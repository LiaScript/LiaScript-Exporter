!function(){var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("E0fFs",(function(t,n){var r,i;r=t.exports,i=function(){return K},Object.defineProperty(r,"joinRoom",{get:i,set:undefined,enumerable:!0,configurable:!0});var a=e("hnmIs"),o=e("9Klpk"),s=e("3bWnf"),c=e("eT7f3"),u=e("bgoEC"),d=e("7j4mF"),l=e("5ENmm"),f=e("6Wo7Q"),h=e("32Euv");function _(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=256*Math.random()|0;return t}function p(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}function g(e,t){return Object.defineProperty(e,"code",{value:t,enumerable:!0,configurable:!0}),e}function y(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var m=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this;if((0,o.default)(this,e),this._map=new Map,this._id=_(4).toString("hex").slice(0,7),this._doDebug=t.debug,this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||_(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||e.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},e.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||function(e){return e},this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=void 0===t.trickle||t.trickle,this.allowHalfTrickle=void 0!==t.allowHalfTrickle&&t.allowHalfTrickle,this.iceCompleteTimeout=t.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&"object"==typeof t.wrtc?t.wrtc:p(),!this._wrtc)throw"undefined"==typeof window?g(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):g(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void this.destroy(g(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=function(){n._onIceStateChange()},this._pc.onicegatheringstatechange=function(){n._onIceStateChange()},this._pc.onconnectionstatechange=function(){n._onConnectionStateChange()},this._pc.onsignalingstatechange=function(){n._onSignalingStateChange()},this._pc.onicecandidate=function(e){n._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((function(e){n.destroy(g(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=function(e){n._setupData(e)},this.streams&&this.streams.forEach((function(e){n.addStream(e)})),this._pc.ontrack=function(e){n._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation()}return(0,s.default)(e,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw g(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.destroy(g(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(g(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch((function(e){!n.address||n.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):t.destroy(g(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this.destroying){if(this.destroyed)throw g(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"addTransceiver",value:function(e,t){if(!this.destroying){if(this.destroyed)throw g(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(g(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw g(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(n){t.addTrack(n,e)}))}}},{key:"addTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw g(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var n=this._senderMap.get(e)||new Map,r=n.get(t);if(r)throw r.removed?g(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,n){if(!this.destroying){if(this.destroyed)throw g(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw g(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(g(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw g(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw g(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(g(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw g(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(n){t.removeTrack(n,e)}))}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this.destroying){if(this.destroyed)throw g(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"destroy",value:function(e){var t=this;this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask((function(){if(t.destroyed=!0,t.destroying=!1,t._debug("destroy (error: %s)",e&&(e.message||e)),t._connected=!1,t._pcReady=!1,t._channelReady=!1,t._remoteTracks=null,t._remoteStreams=null,t._senderMap=null,clearInterval(t._closingInterval),t._closingInterval=null,clearInterval(t._interval),t._interval=null,t._chunk=null,t._cb=null,t._channel){try{t._channel.close()}catch(e){}t._channel.onmessage=null,t._channel.onopen=null,t._channel.onclose=null,t._channel.onerror=null}if(t._pc){try{t._pc.close()}catch(e){}t._pc.oniceconnectionstatechange=null,t._pc.onicegatheringstatechange=null,t._pc.onsignalingstatechange=null,t._pc.onicecandidate=null,t._pc.ontrack=null,t._pc.ondatachannel=null}t._pc=null,t._channel=null,e&&t.emit("error",e),t.emit("close")})))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.destroy(g(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){t.destroy(g(e,"ERR_DATA_CHANNEL"))};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=y(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(g(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(g(t,"ERR_CREATE_OFFER"))}))}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=y(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(g(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(g(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(g(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(g(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(g(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"==={}.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e.getStats((function(n,r){if(!e.destroyed){n&&(r=[]);var i={},a={},o={},s=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));var c=function(t){s=!0;var n=a[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&c(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&c(e)})),s||Object.keys(o).length&&!Object.keys(a).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(g(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var u=e._cb;e._cb=null,u(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))};t()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.emit("data",t)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.destroy())}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some((function(e){return e.id===n.id}))||(t._remoteStreams.push(n),queueMicrotask((function(){t._debug("on stream"),t.emit("stream",n)})))}))}},{key:"_debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._doDebug&&(t[0]="["+this._id+"] "+t[0])}},{key:"on",value:function(e,t){var n=this._map;n.has(e)||n.set(e,new Set),n.get(e).add(t)}},{key:"off",value:function(e,t){var n=this._map,r=n.get(e);r&&(r.delete(t),0===r.size&&n.delete(e))}},{key:"once",value:function(e,t){var n=this,r=function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];n.off(e,r),t.apply(void 0,(0,f.default)(a))};this.on(e,r)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this._map,a=!0,o=!1,s=void 0;if(i.has(e))try{for(var c,u=i.get(e)[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;try{d.apply(void 0,(0,f.default)(n))}catch(e){console.error(e)}}}catch(e){o=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}}]),e}();m.WEBRTC_SUPPORT=!!p(),m.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},m.channelConfig={};var v,b=function(e,t,n){var r=new m({initiator:e,trickle:t,config:n}),i=function(e){return r.__earlyDataBuffer.push(e)};return r.on(I.data,i),r.__earlyDataBuffer=[],r.__drainEarlyData=function(e){r.off(I.data,i),r.__earlyDataBuffer.forEach(e),delete r.__earlyDataBuffer,delete r.__drainEarlyData},r},E=function(e){return Array(e).fill().map((function(){return"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Math.floor(62*Math.random())]})).join("")},R="Trystero",C=E(20),w=Object.keys,T=Object.values,k=Object.entries,S=Object.fromEntries,A=function(){},N=function(e){return Error("".concat(R,": ").concat(e))},D=function(e){return(new TextEncoder).encode(e)},O=function(e){return(new TextDecoder).decode(e)},I=S(["close","connect","data","error","signal","stream","track"].map((function(e){return[e,e]}))),P=Object.getPrototypeOf(Uint8Array),L=16369,q=255,M="bufferedamountlow",U="AES-CBC",j=(v=(0,a.default)((function(e,t){var n,r,i,a,o,s,c;return(0,h.__generator)(this,(function(u){switch(u.label){case 0:return n=crypto.getRandomValues(new Uint8Array(16)),i=JSON.stringify,a={},s=(o=crypto.subtle).encrypt,c=[{name:U,iv:n}],[4,e];case 1:return[4,s.apply(o,c.concat([u.sent(),D(t)]))];case 2:return[2,i.apply(JSON,[(a.c=(r=u.sent(),btoa(String.fromCharCode.apply(null,new Uint8Array(r)))),a.iv=(0,f.default)(n),a)])]}}))})),function(e,t){return v.apply(this,arguments)}),B=function(){var e=(0,a.default)((function(e,t){var n,r,i,a,o,s;return(0,h.__generator)(this,(function(c){switch(c.label){case 0:return n=JSON.parse(t),r=n.c,i=n.iv,o=(a=crypto.subtle).decrypt,s=[{name:U,iv:new Uint8Array(i)}],[4,e];case 1:return[4,o.apply(a,s.concat([c.sent(),function(e){var t=atob(e);return new Uint8Array(t.length).map((function(e,n){return t.charCodeAt(n)})).buffer}(r)]))];case 2:return[2,O.apply(void 0,[c.sent()])]}}))}));return function(t,n){return e.apply(this,arguments)}}(),J={},W={},H={},Y={},F={},x="announce",z=["wss://tracker.webtorrent.dev","wss://tracker.openwebtorrent.com","wss://tracker.files.fm:7073/announce","wss://tracker.btorrent.xyz"],K=function(e,t){return function(t,n){if(e[n])return e[n];if(!t)throw N("requires a config map as the first argument");if(!t.appId&&!t.firebaseApp)throw N("config map is missing appId field");if(!n)throw N("namespace argument required");return e[n]=function(e,t){if(e.trackerUrls||e.trackerRedundancy)throw N("trackerUrls/trackerRedundancy have been replaced by relayUrls/relayRedundancy");var n,r={},i=e.password&&function(){var e=(0,a.default)((function(e,t){var n,r,i;return(0,h.__generator)(this,(function(a){switch(a.label){case 0:return r=(n=crypto.subtle).importKey,i=["raw"],[4,crypto.subtle.digest({name:"SHA-256"},D("".concat(e,":").concat(t)))];case 1:return[2,r.apply(n,i.concat([a.sent(),{name:U},!1,["encrypt","decrypt"]]))]}}))}));return function(t,n){return e.apply(this,arguments)}}()(e.password,t),o=function(e,t,n){return(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||3)}(e,z),s=crypto.subtle.digest("SHA-1",D("".concat(R,":").concat(e.appId,":").concat(t))).then((function(e){return Array.from(new Uint8Array(e)).map((function(e){return e.toString(36)})).join("").slice(0,20)})),f=function(t){return S(Array(t).fill().map((function(){var t=b(!0,!1,e.rtcConfig);return[E(20),{peer:t,offerP:new Promise((function(e){return t.once(I.signal,e)}))}]})))},_=function(){var t=(0,a.default)((function(t,o){var c,l,f,_,p,g,m,E,w,T,k,S,A,N;return(0,h.__generator)(this,(function(D){switch(D.label){case 0:return[4,s];case 1:c=D.sent();try{l=JSON.parse(o.data)}catch(e){return[2,void console.error(R+": received malformed SDP JSON")]}return l.info_hash!==c||l.peer_id&&l.peer_id===C?[2]:(f=l["failure reason"])?(console.warn("".concat(R,": torrent tracker failure from ").concat(t.url," - ").concat(f)),[3,10]):[3,2];case 2:return l.interval&&l.interval>G&&l.interval<=120&&(clearInterval(V),G=l.interval,V=setInterval(y,1e3*G)),l.offer&&l.offer_id?r[l.peer_id]||X[l.offer_id]?[2]:(X[l.offer_id]=!0,(_=b(!1,!1,e.rtcConfig)).once(I.signal,function(){var e=(0,a.default)((function(e){var n,r,a,o,s,f;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:return n=t.send,r=JSON.stringify,a={},i?(s=[(0,u.default)({},e)],f={},[4,j(i,e.sdp)]):[3,2];case 1:return o=d.default.apply(void 0,s.concat([(f.sdp=h.sent(),f)])),[3,3];case 2:o=e,h.label=3;case 3:return[2,n.apply(t,[r.apply(JSON,[(a.answer=o,a.action=x,a.info_hash=c,a.peer_id=C,a.to_peer_id=l.peer_id,a.offer_id=l.offer_id,a)])])]}}))}));return function(t){return e.apply(this,arguments)}}()),_.on(I.connect,(function(){return v(_,l.peer_id)})),_.on(I.close,(function(){return K(_,l.peer_id,l.offer_id)})),p=_.signal,i?(m=[(0,u.default)({},l.offer)],E={},[4,B(i,l.offer.sdp)]):[3,4]):[3,6];case 3:return g=d.default.apply(void 0,m.concat([(E.sdp=D.sent(),E)])),[3,5];case 4:g=l.offer,D.label=5;case 5:return[2,void p.apply(_,[g])];case 6:return l.answer?r[l.peer_id]||X[l.offer_id]?[2]:(w=n[l.offer_id])?(T=w.peer).destroyed?[2]:(X[l.offer_id]=!0,T.on(I.connect,(function(){return v(T,l.peer_id,l.offer_id)})),T.on(I.close,(function(){return K(T,l.peer_id,l.offer_id)})),k=T.signal,i?(A=[(0,u.default)({},l.answer)],N={},[4,B(i,l.answer.sdp)]):[3,8]):[3,10]:[3,10];case 7:return S=d.default.apply(void 0,A.concat([(N.sdp=D.sent(),N)])),[3,9];case 8:S=l.answer,D.label=9;case 9:k.apply(T,[S]),D.label=10;case 10:return[2]}}))}));return function(e,n){return t.apply(this,arguments)}}(),p=function(){var e=(0,a.default)((function(e,t){var r,o,s;return(0,h.__generator)(this,(function(c){switch(c.label){case 0:return r=e.send,o=JSON.stringify,s={action:x,info_hash:t,numwant:10,peer_id:C},[4,Promise.all(k(n).map(function(){var e=(0,a.default)((function(e){var t,n,r,a,o,s,c;return(0,h.__generator)(this,(function(f){switch(f.label){case 0:return t=(0,l.default)(e,2),n=t[0],[4,t[1].offerP];case 1:return r=f.sent(),a={offer_id:n},i?(s=[(0,u.default)({},r)],c={},[4,j(i,r.sdp)]):[3,3];case 2:return o=d.default.apply(void 0,s.concat([(c.sdp=f.sent(),c)])),[3,4];case 3:o=r,f.label=4;case 4:return[2,(a.offer=o,a)]}}))}));return function(t){return e.apply(this,arguments)}}()))];case 1:return[2,r.apply(e,[o.apply(JSON,[(s.offers=c.sent(),s)])])]}}))}));return function(t,n){return e.apply(this,arguments)}}(),g=function(e,t,n){return n||!W[e]?(F[e]=(0,d.default)((0,u.default)({},F[e]),(0,c.default)({},t,_)),W[e]=new Promise((function(n){var r=new WebSocket(e);H[e]=r,r.addEventListener("open",(function(){Y[e]=4e3,n(r)})),r.addEventListener("message",(function(t){return T(F[e]).forEach((function(e){return e(r,t)}))})),r.addEventListener("close",(0,a.default)((function(){var n,r;return(0,h.__generator)(this,(function(i){switch(i.label){case 0:return Y[e]=null!==(r=Y[e])&&void 0!==r?r:4e3,[4,(n=Y[e],new Promise((function(e){return setTimeout(e,n)})))];case 1:return i.sent(),Y[e]*=2,g(e,t,!0),[2]}}))})))}))):F[e][t]=_,W[e]},y=function(){var e=(0,a.default)((function(){var e;return(0,h.__generator)(this,(function(t){switch(t.label){case 0:return[4,s];case 1:return e=t.sent(),n&&m(),n=f(10),o.forEach(function(){var t=(0,a.default)((function(t){var n;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:return[4,g(t,e)];case 1:return(n=r.sent()).readyState!==WebSocket.OPEN?[3,2]:(p(n,e),[3,5]);case 2:return n.readyState!==WebSocket.CONNECTING?[4,g(t,e,!0)]:[3,4];case 3:p.apply(void 0,[r.sent(),e]),r.label=4;case 4:r.label=5;case 5:return[2]}}))}));return function(e){return t.apply(this,arguments)}}()),[2]}}))}));return function(){return e.apply(this,arguments)}}(),m=function(){k(n).forEach((function(e){var t=(0,l.default)(e,2),n=t[0],i=t[1].peer;X[n]||r[n]||i.destroy()})),X={}},v=function(e,t,n){Q(e,t),r[t]=!0,n&&(r[n]=!0)},K=function(e,t,i){delete r[t],e.destroy(),i in n&&(delete n[i],n=(0,u.default)({},n,f(1)))},G=33,V=setInterval(y,1e3*G),Q=A,X={};return y(),function(e,t){var n={},r={},i={},o={},s={},c={},f=function(e,t){return(e?Array.isArray(e)?e:[e]:w(n)).flatMap((function(e){var r=n[e];return r?t(e,r):(console.warn("".concat(R,": no peer with id ").concat(e," found")),[])}))},_=function(e){if(r[e])return[r[e].send,r[e].setOnComplete,r[e].setOnProgress];if(!e)throw N("action type argument is required");var t=D(e);if(t.byteLength>12)throw N('action type string "'.concat(e,'" (').concat(t.byteLength,"b) exceeds byte limit (12). Hint: choose a shorter name."));var i=new Uint8Array(12);i.set(t);var o=0;return r[e]={onComplete:A,onProgress:A,setOnComplete:function(t){return r[e]=(0,d.default)((0,u.default)({},r[e]),{onComplete:t})},setOnProgress:function(t){return r[e]=(0,d.default)((0,u.default)({},r[e]),{onProgress:t})},send:function(e,t,r,s){return(0,a.default)((function(){var c,u,d,l,_,p,g,y,m,v;return(0,h.__generator)(this,(function(b){switch(b.label){case 0:if(r&&"object"!=typeof r)throw N("action meta argument must be an object");if(void 0===e)throw N("action data cannot be undefined");if(c="string"!=typeof e,u=e instanceof Blob,d=u||e instanceof ArrayBuffer||e instanceof P,r&&!d)throw N("action meta argument can only be used with binary data");return d?(m=Uint8Array.bind,u?[4,e.arrayBuffer()]:[3,2]):[3,4];case 1:return v=b.sent(),[3,3];case 2:v=e,b.label=3;case 3:return y=new(m.apply(Uint8Array,[void 0,v])),[3,5];case 4:y=D(c?JSON.stringify(e):e),b.label=5;case 5:return l=y,_=r?D(JSON.stringify(r)):null,p=Math.ceil(l.byteLength/L)+(r?1:0)||1,g=Array(p).fill().map((function(e,t){var n=t===p-1,a=r&&0===t,s=new Uint8Array(15+(a?_.byteLength:n?l.byteLength-L*(p-(r?2:1)):L));return s.set(i),s.set([o],12),s.set([n|a<<1|d<<2|c<<3],13),s.set([Math.round((t+1)/p*q)],14),s.set(r?a?_:l.subarray((t-1)*L,t*L):l.subarray(t*L,(t+1)*L),15),s})),[2,(o=o+1&q,Promise.all(f(t,(E=(0,a.default)((function(e,t){var i,a,o;return(0,h.__generator)(this,(function(c){switch(c.label){case 0:i=t._channel,a=0,c.label=1;case 1:return a<p?(o=g[a],i.bufferedAmount>i.bufferedAmountLowThreshold?[4,new Promise((function(e){var t=function(){i.removeEventListener(M,t),e()};i.addEventListener(M,t)}))]:[3,3]):[3,5];case 2:c.sent(),c.label=3;case 3:if(!n[e])return[3,5];t.send(o),a++,s&&s(o[14]/q,e,r),c.label=4;case 4:return[3,1];case 5:return[2]}}))})),function(e,t){return E.apply(this,arguments)}))))]}var E}))}))()}},[r[e].send,r[e].setOnComplete,r[e].setOnProgress]},p=function(e,t){var n=new Uint8Array(t),a=O(n.subarray(0,12)).replaceAll("\0",""),o=(0,l.default)(n.subarray(12,13),1)[0],s=(0,l.default)(n.subarray(13,14),1)[0],c=(0,l.default)(n.subarray(14,15),1)[0],u=n.subarray(15),d=!!(1&s),f=!!(2&s),h=!!(4&s),_=!!(8&s);if(!r[a])throw N("received message with unregistered type (".concat(a,")"));i[e]||(i[e]={}),i[e][a]||(i[e][a]={});var p=i[e][a][o];if(p||(p=i[e][a][o]={chunks:[]}),f?p.meta=JSON.parse(O(u)):p.chunks.push(u),r[a].onProgress(c/q,e,p.meta),d){var g=new Uint8Array(p.chunks.reduce((function(e,t){return e+t.byteLength}),0));if(p.chunks.reduce((function(e,t){return g.set(t,e),e+t.byteLength}),0),h)r[a].onComplete(g,e,p.meta);else{var y=O(g);r[a].onComplete(_?JSON.parse(y):y,e)}delete i[e][a][o]}},g=(0,l.default)(_("__91n6__"),2),y=g[0],m=g[1],v=(0,l.default)(_("__90n6__"),2),b=v[0],E=v[1],C=(0,l.default)(_("__516n4L__"),2),T=C[0],U=C[1],j=(0,l.default)(_("__57r34m__"),2),B=j[0],J=j[1],W=(0,l.default)(_("__7r4ck__"),2),H=W[0],Y=W[1],F=A,x=A,z=A,K=A;return function(e){Q=e}((function(e,t){if(!n[t]){var r=p.bind(null,t);n[t]=e,e.on(I.signal,(function(e){return T(e,t)})),e.on(I.close,(function(){return function(e){n[e]&&(delete n[e],delete i[e],delete o[e],x(e))}(t)})),e.on(I.data,r),e.on(I.stream,(function(e){z(e,t,s[t]),delete s[t]})),e.on(I.track,(function(e,n){K(e,n,t,c[t]),delete c[t]})),e.on(I.error,(function(e){"ERR_DATA_CHANNEL"!==e.code&&console.error(e)})),F(t),e.__drainEarlyData(r)}})),m((function(e,t){return b("",t)})),E((function(e,t){o[t]&&(o[t](),delete o[t])})),U((function(e,t){n[t]&&n[t].signal(e)})),J((function(e,t){return s[t]=e})),Y((function(e,t){return c[t]=e})),{makeAction:_,ping:function(e){return(0,a.default)((function(){var t;return(0,h.__generator)(this,(function(n){switch(n.label){case 0:if(!e)throw N("ping() must be called with target peer ID");return t=Date.now(),y("",e),[4,new Promise((function(t){return o[e]=t}))];case 1:return[2,(n.sent(),Date.now()-t)]}}))}))()},leave:function(){k(n).forEach((function(e){var t=(0,l.default)(e,2),r=t[0];t[1].destroy(),delete n[r]})),t()},getPeers:function(){return S(k(n).map((function(e){var t=(0,l.default)(e,2);return[t[0],t[1]._pc]})))},addStream:function(e,t,n){return f(t,(r=(0,a.default)((function(t,r){return(0,h.__generator)(this,(function(i){switch(i.label){case 0:return n?[4,B(n,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r.addStream(e),[2]}}))})),function(e,t){return r.apply(this,arguments)}));var r},removeStream:function(e,t){return f(t,(function(t,n){return n.removeStream(e)}))},addTrack:function(e,t,n,r){return f(n,(i=(0,a.default)((function(n,i){return(0,h.__generator)(this,(function(a){switch(a.label){case 0:return r?[4,H(r,n)]:[3,2];case 1:a.sent(),a.label=2;case 2:return i.addTrack(e,t),[2]}}))})),function(e,t){return i.apply(this,arguments)}));var i},removeTrack:function(e,t,n){return f(n,(function(n,r){return r.removeTrack(e,t)}))},replaceTrack:function(e,t,n,r,i){return f(r,(o=(0,a.default)((function(r,a){return(0,h.__generator)(this,(function(o){switch(o.label){case 0:return i?[4,H(i,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return a.replaceTrack(e,t,n),[2]}}))})),function(e,t){return o.apply(this,arguments)}));var o},onPeerJoin:function(e){return F=e},onPeerLeave:function(e){return x=e},onPeerStream:function(e){return z=e},onPeerTrack:function(e){return K=e}}}(0,(0,a.default)((function(){var e;return(0,h.__generator)(this,(function(n){switch(n.label){case 0:return[4,s];case 1:return e=n.sent(),o.forEach((function(t){return delete F[t][e]})),delete J[t],clearInterval(V),m(),[2]}}))})))}(t,n)}}(J)}))}();
