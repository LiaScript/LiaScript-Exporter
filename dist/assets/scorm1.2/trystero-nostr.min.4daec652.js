var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("g9MJ9",(function(t,n){var r,a,o,s;r=t.exports,a="joinRoom",o=function(){return Bt},Object.defineProperty(r,a,{get:o,set:s,enumerable:!0,configurable:!0});var i,c,l,d,f,u,y,p,m,h,v,g,w,b,A,k,T,x,P,S=e("2Xs1f"),E=e("dM3DM"),C=e("aQXMn");const L={p:0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,n:0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,h:1n,a:0n,b:7n,Gx:0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy:0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n},{p:U,n:D,Gx:I,Gy:$,b:O}=L,R=32,j={publicKey:33,publicKeyUncompressed:65,seed:48},H=(e="")=>{const t=Error(e);throw((...e)=>{"captureStackTrace"in Error&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(...e)})(t,H),t},K=(e,t,n="")=>{const r=(a=e)instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name;var a;const o=null==e?void 0:e.length,s=void 0!==t;return(!r||s&&o!==t)&&H((n&&`"${n}" `)+"expected Uint8Array"+(s?" of length "+t:"")+", got "+(r?"length="+o:"type="+typeof e)),e},M=e=>new Uint8Array(e),B=(e,t)=>e.toString(16).padStart(t,"0"),V=e=>Array.from(K(e)).map((e=>B(e,2))).join(""),X=e=>e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0,Z=e=>{const t="hex invalid";if("string"!=typeof e)return H(t);const n=e.length,r=n/2;if(n%2)return H(t);const a=M(r);for(let n=0,o=0;n<r;n++,o+=2){const r=X(e.charCodeAt(o)),s=X(e.charCodeAt(o+1));if(void 0===r||void 0===s)return H(t);a[n]=16*r+s}return a},q=()=>null===globalThis||void 0===globalThis?void 0:globalThis.crypto,Y=()=>{var e;return null!==(P=null===(e=q())||void 0===e?void 0:e.subtle)&&void 0!==P?P:H("crypto.subtle must be defined, consider polyfill")},G=(...e)=>{const t=M(e.reduce(((e,t)=>e+K(t).length),0));let n=0;return e.forEach((e=>{t.set(e,n),n+=e.length})),t},J=(e=32)=>q().getRandomValues(M(e)),N=BigInt,_=(e,t,n,r="bad number: out of range")=>(e=>"bigint"==typeof e)(e)&&t<=e&&e<n?e:H(r),z=(e,t=U)=>{const n=e%t;return n>=0n?n:t+n},Q=e=>z(e,D),F=e=>e instanceof oe?e:H("Point expected"),W=e=>z(z(e*e)*e+O),ee=e=>_(e,0n,U),te=e=>_(e,1n,U),ne=e=>0n===(1n&e),re=e=>Uint8Array.of(e),ae=e=>{const t=W(te(e));let n=1n;for(let e=t,r=(U+1n)/4n;r>0n;r>>=1n)1n&r&&(n=n*e%U),e=e*e%U;return z(n*n)===t?n:H("sqrt invalid")};class oe{static CURVE(){return L}static fromAffine(e){const{x:t,y:n}=e;return 0n===t&&0n===n?ie:new oe(t,n,1n)}static fromBytes(e){K(e);const{publicKey:t,publicKeyUncompressed:n}=j;let r;const a=e.length,o=e[0],s=e.subarray(1),i=le(s,0,R);if(a===t&&(2===o||3===o)){let e=ae(i);const t=ne(e);ne(N(o))!==t&&(e=z(-e)),r=new oe(i,e,1n)}return a===n&&4===o&&(r=new oe(i,le(s,R,64),1n)),r?r.assertValidity():H("bad point: not on curve")}static fromHex(e){return oe.fromBytes(Z(e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(e){const{X:t,Y:n,Z:r}=this,{X:a,Y:o,Z:s}=F(e),i=z(t*s),c=z(a*r),l=z(n*s),d=z(o*r);return i===c&&l===d}is0(){return this.equals(ie)}negate(){return new oe(this.X,z(-this.Y),this.Z)}double(){return this.add(this)}add(e){const{X:t,Y:n,Z:r}=this,{X:a,Y:o,Z:s}=F(e);let i=0n,c=0n,l=0n;const d=z(3n*O);let f=z(t*a),u=z(n*o),y=z(r*s),p=z(t+n),m=z(a+o);p=z(p*m),m=z(f+u),p=z(p-m),m=z(t+r);let h=z(a+s);return m=z(m*h),h=z(f+y),m=z(m-h),h=z(n+r),i=z(o+s),h=z(h*i),i=z(u+y),h=z(h-i),l=z(0n*m),i=z(d*y),l=z(i+l),i=z(u-l),l=z(u+l),c=z(i*l),u=z(f+f),u=z(u+f),y=z(0n*y),m=z(d*m),u=z(u+y),y=z(f-y),y=z(0n*y),m=z(m+y),f=z(u*m),c=z(c+f),f=z(h*m),i=z(p*i),i=z(i-f),f=z(p*u),l=z(h*l),l=z(l+f),new oe(i,c,l)}subtract(e){return this.add(F(e).negate())}multiply(e,t=!0){if(!t&&0n===e)return ie;if((e=>{_(e,1n,D)})(e),1n===e)return this;if(this.equals(se))return je(e).p;let n=ie,r=se;for(let a=this;e>0n;a=a.double(),e>>=1n)1n&e?n=n.add(a):t&&(r=r.add(a));return n}multiplyUnsafe(e){return this.multiply(e,!1)}toAffine(){const{X:e,Y:t,Z:n}=this;if(this.equals(ie))return{x:0n,y:0n};if(1n===n)return{x:e,y:t};const r=((e,t)=>{(0n===e||t<=0n)&&H("no inverse n="+e+" mod="+t);let n=z(e,t),r=t,a=0n,o=1n;for(;0n!==n;){const e=r%n,t=a-o*(r/n);r=n,n=e,a=o,o=t}return 1n===r?z(a,t):H("no inverse")})(n,U);return 1n!==z(n*r)&&H("inverse invalid"),{x:z(e*r),y:z(t*r)}}assertValidity(){const{x:e,y:t}=this.toAffine();return te(e),te(t),z(t*t)===W(e)?this:H("bad point: not on curve")}toBytes(e=!0){const{x:t,y:n}=this.assertValidity().toAffine(),r=fe(t);return e?G((e=>re(ne(e)?2:3))(n),r):G(re(4),r,fe(n))}toHex(e){return V(this.toBytes(e))}constructor(e,t,n){(0,S.default)(this,"X",void 0),(0,S.default)(this,"Y",void 0),(0,S.default)(this,"Z",void 0),this.X=ee(e),this.Y=te(t),this.Z=ee(n),Object.freeze(this)}}(0,S.default)(oe,"BASE",void 0),(0,S.default)(oe,"ZERO",void 0);const se=new oe(I,$,1n),ie=new oe(0n,1n,0n);oe.BASE=se,oe.ZERO=ie;const ce=e=>N("0x"+(V(e)||"0")),le=(e,t,n)=>ce(e.subarray(t,n)),de=2n**256n,fe=e=>Z(B(_(e,0n,de),64)),ue="SHA-256",ye={async hmacSha256Async(e,t){const n=Y(),r="HMAC",a=await n.importKey("raw",e,{name:r,hash:{name:ue}},!1,["sign"]);return M(await n.sign(r,a,t))},hmacSha256:void 0,sha256Async:async e=>M(await Y().digest(ue,e)),sha256:void 0},pe=e=>Uint8Array.from("BIP0340/"+e,(e=>e.charCodeAt(0))),me="nonce",he="challenge",ve=(e,...t)=>{const n=(e=>{const t=ye[e];return"function"!=typeof t&&H("hashes."+e+" not set"),t})("sha256"),r=n(pe(e));return n(G(r,r,...t))},ge=async(e,...t)=>{const n=ye.sha256Async,r=await n(pe(e));return await n(G(r,r,...t))},we=e=>{const t=(e=>{const t=ce(K(e,R,"secret key"));return _(t,1n,D,"invalid secret key: outside of range")})(e),n=se.multiply(t),{x:r,y:a}=n.assertValidity().toAffine();return{d:ne(a)?t:Q(-t),px:fe(r)}},be=e=>Q(ce(e)),Ae=(...e)=>be(ve(he,...e)),ke=async(...e)=>be(await ge(he,...e)),Te=e=>we(e).px,xe=(Pe=Te,e=>{const t=((e=J(j.seed))=>{K(e),(e.length<j.seed||e.length>1024)&&H("expected 40-1024b");const t=z(ce(e),D-1n);return fe(t+1n)})(e);return{secretKey:t,publicKey:Pe(t)}});var Pe;const Se=(e,t,n)=>{const{px:r,d:a}=we(t);return{m:K(e),px:r,d:a,a:K(n,R)}},Ee=e=>{const t=be(e);0n===t&&H("sign failed: k is zero");const{px:n,d:r}=we(fe(t));return{rx:n,k:r}},Ce=(e,t,n,r)=>G(t,fe(Q(e+n*r))),Le="invalid signature produced",Ue=(e,t,n,r)=>{const a=K(e,64,"signature"),o=K(t,void 0,"message"),s=K(n,R,"publicKey");try{const e=ce(s),t=ae(e),n=ne(t)?t:z(-t),l=new oe(e,n,1n).assertValidity(),d=fe(l.toAffine().x),f=le(a,0,R);_(f,1n,U);const u=le(a,R,64);_(u,1n,D);return i=r(G(fe(f),d,o)),c=e=>{const{x:t,y:n}=(r=l,a=u,o=Q(-e),se.multiply(a,!1).add(r.multiply(o,!1)).assertValidity()).toAffine();var r,a,o;return!(!ne(n)||t!==f)},i instanceof Promise?i.then(c):c(i)}catch(e){return!1}var i,c},De=(e,t,n)=>Ue(e,t,n,Ae),Ie=async(e,t,n)=>Ue(e,t,n,ke),$e={keygen:xe,getPublicKey:Te,sign(e,t,n=J(R)){const{m:r,px:a,d:o,a:s}=Se(e,t,n),i=ve("aux",s),c=fe(o^ce(i)),l=ve(me,c,a,r),{rx:d,k:f}=Ee(l),u=Ae(d,a,r),y=Ce(f,d,u,o);return De(y,r,a)||H(Le),y},verify:De,async signAsync(e,t,n=J(R)){const{m:r,px:a,d:o,a:s}=Se(e,t,n),i=await ge("aux",s),c=fe(o^ce(i)),l=await ge(me,c,a,r),{rx:d,k:f}=Ee(l),u=await ke(d,a,r),y=Ce(f,d,u,o);return await Ie(y,r,a)||H(Le),y},verifyAsync:Ie};let Oe;const Re=(e,t)=>{const n=t.negate();return e?n:t},je=e=>{const t=Oe||(Oe=(()=>{const e=[];let t=se,n=t;for(let r=0;r<33;r++){n=t,e.push(n);for(let r=1;r<128;r++)n=n.add(t),e.push(n);t=n.double()}return e})());let n=ie,r=se;const a=N(255),o=N(8);for(let s=0;s<33;s++){let i=Number(e&a);e>>=o,i>128&&(i-=256,e+=1n);const c=128*s,l=c,d=c+Math.abs(i)-1,f=s%2!=0,u=i<0;0===i?r=r.add(Re(f,t[l])):n=n.add(Re(u,t[d]))}return 0n!==e&&H("invalid wnaf"),{p:n,f:r}},{floor:He,random:Ke,sin:Me}=Math,Be="Trystero",Ve=(e,t)=>Array(e).fill().map(t),Xe=e=>Ve(e,(()=>"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[He(62*Ke())])).join(""),Ze=Xe(20),qe=Promise.all.bind(Promise),Ye="undefined"!=typeof window,{entries:Ge,fromEntries:Je,keys:Ne}=Object,_e=()=>{},ze=e=>Error(`${Be}: ${e}`),Qe=new TextEncoder,Fe=new TextDecoder,We=e=>Qe.encode(e),et=e=>Fe.decode(e),tt=e=>e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),nt=(...e)=>e.join("@"),rt=JSON.stringify,at=JSON.parse,ot=(e,t=Number.MAX_SAFE_INTEGER)=>e.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0)%t,st={};let it=null,ct=null;const lt=()=>{it||(it=new Promise((e=>{ct=e})).finally((()=>{ct=null,it=null})))},dt=()=>null==ct?void 0:ct(),ft="AES-GCM",ut={},yt=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,We(t))),pt=async e=>(i=ut)[c=e]||(i[c]=Array.from(await yt("SHA-1",e)).map((e=>e.toString(36))).join("")),mt=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));var r;return n.join(",")+"$"+(r=await crypto.subtle.encrypt({name:ft,iv:n},await e,We(t)),btoa(String.fromCharCode.apply(null,new Uint8Array(r))))},ht=async(e,t)=>{const[n,r]=t.split("$");return et(await crypto.subtle.decrypt({name:ft,iv:new Uint8Array(n.split(","))},await e,(e=>{const t=atob(e);return new Uint8Array(t.length).map(((e,n)=>t.charCodeAt(n))).buffer})(r)))},vt="icegatheringstatechange",gt="offer";var wt=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:r})=>{const a=new(n||RTCPeerConnection)((0,E.default)({iceServers:bt.concat(r||[])},t)),o={};let s=!1,i=!1,c=null;const l=e=>{e.binaryType="arraybuffer",e.bufferedAmountLowThreshold=65535,e.onmessage=e=>{var t;return null===(t=o.data)||void 0===t?void 0:t.call(o,e.data)},e.onopen=()=>{var e;return null===(e=o.connect)||void 0===e?void 0:e.call(o)},e.onclose=()=>{var e;return null===(e=o.close)||void 0===e?void 0:e.call(o)},e.onerror=e=>{var t;return null===(t=o.error)||void 0===t?void 0:t.call(o,e)}},d=e=>Promise.race([new Promise((t=>{const n=()=>{"complete"===e.iceGatheringState&&(e.removeEventListener(vt,n),t())};e.addEventListener(vt,n),n()})),new Promise((e=>setTimeout(e,5e3)))]).then((()=>({type:e.localDescription.type,sdp:e.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")})));return e?(c=a.createDataChannel("data"),l(c)):a.ondatachannel=({channel:e})=>{c=e,l(e)},a.onnegotiationneeded=async()=>{try{var e;s=!0,await a.setLocalDescription();const t=await d(a);null===(e=o.signal)||void 0===e||e.call(o,t)}catch(e){var t;null===(t=o.error)||void 0===t||t.call(o,e)}finally{s=!1}},a.onconnectionstatechange=()=>{var e;["disconnected","failed","closed"].includes(a.connectionState)&&(null===(e=o.close)||void 0===e||e.call(o))},a.ontrack=e=>{var t,n;null===(t=o.track)||void 0===t||t.call(o,e.track,e.streams[0]),null===(n=o.stream)||void 0===n||n.call(o,e.streams[0])},a.onremovestream=e=>{var t;return null===(t=o.stream)||void 0===t?void 0:t.call(o,e.stream)},e&&(a.canTrickleIceCandidates||a.onnegotiationneeded()),{created:Date.now(),connection:a,get channel(){return c},get isDead(){return"closed"===a.connectionState},async signal(t){var n;if("open"!==(null==c?void 0:c.readyState)||(null===(n=t.sdp)||void 0===n?void 0:n.includes("a=rtpmap")))try{if(t.type===gt){var r;if(s||"stable"!==a.signalingState&&!i){if(e)return;await qe([a.setLocalDescription({type:"rollback"}),a.setRemoteDescription(t)])}else await a.setRemoteDescription(t);await a.setLocalDescription();const n=await d(a);return null===(r=o.signal)||void 0===r||r.call(o,n),n}if("answer"===t.type){i=!0;try{await a.setRemoteDescription(t)}finally{i=!1}}}catch(e){var l;null===(l=o.error)||void 0===l||l.call(o,e)}},sendData:e=>c.send(e),destroy(){null==c||c.close(),a.close(),s=!1,i=!1},setHandlers:e=>Object.assign(o,e),offerPromise:e?new Promise((e=>o.signal=t=>{t.type===gt&&e(t)})):Promise.resolve(),addStream:e=>e.getTracks().forEach((t=>a.addTrack(t,e))),removeStream:e=>a.getSenders().filter((t=>e.getTracks().includes(t.track))).forEach((e=>a.removeTrack(e))),addTrack:(e,t)=>a.addTrack(e,t),removeTrack(e){const t=a.getSenders().find((t=>t.track===e));t&&a.removeTrack(t)},replaceTrack(e,t){const n=a.getSenders().find((t=>t.track===e));if(n)return n.replaceTrack(t)}}};const bt=[...Ve(3,((e,t)=>`stun:stun${t||""}.l.google.com:19302`)),"stun:stun.cloudflare.com:3478"].map((e=>({urls:e}))),At=Object.getPrototypeOf(Uint8Array),kt=16369,Tt=255,xt="bufferedamountlow",Pt=e=>"@_"+e;var St;const Et={},Ct="EVENT",{secretKey:Lt,publicKey:Ut}=$e.keygen(),Dt=tt(Ut),It={},$t={},Ot={},Rt=()=>Math.floor(Date.now()/1e3),jt=e=>null!==(St=(v=Ot)[g=e])&&void 0!==St?St:v[g]=ot(e,1e4)+2e4,Ht=async(e,t)=>{const n={kind:jt(e),tags:[["x",e]],created_at:Rt(),content:t,pubkey:Dt},r=await yt("SHA-256",rt([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]));return rt([Ct,(0,C.default)((0,E.default)({},n),{id:tt(r),sig:tt(await $e.signAsync(r,Lt))})])},Kt=(e,t)=>(It[e]=t,rt(["REQ",e,{kinds:[jt(t)],since:Rt(),"#x":[t]}])),Mt=e=>(delete It[e],rt(["CLOSE",e])),Bt=(({init:e,subscribe:t,announce:n})=>{const r={};let a,o,s,i,c=!1;return(v,g,T)=>{var x;const{appId:P}=v;if(null===(x=r[P])||void 0===x?void 0:x[g])return r[P][g];const S={},L={},U=nt(Be,P,g),D=pt(U),I=pt(nt(U,Ze)),$=(async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},We(`${e}:${t}:${n}`)),{name:ft},!1,["encrypt","decrypt"]))(v.password||"",P,g),O=e=>async t=>({type:t.type,sdp:await e($,t.sdp)}),R=O(ht),j=O(mt),H=()=>wt(!0,v),K=(e,t,n)=>{var r;L[t]?L[t]!==e&&e.destroy():(L[t]=e,Y(e,t),null===(r=S[t])||void 0===r||r.forEach(((e,t)=>{t!==n&&e.destroy()})),delete S[t])},M=(e,t)=>{L[t]===e&&delete L[t]},B=e=>(o.push(...Ve(e,H)),qe(o.splice(0,e).map((e=>e.offerPromise.then(j).then((t=>({peer:e,offer:t}))))))),V=(e,t)=>null==T?void 0:T({error:`incorrect password (${v.password}) when decrypting ${t}`,appId:P,peerId:e,roomId:g});if(!v)throw ze("requires a config map as the first argument");if(!P&&!v.firebaseApp)throw ze("config map is missing appId field");if(!g)throw ze("roomId argument required");if(!c){const t=e(v);o=Ve(20,H),a=Array.isArray(t)?t:[t],c=!0,s=setInterval((()=>o=o.filter((e=>{const t=Date.now()-e.created<57333;return t||e.destroy(),t}))),59052.99),i=v.manualRelayReconnection?_e:(()=>{if(Ye){const e=new AbortController;return addEventListener("online",dt,{signal:e.signal}),addEventListener("offline",lt,{signal:e.signal}),()=>e.abort()}return _e})()}const X=a.map((()=>5333)),Z=[],q=a.map((async(e,n)=>t(await e,await D,await I,(e=>async(t,n,r)=>{const[a,o]=await qe([D,I]);if(t!==a&&t!==o)return;const{peerId:s,offer:i,answer:c,peer:l}="string"==typeof n?at(n):n;if(s!==Ze&&!L[s])if(!s||i||c){if(i){var d;if((null===(d=S[s])||void 0===d?void 0:d[e])&&Ze>s)return;const t=wt(!1,v);let n;t.setHandlers({connect:()=>K(t,s,e),close:()=>M(t,s)});try{n=await R(i)}catch(e){return void V(s,"offer")}if(t.isDead)return;const[a,o]=await qe([pt(nt(U,s)),t.signal(n)]);r(a,rt({peerId:Ze,answer:await j(o)}))}else if(c){let t;try{t=await R(c)}catch(e){return void V(s,"answer")}if(l)l.setHandlers({connect:()=>K(l,s,e),close:()=>M(l,s)}),l.signal(t);else{var f;const n=null===(f=S[s])||void 0===f?void 0:f[e];n&&!n.isDead&&n.signal(t)}}}else{var u;if(null===(u=S[s])||void 0===u?void 0:u[e])return;const[[{peer:t,offer:n}],a]=await qe([B(1),pt(nt(U,s))]);(w=S)[b=s]||(w[b]=[]),S[s][e]=t,setTimeout((()=>((e,t)=>{var n;if(L[e])return;const r=null===(n=S[e])||void 0===n?void 0:n[t];r&&(delete S[e][t],r.destroy())})(s,e)),.9*X[e]),t.setHandlers({connect:()=>K(t,s,e),close:()=>M(t,s)}),r(a,rt({peerId:Ze,offer:n}))}})(n),B)));qe([D,I]).then((([e,t])=>{const r=async(a,o)=>{const s=await n(a,e,t);"number"==typeof s&&(X[o]=s),Z[o]=setTimeout((()=>r(a,o)),X[o])};q.forEach((async(e,t)=>{await e,r(await a[t],t)}))}));let Y=_e;return(A=r)[k=P]||(A[k]={}),r[P][g]=((e,t,n)=>{const r={},a={},o={},s={},i={},c={},v={},g={onPeerJoin:_e,onPeerLeave:_e,onPeerStream:_e,onPeerTrack:_e},w=(e,t)=>(e?Array.isArray(e)?e:[e]:Ne(r)).flatMap((e=>{const n=r[e];return n?t(e,n):(console.warn(`${Be}: no peer with id ${e} found`),[])})),b=e=>{r[e]&&(r[e].destroy(),delete r[e],delete s[e],delete i[e],g.onPeerLeave(e),t(e))},A=e=>{if(a[e])return o[e];if(!e)throw ze("action type argument is required");const t=We(e);if(t.byteLength>12)throw ze(`action type string "${e}" (${t.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const n=new Uint8Array(12);n.set(t);let s=0;return a[e]={onComplete:_e,onProgress:_e,setOnComplete:t=>a[e]=(0,C.default)((0,E.default)({},a[e]),{onComplete:t}),setOnProgress:t=>a[e]=(0,C.default)((0,E.default)({},a[e]),{onProgress:t}),async send(e,t,a,o){if(a&&"object"!=typeof a)throw ze("action meta argument must be an object");const i=typeof e;if("undefined"===i)throw ze("action data cannot be undefined");const c="string"!==i,l=e instanceof Blob,d=l||e instanceof ArrayBuffer||e instanceof At;if(a&&!d)throw ze("action meta argument can only be used with binary data");const f=d?new Uint8Array(l?await e.arrayBuffer():e):We(c?rt(e):e),u=a?We(rt(a)):null,y=Math.ceil(f.byteLength/kt)+(a?1:0)||1,p=Ve(y,((e,t)=>{const r=t===y-1,o=a&&0===t,i=new Uint8Array(15+(o?u.byteLength:r?f.byteLength-kt*(y-(a?2:1)):kt));return i.set(n),i.set([s],12),i.set([r|o<<1|d<<2|c<<3],13),i.set([Math.round((t+1)/y*Tt)],14),i.set(a?o?u:f.subarray((t-1)*kt,t*kt):f.subarray(t*kt,(t+1)*kt),15),i}));return s=s+1&Tt,qe(w(t,(async(e,t)=>{const{channel:n}=t;let s=0;for(;s<y;){const i=p[s];if(n.bufferedAmount>n.bufferedAmountLowThreshold&&await new Promise((e=>{const t=()=>{n.removeEventListener(xt,t),e()};n.addEventListener(xt,t)})),!r[e])break;t.sendData(i),s++,null==o||o(i[14]/Tt,e,a)}})))}},(l=o)[d=e]||(l[d]=[a[e].send,a[e].setOnComplete,a[e].setOnProgress])},k=async()=>{await R(""),await new Promise((e=>setTimeout(e,99))),Ge(r).forEach((([e,t])=>{t.destroy(),delete r[e]})),n()},[T,x]=A(Pt("ping")),[P,S]=A(Pt("pong")),[L,U]=A(Pt("signal")),[D,I]=A(Pt("stream")),[$,O]=A(Pt("track")),[R,j]=A(Pt("leave"));return e(((e,t)=>{r[t]||(r[t]=e,e.setHandlers({data:e=>((e,t)=>{const n=new Uint8Array(t),r=et(n.subarray(0,12)).replaceAll("\0",""),[o]=n.subarray(12,13),[i]=n.subarray(13,14),[c]=n.subarray(14,15),l=n.subarray(15),d=!!(1&i),v=!!(2&i),g=!!(4&i),w=!!(8&i);if(!a[r])return void console.warn(`${Be}: received message with unregistered type (${r})`);(f=s)[u=e]||(f[u]={}),(y=s[e])[p=r]||(y[p]={});const b=(m=s[e][r])[h=o]||(m[h]={chunks:[]});if(v?b.meta=at(et(l)):b.chunks.push(l),a[r].onProgress(c/Tt,e,b.meta),!d)return;const A=new Uint8Array(b.chunks.reduce(((e,t)=>e+t.byteLength),0));if(b.chunks.reduce(((e,t)=>(A.set(t,e),e+t.byteLength)),0),delete s[e][r][o],g)a[r].onComplete(A,e,b.meta);else{const t=et(A);a[r].onComplete(w?at(t):t,e)}})(t,e),stream(e){g.onPeerStream(e,t,c[t]),delete c[t]},track(e,n){g.onPeerTrack(e,n,t,v[t]),delete v[t]},signal:e=>L(e,t),close:()=>b(t),error(e){console.error(e),b(t)}}),g.onPeerJoin(t))})),x(((e,t)=>P("",t))),S(((e,t)=>{var n;null===(n=i[t])||void 0===n||n.call(i),delete i[t]})),U(((e,t)=>{var n;return null===(n=r[t])||void 0===n?void 0:n.signal(e)})),I(((e,t)=>c[t]=e)),O(((e,t)=>v[t]=e)),j(((e,t)=>b(t))),Ye&&addEventListener("beforeunload",k),{makeAction:A,leave:k,async ping(e){if(!e)throw ze("ping() must be called with target peer ID");const t=Date.now();return T("",e),await new Promise((t=>i[e]=t)),Date.now()-t},getPeers:()=>Je(Ge(r).map((([e,t])=>[e,t.connection]))),addStream:(e,t,n)=>w(t,(async(t,r)=>{n&&await D(n,t),r.addStream(e)})),removeStream:(e,t)=>w(t,((t,n)=>n.removeStream(e))),addTrack:(e,t,n,r)=>w(n,(async(n,a)=>{r&&await $(r,n),a.addTrack(e,t)})),removeTrack:(e,t)=>w(t,((t,n)=>n.removeTrack(e))),replaceTrack:(e,t,n,r)=>w(n,(async(n,a)=>{r&&await $(r,n),a.replaceTrack(e,t)})),onPeerJoin:e=>g.onPeerJoin=e,onPeerLeave:e=>g.onPeerLeave=e,onPeerStream:e=>g.onPeerStream=e,onPeerTrack:e=>g.onPeerTrack=e}})((e=>Y=e),(e=>delete L[e]),(()=>{delete r[P][g],Z.forEach(clearTimeout),q.forEach((async e=>(await e)())),clearInterval(s),i(),c=!1}))}})({init:e=>((e,t,n)=>(e.relayUrls||((e,t)=>{const n=[...e],r=()=>{const e=1e4*Me(t++);return e-He(e)};let a=n.length;for(;a;){const e=He(r()*a--);[n[a],n[e]]=[n[e],n[a]]}return n})(t,ot(e.appId))).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||n))(e,Xt,5).map((e=>{const t=((e,t)=>{const n={},r=()=>{const a=new WebSocket(e);a.onclose=()=>{var t;it?it.then(r):(null!==(t=(T=st)[x=e])&&void 0!==t||(T[x]=3333),setTimeout(r,st[e]),st[e]*=2)},a.onmessage=e=>t(e.data),n.socket=a,n.url=a.url,n.ready=new Promise((t=>a.onopen=()=>{t(n),st[e]=3333})),n.send=e=>{1===a.readyState&&a.send(e)}};return r(),n})(e,(e=>{var n;const[r,a,o,s]=at(e);if(r===Ct)null===(n=$t[a])||void 0===n||n.call($t,It[a],o.content);else{const e=`${Be}: relay failure from ${t.url} - `;"NOTICE"===r?console.warn(e+a):"OK"!==r||o||console.warn(e+s)}}));return Et[e]=t,t.ready})),subscribe(e,t,n,r){const a=Xe(64),o=Xe(64);return $t[a]=$t[o]=(t,n)=>r(t,n,(async(t,n)=>e.send(await Ht(t,n)))),e.send(Kt(a,t)),e.send(Kt(o,n)),()=>{e.send(Mt(a)),e.send(Mt(o)),delete $t[a],delete $t[o]}},announce:async(e,t)=>e.send(await Ht(t,rt({peerId:Ze})))});Vt=Et;var Vt;const Xt=["black.nostrcity.club","ftp.halifax.rwth-aachen.de/nostr","nos.lol","nostr.cool110.xyz","nostr.data.haus","nostr.sathoarder.com","nostr.vulpem.com","relay.agorist.space","relay.binaryrobot.com","relay.damus.io","relay.fountain.fm","relay.mostro.network","relay.nostraddress.com","relay.nostrdice.com","relay.nostromo.social","relay.oldenburg.cool","relay.verified-nostr.com","yabu.me/v2"].map((e=>"wss://"+e))}));