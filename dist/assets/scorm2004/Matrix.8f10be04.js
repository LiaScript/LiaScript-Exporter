!function(){function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n=r.parcelRequire55a5;n.register("2bOpM",(function(t,r){e(t.exports,"Sync",(function(){return d}));var i=n("kxanC"),o=n("hWDD9"),a=n("61A8y"),s=n("5gj45"),u=n("cksMj"),l=n("giCK6"),c=n("ithja"),d=function(e){"use strict";(0,u.default)(r,e);var t=(0,l.default)(r);function r(e,n){return(0,i.default)(this,r),t.call(this,e,n,!1)}return(0,o.default)(r,[{key:"destroy",value:function(){this.client,(0,a.default)((0,s.default)(r.prototype),"destroy",this).call(this)}},{key:"connect",value:function(e){(0,a.default)((0,s.default)(r.prototype),"connect",this).call(this,e),this.config=e.config,window.matrixcs?this.init(!0):this.load(["https://cdn.jsdelivr.net/npm/matrix-js-sdk@23.1.1/lib/browser-index.min.js"],this)}},{key:"init",value:function(e,t){var r=this.uniqueID();if(e&&window.matrixcs&&r)try{this.client=window.matrixcs.createClient(this.config);try{this.client.canSupportVoip=!1,this.client.clientOpts={lazyLoadMembers:!0}}catch(e){console.warn("Matrix set protected params failed:",e.message)}this.provider=new(0,c.MatrixProvider)(this.db.doc,this.client,{type:"alias",alias:r}),this.provider.initialize();var n=this;this.db.doc.on("update",(function(e,t){"exit"===t?n.destroy():n.update()})),this.sendConnect()}catch(e){this.sendDisconnectError("Could not connect to Matrix: "+e.message)}else this.sendDisconnectError("Could not load Matrix browser lib. "+t)}},{key:"broadcast",value:function(e){}}]),r}(n("dDIEk").Sync)})),n.register("ithja",(function(r,i){e(r.exports,"MatrixProvider",(function(){return ar}));var o=n("Yawv5"),a=n("2swew"),s=n("kxanC"),u=n("hWDD9"),l=n("dLRop"),c=n("61A8y"),d=n("5gj45"),f=n("cksMj"),h=n("hxnqR"),p=n("iFdjt"),v=n("fIDX1"),g=n("mBz5n"),m=n("9oGi2"),y=n("aojpe"),b=n("giCK6"),_=n("eQNFO"),w=n("39vSB"),S=n("fdj4S"),E=n("7ZwSr"),k=n("fNf4Z"),M=n("9Yl8F"),C=n("5nAU4"),I=n("1irm0").Buffer,T=n("b758v");function R(e,t,r,n,i){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function(e,r,n,i,o){var a,s,u,l;return(0,_.__generator)(this,(function(c){if(a="ed25519:"+i,!(s=((r.signatures||{})[n]||{})[a]))throw Error("No signature");return delete(u=Object.assign({},r)).unsigned,delete u.signatures,l=t(E).stringify(u),e.verifySignature(o,l,s),[2]}))}))).apply(this,arguments)}function O(e){return I.from(e).toString("base64")}function A(e){return I.from(e,"base64")}function D(e,t){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function(e,t){return(0,_.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.crypto.signObject(t)];case 1:return r.sent(),[2]}}))}))).apply(this,arguments)}function L(e,t,r,n){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function(e,t,r,n){var i,o,a,s;return(0,_.__generator)(this,(function(u){switch(u.label){case 0:if(!r.signatures||1!==Object.keys(r.signatures).length)throw new Error("invalid signature");if(i=Object.keys(r.signatures)[0],!t.hasWriteAccess(i,n))throw new Error("user doesn't have write access");if(!(o=Object.keys(r.signatures[i])[0]).startsWith("ed25519:"))throw new Error("unexpected key");return a=o.substr(8),e.crypto.deviceList.startTrackingDeviceList(i),[4,e.crypto.deviceList.downloadKeys([i],!1)];case 1:if(!(s=u.sent()[i][a].keys[o]))throw new Error("key not found");return[4,R(e.crypto.olmDevice,r,i,a,s)];case 2:return u.sent(),[2]}}))}))).apply(this,arguments)}var j=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e,n){var i;return(0,s.default)(this,r),(i=t.call(this)).matrixClient=e,i.reader=n,i.disposed=!1,i.initialized=!1,i.initializing=!1,i.initializeOutdated=!1,i.members=new Map,i.processEvent=function(e){if("m.room.power_levels"===e.type||"m.room.member"===e.type){if(i.initializing)return void(i.initializeOutdated=!0);if(i.initialized){if("m.room.power_levels"===e.type)return void(i.powerLevels=e.content);if("m.room.member"===e.type){if("join"===e.content.membership||"invite"===e.content.membership){var t={displayname:e.content.displayname,user_id:e.state_key};i.members.set(e.state_key,t)}else i.members.delete(e.state_key);return}throw new Error("unexpected")}}},i._register(i.reader.onEvents((function(e){return e.events.forEach((function(e){return i.processEvent(e)}))}))),(0,v.default)(i)}return(0,u.default)(r,[{key:"hasWriteAccess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m.room.message";if(!this.members.has(e))return!1;var r=this.powerLevels,n=r.events[t];void 0===n&&(n=r.events_default);var i=r.users[e];if(void 0===i&&(i=r.users_default),"number"!=typeof i||"number"!=typeof n)throw new Error("unexpected");return i>=n}},{key:"initialize",value:function(){var e=this;return(0,a.default)((function(){var t,r,n;return(0,_.__generator)(this,(function(i){switch(i.label){case 0:if(e.initializing||e.initialized)throw new Error("already initializing / initialized");if(!e.reader.isStarted)throw new Error("MatrixReader must have started before initializing MatrixMemberReader");return e.initializing=!0,[4,Promise.all([e.matrixClient.getStateEvent(e.reader.roomId,"m.room.power_levels",void 0),e.matrixClient.members(e.reader.roomId,void 0,["knock","leave","ban"])])];case 1:return t=g.default.apply(void 0,[i.sent(),2]),r=t[0],n=t[1],e.initializeOutdated?[2,(e.initializing=!1,e.initializeOutdated=!1,e.initialize())]:(e.powerLevels=r,n.chunk.filter((function(e){return"m.room.member"===e.type&&("join"===e.content.membership||"invite"===e.content.membership)})).forEach((function(t){e.members.set(t.state_key,{displayname:t.content.displayname,user_id:t.state_key})})),e.initializing=!1,e.initialized=!0,[2])}}))}))()}},{key:"dispose",value:function(){this.disposed=!0,(0,c.default)((0,d.default)(r.prototype),"dispose",this).call(this)}}]),r}(w.lifecycle.Disposable),N={snapshotInterval:30},B=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e,n,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,s.default)(this,r),(o=t.call(this)).matrixClient=e,o.roomId=n,o.translator=i,o.disposed=!1,o.polling=!1,o.messagesSinceSnapshot=0,o._onEvents=o._register(new w.event.Emitter),o.onEvents=o._onEvents.event,o.matrixRoomListener=function(e,t,r){throw console.error("not expected; Room.timeline on MatrixClient"),new Error("unexpected, we don't use /sync calls for MatrixReader, startClient should not be used on the Matrix client")},o.opts=(0,h.default)({},N,a),o.matrixClient.on(k.RoomEvent.Timeline,o.matrixRoomListener),(0,v.default)(o)}return(0,u.default)(r,[{key:"processIncomingEventsForSnapshot",value:function(e){var t=!1,r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(this.translator.isUpdateEvent(s)){if(s.room_id!==this.roomId)throw new Error("event received with invalid roomid");this.messagesSinceSnapshot++,this.messagesSinceSnapshot%this.opts.snapshotInterval==0&&s.user_id===this.matrixClient.credentials.userId&&(t=!0)}else this.translator.isSnapshotEvent(s)&&(this.messagesSinceSnapshot=0,t=!1)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"decryptRawEventsIfNecessary",value:function(e){var t=this;return(0,a.default)((function(){return(0,_.__generator)(this,(function(r){switch(r.label){case 0:return[4,Promise.all(e.map((n=(0,a.default)((function(e){var r;return(0,_.__generator)(this,(function(n){switch(n.label){case 0:return"m.room.encrypted"!==e.type?[3,2]:[4,t.matrixClient.crypto.decryptEvent(new(0,k.MatrixEvent)(e))];case 1:return r=n.sent().clearEvent,[3,3];case 2:r=e,n.label=3;case 3:return[2,r]}}))})),function(e){return n.apply(this,arguments)})))];case 1:return[2,r.sent()]}var n}))}))()}},{key:"peekPoll",value:function(){var e=this;return(0,a.default)((function(){var t,r,n,i;return(0,_.__generator)(this,(function(o){switch(o.label){case 0:if(!e.latestToken)throw new Error("polling but no pagination token");if(e.disposed)return[3,5];o.label=1;case 1:return o.trys.push([1,4,,5]),e.pendingPollRequest=e.matrixClient.http.authedRequest(void 0,k.Method.Get,"/events",{room_id:e.roomId,timeout:"30000",from:e.latestToken},void 0,{localTimeoutMs:6e4}),[4,e.pendingPollRequest];case 2:return t=o.sent(),e.pendingPollRequest=void 0,e.disposed?[2]:[4,e.decryptRawEventsIfNecessary(t.chunk)];case 3:return r=o.sent(),n=e.processIncomingEventsForSnapshot(r),r.length&&e._onEvents.fire({events:r,shouldSendSnapshot:n}),e.latestToken=t.end,e.peekPoll(),[3,5];case 4:return i=o.sent(),console.error("peek error",i),e.disposed||(e.pollRetryTimeout=setTimeout((function(){return e.peekPoll()}),3e4)),[3,5];case 5:return[2]}}))}))()}},{key:"getInitialDocumentUpdateEvents",value:function(e){var t=this;return(0,a.default)((function(){var r,n,i,o,a,s,u,l,c,d,f,h;return(0,_.__generator)(this,(function(p){switch(p.label){case 0:r=[],n="",i=!0,p.label=1;case 1:return i?[4,t.matrixClient.createMessagesRequest(t.roomId,n,30,k.Direction.Backward)]:[3,5];case 2:return a=p.sent(),[4,t.decryptRawEventsIfNecessary(a.chunk)];case 3:s=p.sent(),u=!0,l=!1,c=void 0;try{for(d=s[Symbol.iterator]();!(u=(f=d.next()).done);u=!0)if(h=f.value,e)h.type===e&&r.push(h);else if(t.translator.isSnapshotEvent(h))r.push(h),o=h.content.last_event_id;else if(t.translator.isUpdateEvent(h)){if(o&&o===h.event_id)return[2,(t.latestToken||(t.latestToken=a.start),r.reverse())];t.messagesSinceSnapshot++,r.push(h)}}catch(e){l=!0,c=e}finally{try{u||null==d.return||d.return()}finally{if(l)throw c}}n=a.end,t.latestToken||(t.latestToken=a.start),i=!(a.start===a.end||!a.end),p.label=4;case 4:return[3,1];case 5:return[2,r.reverse()]}}))}))()}},{key:"startPolling",value:function(){if(this.polling)throw new Error("already polling");this.polling=!0,this.peekPoll()}},{key:"isStarted",get:function(){return this.polling}},{key:"dispose",value:function(){this.disposed=!0,(0,c.default)((0,d.default)(r.prototype),"dispose",this).call(this),this.pollRetryTimeout&&clearTimeout(this.pollRetryTimeout),this.pendingPollRequest&&this.pendingPollRequest.abort(),this.matrixClient.off(k.RoomEvent.Timeline,this.matrixRoomListener)}}]),r}(w.lifecycle.Disposable),F=String.fromCharCode,K=/^\s*/g,q=/([A-Z])/g,W=function(e,t){return function(e){return e.replace(K,"")}(e.replace(q,(function(e){return"".concat(t).concat(function(e){return e.toLowerCase()}(e))})))},V=("undefined"==typeof TextEncoder?"undefined":(0,y.default)(TextEncoder))<"u"?new TextEncoder:null,H=V?function(e){return V.encode(e)}:function(e){for(var t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.codePointAt(i);return n},G=("undefined"==typeof TextDecoder?"undefined":(0,y.default)(TextDecoder))>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});G&&1===G.decode(new Uint8Array).length&&(G=null);var z=function(){return new Map},Y=function(e,t,r){var n=e.get(t);return void 0===n&&e.set(t,n=r()),n},Z=new(function(){"use strict";function e(){(0,s.default)(this,e),this.map=new Map}return(0,u.default)(e,[{key:"setItem",value:function(e,t){this.map.set(e,t)}},{key:"getItem",value:function(e){return this.map.get(e)}}]),e}()),$=!0;try{("undefined"==typeof localStorage?"undefined":(0,y.default)(localStorage))<"u"&&(Z=localStorage,$=!1)}catch(e){}var J,Q=Z,X=(void 0===T?"undefined":(0,y.default)(T))<"u"&&T.release&&/node|io\.js/.test(T.release.name),ee=("undefined"==typeof window?"undefined":(0,y.default)(window))<"u"&&!X;("undefined"==typeof navigator?"undefined":(0,y.default)(navigator))<"u"&&/Mac/.test(navigator.platform);var te,re=function(e){return function(){if(void 0===J)if(X){J=z();for(var e=T.argv,t=null,r=0;r<e.length;r++){var n=e[r];"-"===n[0]?(null!==t&&J.set(t,""),t=n):null!==t&&(J.set(t,n),t=null)}null!==t&&J.set(t,"")}else"object"==typeof location?(J=z(),(location.search||"?").slice(1).split("&").forEach((function(e){if(0!==e.length){var t=(0,g.default)(e.split("="),2),r=t[0],n=t[1];J.set("--".concat(W(r,"-")),n),J.set("-".concat(W(r,"-")),n)}}))):J=z();return J}().has(e)},ne=function(e){return function(e){return void 0===e?null:e}(X?T.env[e.toUpperCase()]:Q.getItem(e))};re("--"+(te="production"))||ne(te);var ie=Math.floor,oe=Math.abs,ae=Math.log10,se=function(e,t){return e<t?e:t},ue=function(e,t){return e>t?e:t},le=128,ce=127,de=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&ie(e)===e},fe=function e(){"use strict";(0,s.default)(this,e),this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]},he=function(){return new fe},pe=function(e){for(var t=new Uint8Array(function(e){for(var t=e.cpos,r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t}(e)),r=0,n=0;n<e.bufs.length;n++){var i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(Ee(e.cbuf.buffer,0,e.cpos),r),t},ve=function(e,t){var r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*r),e.cpos=0),e.cbuf[e.cpos++]=t},ge=ve,me=function(e,t){for(;t>ce;)ve(e,le|ce&t),t>>>=7;ve(e,ce&t)},ye=function(e,t){var r=unescape(encodeURIComponent(t)),n=r.length;me(e,n);for(var i=0;i<n;i++)ve(e,r.codePointAt(i))},be=function(e,t){me(e,t.byteLength),function(e,t){var r=e.cbuf.length,n=e.cpos,i=se(r-n,t.length),o=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ue(2*r,o)),e.cbuf.set(t.subarray(i)),e.cpos=o)}(e,t)},_e=function(e,t){!function(e,t){var r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(Ee(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*ue(r,t)),e.cpos=0)}(e,t);var r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},we=new DataView(new ArrayBuffer(4)),Se=function(e,t){switch(void 0===t?"undefined":(0,y.default)(t)){case"string":ve(e,119),ye(e,t);break;case"number":de(t)&&oe(t)<=2147483647?(ve(e,125),function(e,t){var r=function(e){return 0!==e?e<0:1/e<0}(t);for(r&&(t=-t),ve(e,(t>63?le:0)|(r?64:0)|63&t),t>>>=6;t>0;)ve(e,(t>ce?le:0)|ce&t),t>>>=7}(e,t)):function(e){return we.setFloat32(0,e),we.getFloat32(0)===e}(t)?(ve(e,124),function(e,t){_e(e,4).setFloat32(0,t,!1)}(e,t)):(ve(e,123),function(e,t){_e(e,8).setFloat64(0,t,!1)}(e,t));break;case"bigint":ve(e,122),function(e,t){_e(e,8).setBigInt64(0,t,!1)}(e,t);break;case"object":if(null===t)ve(e,126);else if(t instanceof Array){ve(e,117),me(e,t.length);for(var r=0;r<t.length;r++)Se(e,t[r])}else if(t instanceof Uint8Array)ve(e,116),be(e,t);else{ve(e,118);var n=Object.keys(t);me(e,n.length);for(var i=0;i<n.length;i++){var o=n[i];ye(e,o),Se(e,t[o])}}break;case"boolean":ve(e,t?120:121);break;default:ve(e,127)}},Ee=function(e,t,r){return new Uint8Array(e,t,r)},ke=ee?function(e){for(var t="",r=0;r<e.byteLength;r++)t+=F(e[r]);return btoa(t)}:function(e){return I.from(e.buffer,e.byteOffset,e.byteLength).toString("base64")},Me=ee?function(e){for(var t=atob(e),r=function(e){return new Uint8Array(e)}(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}:function(e){var t=I.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Ce=function e(t){"use strict";(0,s.default)(this,e),this.arr=t,this.pos=0},Ie=function(e){return new Ce(e)},Te=function(e){return function(e,t){var r=Ee(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r}(e,xe(e))},Re=function(e){return e.arr[e.pos++]},xe=function(e){for(var t=0,r=0;;){var n=e.arr[e.pos++];if(t|=(n&ce)<<r,n<le)return t>>>0;if((r+=7)>53)throw new Error("Integer out of range!")}},Oe=function(e){var t=xe(e);if(0===t)return"";var r=String.fromCodePoint(Re(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(Re(e));else for(;t>0;){var n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))},Ae=function(e,t){var r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},De=[function(e){},function(e){return null},function(e){var t=e.arr[e.pos++],r=63&t,n=6,i=(64&t)>0?-1:1;if(0==(t&le))return i*r;for(;;){if(r|=((t=e.arr[e.pos++])&ce)<<n,t<le)return i*(r>>>0);if((n+=7)>53)throw new Error("Integer out of range!")}},function(e){return Ae(e,4).getFloat32(0,!1)},function(e){return Ae(e,8).getFloat64(0,!1)},function(e){return Ae(e,8).getBigInt64(0,!1)},function(e){return!1},function(e){return!0},Oe,function(e){for(var t=xe(e),r={},n=0;n<t;n++){r[Oe(e)]=Pe(e)}return r},function(e){for(var t=xe(e),r=[],n=0;n<t;n++)r.push(Pe(e));return r},Te],Pe=function(e){return De[127-Re(e)](e)},Le=Date.now,Ue=function(){return new Set},je=Array.from,Ne=function(){"use strict";function e(){(0,s.default)(this,e),this._observers=z()}return(0,u.default)(e,[{key:"on",value:function(e,t){Y(this._observers,e,Ue).add(t)}},{key:"once",value:function(e,t){var r=this,n=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];r.off(e,n),t.apply(void 0,(0,m.default)(o))};this.on(e,n)}},{key:"off",value:function(e,t){var r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}},{key:"emit",value:function(e,t){return je((this._observers.get(e)||z()).values()).forEach((function(e){return e.apply(void 0,(0,m.default)(t))}))}},{key:"destroy",value:function(){this._observers=z()}}]),e}(),Be=Object.keys,Fe=function(e){return Be(e).length},Ke=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},qe=function(){},We=function(e,t){if(null==e||null==t)return function(e,t){return e===t}(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;break;case Set:if(e.size!==t.size)return!1;var n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(!t.has(u))return!1}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}break;case Map:if(e.size!==t.size)return!1;var l=!0,c=!1,d=void 0;try{for(var f,h=e.keys()[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var p=f.value;if(!t.has(p)||!We(e.get(p),t.get(p)))return!1}}catch(e){c=!0,d=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw d}}break;case Object:if(Fe(e)!==Fe(t))return!1;for(var v in e)if(!Ke(e,v)||!We(e[v],t[v]))return!1;break;case Array:if(e.length!==t.length)return!1;for(var g=0;g<e.length;g++)if(!We(e[g],t[g]))return!1;break;default:return!1}return!0},Ve=3e4,He=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e){var n;return(0,s.default)(this,r),(n=t.call(this)).doc=e,n.clientID=e.clientID,n.states=new Map,n.meta=new Map,n._checkInterval=setInterval((function(){var e=Le();null!==n.getLocalState()&&15e3<=e-n.meta.get(n.clientID).lastUpdated&&n.setLocalState(n.getLocalState());var t=[];n.meta.forEach((function(r,i){i!==n.clientID&&Ve<=e-r.lastUpdated&&n.states.has(i)&&t.push(i)})),t.length>0&&Ge((0,o.default)(n),t,"timeout")}),ie(3e3)),e.on("destroy",(function(){n.destroy()})),n.setLocalState({}),(0,v.default)(n)}return(0,u.default)(r,[{key:"destroy",value:function(){this.emit("destroy",[this]),this.setLocalState(null),(0,c.default)((0,d.default)(r.prototype),"destroy",this).call(this),clearInterval(this._checkInterval)}},{key:"getLocalState",value:function(){return this.states.get(this.clientID)||null}},{key:"setLocalState",value:function(e){var t=this.clientID,r=this.meta.get(t),n=void 0===r?0:r.clock+1,i=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:Le()});var o=[],a=[],s=[],u=[];null===e?u.push(t):null==i?null!=e&&o.push(t):(a.push(t),We(i,e)||s.push(t)),(o.length>0||s.length>0||u.length>0)&&this.emit("change",[{added:o,updated:s,removed:u},"local"]),this.emit("update",[{added:o,updated:a,removed:u},"local"])}},{key:"setLocalStateField",value:function(e,t){var r=this.getLocalState();null!==r&&this.setLocalState((0,p.default)((0,h.default)({},r),(0,l.default)({},e,t)))}},{key:"getStates",value:function(){return this.states}}]),r}(Ne),Ge=function(e,t,r){for(var n=[],i=0;i<t.length;i++){var o=t[i];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){var a=e.meta.get(o);e.meta.set(o,{clock:a.clock+1,lastUpdated:Le()})}n.push(o)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},r]),e.emit("update",[{added:[],updated:[],removed:n},r]))},ze=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.states,n=t.length,i=he();me(i,n);for(var o=0;o<n;o++){var a=t[o],s=r.get(a)||null,u=e.meta.get(a).clock;me(i,a),me(i,u),ye(i,JSON.stringify(s))}return pe(i)},Ye=function(e,t,r){for(var n=Ie(t),i=Le(),o=[],a=[],s=[],u=[],l=xe(n),c=0;c<l;c++){var d=xe(n),f=xe(n),h=JSON.parse(Oe(n)),p=e.meta.get(d),v=e.states.get(d),g=void 0===p?0:p.clock;(g<f||g===f&&null===h&&e.states.has(d))&&(null===h?d===e.clientID&&null!=e.getLocalState()?f++:e.states.delete(d):e.states.set(d,h),e.meta.set(d,{clock:f,lastUpdated:i}),void 0===p&&null!==h?o.push(d):void 0!==p&&null===h?u.push(d):null!==h&&(We(h,v)||s.push(d),a.push(d)))}(o.length>0||s.length>0||u.length>0)&&e.emit("change",[{added:o,updated:s,removed:u},r]),(o.length>0||a.length>0||u.length>0)&&e.emit("update",[{added:o,updated:a,removed:u},r])},Ze=function(e,t,r){return function(e,t,r){me(e,1),be(e,S.encodeStateAsUpdate(t,r))}(t,r,Te(e))},$e=function(e,t,r){try{S.applyUpdate(t,Te(e),r)}catch(e){console.error("Caught error while handling a Yjs update",e)}},Je=function(e,t){me(e,2),be(e,t)},Qe=$e,Xe=function(e,t,r,n){var i=xe(e);switch(i){case 0:Ze(e,t,r);break;case 1:$e(e,r,n);break;case 2:Qe(e,r,n);break;default:throw new Error("Unknown message type")}return i},et=Symbol,tt=function e(t,r){"use strict";(0,s.default)(this,e),this.left=t,this.right=r},rt=function(e,t){return new tt(e,t)},nt=("undefined"==typeof document?"undefined":(0,y.default)(document))<"u"?document:{};("undefined"==typeof DOMParser?"undefined":(0,y.default)(DOMParser))<"u"&&new DOMParser;var it,ot,at=function(e){return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=(0,g.default)(a.value,2),l=u[0],c=u[1];r.push(t(c,l))}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,(function(e,t){return"".concat(t,":").concat(e,";")})).join("")};nt.ELEMENT_NODE,nt.TEXT_NODE,nt.CDATA_SECTION_NODE,nt.COMMENT_NODE,nt.DOCUMENT_NODE,nt.DOCUMENT_TYPE_NODE,nt.DOCUMENT_FRAGMENT_NODE;var st,ut=et(),lt=et(),ct=et(),dt=et(),ft=et(),ht=et(),pt=et(),vt=et(),gt=et(),mt=(it={},(0,l.default)(it,ut,rt("font-weight","bold")),(0,l.default)(it,lt,rt("font-weight","normal")),(0,l.default)(it,ct,rt("color","blue")),(0,l.default)(it,ft,rt("color","green")),(0,l.default)(it,dt,rt("color","grey")),(0,l.default)(it,ht,rt("color","red")),(0,l.default)(it,pt,rt("color","purple")),(0,l.default)(it,vt,rt("color","orange")),(0,l.default)(it,gt,rt("color","black")),it),yt=(ot={},(0,l.default)(ot,ut,"[1m"),(0,l.default)(ot,lt,"[2m"),(0,l.default)(ot,ct,"[34m"),(0,l.default)(ot,ft,"[32m"),(0,l.default)(ot,dt,"[37m"),(0,l.default)(ot,ht,"[31m"),(0,l.default)(ot,pt,"[35m"),(0,l.default)(ot,vt,"[38;5;208m"),(0,l.default)(ot,gt,"[0m"),ot),bt=X?function(e){for(var t=[],r=[],n=0;n<e.length;n++){var i=e[n],o=yt[i];if(void 0!==o)t.push(o);else{if(i.constructor!==String&&i.constructor!==Number)break;t.push(i)}}for(n>0&&(t.push("[0m"),r.push(t.join("")));n<e.length;n++){var a=e[n];a instanceof Symbol||r.push(a)}return r}:function(e){for(var t=[],r=[],n=z(),i=[],o=0;o<e.length;o++){var a=e[o],s=mt[a];if(void 0!==s)n.set(s.left,s.right);else{if(a.constructor!==String&&a.constructor!==Number)break;var u=at(n);o>0||u.length>0?(t.push("%c"+a),r.push(u)):t.push(a)}}for(o>0&&(i=r).unshift(t.join(""));o<e.length;o++){var l=e[o];l instanceof Symbol||i.push(l)}return i},_t=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;(n=console).log.apply(n,(0,m.default)(bt(t))),wt.forEach((function(e){return e.print(t)}))},wt=new Set,St=[ft,pt,vt,ct],Et=0,kt=Le(),Mt=function(e){var t=St[Et],r=ne("log"),n=null!==r&&("*"===r||"true"===r||new RegExp(r,"gi").test(e));return Et=(Et+1)%St.length,e+=": ",n?function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];var o=Le(),a=o-kt;kt=o,_t.apply(void 0,[t,e,gt].concat((0,m.default)(n.map((function(e){return"string"==typeof e||"symbol"==(void 0===e?"undefined":(0,y.default)(e))?e:JSON.stringify(e)}))),[t," +"+a+"ms"]))}:qe},Ct=function(e){return new Error(e)},It=("undefined"==typeof crypto?"undefined":(0,y.default)(crypto))>"u"?null:crypto,Tt=null!==It?function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t);return It.getRandomValues(r),t}:function(e){for(var t=new ArrayBuffer(e),r=new Uint8Array(t),n=0;n<e;n++)r[n]=Math.ceil(4294967295*Math.random()>>>0);return t},Rt=Math.random,xt=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(e){return(e^new Uint32Array(Tt(4))[0]&15>>e/4).toString(16)}))},Ot=function(e,t){var r=H(e).buffer,n=H(t).buffer;return crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"]).then((function(e){return crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}))},At=(st=(0,a.default)((function(e,t){var r;return(0,_.__generator)(this,(function(n){return t?(r=crypto.getRandomValues(new Uint8Array(12)),[2,crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,e).then((function(e){var t=he();return ye(t,"AES-GCM"),be(t,r),be(t,new Uint8Array(e)),pe(t)}))]):[2,e]}))})),function(e,t){return st.apply(this,arguments)}),Dt=function(){var e=(0,a.default)((function(e,t){var r,n,i;return(0,_.__generator)(this,(function(o){return t?(r=Ie(e),"AES-GCM"!==Oe(r)&&function(e){Promise.reject(e)}(Ct("Unknown encryption algorithm")),n=Te(r),i=Te(r),[2,crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,i).then((function(e){return new Uint8Array(e)}))]):[2,e]}))}));return function(t,r){return e.apply(this,arguments)}}(),Pt=new Map,Lt=new Map;function Ut(e){Pt.forEach((function(t){t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&t.publishSignalingMessage(e,{type:"announce",from:e.peerId}))}))}var jt=new Map,Nt=function(){"use strict";function e(t){var r=this;(0,s.default)(this,e),this.room=t,this.onmessage=null,function(e){$||addEventListener("storage",e)}((function(e){return e.key===t&&null!==r.onmessage&&r.onmessage({data:Me(e.newValue||"")})}))}return(0,u.default)(e,[{key:"postMessage",value:function(e){Q.setItem(this.room,ke(function(e){return new Uint8Array(e)}(e)))}}]),e}(),Bt=("undefined"==typeof BroadcastChannel?"undefined":(0,y.default)(BroadcastChannel))>"u"?Nt:BroadcastChannel,Ft=function(e){return Y(jt,e,(function(){var t=new Set,r=new Bt(e);return r.onmessage=function(e){return t.forEach((function(t){return t(e.data,"broadcastchannel")}))},{bc:r,subs:t}}))},Kt=Mt("y-webrtc"),qt=function(){"use strict";function e(t,r,n,i,o){var a=this;(0,s.default)(this,e),this.provider=t,this.onCustomMessage=r,this.onPeerConnected=n,this.name=i,this.key=o,this.peerId=xt(),this.synced=!1,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=function(){var e=!0;return function(t,r){if(e){e=!1;try{t()}finally{e=!0}}else void 0!==r&&r()}}(),this.bcconnected=!1,this._bcSubscriber=function(e){return Dt(new Uint8Array(e),a.key).then((function(e){return a.mux((function(){a.readMessage(e,(function(e){a.broadcastBcMessage(pe(e))}))}))}))},this.readMessage=function(e,t){var r=Ie(e),n=he(),i=function(e){me(n,5),be(n,e),t(n)};switch(xe(r)){case 5:a.onCustomMessage(Te(r),i);break;case 4:var o=1===Re(r),s=Oe(r);if(s!==a.peerId&&(a.bcConns.has(s)&&!o||!a.bcConns.has(s)&&o)){var u=[],l=[];o?(a.bcConns.add(s),l.push(s),a.onPeerConnected(i)):(a.bcConns.delete(s),u.push(s)),a.provider.emit("peers",[{added:l,removed:u,webrtcPeers:Array.from(a.webrtcConns.keys()),bcPeers:Array.from(a.bcConns)}]),a.broadcastBcPeerId()}break;default:return void console.error("Unable to compute message")}}}return(0,u.default)(e,[{key:"broadcastBcPeerId",value:function(){if(this.provider.filterBcConns){var e=he();me(e,4),ge(e,1),ye(e,this.peerId),this.broadcastBcMessage(pe(e))}}},{key:"broadcastWebrtcConn",value:function(e){Kt("broadcast message in ",ut,this.name,lt),this.webrtcConns.forEach((function(t){try{t.peer.send(e)}catch(e){}}))}},{key:"broadcastRoomMessage",value:function(e){var t=he();me(t,5),be(t,e);var r=pe(t);this.bcconnected&&this.broadcastBcMessage(r),this.broadcastWebrtcConn(r)}},{key:"broadcastBcMessage",value:function(e){var t=this;return At(e,this.key).then((function(e){return t.mux((function(){return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Ft(e);n.bc.postMessage(t),n.subs.forEach((function(e){return e(t,r)}))}(t.name,e)}))}))}},{key:"connect",value:function(){Ut(this),function(e,t){Ft(e).subs.add(t)}(this.name,this._bcSubscriber),this.bcconnected=!0,this.broadcastBcPeerId()}},{key:"disconnect",value:function(){var e=this;Pt.forEach((function(t){t.connected&&t.send({type:"unsubscribe",topics:[e.name]})}));var t=he();me(t,4),ge(t,0),ye(t,this.peerId),this.broadcastBcMessage(pe(t)),function(e,t){Ft(e).subs.delete(t)}(this.name,this._bcSubscriber),this.bcconnected=!1,this.webrtcConns.forEach((function(e){return e.destroy()}))}},{key:"destroy",value:function(){this.disconnect()}}]),e}(),Wt=3e4,Vt=function(e){if(e.shouldConnect&&null===e.ws){var t=new WebSocket(e.url),r=e.binaryType,n=null;r&&(t.binaryType=r),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=function(t){e.lastMessageReceived=Le();var r=t.data,i="string"==typeof r?JSON.parse(r):r;i&&"pong"===i.type&&(clearTimeout(n),n=setTimeout(o,15e3)),e.emit("message",[i,e])};var i=function(t){null!==e.ws&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:t},e])):e.unsuccessfulReconnects++,setTimeout(Vt,se(1200*ae(e.unsuccessfulReconnects+1),2500),e)),clearTimeout(n)},o=function(){e.ws===t&&e.send({type:"ping"})};t.onclose=function(){return i(null)},t.onerror=function(e){return i(e)},t.onopen=function(){e.lastMessageReceived=Le(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),n=setTimeout(o,15e3)}}},Ht=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.binaryType;return(0,s.default)(this,r),(n=t.call(this)).url=e,n.ws=null,n.binaryType=a||null,n.connected=!1,n.connecting=!1,n.unsuccessfulReconnects=0,n.lastMessageReceived=0,n.shouldConnect=!0,n._checkInterval=setInterval((function(){n.connected&&Wt<Le()-n.lastMessageReceived&&n.ws.close()}),15e3),Vt((0,o.default)(n)),(0,v.default)(n)}return(0,u.default)(r,[{key:"send",value:function(e){this.ws&&this.ws.send(JSON.stringify(e))}},{key:"destroy",value:function(){clearInterval(this._checkInterval),this.disconnect(),(0,c.default)((0,d.default)(r.prototype),"destroy",this).call(this)}},{key:"disconnect",value:function(){this.shouldConnect=!1,null!==this.ws&&this.ws.close()}},{key:"connect",value:function(){this.shouldConnect=!0,!this.connected&&null===this.ws&&Vt(this)}}]),r}(Ne),Gt=Mt("y-webrtc"),zt=function(){"use strict";function e(r,n,i,o){var a=this;(0,s.default)(this,e),this.remotePeerId=i,this.room=o,this.closed=!1,this.connected=!1,this.synced=!1,Gt("establishing connection to ",ut,i),this.peer=new(t(M))((0,h.default)({initiator:n},o.provider.peerOpts)),this.peer.on("signal",(function(e){r.publishSignalingMessage(o,{to:i,from:o.peerId,type:"signal",signal:e})})),this.peer.on("connect",(function(){Gt("connected to ",ut,i),a.connected=!0,o.onPeerConnected((function(e){var t=he();me(t,5),be(t,e),a.sendWebrtcConn(t)}))})),this.peer.on("close",(function(){a.connected=!1,a.closed=!0,o.webrtcConns.has(a.remotePeerId)&&(o.webrtcConns.delete(a.remotePeerId),o.provider.emit("peers",[{removed:[a.remotePeerId],added:[],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}])),a.peer.destroy(),Gt("closed connection to ",ut,i),Ut(o)})),this.peer.on("error",(function(e){Gt("Error in connection to ",ut,i,": ",e),Ut(o)})),this.peer.on("data",(function(e){Gt("received message from ",ut,a.remotePeerId,dt," (",o.name,")",lt,gt),a.room.readMessage(e,(function(e){a.sendWebrtcConn(e)}))}))}return(0,u.default)(e,[{key:"sendWebrtcConn",value:function(e){Gt("send message to ",ut,this.remotePeerId,lt,dt," (",this.room.name,")",gt);try{this.peer.send(pe(e))}catch(e){}}},{key:"destroy",value:function(){this.peer.destroy()}}]),e}(),Yt=Mt("y-webrtc"),Zt=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e){var n;return(0,s.default)(this,r),(n=t.call(this,e)).providers=new Set,n.publishSignalingMessage=function(e,t){e.key?function(e,t){var r=he();return Se(r,e),At(pe(r),t)}(t,e.key).then((function(t){n.send({type:"publish",topic:e.name,data:ke(t)})})):n.send({type:"publish",topic:e.name,data:t})},n.on("connect",(function(){Yt("connected (".concat(e,")"));var t=Array.from(Lt.keys());n.send({type:"subscribe",topics:t}),Lt.forEach((function(e){return n.publishSignalingMessage(e,{type:"announce",from:e.peerId})}))})),n.on("message",(function(e){if("publish"===e.type){var t=e.topic,r=Lt.get(t);if(null==r||"string"!=typeof t)return;var i=function(e){var t=r.webrtcConns,i=r.peerId;if(!(null==e||e.from===i||void 0!==e.to&&e.to!==i||r.bcConns.has(e.from))){var a=t.has(e.from)?function(){}:function(){return r.provider.emit("peers",[{removed:[],added:[e.from],webrtcPeers:Array.from(r.webrtcConns.keys()),bcPeers:Array.from(r.bcConns)}])};switch(e.type){case"announce":t.size<r.provider.maxConns&&(Y(t,e.from,(function(){return new zt((0,o.default)(n),!0,e.from,r)})),a());break;case"signal":e.to===i&&(Y(t,e.from,(function(){return new zt(n,!1,e.from,r)})).peer.signal(e.signal),a())}}};r.key?"string"==typeof e.data&&function(e,t){return Dt(e,t).then((function(e){return Pe(Ie(new Uint8Array(e)))}))}(Me(e.data),r.key).then(i):i(e.data)}})),n.on("disconnect",(function(){return Yt("disconnect (".concat(e,")"))})),(0,v.default)(n)}return r}(Ht);Mt("y-webrtc");var $t=function(e,t,r,n,i){if(Lt.has(n))throw Ct('A Yjs Doc connected to room "'.concat(n,'" already exists!'));var o=new qt(e,t,r,n,i);return Lt.set(n,o),o},Jt=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.signaling,u=void 0===a?["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"]:a,l=i.password,c=i.maxConns,d=void 0===c?20+ie(15*Rt()):c,f=i.filterBcConns,h=void 0===f||f;i.peerOpts;return(0,s.default)(this,r),(n=t.call(this)).roomName=e,n.shouldConnect=!1,n.filterBcConns=!0,n.filterBcConns=h,n.shouldConnect=!1,n.signalingUrls=u,n.signalingConns=[],n.maxConns=d,n.peerOpts={iceServers:[]},n.key=l?Ot(l,e):Promise.resolve(void 0),n.key.then((function(t){n.room=$t((0,o.default)(n),n.onCustomMessage,n.onPeerConnected,e,t),n.shouldConnect?n.room.connect():n.room.disconnect()})),n.connect(),(0,v.default)(n)}return(0,u.default)(r,[{key:"connected",get:function(){return null!==this.room&&this.shouldConnect}},{key:"connect",value:function(){var e=this;this.shouldConnect=!0,this.signalingUrls.forEach((function(t){var r=Y(Pt,t,(function(){return new Zt(t)}));e.signalingConns.push(r),r.providers.add(e)})),this.room&&this.room.connect()}},{key:"disconnect",value:function(){var e=this;this.shouldConnect=!1,this.signalingConns.forEach((function(t){t.providers.delete(e),0===t.providers.size&&(t.destroy(),Pt.delete(t.url))})),this.room&&this.room.disconnect()}},{key:"destroy",value:function(){var e=this;this.key.then((function(){var t;null==(t=e.room)||t.destroy(),Lt.delete(e.roomName)})),(0,c.default)((0,d.default)(r.prototype),"destroy",this).call(this)}}]),r}(Ne),Qt=Mt("y-webrtc"),Xt=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e,n,i,u,l,c){var d,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new He(e);(0,s.default)(this,r);var p=(0,o.default)(d);return(d=t.call(this,n,(0,h.default)({password:i},c))).doc=e,d.roomPassword=i,d.sign=u,d.verify=l,d.awareness=f,d.onCustomMessage=function(e,t){var r=Ie(e),n=he();switch(xe(r)){case 0:var i=Pe(r);d.verify(i).then((function(){var e=A(i.message),t=Ie(e);if(2!==Xe(t,n,d.doc,(0,o.default)(d)))throw Qt("error: expect only updates"),new Error("error: only update messages expected")}),(function(e){console.error("couldn't verify message")}));break;case 1:Ye(d.awareness,Te(r),(0,o.default)(d))}},d.onPeerConnected=function(e){var t=he(),r=d.awareness.getStates();r.size>0&&(me(t,1),be(t,ze(d.awareness,Array.from(r.keys()))),e(pe(t)))},d._docUpdateHandler=function(){var e=(0,a.default)((function(e,t){var r,n,i;return(0,_.__generator)(this,(function(t){switch(t.label){case 0:return p.room?(r=he(),me(r,0),n=he(),Je(n,e),i={message:O(pe(n))},[4,p.sign(i)]):[2];case 1:return t.sent(),Se(r,i),p.room.broadcastRoomMessage(pe(r)),[2]}}))}));return function(t,r){return e.apply(this,arguments)}}(),d._awarenessUpdateHandler=function(e,t){var r=e.added,n=e.updated,i=e.removed;if(d.room){var o=r.concat(n).concat(i);Qt("awareness change ",{added:r,updated:n,removed:i},"local",d.awareness.clientID);var a=he();me(a,1),be(a,ze(d.awareness,o)),d.room.broadcastRoomMessage(pe(a))}},e.on("destroy",d.destroy.bind((0,o.default)(d))),d.doc.on("update",d._docUpdateHandler),d.awareness.on("update",d._awarenessUpdateHandler),window.addEventListener("beforeunload",(function(){Ge(d.awareness,[e.clientID],"window unload"),Lt.forEach((function(e){e.disconnect()}))})),(0,v.default)(d)}return(0,u.default)(r,[{key:"destroy",value:function(){this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("destroy",this.destroy),(0,c.default)((0,d.default)(r.prototype),"destroy",this).call(this)}}]),r}(Jt),er={flushInterval:500,retryIfForbiddenInterval:3e4},tr=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e,n){var i,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,s.default)(this,r);var l=(0,o.default)(i);return(i=t.call(this)).matrixClient=e,i.translator=n,i.pendingUpdates=[],i.isSendingUpdates=!1,i._canWrite=!0,i._onCanWriteChanged=i._register(new w.event.Emitter),i.onCanWriteChanged=i._onCanWriteChanged.event,i._onSentAllEvents=i._register(new w.event.Emitter),i.onSentAllEvents=i._onSentAllEvents.event,i.flushUpdatesToMatrix=(0,a.default)((function(){var e,t,r,n;return(0,_.__generator)(this,(function(i){switch(i.label){case 0:if(l.isSendingUpdates||!l.pendingUpdates.length||!l.roomId)return[2];l.isSendingUpdates=!0,e=S.mergeUpdates(l.pendingUpdates),l.pendingUpdates=[],t=!1,i.label=1;case 1:return i.trys.push([1,3,10,11]),console.log("Sending updates"),[4,l.translator.sendUpdate(l.matrixClient,l.roomId,e)];case 2:return i.sent(),l.setCanWrite(!0),console.log("sent updates"),[3,11];case 3:if("M_FORBIDDEN"!==(r=i.sent()).errcode)return[3,8];console.warn("not allowed to edit document",r),l.setCanWrite(!1),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,l.matrixClient.joinRoom(l.roomId)];case 5:return i.sent(),console.log("joined room",l.roomId),t=!0,[3,7];case 6:return n=i.sent(),console.warn("failed to join room",n),[3,7];case 7:return[3,9];case 8:console.error("error sending updates",r),i.label=9;case 9:return l.pendingUpdates.unshift(e),[3,11];case 10:return l.isSendingUpdates=!1,[7];case 11:return l.pendingUpdates.length?l.retryTimeoutHandler=setTimeout((function(){l.throttledFlushUpdatesToMatrix()}),t?0:l.canWrite?l.opts.flushInterval:l.opts.retryIfForbiddenInterval):(console.log("_onSentAllEvents"),l._onSentAllEvents.fire()),[2]}}))})),i.opts=(0,h.default)({},er,u),i.throttledFlushUpdatesToMatrix=C.throttle(i.flushUpdatesToMatrix,i.canWrite?i.opts.flushInterval:i.opts.retryIfForbiddenInterval),(0,v.default)(i)}return(0,u.default)(r,[{key:"setCanWrite",value:function(e){this._canWrite!==e&&(this._canWrite=e,this._onCanWriteChanged.fire())}},{key:"initialize",value:function(e){var t=this;return(0,a.default)((function(){return(0,_.__generator)(this,(function(r){return t.roomId=e,t.throttledFlushUpdatesToMatrix(),[2]}))}))()}},{key:"canWrite",get:function(){return this._canWrite}},{key:"writeUpdate",value:function(e){this.pendingUpdates.push(e),this.throttledFlushUpdatesToMatrix()}},{key:"waitForFlush",value:function(){var e=this;return(0,a.default)((function(){return(0,_.__generator)(this,(function(t){switch(t.label){case 0:return!e.pendingUpdates.length&&!e.isSendingUpdates?[3,2]:[4,w.event.Event.toPromise(e.onSentAllEvents)];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))()}},{key:"dispose",value:function(){(0,c.default)((0,d.default)(r.prototype),"dispose",this).call(this),clearTimeout(this.retryTimeoutHandler),this.throttledFlushUpdatesToMatrix.cancel()}}]),r}(w.lifecycle.Disposable);var rr="m.room.message",nr={updatesAsRegularMessages:!1,updateEventType:"matrix-crdt.doc_update",snapshotEventType:"matrix-crdt.doc_snapshot"},ir=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.default)(this,e),this.opts=(0,h.default)({},nr,t)}return(0,u.default)(e,[{key:"sendUpdate",value:function(e,t,r){var n=this;return(0,a.default)((function(){var i,o,a;return(0,_.__generator)(this,(function(s){switch(s.label){case 0:return i=O(r),o={update:i},n.opts.updatesAsRegularMessages?(a=(0,h.default)({body:n.opts.updateEventType+": "+i,msgtype:n.opts.updateEventType},o),e.scheduler=void 0,[4,e.sendEvent(t,rr,a,"")]):[3,2];case 1:return s.sent(),[3,4];case 2:return[4,e.sendEvent(t,n.opts.updateEventType,o,"")];case 3:s.sent(),s.label=4;case 4:return[2]}}))}))()}},{key:"sendSnapshot",value:function(e,t,r,n){var i=this;return(0,a.default)((function(){var o,a,s;return(0,_.__generator)(this,(function(u){switch(u.label){case 0:return o=O(r),a={update:o,last_event_id:n},i.opts.updatesAsRegularMessages?(s=(0,h.default)({body:i.opts.snapshotEventType+": "+o,msgtype:i.opts.snapshotEventType},a),e.scheduler=void 0,[4,e.sendEvent(t,rr,s,"")]):[3,2];case 1:return u.sent(),[3,4];case 2:return[4,e.sendEvent(t,i.opts.snapshotEventType,a,"")];case 3:u.sent(),u.label=4;case 4:return[2]}}))}))()}},{key:"isUpdateEvent",value:function(e){return this.opts.updatesAsRegularMessages?e.type===rr&&e.content.msgtype===this.opts.updateEventType:e.type===this.opts.updateEventType}},{key:"isSnapshotEvent",value:function(e){return this.opts.updatesAsRegularMessages?e.type===rr&&e.content.msgtype===this.opts.snapshotEventType:e.type===this.opts.snapshotEventType}},{key:"WrappedEventType",get:function(){return this.opts.updatesAsRegularMessages?rr:this.opts.updateEventType}}]),e}(),or={enableExperimentalWebrtcSync:!1,reader:{},writer:{},translator:{}},ar=function(e){"use strict";(0,f.default)(r,e);var t=(0,b.default)(r);function r(e,n,i,u){var l,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};(0,s.default)(this,r);var d=(0,o.default)(l);if((l=t.call(this)).doc=e,l.matrixClient=n,l.room=i,l.awareness=u,l.disposed=!1,l.initializedPromise=new Promise((function(e){l.initializedResolve=e})),l._onDocumentAvailable=l._register(new w.event.Emitter),l._onDocumentUnavailable=l._register(new w.event.Emitter),l._onReceivedEvents=l._register(new w.event.Emitter),l.onDocumentAvailable=l._onDocumentAvailable.event,l.onReceivedEvents=l._onReceivedEvents.event,l.onDocumentUnavailable=l._onDocumentUnavailable.event,l.totalEventsReceived=0,l.documentUpdateListener=function(){var e=(0,a.default)((function(e,t){return(0,_.__generator)(this,(function(r){return t===d||d.webrtcProvider&&t===d.webrtcProvider||null!=t&&t.provider||d.throttledWriter.writeUpdate(e),[2]}))}));return function(t,r){return e.apply(this,arguments)}}(),l.processIncomingEvents=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e.filter((function(e){return!(!l.translator.isUpdateEvent(e)&&!l.translator.isSnapshotEvent(e))})),l.totalEventsReceived+=e.length;var r=e.map((function(e){return new Uint8Array(A(e.content.update))})),n=S.mergeUpdates(r);if(!r.length)return n;if(S.applyUpdate(l.doc,n,(0,o.default)(l)),t){var i=e[e.length-1],a=S.encodeStateAsUpdate(l.doc);l.translator.sendSnapshot(l.matrixClient,l._roomId,a,i.event_id).catch((function(e){console.error("failed to send snapshot")}))}return e.filter((function(e){return e.user_id!==l.matrixClient.credentials.userId})).length&&l._onReceivedEvents.fire(),n},u&&!c.enableExperimentalWebrtcSync)throw new Error("awareness is only supported when using enableExperimentalWebrtcSync=true");return l.opts=(0,h.default)({},or,c),l.translator=new ir(l.opts.translator),l.throttledWriter=new tr(l.matrixClient,l.translator,l.opts.writer),e.on("update",l.documentUpdateListener),(0,v.default)(l)}return(0,u.default)(r,[{key:"onCanWriteChanged",get:function(){return this.throttledWriter.onCanWriteChanged}},{key:"canWrite",get:function(){return this.throttledWriter.canWrite}},{key:"roomId",get:function(){return this._roomId}},{key:"matrixReader",get:function(){return this.reader}},{key:"initializeWebrtc",value:function(){var e=this;return(0,a.default)((function(){var t;return(0,_.__generator)(this,(function(r){switch(r.label){case 0:if(!e._roomId)throw new Error("not initialized");if(!e.reader)throw new Error("needs reader to initialize webrtc");return[4,(t=e._register(new j(e.matrixClient,e.reader))).initialize()];case 1:return r.sent(),e.webrtcProvider=new Xt(e.doc,e._roomId,e._roomId,function(){var t=(0,a.default)((function(t){return(0,_.__generator)(this,(function(r){switch(r.label){case 0:return[4,D(e.matrixClient,t)];case 1:return r.sent(),[2]}}))}));return function(e){return t.apply(this,arguments)}}(),function(){var r=(0,a.default)((function(r){return(0,_.__generator)(this,(function(n){switch(n.label){case 0:return[4,L(e.matrixClient,t,r,e.translator.WrappedEventType)];case 1:return n.sent(),[2]}}))}));return function(e){return r.apply(this,arguments)}}(),void 0,e.awareness),[2]}}))}))()}},{key:"initializeNoCatch",value:function(){var e=this;return(0,a.default)((function(){var t,r,n,i,o,a,s,u,l,c,d,f;return(0,_.__generator)(this,(function(h){switch(h.label){case 0:t="id"===e.room.type?e.room.id:e.room.alias,h.label=1;case 1:return h.trys.push([1,6,,7]),"id"!==e.room.type?[3,2]:(e._roomId=e.room.id,[3,4]);case 2:return"alias"!==e.room.type?[3,4]:[4,e.matrixClient.getRoomIdForAlias(e.room.alias)];case 3:r=h.sent(),e._roomId=r.room_id,h.label=4;case 4:if(!e._roomId)throw new Error("error receiving room id");return console.log("room resolved",e._roomId),[4,e.throttledWriter.initialize(e._roomId)];case 5:return h.sent(),[3,7];case 6:return n=h.sent(),i=5e3,"M_NOT_FOUND"===n.errcode?(console.log("room not found",t),e._onDocumentUnavailable.fire()):"ConnectionError"===n.name?console.log("room not found (offline)",t):(console.error("error retrieving room",t,n),i=3e4,e._onDocumentUnavailable.fire()),e.initializeTimeoutHandler=setTimeout((function(){e.initialize()}),i),[2];case 7:return o=S.encodeStateAsUpdate(e.doc),a=S.encodeStateVectorFromUpdate(o),s=S.diffUpdate(o,a),u=S.snapshot(e.doc),[4,e.initializeReader()];case 8:return l=h.sent(),e._onDocumentAvailable.fire(),c=S.encodeStateVectorFromUpdate(l),d=S.diffUpdate(o,c),function(e,t){return function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=0;r<e.byteLength;r++)if(e.getUint8(r)!==t.getUint8(r))return!1;return!0}(new DataView(e),new DataView(t))}(s.buffer,d.buffer)&&(f=new S.Doc,S.applyUpdate(f,l),function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=t.ds.clients.entries()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=(0,g.default)(o.value,2),u=s[0],l=s[1],c=e.ds.clients.get(u)||[];if(l.length>c.length)return!1;for(var d=0;d<l.length;d++){var f=l[d],h=c[d];if(f.clock!==h.clock||f.len!==h.len)return!1}}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return!0}(S.snapshot(f),u))?(e.initializedResolve(),[2]):(d.length>2&&e.throttledWriter.writeUpdate(d),e.initializedResolve(),[2])}}))}))()}},{key:"initializeReader",value:function(){var e=this;return(0,a.default)((function(){var t;return(0,_.__generator)(this,(function(r){switch(r.label){case 0:if(e.reader)throw new Error("already initialized reader");if(!e._roomId)throw new Error("no roomId");return e.reader=e._register(new B(e.matrixClient,e._roomId,e.translator,e.opts.reader)),e._register(e.reader.onEvents((function(t){return e.processIncomingEvents(t.events,t.shouldSendSnapshot)}))),[4,e.reader.getInitialDocumentUpdateEvents()];case 1:return t=r.sent(),[2,(e.reader.startPolling(),e.processIncomingEvents(t))]}}))}))()}},{key:"waitForFlush",value:function(){var e=this;return(0,a.default)((function(){return(0,_.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.initializedPromise];case 1:return t.sent(),[4,e.throttledWriter.waitForFlush()];case 2:return t.sent(),[2]}}))}))()}},{key:"initialize",value:function(){var e=this;return(0,a.default)((function(){var t;return(0,_.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),[4,e.initializeNoCatch()];case 1:return r.sent(),[4,e.initializedPromise];case 2:return r.sent(),!e.disposed&&e.opts.enableExperimentalWebrtcSync?[4,e.initializeWebrtc()]:[3,4];case 3:r.sent(),r.label=4;case 4:return[3,6];case 5:throw t=r.sent(),console.error(t),t;case 6:return[2]}}))}))()}},{key:"dispose",value:function(){var e,t;(0,c.default)((0,d.default)(r.prototype),"dispose",this).call(this),this.disposed=!0,null==(e=this.webrtcProvider)||e.destroy(),null==(t=this.reader)||t.dispose(),clearTimeout(this.initializeTimeoutHandler),this.doc.off("update",this.documentUpdateListener)}}]),r}(w.lifecycle.Disposable);Mt("y-webrtc")})),n.register("39vSB",(function(t,i){e(t.exports,"lifecycle",(function(){return N})),e(t.exports,"event",(function(){return Be}));var o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("dLRop"),l=n("61A8y"),c=n("5gj45"),d=n("cksMj"),f=n("mBz5n"),h=n("9oGi2"),p=n("aojpe"),v=n("hcUaE"),g=n("giCK6"),m=n("eQNFO"),y=(m=n("eQNFO"),n("b758v"));n("1irm0").Buffer;function b(e,t){return 0===t.length?e:e.replace(/\{(\d+)\}/g,(function(e,r){var n=r[0];return void 0!==t[n]?t[n]:e}))}function _(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return b(t,n)}function w(e){var t,r=this,n=!1;return function(){return n?t:(n=!0,t=e.apply(r,arguments))}}var S;!function(e){e.is=function(e){return e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator]};var t=Object.freeze([]);e.empty=function(){return t},e.single=function(e){return(0,m.__generator)(this,(function(t){switch(t.label){case 0:return[4,e];case 1:return t.sent(),[2]}}))},e.from=function(e){return e||t},e.isEmpty=function(e){return!e||!0===e[Symbol.iterator]().next().done},e.first=function(e){return e[Symbol.iterator]().next().value},e.some=function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){if(t(o.value))return!0}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return!1},e.find=function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(t(s))return s}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}},e.filter=function(e,t){var r,n,i,o,a,s,u;return(0,m.__generator)(this,(function(l){switch(l.label){case 0:r=!0,n=!1,i=void 0,l.label=1;case 1:l.trys.push([1,6,7,8]),o=e[Symbol.iterator](),l.label=2;case 2:return(r=(a=o.next()).done)?[3,5]:(s=a.value,t(s)?[4,s]:[3,4]);case 3:l.sent(),l.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return u=l.sent(),n=!0,i=u,[3,8];case 7:try{r||null==o.return||o.return()}finally{if(n)throw i}return[7];case 8:return[2]}}))},e.map=function(e,t){var r,n,i,o,a,s,u,l;return(0,m.__generator)(this,(function(c){switch(c.label){case 0:r=0,n=!0,i=!1,o=void 0,c.label=1;case 1:c.trys.push([1,6,7,8]),a=e[Symbol.iterator](),c.label=2;case 2:return(n=(s=a.next()).done)?[3,5]:(u=s.value,[4,t(u,r++)]);case 3:c.sent(),c.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return l=c.sent(),i=!0,o=l,[3,8];case 7:try{n||null==a.return||a.return()}finally{if(i)throw o}return[7];case 8:return[2]}}))},e.concat=function(){var e,t,r,n,i,o,a,s,u,l,c,d,f,h,p,v=arguments;return(0,m.__generator)(this,(function(g){switch(g.label){case 0:for(e=v.length,t=new Array(e),r=0;r<e;r++)t[r]=v[r];n=!0,i=!1,o=void 0,a=!0,s=!1,u=void 0,g.label=1;case 1:g.trys.push([1,12,13,14]),l=t[Symbol.iterator](),g.label=2;case 2:if(a=(c=l.next()).done)return[3,11];d=c.value,g.label=3;case 3:g.trys.push([3,8,9,10]),f=d[Symbol.iterator](),g.label=4;case 4:return(n=(h=f.next()).done)?[3,7]:[4,h.value];case 5:g.sent(),g.label=6;case 6:return n=!0,[3,4];case 7:return[3,10];case 8:return p=g.sent(),i=!0,o=p,[3,10];case 9:try{n||null==f.return||f.return()}finally{if(i)throw o}return[7];case 10:return a=!0,[3,2];case 11:return[3,14];case 12:return p=g.sent(),s=!0,u=p,[3,14];case 13:try{a||null==l.return||l.return()}finally{if(s)throw u}return[7];case 14:return[2]}}))},e.concatNested=function(e){var t,r,n,i,o,a,s,u,l,c,d,f;return(0,m.__generator)(this,(function(h){switch(h.label){case 0:t=!0,r=!1,n=void 0,i=!0,o=!1,a=void 0,h.label=1;case 1:h.trys.push([1,12,13,14]),s=e[Symbol.iterator](),h.label=2;case 2:if(i=(u=s.next()).done)return[3,11];l=u.value,h.label=3;case 3:h.trys.push([3,8,9,10]),c=l[Symbol.iterator](),h.label=4;case 4:return(t=(d=c.next()).done)?[3,7]:[4,d.value];case 5:h.sent(),h.label=6;case 6:return t=!0,[3,4];case 7:return[3,10];case 8:return f=h.sent(),r=!0,n=f,[3,10];case 9:try{t||null==c.return||c.return()}finally{if(r)throw n}return[7];case 10:return i=!0,[3,2];case 11:return[3,14];case 12:return f=h.sent(),o=!0,a=f,[3,14];case 13:try{i||null==s.return||s.return()}finally{if(o)throw a}return[7];case 14:return[2]}}))},e.reduce=function(e,t,r){var n=r,i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){n=t(n,s.value)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return n},e.slice=function(e,t){var r,n=arguments;return(0,m.__generator)(this,(function(i){switch(i.label){case 0:r=n.length>2&&void 0!==n[2]?n[2]:e.length,t<0&&(t+=e.length),r<0?r+=e.length:r>e.length&&(r=e.length),i.label=1;case 1:return t<r?[4,e[t]]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}}))},e.consume=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,n=[];if(0===r)return[n,t];for(var i=t[Symbol.iterator](),o=0;o<r;o++){var a=i.next();if(a.done)return[n,e.empty()];n.push(a.value)}return[n,(0,u.default)({},Symbol.iterator,(function(){return i}))]},e.equals=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t},n=e[Symbol.iterator](),i=t[Symbol.iterator]();;){var o=n.next(),a=i.next();if(o.done!==a.done)return!1;if(o.done)return!0;if(!r(o.value,a.value))return!1}}}(S||(S={}));var E=null;function k(e){var t;return null==(t=E)||t.trackDisposable(e),e}function M(e){var t;null==(t=E)||t.markAsDisposed(e)}function C(e,t){var r;null==(r=E)||r.setParent(e,t)}function I(e,t){if(E){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;E.setParent(s,t)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}}var T=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e){var n;return(0,a.default)(this,r),(n=t.call(this,"Encountered errors while disposing of store. Errors: [".concat(e.join(", "),"]"))).errors=e,n}return r}((0,v.default)(Error));function R(e){if(S.is(e)){var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(s)try{s.dispose()}catch(e){t.push(e)}}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}if(1===t.length)throw t[0];if(t.length>1)throw new T(t);return Array.isArray(e)?[]:e}if(e)return e.dispose(),e}function x(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=O((function(){return R(t)}));return I(t,n),n}function O(e){var t=k({dispose:w((function(){M(t),e()}))});return t}var A=function(){"use strict";function e(){(0,a.default)(this,e),this._toDispose=new Set,this._isDisposed=!1,k(this)}return(0,s.default)(e,[{key:"dispose",value:function(){this._isDisposed||(M(this),this._isDisposed=!0,this.clear())}},{key:"clear",value:function(){try{R(this._toDispose.values())}finally{this._toDispose.clear()}}},{key:"add",value:function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return C(t,this),this._isDisposed?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}}]),e}();A.DISABLE_DISPOSED_WARNING=!1;var D=function(){"use strict";function e(){(0,a.default)(this,e),this._store=new A,k(this),C(this._store,this)}return(0,s.default)(e,[{key:"dispose",value:function(){M(this),this._store.dispose()}},{key:"_register",value:function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}}]),e}();D.None=Object.freeze({dispose:function(){}});var P=function(){"use strict";function e(){(0,a.default)(this,e),this._isDisposed=!1,k(this)}return(0,s.default)(e,[{key:"value",get:function(){return this._isDisposed?void 0:this._value},set:function(e){var t;this._isDisposed||e===this._value||(null==(t=this._value)||t.dispose(),e&&C(e,this),this._value=e)}},{key:"clear",value:function(){this.value=void 0}},{key:"dispose",value:function(){var e;this._isDisposed=!0,M(this),null==(e=this._value)||e.dispose(),this._value=void 0}},{key:"clearAndLeak",value:function(){var e=this._value;return this._value=void 0,e&&C(e,null),e}}]),e}(),L=function(){"use strict";function e(t){(0,a.default)(this,e),this._disposable=t,this._counter=1}return(0,s.default)(e,[{key:"acquire",value:function(){return this._counter++,this}},{key:"release",value:function(){return 0==--this._counter&&this._disposable.dispose(),this}}]),e}(),U=function(){"use strict";function e(){(0,a.default)(this,e),this.references=new Map}return(0,s.default)(e,[{key:"acquire",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=this,o=this.references.get(e);o||(o={counter:0,object:this.createReferencedObject.apply(this,[e].concat((0,h.default)(r)))},this.references.set(e,o));var a=o.object,s=w((function(){0==--o.counter&&(i.destroyReferencedObject(e,o.object),i.references.delete(e))}));return o.counter++,{object:a,dispose:s}}}]),e}(),j=function(){"use strict";function e(t){(0,a.default)(this,e),this.referenceCollection=t}return(0,s.default)(e,[{key:"acquire",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=this;return(0,o.default)((function(){var t,n,o;return(0,m.__generator)(this,(function(a){switch(a.label){case 0:n=(t=i.referenceCollection).acquire.apply(t,[e].concat((0,h.default)(r))),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n.object];case 2:return[2,{object:a.sent(),dispose:function(){return n.dispose()}}];case 3:throw o=a.sent(),n.dispose(),o;case 4:return[2]}}))}))()}}]),e}(),N={__proto__:null,setDisposableTracker:function(e){E=e},markAsSingleton:function(e){var t;return null==(t=E)||t.markAsSingleton(e),e},MultiDisposeError:T,isDisposable:function(e){return"function"==typeof e.dispose&&0===e.dispose.length},dispose:R,combinedDisposable:x,toDisposable:O,DisposableStore:A,Disposable:D,MutableDisposable:P,RefCountedDisposable:L,ReferenceCollection:U,AsyncReferenceCollection:j,ImmortalReference:function(){"use strict";function e(t){(0,a.default)(this,e),this.object=t}return(0,s.default)(e,[{key:"dispose",value:function(){}}]),e}()};function B(){return B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},B.apply(this,arguments)}var F=function(){"use strict";function e(){(0,a.default)(this,e),this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout((function(){if(e.stack)throw new Error(e.message+"\n\n"+e.stack);throw e}),0)}}return(0,s.default)(e,[{key:"addListener",value:function(e){var t=this;return this.listeners.push(e),function(){t._removeListener(e)}}},{key:"emit",value:function(e){this.listeners.forEach((function(t){t(e)}))}},{key:"_removeListener",value:function(e){this.listeners.splice(this.listeners.indexOf(e),1)}},{key:"setUnexpectedErrorHandler",value:function(e){this.unexpectedErrorHandler=e}},{key:"getUnexpectedErrorHandler",value:function(){return this.unexpectedErrorHandler}},{key:"onUnexpectedError",value:function(e){this.unexpectedErrorHandler(e),this.emit(e)}},{key:"onUnexpectedExternalError",value:function(e){this.unexpectedErrorHandler(e)}}]),e}(),K=new F;function q(e){V(e)||K.onUnexpectedError(e)}var W="Canceled";function V(e){return e instanceof Error&&e.name===W&&e.message===W}(0,v.default)(Error);(0,v.default)(Error),(0,v.default)(Error),(0,v.default)(Error);var H=function e(t){"use strict";(0,a.default)(this,e),this.element=t,this.next=e.Undefined,this.prev=e.Undefined};H.Undefined=new H(void 0);var G,z,Y,Z=function(){"use strict";function e(){(0,a.default)(this,e),this._first=H.Undefined,this._last=H.Undefined,this._size=0}return(0,s.default)(e,[{key:"size",get:function(){return this._size}},{key:"isEmpty",value:function(){return this._first===H.Undefined}},{key:"clear",value:function(){for(var e=this._first;e!==H.Undefined;){var t=e.next;e.prev=H.Undefined,e.next=H.Undefined,e=t}this._first=H.Undefined,this._last=H.Undefined,this._size=0}},{key:"unshift",value:function(e){return this._insert(e,!1)}},{key:"push",value:function(e){return this._insert(e,!0)}},{key:"_insert",value:function(e,t){var r=this,n=new H(e);if(this._first===H.Undefined)this._first=n,this._last=n;else if(t){var i=this._last;this._last=n,n.prev=i,i.next=n}else{var o=this._first;this._first=n,n.next=o,o.prev=n}this._size+=1;var a=!1;return function(){a||(a=!0,r._remove(n))}}},{key:"shift",value:function(){if(this._first!==H.Undefined){var e=this._first.element;return this._remove(this._first),e}}},{key:"pop",value:function(){if(this._last!==H.Undefined){var e=this._last.element;return this._remove(this._last),e}}},{key:"_remove",value:function(e){if(e.prev!==H.Undefined&&e.next!==H.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===H.Undefined&&e.next===H.Undefined?(this._first=H.Undefined,this._last=H.Undefined):e.next===H.Undefined?(this._last=this._last.prev,this._last.next=H.Undefined):e.prev===H.Undefined&&(this._first=this._first.next,this._first.prev=H.Undefined);this._size-=1}},{key:Symbol.iterator,value:function(){var e;return(0,m.__generator)(this,(function(t){switch(t.label){case 0:e=this._first,t.label=1;case 1:return e===H.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))}}]),e}(),$="en",J=!1,Q=!1,X=!1,ee=!1,te=!1,re=$,ne=void 0,ie="object"==typeof self?self:"object"==typeof r?r:{},oe=void 0;void 0!==ie.vscode&&void 0!==ie.vscode.process?oe=ie.vscode.process:void 0!==y&&(oe=y);var ae,se,ue="string"==typeof(null==(G=oe)||null==(z=G.versions)?void 0:z.electron)&&"renderer"===oe.type,le=ue&&(null==(Y=oe)?void 0:Y.sandboxed),ce=function(){var e;if(le)return"bypassHeatCheck";var t=null==(e=oe)?void 0:e.env.VSCODE_BROWSER_CODE_LOADING;return"string"==typeof t?"none"===t||"code"===t||"bypassHeatCheck"===t||"bypassHeatCheckAndEagerCompile"===t?t:"bypassHeatCheck":void 0}(),de="string"==typeof ce;if("object"!=typeof navigator||ue)if("object"==typeof oe){J="win32"===oe.platform,Q="darwin"===oe.platform,(X="linux"===oe.platform)&&!!oe.env.SNAP&&!!oe.env.SNAP_REVISION,$,re=$;var fe=oe.env.VSCODE_NLS_CONFIG;if(fe)try{var he=JSON.parse(fe),pe=he.availableLanguages["*"];he.locale,re=pe||$,he._translationsConfigFile}catch(e){}ee=!0}else console.error("Unable to resolve platform.");else J=(ne=navigator.userAgent).indexOf("Windows")>=0,Q=ne.indexOf("Macintosh")>=0,(ne.indexOf("Macintosh")>=0||ne.indexOf("iPad")>=0||ne.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,X=ne.indexOf("Linux")>=0,te=!0,re=navigator.language;(se=ae||(ae={}))[se.Web=0]="Web",se[se.Mac=1]="Mac",se[se.Linux=2]="Linux",se[se.Windows=3]="Windows";var ve,ge,me=J,ye=Q,be=X,_e=ee,we=te,Se=re;(ge=ve||(ve={})).value=function(){return Se},ge.isDefaultVariant=function(){return 2===Se.length?"en"===Se:Se.length>=3&&"e"===Se[0]&&"n"===Se[1]&&"-"===Se[2]},ge.isDefault=function(){return"en"===Se};var Ee,ke,Me=function(){var e;if(ie.setImmediate)return ie.setImmediate.bind(ie);if("function"==typeof ie.postMessage&&!ie.importScripts){var t=[];ie.addEventListener("message",(function(e){if(e.data&&e.data.vscodeSetImmediateId)for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i.id===e.data.vscodeSetImmediateId)return t.splice(r,1),void i.callback()}}));var r=0;return function(e){var n=++r;t.push({id:n,callback:e}),ie.postMessage({vscodeSetImmediateId:n},"*")}}if("function"==typeof(null==(e=oe)?void 0:e.nextTick))return oe.nextTick.bind(oe);var n=Promise.resolve();return function(e){return n.then(e)}}();(ke=Ee||(Ee={}))[ke.Windows=1]="Windows",ke[ke.Macintosh=2]="Macintosh",ke[ke.Linux=3]="Linux";var Ce,Ie=ie.performance&&"function"==typeof ie.performance.now,Te=function(){"use strict";function e(t){(0,a.default)(this,e),this._highResolution=Ie&&t,this._startTime=this._now(),this._stopTime=-1}return(0,s.default)(e,[{key:"stop",value:function(){this._stopTime=this._now()}},{key:"elapsed",value:function(){return-1!==this._stopTime?this._stopTime-this._startTime:this._now()-this._startTime}},{key:"_now",value:function(){return this._highResolution?ie.performance.now():Date.now()}}],[{key:"create",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new e(t)}}]),e}();!function(e){function t(e){return function(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,o=!1;return r=e((function(e){if(!o)return r?r.dispose():o=!0,t.call(n,e)}),null,i),o&&r.dispose(),r}}function r(e,t){return u((function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return e((function(e){return r.call(n,t(e))}),null,i)}))}function n(e,t){return u((function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return e((function(e){t(e),r.call(n,e)}),null,i)}))}function i(e,t){return u((function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return e((function(e){return t(e)&&r.call(n,e)}),null,i)}))}function o(e,t,n){var i=n;return r(e,(function(e){return i=t(i,e)}))}function u(e){var t,r=new Ae({onFirstListenerAdd:function(){t=e(r.fire,r)},onLastListenerRemove:function(){t.dispose()}});return r.event}function l(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,a=void 0,s=void 0,u=0,l=new Ae({leakWarningThreshold:o,onFirstListenerAdd:function(){r=e((function(e){u++,a=t(a,e),i&&!s&&(l.fire(a),a=void 0),clearTimeout(s),s=setTimeout((function(){var e=a;a=void 0,s=void 0,(!i||u>1)&&l.fire(e),u=0}),n)}))},onLastListenerRemove:function(){r.dispose()}});return l.event}function c(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return e===t},n=!0;return i(e,(function(e){var i=n||!r(e,t);return n=!1,t=e,i}))}e.None=function(){return D.None},e.once=t,e.map=r,e.forEach=n,e.filter=i,e.signal=function(e){return e},e.any=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return x.apply(void 0,(0,h.default)(t.map((function(t){return t((function(t){return e.call(r,t)}),null,n)}))))}},e.reduce=o,e.debounce=l,e.latch=c,e.split=function(t,r){return[e.filter(t,r),e.filter(t,(function(e){return!r(e)}))]},e.buffer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=r.slice(),i=e((function(e){n?n.push(e):a.fire(e)})),o=function(){n&&n.forEach((function(e){return a.fire(e)})),n=null},a=new Ae({onFirstListenerAdd:function(){i||(i=e((function(e){return a.fire(e)})))},onFirstListenerDidAdd:function(){n&&(t?setTimeout(o):o())},onLastListenerRemove:function(){i&&i.dispose(),i=null}});return a.event};var d=function(){"use strict";function e(t){(0,a.default)(this,e),this.event=t}return(0,s.default)(e,[{key:"map",value:function(t){return new e(r(this.event,t))}},{key:"forEach",value:function(t){return new e(n(this.event,t))}},{key:"filter",value:function(t){return new e(i(this.event,t))}},{key:"reduce",value:function(t,r){return new e(o(this.event,t,r))}},{key:"latch",value:function(){return new e(c(this.event))}},{key:"debounce",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return new e(l(this.event,t,r,n,i))}},{key:"on",value:function(e,t,r){return this.event(e,t,r)}},{key:"once",value:function(e,r,n){return t(this.event)(e,r,n)}}]),e}();e.chain=function(e){return new d(e)},e.fromNodeEventEmitter=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.fire(r.apply(void 0,(0,h.default)(t)))},i=function(){return e.on(t,n)},o=function(){return e.removeListener(t,n)},a=new Ae({onFirstListenerAdd:i,onLastListenerRemove:o});return a.event},e.fromDOMEventEmitter=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.fire(r.apply(void 0,(0,h.default)(t)))},i=function(){return e.addEventListener(t,n)},o=function(){return e.removeEventListener(t,n)},a=new Ae({onFirstListenerAdd:i,onLastListenerRemove:o});return a.event},e.toPromise=function(e){return new Promise((function(r){return t(e)(r)}))}}(Ce||(Ce={}));var Re=function(){"use strict";function e(t){(0,a.default)(this,e),this._listenerCount=0,this._invocationCount=0,this._elapsedOverall=0,this._name="".concat(t,"_").concat(e._idPool++)}return(0,s.default)(e,[{key:"start",value:function(e){this._stopWatch=new Te(!0),this._listenerCount=e}},{key:"stop",value:function(){if(this._stopWatch){var e=this._stopWatch.elapsed();this._elapsedOverall+=e,this._invocationCount+=1,console.info("did FIRE ".concat(this._name,": elapsed_ms: ").concat(e.toFixed(5),", listener: ").concat(this._listenerCount," (elapsed_overall: ").concat(this._elapsedOverall.toFixed(2),", invocations: ").concat(this._invocationCount,")")),this._stopWatch=void 0}}}]),e}();Re._idPool=0;var xe=-1;var Oe=function(){"use strict";function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random().toString(18).slice(2,5);(0,a.default)(this,e),this.customThreshold=t,this.name=r,this._warnCountdown=0}return(0,s.default)(e,[{key:"dispose",value:function(){this._stacks&&this._stacks.clear()}},{key:"check",value:function(e){var t=this,r=xe;if("number"==typeof this.customThreshold&&(r=this.customThreshold),!(r<=0||e<r)){this._stacks||(this._stacks=new Map);var n=(new Error).stack.split("\n").slice(3).join("\n"),i=this._stacks.get(n)||0;if(this._stacks.set(n,i+1),this._warnCountdown-=1,this._warnCountdown<=0){var o;this._warnCountdown=.5*r;var a=0,s=!0,u=!1,l=void 0;try{for(var c,d=this._stacks[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=(0,f.default)(c.value,2),p=h[0],v=h[1];(!o||a<v)&&(o=p,a=v)}}catch(e){u=!0,l=e}finally{try{s||null==d.return||d.return()}finally{if(u)throw l}}console.warn("[".concat(this.name,"] potential listener LEAK detected, having ").concat(e," listeners already. MOST frequent listener (").concat(a,"):")),console.warn(o)}return function(){var e=t._stacks.get(n)||0;t._stacks.set(n,e-1)}}}}]),e}(),Ae=function(){"use strict";function e(t){var r;(0,a.default)(this,e),this._disposed=!1,this._options=t,this._leakageMon=xe>0?new Oe(this._options&&this._options.leakWarningThreshold):void 0,this._perfMon=null!=(r=this._options)&&r._profName?new Re(this._options._profName):void 0}return(0,s.default)(e,[{key:"event",get:function(){var e=this;return this._event||(this._event=function(t,r,n){var i;e._listeners||(e._listeners=new Z);var o=e._listeners.isEmpty();o&&e._options&&e._options.onFirstListenerAdd&&e._options.onFirstListenerAdd(e);var a=e._listeners.push(r?[t,r]:t);o&&e._options&&e._options.onFirstListenerDidAdd&&e._options.onFirstListenerDidAdd(e),e._options&&e._options.onListenerDidAdd&&e._options.onListenerDidAdd(e,t,r);var s=null==(i=e._leakageMon)?void 0:i.check(e._listeners.size),u=O((function(){(s&&s(),e._disposed)||(a(),e._options&&e._options.onLastListenerRemove&&(e._listeners&&!e._listeners.isEmpty()||e._options.onLastListenerRemove(e)))}));return n instanceof A?n.add(u):Array.isArray(n)&&n.push(u),u}),this._event}},{key:"fire",value:function(e){if(this._listeners){var t,r;this._deliveryQueue||(this._deliveryQueue=new Z);var n=!0,i=!1,o=void 0;try{for(var a,s=this._listeners[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this._deliveryQueue.push([u,e])}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}for(null==(t=this._perfMon)||t.start(this._deliveryQueue.size);this._deliveryQueue.size>0;){var l=(0,f.default)(this._deliveryQueue.shift(),2),c=l[0],d=l[1];try{"function"==typeof c?c.call(void 0,d):c[0].call(c[1],d)}catch(e){q(e)}}null==(r=this._perfMon)||r.stop()}}},{key:"dispose",value:function(){var e,t,r,n;this._disposed||(this._disposed=!0,null==(e=this._listeners)||e.clear(),null==(t=this._deliveryQueue)||t.clear(),null==(r=this._options)||null==r.onLastListenerRemove||r.onLastListenerRemove(),null==(n=this._leakageMon)||n.dispose())}}]),e}(),De=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(){return(0,a.default)(this,r),t.apply(this,arguments)}return(0,s.default)(r,[{key:"fireAsync",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i,o,a,s,u,l,c,d,h,p,v;return(0,m.__generator)(this,(function(g){switch(g.label){case 0:if(!n._listeners)return[2];n._asyncDeliveryQueue||(n._asyncDeliveryQueue=new Z),i=!0,o=!1,a=void 0;try{for(s=n._listeners[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)l=u.value,n._asyncDeliveryQueue.push([l,e])}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}g.label=1;case 1:if(!(n._asyncDeliveryQueue.size>0)||t.isCancellationRequested)return[3,3];c=(0,f.default)(n._asyncDeliveryQueue.shift(),2),d=c[0],h=c[1],p=[],v=B({},h,{waitUntil:function(e){if(Object.isFrozen(p))throw new Error("waitUntil can NOT be called asynchronous");r&&(e=r(e,"function"==typeof d?d:d[0])),p.push(e)}});try{"function"==typeof d?d.call(void 0,v):d[0].call(d[1],v)}catch(e){return q(e),[3,1]}return Object.freeze(p),[4,Promise.allSettled(p).then((function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;"rejected"===a.status&&q(a.reason)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}))];case 2:return g.sent(),[3,1];case 3:return[2]}}))}))()}}]),r}(Ae),Pe=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e){var n;return(0,a.default)(this,r),(n=t.call(this,e))._isPaused=0,n._eventQueue=new Z,n._mergeFn=null==e?void 0:e.merge,n}return(0,s.default)(r,[{key:"pause",value:function(){this._isPaused++}},{key:"resume",value:function(){if(0!==this._isPaused&&0==--this._isPaused)if(this._mergeFn){var e=Array.from(this._eventQueue);this._eventQueue.clear(),(0,l.default)((0,c.default)(r.prototype),"fire",this).call(this,this._mergeFn(e))}else for(;!this._isPaused&&0!==this._eventQueue.size;)(0,l.default)((0,c.default)(r.prototype),"fire",this).call(this,this._eventQueue.shift())}},{key:"fire",value:function(e){this._listeners&&(0!==this._isPaused?this._eventQueue.push(e):(0,l.default)((0,c.default)(r.prototype),"fire",this).call(this,e))}}]),r}(Ae),Le=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e){var n,i;return(0,a.default)(this,r),(n=t.call(this,e))._delay=null!=(i=e.delay)?i:100,n}return(0,s.default)(r,[{key:"fire",value:function(e){var t=this;this._handle||(this.pause(),this._handle=setTimeout((function(){t._handle=void 0,t.resume()}),this._delay)),(0,l.default)((0,c.default)(r.prototype),"fire",this).call(this,e)}}]),r}(Pe),Ue=function(){"use strict";function e(){var t=this;(0,a.default)(this,e),this.hasListeners=!1,this.events=[],this.emitter=new Ae({onFirstListenerAdd:function(){return t.onFirstListenerAdd()},onLastListenerRemove:function(){return t.onLastListenerRemove()}})}return(0,s.default)(e,[{key:"event",get:function(){return this.emitter.event}},{key:"add",value:function(e){var t=this,r={event:e,listener:null};this.events.push(r),this.hasListeners&&this.hook(r);return O(w((function(){t.hasListeners&&t.unhook(r);var e=t.events.indexOf(r);t.events.splice(e,1)})))}},{key:"onFirstListenerAdd",value:function(){var e=this;this.hasListeners=!0,this.events.forEach((function(t){return e.hook(t)}))}},{key:"onLastListenerRemove",value:function(){var e=this;this.hasListeners=!1,this.events.forEach((function(t){return e.unhook(t)}))}},{key:"hook",value:function(e){var t=this;e.listener=e.event((function(e){return t.emitter.fire(e)}))}},{key:"unhook",value:function(e){e.listener&&e.listener.dispose(),e.listener=null}},{key:"dispose",value:function(){this.emitter.dispose()}}]),e}(),je=function(){"use strict";function e(){(0,a.default)(this,e),this.buffers=[]}return(0,s.default)(e,[{key:"wrapEvent",value:function(e){var t=this;return function(r,n,i){return e((function(e){var i=t.buffers[t.buffers.length-1];i?i.push((function(){return r.call(n,e)})):r.call(n,e)}),void 0,i)}}},{key:"bufferEvents",value:function(e){var t=[];this.buffers.push(t);var r=e();return this.buffers.pop(),t.forEach((function(e){return e()})),r}}]),e}(),Ne=function(){"use strict";function e(){var t=this;(0,a.default)(this,e),this.listening=!1,this.inputEvent=Ce.None,this.inputEventListener=D.None,this.emitter=new Ae({onFirstListenerDidAdd:function(){t.listening=!0,t.inputEventListener=t.inputEvent(t.emitter.fire,t.emitter)},onLastListenerRemove:function(){t.listening=!1,t.inputEventListener.dispose()}}),this.event=this.emitter.event}return(0,s.default)(e,[{key:"input",set:function(e){this.inputEvent=e,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=e(this.emitter.fire,this.emitter))}},{key:"dispose",value:function(){this.inputEventListener.dispose(),this.emitter.dispose()}}]),e}(),Be={__proto__:null,get Event(){return Ce},setGlobalLeakWarningThreshold:function(e){var t=xe;return xe=e,{dispose:function(){xe=t}}},Emitter:Ae,AsyncEmitter:De,PauseableEmitter:Pe,DebounceEmitter:Le,EventMultiplexer:Ue,EventBufferer:je,Relay:Ne},Fe=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],u=arguments.length>4?arguments[4]:void 0;return(0,a.default)(this,r),(n=t.call(this))._onDidChange=n._register(new Ae),n.onDidChange=n._onDidChange.event,n._enabled=!0,n._checked=!1,n._id=e,n._label=i,n._cssClass=o,n._enabled=s,n._actionCallback=u,n}return(0,s.default)(r,[{key:"id",get:function(){return this._id}},{key:"label",get:function(){return this._label},set:function(e){this._setLabel(e)}},{key:"_setLabel",value:function(e){this._label!==e&&(this._label=e,this._onDidChange.fire({label:e}))}},{key:"tooltip",get:function(){return this._tooltip||""},set:function(e){this._setTooltip(e)}},{key:"_setTooltip",value:function(e){this._tooltip!==e&&(this._tooltip=e,this._onDidChange.fire({tooltip:e}))}},{key:"class",get:function(){return this._cssClass},set:function(e){this._setClass(e)}},{key:"_setClass",value:function(e){this._cssClass!==e&&(this._cssClass=e,this._onDidChange.fire({class:e}))}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._setEnabled(e)}},{key:"_setEnabled",value:function(e){this._enabled!==e&&(this._enabled=e,this._onDidChange.fire({enabled:e}))}},{key:"checked",get:function(){return this._checked},set:function(e){this._setChecked(e)}},{key:"_setChecked",value:function(e){this._checked!==e&&(this._checked=e,this._onDidChange.fire({checked:e}))}},{key:"run",value:function(e,t){var r=this;return(0,o.default)((function(){return(0,m.__generator)(this,(function(t){switch(t.label){case 0:return r._actionCallback?[4,r._actionCallback(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))()}}]),r}(D),Ke=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e){var n;return(0,a.default)(this,r),(n=t.call(this,r.ID,e,e?"separator text":"separator")).checked=!1,n.enabled=!1,n}return(0,s.default)(r,null,[{key:"join",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=[],o=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;c.length&&(i=i.length?(0,h.default)(i).concat([new r],(0,h.default)(c)):c)}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}return i}}]),r}(Fe);Ke.ID="vs.actions.separator";var qe=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(){return(0,a.default)(this,r),t.call(this,r.ID,_("submenu.empty","(empty)"),void 0,!1)}return r}(Fe);qe.ID="vs.actions.empty";var We,Ve,He=Object.freeze((function(e,t){var r=setTimeout(e.bind(t),0);return{dispose:function(){clearTimeout(r)}}}));(Ve=We||(We={})).isCancellationToken=function(e){return e===Ve.None||e===Ve.Cancelled||e instanceof Ge||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested&&"function"==typeof e.onCancellationRequested},Ve.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Ce.None}),Ve.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:He});var Ge=function(){"use strict";function e(){(0,a.default)(this,e),this._isCancelled=!1,this._emitter=null}return(0,s.default)(e,[{key:"cancel",value:function(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}},{key:"isCancellationRequested",get:function(){return this._isCancelled}},{key:"onCancellationRequested",get:function(){return this._isCancelled?He:(this._emitter||(this._emitter=new Ae),this._emitter.event)}},{key:"dispose",value:function(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}]),e}();function ze(e,t){return e<t?-1:e>t?1:0}function Ye(e){return e>=97&&e<=122}function Ze(e){return e>=65&&e<=90}function $e(e){return Ye(e)||Ze(e)}function Je(e,t){return e.length===t.length&&Qe(e,t)}function Qe(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,n=0;n<r;n++){var i=e.charCodeAt(n),o=t.charCodeAt(n);if(i!==o)if($e(i)&&$e(o)){var a=Math.abs(i-o);if(0!==a&&32!==a)return!1}else if(String.fromCharCode(i).toLowerCase()!==String.fromCharCode(o).toLowerCase())return!1}return!0}function Xe(e,t){var r=t.length;return!(t.length>e.length)&&Qe(e,t,r)}function et(e){return 55296<=e&&e<=56319}function tt(e){return 56320<=e&&e<=57343}function rt(e,t){return t-56320+(e-55296<<10)+65536}var nt,it;String.fromCharCode(65279);(it=nt||(nt={}))[it.Other=0]="Other",it[it.Prepend=1]="Prepend",it[it.CR=2]="CR",it[it.LF=3]="LF",it[it.Control=4]="Control",it[it.Extend=5]="Extend",it[it.Regional_Indicator=6]="Regional_Indicator",it[it.SpacingMark=7]="SpacingMark",it[it.L=8]="L",it[it.V=9]="V",it[it.T=10]="T",it[it.LV=11]="LV",it[it.LVT=12]="LVT",it[it.ZWJ=13]="ZWJ",it[it.Extended_Pictographic=14]="Extended_Pictographic";var ot,at,st=function(){"use strict";function e(){(0,a.default)(this,e),this._data=JSON.parse("[0,0,0,51592,51592,11,44424,44424,11,72251,72254,5,7150,7150,7,48008,48008,11,55176,55176,11,128420,128420,14,3276,3277,5,9979,9980,14,46216,46216,11,49800,49800,11,53384,53384,11,70726,70726,5,122915,122916,5,129320,129327,14,2558,2558,5,5906,5908,5,9762,9763,14,43360,43388,8,45320,45320,11,47112,47112,11,48904,48904,11,50696,50696,11,52488,52488,11,54280,54280,11,70082,70083,1,71350,71350,7,73111,73111,5,127892,127893,14,128726,128727,14,129473,129474,14,2027,2035,5,2901,2902,5,3784,3789,5,6754,6754,5,8418,8420,5,9877,9877,14,11088,11088,14,44008,44008,5,44872,44872,11,45768,45768,11,46664,46664,11,47560,47560,11,48456,48456,11,49352,49352,11,50248,50248,11,51144,51144,11,52040,52040,11,52936,52936,11,53832,53832,11,54728,54728,11,69811,69814,5,70459,70460,5,71096,71099,7,71998,71998,5,72874,72880,5,119149,119149,7,127374,127374,14,128335,128335,14,128482,128482,14,128765,128767,14,129399,129400,14,129680,129685,14,1476,1477,5,2377,2380,7,2759,2760,5,3137,3140,7,3458,3459,7,4153,4154,5,6432,6434,5,6978,6978,5,7675,7679,5,9723,9726,14,9823,9823,14,9919,9923,14,10035,10036,14,42736,42737,5,43596,43596,5,44200,44200,11,44648,44648,11,45096,45096,11,45544,45544,11,45992,45992,11,46440,46440,11,46888,46888,11,47336,47336,11,47784,47784,11,48232,48232,11,48680,48680,11,49128,49128,11,49576,49576,11,50024,50024,11,50472,50472,11,50920,50920,11,51368,51368,11,51816,51816,11,52264,52264,11,52712,52712,11,53160,53160,11,53608,53608,11,54056,54056,11,54504,54504,11,54952,54952,11,68108,68111,5,69933,69940,5,70197,70197,7,70498,70499,7,70845,70845,5,71229,71229,5,71727,71735,5,72154,72155,5,72344,72345,5,73023,73029,5,94095,94098,5,121403,121452,5,126981,127182,14,127538,127546,14,127990,127990,14,128391,128391,14,128445,128449,14,128500,128505,14,128752,128752,14,129160,129167,14,129356,129356,14,129432,129442,14,129648,129651,14,129751,131069,14,173,173,4,1757,1757,1,2274,2274,1,2494,2494,5,2641,2641,5,2876,2876,5,3014,3016,7,3262,3262,7,3393,3396,5,3570,3571,7,3968,3972,5,4228,4228,7,6086,6086,5,6679,6680,5,6912,6915,5,7080,7081,5,7380,7392,5,8252,8252,14,9096,9096,14,9748,9749,14,9784,9786,14,9833,9850,14,9890,9894,14,9938,9938,14,9999,9999,14,10085,10087,14,12349,12349,14,43136,43137,7,43454,43456,7,43755,43755,7,44088,44088,11,44312,44312,11,44536,44536,11,44760,44760,11,44984,44984,11,45208,45208,11,45432,45432,11,45656,45656,11,45880,45880,11,46104,46104,11,46328,46328,11,46552,46552,11,46776,46776,11,47000,47000,11,47224,47224,11,47448,47448,11,47672,47672,11,47896,47896,11,48120,48120,11,48344,48344,11,48568,48568,11,48792,48792,11,49016,49016,11,49240,49240,11,49464,49464,11,49688,49688,11,49912,49912,11,50136,50136,11,50360,50360,11,50584,50584,11,50808,50808,11,51032,51032,11,51256,51256,11,51480,51480,11,51704,51704,11,51928,51928,11,52152,52152,11,52376,52376,11,52600,52600,11,52824,52824,11,53048,53048,11,53272,53272,11,53496,53496,11,53720,53720,11,53944,53944,11,54168,54168,11,54392,54392,11,54616,54616,11,54840,54840,11,55064,55064,11,65438,65439,5,69633,69633,5,69837,69837,1,70018,70018,7,70188,70190,7,70368,70370,7,70465,70468,7,70712,70719,5,70835,70840,5,70850,70851,5,71132,71133,5,71340,71340,7,71458,71461,5,71985,71989,7,72002,72002,7,72193,72202,5,72281,72283,5,72766,72766,7,72885,72886,5,73104,73105,5,92912,92916,5,113824,113827,4,119173,119179,5,121505,121519,5,125136,125142,5,127279,127279,14,127489,127490,14,127570,127743,14,127900,127901,14,128254,128254,14,128369,128370,14,128400,128400,14,128425,128432,14,128468,128475,14,128489,128494,14,128715,128720,14,128745,128745,14,128759,128760,14,129004,129023,14,129296,129304,14,129340,129342,14,129388,129392,14,129404,129407,14,129454,129455,14,129485,129487,14,129659,129663,14,129719,129727,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2363,2363,7,2402,2403,5,2507,2508,7,2622,2624,7,2691,2691,7,2786,2787,5,2881,2884,5,3006,3006,5,3072,3072,5,3170,3171,5,3267,3268,7,3330,3331,7,3406,3406,1,3538,3540,5,3655,3662,5,3897,3897,5,4038,4038,5,4184,4185,5,4352,4447,8,6068,6069,5,6155,6157,5,6448,6449,7,6742,6742,5,6783,6783,5,6966,6970,5,7042,7042,7,7143,7143,7,7212,7219,5,7412,7412,5,8206,8207,4,8294,8303,4,8596,8601,14,9410,9410,14,9742,9742,14,9757,9757,14,9770,9770,14,9794,9794,14,9828,9828,14,9855,9855,14,9882,9882,14,9900,9903,14,9929,9933,14,9963,9967,14,9987,9988,14,10006,10006,14,10062,10062,14,10175,10175,14,11744,11775,5,42607,42607,5,43043,43044,7,43263,43263,5,43444,43445,7,43569,43570,5,43698,43700,5,43766,43766,5,44032,44032,11,44144,44144,11,44256,44256,11,44368,44368,11,44480,44480,11,44592,44592,11,44704,44704,11,44816,44816,11,44928,44928,11,45040,45040,11,45152,45152,11,45264,45264,11,45376,45376,11,45488,45488,11,45600,45600,11,45712,45712,11,45824,45824,11,45936,45936,11,46048,46048,11,46160,46160,11,46272,46272,11,46384,46384,11,46496,46496,11,46608,46608,11,46720,46720,11,46832,46832,11,46944,46944,11,47056,47056,11,47168,47168,11,47280,47280,11,47392,47392,11,47504,47504,11,47616,47616,11,47728,47728,11,47840,47840,11,47952,47952,11,48064,48064,11,48176,48176,11,48288,48288,11,48400,48400,11,48512,48512,11,48624,48624,11,48736,48736,11,48848,48848,11,48960,48960,11,49072,49072,11,49184,49184,11,49296,49296,11,49408,49408,11,49520,49520,11,49632,49632,11,49744,49744,11,49856,49856,11,49968,49968,11,50080,50080,11,50192,50192,11,50304,50304,11,50416,50416,11,50528,50528,11,50640,50640,11,50752,50752,11,50864,50864,11,50976,50976,11,51088,51088,11,51200,51200,11,51312,51312,11,51424,51424,11,51536,51536,11,51648,51648,11,51760,51760,11,51872,51872,11,51984,51984,11,52096,52096,11,52208,52208,11,52320,52320,11,52432,52432,11,52544,52544,11,52656,52656,11,52768,52768,11,52880,52880,11,52992,52992,11,53104,53104,11,53216,53216,11,53328,53328,11,53440,53440,11,53552,53552,11,53664,53664,11,53776,53776,11,53888,53888,11,54000,54000,11,54112,54112,11,54224,54224,11,54336,54336,11,54448,54448,11,54560,54560,11,54672,54672,11,54784,54784,11,54896,54896,11,55008,55008,11,55120,55120,11,64286,64286,5,66272,66272,5,68900,68903,5,69762,69762,7,69817,69818,5,69927,69931,5,70003,70003,5,70070,70078,5,70094,70094,7,70194,70195,7,70206,70206,5,70400,70401,5,70463,70463,7,70475,70477,7,70512,70516,5,70722,70724,5,70832,70832,5,70842,70842,5,70847,70848,5,71088,71089,7,71102,71102,7,71219,71226,5,71231,71232,5,71342,71343,7,71453,71455,5,71463,71467,5,71737,71738,5,71995,71996,5,72000,72000,7,72145,72147,7,72160,72160,5,72249,72249,7,72273,72278,5,72330,72342,5,72752,72758,5,72850,72871,5,72882,72883,5,73018,73018,5,73031,73031,5,73109,73109,5,73461,73462,7,94031,94031,5,94192,94193,7,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,126976,126979,14,127184,127231,14,127344,127345,14,127405,127461,14,127514,127514,14,127561,127567,14,127778,127779,14,127896,127896,14,127985,127986,14,127995,127999,5,128326,128328,14,128360,128366,14,128378,128378,14,128394,128397,14,128405,128406,14,128422,128423,14,128435,128443,14,128453,128464,14,128479,128480,14,128484,128487,14,128496,128498,14,128640,128709,14,128723,128724,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129096,129103,14,129292,129292,14,129311,129311,14,129329,129330,14,129344,129349,14,129360,129374,14,129394,129394,14,129402,129402,14,129413,129425,14,129445,129450,14,129466,129471,14,129483,129483,14,129511,129535,14,129653,129655,14,129667,129670,14,129705,129711,14,129731,129743,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2307,2307,7,2366,2368,7,2382,2383,7,2434,2435,7,2497,2500,5,2519,2519,5,2563,2563,7,2631,2632,5,2677,2677,5,2750,2752,7,2763,2764,7,2817,2817,5,2879,2879,5,2891,2892,7,2914,2915,5,3008,3008,5,3021,3021,5,3076,3076,5,3146,3149,5,3202,3203,7,3264,3265,7,3271,3272,7,3298,3299,5,3390,3390,5,3402,3404,7,3426,3427,5,3535,3535,5,3544,3550,7,3635,3635,7,3763,3763,7,3893,3893,5,3953,3966,5,3981,3991,5,4145,4145,7,4157,4158,5,4209,4212,5,4237,4237,5,4520,4607,10,5970,5971,5,6071,6077,5,6089,6099,5,6277,6278,5,6439,6440,5,6451,6456,7,6683,6683,5,6744,6750,5,6765,6770,7,6846,6846,5,6964,6964,5,6972,6972,5,7019,7027,5,7074,7077,5,7083,7085,5,7146,7148,7,7154,7155,7,7222,7223,5,7394,7400,5,7416,7417,5,8204,8204,5,8233,8233,4,8288,8292,4,8413,8416,5,8482,8482,14,8986,8987,14,9193,9203,14,9654,9654,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9775,14,9792,9792,14,9800,9811,14,9825,9826,14,9831,9831,14,9852,9853,14,9872,9873,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9936,9936,14,9941,9960,14,9974,9974,14,9982,9985,14,9992,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10145,10145,14,11013,11015,14,11503,11505,5,12334,12335,5,12951,12951,14,42612,42621,5,43014,43014,5,43047,43047,7,43204,43205,5,43335,43345,5,43395,43395,7,43450,43451,7,43561,43566,5,43573,43574,5,43644,43644,5,43710,43711,5,43758,43759,7,44005,44005,5,44012,44012,7,44060,44060,11,44116,44116,11,44172,44172,11,44228,44228,11,44284,44284,11,44340,44340,11,44396,44396,11,44452,44452,11,44508,44508,11,44564,44564,11,44620,44620,11,44676,44676,11,44732,44732,11,44788,44788,11,44844,44844,11,44900,44900,11,44956,44956,11,45012,45012,11,45068,45068,11,45124,45124,11,45180,45180,11,45236,45236,11,45292,45292,11,45348,45348,11,45404,45404,11,45460,45460,11,45516,45516,11,45572,45572,11,45628,45628,11,45684,45684,11,45740,45740,11,45796,45796,11,45852,45852,11,45908,45908,11,45964,45964,11,46020,46020,11,46076,46076,11,46132,46132,11,46188,46188,11,46244,46244,11,46300,46300,11,46356,46356,11,46412,46412,11,46468,46468,11,46524,46524,11,46580,46580,11,46636,46636,11,46692,46692,11,46748,46748,11,46804,46804,11,46860,46860,11,46916,46916,11,46972,46972,11,47028,47028,11,47084,47084,11,47140,47140,11,47196,47196,11,47252,47252,11,47308,47308,11,47364,47364,11,47420,47420,11,47476,47476,11,47532,47532,11,47588,47588,11,47644,47644,11,47700,47700,11,47756,47756,11,47812,47812,11,47868,47868,11,47924,47924,11,47980,47980,11,48036,48036,11,48092,48092,11,48148,48148,11,48204,48204,11,48260,48260,11,48316,48316,11,48372,48372,11,48428,48428,11,48484,48484,11,48540,48540,11,48596,48596,11,48652,48652,11,48708,48708,11,48764,48764,11,48820,48820,11,48876,48876,11,48932,48932,11,48988,48988,11,49044,49044,11,49100,49100,11,49156,49156,11,49212,49212,11,49268,49268,11,49324,49324,11,49380,49380,11,49436,49436,11,49492,49492,11,49548,49548,11,49604,49604,11,49660,49660,11,49716,49716,11,49772,49772,11,49828,49828,11,49884,49884,11,49940,49940,11,49996,49996,11,50052,50052,11,50108,50108,11,50164,50164,11,50220,50220,11,50276,50276,11,50332,50332,11,50388,50388,11,50444,50444,11,50500,50500,11,50556,50556,11,50612,50612,11,50668,50668,11,50724,50724,11,50780,50780,11,50836,50836,11,50892,50892,11,50948,50948,11,51004,51004,11,51060,51060,11,51116,51116,11,51172,51172,11,51228,51228,11,51284,51284,11,51340,51340,11,51396,51396,11,51452,51452,11,51508,51508,11,51564,51564,11,51620,51620,11,51676,51676,11,51732,51732,11,51788,51788,11,51844,51844,11,51900,51900,11,51956,51956,11,52012,52012,11,52068,52068,11,52124,52124,11,52180,52180,11,52236,52236,11,52292,52292,11,52348,52348,11,52404,52404,11,52460,52460,11,52516,52516,11,52572,52572,11,52628,52628,11,52684,52684,11,52740,52740,11,52796,52796,11,52852,52852,11,52908,52908,11,52964,52964,11,53020,53020,11,53076,53076,11,53132,53132,11,53188,53188,11,53244,53244,11,53300,53300,11,53356,53356,11,53412,53412,11,53468,53468,11,53524,53524,11,53580,53580,11,53636,53636,11,53692,53692,11,53748,53748,11,53804,53804,11,53860,53860,11,53916,53916,11,53972,53972,11,54028,54028,11,54084,54084,11,54140,54140,11,54196,54196,11,54252,54252,11,54308,54308,11,54364,54364,11,54420,54420,11,54476,54476,11,54532,54532,11,54588,54588,11,54644,54644,11,54700,54700,11,54756,54756,11,54812,54812,11,54868,54868,11,54924,54924,11,54980,54980,11,55036,55036,11,55092,55092,11,55148,55148,11,55216,55238,9,65056,65071,5,65529,65531,4,68097,68099,5,68159,68159,5,69446,69456,5,69688,69702,5,69808,69810,7,69815,69816,7,69821,69821,1,69888,69890,5,69932,69932,7,69957,69958,7,70016,70017,5,70067,70069,7,70079,70080,7,70089,70092,5,70095,70095,5,70191,70193,5,70196,70196,5,70198,70199,5,70367,70367,5,70371,70378,5,70402,70403,7,70462,70462,5,70464,70464,5,70471,70472,7,70487,70487,5,70502,70508,5,70709,70711,7,70720,70721,7,70725,70725,7,70750,70750,5,70833,70834,7,70841,70841,7,70843,70844,7,70846,70846,7,70849,70849,7,71087,71087,5,71090,71093,5,71100,71101,5,71103,71104,5,71216,71218,7,71227,71228,7,71230,71230,7,71339,71339,5,71341,71341,5,71344,71349,5,71351,71351,5,71456,71457,7,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123628,123631,5,125252,125258,5,126980,126980,14,127183,127183,14,127245,127247,14,127340,127343,14,127358,127359,14,127377,127386,14,127462,127487,6,127491,127503,14,127535,127535,14,127548,127551,14,127568,127569,14,127744,127777,14,127780,127891,14,127894,127895,14,127897,127899,14,127902,127984,14,127987,127989,14,127991,127994,14,128000,128253,14,128255,128317,14,128329,128334,14,128336,128359,14,128367,128368,14,128371,128377,14,128379,128390,14,128392,128393,14,128398,128399,14,128401,128404,14,128407,128419,14,128421,128421,14,128424,128424,14,128433,128434,14,128444,128444,14,128450,128452,14,128465,128467,14,128476,128478,14,128481,128481,14,128483,128483,14,128488,128488,14,128495,128495,14,128499,128499,14,128506,128591,14,128710,128714,14,128721,128722,14,128725,128725,14,128728,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129664,129666,14,129671,129679,14,129686,129704,14,129712,129718,14,129728,129730,14,129744,129750,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2259,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3134,3136,5,3142,3144,5,3157,3158,5,3201,3201,5,3260,3260,5,3263,3263,5,3266,3266,5,3270,3270,5,3274,3275,7,3285,3286,5,3328,3329,5,3387,3388,5,3391,3392,7,3398,3400,7,3405,3405,5,3415,3415,5,3457,3457,5,3530,3530,5,3536,3537,7,3542,3542,5,3551,3551,5,3633,3633,5,3636,3642,5,3761,3761,5,3764,3772,5,3864,3865,5,3895,3895,5,3902,3903,7,3967,3967,7,3974,3975,5,3993,4028,5,4141,4144,5,4146,4151,5,4155,4156,7,4182,4183,7,4190,4192,5,4226,4226,5,4229,4230,5,4253,4253,5,4448,4519,9,4957,4959,5,5938,5940,5,6002,6003,5,6070,6070,7,6078,6085,7,6087,6088,7,6109,6109,5,6158,6158,4,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6848,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7673,5,8203,8203,4,8205,8205,13,8232,8232,4,8234,8238,4,8265,8265,14,8293,8293,4,8400,8412,5,8417,8417,5,8421,8432,5,8505,8505,14,8617,8618,14,9000,9000,14,9167,9167,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9776,9783,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9935,14,9937,9937,14,9939,9940,14,9961,9962,14,9968,9973,14,9975,9978,14,9981,9981,14,9986,9986,14,9989,9989,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10084,14,10133,10135,14,10160,10160,14,10548,10549,14,11035,11036,14,11093,11093,14,11647,11647,5,12330,12333,5,12336,12336,14,12441,12442,5,12953,12953,14,42608,42610,5,42654,42655,5,43010,43010,5,43019,43019,5,43045,43046,5,43052,43052,5,43188,43203,7,43232,43249,5,43302,43309,5,43346,43347,7,43392,43394,5,43443,43443,5,43446,43449,5,43452,43453,5,43493,43493,5,43567,43568,7,43571,43572,7,43587,43587,5,43597,43597,7,43696,43696,5,43703,43704,5,43713,43713,5,43756,43757,5,43765,43765,7,44003,44004,7,44006,44007,7,44009,44010,7,44013,44013,5,44033,44059,12,44061,44087,12,44089,44115,12,44117,44143,12,44145,44171,12,44173,44199,12,44201,44227,12,44229,44255,12,44257,44283,12,44285,44311,12,44313,44339,12,44341,44367,12,44369,44395,12,44397,44423,12,44425,44451,12,44453,44479,12,44481,44507,12,44509,44535,12,44537,44563,12,44565,44591,12,44593,44619,12,44621,44647,12,44649,44675,12,44677,44703,12,44705,44731,12,44733,44759,12,44761,44787,12,44789,44815,12,44817,44843,12,44845,44871,12,44873,44899,12,44901,44927,12,44929,44955,12,44957,44983,12,44985,45011,12,45013,45039,12,45041,45067,12,45069,45095,12,45097,45123,12,45125,45151,12,45153,45179,12,45181,45207,12,45209,45235,12,45237,45263,12,45265,45291,12,45293,45319,12,45321,45347,12,45349,45375,12,45377,45403,12,45405,45431,12,45433,45459,12,45461,45487,12,45489,45515,12,45517,45543,12,45545,45571,12,45573,45599,12,45601,45627,12,45629,45655,12,45657,45683,12,45685,45711,12,45713,45739,12,45741,45767,12,45769,45795,12,45797,45823,12,45825,45851,12,45853,45879,12,45881,45907,12,45909,45935,12,45937,45963,12,45965,45991,12,45993,46019,12,46021,46047,12,46049,46075,12,46077,46103,12,46105,46131,12,46133,46159,12,46161,46187,12,46189,46215,12,46217,46243,12,46245,46271,12,46273,46299,12,46301,46327,12,46329,46355,12,46357,46383,12,46385,46411,12,46413,46439,12,46441,46467,12,46469,46495,12,46497,46523,12,46525,46551,12,46553,46579,12,46581,46607,12,46609,46635,12,46637,46663,12,46665,46691,12,46693,46719,12,46721,46747,12,46749,46775,12,46777,46803,12,46805,46831,12,46833,46859,12,46861,46887,12,46889,46915,12,46917,46943,12,46945,46971,12,46973,46999,12,47001,47027,12,47029,47055,12,47057,47083,12,47085,47111,12,47113,47139,12,47141,47167,12,47169,47195,12,47197,47223,12,47225,47251,12,47253,47279,12,47281,47307,12,47309,47335,12,47337,47363,12,47365,47391,12,47393,47419,12,47421,47447,12,47449,47475,12,47477,47503,12,47505,47531,12,47533,47559,12,47561,47587,12,47589,47615,12,47617,47643,12,47645,47671,12,47673,47699,12,47701,47727,12,47729,47755,12,47757,47783,12,47785,47811,12,47813,47839,12,47841,47867,12,47869,47895,12,47897,47923,12,47925,47951,12,47953,47979,12,47981,48007,12,48009,48035,12,48037,48063,12,48065,48091,12,48093,48119,12,48121,48147,12,48149,48175,12,48177,48203,12,48205,48231,12,48233,48259,12,48261,48287,12,48289,48315,12,48317,48343,12,48345,48371,12,48373,48399,12,48401,48427,12,48429,48455,12,48457,48483,12,48485,48511,12,48513,48539,12,48541,48567,12,48569,48595,12,48597,48623,12,48625,48651,12,48653,48679,12,48681,48707,12,48709,48735,12,48737,48763,12,48765,48791,12,48793,48819,12,48821,48847,12,48849,48875,12,48877,48903,12,48905,48931,12,48933,48959,12,48961,48987,12,48989,49015,12,49017,49043,12,49045,49071,12,49073,49099,12,49101,49127,12,49129,49155,12,49157,49183,12,49185,49211,12,49213,49239,12,49241,49267,12,49269,49295,12,49297,49323,12,49325,49351,12,49353,49379,12,49381,49407,12,49409,49435,12,49437,49463,12,49465,49491,12,49493,49519,12,49521,49547,12,49549,49575,12,49577,49603,12,49605,49631,12,49633,49659,12,49661,49687,12,49689,49715,12,49717,49743,12,49745,49771,12,49773,49799,12,49801,49827,12,49829,49855,12,49857,49883,12,49885,49911,12,49913,49939,12,49941,49967,12,49969,49995,12,49997,50023,12,50025,50051,12,50053,50079,12,50081,50107,12,50109,50135,12,50137,50163,12,50165,50191,12,50193,50219,12,50221,50247,12,50249,50275,12,50277,50303,12,50305,50331,12,50333,50359,12,50361,50387,12,50389,50415,12,50417,50443,12,50445,50471,12,50473,50499,12,50501,50527,12,50529,50555,12,50557,50583,12,50585,50611,12,50613,50639,12,50641,50667,12,50669,50695,12,50697,50723,12,50725,50751,12,50753,50779,12,50781,50807,12,50809,50835,12,50837,50863,12,50865,50891,12,50893,50919,12,50921,50947,12,50949,50975,12,50977,51003,12,51005,51031,12,51033,51059,12,51061,51087,12,51089,51115,12,51117,51143,12,51145,51171,12,51173,51199,12,51201,51227,12,51229,51255,12,51257,51283,12,51285,51311,12,51313,51339,12,51341,51367,12,51369,51395,12,51397,51423,12,51425,51451,12,51453,51479,12,51481,51507,12,51509,51535,12,51537,51563,12,51565,51591,12,51593,51619,12,51621,51647,12,51649,51675,12,51677,51703,12,51705,51731,12,51733,51759,12,51761,51787,12,51789,51815,12,51817,51843,12,51845,51871,12,51873,51899,12,51901,51927,12,51929,51955,12,51957,51983,12,51985,52011,12,52013,52039,12,52041,52067,12,52069,52095,12,52097,52123,12,52125,52151,12,52153,52179,12,52181,52207,12,52209,52235,12,52237,52263,12,52265,52291,12,52293,52319,12,52321,52347,12,52349,52375,12,52377,52403,12,52405,52431,12,52433,52459,12,52461,52487,12,52489,52515,12,52517,52543,12,52545,52571,12,52573,52599,12,52601,52627,12,52629,52655,12,52657,52683,12,52685,52711,12,52713,52739,12,52741,52767,12,52769,52795,12,52797,52823,12,52825,52851,12,52853,52879,12,52881,52907,12,52909,52935,12,52937,52963,12,52965,52991,12,52993,53019,12,53021,53047,12,53049,53075,12,53077,53103,12,53105,53131,12,53133,53159,12,53161,53187,12,53189,53215,12,53217,53243,12,53245,53271,12,53273,53299,12,53301,53327,12,53329,53355,12,53357,53383,12,53385,53411,12,53413,53439,12,53441,53467,12,53469,53495,12,53497,53523,12,53525,53551,12,53553,53579,12,53581,53607,12,53609,53635,12,53637,53663,12,53665,53691,12,53693,53719,12,53721,53747,12,53749,53775,12,53777,53803,12,53805,53831,12,53833,53859,12,53861,53887,12,53889,53915,12,53917,53943,12,53945,53971,12,53973,53999,12,54001,54027,12,54029,54055,12,54057,54083,12,54085,54111,12,54113,54139,12,54141,54167,12,54169,54195,12,54197,54223,12,54225,54251,12,54253,54279,12,54281,54307,12,54309,54335,12,54337,54363,12,54365,54391,12,54393,54419,12,54421,54447,12,54449,54475,12,54477,54503,12,54505,54531,12,54533,54559,12,54561,54587,12,54589,54615,12,54617,54643,12,54645,54671,12,54673,54699,12,54701,54727,12,54729,54755,12,54757,54783,12,54785,54811,12,54813,54839,12,54841,54867,12,54869,54895,12,54897,54923,12,54925,54951,12,54953,54979,12,54981,55007,12,55009,55035,12,55037,55063,12,55065,55091,12,55093,55119,12,55121,55147,12,55149,55175,12,55177,55203,12,55243,55291,10,65024,65039,5,65279,65279,4,65520,65528,4,66045,66045,5,66422,66426,5,68101,68102,5,68152,68154,5,68325,68326,5,69291,69292,5,69632,69632,7,69634,69634,7,69759,69761,5]")}return(0,s.default)(e,[{key:"getGraphemeBreakType",value:function(e){if(e<32)return 10===e?3:13===e?2:4;if(e<127)return 0;for(var t=this._data,r=t.length/3,n=1;n<=r;)if(e<t[3*n])n*=2;else{if(!(e>t[3*n+1]))return t[3*n+2];n=2*n+1}return 0}}],[{key:"getInstance",value:function(){return e._INSTANCE||(e._INSTANCE=new e),e._INSTANCE}}]),e}();st._INSTANCE=null,(at=ot||(ot={}))[at.zwj=8205]="zwj",at[at.emojiVariantSelector=65039]="emojiVariantSelector",at[at.enclosingKeyCap=8419]="enclosingKeyCap";var ut;if(void 0!==ie.vscode&&void 0!==ie.vscode.process){var lt=ie.vscode.process;ut={get platform(){return lt.platform},get env(){return lt.env},cwd:function(){return lt.cwd()},nextTick:function(e){return Me(e)}}}else ut=void 0!==y?{get platform(){return y.platform},get env(){return y.env},cwd:function(){return y.cwd()},nextTick:function(e){return y.nextTick(e)}}:{get platform(){return me?"win32":ye?"darwin":"linux"},nextTick:function(e){return Me(e)},get env(){return{}},cwd:function(){return"/"}};var ct=ut.cwd,dt=ut.env,ft=ut.platform,ht=(ut.nextTick,46),pt=47,vt=92,gt=58,mt=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e,n,i){var o,s;(0,a.default)(this,r),"string"==typeof n&&0===n.indexOf("not ")?(s="must not be",n=n.replace(/^not /,"")):s="must be";var u=-1!==e.indexOf(".")?"property":"argument",l='The "'.concat(e,'" ').concat(u," ").concat(s," of type ").concat(n);return l+=". Received type ".concat(void 0===i?"undefined":(0,p.default)(i)),(o=t.call(this,l)).code="ERR_INVALID_ARG_TYPE",o}return r}((0,v.default)(Error));function yt(e,t){if("string"!=typeof e)throw new mt(t,"string",e)}function bt(e){return e===pt||e===vt}function _t(e){return e===pt}function wt(e){return e>=65&&e<=90||e>=97&&e<=122}function St(e,t,r,n){for(var i="",o=0,a=-1,s=0,u=0,l=0;l<=e.length;++l){if(l<e.length)u=e.charCodeAt(l);else{if(n(u))break;u=pt}if(n(u)){if(a===l-1||1===s);else if(2===s){if(i.length<2||2!==o||i.charCodeAt(i.length-1)!==ht||i.charCodeAt(i.length-2)!==ht){if(i.length>2){var c=i.lastIndexOf(r);-1===c?(i="",o=0):o=(i=i.slice(0,c)).length-1-i.lastIndexOf(r),a=l,s=0;continue}if(0!==i.length){i="",o=0,a=l,s=0;continue}}t&&(i+=i.length>0?"".concat(r,".."):"..",o=2)}else i.length>0?i+="".concat(r).concat(e.slice(a+1,l)):i=e.slice(a+1,l),o=l-a-1;a=l,s=0}else u===ht&&-1!==s?++s:s=-1}return i}function Et(e,t){if(null===t||"object"!=typeof t)throw new mt("pathObject","Object",t);var r=t.dir||t.root,n=t.base||"".concat(t.name||"").concat(t.ext||"");return r?r===t.root?"".concat(r).concat(n):"".concat(r).concat(e).concat(n):n}var kt={resolve:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n="",i="",o=!1,a=t.length-1;a>=-1;a--){var s=void 0;if(a>=0){if(yt(s=t[a],"path"),0===s.length)continue}else 0===n.length?s=ct():(void 0===(s=dt["=".concat(n)]||ct())||s.slice(0,2).toLowerCase()!==n.toLowerCase()&&s.charCodeAt(2)===vt)&&(s="".concat(n,"\\"));var u=s.length,l=0,c="",d=!1,f=s.charCodeAt(0);if(1===u)bt(f)&&(l=1,d=!0);else if(bt(f))if(d=!0,bt(s.charCodeAt(1))){for(var h=2,p=h;h<u&&!bt(s.charCodeAt(h));)h++;if(h<u&&h!==p){var v=s.slice(p,h);for(p=h;h<u&&bt(s.charCodeAt(h));)h++;if(h<u&&h!==p){for(p=h;h<u&&!bt(s.charCodeAt(h));)h++;h!==u&&h===p||(c="\\\\".concat(v,"\\").concat(s.slice(p,h)),l=h)}}}else l=1;else wt(f)&&s.charCodeAt(1)===gt&&(c=s.slice(0,2),l=2,u>2&&bt(s.charCodeAt(2))&&(d=!0,l=3));if(c.length>0)if(n.length>0){if(c.toLowerCase()!==n.toLowerCase())continue}else n=c;if(o){if(n.length>0)break}else if(i="".concat(s.slice(l),"\\").concat(i),o=d,d&&n.length>0)break}return i=St(i,!o,"\\",bt),o?"".concat(n,"\\").concat(i):"".concat(n).concat(i)||"."},normalize:function(e){yt(e,"path");var t=e.length;if(0===t)return".";var r,n=0,i=!1,o=e.charCodeAt(0);if(1===t)return _t(o)?"\\":e;if(bt(o))if(i=!0,bt(e.charCodeAt(1))){for(var a=2,s=a;a<t&&!bt(e.charCodeAt(a));)a++;if(a<t&&a!==s){var u=e.slice(s,a);for(s=a;a<t&&bt(e.charCodeAt(a));)a++;if(a<t&&a!==s){for(s=a;a<t&&!bt(e.charCodeAt(a));)a++;if(a===t)return"\\\\".concat(u,"\\").concat(e.slice(s),"\\");a!==s&&(r="\\\\".concat(u,"\\").concat(e.slice(s,a)),n=a)}}}else n=1;else wt(o)&&e.charCodeAt(1)===gt&&(r=e.slice(0,2),n=2,t>2&&bt(e.charCodeAt(2))&&(i=!0,n=3));var l=n<t?St(e.slice(n),!i,"\\",bt):"";return 0!==l.length||i||(l="."),l.length>0&&bt(e.charCodeAt(t-1))&&(l+="\\"),void 0===r?i?"\\".concat(l):l:i?"".concat(r,"\\").concat(l):"".concat(r).concat(l)},isAbsolute:function(e){yt(e,"path");var t=e.length;if(0===t)return!1;var r=e.charCodeAt(0);return bt(r)||t>2&&wt(r)&&e.charCodeAt(1)===gt&&bt(e.charCodeAt(2))},join:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(0===t.length)return".";for(var n,i,o=0;o<t.length;++o){var a=t[o];yt(a,"path"),a.length>0&&(void 0===n?n=i=a:n+="\\".concat(a))}if(void 0===n)return".";var s=!0,u=0;if("string"==typeof i&&bt(i.charCodeAt(0))){++u;var l=i.length;l>1&&bt(i.charCodeAt(1))&&(++u,l>2&&(bt(i.charCodeAt(2))?++u:s=!1))}if(s){for(;u<n.length&&bt(n.charCodeAt(u));)u++;u>=2&&(n="\\".concat(n.slice(u)))}return kt.normalize(n)},relative:function(e,t){if(yt(e,"from"),yt(t,"to"),e===t)return"";var r=kt.resolve(e),n=kt.resolve(t);if(r===n)return"";if((e=r.toLowerCase())===(t=n.toLowerCase()))return"";for(var i=0;i<e.length&&e.charCodeAt(i)===vt;)i++;for(var o=e.length;o-1>i&&e.charCodeAt(o-1)===vt;)o--;for(var a=o-i,s=0;s<t.length&&t.charCodeAt(s)===vt;)s++;for(var u=t.length;u-1>s&&t.charCodeAt(u-1)===vt;)u--;for(var l=u-s,c=a<l?a:l,d=-1,f=0;f<c;f++){var h=e.charCodeAt(i+f);if(h!==t.charCodeAt(s+f))break;h===vt&&(d=f)}if(f!==c){if(-1===d)return n}else{if(l>c){if(t.charCodeAt(s+f)===vt)return n.slice(s+f+1);if(2===f)return n.slice(s+f)}a>c&&(e.charCodeAt(i+f)===vt?d=f:2===f&&(d=3)),-1===d&&(d=0)}var p="";for(f=i+d+1;f<=o;++f)f!==o&&e.charCodeAt(f)!==vt||(p+=0===p.length?"..":"\\..");return s+=d,p.length>0?"".concat(p).concat(n.slice(s,u)):(n.charCodeAt(s)===vt&&++s,n.slice(s,u))},toNamespacedPath:function(e){if("string"!=typeof e)return e;if(0===e.length)return"";var t=kt.resolve(e);if(t.length<=2)return e;if(t.charCodeAt(0)===vt){if(t.charCodeAt(1)===vt){var r=t.charCodeAt(2);if(63!==r&&r!==ht)return"\\\\?\\UNC\\".concat(t.slice(2))}}else if(wt(t.charCodeAt(0))&&t.charCodeAt(1)===gt&&t.charCodeAt(2)===vt)return"\\\\?\\".concat(t);return e},dirname:function(e){yt(e,"path");var t=e.length;if(0===t)return".";var r=-1,n=0,i=e.charCodeAt(0);if(1===t)return bt(i)?e:".";if(bt(i)){if(r=n=1,bt(e.charCodeAt(1))){for(var o=2,a=o;o<t&&!bt(e.charCodeAt(o));)o++;if(o<t&&o!==a){for(a=o;o<t&&bt(e.charCodeAt(o));)o++;if(o<t&&o!==a){for(a=o;o<t&&!bt(e.charCodeAt(o));)o++;if(o===t)return e;o!==a&&(r=n=o+1)}}}}else wt(i)&&e.charCodeAt(1)===gt&&(n=r=t>2&&bt(e.charCodeAt(2))?3:2);for(var s=-1,u=!0,l=t-1;l>=n;--l)if(bt(e.charCodeAt(l))){if(!u){s=l;break}}else u=!1;if(-1===s){if(-1===r)return".";s=r}return e.slice(0,s)},basename:function(e,t){void 0!==t&&yt(t,"ext"),yt(e,"path");var r,n=0,i=-1,o=!0;if(e.length>=2&&wt(e.charCodeAt(0))&&e.charCodeAt(1)===gt&&(n=2),void 0!==t&&t.length>0&&t.length<=e.length){if(t===e)return"";var a=t.length-1,s=-1;for(r=e.length-1;r>=n;--r){var u=e.charCodeAt(r);if(bt(u)){if(!o){n=r+1;break}}else-1===s&&(o=!1,s=r+1),a>=0&&(u===t.charCodeAt(a)?-1==--a&&(i=r):(a=-1,i=s))}return n===i?i=s:-1===i&&(i=e.length),e.slice(n,i)}for(r=e.length-1;r>=n;--r)if(bt(e.charCodeAt(r))){if(!o){n=r+1;break}}else-1===i&&(o=!1,i=r+1);return-1===i?"":e.slice(n,i)},extname:function(e){yt(e,"path");var t=0,r=-1,n=0,i=-1,o=!0,a=0;e.length>=2&&e.charCodeAt(1)===gt&&wt(e.charCodeAt(0))&&(t=n=2);for(var s=e.length-1;s>=t;--s){var u=e.charCodeAt(s);if(bt(u)){if(!o){n=s+1;break}}else-1===i&&(o=!1,i=s+1),u===ht?-1===r?r=s:1!==a&&(a=1):-1!==r&&(a=-1)}return-1===r||-1===i||0===a||1===a&&r===i-1&&r===n+1?"":e.slice(r,i)},format:Et.bind(null,"\\"),parse:function(e){yt(e,"path");var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var r=e.length,n=0,i=e.charCodeAt(0);if(1===r)return bt(i)?(t.root=t.dir=e,t):(t.base=t.name=e,t);if(bt(i)){if(n=1,bt(e.charCodeAt(1))){for(var o=2,a=o;o<r&&!bt(e.charCodeAt(o));)o++;if(o<r&&o!==a){for(a=o;o<r&&bt(e.charCodeAt(o));)o++;if(o<r&&o!==a){for(a=o;o<r&&!bt(e.charCodeAt(o));)o++;o===r?n=o:o!==a&&(n=o+1)}}}}else if(wt(i)&&e.charCodeAt(1)===gt){if(r<=2)return t.root=t.dir=e,t;if(n=2,bt(e.charCodeAt(2))){if(3===r)return t.root=t.dir=e,t;n=3}}n>0&&(t.root=e.slice(0,n));for(var s=-1,u=n,l=-1,c=!0,d=e.length-1,f=0;d>=n;--d)if(bt(i=e.charCodeAt(d))){if(!c){u=d+1;break}}else-1===l&&(c=!1,l=d+1),i===ht?-1===s?s=d:1!==f&&(f=1):-1!==s&&(f=-1);return-1!==l&&(-1===s||0===f||1===f&&s===l-1&&s===u+1?t.base=t.name=e.slice(u,l):(t.name=e.slice(u,s),t.base=e.slice(u,l),t.ext=e.slice(s,l))),t.dir=u>0&&u!==n?e.slice(0,u-1):t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},Mt={resolve:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n="",i=!1,o=t.length-1;o>=-1&&!i;o--){var a=o>=0?t[o]:ct();yt(a,"path"),0!==a.length&&(n="".concat(a,"/").concat(n),i=a.charCodeAt(0)===pt)}return n=St(n,!i,"/",_t),i?"/".concat(n):n.length>0?n:"."},normalize:function(e){if(yt(e,"path"),0===e.length)return".";var t=e.charCodeAt(0)===pt,r=e.charCodeAt(e.length-1)===pt;return 0===(e=St(e,!t,"/",_t)).length?t?"/":r?"./":".":(r&&(e+="/"),t?"/".concat(e):e)},isAbsolute:function(e){return yt(e,"path"),e.length>0&&e.charCodeAt(0)===pt},join:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(0===t.length)return".";for(var n,i=0;i<t.length;++i){var o=t[i];yt(o,"path"),o.length>0&&(void 0===n?n=o:n+="/".concat(o))}return void 0===n?".":Mt.normalize(n)},relative:function(e,t){if(yt(e,"from"),yt(t,"to"),e===t)return"";if((e=Mt.resolve(e))===(t=Mt.resolve(t)))return"";for(var r=e.length,n=r-1,i=t.length-1,o=n<i?n:i,a=-1,s=0;s<o;s++){var u=e.charCodeAt(1+s);if(u!==t.charCodeAt(1+s))break;u===pt&&(a=s)}if(s===o)if(i>o){if(t.charCodeAt(1+s)===pt)return t.slice(1+s+1);if(0===s)return t.slice(1+s)}else n>o&&(e.charCodeAt(1+s)===pt?a=s:0===s&&(a=0));var l="";for(s=1+a+1;s<=r;++s)s!==r&&e.charCodeAt(s)!==pt||(l+=0===l.length?"..":"/..");return"".concat(l).concat(t.slice(1+a))},toNamespacedPath:function(e){return e},dirname:function(e){if(yt(e,"path"),0===e.length)return".";for(var t=e.charCodeAt(0)===pt,r=-1,n=!0,i=e.length-1;i>=1;--i)if(e.charCodeAt(i)===pt){if(!n){r=i;break}}else n=!1;return-1===r?t?"/":".":t&&1===r?"//":e.slice(0,r)},basename:function(e,t){void 0!==t&&yt(t,"ext"),yt(e,"path");var r,n=0,i=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t===e)return"";var a=t.length-1,s=-1;for(r=e.length-1;r>=0;--r){var u=e.charCodeAt(r);if(u===pt){if(!o){n=r+1;break}}else-1===s&&(o=!1,s=r+1),a>=0&&(u===t.charCodeAt(a)?-1==--a&&(i=r):(a=-1,i=s))}return n===i?i=s:-1===i&&(i=e.length),e.slice(n,i)}for(r=e.length-1;r>=0;--r)if(e.charCodeAt(r)===pt){if(!o){n=r+1;break}}else-1===i&&(o=!1,i=r+1);return-1===i?"":e.slice(n,i)},extname:function(e){yt(e,"path");for(var t=-1,r=0,n=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(s!==pt)-1===n&&(i=!1,n=a+1),s===ht?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){r=a+1;break}}return-1===t||-1===n||0===o||1===o&&t===n-1&&t===r+1?"":e.slice(t,n)},format:Et.bind(null,"/"),parse:function(e){yt(e,"path");var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var r,n=e.charCodeAt(0)===pt;n?(t.root="/",r=1):r=0;for(var i=-1,o=0,a=-1,s=!0,u=e.length-1,l=0;u>=r;--u){var c=e.charCodeAt(u);if(c!==pt)-1===a&&(s=!1,a=u+1),c===ht?-1===i?i=u:1!==l&&(l=1):-1!==i&&(l=-1);else if(!s){o=u+1;break}}if(-1!==a){var d=0===o&&n?1:o;-1===i||0===l||1===l&&i===a-1&&i===o+1?t.base=t.name=e.slice(d,a):(t.name=e.slice(d,i),t.base=e.slice(d,a),t.ext=e.slice(i,a))}return o>0?t.dir=e.slice(0,o-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Mt.win32=kt.win32=kt,Mt.posix=kt.posix=Mt;var Ct="win32"===ft?kt.normalize:Mt.normalize,It=("win32"===ft?kt.isAbsolute:Mt.isAbsolute,"win32"===ft?kt.join:Mt.join,"win32"===ft?kt.resolve:Mt.resolve),Tt="win32"===ft?kt.relative:Mt.relative,Rt="win32"===ft?kt.dirname:Mt.dirname,xt=("win32"===ft?kt.basename:Mt.basename,"win32"===ft?kt.extname:Mt.extname,"win32"===ft?kt.format:Mt.format,"win32"===ft?kt.parse:Mt.parse,"win32"===ft?kt.toNamespacedPath:Mt.toNamespacedPath,"win32"===ft?kt.sep:Mt.sep);"win32"===ft?kt.delimiter:Mt.delimiter;Object.prototype.hasOwnProperty;function Ot(e){return 47===e||92===e}function At(e){return e.replace(/[\\/]/g,Mt.sep)}function Dt(e){return-1===e.indexOf("/")&&(e=At(e)),/^[a-zA-Z]:(\/|$)/.test(e)&&(e="/"+e),e}function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mt.sep;if(!e)return"";var r=e.length,n=e.charCodeAt(0);if(Ot(n)){if(Ot(e.charCodeAt(1))&&!Ot(e.charCodeAt(2))){for(var i=3,o=i;i<r&&!Ot(e.charCodeAt(i));i++);if(o!==i&&!Ot(e.charCodeAt(i+1)))for(i+=1;i<r;i++)if(Ot(e.charCodeAt(i)))return e.slice(0,i+1).replace(/[\\/]/g,t)}return t}if(Ut(n)&&58===e.charCodeAt(1))return Ot(e.charCodeAt(2))?e.slice(0,2)+t:e.slice(0,2);var a=e.indexOf("://");if(-1!==a)for(a+=3;a<r;a++)if(Ot(e.charCodeAt(a)))return e.slice(0,a+1);return""}function Lt(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xt;if(e===t)return!0;if(!e||!t)return!1;if(t.length>e.length)return!1;if(r){var i=Xe(e,t);if(!i)return!1;if(t.length===e.length)return!0;var o=t.length;return t.charAt(t.length-1)===n&&o--,e.charAt(o)===n}return t.charAt(t.length-1)!==n&&(t+=n),0===e.indexOf(t)}function Ut(e){return e>=65&&e<=90||e>=97&&e<=122}var jt=/^\w[\w\d+.-]*$/,Nt=/^\//,Bt=/^\/\//;function Ft(e,t){if(!e.scheme&&t)throw new Error('[UriError]: Scheme is missing: {scheme: "", authority: "'.concat(e.authority,'", path: "').concat(e.path,'", query: "').concat(e.query,'", fragment: "').concat(e.fragment,'"}'));if(e.scheme&&!jt.test(e.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(e.path)if(e.authority){if(!Nt.test(e.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(Bt.test(e.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}function Kt(e,t){return e||t?e:"file"}function qt(e,t){switch(e){case"https":case"http":case"file":t?t[0]!==Ht&&(t=Ht+t):t=Ht}return t}var Wt,Vt="",Ht="/",Gt=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,zt=function(){"use strict";function e(t,r,n,i,o){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,a.default)(this,e),"object"==typeof t?(this.scheme=t.scheme||Vt,this.authority=t.authority||Vt,this.path=t.path||Vt,this.query=t.query||Vt,this.fragment=t.fragment||Vt):(this.scheme=Kt(t,s),this.authority=r||Vt,this.path=qt(this.scheme,n||Vt),this.query=i||Vt,this.fragment=o||Vt,Ft(this,s))}return(0,s.default)(e,[{key:"fsPath",get:function(){return Xt(this,!1)}},{key:"with",value:function(e){if(!e)return this;var t=e.scheme,r=e.authority,n=e.path,i=e.query,o=e.fragment;return void 0===t?t=this.scheme:null===t&&(t=Vt),void 0===r?r=this.authority:null===r&&(r=Vt),void 0===n?n=this.path:null===n&&(n=Vt),void 0===i?i=this.query:null===i&&(i=Vt),void 0===o?o=this.fragment:null===o&&(o=Vt),t===this.scheme&&r===this.authority&&n===this.path&&i===this.query&&o===this.fragment?this:new Zt(t,r,n,i,o)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return er(this,e)}},{key:"toJSON",value:function(){return this}}],[{key:"isUri",value:function(t){return t instanceof e||!!t&&("string"==typeof t.authority&&"string"==typeof t.fragment&&"string"==typeof t.path&&"string"==typeof t.query&&"string"==typeof t.scheme&&"string"==typeof t.fsPath&&"function"==typeof t.with&&"function"==typeof t.toString)}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Gt.exec(e);return r?new Zt(r[2]||Vt,nr(r[4]||Vt),nr(r[5]||Vt),nr(r[7]||Vt),nr(r[9]||Vt),t):new Zt(Vt,Vt,Vt,Vt,Vt)}},{key:"file",value:function(e){var t=Vt;if(me&&(e=e.replace(/\\/g,Ht)),e[0]===Ht&&e[1]===Ht){var r=e.indexOf(Ht,2);-1===r?(t=e.substring(2),e=Ht):(t=e.substring(2,r),e=e.substring(r)||Ht)}return new Zt("file",t,e,Vt,Vt)}},{key:"from",value:function(e){var t=new Zt(e.scheme,e.authority,e.path,e.query,e.fragment);return Ft(t,!0),t}},{key:"joinPath",value:function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o,a,s;if(!t.path)throw new Error("[UriError]: cannot call joinPath on URI without path");return s=me&&"file"===t.scheme?e.file((o=kt).join.apply(o,[Xt(t,!0)].concat((0,h.default)(n)))).path:(a=Mt).join.apply(a,[t.path].concat((0,h.default)(n))),t.with({path:s})}},{key:"revive",value:function(t){if(t){if(t instanceof e)return t;var r=new Zt(t);return r._formatted=t.external,r._fsPath=t._sep===Yt?t.fsPath:null,r}return t}}]),e}(),Yt=me?1:void 0,Zt=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(){var e;return(0,a.default)(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._formatted=null,e._fsPath=null,e}return(0,s.default)(r,[{key:"fsPath",get:function(){return this._fsPath||(this._fsPath=Xt(this,!1)),this._fsPath}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?er(this,!0):(this._formatted||(this._formatted=er(this,!1)),this._formatted)}},{key:"toJSON",value:function(){var e={$mid:1};return this._fsPath&&(e.fsPath=this._fsPath,e._sep=Yt),this._formatted&&(e.external=this._formatted),this.path&&(e.path=this.path),this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority),this.query&&(e.query=this.query),this.fragment&&(e.fragment=this.fragment),e}}]),r}(zt),$t=(Wt={},(0,u.default)(Wt,58,"%3A"),(0,u.default)(Wt,47,"%2F"),(0,u.default)(Wt,63,"%3F"),(0,u.default)(Wt,35,"%23"),(0,u.default)(Wt,91,"%5B"),(0,u.default)(Wt,93,"%5D"),(0,u.default)(Wt,64,"%40"),(0,u.default)(Wt,33,"%21"),(0,u.default)(Wt,36,"%24"),(0,u.default)(Wt,38,"%26"),(0,u.default)(Wt,39,"%27"),(0,u.default)(Wt,40,"%28"),(0,u.default)(Wt,41,"%29"),(0,u.default)(Wt,42,"%2A"),(0,u.default)(Wt,43,"%2B"),(0,u.default)(Wt,44,"%2C"),(0,u.default)(Wt,59,"%3B"),(0,u.default)(Wt,61,"%3D"),(0,u.default)(Wt,32,"%20"),Wt);function Jt(e,t){for(var r=void 0,n=-1,i=0;i<e.length;i++){var o=e.charCodeAt(i);if(o>=97&&o<=122||o>=65&&o<=90||o>=48&&o<=57||45===o||46===o||95===o||126===o||t&&47===o)-1!==n&&(r+=encodeURIComponent(e.substring(n,i)),n=-1),void 0!==r&&(r+=e.charAt(i));else{void 0===r&&(r=e.substr(0,i));var a=$t[o];void 0!==a?(-1!==n&&(r+=encodeURIComponent(e.substring(n,i)),n=-1),r+=a):-1===n&&(n=i)}}return-1!==n&&(r+=encodeURIComponent(e.substring(n))),void 0!==r?r:e}function Qt(e){for(var t=void 0,r=0;r<e.length;r++){var n=e.charCodeAt(r);35===n||63===n?(void 0===t&&(t=e.substr(0,r)),t+=$t[n]):void 0!==t&&(t+=e[r])}return void 0!==t?t:e}function Xt(e,t){var r;return r=e.authority&&e.path.length>1&&"file"===e.scheme?"//".concat(e.authority).concat(e.path):47===e.path.charCodeAt(0)&&(e.path.charCodeAt(1)>=65&&e.path.charCodeAt(1)<=90||e.path.charCodeAt(1)>=97&&e.path.charCodeAt(1)<=122)&&58===e.path.charCodeAt(2)?t?e.path.substr(1):e.path[1].toLowerCase()+e.path.substr(2):e.path,me&&(r=r.replace(/\//g,"\\")),r}function er(e,t){var r=t?Qt:Jt,n="",i=e.scheme,o=e.authority,a=e.path,s=e.query,u=e.fragment;if(i&&(n+=i,n+=":"),(o||"file"===i)&&(n+=Ht,n+=Ht),o){var l=o.indexOf("@");if(-1!==l){var c=o.substr(0,l);o=o.substr(l+1),-1===(l=c.indexOf(":"))?n+=r(c,!1):(n+=r(c.substr(0,l),!1),n+=":",n+=r(c.substr(l+1),!1)),n+="@"}-1===(l=(o=o.toLowerCase()).indexOf(":"))?n+=r(o,!1):(n+=r(o.substr(0,l),!1),n+=o.substr(l))}if(a){if(a.length>=3&&47===a.charCodeAt(0)&&58===a.charCodeAt(2)){var d=a.charCodeAt(1);d>=65&&d<=90&&(a="/".concat(String.fromCharCode(d+32),":").concat(a.substr(3)))}else if(a.length>=2&&58===a.charCodeAt(1)){var f=a.charCodeAt(0);f>=65&&f<=90&&(a="".concat(String.fromCharCode(f+32),":").concat(a.substr(2)))}n+=r(a,!0)}return s&&(n+="?",n+=r(s,!1)),u&&(n+="#",n+=t?u:Jt(u,!1)),n}function tr(e){try{return decodeURIComponent(e)}catch(t){return e.length>3?e.substr(0,3)+tr(e.substr(3)):e}}var rr=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function nr(e){return e.match(rr)?e.replace(rr,(function(e){return tr(e)})):e}var ir,or;(or=ir||(ir={})).inMemory="inmemory",or.vscode="vscode",or.internal="private",or.walkThrough="walkThrough",or.walkThroughSnippet="walkThroughSnippet",or.http="http",or.https="https",or.file="file",or.mailto="mailto",or.untitled="untitled",or.data="data",or.command="command",or.vscodeRemote="vscode-remote",or.vscodeRemoteResource="vscode-remote-resource",or.userData="vscode-userdata",or.vscodeCustomEditor="vscode-custom-editor",or.vscodeNotebook="vscode-notebook",or.vscodeNotebookCell="vscode-notebook-cell",or.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",or.vscodeNotebookCellOutput="vscode-notebook-cell-output",or.vscodeInteractive="vscode-interactive",or.vscodeInteractiveInput="vscode-interactive-input",or.vscodeSettings="vscode-settings",or.vscodeWorkspaceTrust="vscode-workspace-trust",or.vscodeTerminal="vscode-terminal",or.webviewPanel="webview-panel",or.vscodeWebview="vscode-webview",or.extension="extension",or.vscodeFileResource="vscode-file",or.tmp="tmp";var ar=new(function(){"use strict";function e(){(0,a.default)(this,e),this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null}return(0,s.default)(e,[{key:"setPreferredWebSchema",value:function(e){this._preferredWebSchema=e}},{key:"setDelegate",value:function(e){this._delegate=e}},{key:"set",value:function(e,t,r){this._hosts[e]=t,this._ports[e]=r}},{key:"setConnectionToken",value:function(e,t){this._connectionTokens[e]=t}},{key:"rewrite",value:function(e){if(this._delegate)return this._delegate(e);var t=e.authority,r=this._hosts[t];r&&-1!==r.indexOf(":")&&(r="[".concat(r,"]"));var n=this._ports[t],i=this._connectionTokens[t],o="path=".concat(encodeURIComponent(e.path));return"string"==typeof i&&(o+="&tkn=".concat(encodeURIComponent(i))),zt.from({scheme:we?this._preferredWebSchema:ir.vscodeRemoteResource,authority:"".concat(r,":").concat(n),path:"/vscode-remote-resource",query:o})}}]),e}());new(function(){"use strict";function e(){(0,a.default)(this,e),this.FALLBACK_AUTHORITY="vscode-app"}return(0,s.default)(e,[{key:"asBrowserUri",value:function(e,t,r){var n=this.toUri(e,t);if(n.scheme===ir.vscodeRemote)return ar.rewrite(n);var i=!1;return _e&&(r||de)&&n.scheme===ir.file&&(i=!0),n.scheme===ir.file&&"function"==typeof ie.importScripts&&"vscode-file://vscode-app"===ie.origin&&(i=!0),i?n.with({scheme:ir.vscodeFileResource,authority:n.authority||this.FALLBACK_AUTHORITY,query:null,fragment:null}):n}},{key:"asFileUri",value:function(e,t){var r=this.toUri(e,t);return r.scheme===ir.vscodeFileResource?r.with({scheme:ir.file,authority:r.authority!==this.FALLBACK_AUTHORITY?r.authority:null,query:null,fragment:null}):r}},{key:"toUri",value:function(e,t){return zt.isUri(e)?e:zt.parse(t.toUrl(e))}}]),e}());function sr(e){return Xt(e,!0)}var ur,lr,cr=function(){"use strict";function e(t){(0,a.default)(this,e),this._ignorePathCasing=t}return(0,s.default)(e,[{key:"compare",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e===t?0:ze(this.getComparisonKey(e,r),this.getComparisonKey(t,r))}},{key:"isEqual",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e===t||!(!e||!t)&&this.getComparisonKey(e,r)===this.getComparisonKey(t,r)}},{key:"getComparisonKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:t?null:void 0}).toString()}},{key:"ignorePathCasing",value:function(e){return this._ignorePathCasing(e)}},{key:"isEqualOrParent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.scheme===t.scheme){if(e.scheme===ir.file)return Lt(sr(e),sr(t),this._ignorePathCasing(e))&&e.query===t.query&&(r||e.fragment===t.fragment);if(hr(e.authority,t.authority))return Lt(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(r||e.fragment===t.fragment)}return!1}},{key:"joinPath",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i;return(i=zt).joinPath.apply(i,[e].concat((0,h.default)(r)))}},{key:"basenameOrAuthority",value:function(e){return fr(e)||e.authority}},{key:"basename",value:function(e){return Mt.basename(e.path)}},{key:"extname",value:function(e){return Mt.extname(e.path)}},{key:"dirname",value:function(e){return 0===e.path.length?e:(e.scheme===ir.file?t=zt.file(Rt(sr(e))).path:(t=Mt.dirname(e.path),e.authority&&t.length&&47!==t.charCodeAt(0)&&(console.error('dirname("'.concat(e.toString,")) resulted in a relative path")),t="/")),e.with({path:t}));var t}},{key:"normalizePath",value:function(e){return e.path.length?(t=e.scheme===ir.file?zt.file(Ct(sr(e))).path:Mt.normalize(e.path),e.with({path:t})):e;var t}},{key:"relativePath",value:function(e,t){if(e.scheme===t.scheme&&hr(e.authority,t.authority)){if(e.scheme===ir.file){var r=Tt(sr(e),sr(t));return me?At(r):r}var n=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){for(var o=0,a=Math.min(n.length,i.length);o<a&&(n.charCodeAt(o)===i.charCodeAt(o)||n.charAt(o).toLowerCase()===i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return Mt.relative(n,i)}}},{key:"resolvePath",value:function(e,t){if(e.scheme===ir.file){var r=zt.file(It(sr(e),t));return e.with({authority:r.authority,path:r.path})}return t=Dt(t),e.with({path:Mt.resolve(e.path,t)})}},{key:"isAbsolutePath",value:function(e){return!!e.path&&"/"===e.path[0]}},{key:"isEqualAuthority",value:function(e,t){return e===t||Je(e,t)}},{key:"hasTrailingPathSeparator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xt;if(e.scheme===ir.file){var r=sr(e);return r.length>Pt(r).length&&r[r.length-1]===t}var n=e.path;return n.length>1&&47===n.charCodeAt(n.length-1)&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}},{key:"removeTrailingPathSeparator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xt;return pr(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}},{key:"addTrailingPathSeparator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xt,r=!1;if(e.scheme===ir.file){var n=sr(e);r=void 0!==n&&n.length===Pt(n).length&&n[n.length-1]===t}else{t="/";var i=e.path;r=1===i.length&&47===i.charCodeAt(i.length-1)}return r||pr(e,t)?e:e.with({path:e.path+"/"})}}]),e}(),dr=new cr((function(){return!1})),fr=(new cr((function(e){return e.scheme!==ir.file||!be})),new cr((function(e){return!0})),dr.isEqual.bind(dr),dr.isEqualOrParent.bind(dr),dr.getComparisonKey.bind(dr),dr.basenameOrAuthority.bind(dr),dr.basename.bind(dr)),hr=(dr.extname.bind(dr),dr.dirname.bind(dr),dr.joinPath.bind(dr),dr.normalizePath.bind(dr),dr.relativePath.bind(dr),dr.resolvePath.bind(dr),dr.isAbsolutePath.bind(dr),dr.isEqualAuthority.bind(dr)),pr=dr.hasTrailingPathSeparator.bind(dr);dr.removeTrailingPathSeparator.bind(dr),dr.addTrailingPathSeparator.bind(dr);(lr=ur||(ur={})).META_DATA_LABEL="label",lr.META_DATA_DESCRIPTION="description",lr.META_DATA_SIZE="size",lr.META_DATA_MIME="mime",lr.parseMetaData=function(e){var t=new Map;e.path.substring(e.path.indexOf(";")+1,e.path.lastIndexOf(";")).split(";").forEach((function(e){var r=(0,f.default)(e.split(":"),2),n=r[0],i=r[1];n&&i&&t.set(n,i)}));var r=e.path.substring(0,e.path.indexOf(";"));return r&&t.set(lr.META_DATA_MIME,r),t};var vr;!function(){if("function"!=typeof requestIdleCallback||"function"!=typeof cancelIdleCallback){var e=Object.freeze({didTimeout:!0,timeRemaining:function(){return 15}});vr=function(t){var r=setTimeout((function(){return t(e)})),n=!1;return{dispose:function(){n||(n=!0,clearTimeout(r))}}}}else vr=function(e,t){var r=requestIdleCallback(e,"number"==typeof t?{timeout:t}:void 0),n=!1;return{dispose:function(){n||(n=!0,cancelIdleCallback(r))}}}}();var gr=function(){"use strict";function e(t){var r=this;(0,a.default)(this,e),this._didRun=!1,this._executor=function(){try{r._value=t()}catch(e){r._error=e}finally{r._didRun=!0}},this._handle=vr((function(){return r._executor()}))}return(0,s.default)(e,[{key:"dispose",value:function(){this._handle.dispose()}},{key:"value",get:function(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}}]),e}();var mr;!function(e){function t(){return(t=(0,o.default)((function(e){var t,r;return(0,m.__generator)(this,(function(n){switch(n.label){case 0:return t=void 0,[4,Promise.all(e.map((function(e){return e.then((function(e){return e}),(function(e){t||(t=e)}))})))];case 1:if(r=n.sent(),void 0!==t)throw t;return[2,r]}}))}))).apply(this,arguments)}e.settled=function(e){return t.apply(this,arguments)}}(mr||(mr={}));var yr,br;(br=yr||(yr={}))[br.Null=0]="Null",br[br.Backspace=8]="Backspace",br[br.Tab=9]="Tab",br[br.LineFeed=10]="LineFeed",br[br.CarriageReturn=13]="CarriageReturn",br[br.Space=32]="Space",br[br.ExclamationMark=33]="ExclamationMark",br[br.DoubleQuote=34]="DoubleQuote",br[br.Hash=35]="Hash",br[br.DollarSign=36]="DollarSign",br[br.PercentSign=37]="PercentSign",br[br.Ampersand=38]="Ampersand",br[br.SingleQuote=39]="SingleQuote",br[br.OpenParen=40]="OpenParen",br[br.CloseParen=41]="CloseParen",br[br.Asterisk=42]="Asterisk",br[br.Plus=43]="Plus",br[br.Comma=44]="Comma",br[br.Dash=45]="Dash",br[br.Period=46]="Period",br[br.Slash=47]="Slash",br[br.Digit0=48]="Digit0",br[br.Digit1=49]="Digit1",br[br.Digit2=50]="Digit2",br[br.Digit3=51]="Digit3",br[br.Digit4=52]="Digit4",br[br.Digit5=53]="Digit5",br[br.Digit6=54]="Digit6",br[br.Digit7=55]="Digit7",br[br.Digit8=56]="Digit8",br[br.Digit9=57]="Digit9",br[br.Colon=58]="Colon",br[br.Semicolon=59]="Semicolon",br[br.LessThan=60]="LessThan",br[br.Equals=61]="Equals",br[br.GreaterThan=62]="GreaterThan",br[br.QuestionMark=63]="QuestionMark",br[br.AtSign=64]="AtSign",br[br.A=65]="A",br[br.B=66]="B",br[br.C=67]="C",br[br.D=68]="D",br[br.E=69]="E",br[br.F=70]="F",br[br.G=71]="G",br[br.H=72]="H",br[br.I=73]="I",br[br.J=74]="J",br[br.K=75]="K",br[br.L=76]="L",br[br.M=77]="M",br[br.N=78]="N",br[br.O=79]="O",br[br.P=80]="P",br[br.Q=81]="Q",br[br.R=82]="R",br[br.S=83]="S",br[br.T=84]="T",br[br.U=85]="U",br[br.V=86]="V",br[br.W=87]="W",br[br.X=88]="X",br[br.Y=89]="Y",br[br.Z=90]="Z",br[br.OpenSquareBracket=91]="OpenSquareBracket",br[br.Backslash=92]="Backslash",br[br.CloseSquareBracket=93]="CloseSquareBracket",br[br.Caret=94]="Caret",br[br.Underline=95]="Underline",br[br.BackTick=96]="BackTick",br[br.a=97]="a",br[br.b=98]="b",br[br.c=99]="c",br[br.d=100]="d",br[br.e=101]="e",br[br.f=102]="f",br[br.g=103]="g",br[br.h=104]="h",br[br.i=105]="i",br[br.j=106]="j",br[br.k=107]="k",br[br.l=108]="l",br[br.m=109]="m",br[br.n=110]="n",br[br.o=111]="o",br[br.p=112]="p",br[br.q=113]="q",br[br.r=114]="r",br[br.s=115]="s",br[br.t=116]="t",br[br.u=117]="u",br[br.v=118]="v",br[br.w=119]="w",br[br.x=120]="x",br[br.y=121]="y",br[br.z=122]="z",br[br.OpenCurlyBrace=123]="OpenCurlyBrace",br[br.Pipe=124]="Pipe",br[br.CloseCurlyBrace=125]="CloseCurlyBrace",br[br.Tilde=126]="Tilde",br[br.U_Combining_Grave_Accent=768]="U_Combining_Grave_Accent",br[br.U_Combining_Acute_Accent=769]="U_Combining_Acute_Accent",br[br.U_Combining_Circumflex_Accent=770]="U_Combining_Circumflex_Accent",br[br.U_Combining_Tilde=771]="U_Combining_Tilde",br[br.U_Combining_Macron=772]="U_Combining_Macron",br[br.U_Combining_Overline=773]="U_Combining_Overline",br[br.U_Combining_Breve=774]="U_Combining_Breve",br[br.U_Combining_Dot_Above=775]="U_Combining_Dot_Above",br[br.U_Combining_Diaeresis=776]="U_Combining_Diaeresis",br[br.U_Combining_Hook_Above=777]="U_Combining_Hook_Above",br[br.U_Combining_Ring_Above=778]="U_Combining_Ring_Above",br[br.U_Combining_Double_Acute_Accent=779]="U_Combining_Double_Acute_Accent",br[br.U_Combining_Caron=780]="U_Combining_Caron",br[br.U_Combining_Vertical_Line_Above=781]="U_Combining_Vertical_Line_Above",br[br.U_Combining_Double_Vertical_Line_Above=782]="U_Combining_Double_Vertical_Line_Above",br[br.U_Combining_Double_Grave_Accent=783]="U_Combining_Double_Grave_Accent",br[br.U_Combining_Candrabindu=784]="U_Combining_Candrabindu",br[br.U_Combining_Inverted_Breve=785]="U_Combining_Inverted_Breve",br[br.U_Combining_Turned_Comma_Above=786]="U_Combining_Turned_Comma_Above",br[br.U_Combining_Comma_Above=787]="U_Combining_Comma_Above",br[br.U_Combining_Reversed_Comma_Above=788]="U_Combining_Reversed_Comma_Above",br[br.U_Combining_Comma_Above_Right=789]="U_Combining_Comma_Above_Right",br[br.U_Combining_Grave_Accent_Below=790]="U_Combining_Grave_Accent_Below",br[br.U_Combining_Acute_Accent_Below=791]="U_Combining_Acute_Accent_Below",br[br.U_Combining_Left_Tack_Below=792]="U_Combining_Left_Tack_Below",br[br.U_Combining_Right_Tack_Below=793]="U_Combining_Right_Tack_Below",br[br.U_Combining_Left_Angle_Above=794]="U_Combining_Left_Angle_Above",br[br.U_Combining_Horn=795]="U_Combining_Horn",br[br.U_Combining_Left_Half_Ring_Below=796]="U_Combining_Left_Half_Ring_Below",br[br.U_Combining_Up_Tack_Below=797]="U_Combining_Up_Tack_Below",br[br.U_Combining_Down_Tack_Below=798]="U_Combining_Down_Tack_Below",br[br.U_Combining_Plus_Sign_Below=799]="U_Combining_Plus_Sign_Below",br[br.U_Combining_Minus_Sign_Below=800]="U_Combining_Minus_Sign_Below",br[br.U_Combining_Palatalized_Hook_Below=801]="U_Combining_Palatalized_Hook_Below",br[br.U_Combining_Retroflex_Hook_Below=802]="U_Combining_Retroflex_Hook_Below",br[br.U_Combining_Dot_Below=803]="U_Combining_Dot_Below",br[br.U_Combining_Diaeresis_Below=804]="U_Combining_Diaeresis_Below",br[br.U_Combining_Ring_Below=805]="U_Combining_Ring_Below",br[br.U_Combining_Comma_Below=806]="U_Combining_Comma_Below",br[br.U_Combining_Cedilla=807]="U_Combining_Cedilla",br[br.U_Combining_Ogonek=808]="U_Combining_Ogonek",br[br.U_Combining_Vertical_Line_Below=809]="U_Combining_Vertical_Line_Below",br[br.U_Combining_Bridge_Below=810]="U_Combining_Bridge_Below",br[br.U_Combining_Inverted_Double_Arch_Below=811]="U_Combining_Inverted_Double_Arch_Below",br[br.U_Combining_Caron_Below=812]="U_Combining_Caron_Below",br[br.U_Combining_Circumflex_Accent_Below=813]="U_Combining_Circumflex_Accent_Below",br[br.U_Combining_Breve_Below=814]="U_Combining_Breve_Below",br[br.U_Combining_Inverted_Breve_Below=815]="U_Combining_Inverted_Breve_Below",br[br.U_Combining_Tilde_Below=816]="U_Combining_Tilde_Below",br[br.U_Combining_Macron_Below=817]="U_Combining_Macron_Below",br[br.U_Combining_Low_Line=818]="U_Combining_Low_Line",br[br.U_Combining_Double_Low_Line=819]="U_Combining_Double_Low_Line",br[br.U_Combining_Tilde_Overlay=820]="U_Combining_Tilde_Overlay",br[br.U_Combining_Short_Stroke_Overlay=821]="U_Combining_Short_Stroke_Overlay",br[br.U_Combining_Long_Stroke_Overlay=822]="U_Combining_Long_Stroke_Overlay",br[br.U_Combining_Short_Solidus_Overlay=823]="U_Combining_Short_Solidus_Overlay",br[br.U_Combining_Long_Solidus_Overlay=824]="U_Combining_Long_Solidus_Overlay",br[br.U_Combining_Right_Half_Ring_Below=825]="U_Combining_Right_Half_Ring_Below",br[br.U_Combining_Inverted_Bridge_Below=826]="U_Combining_Inverted_Bridge_Below",br[br.U_Combining_Square_Below=827]="U_Combining_Square_Below",br[br.U_Combining_Seagull_Below=828]="U_Combining_Seagull_Below",br[br.U_Combining_X_Above=829]="U_Combining_X_Above",br[br.U_Combining_Vertical_Tilde=830]="U_Combining_Vertical_Tilde",br[br.U_Combining_Double_Overline=831]="U_Combining_Double_Overline",br[br.U_Combining_Grave_Tone_Mark=832]="U_Combining_Grave_Tone_Mark",br[br.U_Combining_Acute_Tone_Mark=833]="U_Combining_Acute_Tone_Mark",br[br.U_Combining_Greek_Perispomeni=834]="U_Combining_Greek_Perispomeni",br[br.U_Combining_Greek_Koronis=835]="U_Combining_Greek_Koronis",br[br.U_Combining_Greek_Dialytika_Tonos=836]="U_Combining_Greek_Dialytika_Tonos",br[br.U_Combining_Greek_Ypogegrammeni=837]="U_Combining_Greek_Ypogegrammeni",br[br.U_Combining_Bridge_Above=838]="U_Combining_Bridge_Above",br[br.U_Combining_Equals_Sign_Below=839]="U_Combining_Equals_Sign_Below",br[br.U_Combining_Double_Vertical_Line_Below=840]="U_Combining_Double_Vertical_Line_Below",br[br.U_Combining_Left_Angle_Below=841]="U_Combining_Left_Angle_Below",br[br.U_Combining_Not_Tilde_Above=842]="U_Combining_Not_Tilde_Above",br[br.U_Combining_Homothetic_Above=843]="U_Combining_Homothetic_Above",br[br.U_Combining_Almost_Equal_To_Above=844]="U_Combining_Almost_Equal_To_Above",br[br.U_Combining_Left_Right_Arrow_Below=845]="U_Combining_Left_Right_Arrow_Below",br[br.U_Combining_Upwards_Arrow_Below=846]="U_Combining_Upwards_Arrow_Below",br[br.U_Combining_Grapheme_Joiner=847]="U_Combining_Grapheme_Joiner",br[br.U_Combining_Right_Arrowhead_Above=848]="U_Combining_Right_Arrowhead_Above",br[br.U_Combining_Left_Half_Ring_Above=849]="U_Combining_Left_Half_Ring_Above",br[br.U_Combining_Fermata=850]="U_Combining_Fermata",br[br.U_Combining_X_Below=851]="U_Combining_X_Below",br[br.U_Combining_Left_Arrowhead_Below=852]="U_Combining_Left_Arrowhead_Below",br[br.U_Combining_Right_Arrowhead_Below=853]="U_Combining_Right_Arrowhead_Below",br[br.U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below=854]="U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below",br[br.U_Combining_Right_Half_Ring_Above=855]="U_Combining_Right_Half_Ring_Above",br[br.U_Combining_Dot_Above_Right=856]="U_Combining_Dot_Above_Right",br[br.U_Combining_Asterisk_Below=857]="U_Combining_Asterisk_Below",br[br.U_Combining_Double_Ring_Below=858]="U_Combining_Double_Ring_Below",br[br.U_Combining_Zigzag_Above=859]="U_Combining_Zigzag_Above",br[br.U_Combining_Double_Breve_Below=860]="U_Combining_Double_Breve_Below",br[br.U_Combining_Double_Breve=861]="U_Combining_Double_Breve",br[br.U_Combining_Double_Macron=862]="U_Combining_Double_Macron",br[br.U_Combining_Double_Macron_Below=863]="U_Combining_Double_Macron_Below",br[br.U_Combining_Double_Tilde=864]="U_Combining_Double_Tilde",br[br.U_Combining_Double_Inverted_Breve=865]="U_Combining_Double_Inverted_Breve",br[br.U_Combining_Double_Rightwards_Arrow_Below=866]="U_Combining_Double_Rightwards_Arrow_Below",br[br.U_Combining_Latin_Small_Letter_A=867]="U_Combining_Latin_Small_Letter_A",br[br.U_Combining_Latin_Small_Letter_E=868]="U_Combining_Latin_Small_Letter_E",br[br.U_Combining_Latin_Small_Letter_I=869]="U_Combining_Latin_Small_Letter_I",br[br.U_Combining_Latin_Small_Letter_O=870]="U_Combining_Latin_Small_Letter_O",br[br.U_Combining_Latin_Small_Letter_U=871]="U_Combining_Latin_Small_Letter_U",br[br.U_Combining_Latin_Small_Letter_C=872]="U_Combining_Latin_Small_Letter_C",br[br.U_Combining_Latin_Small_Letter_D=873]="U_Combining_Latin_Small_Letter_D",br[br.U_Combining_Latin_Small_Letter_H=874]="U_Combining_Latin_Small_Letter_H",br[br.U_Combining_Latin_Small_Letter_M=875]="U_Combining_Latin_Small_Letter_M",br[br.U_Combining_Latin_Small_Letter_R=876]="U_Combining_Latin_Small_Letter_R",br[br.U_Combining_Latin_Small_Letter_T=877]="U_Combining_Latin_Small_Letter_T",br[br.U_Combining_Latin_Small_Letter_V=878]="U_Combining_Latin_Small_Letter_V",br[br.U_Combining_Latin_Small_Letter_X=879]="U_Combining_Latin_Small_Letter_X",br[br.LINE_SEPARATOR=8232]="LINE_SEPARATOR",br[br.PARAGRAPH_SEPARATOR=8233]="PARAGRAPH_SEPARATOR",br[br.NEXT_LINE=133]="NEXT_LINE",br[br.U_CIRCUMFLEX=94]="U_CIRCUMFLEX",br[br.U_GRAVE_ACCENT=96]="U_GRAVE_ACCENT",br[br.U_DIAERESIS=168]="U_DIAERESIS",br[br.U_MACRON=175]="U_MACRON",br[br.U_ACUTE_ACCENT=180]="U_ACUTE_ACCENT",br[br.U_CEDILLA=184]="U_CEDILLA",br[br.U_MODIFIER_LETTER_LEFT_ARROWHEAD=706]="U_MODIFIER_LETTER_LEFT_ARROWHEAD",br[br.U_MODIFIER_LETTER_RIGHT_ARROWHEAD=707]="U_MODIFIER_LETTER_RIGHT_ARROWHEAD",br[br.U_MODIFIER_LETTER_UP_ARROWHEAD=708]="U_MODIFIER_LETTER_UP_ARROWHEAD",br[br.U_MODIFIER_LETTER_DOWN_ARROWHEAD=709]="U_MODIFIER_LETTER_DOWN_ARROWHEAD",br[br.U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING=722]="U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING",br[br.U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING=723]="U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING",br[br.U_MODIFIER_LETTER_UP_TACK=724]="U_MODIFIER_LETTER_UP_TACK",br[br.U_MODIFIER_LETTER_DOWN_TACK=725]="U_MODIFIER_LETTER_DOWN_TACK",br[br.U_MODIFIER_LETTER_PLUS_SIGN=726]="U_MODIFIER_LETTER_PLUS_SIGN",br[br.U_MODIFIER_LETTER_MINUS_SIGN=727]="U_MODIFIER_LETTER_MINUS_SIGN",br[br.U_BREVE=728]="U_BREVE",br[br.U_DOT_ABOVE=729]="U_DOT_ABOVE",br[br.U_RING_ABOVE=730]="U_RING_ABOVE",br[br.U_OGONEK=731]="U_OGONEK",br[br.U_SMALL_TILDE=732]="U_SMALL_TILDE",br[br.U_DOUBLE_ACUTE_ACCENT=733]="U_DOUBLE_ACUTE_ACCENT",br[br.U_MODIFIER_LETTER_RHOTIC_HOOK=734]="U_MODIFIER_LETTER_RHOTIC_HOOK",br[br.U_MODIFIER_LETTER_CROSS_ACCENT=735]="U_MODIFIER_LETTER_CROSS_ACCENT",br[br.U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR=741]="U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR",br[br.U_MODIFIER_LETTER_HIGH_TONE_BAR=742]="U_MODIFIER_LETTER_HIGH_TONE_BAR",br[br.U_MODIFIER_LETTER_MID_TONE_BAR=743]="U_MODIFIER_LETTER_MID_TONE_BAR",br[br.U_MODIFIER_LETTER_LOW_TONE_BAR=744]="U_MODIFIER_LETTER_LOW_TONE_BAR",br[br.U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR=745]="U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR",br[br.U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK=746]="U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK",br[br.U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK=747]="U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK",br[br.U_MODIFIER_LETTER_UNASPIRATED=749]="U_MODIFIER_LETTER_UNASPIRATED",br[br.U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD=751]="U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD",br[br.U_MODIFIER_LETTER_LOW_UP_ARROWHEAD=752]="U_MODIFIER_LETTER_LOW_UP_ARROWHEAD",br[br.U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD=753]="U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD",br[br.U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD=754]="U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD",br[br.U_MODIFIER_LETTER_LOW_RING=755]="U_MODIFIER_LETTER_LOW_RING",br[br.U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT=756]="U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT",br[br.U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT=757]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT",br[br.U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT=758]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT",br[br.U_MODIFIER_LETTER_LOW_TILDE=759]="U_MODIFIER_LETTER_LOW_TILDE",br[br.U_MODIFIER_LETTER_RAISED_COLON=760]="U_MODIFIER_LETTER_RAISED_COLON",br[br.U_MODIFIER_LETTER_BEGIN_HIGH_TONE=761]="U_MODIFIER_LETTER_BEGIN_HIGH_TONE",br[br.U_MODIFIER_LETTER_END_HIGH_TONE=762]="U_MODIFIER_LETTER_END_HIGH_TONE",br[br.U_MODIFIER_LETTER_BEGIN_LOW_TONE=763]="U_MODIFIER_LETTER_BEGIN_LOW_TONE",br[br.U_MODIFIER_LETTER_END_LOW_TONE=764]="U_MODIFIER_LETTER_END_LOW_TONE",br[br.U_MODIFIER_LETTER_SHELF=765]="U_MODIFIER_LETTER_SHELF",br[br.U_MODIFIER_LETTER_OPEN_SHELF=766]="U_MODIFIER_LETTER_OPEN_SHELF",br[br.U_MODIFIER_LETTER_LOW_LEFT_ARROW=767]="U_MODIFIER_LETTER_LOW_LEFT_ARROW",br[br.U_GREEK_LOWER_NUMERAL_SIGN=885]="U_GREEK_LOWER_NUMERAL_SIGN",br[br.U_GREEK_TONOS=900]="U_GREEK_TONOS",br[br.U_GREEK_DIALYTIKA_TONOS=901]="U_GREEK_DIALYTIKA_TONOS",br[br.U_GREEK_KORONIS=8125]="U_GREEK_KORONIS",br[br.U_GREEK_PSILI=8127]="U_GREEK_PSILI",br[br.U_GREEK_PERISPOMENI=8128]="U_GREEK_PERISPOMENI",br[br.U_GREEK_DIALYTIKA_AND_PERISPOMENI=8129]="U_GREEK_DIALYTIKA_AND_PERISPOMENI",br[br.U_GREEK_PSILI_AND_VARIA=8141]="U_GREEK_PSILI_AND_VARIA",br[br.U_GREEK_PSILI_AND_OXIA=8142]="U_GREEK_PSILI_AND_OXIA",br[br.U_GREEK_PSILI_AND_PERISPOMENI=8143]="U_GREEK_PSILI_AND_PERISPOMENI",br[br.U_GREEK_DASIA_AND_VARIA=8157]="U_GREEK_DASIA_AND_VARIA",br[br.U_GREEK_DASIA_AND_OXIA=8158]="U_GREEK_DASIA_AND_OXIA",br[br.U_GREEK_DASIA_AND_PERISPOMENI=8159]="U_GREEK_DASIA_AND_PERISPOMENI",br[br.U_GREEK_DIALYTIKA_AND_VARIA=8173]="U_GREEK_DIALYTIKA_AND_VARIA",br[br.U_GREEK_DIALYTIKA_AND_OXIA=8174]="U_GREEK_DIALYTIKA_AND_OXIA",br[br.U_GREEK_VARIA=8175]="U_GREEK_VARIA",br[br.U_GREEK_OXIA=8189]="U_GREEK_OXIA",br[br.U_GREEK_DASIA=8190]="U_GREEK_DASIA",br[br.U_OVERLINE=8254]="U_OVERLINE",br[br.UTF8_BOM=65279]="UTF8_BOM";var _r=new(function(){"use strict";function e(){(0,a.default)(this,e),this._icons=new Map,this._onDidRegister=new Ae}return(0,s.default)(e,[{key:"add",value:function(e){var t=this._icons.get(e.id);t?e.description?t.description=e.description:console.error("Duplicate registration of codicon ".concat(e.id)):(this._icons.set(e.id,e),this._onDidRegister.fire(e))}},{key:"get",value:function(e){return this._icons.get(e)}},{key:"all",get:function(){return this._icons.values()}},{key:"onDidRegister",get:function(){return this._onDidRegister.event}}]),e}());var wr,Sr,Er=function(){"use strict";function e(t,r,n){(0,a.default)(this,e),this.id=t,this.definition=r,this.description=n,_r.add(this)}return(0,s.default)(e,[{key:"classNames",get:function(){return"codicon codicon-"+this.id}},{key:"classNamesArray",get:function(){return["codicon","codicon-"+this.id]}},{key:"cssSelector",get:function(){return".codicon.codicon-"+this.id}}]),e}();!function(e){e.iconNameSegment="[A-Za-z0-9]+",e.iconNameExpression="[A-Za-z0-9\\-]+",e.iconModifierExpression="~[A-Za-z]+";var t=new RegExp("^(".concat(e.iconNameExpression,")(").concat(e.iconModifierExpression,")?$"));function r(e){if(e instanceof Er)return["codicon","codicon-"+e.id];var n=t.exec(e.id);if(!n)return r(Er.error);var i=(0,f.default)(n,3),o=i[1],a=i[2],s=["codicon","codicon-"+o];return a&&s.push("codicon-modifier-"+a.substr(1)),s}e.asClassNameArray=r,e.asClassName=function(e){return r(e).join(" ")},e.asCSSSelector=function(e){return"."+r(e).join(".")}}(wr||(wr={})),(Sr=Er||(Er={})).add=new Sr("add",{fontCharacter:"\\ea60"}),Sr.plus=new Sr("plus",{fontCharacter:"\\ea60"}),Sr.gistNew=new Sr("gist-new",{fontCharacter:"\\ea60"}),Sr.repoCreate=new Sr("repo-create",{fontCharacter:"\\ea60"}),Sr.lightbulb=new Sr("lightbulb",{fontCharacter:"\\ea61"}),Sr.lightBulb=new Sr("light-bulb",{fontCharacter:"\\ea61"}),Sr.repo=new Sr("repo",{fontCharacter:"\\ea62"}),Sr.repoDelete=new Sr("repo-delete",{fontCharacter:"\\ea62"}),Sr.gistFork=new Sr("gist-fork",{fontCharacter:"\\ea63"}),Sr.repoForked=new Sr("repo-forked",{fontCharacter:"\\ea63"}),Sr.gitPullRequest=new Sr("git-pull-request",{fontCharacter:"\\ea64"}),Sr.gitPullRequestAbandoned=new Sr("git-pull-request-abandoned",{fontCharacter:"\\ea64"}),Sr.recordKeys=new Sr("record-keys",{fontCharacter:"\\ea65"}),Sr.keyboard=new Sr("keyboard",{fontCharacter:"\\ea65"}),Sr.tag=new Sr("tag",{fontCharacter:"\\ea66"}),Sr.tagAdd=new Sr("tag-add",{fontCharacter:"\\ea66"}),Sr.tagRemove=new Sr("tag-remove",{fontCharacter:"\\ea66"}),Sr.person=new Sr("person",{fontCharacter:"\\ea67"}),Sr.personFollow=new Sr("person-follow",{fontCharacter:"\\ea67"}),Sr.personOutline=new Sr("person-outline",{fontCharacter:"\\ea67"}),Sr.personFilled=new Sr("person-filled",{fontCharacter:"\\ea67"}),Sr.gitBranch=new Sr("git-branch",{fontCharacter:"\\ea68"}),Sr.gitBranchCreate=new Sr("git-branch-create",{fontCharacter:"\\ea68"}),Sr.gitBranchDelete=new Sr("git-branch-delete",{fontCharacter:"\\ea68"}),Sr.sourceControl=new Sr("source-control",{fontCharacter:"\\ea68"}),Sr.mirror=new Sr("mirror",{fontCharacter:"\\ea69"}),Sr.mirrorPublic=new Sr("mirror-public",{fontCharacter:"\\ea69"}),Sr.star=new Sr("star",{fontCharacter:"\\ea6a"}),Sr.starAdd=new Sr("star-add",{fontCharacter:"\\ea6a"}),Sr.starDelete=new Sr("star-delete",{fontCharacter:"\\ea6a"}),Sr.starEmpty=new Sr("star-empty",{fontCharacter:"\\ea6a"}),Sr.comment=new Sr("comment",{fontCharacter:"\\ea6b"}),Sr.commentAdd=new Sr("comment-add",{fontCharacter:"\\ea6b"}),Sr.alert=new Sr("alert",{fontCharacter:"\\ea6c"}),Sr.warning=new Sr("warning",{fontCharacter:"\\ea6c"}),Sr.search=new Sr("search",{fontCharacter:"\\ea6d"}),Sr.searchSave=new Sr("search-save",{fontCharacter:"\\ea6d"}),Sr.logOut=new Sr("log-out",{fontCharacter:"\\ea6e"}),Sr.signOut=new Sr("sign-out",{fontCharacter:"\\ea6e"}),Sr.logIn=new Sr("log-in",{fontCharacter:"\\ea6f"}),Sr.signIn=new Sr("sign-in",{fontCharacter:"\\ea6f"}),Sr.eye=new Sr("eye",{fontCharacter:"\\ea70"}),Sr.eyeUnwatch=new Sr("eye-unwatch",{fontCharacter:"\\ea70"}),Sr.eyeWatch=new Sr("eye-watch",{fontCharacter:"\\ea70"}),Sr.circleFilled=new Sr("circle-filled",{fontCharacter:"\\ea71"}),Sr.primitiveDot=new Sr("primitive-dot",{fontCharacter:"\\ea71"}),Sr.closeDirty=new Sr("close-dirty",{fontCharacter:"\\ea71"}),Sr.debugBreakpoint=new Sr("debug-breakpoint",{fontCharacter:"\\ea71"}),Sr.debugBreakpointDisabled=new Sr("debug-breakpoint-disabled",{fontCharacter:"\\ea71"}),Sr.debugHint=new Sr("debug-hint",{fontCharacter:"\\ea71"}),Sr.primitiveSquare=new Sr("primitive-square",{fontCharacter:"\\ea72"}),Sr.edit=new Sr("edit",{fontCharacter:"\\ea73"}),Sr.pencil=new Sr("pencil",{fontCharacter:"\\ea73"}),Sr.info=new Sr("info",{fontCharacter:"\\ea74"}),Sr.issueOpened=new Sr("issue-opened",{fontCharacter:"\\ea74"}),Sr.gistPrivate=new Sr("gist-private",{fontCharacter:"\\ea75"}),Sr.gitForkPrivate=new Sr("git-fork-private",{fontCharacter:"\\ea75"}),Sr.lock=new Sr("lock",{fontCharacter:"\\ea75"}),Sr.mirrorPrivate=new Sr("mirror-private",{fontCharacter:"\\ea75"}),Sr.close=new Sr("close",{fontCharacter:"\\ea76"}),Sr.removeClose=new Sr("remove-close",{fontCharacter:"\\ea76"}),Sr.x=new Sr("x",{fontCharacter:"\\ea76"}),Sr.repoSync=new Sr("repo-sync",{fontCharacter:"\\ea77"}),Sr.sync=new Sr("sync",{fontCharacter:"\\ea77"}),Sr.clone=new Sr("clone",{fontCharacter:"\\ea78"}),Sr.desktopDownload=new Sr("desktop-download",{fontCharacter:"\\ea78"}),Sr.beaker=new Sr("beaker",{fontCharacter:"\\ea79"}),Sr.microscope=new Sr("microscope",{fontCharacter:"\\ea79"}),Sr.vm=new Sr("vm",{fontCharacter:"\\ea7a"}),Sr.deviceDesktop=new Sr("device-desktop",{fontCharacter:"\\ea7a"}),Sr.file=new Sr("file",{fontCharacter:"\\ea7b"}),Sr.fileText=new Sr("file-text",{fontCharacter:"\\ea7b"}),Sr.more=new Sr("more",{fontCharacter:"\\ea7c"}),Sr.ellipsis=new Sr("ellipsis",{fontCharacter:"\\ea7c"}),Sr.kebabHorizontal=new Sr("kebab-horizontal",{fontCharacter:"\\ea7c"}),Sr.mailReply=new Sr("mail-reply",{fontCharacter:"\\ea7d"}),Sr.reply=new Sr("reply",{fontCharacter:"\\ea7d"}),Sr.organization=new Sr("organization",{fontCharacter:"\\ea7e"}),Sr.organizationFilled=new Sr("organization-filled",{fontCharacter:"\\ea7e"}),Sr.organizationOutline=new Sr("organization-outline",{fontCharacter:"\\ea7e"}),Sr.newFile=new Sr("new-file",{fontCharacter:"\\ea7f"}),Sr.fileAdd=new Sr("file-add",{fontCharacter:"\\ea7f"}),Sr.newFolder=new Sr("new-folder",{fontCharacter:"\\ea80"}),Sr.fileDirectoryCreate=new Sr("file-directory-create",{fontCharacter:"\\ea80"}),Sr.trash=new Sr("trash",{fontCharacter:"\\ea81"}),Sr.trashcan=new Sr("trashcan",{fontCharacter:"\\ea81"}),Sr.history=new Sr("history",{fontCharacter:"\\ea82"}),Sr.clock=new Sr("clock",{fontCharacter:"\\ea82"}),Sr.folder=new Sr("folder",{fontCharacter:"\\ea83"}),Sr.fileDirectory=new Sr("file-directory",{fontCharacter:"\\ea83"}),Sr.symbolFolder=new Sr("symbol-folder",{fontCharacter:"\\ea83"}),Sr.logoGithub=new Sr("logo-github",{fontCharacter:"\\ea84"}),Sr.markGithub=new Sr("mark-github",{fontCharacter:"\\ea84"}),Sr.github=new Sr("github",{fontCharacter:"\\ea84"}),Sr.terminal=new Sr("terminal",{fontCharacter:"\\ea85"}),Sr.console=new Sr("console",{fontCharacter:"\\ea85"}),Sr.repl=new Sr("repl",{fontCharacter:"\\ea85"}),Sr.zap=new Sr("zap",{fontCharacter:"\\ea86"}),Sr.symbolEvent=new Sr("symbol-event",{fontCharacter:"\\ea86"}),Sr.error=new Sr("error",{fontCharacter:"\\ea87"}),Sr.stop=new Sr("stop",{fontCharacter:"\\ea87"}),Sr.variable=new Sr("variable",{fontCharacter:"\\ea88"}),Sr.symbolVariable=new Sr("symbol-variable",{fontCharacter:"\\ea88"}),Sr.array=new Sr("array",{fontCharacter:"\\ea8a"}),Sr.symbolArray=new Sr("symbol-array",{fontCharacter:"\\ea8a"}),Sr.symbolModule=new Sr("symbol-module",{fontCharacter:"\\ea8b"}),Sr.symbolPackage=new Sr("symbol-package",{fontCharacter:"\\ea8b"}),Sr.symbolNamespace=new Sr("symbol-namespace",{fontCharacter:"\\ea8b"}),Sr.symbolObject=new Sr("symbol-object",{fontCharacter:"\\ea8b"}),Sr.symbolMethod=new Sr("symbol-method",{fontCharacter:"\\ea8c"}),Sr.symbolFunction=new Sr("symbol-function",{fontCharacter:"\\ea8c"}),Sr.symbolConstructor=new Sr("symbol-constructor",{fontCharacter:"\\ea8c"}),Sr.symbolBoolean=new Sr("symbol-boolean",{fontCharacter:"\\ea8f"}),Sr.symbolNull=new Sr("symbol-null",{fontCharacter:"\\ea8f"}),Sr.symbolNumeric=new Sr("symbol-numeric",{fontCharacter:"\\ea90"}),Sr.symbolNumber=new Sr("symbol-number",{fontCharacter:"\\ea90"}),Sr.symbolStructure=new Sr("symbol-structure",{fontCharacter:"\\ea91"}),Sr.symbolStruct=new Sr("symbol-struct",{fontCharacter:"\\ea91"}),Sr.symbolParameter=new Sr("symbol-parameter",{fontCharacter:"\\ea92"}),Sr.symbolTypeParameter=new Sr("symbol-type-parameter",{fontCharacter:"\\ea92"}),Sr.symbolKey=new Sr("symbol-key",{fontCharacter:"\\ea93"}),Sr.symbolText=new Sr("symbol-text",{fontCharacter:"\\ea93"}),Sr.symbolReference=new Sr("symbol-reference",{fontCharacter:"\\ea94"}),Sr.goToFile=new Sr("go-to-file",{fontCharacter:"\\ea94"}),Sr.symbolEnum=new Sr("symbol-enum",{fontCharacter:"\\ea95"}),Sr.symbolValue=new Sr("symbol-value",{fontCharacter:"\\ea95"}),Sr.symbolRuler=new Sr("symbol-ruler",{fontCharacter:"\\ea96"}),Sr.symbolUnit=new Sr("symbol-unit",{fontCharacter:"\\ea96"}),Sr.activateBreakpoints=new Sr("activate-breakpoints",{fontCharacter:"\\ea97"}),Sr.archive=new Sr("archive",{fontCharacter:"\\ea98"}),Sr.arrowBoth=new Sr("arrow-both",{fontCharacter:"\\ea99"}),Sr.arrowDown=new Sr("arrow-down",{fontCharacter:"\\ea9a"}),Sr.arrowLeft=new Sr("arrow-left",{fontCharacter:"\\ea9b"}),Sr.arrowRight=new Sr("arrow-right",{fontCharacter:"\\ea9c"}),Sr.arrowSmallDown=new Sr("arrow-small-down",{fontCharacter:"\\ea9d"}),Sr.arrowSmallLeft=new Sr("arrow-small-left",{fontCharacter:"\\ea9e"}),Sr.arrowSmallRight=new Sr("arrow-small-right",{fontCharacter:"\\ea9f"}),Sr.arrowSmallUp=new Sr("arrow-small-up",{fontCharacter:"\\eaa0"}),Sr.arrowUp=new Sr("arrow-up",{fontCharacter:"\\eaa1"}),Sr.bell=new Sr("bell",{fontCharacter:"\\eaa2"}),Sr.bold=new Sr("bold",{fontCharacter:"\\eaa3"}),Sr.book=new Sr("book",{fontCharacter:"\\eaa4"}),Sr.bookmark=new Sr("bookmark",{fontCharacter:"\\eaa5"}),Sr.debugBreakpointConditionalUnverified=new Sr("debug-breakpoint-conditional-unverified",{fontCharacter:"\\eaa6"}),Sr.debugBreakpointConditional=new Sr("debug-breakpoint-conditional",{fontCharacter:"\\eaa7"}),Sr.debugBreakpointConditionalDisabled=new Sr("debug-breakpoint-conditional-disabled",{fontCharacter:"\\eaa7"}),Sr.debugBreakpointDataUnverified=new Sr("debug-breakpoint-data-unverified",{fontCharacter:"\\eaa8"}),Sr.debugBreakpointData=new Sr("debug-breakpoint-data",{fontCharacter:"\\eaa9"}),Sr.debugBreakpointDataDisabled=new Sr("debug-breakpoint-data-disabled",{fontCharacter:"\\eaa9"}),Sr.debugBreakpointLogUnverified=new Sr("debug-breakpoint-log-unverified",{fontCharacter:"\\eaaa"}),Sr.debugBreakpointLog=new Sr("debug-breakpoint-log",{fontCharacter:"\\eaab"}),Sr.debugBreakpointLogDisabled=new Sr("debug-breakpoint-log-disabled",{fontCharacter:"\\eaab"}),Sr.briefcase=new Sr("briefcase",{fontCharacter:"\\eaac"}),Sr.broadcast=new Sr("broadcast",{fontCharacter:"\\eaad"}),Sr.browser=new Sr("browser",{fontCharacter:"\\eaae"}),Sr.bug=new Sr("bug",{fontCharacter:"\\eaaf"}),Sr.calendar=new Sr("calendar",{fontCharacter:"\\eab0"}),Sr.caseSensitive=new Sr("case-sensitive",{fontCharacter:"\\eab1"}),Sr.check=new Sr("check",{fontCharacter:"\\eab2"}),Sr.checklist=new Sr("checklist",{fontCharacter:"\\eab3"}),Sr.chevronDown=new Sr("chevron-down",{fontCharacter:"\\eab4"}),Sr.chevronLeft=new Sr("chevron-left",{fontCharacter:"\\eab5"}),Sr.chevronRight=new Sr("chevron-right",{fontCharacter:"\\eab6"}),Sr.chevronUp=new Sr("chevron-up",{fontCharacter:"\\eab7"}),Sr.chromeClose=new Sr("chrome-close",{fontCharacter:"\\eab8"}),Sr.chromeMaximize=new Sr("chrome-maximize",{fontCharacter:"\\eab9"}),Sr.chromeMinimize=new Sr("chrome-minimize",{fontCharacter:"\\eaba"}),Sr.chromeRestore=new Sr("chrome-restore",{fontCharacter:"\\eabb"}),Sr.circleOutline=new Sr("circle-outline",{fontCharacter:"\\eabc"}),Sr.debugBreakpointUnverified=new Sr("debug-breakpoint-unverified",{fontCharacter:"\\eabc"}),Sr.circleSlash=new Sr("circle-slash",{fontCharacter:"\\eabd"}),Sr.circuitBoard=new Sr("circuit-board",{fontCharacter:"\\eabe"}),Sr.clearAll=new Sr("clear-all",{fontCharacter:"\\eabf"}),Sr.clippy=new Sr("clippy",{fontCharacter:"\\eac0"}),Sr.closeAll=new Sr("close-all",{fontCharacter:"\\eac1"}),Sr.cloudDownload=new Sr("cloud-download",{fontCharacter:"\\eac2"}),Sr.cloudUpload=new Sr("cloud-upload",{fontCharacter:"\\eac3"}),Sr.code=new Sr("code",{fontCharacter:"\\eac4"}),Sr.collapseAll=new Sr("collapse-all",{fontCharacter:"\\eac5"}),Sr.colorMode=new Sr("color-mode",{fontCharacter:"\\eac6"}),Sr.commentDiscussion=new Sr("comment-discussion",{fontCharacter:"\\eac7"}),Sr.compareChanges=new Sr("compare-changes",{fontCharacter:"\\eafd"}),Sr.creditCard=new Sr("credit-card",{fontCharacter:"\\eac9"}),Sr.dash=new Sr("dash",{fontCharacter:"\\eacc"}),Sr.dashboard=new Sr("dashboard",{fontCharacter:"\\eacd"}),Sr.database=new Sr("database",{fontCharacter:"\\eace"}),Sr.debugContinue=new Sr("debug-continue",{fontCharacter:"\\eacf"}),Sr.debugDisconnect=new Sr("debug-disconnect",{fontCharacter:"\\ead0"}),Sr.debugPause=new Sr("debug-pause",{fontCharacter:"\\ead1"}),Sr.debugRestart=new Sr("debug-restart",{fontCharacter:"\\ead2"}),Sr.debugStart=new Sr("debug-start",{fontCharacter:"\\ead3"}),Sr.debugStepInto=new Sr("debug-step-into",{fontCharacter:"\\ead4"}),Sr.debugStepOut=new Sr("debug-step-out",{fontCharacter:"\\ead5"}),Sr.debugStepOver=new Sr("debug-step-over",{fontCharacter:"\\ead6"}),Sr.debugStop=new Sr("debug-stop",{fontCharacter:"\\ead7"}),Sr.debug=new Sr("debug",{fontCharacter:"\\ead8"}),Sr.deviceCameraVideo=new Sr("device-camera-video",{fontCharacter:"\\ead9"}),Sr.deviceCamera=new Sr("device-camera",{fontCharacter:"\\eada"}),Sr.deviceMobile=new Sr("device-mobile",{fontCharacter:"\\eadb"}),Sr.diffAdded=new Sr("diff-added",{fontCharacter:"\\eadc"}),Sr.diffIgnored=new Sr("diff-ignored",{fontCharacter:"\\eadd"}),Sr.diffModified=new Sr("diff-modified",{fontCharacter:"\\eade"}),Sr.diffRemoved=new Sr("diff-removed",{fontCharacter:"\\eadf"}),Sr.diffRenamed=new Sr("diff-renamed",{fontCharacter:"\\eae0"}),Sr.diff=new Sr("diff",{fontCharacter:"\\eae1"}),Sr.discard=new Sr("discard",{fontCharacter:"\\eae2"}),Sr.editorLayout=new Sr("editor-layout",{fontCharacter:"\\eae3"}),Sr.emptyWindow=new Sr("empty-window",{fontCharacter:"\\eae4"}),Sr.exclude=new Sr("exclude",{fontCharacter:"\\eae5"}),Sr.extensions=new Sr("extensions",{fontCharacter:"\\eae6"}),Sr.eyeClosed=new Sr("eye-closed",{fontCharacter:"\\eae7"}),Sr.fileBinary=new Sr("file-binary",{fontCharacter:"\\eae8"}),Sr.fileCode=new Sr("file-code",{fontCharacter:"\\eae9"}),Sr.fileMedia=new Sr("file-media",{fontCharacter:"\\eaea"}),Sr.filePdf=new Sr("file-pdf",{fontCharacter:"\\eaeb"}),Sr.fileSubmodule=new Sr("file-submodule",{fontCharacter:"\\eaec"}),Sr.fileSymlinkDirectory=new Sr("file-symlink-directory",{fontCharacter:"\\eaed"}),Sr.fileSymlinkFile=new Sr("file-symlink-file",{fontCharacter:"\\eaee"}),Sr.fileZip=new Sr("file-zip",{fontCharacter:"\\eaef"}),Sr.files=new Sr("files",{fontCharacter:"\\eaf0"}),Sr.filter=new Sr("filter",{fontCharacter:"\\eaf1"}),Sr.flame=new Sr("flame",{fontCharacter:"\\eaf2"}),Sr.foldDown=new Sr("fold-down",{fontCharacter:"\\eaf3"}),Sr.foldUp=new Sr("fold-up",{fontCharacter:"\\eaf4"}),Sr.fold=new Sr("fold",{fontCharacter:"\\eaf5"}),Sr.folderActive=new Sr("folder-active",{fontCharacter:"\\eaf6"}),Sr.folderOpened=new Sr("folder-opened",{fontCharacter:"\\eaf7"}),Sr.gear=new Sr("gear",{fontCharacter:"\\eaf8"}),Sr.gift=new Sr("gift",{fontCharacter:"\\eaf9"}),Sr.gistSecret=new Sr("gist-secret",{fontCharacter:"\\eafa"}),Sr.gist=new Sr("gist",{fontCharacter:"\\eafb"}),Sr.gitCommit=new Sr("git-commit",{fontCharacter:"\\eafc"}),Sr.gitCompare=new Sr("git-compare",{fontCharacter:"\\eafd"}),Sr.gitMerge=new Sr("git-merge",{fontCharacter:"\\eafe"}),Sr.githubAction=new Sr("github-action",{fontCharacter:"\\eaff"}),Sr.githubAlt=new Sr("github-alt",{fontCharacter:"\\eb00"}),Sr.globe=new Sr("globe",{fontCharacter:"\\eb01"}),Sr.grabber=new Sr("grabber",{fontCharacter:"\\eb02"}),Sr.graph=new Sr("graph",{fontCharacter:"\\eb03"}),Sr.gripper=new Sr("gripper",{fontCharacter:"\\eb04"}),Sr.heart=new Sr("heart",{fontCharacter:"\\eb05"}),Sr.home=new Sr("home",{fontCharacter:"\\eb06"}),Sr.horizontalRule=new Sr("horizontal-rule",{fontCharacter:"\\eb07"}),Sr.hubot=new Sr("hubot",{fontCharacter:"\\eb08"}),Sr.inbox=new Sr("inbox",{fontCharacter:"\\eb09"}),Sr.issueClosed=new Sr("issue-closed",{fontCharacter:"\\eba4"}),Sr.issueReopened=new Sr("issue-reopened",{fontCharacter:"\\eb0b"}),Sr.issues=new Sr("issues",{fontCharacter:"\\eb0c"}),Sr.italic=new Sr("italic",{fontCharacter:"\\eb0d"}),Sr.jersey=new Sr("jersey",{fontCharacter:"\\eb0e"}),Sr.json=new Sr("json",{fontCharacter:"\\eb0f"}),Sr.kebabVertical=new Sr("kebab-vertical",{fontCharacter:"\\eb10"}),Sr.key=new Sr("key",{fontCharacter:"\\eb11"}),Sr.law=new Sr("law",{fontCharacter:"\\eb12"}),Sr.lightbulbAutofix=new Sr("lightbulb-autofix",{fontCharacter:"\\eb13"}),Sr.linkExternal=new Sr("link-external",{fontCharacter:"\\eb14"}),Sr.link=new Sr("link",{fontCharacter:"\\eb15"}),Sr.listOrdered=new Sr("list-ordered",{fontCharacter:"\\eb16"}),Sr.listUnordered=new Sr("list-unordered",{fontCharacter:"\\eb17"}),Sr.liveShare=new Sr("live-share",{fontCharacter:"\\eb18"}),Sr.loading=new Sr("loading",{fontCharacter:"\\eb19"}),Sr.location=new Sr("location",{fontCharacter:"\\eb1a"}),Sr.mailRead=new Sr("mail-read",{fontCharacter:"\\eb1b"}),Sr.mail=new Sr("mail",{fontCharacter:"\\eb1c"}),Sr.markdown=new Sr("markdown",{fontCharacter:"\\eb1d"}),Sr.megaphone=new Sr("megaphone",{fontCharacter:"\\eb1e"}),Sr.mention=new Sr("mention",{fontCharacter:"\\eb1f"}),Sr.milestone=new Sr("milestone",{fontCharacter:"\\eb20"}),Sr.mortarBoard=new Sr("mortar-board",{fontCharacter:"\\eb21"}),Sr.move=new Sr("move",{fontCharacter:"\\eb22"}),Sr.multipleWindows=new Sr("multiple-windows",{fontCharacter:"\\eb23"}),Sr.mute=new Sr("mute",{fontCharacter:"\\eb24"}),Sr.noNewline=new Sr("no-newline",{fontCharacter:"\\eb25"}),Sr.note=new Sr("note",{fontCharacter:"\\eb26"}),Sr.octoface=new Sr("octoface",{fontCharacter:"\\eb27"}),Sr.openPreview=new Sr("open-preview",{fontCharacter:"\\eb28"}),Sr.package_=new Sr("package",{fontCharacter:"\\eb29"}),Sr.paintcan=new Sr("paintcan",{fontCharacter:"\\eb2a"}),Sr.pin=new Sr("pin",{fontCharacter:"\\eb2b"}),Sr.play=new Sr("play",{fontCharacter:"\\eb2c"}),Sr.run=new Sr("run",{fontCharacter:"\\eb2c"}),Sr.plug=new Sr("plug",{fontCharacter:"\\eb2d"}),Sr.preserveCase=new Sr("preserve-case",{fontCharacter:"\\eb2e"}),Sr.preview=new Sr("preview",{fontCharacter:"\\eb2f"}),Sr.project=new Sr("project",{fontCharacter:"\\eb30"}),Sr.pulse=new Sr("pulse",{fontCharacter:"\\eb31"}),Sr.question=new Sr("question",{fontCharacter:"\\eb32"}),Sr.quote=new Sr("quote",{fontCharacter:"\\eb33"}),Sr.radioTower=new Sr("radio-tower",{fontCharacter:"\\eb34"}),Sr.reactions=new Sr("reactions",{fontCharacter:"\\eb35"}),Sr.references=new Sr("references",{fontCharacter:"\\eb36"}),Sr.refresh=new Sr("refresh",{fontCharacter:"\\eb37"}),Sr.regex=new Sr("regex",{fontCharacter:"\\eb38"}),Sr.remoteExplorer=new Sr("remote-explorer",{fontCharacter:"\\eb39"}),Sr.remote=new Sr("remote",{fontCharacter:"\\eb3a"}),Sr.remove=new Sr("remove",{fontCharacter:"\\eb3b"}),Sr.replaceAll=new Sr("replace-all",{fontCharacter:"\\eb3c"}),Sr.replace=new Sr("replace",{fontCharacter:"\\eb3d"}),Sr.repoClone=new Sr("repo-clone",{fontCharacter:"\\eb3e"}),Sr.repoForcePush=new Sr("repo-force-push",{fontCharacter:"\\eb3f"}),Sr.repoPull=new Sr("repo-pull",{fontCharacter:"\\eb40"}),Sr.repoPush=new Sr("repo-push",{fontCharacter:"\\eb41"}),Sr.report=new Sr("report",{fontCharacter:"\\eb42"}),Sr.requestChanges=new Sr("request-changes",{fontCharacter:"\\eb43"}),Sr.rocket=new Sr("rocket",{fontCharacter:"\\eb44"}),Sr.rootFolderOpened=new Sr("root-folder-opened",{fontCharacter:"\\eb45"}),Sr.rootFolder=new Sr("root-folder",{fontCharacter:"\\eb46"}),Sr.rss=new Sr("rss",{fontCharacter:"\\eb47"}),Sr.ruby=new Sr("ruby",{fontCharacter:"\\eb48"}),Sr.saveAll=new Sr("save-all",{fontCharacter:"\\eb49"}),Sr.saveAs=new Sr("save-as",{fontCharacter:"\\eb4a"}),Sr.save=new Sr("save",{fontCharacter:"\\eb4b"}),Sr.screenFull=new Sr("screen-full",{fontCharacter:"\\eb4c"}),Sr.screenNormal=new Sr("screen-normal",{fontCharacter:"\\eb4d"}),Sr.searchStop=new Sr("search-stop",{fontCharacter:"\\eb4e"}),Sr.server=new Sr("server",{fontCharacter:"\\eb50"}),Sr.settingsGear=new Sr("settings-gear",{fontCharacter:"\\eb51"}),Sr.settings=new Sr("settings",{fontCharacter:"\\eb52"}),Sr.shield=new Sr("shield",{fontCharacter:"\\eb53"}),Sr.smiley=new Sr("smiley",{fontCharacter:"\\eb54"}),Sr.sortPrecedence=new Sr("sort-precedence",{fontCharacter:"\\eb55"}),Sr.splitHorizontal=new Sr("split-horizontal",{fontCharacter:"\\eb56"}),Sr.splitVertical=new Sr("split-vertical",{fontCharacter:"\\eb57"}),Sr.squirrel=new Sr("squirrel",{fontCharacter:"\\eb58"}),Sr.starFull=new Sr("star-full",{fontCharacter:"\\eb59"}),Sr.starHalf=new Sr("star-half",{fontCharacter:"\\eb5a"}),Sr.symbolClass=new Sr("symbol-class",{fontCharacter:"\\eb5b"}),Sr.symbolColor=new Sr("symbol-color",{fontCharacter:"\\eb5c"}),Sr.symbolConstant=new Sr("symbol-constant",{fontCharacter:"\\eb5d"}),Sr.symbolEnumMember=new Sr("symbol-enum-member",{fontCharacter:"\\eb5e"}),Sr.symbolField=new Sr("symbol-field",{fontCharacter:"\\eb5f"}),Sr.symbolFile=new Sr("symbol-file",{fontCharacter:"\\eb60"}),Sr.symbolInterface=new Sr("symbol-interface",{fontCharacter:"\\eb61"}),Sr.symbolKeyword=new Sr("symbol-keyword",{fontCharacter:"\\eb62"}),Sr.symbolMisc=new Sr("symbol-misc",{fontCharacter:"\\eb63"}),Sr.symbolOperator=new Sr("symbol-operator",{fontCharacter:"\\eb64"}),Sr.symbolProperty=new Sr("symbol-property",{fontCharacter:"\\eb65"}),Sr.wrench=new Sr("wrench",{fontCharacter:"\\eb65"}),Sr.wrenchSubaction=new Sr("wrench-subaction",{fontCharacter:"\\eb65"}),Sr.symbolSnippet=new Sr("symbol-snippet",{fontCharacter:"\\eb66"}),Sr.tasklist=new Sr("tasklist",{fontCharacter:"\\eb67"}),Sr.telescope=new Sr("telescope",{fontCharacter:"\\eb68"}),Sr.textSize=new Sr("text-size",{fontCharacter:"\\eb69"}),Sr.threeBars=new Sr("three-bars",{fontCharacter:"\\eb6a"}),Sr.thumbsdown=new Sr("thumbsdown",{fontCharacter:"\\eb6b"}),Sr.thumbsup=new Sr("thumbsup",{fontCharacter:"\\eb6c"}),Sr.tools=new Sr("tools",{fontCharacter:"\\eb6d"}),Sr.triangleDown=new Sr("triangle-down",{fontCharacter:"\\eb6e"}),Sr.triangleLeft=new Sr("triangle-left",{fontCharacter:"\\eb6f"}),Sr.triangleRight=new Sr("triangle-right",{fontCharacter:"\\eb70"}),Sr.triangleUp=new Sr("triangle-up",{fontCharacter:"\\eb71"}),Sr.twitter=new Sr("twitter",{fontCharacter:"\\eb72"}),Sr.unfold=new Sr("unfold",{fontCharacter:"\\eb73"}),Sr.unlock=new Sr("unlock",{fontCharacter:"\\eb74"}),Sr.unmute=new Sr("unmute",{fontCharacter:"\\eb75"}),Sr.unverified=new Sr("unverified",{fontCharacter:"\\eb76"}),Sr.verified=new Sr("verified",{fontCharacter:"\\eb77"}),Sr.versions=new Sr("versions",{fontCharacter:"\\eb78"}),Sr.vmActive=new Sr("vm-active",{fontCharacter:"\\eb79"}),Sr.vmOutline=new Sr("vm-outline",{fontCharacter:"\\eb7a"}),Sr.vmRunning=new Sr("vm-running",{fontCharacter:"\\eb7b"}),Sr.watch=new Sr("watch",{fontCharacter:"\\eb7c"}),Sr.whitespace=new Sr("whitespace",{fontCharacter:"\\eb7d"}),Sr.wholeWord=new Sr("whole-word",{fontCharacter:"\\eb7e"}),Sr.window=new Sr("window",{fontCharacter:"\\eb7f"}),Sr.wordWrap=new Sr("word-wrap",{fontCharacter:"\\eb80"}),Sr.zoomIn=new Sr("zoom-in",{fontCharacter:"\\eb81"}),Sr.zoomOut=new Sr("zoom-out",{fontCharacter:"\\eb82"}),Sr.listFilter=new Sr("list-filter",{fontCharacter:"\\eb83"}),Sr.listFlat=new Sr("list-flat",{fontCharacter:"\\eb84"}),Sr.listSelection=new Sr("list-selection",{fontCharacter:"\\eb85"}),Sr.selection=new Sr("selection",{fontCharacter:"\\eb85"}),Sr.listTree=new Sr("list-tree",{fontCharacter:"\\eb86"}),Sr.debugBreakpointFunctionUnverified=new Sr("debug-breakpoint-function-unverified",{fontCharacter:"\\eb87"}),Sr.debugBreakpointFunction=new Sr("debug-breakpoint-function",{fontCharacter:"\\eb88"}),Sr.debugBreakpointFunctionDisabled=new Sr("debug-breakpoint-function-disabled",{fontCharacter:"\\eb88"}),Sr.debugStackframeActive=new Sr("debug-stackframe-active",{fontCharacter:"\\eb89"}),Sr.debugStackframeDot=new Sr("debug-stackframe-dot",{fontCharacter:"\\eb8a"}),Sr.debugStackframe=new Sr("debug-stackframe",{fontCharacter:"\\eb8b"}),Sr.debugStackframeFocused=new Sr("debug-stackframe-focused",{fontCharacter:"\\eb8b"}),Sr.debugBreakpointUnsupported=new Sr("debug-breakpoint-unsupported",{fontCharacter:"\\eb8c"}),Sr.symbolString=new Sr("symbol-string",{fontCharacter:"\\eb8d"}),Sr.debugReverseContinue=new Sr("debug-reverse-continue",{fontCharacter:"\\eb8e"}),Sr.debugStepBack=new Sr("debug-step-back",{fontCharacter:"\\eb8f"}),Sr.debugRestartFrame=new Sr("debug-restart-frame",{fontCharacter:"\\eb90"}),Sr.callIncoming=new Sr("call-incoming",{fontCharacter:"\\eb92"}),Sr.callOutgoing=new Sr("call-outgoing",{fontCharacter:"\\eb93"}),Sr.menu=new Sr("menu",{fontCharacter:"\\eb94"}),Sr.expandAll=new Sr("expand-all",{fontCharacter:"\\eb95"}),Sr.feedback=new Sr("feedback",{fontCharacter:"\\eb96"}),Sr.groupByRefType=new Sr("group-by-ref-type",{fontCharacter:"\\eb97"}),Sr.ungroupByRefType=new Sr("ungroup-by-ref-type",{fontCharacter:"\\eb98"}),Sr.account=new Sr("account",{fontCharacter:"\\eb99"}),Sr.bellDot=new Sr("bell-dot",{fontCharacter:"\\eb9a"}),Sr.debugConsole=new Sr("debug-console",{fontCharacter:"\\eb9b"}),Sr.library=new Sr("library",{fontCharacter:"\\eb9c"}),Sr.output=new Sr("output",{fontCharacter:"\\eb9d"}),Sr.runAll=new Sr("run-all",{fontCharacter:"\\eb9e"}),Sr.syncIgnored=new Sr("sync-ignored",{fontCharacter:"\\eb9f"}),Sr.pinned=new Sr("pinned",{fontCharacter:"\\eba0"}),Sr.githubInverted=new Sr("github-inverted",{fontCharacter:"\\eba1"}),Sr.debugAlt=new Sr("debug-alt",{fontCharacter:"\\eb91"}),Sr.serverProcess=new Sr("server-process",{fontCharacter:"\\eba2"}),Sr.serverEnvironment=new Sr("server-environment",{fontCharacter:"\\eba3"}),Sr.pass=new Sr("pass",{fontCharacter:"\\eba4"}),Sr.stopCircle=new Sr("stop-circle",{fontCharacter:"\\eba5"}),Sr.playCircle=new Sr("play-circle",{fontCharacter:"\\eba6"}),Sr.record=new Sr("record",{fontCharacter:"\\eba7"}),Sr.debugAltSmall=new Sr("debug-alt-small",{fontCharacter:"\\eba8"}),Sr.vmConnect=new Sr("vm-connect",{fontCharacter:"\\eba9"}),Sr.cloud=new Sr("cloud",{fontCharacter:"\\ebaa"}),Sr.merge=new Sr("merge",{fontCharacter:"\\ebab"}),Sr.exportIcon=new Sr("export",{fontCharacter:"\\ebac"}),Sr.graphLeft=new Sr("graph-left",{fontCharacter:"\\ebad"}),Sr.magnet=new Sr("magnet",{fontCharacter:"\\ebae"}),Sr.notebook=new Sr("notebook",{fontCharacter:"\\ebaf"}),Sr.redo=new Sr("redo",{fontCharacter:"\\ebb0"}),Sr.checkAll=new Sr("check-all",{fontCharacter:"\\ebb1"}),Sr.pinnedDirty=new Sr("pinned-dirty",{fontCharacter:"\\ebb2"}),Sr.passFilled=new Sr("pass-filled",{fontCharacter:"\\ebb3"}),Sr.circleLargeFilled=new Sr("circle-large-filled",{fontCharacter:"\\ebb4"}),Sr.circleLargeOutline=new Sr("circle-large-outline",{fontCharacter:"\\ebb5"}),Sr.combine=new Sr("combine",{fontCharacter:"\\ebb6"}),Sr.gather=new Sr("gather",{fontCharacter:"\\ebb6"}),Sr.table=new Sr("table",{fontCharacter:"\\ebb7"}),Sr.variableGroup=new Sr("variable-group",{fontCharacter:"\\ebb8"}),Sr.typeHierarchy=new Sr("type-hierarchy",{fontCharacter:"\\ebb9"}),Sr.typeHierarchySub=new Sr("type-hierarchy-sub",{fontCharacter:"\\ebba"}),Sr.typeHierarchySuper=new Sr("type-hierarchy-super",{fontCharacter:"\\ebbb"}),Sr.gitPullRequestCreate=new Sr("git-pull-request-create",{fontCharacter:"\\ebbc"}),Sr.runAbove=new Sr("run-above",{fontCharacter:"\\ebbd"}),Sr.runBelow=new Sr("run-below",{fontCharacter:"\\ebbe"}),Sr.notebookTemplate=new Sr("notebook-template",{fontCharacter:"\\ebbf"}),Sr.debugRerun=new Sr("debug-rerun",{fontCharacter:"\\ebc0"}),Sr.workspaceTrusted=new Sr("workspace-trusted",{fontCharacter:"\\ebc1"}),Sr.workspaceUntrusted=new Sr("workspace-untrusted",{fontCharacter:"\\ebc2"}),Sr.workspaceUnspecified=new Sr("workspace-unspecified",{fontCharacter:"\\ebc3"}),Sr.terminalCmd=new Sr("terminal-cmd",{fontCharacter:"\\ebc4"}),Sr.terminalDebian=new Sr("terminal-debian",{fontCharacter:"\\ebc5"}),Sr.terminalLinux=new Sr("terminal-linux",{fontCharacter:"\\ebc6"}),Sr.terminalPowershell=new Sr("terminal-powershell",{fontCharacter:"\\ebc7"}),Sr.terminalTmux=new Sr("terminal-tmux",{fontCharacter:"\\ebc8"}),Sr.terminalUbuntu=new Sr("terminal-ubuntu",{fontCharacter:"\\ebc9"}),Sr.terminalBash=new Sr("terminal-bash",{fontCharacter:"\\ebca"}),Sr.arrowSwap=new Sr("arrow-swap",{fontCharacter:"\\ebcb"}),Sr.copy=new Sr("copy",{fontCharacter:"\\ebcc"}),Sr.personAdd=new Sr("person-add",{fontCharacter:"\\ebcd"}),Sr.filterFilled=new Sr("filter-filled",{fontCharacter:"\\ebce"}),Sr.wand=new Sr("wand",{fontCharacter:"\\ebcf"}),Sr.debugLineByLine=new Sr("debug-line-by-line",{fontCharacter:"\\ebd0"}),Sr.inspect=new Sr("inspect",{fontCharacter:"\\ebd1"}),Sr.layers=new Sr("layers",{fontCharacter:"\\ebd2"}),Sr.layersDot=new Sr("layers-dot",{fontCharacter:"\\ebd3"}),Sr.layersActive=new Sr("layers-active",{fontCharacter:"\\ebd4"}),Sr.compass=new Sr("compass",{fontCharacter:"\\ebd5"}),Sr.compassDot=new Sr("compass-dot",{fontCharacter:"\\ebd6"}),Sr.compassActive=new Sr("compass-active",{fontCharacter:"\\ebd7"}),Sr.azure=new Sr("azure",{fontCharacter:"\\ebd8"}),Sr.issueDraft=new Sr("issue-draft",{fontCharacter:"\\ebd9"}),Sr.gitPullRequestClosed=new Sr("git-pull-request-closed",{fontCharacter:"\\ebda"}),Sr.gitPullRequestDraft=new Sr("git-pull-request-draft",{fontCharacter:"\\ebdb"}),Sr.debugAll=new Sr("debug-all",{fontCharacter:"\\ebdc"}),Sr.debugCoverage=new Sr("debug-coverage",{fontCharacter:"\\ebdd"}),Sr.dropDownButton=new Sr("drop-down-button",Sr.chevronDown.definition);Object.prototype.hasOwnProperty;function kr(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var Mr,Cr,Ir=function(){"use strict";function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,a.default)(this,e),this._rgbaBrand=void 0,this.r=0|Math.min(255,Math.max(0,t)),this.g=0|Math.min(255,Math.max(0,r)),this.b=0|Math.min(255,Math.max(0,n)),this.a=kr(Math.max(Math.min(1,i),0),3)}return(0,s.default)(e,null,[{key:"equals",value:function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}}]),e}(),Tr=function(){"use strict";function e(t,r,n,i){(0,a.default)(this,e),this._hslaBrand=void 0,this.h=0|Math.max(Math.min(360,t),0),this.s=kr(Math.max(Math.min(1,r),0),3),this.l=kr(Math.max(Math.min(1,n),0),3),this.a=kr(Math.max(Math.min(1,i),0),3)}return(0,s.default)(e,null,[{key:"equals",value:function(e,t){return e.h===t.h&&e.s===t.s&&e.l===t.l&&e.a===t.a}},{key:"fromRGBA",value:function(t){var r=t.r/255,n=t.g/255,i=t.b/255,o=t.a,a=Math.max(r,n,i),s=Math.min(r,n,i),u=0,l=0,c=(s+a)/2,d=a-s;if(d>0){switch(l=Math.min(c<=.5?d/(2*c):d/(2-2*c),1),a){case r:u=(n-i)/d+(n<i?6:0);break;case n:u=(i-r)/d+2;break;case i:u=(r-n)/d+4}u*=60,u=Math.round(u)}return new e(u,l,c,o)}},{key:"_hue2rgb",value:function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}},{key:"toRGBA",value:function(t){var r,n,i,o=t.h/360,a=t.s,s=t.l,u=t.a;if(0===a)r=n=i=s;else{var l=s<.5?s*(1+a):s+a-s*a,c=2*s-l;r=e._hue2rgb(c,l,o+1/3),n=e._hue2rgb(c,l,o),i=e._hue2rgb(c,l,o-1/3)}return new Ir(Math.round(255*r),Math.round(255*n),Math.round(255*i),u)}}]),e}(),Rr=function(){"use strict";function e(t,r,n,i){(0,a.default)(this,e),this._hsvaBrand=void 0,this.h=0|Math.max(Math.min(360,t),0),this.s=kr(Math.max(Math.min(1,r),0),3),this.v=kr(Math.max(Math.min(1,n),0),3),this.a=kr(Math.max(Math.min(1,i),0),3)}return(0,s.default)(e,null,[{key:"equals",value:function(e,t){return e.h===t.h&&e.s===t.s&&e.v===t.v&&e.a===t.a}},{key:"fromRGBA",value:function(t){var r,n=t.r/255,i=t.g/255,o=t.b/255,a=Math.max(n,i,o),s=a-Math.min(n,i,o),u=0===a?0:s/a;return r=0===s?0:a===n?((i-o)/s%6+6)%6:a===i?(o-n)/s+2:(n-i)/s+4,new e(Math.round(60*r),u,a,t.a)}},{key:"toRGBA",value:function(e){var t=e.h,r=e.s,n=e.v,i=e.a,o=n*r,a=o*(1-Math.abs(t/60%2-1)),s=n-o,u=0,l=0,c=0;return t<60?(u=o,l=a):t<120?(u=a,l=o):t<180?(l=o,c=a):t<240?(l=a,c=o):t<300?(u=a,c=o):t<=360&&(u=o,c=a),u=Math.round(255*(u+s)),l=Math.round(255*(l+s)),c=Math.round(255*(c+s)),new Ir(u,l,c,i)}}]),e}(),xr=function(){"use strict";function e(t){if((0,a.default)(this,e),!t)throw new Error("Color needs a value");if(t instanceof Ir)this.rgba=t;else if(t instanceof Tr)this._hsla=t,this.rgba=Tr.toRGBA(t);else{if(!(t instanceof Rr))throw new Error("Invalid color ctor argument");this._hsva=t,this.rgba=Rr.toRGBA(t)}}return(0,s.default)(e,[{key:"hsla",get:function(){return this._hsla?this._hsla:Tr.fromRGBA(this.rgba)}},{key:"hsva",get:function(){return this._hsva?this._hsva:Rr.fromRGBA(this.rgba)}},{key:"equals",value:function(e){return!!e&&Ir.equals(this.rgba,e.rgba)&&Tr.equals(this.hsla,e.hsla)&&Rr.equals(this.hsva,e.hsva)}},{key:"getRelativeLuminance",value:function(){return kr(.2126*e._relativeLuminanceForComponent(this.rgba.r)+.7152*e._relativeLuminanceForComponent(this.rgba.g)+.0722*e._relativeLuminanceForComponent(this.rgba.b),4)}},{key:"getContrastRatio",value:function(e){var t=this.getRelativeLuminance(),r=e.getRelativeLuminance();return t>r?(t+.05)/(r+.05):(r+.05)/(t+.05)}},{key:"isDarker",value:function(){return(299*this.rgba.r+587*this.rgba.g+114*this.rgba.b)/1e3<128}},{key:"isLighter",value:function(){return(299*this.rgba.r+587*this.rgba.g+114*this.rgba.b)/1e3>=128}},{key:"isLighterThan",value:function(e){return this.getRelativeLuminance()>e.getRelativeLuminance()}},{key:"isDarkerThan",value:function(e){return this.getRelativeLuminance()<e.getRelativeLuminance()}},{key:"lighten",value:function(t){return new e(new Tr(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*t,this.hsla.a))}},{key:"darken",value:function(t){return new e(new Tr(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*t,this.hsla.a))}},{key:"transparent",value:function(t){var r=this.rgba,n=r.r,i=r.g,o=r.b,a=r.a;return new e(new Ir(n,i,o,a*t))}},{key:"isTransparent",value:function(){return 0===this.rgba.a}},{key:"isOpaque",value:function(){return 1===this.rgba.a}},{key:"opposite",value:function(){return new e(new Ir(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}},{key:"blend",value:function(t){var r=t.rgba,n=this.rgba.a,i=r.a,o=n+i*(1-n);if(o<1e-6)return e.transparent;var a=this.rgba.r*n/o+r.r*i*(1-n)/o,s=this.rgba.g*n/o+r.g*i*(1-n)/o,u=this.rgba.b*n/o+r.b*i*(1-n)/o;return new e(new Ir(a,s,u,o))}},{key:"makeOpaque",value:function(t){if(this.isOpaque()||1!==t.rgba.a)return this;var r=this.rgba,n=r.r,i=r.g,o=r.b,a=r.a;return new e(new Ir(t.rgba.r-a*(t.rgba.r-n),t.rgba.g-a*(t.rgba.g-i),t.rgba.b-a*(t.rgba.b-o),1))}},{key:"flatten",value:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r.reduceRight((function(t,r){return e._flatten(r,t)}));return e._flatten(this,i)}},{key:"toString",value:function(){return""+e.Format.CSS.format(this)}}],[{key:"fromHex",value:function(t){return e.Format.CSS.parseHex(t)||e.red}},{key:"_relativeLuminanceForComponent",value:function(e){var t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}},{key:"_flatten",value:function(t,r){var n=1-t.rgba.a;return new e(new Ir(n*r.rgba.r+t.rgba.a*t.rgba.r,n*r.rgba.g+t.rgba.a*t.rgba.g,n*r.rgba.b+t.rgba.a*t.rgba.b))}},{key:"getLighterColor",value:function(e,t,r){if(e.isLighterThan(t))return e;r=r||.5;var n=e.getRelativeLuminance(),i=t.getRelativeLuminance();return r=r*(i-n)/i,e.lighten(r)}},{key:"getDarkerColor",value:function(e,t,r){if(e.isDarkerThan(t))return e;r=r||.5;var n=e.getRelativeLuminance();return r=r*(n-t.getRelativeLuminance())/n,e.darken(r)}}]),e}();xr.white=new xr(new Ir(255,255,255,1)),xr.black=new xr(new Ir(0,0,0,1)),xr.red=new xr(new Ir(255,0,0,1)),xr.blue=new xr(new Ir(0,0,255,1)),xr.green=new xr(new Ir(0,255,0,1)),xr.cyan=new xr(new Ir(0,255,255,1)),xr.lightgrey=new xr(new Ir(211,211,211,1)),xr.transparent=new xr(new Ir(0,0,0,0)),Mr=xr||(xr={}),function(e){function t(e){var t=e.toString(16);return 2!==t.length?"0"+t:t}function r(e){switch(e){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:case 65:return 10;case 98:case 66:return 11;case 99:case 67:return 12;case 100:case 68:return 13;case 101:case 69:return 14;case 102:case 70:return 15}return 0}e.formatRGB=function(e){return 1===e.rgba.a?"rgb(".concat(e.rgba.r,", ").concat(e.rgba.g,", ").concat(e.rgba.b,")"):Mr.Format.CSS.formatRGBA(e)},e.formatRGBA=function(e){return"rgba(".concat(e.rgba.r,", ").concat(e.rgba.g,", ").concat(e.rgba.b,", ").concat(+e.rgba.a.toFixed(2),")")},e.formatHSL=function(e){return 1===e.hsla.a?"hsl(".concat(e.hsla.h,", ").concat((100*e.hsla.s).toFixed(2),"%, ").concat((100*e.hsla.l).toFixed(2),"%)"):Mr.Format.CSS.formatHSLA(e)},e.formatHSLA=function(e){return"hsla(".concat(e.hsla.h,", ").concat((100*e.hsla.s).toFixed(2),"%, ").concat((100*e.hsla.l).toFixed(2),"%, ").concat(e.hsla.a.toFixed(2),")")},e.formatHex=function(e){return"#".concat(t(e.rgba.r)).concat(t(e.rgba.g)).concat(t(e.rgba.b))},e.formatHexA=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r&&1===e.rgba.a?Mr.Format.CSS.formatHex(e):"#".concat(t(e.rgba.r)).concat(t(e.rgba.g)).concat(t(e.rgba.b)).concat(t(Math.round(255*e.rgba.a)))},e.format=function(e){return e.isOpaque()?Mr.Format.CSS.formatHex(e):Mr.Format.CSS.formatRGBA(e)},e.parseHex=function(e){var t=e.length;if(0===t)return null;if(35!==e.charCodeAt(0))return null;if(7===t){var n=16*r(e.charCodeAt(1))+r(e.charCodeAt(2)),i=16*r(e.charCodeAt(3))+r(e.charCodeAt(4)),o=16*r(e.charCodeAt(5))+r(e.charCodeAt(6));return new Mr(new Ir(n,i,o,1))}if(9===t){var a=16*r(e.charCodeAt(1))+r(e.charCodeAt(2)),s=16*r(e.charCodeAt(3))+r(e.charCodeAt(4)),u=16*r(e.charCodeAt(5))+r(e.charCodeAt(6)),l=16*r(e.charCodeAt(7))+r(e.charCodeAt(8));return new Mr(new Ir(a,s,u,l/255))}if(4===t){var c=r(e.charCodeAt(1)),d=r(e.charCodeAt(2)),f=r(e.charCodeAt(3));return new Mr(new Ir(16*c+c,16*d+d,16*f+f))}if(5===t){var h=r(e.charCodeAt(1)),p=r(e.charCodeAt(2)),v=r(e.charCodeAt(3)),g=r(e.charCodeAt(4));return new Mr(new Ir(16*h+h,16*p+p,16*v+v,(16*g+g)/255))}return null}}((Cr=Mr.Format||(Mr.Format={})).CSS||(Cr.CSS={}));new gr((function(){var e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return{collator:e,collatorIsNumeric:e.resolvedOptions().numeric}})),new gr((function(){return{collator:new Intl.Collator(void 0,{numeric:!0})}})),new gr((function(){return{collator:new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"})}}));function Or(e,t,r){var n=null,i=null;if("function"==typeof r.value?(n="value",0!==(i=r.value).length&&console.warn("Memoize should only be used in functions with zero parameters")):"function"==typeof r.get&&(n="get",i=r.get),!i)throw new Error("not supported");var o="$memoize$".concat(t);r[n]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:i.apply(this,t)}),this[o]}}var Ar,Dr;var Pr,Lr;(Lr=Pr||(Pr={}))[Lr.Scheme=1]="Scheme",Lr[Lr.Authority=2]="Authority",Lr[Lr.Path=3]="Path",Lr[Lr.Query=4]="Query",Lr[Lr.Fragment=5]="Fragment";var Ur,jr,Nr=function(){"use strict";function e(t,r){(0,a.default)(this,e),this[Ar]="ResourceMap",t instanceof e?(this.map=new Map(t.map),this.toKey=null!=r?r:e.defaultToKey):(this.map=new Map,this.toKey=null!=t?t:e.defaultToKey)}return(0,s.default)(e,[{key:"set",value:function(e,t){return this.map.set(this.toKey(e),t),this}},{key:"get",value:function(e){return this.map.get(this.toKey(e))}},{key:"has",value:function(e){return this.map.has(this.toKey(e))}},{key:"size",get:function(){return this.map.size}},{key:"clear",value:function(){this.map.clear()}},{key:"delete",value:function(e){return this.map.delete(this.toKey(e))}},{key:"forEach",value:function(e,t){void 0!==t&&(e=e.bind(t));var r=!0,n=!1,i=void 0;try{for(var o,a=this.map[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=(0,f.default)(o.value,2),u=s[0];e(s[1],zt.parse(u),this)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"values",value:function(){return this.map.values()}},{key:"keys",value:function(){var e,t,r,n,i,o,a;return(0,m.__generator)(this,(function(s){switch(s.label){case 0:e=!0,t=!1,r=void 0,s.label=1;case 1:s.trys.push([1,6,7,8]),n=this.map.keys()[Symbol.iterator](),s.label=2;case 2:return(e=(i=n.next()).done)?[3,5]:(o=i.value,[4,zt.parse(o)]);case 3:s.sent(),s.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return a=s.sent(),t=!0,r=a,[3,8];case 7:try{e||null==n.return||n.return()}finally{if(t)throw r}return[7];case 8:return[2]}}))}},{key:"entries",value:function(){var e,t,r,n,i,o,a;return(0,m.__generator)(this,(function(s){switch(s.label){case 0:e=!0,t=!1,r=void 0,s.label=1;case 1:s.trys.push([1,6,7,8]),n=this.map.entries()[Symbol.iterator](),s.label=2;case 2:return(e=(i=n.next()).done)?[3,5]:(o=i.value,[4,[zt.parse(o[0]),o[1]]]);case 3:s.sent(),s.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return a=s.sent(),t=!0,r=a,[3,8];case 7:try{e||null==n.return||n.return()}finally{if(t)throw r}return[7];case 8:return[2]}}))}},{key:(Ar=Symbol.toStringTag,Symbol.iterator),value:function(){var e,t,r,n,i,o,a;return(0,m.__generator)(this,(function(s){switch(s.label){case 0:e=!0,t=!1,r=void 0,s.label=1;case 1:s.trys.push([1,6,7,8]),n=this.map[Symbol.iterator](),s.label=2;case 2:return(e=(i=n.next()).done)?[3,5]:(o=i.value,[4,[zt.parse(o[0]),o[1]]]);case 3:s.sent(),s.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return a=s.sent(),t=!0,r=a,[3,8];case 7:try{e||null==n.return||n.return()}finally{if(t)throw r}return[7];case 8:return[2]}}))}}]),e}();Nr.defaultToKey=function(e){return e.toString()},(jr=Ur||(Ur={}))[jr.None=0]="None",jr[jr.AsOld=1]="AsOld",jr[jr.AsNew=2]="AsNew";var Br=function(){"use strict";function e(){(0,a.default)(this,e),this[Dr]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}return(0,s.default)(e,[{key:"clear",value:function(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}},{key:"isEmpty",value:function(){return!this._head&&!this._tail}},{key:"size",get:function(){return this._size}},{key:"first",get:function(){var e;return null==(e=this._head)?void 0:e.value}},{key:"last",get:function(){var e;return null==(e=this._tail)?void 0:e.value}},{key:"has",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._map.get(e);if(r)return 0!==t&&this.touch(r,t),r.value}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this._map.get(e);if(n)n.value=t,0!==r&&this.touch(n,r);else{switch(n={key:e,value:t,next:void 0,previous:void 0},r){case 0:case 2:default:this.addItemLast(n);break;case 1:this.addItemFirst(n)}this._map.set(e,n),this._size++}return this}},{key:"delete",value:function(e){return!!this.remove(e)}},{key:"remove",value:function(e){var t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}},{key:"shift",value:function(){if(this._head||this._tail){if(!this._head||!this._tail)throw new Error("Invalid list");var e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}}},{key:"forEach",value:function(e,t){for(var r=this._state,n=this._head;n;){if(t?e.bind(t)(n.value,n.key,this):e(n.value,n.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");n=n.next}}},{key:"keys",value:function(){var e,t=this,r=this._state,n=this._head,i=(e={},(0,u.default)(e,Symbol.iterator,(function(){return i})),(0,u.default)(e,"next",(function(){if(t._state!==r)throw new Error("LinkedMap got modified during iteration.");if(n){var e={value:n.key,done:!1};return n=n.next,e}return{value:void 0,done:!0}})),e);return i}},{key:"values",value:function(){var e,t=this,r=this._state,n=this._head,i=(e={},(0,u.default)(e,Symbol.iterator,(function(){return i})),(0,u.default)(e,"next",(function(){if(t._state!==r)throw new Error("LinkedMap got modified during iteration.");if(n){var e={value:n.value,done:!1};return n=n.next,e}return{value:void 0,done:!0}})),e);return i}},{key:"entries",value:function(){var e,t=this,r=this._state,n=this._head,i=(e={},(0,u.default)(e,Symbol.iterator,(function(){return i})),(0,u.default)(e,"next",(function(){if(t._state!==r)throw new Error("LinkedMap got modified during iteration.");if(n){var e={value:[n.key,n.value],done:!1};return n=n.next,e}return{value:void 0,done:!0}})),e);return i}},{key:(Dr=Symbol.toStringTag,Symbol.iterator),value:function(){return this.entries()}},{key:"trimOld",value:function(e){if(!(e>=this.size))if(0!==e){for(var t=this._head,r=this.size;t&&r>e;)this._map.delete(t.key),t=t.next,r--;this._head=t,this._size=r,t&&(t.previous=void 0),this._state++}else this.clear()}},{key:"addItemFirst",value:function(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e,this._state++}},{key:"addItemLast",value:function(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e,this._state++}},{key:"removeItem",value:function(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{var t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}e.next=void 0,e.previous=void 0,this._state++}},{key:"touch",value:function(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(1===t||2===t)if(1===t){if(e===this._head)return;var r=e.next,n=e.previous;e===this._tail?(n.next=void 0,this._tail=n):(r.previous=n,n.next=r),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(2===t){if(e===this._tail)return;var i=e.next,o=e.previous;e===this._head?(i.previous=void 0,this._head=i):(i.previous=o,o.next=i),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}},{key:"toJSON",value:function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),e}},{key:"fromJSON",value:function(e){this.clear();var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,f.default)(i.value,2),s=a[0],u=a[1];this.set(s,u)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}}]),e}(),Fr=function(e){"use strict";(0,d.default)(r,e);var t=(0,g.default)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,a.default)(this,r),(n=t.call(this))._limit=e,n._ratio=Math.min(Math.max(0,i),1),n}return(0,s.default)(r,[{key:"limit",get:function(){return this._limit},set:function(e){this._limit=e,this.checkTrim()}},{key:"ratio",get:function(){return this._ratio},set:function(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(0,l.default)((0,c.default)(r.prototype),"get",this).call(this,e,t)}},{key:"peek",value:function(e){return(0,l.default)((0,c.default)(r.prototype),"get",this).call(this,e,0)}},{key:"set",value:function(e,t){return(0,l.default)((0,c.default)(r.prototype),"set",this).call(this,e,t,2),this.checkTrim(),this}},{key:"checkTrim",value:function(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}]),r}(Br);Symbol.iterator;function Kr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r){for(var n=0,i=t.length;n<i;n++){var o=t[n](e,r);if(o)return o}return null}}Wr.bind(void 0,!1);var qr=Wr.bind(void 0,!0);function Wr(e,t,r){return!r||r.length<t.length?null:(e?Xe(r,t):0===r.indexOf(t))?t.length>0?[{start:0,end:t.length}]:[]:null}function Vr(e,t){var r=t.toLowerCase().indexOf(e.toLowerCase());return-1===r?null:[{start:r,end:r+e.length}]}function Hr(e,t){return Gr(e.toLowerCase(),t.toLowerCase(),0,0)}function Gr(e,t,r,n){if(r===e.length)return[];if(n===t.length)return null;if(e[r]===t[n]){var i;return(i=Gr(e,t,r+1,n+1))?Xr({start:n,end:n+1},i):null}return Gr(e,t,r,n+1)}function zr(e){return 97<=e&&e<=122}function Yr(e){return 65<=e&&e<=90}function Zr(e){return 48<=e&&e<=57}function $r(e){return 32===e||9===e||10===e||13===e}var Jr=new Set;function Qr(e){return zr(e)||Yr(e)||Zr(e)}function Xr(e,t){return 0===t.length?t=[e]:e.end===t[0].start?t[0].start=e.start:t.unshift(e),t}function en(e,t){for(var r=t;r<e.length;r++){var n=e.charCodeAt(r);if(Yr(n)||Zr(n)||r>0&&!Qr(e.charCodeAt(r-1)))return r}return e.length}function tn(e,t,r,n){if(r===e.length)return[];if(n===t.length)return null;if(e[r]!==t[n].toLowerCase())return null;var i=null,o=n+1;for(i=tn(e,t,r+1,n+1);!i&&(o=en(t,o))<t.length;)i=tn(e,t,r+1,o),o++;return null===i?null:Xr({start:n,end:n+1},i)}function rn(e,t){if(!t)return null;if(0===(t=t.trim()).length)return null;if(!function(e){for(var t=0,r=0,n=0,i=0,o=0;o<e.length;o++)Yr(n=e.charCodeAt(o))&&t++,zr(n)&&r++,$r(n)&&i++;return 0!==t&&0!==r||0!==i?t<=5:e.length<=30}(e))return null;if(t.length>60)return null;var r=function(e){for(var t=0,r=0,n=0,i=0,o=0,a=0;a<e.length;a++)Yr(o=e.charCodeAt(a))&&t++,zr(o)&&r++,Qr(o)&&n++,Zr(o)&&i++;return{upperPercent:t/e.length,lowerPercent:r/e.length,alphaPercent:n/e.length,numericPercent:i/e.length}}(t);if(!function(e){var t=e.upperPercent,r=e.lowerPercent,n=e.alphaPercent,i=e.numericPercent;return r>.2&&t<.8&&n>.6&&i<.2}(r)){if(!function(e){var t=e.upperPercent;return 0===e.lowerPercent&&t>.6}(r))return null;t=t.toLowerCase()}var n=null,i=0;for(e=e.toLowerCase();i<t.length&&null===(n=tn(e,t,0,i));)i=en(t,i+1);return n}"`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?".split("").forEach((function(e){return Jr.add(e.charCodeAt(0))}));Kr(qr,rn,Vr),Kr(qr,rn,Hr),new Fr(1e4);var nn=128;function on(){for(var e=[],t=[],r=0;r<=nn;r++)t[r]=0;for(var n=0;n<=nn;n++)e.push(t.slice(0));return e}function an(e){for(var t=[],r=0;r<=e;r++)t[r]=0;return t}var sn,un,ln,cn;an(256),an(256),on(),on(),on();(un=sn||(sn={}))[un.Diag=1]="Diag",un[un.Left=2]="Left",un[un.LeftLeft=3]="LeftLeft",(cn=ln||(ln={})).Default=[-100,0],cn.isDefault=function(e){return!e||2===e.length&&-100===e[0]&&0===e[1]};Object.freeze({score:0});new Fr(1e4);var dn,fn;function hn(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,n=r-t,i=~((1<<n)-1);return(e<<t|(i&e)>>>n)>>>0}function pn(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=0;i<r;i++)e[t+i]=n}function vn(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";e.length<t;)e=r+e;return e}function gn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map((function(e){return e.toString(16).padStart(2,"0")})).join(""):vn((e>>>0).toString(16),t/4)}(fn=dn||(dn={}))[fn.BLOCK_SIZE=64]="BLOCK_SIZE",fn[fn.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT";var mn=function(){"use strict";function e(){(0,a.default)(this,e),this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}return(0,s.default)(e,[{key:"update",value:function(e){var t=e.length;if(0!==t){var r,n,i=this._buff,o=this._buffLen,a=this._leftoverHighSurrogate;for(0!==a?(r=a,n=-1,a=0):(r=e.charCodeAt(0),n=0);;){var s=r;if(et(r)){if(!(n+1<t)){a=r;break}var u=e.charCodeAt(n+1);tt(u)?(n++,s=rt(r,u)):s=65533}else tt(r)&&(s=65533);if(o=this._push(i,o,s),!(++n<t))break;r=e.charCodeAt(n)}this._buffLen=o,this._leftoverHighSurrogate=a}}},{key:"_push",value:function(e,t,r){return r<128?e[t++]=r:r<2048?(e[t++]=192|(1984&r)>>>6,e[t++]=128|(63&r)>>>0):r<65536?(e[t++]=224|(61440&r)>>>12,e[t++]=128|(4032&r)>>>6,e[t++]=128|(63&r)>>>0):(e[t++]=240|(1835008&r)>>>18,e[t++]=128|(258048&r)>>>12,e[t++]=128|(4032&r)>>>6,e[t++]=128|(63&r)>>>0),t>=64&&(this._step(),t-=64,this._totalLen+=64,e[0]=e[64],e[1]=e[65],e[2]=e[66]),t}},{key:"digest",value:function(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),gn(this._h0)+gn(this._h1)+gn(this._h2)+gn(this._h3)+gn(this._h4)}},{key:"_wrapUp",value:function(){this._buff[this._buffLen++]=128,pn(this._buff,this._buffLen),this._buffLen>56&&(this._step(),pn(this._buff));var e=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(e/4294967296),!1),this._buffDV.setUint32(60,e%4294967296,!1),this._step()}},{key:"_step",value:function(){for(var t=e._bigBlock32,r=this._buffDV,n=0;n<64;n+=4)t.setUint32(n,r.getUint32(n,!1),!1);for(var i=64;i<320;i+=4)t.setUint32(i,hn(t.getUint32(i-12,!1)^t.getUint32(i-32,!1)^t.getUint32(i-56,!1)^t.getUint32(i-64,!1),1),!1);for(var o,a,s,u=this._h0,l=this._h1,c=this._h2,d=this._h3,f=this._h4,h=0;h<80;h++)h<20?(o=l&c|~l&d,a=1518500249):h<40?(o=l^c^d,a=1859775393):h<60?(o=l&c|l&d|c&d,a=2400959708):(o=l^c^d,a=3395469782),s=hn(u,5)+o+f+a+t.getUint32(4*h,!1)&4294967295,f=d,d=c,c=hn(l,30),l=u,u=s;this._h0=this._h0+u&4294967295,this._h1=this._h1+l&4294967295,this._h2=this._h2+c&4294967295,this._h3=this._h3+d&4294967295,this._h4=this._h4+f&4294967295}}]),e}();mn._bigBlock32=new DataView(new ArrayBuffer(320));var yn=new RegExp("\\$\\(".concat(wr.iconNameExpression,"(?:").concat(wr.iconModifierExpression,")?\\)"),"g");new RegExp("(\\\\)?".concat(yn.source),"g");new RegExp("\\\\".concat(yn.source),"g");new RegExp("(\\s)?(\\\\)?".concat(yn.source,"(\\s)?"),"g");var bn,_n;(_n=bn||(bn={}))[_n.Paragraph=0]="Paragraph",_n[_n.Break=1]="Break";var wn,Sn,En,kn,Mn,Cn,In,Tn,Rn,xn=function(){"use strict";function e(t){(0,a.default)(this,e),this._prefix=t,this._lastId=0}return(0,s.default)(e,[{key:"nextId",value:function(){return this._prefix+ ++this._lastId}}]),e}();new xn("id#");(Sn=wn||(wn={}))[Sn.None=0]="None",Sn[Sn.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",Sn[Sn.UnexpectedEndOfString=2]="UnexpectedEndOfString",Sn[Sn.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",Sn[Sn.InvalidUnicode=4]="InvalidUnicode",Sn[Sn.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",Sn[Sn.InvalidCharacter=6]="InvalidCharacter",(kn=En||(En={}))[kn.OpenBraceToken=1]="OpenBraceToken",kn[kn.CloseBraceToken=2]="CloseBraceToken",kn[kn.OpenBracketToken=3]="OpenBracketToken",kn[kn.CloseBracketToken=4]="CloseBracketToken",kn[kn.CommaToken=5]="CommaToken",kn[kn.ColonToken=6]="ColonToken",kn[kn.NullKeyword=7]="NullKeyword",kn[kn.TrueKeyword=8]="TrueKeyword",kn[kn.FalseKeyword=9]="FalseKeyword",kn[kn.StringLiteral=10]="StringLiteral",kn[kn.NumericLiteral=11]="NumericLiteral",kn[kn.LineCommentTrivia=12]="LineCommentTrivia",kn[kn.BlockCommentTrivia=13]="BlockCommentTrivia",kn[kn.LineBreakTrivia=14]="LineBreakTrivia",kn[kn.Trivia=15]="Trivia",kn[kn.Unknown=16]="Unknown",kn[kn.EOF=17]="EOF",(Cn=Mn||(Mn={}))[Cn.InvalidSymbol=1]="InvalidSymbol",Cn[Cn.InvalidNumberFormat=2]="InvalidNumberFormat",Cn[Cn.PropertyNameExpected=3]="PropertyNameExpected",Cn[Cn.ValueExpected=4]="ValueExpected",Cn[Cn.ColonExpected=5]="ColonExpected",Cn[Cn.CommaExpected=6]="CommaExpected",Cn[Cn.CloseBraceExpected=7]="CloseBraceExpected",Cn[Cn.CloseBracketExpected=8]="CloseBracketExpected",Cn[Cn.EndOfFileExpected=9]="EndOfFileExpected",Cn[Cn.InvalidCommentToken=10]="InvalidCommentToken",Cn[Cn.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",Cn[Cn.UnexpectedEndOfString=12]="UnexpectedEndOfString",Cn[Cn.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",Cn[Cn.InvalidUnicode=14]="InvalidUnicode",Cn[Cn.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",Cn[Cn.InvalidCharacter=16]="InvalidCharacter",(In||(In={})).DEFAULT={allowTrailingComma:!0},(Rn=Tn||(Tn={}))[Rn.nullCharacter=0]="nullCharacter",Rn[Rn.maxAsciiCharacter=127]="maxAsciiCharacter",Rn[Rn.lineFeed=10]="lineFeed",Rn[Rn.carriageReturn=13]="carriageReturn",Rn[Rn.lineSeparator=8232]="lineSeparator",Rn[Rn.paragraphSeparator=8233]="paragraphSeparator",Rn[Rn.nextLine=133]="nextLine",Rn[Rn.space=32]="space",Rn[Rn.nonBreakingSpace=160]="nonBreakingSpace",Rn[Rn.enQuad=8192]="enQuad",Rn[Rn.emQuad=8193]="emQuad",Rn[Rn.enSpace=8194]="enSpace",Rn[Rn.emSpace=8195]="emSpace",Rn[Rn.threePerEmSpace=8196]="threePerEmSpace",Rn[Rn.fourPerEmSpace=8197]="fourPerEmSpace",Rn[Rn.sixPerEmSpace=8198]="sixPerEmSpace",Rn[Rn.figureSpace=8199]="figureSpace",Rn[Rn.punctuationSpace=8200]="punctuationSpace",Rn[Rn.thinSpace=8201]="thinSpace",Rn[Rn.hairSpace=8202]="hairSpace",Rn[Rn.zeroWidthSpace=8203]="zeroWidthSpace",Rn[Rn.narrowNoBreakSpace=8239]="narrowNoBreakSpace",Rn[Rn.ideographicSpace=12288]="ideographicSpace",Rn[Rn.mathematicalSpace=8287]="mathematicalSpace",Rn[Rn.ogham=5760]="ogham",Rn[Rn._=95]="_",Rn[Rn.$=36]="$",Rn[Rn._0=48]="_0",Rn[Rn._1=49]="_1",Rn[Rn._2=50]="_2",Rn[Rn._3=51]="_3",Rn[Rn._4=52]="_4",Rn[Rn._5=53]="_5",Rn[Rn._6=54]="_6",Rn[Rn._7=55]="_7",Rn[Rn._8=56]="_8",Rn[Rn._9=57]="_9",Rn[Rn.a=97]="a",Rn[Rn.b=98]="b",Rn[Rn.c=99]="c",Rn[Rn.d=100]="d",Rn[Rn.e=101]="e",Rn[Rn.f=102]="f",Rn[Rn.g=103]="g",Rn[Rn.h=104]="h",Rn[Rn.i=105]="i",Rn[Rn.j=106]="j",Rn[Rn.k=107]="k",Rn[Rn.l=108]="l",Rn[Rn.m=109]="m",Rn[Rn.n=110]="n",Rn[Rn.o=111]="o",Rn[Rn.p=112]="p",Rn[Rn.q=113]="q",Rn[Rn.r=114]="r",Rn[Rn.s=115]="s",Rn[Rn.t=116]="t",Rn[Rn.u=117]="u",Rn[Rn.v=118]="v",Rn[Rn.w=119]="w",Rn[Rn.x=120]="x",Rn[Rn.y=121]="y",Rn[Rn.z=122]="z",Rn[Rn.A=65]="A",Rn[Rn.B=66]="B",Rn[Rn.C=67]="C",Rn[Rn.D=68]="D",Rn[Rn.E=69]="E",Rn[Rn.F=70]="F",Rn[Rn.G=71]="G",Rn[Rn.H=72]="H",Rn[Rn.I=73]="I",Rn[Rn.J=74]="J",Rn[Rn.K=75]="K",Rn[Rn.L=76]="L",Rn[Rn.M=77]="M",Rn[Rn.N=78]="N",Rn[Rn.O=79]="O",Rn[Rn.P=80]="P",Rn[Rn.Q=81]="Q",Rn[Rn.R=82]="R",Rn[Rn.S=83]="S",Rn[Rn.T=84]="T",Rn[Rn.U=85]="U",Rn[Rn.V=86]="V",Rn[Rn.W=87]="W",Rn[Rn.X=88]="X",Rn[Rn.Y=89]="Y",Rn[Rn.Z=90]="Z",Rn[Rn.ampersand=38]="ampersand",Rn[Rn.asterisk=42]="asterisk",Rn[Rn.at=64]="at",Rn[Rn.backslash=92]="backslash",Rn[Rn.bar=124]="bar",Rn[Rn.caret=94]="caret",Rn[Rn.closeBrace=125]="closeBrace",Rn[Rn.closeBracket=93]="closeBracket",Rn[Rn.closeParen=41]="closeParen",Rn[Rn.colon=58]="colon",Rn[Rn.comma=44]="comma",Rn[Rn.dot=46]="dot",Rn[Rn.doubleQuote=34]="doubleQuote",Rn[Rn.equals=61]="equals",Rn[Rn.exclamation=33]="exclamation",Rn[Rn.greaterThan=62]="greaterThan",Rn[Rn.lessThan=60]="lessThan",Rn[Rn.minus=45]="minus",Rn[Rn.openBrace=123]="openBrace",Rn[Rn.openBracket=91]="openBracket",Rn[Rn.openParen=40]="openParen",Rn[Rn.percent=37]="percent",Rn[Rn.plus=43]="plus",Rn[Rn.question=63]="question",Rn[Rn.semicolon=59]="semicolon",Rn[Rn.singleQuote=39]="singleQuote",Rn[Rn.slash=47]="slash",Rn[Rn.tilde=126]="tilde",Rn[Rn.backspace=8]="backspace",Rn[Rn.formFeed=12]="formFeed",Rn[Rn.byteOrderMark=65279]="byteOrderMark",Rn[Rn.tab=9]="tab",Rn[Rn.verticalTab=11]="verticalTab";var On,An;(An=On||(On={}))[An.DependsOnKbLayout=-1]="DependsOnKbLayout",An[An.Unknown=0]="Unknown",An[An.Backspace=1]="Backspace",An[An.Tab=2]="Tab",An[An.Enter=3]="Enter",An[An.Shift=4]="Shift",An[An.Ctrl=5]="Ctrl",An[An.Alt=6]="Alt",An[An.PauseBreak=7]="PauseBreak",An[An.CapsLock=8]="CapsLock",An[An.Escape=9]="Escape",An[An.Space=10]="Space",An[An.PageUp=11]="PageUp",An[An.PageDown=12]="PageDown",An[An.End=13]="End",An[An.Home=14]="Home",An[An.LeftArrow=15]="LeftArrow",An[An.UpArrow=16]="UpArrow",An[An.RightArrow=17]="RightArrow",An[An.DownArrow=18]="DownArrow",An[An.Insert=19]="Insert",An[An.Delete=20]="Delete",An[An.KEY_0=21]="KEY_0",An[An.KEY_1=22]="KEY_1",An[An.KEY_2=23]="KEY_2",An[An.KEY_3=24]="KEY_3",An[An.KEY_4=25]="KEY_4",An[An.KEY_5=26]="KEY_5",An[An.KEY_6=27]="KEY_6",An[An.KEY_7=28]="KEY_7",An[An.KEY_8=29]="KEY_8",An[An.KEY_9=30]="KEY_9",An[An.KEY_A=31]="KEY_A",An[An.KEY_B=32]="KEY_B",An[An.KEY_C=33]="KEY_C",An[An.KEY_D=34]="KEY_D",An[An.KEY_E=35]="KEY_E",An[An.KEY_F=36]="KEY_F",An[An.KEY_G=37]="KEY_G",An[An.KEY_H=38]="KEY_H",An[An.KEY_I=39]="KEY_I",An[An.KEY_J=40]="KEY_J",An[An.KEY_K=41]="KEY_K",An[An.KEY_L=42]="KEY_L",An[An.KEY_M=43]="KEY_M",An[An.KEY_N=44]="KEY_N",An[An.KEY_O=45]="KEY_O",An[An.KEY_P=46]="KEY_P",An[An.KEY_Q=47]="KEY_Q",An[An.KEY_R=48]="KEY_R",An[An.KEY_S=49]="KEY_S",An[An.KEY_T=50]="KEY_T",An[An.KEY_U=51]="KEY_U",An[An.KEY_V=52]="KEY_V",An[An.KEY_W=53]="KEY_W",An[An.KEY_X=54]="KEY_X",An[An.KEY_Y=55]="KEY_Y",An[An.KEY_Z=56]="KEY_Z",An[An.Meta=57]="Meta",An[An.ContextMenu=58]="ContextMenu",An[An.F1=59]="F1",An[An.F2=60]="F2",An[An.F3=61]="F3",An[An.F4=62]="F4",An[An.F5=63]="F5",An[An.F6=64]="F6",An[An.F7=65]="F7",An[An.F8=66]="F8",An[An.F9=67]="F9",An[An.F10=68]="F10",An[An.F11=69]="F11",An[An.F12=70]="F12",An[An.F13=71]="F13",An[An.F14=72]="F14",An[An.F15=73]="F15",An[An.F16=74]="F16",An[An.F17=75]="F17",An[An.F18=76]="F18",An[An.F19=77]="F19",An[An.NumLock=78]="NumLock",An[An.ScrollLock=79]="ScrollLock",An[An.US_SEMICOLON=80]="US_SEMICOLON",An[An.US_EQUAL=81]="US_EQUAL",An[An.US_COMMA=82]="US_COMMA",An[An.US_MINUS=83]="US_MINUS",An[An.US_DOT=84]="US_DOT",An[An.US_SLASH=85]="US_SLASH",An[An.US_BACKTICK=86]="US_BACKTICK",An[An.US_OPEN_SQUARE_BRACKET=87]="US_OPEN_SQUARE_BRACKET",An[An.US_BACKSLASH=88]="US_BACKSLASH",An[An.US_CLOSE_SQUARE_BRACKET=89]="US_CLOSE_SQUARE_BRACKET",An[An.US_QUOTE=90]="US_QUOTE",An[An.OEM_8=91]="OEM_8",An[An.OEM_102=92]="OEM_102",An[An.NUMPAD_0=93]="NUMPAD_0",An[An.NUMPAD_1=94]="NUMPAD_1",An[An.NUMPAD_2=95]="NUMPAD_2",An[An.NUMPAD_3=96]="NUMPAD_3",An[An.NUMPAD_4=97]="NUMPAD_4",An[An.NUMPAD_5=98]="NUMPAD_5",An[An.NUMPAD_6=99]="NUMPAD_6",An[An.NUMPAD_7=100]="NUMPAD_7",An[An.NUMPAD_8=101]="NUMPAD_8",An[An.NUMPAD_9=102]="NUMPAD_9",An[An.NUMPAD_MULTIPLY=103]="NUMPAD_MULTIPLY",An[An.NUMPAD_ADD=104]="NUMPAD_ADD",An[An.NUMPAD_SEPARATOR=105]="NUMPAD_SEPARATOR",An[An.NUMPAD_SUBTRACT=106]="NUMPAD_SUBTRACT",An[An.NUMPAD_DECIMAL=107]="NUMPAD_DECIMAL",An[An.NUMPAD_DIVIDE=108]="NUMPAD_DIVIDE",An[An.KEY_IN_COMPOSITION=109]="KEY_IN_COMPOSITION",An[An.ABNT_C1=110]="ABNT_C1",An[An.ABNT_C2=111]="ABNT_C2",An[An.MAX_VALUE=112]="MAX_VALUE";var Dn,Pn,Ln,Un,jn,Nn,Bn=function(){"use strict";function e(){(0,a.default)(this,e),this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}return(0,s.default)(e,[{key:"define",value:function(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}},{key:"keyCodeToStr",value:function(e){return this._keyCodeToStr[e]}},{key:"strToKeyCode",value:function(e){return this._strToKeyCode[e.toLowerCase()]||0}}]),e}(),Fn=new Bn,Kn=new Bn,qn=new Bn;!function(){function e(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;Fn.define(e,t),Kn.define(e,r),qn.define(e,n)}e(0,"unknown"),e(1,"Backspace"),e(2,"Tab"),e(3,"Enter"),e(4,"Shift"),e(5,"Ctrl"),e(6,"Alt"),e(7,"PauseBreak"),e(8,"CapsLock"),e(9,"Escape"),e(10,"Space"),e(11,"PageUp"),e(12,"PageDown"),e(13,"End"),e(14,"Home"),e(15,"LeftArrow","Left"),e(16,"UpArrow","Up"),e(17,"RightArrow","Right"),e(18,"DownArrow","Down"),e(19,"Insert"),e(20,"Delete"),e(21,"0"),e(22,"1"),e(23,"2"),e(24,"3"),e(25,"4"),e(26,"5"),e(27,"6"),e(28,"7"),e(29,"8"),e(30,"9"),e(31,"A"),e(32,"B"),e(33,"C"),e(34,"D"),e(35,"E"),e(36,"F"),e(37,"G"),e(38,"H"),e(39,"I"),e(40,"J"),e(41,"K"),e(42,"L"),e(43,"M"),e(44,"N"),e(45,"O"),e(46,"P"),e(47,"Q"),e(48,"R"),e(49,"S"),e(50,"T"),e(51,"U"),e(52,"V"),e(53,"W"),e(54,"X"),e(55,"Y"),e(56,"Z"),e(57,"Meta"),e(58,"ContextMenu"),e(59,"F1"),e(60,"F2"),e(61,"F3"),e(62,"F4"),e(63,"F5"),e(64,"F6"),e(65,"F7"),e(66,"F8"),e(67,"F9"),e(68,"F10"),e(69,"F11"),e(70,"F12"),e(71,"F13"),e(72,"F14"),e(73,"F15"),e(74,"F16"),e(75,"F17"),e(76,"F18"),e(77,"F19"),e(78,"NumLock"),e(79,"ScrollLock"),e(80,";",";","OEM_1"),e(81,"=","=","OEM_PLUS"),e(82,",",",","OEM_COMMA"),e(83,"-","-","OEM_MINUS"),e(84,".",".","OEM_PERIOD"),e(85,"/","/","OEM_2"),e(86,"`","`","OEM_3"),e(110,"ABNT_C1"),e(111,"ABNT_C2"),e(87,"[","[","OEM_4"),e(88,"\\","\\","OEM_5"),e(89,"]","]","OEM_6"),e(90,"'","'","OEM_7"),e(91,"OEM_8"),e(92,"OEM_102"),e(93,"NumPad0"),e(94,"NumPad1"),e(95,"NumPad2"),e(96,"NumPad3"),e(97,"NumPad4"),e(98,"NumPad5"),e(99,"NumPad6"),e(100,"NumPad7"),e(101,"NumPad8"),e(102,"NumPad9"),e(103,"NumPad_Multiply"),e(104,"NumPad_Add"),e(105,"NumPad_Separator"),e(106,"NumPad_Subtract"),e(107,"NumPad_Decimal"),e(108,"NumPad_Divide")}(),(Pn=Dn||(Dn={})).toString=function(e){return Fn.keyCodeToStr(e)},Pn.fromString=function(e){return Fn.strToKeyCode(e)},Pn.toUserSettingsUS=function(e){return Kn.keyCodeToStr(e)},Pn.toUserSettingsGeneral=function(e){return qn.keyCodeToStr(e)},Pn.fromUserSettings=function(e){return Kn.strToKeyCode(e)||qn.strToKeyCode(e)},(Un=Ln||(Ln={}))[Un.CtrlCmd=2048]="CtrlCmd",Un[Un.Shift=1024]="Shift",Un[Un.Alt=512]="Alt",Un[Un.WinCtrl=256]="WinCtrl",Un[Un.KeyCode=255]="KeyCode",(Nn=jn||(jn={}))[Nn.CtrlCmd=2048]="CtrlCmd",Nn[Nn.Shift=1024]="Shift",Nn[Nn.Alt=512]="Alt",Nn[Nn.WinCtrl=256]="WinCtrl";var Wn=function(){"use strict";function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;(0,a.default)(this,e),this.modifierLabels=[null],this.modifierLabels[2]=t,this.modifierLabels[1]=r,this.modifierLabels[3]=n}return(0,s.default)(e,[{key:"toLabel",value:function(e,t,r){if(0===t.length)return null;for(var n=[],i=0,o=t.length;i<o;i++){var a=t[i],s=r(a);if(null===s)return null;n[i]=Vn(a,s,this.modifierLabels[e])}return n.join(" ")}}]),e}();new Wn({ctrlKey:"⌃",shiftKey:"⇧",altKey:"⌥",metaKey:"⌘",separator:""},{ctrlKey:_({key:"ctrlKey",comment:["This is the short form for the Control key on the keyboard"]},"Ctrl"),shiftKey:_({key:"shiftKey",comment:["This is the short form for the Shift key on the keyboard"]},"Shift"),altKey:_({key:"altKey",comment:["This is the short form for the Alt key on the keyboard"]},"Alt"),metaKey:_({key:"windowsKey",comment:["This is the short form for the Windows key on the keyboard"]},"Windows"),separator:"+"},{ctrlKey:_({key:"ctrlKey",comment:["This is the short form for the Control key on the keyboard"]},"Ctrl"),shiftKey:_({key:"shiftKey",comment:["This is the short form for the Shift key on the keyboard"]},"Shift"),altKey:_({key:"altKey",comment:["This is the short form for the Alt key on the keyboard"]},"Alt"),metaKey:_({key:"superKey",comment:["This is the short form for the Super key on the keyboard"]},"Super"),separator:"+"}),new Wn({ctrlKey:_({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:_({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:_({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:_({key:"cmdKey.long",comment:["This is the long form for the Command key on the keyboard"]},"Command"),separator:"+"},{ctrlKey:_({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:_({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:_({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:_({key:"windowsKey.long",comment:["This is the long form for the Windows key on the keyboard"]},"Windows"),separator:"+"},{ctrlKey:_({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:_({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:_({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:_({key:"superKey.long",comment:["This is the long form for the Super key on the keyboard"]},"Super"),separator:"+"}),new Wn({ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Cmd",separator:"+"},{ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Super",separator:"+"}),new Wn({ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"cmd",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"win",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"meta",separator:"+"});function Vn(e,t,r){if(null===t)return"";var n=[];return e.ctrlKey&&n.push(r.ctrlKey),e.shiftKey&&n.push(r.shiftKey),e.altKey&&n.push(r.altKey),e.metaKey&&n.push(r.metaKey),""!==t&&n.push(t),n.join(r.separator)}var Hn,Gn;(Gn=Hn||(Hn={}))[Gn.DependsOnKbLayout=-1]="DependsOnKbLayout",Gn[Gn.None=0]="None",Gn[Gn.Hyper=1]="Hyper",Gn[Gn.Super=2]="Super",Gn[Gn.Fn=3]="Fn",Gn[Gn.FnLock=4]="FnLock",Gn[Gn.Suspend=5]="Suspend",Gn[Gn.Resume=6]="Resume",Gn[Gn.Turbo=7]="Turbo",Gn[Gn.Sleep=8]="Sleep",Gn[Gn.WakeUp=9]="WakeUp",Gn[Gn.KeyA=10]="KeyA",Gn[Gn.KeyB=11]="KeyB",Gn[Gn.KeyC=12]="KeyC",Gn[Gn.KeyD=13]="KeyD",Gn[Gn.KeyE=14]="KeyE",Gn[Gn.KeyF=15]="KeyF",Gn[Gn.KeyG=16]="KeyG",Gn[Gn.KeyH=17]="KeyH",Gn[Gn.KeyI=18]="KeyI",Gn[Gn.KeyJ=19]="KeyJ",Gn[Gn.KeyK=20]="KeyK",Gn[Gn.KeyL=21]="KeyL",Gn[Gn.KeyM=22]="KeyM",Gn[Gn.KeyN=23]="KeyN",Gn[Gn.KeyO=24]="KeyO",Gn[Gn.KeyP=25]="KeyP",Gn[Gn.KeyQ=26]="KeyQ",Gn[Gn.KeyR=27]="KeyR",Gn[Gn.KeyS=28]="KeyS",Gn[Gn.KeyT=29]="KeyT",Gn[Gn.KeyU=30]="KeyU",Gn[Gn.KeyV=31]="KeyV",Gn[Gn.KeyW=32]="KeyW",Gn[Gn.KeyX=33]="KeyX",Gn[Gn.KeyY=34]="KeyY",Gn[Gn.KeyZ=35]="KeyZ",Gn[Gn.Digit1=36]="Digit1",Gn[Gn.Digit2=37]="Digit2",Gn[Gn.Digit3=38]="Digit3",Gn[Gn.Digit4=39]="Digit4",Gn[Gn.Digit5=40]="Digit5",Gn[Gn.Digit6=41]="Digit6",Gn[Gn.Digit7=42]="Digit7",Gn[Gn.Digit8=43]="Digit8",Gn[Gn.Digit9=44]="Digit9",Gn[Gn.Digit0=45]="Digit0",Gn[Gn.Enter=46]="Enter",Gn[Gn.Escape=47]="Escape",Gn[Gn.Backspace=48]="Backspace",Gn[Gn.Tab=49]="Tab",Gn[Gn.Space=50]="Space",Gn[Gn.Minus=51]="Minus",Gn[Gn.Equal=52]="Equal",Gn[Gn.BracketLeft=53]="BracketLeft",Gn[Gn.BracketRight=54]="BracketRight",Gn[Gn.Backslash=55]="Backslash",Gn[Gn.IntlHash=56]="IntlHash",Gn[Gn.Semicolon=57]="Semicolon",Gn[Gn.Quote=58]="Quote",Gn[Gn.Backquote=59]="Backquote",Gn[Gn.Comma=60]="Comma",Gn[Gn.Period=61]="Period",Gn[Gn.Slash=62]="Slash",Gn[Gn.CapsLock=63]="CapsLock",Gn[Gn.F1=64]="F1",Gn[Gn.F2=65]="F2",Gn[Gn.F3=66]="F3",Gn[Gn.F4=67]="F4",Gn[Gn.F5=68]="F5",Gn[Gn.F6=69]="F6",Gn[Gn.F7=70]="F7",Gn[Gn.F8=71]="F8",Gn[Gn.F9=72]="F9",Gn[Gn.F10=73]="F10",Gn[Gn.F11=74]="F11",Gn[Gn.F12=75]="F12",Gn[Gn.PrintScreen=76]="PrintScreen",Gn[Gn.ScrollLock=77]="ScrollLock",Gn[Gn.Pause=78]="Pause",Gn[Gn.Insert=79]="Insert",Gn[Gn.Home=80]="Home",Gn[Gn.PageUp=81]="PageUp",Gn[Gn.Delete=82]="Delete",Gn[Gn.End=83]="End",Gn[Gn.PageDown=84]="PageDown",Gn[Gn.ArrowRight=85]="ArrowRight",Gn[Gn.ArrowLeft=86]="ArrowLeft",Gn[Gn.ArrowDown=87]="ArrowDown",Gn[Gn.ArrowUp=88]="ArrowUp",Gn[Gn.NumLock=89]="NumLock",Gn[Gn.NumpadDivide=90]="NumpadDivide",Gn[Gn.NumpadMultiply=91]="NumpadMultiply",Gn[Gn.NumpadSubtract=92]="NumpadSubtract",Gn[Gn.NumpadAdd=93]="NumpadAdd",Gn[Gn.NumpadEnter=94]="NumpadEnter",Gn[Gn.Numpad1=95]="Numpad1",Gn[Gn.Numpad2=96]="Numpad2",Gn[Gn.Numpad3=97]="Numpad3",Gn[Gn.Numpad4=98]="Numpad4",Gn[Gn.Numpad5=99]="Numpad5",Gn[Gn.Numpad6=100]="Numpad6",Gn[Gn.Numpad7=101]="Numpad7",Gn[Gn.Numpad8=102]="Numpad8",Gn[Gn.Numpad9=103]="Numpad9",Gn[Gn.Numpad0=104]="Numpad0",Gn[Gn.NumpadDecimal=105]="NumpadDecimal",Gn[Gn.IntlBackslash=106]="IntlBackslash",Gn[Gn.ContextMenu=107]="ContextMenu",Gn[Gn.Power=108]="Power",Gn[Gn.NumpadEqual=109]="NumpadEqual",Gn[Gn.F13=110]="F13",Gn[Gn.F14=111]="F14",Gn[Gn.F15=112]="F15",Gn[Gn.F16=113]="F16",Gn[Gn.F17=114]="F17",Gn[Gn.F18=115]="F18",Gn[Gn.F19=116]="F19",Gn[Gn.F20=117]="F20",Gn[Gn.F21=118]="F21",Gn[Gn.F22=119]="F22",Gn[Gn.F23=120]="F23",Gn[Gn.F24=121]="F24",Gn[Gn.Open=122]="Open",Gn[Gn.Help=123]="Help",Gn[Gn.Select=124]="Select",Gn[Gn.Again=125]="Again",Gn[Gn.Undo=126]="Undo",Gn[Gn.Cut=127]="Cut",Gn[Gn.Copy=128]="Copy",Gn[Gn.Paste=129]="Paste",Gn[Gn.Find=130]="Find",Gn[Gn.AudioVolumeMute=131]="AudioVolumeMute",Gn[Gn.AudioVolumeUp=132]="AudioVolumeUp",Gn[Gn.AudioVolumeDown=133]="AudioVolumeDown",Gn[Gn.NumpadComma=134]="NumpadComma",Gn[Gn.IntlRo=135]="IntlRo",Gn[Gn.KanaMode=136]="KanaMode",Gn[Gn.IntlYen=137]="IntlYen",Gn[Gn.Convert=138]="Convert",Gn[Gn.NonConvert=139]="NonConvert",Gn[Gn.Lang1=140]="Lang1",Gn[Gn.Lang2=141]="Lang2",Gn[Gn.Lang3=142]="Lang3",Gn[Gn.Lang4=143]="Lang4",Gn[Gn.Lang5=144]="Lang5",Gn[Gn.Abort=145]="Abort",Gn[Gn.Props=146]="Props",Gn[Gn.NumpadParenLeft=147]="NumpadParenLeft",Gn[Gn.NumpadParenRight=148]="NumpadParenRight",Gn[Gn.NumpadBackspace=149]="NumpadBackspace",Gn[Gn.NumpadMemoryStore=150]="NumpadMemoryStore",Gn[Gn.NumpadMemoryRecall=151]="NumpadMemoryRecall",Gn[Gn.NumpadMemoryClear=152]="NumpadMemoryClear",Gn[Gn.NumpadMemoryAdd=153]="NumpadMemoryAdd",Gn[Gn.NumpadMemorySubtract=154]="NumpadMemorySubtract",Gn[Gn.NumpadClear=155]="NumpadClear",Gn[Gn.NumpadClearEntry=156]="NumpadClearEntry",Gn[Gn.ControlLeft=157]="ControlLeft",Gn[Gn.ShiftLeft=158]="ShiftLeft",Gn[Gn.AltLeft=159]="AltLeft",Gn[Gn.MetaLeft=160]="MetaLeft",Gn[Gn.ControlRight=161]="ControlRight",Gn[Gn.ShiftRight=162]="ShiftRight",Gn[Gn.AltRight=163]="AltRight",Gn[Gn.MetaRight=164]="MetaRight",Gn[Gn.BrightnessUp=165]="BrightnessUp",Gn[Gn.BrightnessDown=166]="BrightnessDown",Gn[Gn.MediaPlay=167]="MediaPlay",Gn[Gn.MediaRecord=168]="MediaRecord",Gn[Gn.MediaFastForward=169]="MediaFastForward",Gn[Gn.MediaRewind=170]="MediaRewind",Gn[Gn.MediaTrackNext=171]="MediaTrackNext",Gn[Gn.MediaTrackPrevious=172]="MediaTrackPrevious",Gn[Gn.MediaStop=173]="MediaStop",Gn[Gn.Eject=174]="Eject",Gn[Gn.MediaPlayPause=175]="MediaPlayPause",Gn[Gn.MediaSelect=176]="MediaSelect",Gn[Gn.LaunchMail=177]="LaunchMail",Gn[Gn.LaunchApp2=178]="LaunchApp2",Gn[Gn.LaunchApp1=179]="LaunchApp1",Gn[Gn.SelectTask=180]="SelectTask",Gn[Gn.LaunchScreenSaver=181]="LaunchScreenSaver",Gn[Gn.BrowserSearch=182]="BrowserSearch",Gn[Gn.BrowserHome=183]="BrowserHome",Gn[Gn.BrowserBack=184]="BrowserBack",Gn[Gn.BrowserForward=185]="BrowserForward",Gn[Gn.BrowserStop=186]="BrowserStop",Gn[Gn.BrowserRefresh=187]="BrowserRefresh",Gn[Gn.BrowserFavorites=188]="BrowserFavorites",Gn[Gn.ZoomToggle=189]="ZoomToggle",Gn[Gn.MailReply=190]="MailReply",Gn[Gn.MailForward=191]="MailForward",Gn[Gn.MailSend=192]="MailSend",Gn[Gn.MAX_VALUE=193]="MAX_VALUE";var zn=[],Yn=Object.create(null),Zn=Object.create(null),$n=[],Jn=[];!function(){function e(e,t){zn[e]=t,Yn[t]=e,Zn[t.toLowerCase()]=e}e(0,"None"),e(1,"Hyper"),e(2,"Super"),e(3,"Fn"),e(4,"FnLock"),e(5,"Suspend"),e(6,"Resume"),e(7,"Turbo"),e(8,"Sleep"),e(9,"WakeUp"),e(10,"KeyA"),e(11,"KeyB"),e(12,"KeyC"),e(13,"KeyD"),e(14,"KeyE"),e(15,"KeyF"),e(16,"KeyG"),e(17,"KeyH"),e(18,"KeyI"),e(19,"KeyJ"),e(20,"KeyK"),e(21,"KeyL"),e(22,"KeyM"),e(23,"KeyN"),e(24,"KeyO"),e(25,"KeyP"),e(26,"KeyQ"),e(27,"KeyR"),e(28,"KeyS"),e(29,"KeyT"),e(30,"KeyU"),e(31,"KeyV"),e(32,"KeyW"),e(33,"KeyX"),e(34,"KeyY"),e(35,"KeyZ"),e(36,"Digit1"),e(37,"Digit2"),e(38,"Digit3"),e(39,"Digit4"),e(40,"Digit5"),e(41,"Digit6"),e(42,"Digit7"),e(43,"Digit8"),e(44,"Digit9"),e(45,"Digit0"),e(46,"Enter"),e(47,"Escape"),e(48,"Backspace"),e(49,"Tab"),e(50,"Space"),e(51,"Minus"),e(52,"Equal"),e(53,"BracketLeft"),e(54,"BracketRight"),e(55,"Backslash"),e(56,"IntlHash"),e(57,"Semicolon"),e(58,"Quote"),e(59,"Backquote"),e(60,"Comma"),e(61,"Period"),e(62,"Slash"),e(63,"CapsLock"),e(64,"F1"),e(65,"F2"),e(66,"F3"),e(67,"F4"),e(68,"F5"),e(69,"F6"),e(70,"F7"),e(71,"F8"),e(72,"F9"),e(73,"F10"),e(74,"F11"),e(75,"F12"),e(76,"PrintScreen"),e(77,"ScrollLock"),e(78,"Pause"),e(79,"Insert"),e(80,"Home"),e(81,"PageUp"),e(82,"Delete"),e(83,"End"),e(84,"PageDown"),e(85,"ArrowRight"),e(86,"ArrowLeft"),e(87,"ArrowDown"),e(88,"ArrowUp"),e(89,"NumLock"),e(90,"NumpadDivide"),e(91,"NumpadMultiply"),e(92,"NumpadSubtract"),e(93,"NumpadAdd"),e(94,"NumpadEnter"),e(95,"Numpad1"),e(96,"Numpad2"),e(97,"Numpad3"),e(98,"Numpad4"),e(99,"Numpad5"),e(100,"Numpad6"),e(101,"Numpad7"),e(102,"Numpad8"),e(103,"Numpad9"),e(104,"Numpad0"),e(105,"NumpadDecimal"),e(106,"IntlBackslash"),e(107,"ContextMenu"),e(108,"Power"),e(109,"NumpadEqual"),e(110,"F13"),e(111,"F14"),e(112,"F15"),e(113,"F16"),e(114,"F17"),e(115,"F18"),e(116,"F19"),e(117,"F20"),e(118,"F21"),e(119,"F22"),e(120,"F23"),e(121,"F24"),e(122,"Open"),e(123,"Help"),e(124,"Select"),e(125,"Again"),e(126,"Undo"),e(127,"Cut"),e(128,"Copy"),e(129,"Paste"),e(130,"Find"),e(131,"AudioVolumeMute"),e(132,"AudioVolumeUp"),e(133,"AudioVolumeDown"),e(134,"NumpadComma"),e(135,"IntlRo"),e(136,"KanaMode"),e(137,"IntlYen"),e(138,"Convert"),e(139,"NonConvert"),e(140,"Lang1"),e(141,"Lang2"),e(142,"Lang3"),e(143,"Lang4"),e(144,"Lang5"),e(145,"Abort"),e(146,"Props"),e(147,"NumpadParenLeft"),e(148,"NumpadParenRight"),e(149,"NumpadBackspace"),e(150,"NumpadMemoryStore"),e(151,"NumpadMemoryRecall"),e(152,"NumpadMemoryClear"),e(153,"NumpadMemoryAdd"),e(154,"NumpadMemorySubtract"),e(155,"NumpadClear"),e(156,"NumpadClearEntry"),e(157,"ControlLeft"),e(158,"ShiftLeft"),e(159,"AltLeft"),e(160,"MetaLeft"),e(161,"ControlRight"),e(162,"ShiftRight"),e(163,"AltRight"),e(164,"MetaRight"),e(165,"BrightnessUp"),e(166,"BrightnessDown"),e(167,"MediaPlay"),e(168,"MediaRecord"),e(169,"MediaFastForward"),e(170,"MediaRewind"),e(171,"MediaTrackNext"),e(172,"MediaTrackPrevious"),e(173,"MediaStop"),e(174,"Eject"),e(175,"MediaPlayPause"),e(176,"MediaSelect"),e(177,"LaunchMail"),e(178,"LaunchApp2"),e(179,"LaunchApp1"),e(180,"SelectTask"),e(181,"LaunchScreenSaver"),e(182,"BrowserSearch"),e(183,"BrowserHome"),e(184,"BrowserBack"),e(185,"BrowserForward"),e(186,"BrowserStop"),e(187,"BrowserRefresh"),e(188,"BrowserFavorites"),e(189,"ZoomToggle"),e(190,"MailReply"),e(191,"MailForward"),e(192,"MailSend")}(),function(){for(var e=0;e<=193;e++)$n[e]=-1;for(var t=0;t<=112;t++)Jn[t]=-1;function r(e,t){$n[e]=t,0!==t&&3!==t&&5!==t&&4!==t&&6!==t&&57!==t&&(Jn[t]=e)}Jn[3]=46,r(0,0),r(1,0),r(2,0),r(3,0),r(4,0),r(5,0),r(6,0),r(7,0),r(8,0),r(9,0),r(46,3),r(47,9),r(48,1),r(49,2),r(50,10),r(63,8),r(64,59),r(65,60),r(66,61),r(67,62),r(68,63),r(69,64),r(70,65),r(71,66),r(72,67),r(73,68),r(74,69),r(75,70),r(76,0),r(77,79),r(78,7),r(79,19),r(80,14),r(81,11),r(82,20),r(83,13),r(84,12),r(85,17),r(86,15),r(87,18),r(88,16),r(89,78),r(90,108),r(91,103),r(92,106),r(93,104),r(94,3),r(95,94),r(96,95),r(97,96),r(98,97),r(99,98),r(100,99),r(101,100),r(102,101),r(103,102),r(104,93),r(105,107),r(107,58),r(108,0),r(109,0),r(110,71),r(111,72),r(112,73),r(113,74),r(114,75),r(115,76),r(116,77),r(117,0),r(118,0),r(119,0),r(120,0),r(121,0),r(122,0),r(123,0),r(124,0),r(125,0),r(126,0),r(127,0),r(128,0),r(129,0),r(130,0),r(131,0),r(132,0),r(133,0),r(134,105),r(136,0),r(138,0),r(139,0),r(140,0),r(141,0),r(142,0),r(143,0),r(144,0),r(145,0),r(146,0),r(147,0),r(148,0),r(149,0),r(150,0),r(151,0),r(152,0),r(153,0),r(154,0),r(155,0),r(156,0),r(157,5),r(158,4),r(159,6),r(160,57),r(161,5),r(162,4),r(163,6),r(164,57),r(165,0),r(166,0),r(167,0),r(168,0),r(169,0),r(170,0),r(171,0),r(172,0),r(173,0),r(174,0),r(175,0),r(176,0),r(177,0),r(178,0),r(179,0),r(180,0),r(181,0),r(182,0),r(183,0),r(184,0),r(185,0),r(186,0),r(187,0),r(188,0),r(189,0),r(190,0),r(191,0),r(192,0)}();Object.create(null);var Qn,Xn;(Xn=Qn||(Qn={}))[Xn.TEXT=0]="TEXT",Xn[Xn.VARIABLE=1]="VARIABLE",Xn[Xn.SEPARATOR=2]="SEPARATOR";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function ei(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}var ti=function(){"use strict";function e(t){(0,a.default)(this,e),this.nodes=t}return(0,s.default)(e,[{key:"toString",value:function(){return this.nodes.map((function(e){return"string"==typeof e?e:e.label})).join("")}}]),e}();ei([Or],ti.prototype,"toString",null);var ri,ni;(ni=ri||(ri={}))[ni.Uri=1]="Uri",ni[ni.Regexp=2]="Regexp",ni[ni.ScmResource=3]="ScmResource",ni[ni.ScmResourceGroup=4]="ScmResourceGroup",ni[ni.ScmProvider=5]="ScmProvider",ni[ni.CommentController=6]="CommentController",ni[ni.CommentThread=7]="CommentThread",ni[ni.CommentThreadReply=8]="CommentThreadReply",ni[ni.CommentNode=9]="CommentNode",ni[ni.CommentThreadNode=10]="CommentThreadNode",ni[ni.TimelineActionContext=11]="TimelineActionContext",ni[ni.NotebookCellActionContext=12]="NotebookCellActionContext",ni[ni.TestItemContext=13]="TestItemContext";var ii,oi;(oi=ii||(ii={})).text="text/plain",oi.binary="application/octet-stream",oi.unknown="application/unknown",oi.markdown="text/markdown";new Fr(1e4);var ai=new Fr(1e4);function si(e){return li(e,"NFD",ai)}var ui=/[^\u0000-\u0080]/;function li(e,t,r){if(!e)return e;var n,i=r.get(e);return i||(ui.test(e)?e.normalize(t):e,r.set(e,n),n)}var ci;ci=/[\u0300-\u036f]/g;var di,fi;(fi=di||(di={}))[fi.OK=0]="OK",fi[fi.Info=1]="Info",fi[fi.Warning=2]="Warning",fi[fi.Error=3]="Error",fi[fi.Fatal=4]="Fatal";var hi,pi,vi,gi;(pi=hi||(hi={}))[pi.stdout=0]="stdout",pi[pi.stderr=1]="stderr",(gi=vi||(vi={}))[gi.Success=0]="Success",gi[gi.Unknown=1]="Unknown",gi[gi.AccessDenied=2]="AccessDenied",gi[gi.ProcessNotFound=3]="ProcessNotFound";var mi;!function(e){function t(e,t){if(e.start>=t.end||t.start>=e.end)return{start:0,end:0};var r=Math.max(e.start,t.start),n=Math.min(e.end,t.end);return n-r<=0?{start:0,end:0}:{start:r,end:n}}function r(e){return e.end-e.start<=0}e.intersect=t,e.isEmpty=r,e.intersects=function(e,n){return!r(t(e,n))},e.relativeComplement=function(e,t){var n=[],i={start:e.start,end:Math.min(t.start,e.end)},o={start:Math.max(t.end,e.start),end:e.end};return r(i)||n.push(i),r(o)||n.push(o),n}}(mi||(mi={}));var yi=function(){"use strict";function e(t,r,n,i,o){(0,a.default)(this,e),this.uri=t,this.relativePath=r,this.context=n,this.element=i,this.parent=o,this._children=new Map}return(0,s.default)(e,[{key:"childrenCount",get:function(){return this._children.size}},{key:"children",get:function(){return this._children.values()}},{key:"name",get:function(){return Mt.basename(this.relativePath)}},{key:"get",value:function(e){return this._children.get(e)}},{key:"set",value:function(e,t){this._children.set(e,t)}},{key:"delete",value:function(e){this._children.delete(e)}},{key:"clear",value:function(){this._children.clear()}}]),e}();ei([Or],yi.prototype,"name",null);var bi,_i;(_i=bi||(bi={}))[_i.Auto=1]="Auto",_i[_i.Hidden=2]="Hidden",_i[_i.Visible=3]="Visible";var wi,Si;(Si=wi||(wi={}))[Si.Ignore=0]="Ignore",Si[Si.Info=1]="Info",Si[Si.Warning=2]="Warning",Si[Si.Error=3]="Error",function(e){var t="error",r="warning",n="info";e.fromValue=function(i){return i?Je(t,i)?e.Error:Je(r,i)||Je("warn",i)?e.Warning:Je(n,i)?e.Info:e.Ignore:e.Ignore},e.toString=function(i){switch(i){case e.Error:return t;case e.Warning:return r;case e.Info:return n;default:return"ignore"}}}(wi||(wi={}));var Ei,ki;(ki=Ei||(Ei={}))[ki.MAX_SAFE_SMALL_INTEGER=1073741824]="MAX_SAFE_SMALL_INTEGER",ki[ki.MIN_SAFE_SMALL_INTEGER=-1073741824]="MIN_SAFE_SMALL_INTEGER",ki[ki.MAX_UINT_8=255]="MAX_UINT_8",ki[ki.MAX_UINT_16=65535]="MAX_UINT_16",ki[ki.MAX_UINT_32=4294967295]="MAX_UINT_32",ki[ki.UNICODE_SUPPLEMENTARY_PLANE_BEGIN=65536]="UNICODE_SUPPLEMENTARY_PLANE_BEGIN";new(function(){"use strict";function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"transformIncoming",value:function(e){return e}},{key:"transformOutgoing",value:function(e){return e}},{key:"transformOutgoingURI",value:function(e){return e}},{key:"transformOutgoingScheme",value:function(e){return e}}]),e}());new Uint8Array(16);for(var Mi=[],Ci=0;Ci<256;Ci++)Mi.push(Ci.toString(16).padStart(2,"0"));"object"==typeof crypto&&"function"==typeof crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)})),n.register("7ZwSr",(function(e,t){for(var r=n("aojpe"),i=/[\\\"\x00-\x1F]/g,o={},a=0;a<32;++a)o[String.fromCharCode(a)]="\\U"+("0000"+a.toString(16)).slice(-4).toUpperCase();function s(e){return i.lastIndex=0,e.replace(i,(function(e){return o[e]}))}function u(e){switch(void 0===e?"undefined":(0,r.default)(e)){case"string":return'"'+s(e)+'"';case"number":return isFinite(e)?e:"null";case"boolean":return e;case"object":return null===e?"null":Array.isArray(e)?function(e){for(var t="[",r="",n=0;n<e.length;++n)r+=t,t=",",r+=u(e[n]);return","!=t?"[]":r+"]"}(e):function(e){var t="{",r="",n=Object.keys(e);n.sort();for(var i=0;i<n.length;++i){var o=n[i];r+=t+'"'+s(o)+'":',t=",",r+=u(e[o])}return","!=t?"{}":r+"}"}(e);default:throw new Error("Cannot stringify: "+(void 0===e?"undefined":(0,r.default)(e)))}}o["\b"]="\\b",o["\t"]="\\t",o["\n"]="\\n",o["\f"]="\\f",o["\r"]="\\r",o['"']='\\"',o["\\"]="\\\\",e.exports={stringify:u}})),n.register("fNf4Z",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0});var i={};e.exports.default=void 0;var o,a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("6nZ0x"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}if(Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))})),r.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");r.__js_sdk_entrypoint=!0;try{o=r.indexedDB}catch(e){}o&&a.setCryptoStoreFactory((function(){return new a.IndexedDBCryptoStore(o,"matrix-js-sdk:crypto")}));var u=a;e.exports.default=u,r.matrixcs=a})),n.register("6nZ0x",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0});var i={setCryptoStoreFactory:!0,createClient:!0,createRoomWidgetClient:!0,ContentHelpers:!0,createNewMatrixCall:!0,GroupCallEvent:!0,GroupCallIntent:!0,GroupCallState:!0,GroupCallType:!0};e.exports.ContentHelpers=void 0,Object.defineProperty(e.exports,"GroupCallEvent",{enumerable:!0,get:function(){return j.GroupCallEvent}}),Object.defineProperty(e.exports,"GroupCallIntent",{enumerable:!0,get:function(){return j.GroupCallIntent}}),Object.defineProperty(e.exports,"GroupCallState",{enumerable:!0,get:function(){return j.GroupCallState}}),Object.defineProperty(e.exports,"GroupCallType",{enumerable:!0,get:function(){return j.GroupCallType}}),e.exports.createClient=function(e){return new u.MatrixClient(F(e))},Object.defineProperty(e.exports,"createNewMatrixCall",{enumerable:!0,get:function(){return U.createNewMatrixCall}}),e.exports.createRoomWidgetClient=function(e,t,r,n){return new l.RoomWidgetClient(e,t,r,F(n))},e.exports.setCryptoStoreFactory=function(e){B=e};var o=n("it6PG");Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))}));var a=n("QJIyW");Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))}));var s=n("2Xhao");Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===s[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return s[t]}}))}));var u=n("4uAg3");Object.keys(u).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===u[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return u[t]}}))}));var l=n("ljahd");Object.keys(l).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===l[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return l[t]}}))}));var c=n("6BFg8");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var d=n("cCXi5");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=n("6fQci");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var h=n("bzllY");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var p=n("afpjH");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var v=n("jEuTn");Object.keys(v).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===v[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return v[t]}}))}));var g=n("5xqDi");Object.keys(g).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===g[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return g[t]}}))}));var m=n("aBvOl");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var y=n("jjL6E");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=n("9SRK1");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var _=n("bcGqc");Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var w=n("c9Npn");Object.keys(w).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===w[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return w[t]}}))}));var S=n("hwbWG");Object.keys(S).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===S[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return S[t]}}))}));var E=n("j1l3u");Object.keys(E).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===E[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return E[t]}}))}));var k=n("azQ2p");Object.keys(k).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===k[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return k[t]}}))}));var M=n("7c1B9");Object.keys(M).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===M[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return M[t]}}))}));var C=n("ee1Wz");Object.keys(C).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===C[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return C[t]}}))}));var I=n("8A6lK");Object.keys(I).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===I[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return I[t]}}))}));var T=n("kMq5l");Object.keys(T).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===T[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return T[t]}}))}));var R=n("8bPbt");Object.keys(R).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===R[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return R[t]}}))}));var x=n("2jbfh");Object.keys(x).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===x[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return x[t]}}))}));var O=n("7pEi8");Object.keys(O).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===O[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return O[t]}}))}));var A=n("cP9JN");Object.keys(A).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===A[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return A[t]}}))}));var D=n("kilBp");Object.keys(D).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===D[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return D[t]}}))}));var P=n("da1nQ");Object.keys(P).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(i,t)||t in e.exports&&e.exports[t]===P[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return P[t]}}))}));var L=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=N(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("8RGNK"));e.exports.ContentHelpers=L;var U=n("iTgYJ"),j=n("fu2Ru");function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(N=function(e){return e?r:t})(e)}var B=function(){return new o.MemoryCryptoStore};function F(e){var t,n,i;return e.store=null!==(t=e.store)&&void 0!==t?t:new a.MemoryStore({localStorage:r.localStorage}),e.scheduler=null!==(n=e.scheduler)&&void 0!==n?n:new s.MatrixScheduler,e.cryptoStore=null!==(i=e.cryptoStore)&&void 0!==i?i:B(),e}})),n.register("it6PG",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("mBz5n"),u=n("eQNFO"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MemoryCryptoStore=void 0;var c=l(n("3rHpI")),d=n("jtqeE"),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas"));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=function(){function e(){(0,i.default)(this,e),(0,c.default)(this,"outgoingRoomKeyRequests",[]),(0,c.default)(this,"account",null),(0,c.default)(this,"crossSigningKeys",null),(0,c.default)(this,"privateKeys",{}),(0,c.default)(this,"sessions",{}),(0,c.default)(this,"sessionProblems",{}),(0,c.default)(this,"notifiedErrorDevices",{}),(0,c.default)(this,"inboundGroupSessions",{}),(0,c.default)(this,"inboundGroupSessionsWithheld",{}),(0,c.default)(this,"deviceData",null),(0,c.default)(this,"rooms",{}),(0,c.default)(this,"sessionsNeedingBackup",{}),(0,c.default)(this,"sharedHistoryInboundGroupSessions",{}),(0,c.default)(this,"parkedSharedHistory",new Map)}return(0,o.default)(e,[{key:"startup",value:function(){var e=this;return(0,r.default)((function(){return(0,u.__generator)(this,(function(t){return[2,e]}))}))()}},{key:"deleteAllData",value:function(){return Promise.resolve()}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){var t=this,r=e.requestBody;return f.promiseTry((function(){var n=t._getOutgoingRoomKeyRequest(r);return n?(d.logger.log("already have key request outstanding for "+"".concat(r.room_id," / ").concat(r.session_id,": ")+"not sending another"),n):(d.logger.log("enqueueing key request for ".concat(r.room_id," / ")+r.session_id),t.outgoingRoomKeyRequests.push(e),e)}))}},{key:"getOutgoingRoomKeyRequest",value:function(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}},{key:"_getOutgoingRoomKeyRequest",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.outgoingRoomKeyRequests[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(f.deepCompare(a.requestBody,e))return a}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return null}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){var t=!0,r=!1,n=void 0,i=!0,o=!1,a=void 0;try{for(var s,u=this.outgoingRoomKeyRequests[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;try{for(var c,d=e[Symbol.iterator]();!(t=(c=d.next()).done);t=!0){var f=c.value;if(l.state===f)return Promise.resolve(l)}}catch(e){r=!0,n=e}finally{try{t||null==d.return||d.return()}finally{if(r)throw n}}}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return Promise.resolve(null)}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter((function(t){return t.state==e})))}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,r){var n=[],i=!0,o=!1,a=void 0;try{for(var s,u=this.outgoingRoomKeyRequests[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=!0,d=!1,f=void 0;try{for(var h,p=r[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value;l.state===v&&l.recipients.some((function(r){return r.userId===e&&r.deviceId===t}))&&n.push(l)}}catch(e){d=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return Promise.resolve(n)}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,r){var n=!0,i=!1,o=void 0;try{for(var a,s=this.outgoingRoomKeyRequests[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(u.requestId===e)return u.state!==t?(d.logger.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(u.state)),Promise.resolve(null)):(Object.assign(u,r),Promise.resolve(u))}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return Promise.resolve(null)}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){for(var r=0;r<this.outgoingRoomKeyRequests.length;r++){var n=this.outgoingRoomKeyRequests[r];if(n.requestId===e)return n.state!=t?(d.logger.warn("Cannot delete room key request in state ".concat(n.state," ")+"(expected ".concat(t,")")),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(r,1),Promise.resolve(n))}return Promise.resolve(null)}},{key:"getAccount",value:function(e,t){t(this.account)}},{key:"storeAccount",value:function(e,t){this.account=t}},{key:"getCrossSigningKeys",value:function(e,t){t(this.crossSigningKeys)}},{key:"getSecretStorePrivateKey",value:function(e,t,r){t(this.privateKeys[r]||null)}},{key:"storeCrossSigningKeys",value:function(e,t){this.crossSigningKeys=t}},{key:"storeSecretStorePrivateKey",value:function(e,t,r){this.privateKeys[t]=r}},{key:"countEndToEndSessions",value:function(e,t){t(Object.keys(this.sessions).length)}},{key:"getEndToEndSession",value:function(e,t,r,n){n((this.sessions[e]||{})[t]||null)}},{key:"getEndToEndSessions",value:function(e,t,r){r(this.sessions[e]||{})}},{key:"getAllEndToEndSessions",value:function(e,t){Object.entries(this.sessions).forEach((function(e){var r=(0,s.default)(e,2),n=r[0],i=r[1];Object.entries(i).forEach((function(e){var r=(0,s.default)(e,2),i=r[0],o=r[1];t(v(v({},o),{},{deviceKey:n,sessionId:i}))}))}))}},{key:"storeEndToEndSession",value:function(e,t,r,n){var i=this.sessions[e];void 0===i&&(i={},this.sessions[e]=i),i[t]=r}},{key:"storeEndToEndSessionProblem",value:function(e,t,n){var i=this;return(0,r.default)((function(){var r;return(0,u.__generator)(this,(function(o){return(r=i.sessionProblems[e]=i.sessionProblems[e]||[]).push({type:t,fixed:n,time:Date.now()}),r.sort((function(e,t){return e.time-t.time})),[2]}))}))()}},{key:"getEndToEndSessionProblem",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i,o,a,s,l,c,d;return(0,u.__generator)(this,(function(u){if(!(r=n.sessionProblems[e]||[]).length)return[2,null];i=r[r.length-1],o=!0,a=!1,s=void 0;try{for(l=r[Symbol.iterator]();!(o=(c=l.next()).done);o=!0)if((d=c.value).time>t)return[2,Object.assign({},d,{fixed:i.fixed})]}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}return i.fixed?[2,null]:[2,i]}))}))()}},{key:"filterOutNotifiedErrorDevices",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,l,c,d,f,h;return(0,u.__generator)(this,(function(u){r=t.notifiedErrorDevices,n=[],i=!0,o=!1,s=void 0;try{for(l=e[Symbol.iterator]();!(i=(c=l.next()).done);i=!0)d=c.value,f=d.userId,h=d.deviceInfo,f in r?h.deviceId in r[f]||(n.push(d),r[f][h.deviceId]=!0):(n.push(d),r[f]=(0,a.default)({},h.deviceId,!0))}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return[2,n]}))}))()}},{key:"getEndToEndInboundGroupSession",value:function(e,t,r,n){var i=e+"/"+t;n(this.inboundGroupSessions[i]||null,this.inboundGroupSessionsWithheld[i]||null)}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=Object.keys(this.inboundGroupSessions)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t({senderKey:s.slice(0,43),sessionId:s.slice(44),sessionData:this.inboundGroupSessions[s]})}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}t(null)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,r,n){var i=e+"/"+t;void 0===this.inboundGroupSessions[i]&&(this.inboundGroupSessions[i]=r)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,r,n){this.inboundGroupSessions[e+"/"+t]=r}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,r,n){var i=e+"/"+t;this.inboundGroupSessionsWithheld[i]=r}},{key:"getEndToEndDeviceData",value:function(e,t){t(this.deviceData)}},{key:"storeEndToEndDeviceData",value:function(e,t){this.deviceData=e}},{key:"storeEndToEndRoom",value:function(e,t,r){this.rooms[e]=t}},{key:"getEndToEndRooms",value:function(e,t){t(this.rooms)}},{key:"getSessionsNeedingBackup",value:function(e){var t=[];for(var r in this.sessionsNeedingBackup)if(this.inboundGroupSessions[r]&&(t.push({senderKey:r.slice(0,43),sessionId:r.slice(44),sessionData:this.inboundGroupSessions[r]}),e&&r.length>=e))break;return Promise.resolve(t)}},{key:"countSessionsNeedingBackup",value:function(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}},{key:"unmarkSessionsNeedingBackup",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=a.senderKey+"/"+a.sessionId;delete this.sessionsNeedingBackup[s]}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return Promise.resolve()}},{key:"markSessionsNeedingBackup",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=a.senderKey+"/"+a.sessionId;this.sessionsNeedingBackup[s]=!0}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return Promise.resolve()}},{key:"addSharedHistoryInboundGroupSession",value:function(e,t,r){var n=this.sharedHistoryInboundGroupSessions[e]||[];n.push([t,r]),this.sharedHistoryInboundGroupSessions[e]=n}},{key:"getSharedHistoryInboundGroupSessions",value:function(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}},{key:"addParkedSharedHistory",value:function(e,t){var r,n=null!==(r=this.parkedSharedHistory.get(e))&&void 0!==r?r:[];n.push(t),this.parkedSharedHistory.set(e,n)}},{key:"takeParkedSharedHistory",value:function(e){var t,r=null!==(t=this.parkedSharedHistory.get(e))&&void 0!==t?t:[];return this.parkedSharedHistory.delete(e),Promise.resolve(r)}},{key:"doTxn",value:function(e,t,r){return Promise.resolve(r(null))}}]),e}();e.exports.MemoryCryptoStore=g})),n.register("fyjrC",(function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("3rHpI",(function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("jtqeE",(function(e,t){var r=n("9oGi2"),i=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.logger=void 0;var o=i(n("cDKAe")),a="matrix";o.default.methodFactory=function(e,t,n){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o,a;this.prefix&&n.unshift(this.prefix);var s="error"===e||"warn"===e||"trace"===e||"info"===e;return s?(o=console)[e].apply(o,(0,r.default)(n)):(a=console).log.apply(a,(0,r.default)(n))}};var s=o.default.getLogger(a);function u(e){e.withPrefix=function(e){return function(e){var t=o.default.getLogger("".concat(a,"-").concat(e));t.prefix!==e&&(u(t),t.prefix=e,t.setLevel(o.default.levels.DEBUG,!1));return t}((this.prefix||"")+e)}}e.exports.logger=s,s.setLevel(o.default.levels.DEBUG,!1),u(s)})),n.register("cDKAe",(function(e,t){var r=n("aojpe");!function(t,r){"use strict";"function"==typeof define&&define.amd?define(r):e.exports?e.exports=r():t.log=r()}(void 0,(function(){"use strict";var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":(0,r.default)(window))!==t&&(0,r.default)(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function o(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(i){return"debug"===i&&(i="log"),("undefined"==typeof console?"undefined":(0,r.default)(console))!==t&&("trace"===i&&n?a:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}function u(t,r){for(var n=0;n<i.length;n++){var o=i[n];this[o]=n<t?e:this.methodFactory(o,t,r)}this.log=this.debug}function l(e,n,i){return function(){("undefined"==typeof console?"undefined":(0,r.default)(console))!==t&&(u.call(this,n,i),this[e].apply(this,arguments))}}function c(e,t,r){return s(e)||l.apply(this,arguments)}function d(e,n,o){var a,s=this;n=null==n?"WARN":n;var l="loglevel";function d(){var e;if(("undefined"==typeof window?"undefined":(0,r.default)(window))!==t&&l){try{e=window.localStorage[l]}catch(e){}if((void 0===e?"undefined":(0,r.default)(e))===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(l)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"===(void 0===e?"undefined":(0,r.default)(e))&&(l=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=o||c,s.getLevel=function(){return a},s.setLevel=function(n,o){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==o&&function(e){var n=(i[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":(0,r.default)(window))!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}(n),u.call(s,n,e),("undefined"==typeof console?"undefined":(0,r.default)(console))===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){n=e,d()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(n,!1),function(){if(("undefined"==typeof window?"undefined":(0,r.default)(window))!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var f=d();null==f&&(f=n),s.setLevel(f,!1)}var f=new d,h={};f.getLogger=function(e){if("symbol"!==(void 0===e?"undefined":(0,r.default)(e))&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new d(e,f.getLevel(),f.methodFactory)),t};var p=("undefined"==typeof window?"undefined":(0,r.default)(window))!==t?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":(0,r.default)(window))!==t&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return h},f.default=f,f}))})),n.register("e8gas",(function(e,t){var r=n("2swew"),i=n("dLRop"),o=n("mBz5n"),a=n("9oGi2"),s=n("aojpe"),u=n("eQNFO"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DEFAULT_ALPHABET=void 0,e.exports.alphabetPad=k,e.exports.averageBetweenStrings=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E,n=Math.max(e.length,t.length),i=C(k(e,n,r),r),o=C(k(t,n,r),r),a=(i+o)/BigInt(2);return a===i||a==o?M(a,r)+r[0]:M(a,r)},e.exports.baseToString=M,e.exports.checkObjectHasKeys=function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(!e.hasOwnProperty(s))throw new Error("Missing required key: "+s)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}},e.exports.chunkPromises=function(e,t){return S.apply(this,arguments)},e.exports.compare=function(e,t){return T.compare(e,t)},e.exports.decodeParams=function(e){var t={},r=new URLSearchParams(e),n=!0,i=!1,o=void 0;try{for(var a,s=r.keys()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value,l=r.getAll(u);t[u]=1===l.length?l[0]:l}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return t},e.exports.deepCompare=function e(t,r){if(t===r)return!0;if((void 0===t?"undefined":(0,s.default)(t))!==(void 0===r?"undefined":(0,s.default)(r)))return!1;if("number"==typeof t&&isNaN(t)&&isNaN(r))return!0;if(null===t||null===r)return t===r;if(!(t instanceof Object))return!1;if(t.constructor!==r.constructor||t.prototype!==r.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===r.toString();if(Array.isArray(t)){if(t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1}else{for(var i in r)if(r.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;for(var o in t)if(r.hasOwnProperty(o)!==t.hasOwnProperty(o)||!e(t[o],r[o]))return!1}return!0},e.exports.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},e.exports.deepSortedObjectEntries=function e(t){if("object"!=typeof t)return t;if(null==t||Array.isArray(t))return t;var r=[],n=!0,i=!1,a=void 0;try{for(var s,u=Object.entries(t)[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=(0,o.default)(s.value,2),c=l[0],d=l[1];r.push([c,e(d)])}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r.sort((function(e,t){return I(e[0],t[0])})),r},e.exports.defer=function(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return{resolve:e,reject:t,promise:r}},e.exports.encodeParams=function(e,t){var r=null!=t?t:new URLSearchParams,n=!0,i=!1,a=void 0;try{for(var s,u=function(){var e=(0,o.default)(s.value,2),t=e[0],n=e[1];null!=n&&(Array.isArray(n)?n.forEach((function(e){r.append(t,String(e))})):r.append(t,String(n)))},l=Object.entries(e)[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)u()}catch(e){i=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw a}}return r},e.exports.encodeUri=function(e,t){for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];null!=n&&(e=e.replace(r,encodeURIComponent(n)))}return e},e.exports.ensureNoTrailingSlash=function(e){return null!=e&&e.endsWith("/")?e.slice(0,-1):e},e.exports.escapeRegExp=_,e.exports.globToRegexp=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[[/\\\*/g,".*"],[/\?/g,"."]];t||r.push([/\\\[(!|)(.*)\\]/g,function(e,t,r){return["[",t?"^":"",r.replace(/\\-/,"-"),"]"].join("")}]);return r.reduce((function(e,t){return t?e.replace(t[0],t[1]):e}),_(e))},e.exports.internaliseString=function(e){e instanceof String&&(e=e.toString());m.has(e)||m.set(e,e);return m.get(e)},e.exports.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},e.exports.isNullOrUndefined=function(e){return null==e},e.exports.isNumber=function(e){return"number"==typeof e&&isFinite(e)},e.exports.isSupportedReceiptType=function(e){return[p.ReceiptType.Read,p.ReceiptType.ReadPrivate].includes(e)},e.exports.lexicographicCompare=I,e.exports.mapsEqual=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.size!==t.size)return!1;var n=!0,i=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=(0,o.default)(s.value,2),c=l[0],d=l[1],f=t.get(c);if(void 0===f||!r(d,f))return!1}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return!0},e.exports.nextString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;return M(C(e,t)+BigInt(1),t)},e.exports.normalize=function(e){return y(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()},e.exports.prevString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;return M(C(e,t)-BigInt(1),t)},e.exports.promiseMapSeries=function(e,t){return w.apply(this,arguments)},e.exports.promiseTry=function(e){return Promise.resolve(e())},e.exports.recursivelyAssign=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!0,a=!1,s=void 0;try{for(var u,l=Object.entries(r)[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=(0,o.default)(u.value,2),d=c[0],f=c[1];t[d]instanceof Object&&f?e(t[d],f):null==f&&n||(t[d]=f)}}catch(e){a=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw s}}return t},e.exports.removeDirectionOverrideChars=function(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""},e.exports.removeElement=function(e,t,r){var n;if(r){for(n=e.length-1;n>=0;n--)if(t(e[n],n,e))return e.splice(n,1),!0}else for(n=0;n<e.length;n++)if(t(e[n],n,e))return e.splice(n,1),!0;return!1},e.exports.removeHiddenChars=y,e.exports.replaceParam=function(e,t,r){var n=g(g({},r),{},(0,i.default)({},t,r[e]));return delete n[e],n},e.exports.simpleRetryOperation=function(e){return(0,f.default)((function(t){return e(t)}),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},e.exports.sleep=function(e,t){return new Promise((function(r){setTimeout(r,e,t)}))},e.exports.sortEventsByLatestContentTimestamp=function(e,t){return R(t)-R(e)},e.exports.stringToBase=C;var c=l(n("3rHpI")),d=l(n("chW6S")),f=l(n("bziKh")),h=n("3F1o7"),p=n("7Ud45");function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=new Map;function y(e){return"string"==typeof e?(0,d.default)(e.normalize("NFD").replace(b,"")):""}var b=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function _(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w(){return(w=(0,r.default)((function(e,t){var r,n,i,o,a,s;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:r=!0,n=!1,i=void 0,u.label=1;case 1:u.trys.push([1,7,8,9]),o=e[Symbol.iterator](),u.label=2;case 2:return(r=(a=o.next()).done)?[3,6]:[4,a.value];case 3:return[4,t.apply(void 0,[u.sent()])];case 4:u.sent(),u.label=5;case 5:return r=!0,[3,2];case 6:return[3,9];case 7:return s=u.sent(),n=!0,i=s,[3,9];case 8:try{r||null==o.return||o.return()}finally{if(n)throw i}return[7];case 9:return[2]}}))}))).apply(this,arguments)}function S(){return(S=(0,r.default)((function(e,t){var r,n,i,o,s,l;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:n=[],i=0,u.label=1;case 1:return i<e.length?(s=(o=(r=n).push).apply,l=[r],[4,Promise.all(e.slice(i,i+t).map((function(e){return e()})))]):[3,4];case 2:s.apply(o,l.concat([a.default.apply(void 0,[u.sent()])])),u.label=3;case 3:return i+=t,[3,1];case 4:return[2,n]}}))}))).apply(this,arguments)}var E=function(){for(var e="",t=32;t<=126;t++)e+=String.fromCharCode(t);return e}();function k(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E;return e.padEnd(t,r[0])}function M(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,n=BigInt(r.length);if(e<=n)return null!==(t=r[Number(e)-1])&&void 0!==t?t:"";var i=e/n,o=Number(e%n)-1;return o<0&&(i-=BigInt(Math.abs(o)),o=Number(n)-1),M(i,r)+r[o]}function C(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,r=BigInt(t.length),n=BigInt(0),i=e.length-1,o=BigInt(0);i>=0;i--,o++){var a=e.charCodeAt(i)-t.charCodeAt(0);n+=BigInt(1+a)*Math.pow(r,o)}return n}function I(e,t){return e<t?-1:e>t?1:0}e.exports.DEFAULT_ALPHABET=E;var T=new Intl.Collator;function R(e){var t;return null!==(t=h.M_TIMESTAMP.findIn(e.getContent()))&&void 0!==t?t:-1}})),n.register("chW6S",(function(e,t){"use strict";var r=n("cIy9L");var i=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function o(e){return r[e]}e.exports=function(e){return e.replace(i,o)}})),n.register("cIy9L",(function(e,t){e.exports=JSON.parse('{"0":"O","1":"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ","ﱞ":"ﹲّ","ࣲ":"ٍ","ﱟ":"ﹴّ","ﳲ":"ﹷّ","ﱠ":"ﹶّ","ﳳ":"ﹹّ","ﱡ":"ﹸّ","ؚ":"ِ","̗":"ِ","ﳴ":"ﹻّ","ﱢ":"ﹺّ","ﱣ":"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":","ː":":","ꓽ":":","⩴":"::=","⧴":":→","！":"!","ǃ":"!","ⵑ":"!","‼":"!!","⁉":"!?","ʔ":"?","Ɂ":"?","ॽ":"?","Ꭾ":"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·","ᐧ":"·","⋯":"···","ⵈ":"···","ᑄ":"·<","⋗":"·>","ᐷ":"·>","ᑀ":"·>","ᔯ":"·4","ᑾ":"·b","ᒀ":"·ḃ","ᑺ":"·d","ᒘ":"·J","ᒶ":"·L","ᑶ":"·P","ᑗ":"·U","ᐺ":"·V","ᐼ":"·Ʌ","ᒮ":"·Γ","ᐎ":"·Δ","ᑙ":"·Ո","ᐌ":"·ᐁ","ᐐ":"·ᐄ","ᐒ":"·ᐅ","ᐔ":"·ᐆ","ᐗ":"·ᐊ","ᐙ":"·ᐋ","ᐾ":"·ᐲ","ᑂ":"·ᐴ","ᑆ":"·ᐹ","ᑛ":"·ᑏ","ᑔ":"·ᑐ","ᑝ":"·ᑐ","ᑟ":"·ᑑ","ᑡ":"·ᑕ","ᑣ":"·ᑖ","ᑴ":"·ᑫ","ᑸ":"·ᑮ","ᑼ":"·ᑰ","ᒒ":"·ᒉ","ᒔ":"·ᒋ","ᒖ":"·ᒌ","ᒚ":"·ᒎ","ᒜ":"·ᒐ","ᒞ":"·ᒑ","ᒬ":"·ᒣ","ᒰ":"·ᒦ","ᒲ":"·ᒧ","ᒴ":"·ᒨ","ᒸ":"·ᒫ","ᓉ":"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ","ᓋ":"·ᓇ","ᓍ":"·ᓈ","ᓜ":"·ᓓ","ᓞ":"·ᓕ","ᓠ":"·ᓖ","ᓢ":"·ᓗ","ᓤ":"·ᓘ","ᓦ":"·ᓚ","ᓨ":"·ᓛ","ᓶ":"·ᓭ","ᓸ":"·ᓯ","ᓺ":"·ᓰ","ᓼ":"·ᓱ","ᓾ":"·ᓲ","ᔀ":"·ᓴ","ᔂ":"·ᓵ","ᔗ":"·ᔐ","ᔙ":"·ᔑ","ᔛ":"·ᔒ","ᔝ":"·ᔓ","ᔟ":"·ᔔ","ᔡ":"·ᔕ","ᔣ":"·ᔖ","ᔱ":"·ᔨ","ᔳ":"·ᔩ","ᔵ":"·ᔪ","ᔷ":"·ᔫ","ᔹ":"·ᔭ","ᔻ":"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ","ᕎ":"·ᕌ","ᕛ":"·ᕚ","ᕨ":"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"\'","＇":"\'","‘":"\'","’":"\'","‛":"\'","′":"\'","‵":"\'","՚":"\'","׳":"\'","`":"\'","`":"\'","｀":"\'","´":"\'","΄":"\'","´":"\'","᾽":"\'","᾿":"\'","῾":"\'","ʹ":"\'","ʹ":"\'","ˈ":"\'","ˊ":"\'","ˋ":"\'","˴":"\'","ʻ":"\'","ʽ":"\'","ʼ":"\'","ʾ":"\'","ꞌ":"\'","י":"\'","ߴ":"\'","ߵ":"\'","ᑊ":"\'","ᛌ":"\'","𖽑":"\'","𖽒":"\'","᳓":"\'\'","\\"":"\'\'","＂":"\'\'","“":"\'\'","”":"\'\'","‟":"\'\'","″":"\'\'","‶":"\'\'","〃":"\'\'","״":"\'\'","˝":"\'\'","ʺ":"\'\'","˶":"\'\'","ˮ":"\'\'","ײ":"\'\'","‴":"\'\'\'","‷":"\'\'\'","⁗":"\'\'\'\'","Ɓ":"\'B","Ɗ":"\'D","ŉ":"\'n","Ƥ":"\'P","Ƭ":"\'T","Ƴ":"\'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬","く":"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/","〳":"/","Ⳇ":"/","ノ":"/","丿":"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\\\","﹨":"\\\\","∖":"\\\\","⟍":"\\\\","⧵":"\\\\","⧹":"\\\\","𝈏":"\\\\","𝈻":"\\\\","㇔":"\\\\","丶":"\\\\","⼂":"\\\\","⳹":"\\\\\\\\","⑊":"\\\\\\\\","⟈":"\\\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ","ъ":"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵","ð":"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<","ᐸ":"<","ᚲ":"<","⋖":"<·","Ⲵ":"<·","ᑅ":"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">","ᐳ":">","𖼿":">","ᑁ":">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー","ᅳ":"ー","ㅡ":"ー","一":"ー","⼀":"ー","ᆖ":"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ","ᆕ":"ーᅮ","ᅴ":"ー丨","ㅢ":"ー丨","ᆗ":"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2","Ƨ":"2","Ϩ":"2","Ꙅ":"2","ᒿ":"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁","ƻ":"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3","Ȝ":"3","Ʒ":"3","Ꝫ":"3","Ⳍ":"3","З":"3","Ӡ":"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂","Ҙ":"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4","Ꮞ":"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.","ᔰ":"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5","Ƽ":"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6","б":"6","Ꮾ":"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8","ȣ":"8","Ȣ":"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a","ａ":"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a","ɑ":"a","α":"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a","а":"a","ⷶ":"ͣ","Ａ":"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A","Α":"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A","А":"A","Ꭺ":"A","ᗅ":"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲","ǎ":"ă","Ǎ":"Ă","ȧ":"å","Ȧ":"Å","ẚ":"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA","æ":"ae","ӕ":"ae","Æ":"AE","Ӕ":"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ","ᗄ":"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b","Ƅ":"b","Ь":"b","Ꮟ":"b","ᑲ":"b","ᖯ":"b","Ｂ":"B","ℬ":"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B","Β":"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B","В":"B","Ᏼ":"B","ᗷ":"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B","ɓ":"b̔","ᑳ":"ḃ","ƃ":"b̄","Ƃ":"b̄","Б":"b̄","ƀ":"b̵","ҍ":"b̵","Ҍ":"b̵","ѣ":"b̵","Ѣ":"b̵","ᑿ":"b·","ᒁ":"ḃ·","ᒈ":"b\'","Ы":"bl","в":"ʙ","ᏼ":"ʙ","ｃ":"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c","ϲ":"c","ⲥ":"c","с":"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C","Ｃ":"C","Ⅽ":"C","ℂ":"C","ℭ":"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C","С":"C","Ꮯ":"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠","ç":"c̦","ҫ":"c̦","Ç":"C̦","Ҫ":"C̦","Ƈ":"C\'","℅":"c/o","℆":"c/u","🅭":"㏄\\t⃝","⋴":"ꞓ","ɛ":"ꞓ","ε":"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ","є":"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ","Є":"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d","Ꮷ":"d","ᑯ":"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D","Ꭰ":"D","ᗞ":"D","ᗪ":"D","ꓓ":"D","ɗ":"d̔","ɖ":"d̨","ƌ":"d̄","đ":"d̵","Đ":"D̵","Ð":"D̵","Ɖ":"D̵","₫":"ḏ̵","ꝺ":"Ꝺ","ᑻ":"d·","ᒇ":"d\'","ʤ":"dȝ","ǳ":"dz","ʣ":"dz","ǲ":"Dz","Ǳ":"DZ","ǆ":"dž","ǅ":"Dž","Ǆ":"DŽ","ʥ":"dʑ","ꭰ":"ᴅ","⸹":"ẟ","δ":"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ","ծ":"ẟ","ᕷ":"ẟ","℮":"e","ｅ":"e","ℯ":"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e","е":"e","ҽ":"e","ⷷ":"ͤ","⋿":"E","Ｅ":"E","ℰ":"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E","Ε":"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E","Е":"E","ⴹ":"E","Ꭼ":"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E","ě":"ĕ","Ě":"Ĕ","ɇ":"e̸","Ɇ":"E̸","ҿ":"ę","ꭼ":"ᴇ","ə":"ǝ","ә":"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ","ɚ":"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵","Ә":"Ə","𝈡":"Ɛ","ℇ":"Ɛ","Ԑ":"Ɛ","Ꮛ":"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ","з":"ɜ","ҙ":"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f","ſ":"f","ẝ":"f","ք":"f","𝈓":"F","ℱ":"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F","Ϝ":"F","𝟊":"F","ᖴ":"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F","ƒ":"f̦","Ƒ":"F̦","ᵮ":"f̴","℻":"FAX","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ʩ":"fŋ","ᖵ":"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ","ᖷ":"ꟻ","ｇ":"g","ℊ":"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g","ɡ":"g","ᶃ":"g","ƍ":"g","ց":"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G","Ꮐ":"G","Ᏻ":"G","ꓖ":"G","ᶢ":"ᵍ","ɠ":"g̔","ǧ":"ğ","Ǧ":"Ğ","ǵ":"ģ","ǥ":"g̵","Ǥ":"G̵","Ɠ":"G\'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ","ｈ":"h","ℎ":"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h","һ":"h","հ":"h","Ꮒ":"h","Ｈ":"H","ℋ":"H","ℌ":"H","ℍ":"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H","Η":"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H","Н":"H","Ꮋ":"H","ᕼ":"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ","ɦ":"h̔","ꚕ":"h̔","Ᏺ":"h̔","Ⱨ":"H̩","Ң":"H̩","ħ":"h̵","ℏ":"h̵","ћ":"h̵","Ħ":"H̵","Ӊ":"H̦","Ӈ":"H̦","н":"ʜ","ꮋ":"ʜ","ң":"ʜ̩","ӊ":"ʜ̦","ӈ":"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ","Ꭸ":"Ⱶ","Ꮀ":"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i","ｉ":"i","ⅰ":"i","ℹ":"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i","ı":"i","𝚤":"i","ɪ":"i","ɩ":"i","ι":"i","ι":"i","ͺ":"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i","і":"i","ꙇ":"i","ӏ":"i","ꭵ":"i","Ꭵ":"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲","ǐ":"ĭ","Ǐ":"Ĭ","ɨ":"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii","ĳ":"ij","ⅳ":"iv","ⅸ":"ix","ｊ":"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j","ϳ":"j","ј":"j","Ｊ":"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J","Ј":"J","Ꭻ":"J","ᒍ":"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵","ᒙ":"J·","𝚥":"ȷ","յ":"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k","K":"K","Ｋ":"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K","Κ":"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K","К":"K","Ꮶ":"K","ᛕ":"K","ꓗ":"K","𐔘":"K","ƙ":"k̔","Ⱪ":"K̩","Қ":"K̩","₭":"K̵","Ꝁ":"K̵","Ҟ":"K̵","Ƙ":"K\'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l","I":"l","Ｉ":"l","Ⅰ":"l","ℐ":"l","ℑ":"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l","Ɩ":"l","ｌ":"l","ⅼ":"l","ℓ":"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l","ǀ":"l","Ι":"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l","І":"l","Ӏ":"l","ו":"l","ן":"l","ا":"l","𞸀":"l","𞺀":"l","ﺎ":"l","ﺍ":"l","ߊ":"l","ⵏ":"l","ᛁ":"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L","ℒ":"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L","Ꮮ":"L","ᒪ":"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L","ﴼ":"l̋","ﴽ":"l̋","ł":"l̸","Ł":"L̸","ɭ":"l̨","Ɨ":"l̵","ƚ":"l̵","ɫ":"l̴","إ":"lٕ","ﺈ":"lٕ","ﺇ":"lٕ","ٳ":"lٕ","ŀ":"l·","Ŀ":"l·","ᒷ":"l·","🄂":"l,","⒈":"l.","ױ":"l\'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点","ǉ":"lj","Ĳ":"lJ","ǈ":"Lj","Ǉ":"LJ","‖":"ll","∥":"ll","Ⅱ":"ll","ǁ":"ll","װ":"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点","Ю":"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点","ʪ":"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX","ɮ":"lȝ","ʫ":"lz","أ":"lٴ","ﺄ":"lٴ","ﺃ":"lٴ","ٲ":"lٴ","ٵ":"lٴ","ﷳ":"lكبر","ﷲ":"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ","Ｍ":"M","Ⅿ":"M","ℳ":"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M","Μ":"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M","М":"M","Ꮇ":"M","ᗰ":"M","ᛖ":"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n","ո":"n","ռ":"n","Ｎ":"N","ℕ":"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N","Ν":"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊","ɳ":"n̨","ƞ":"n̩","η":"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩","Ɲ":"N̦","ᵰ":"n̴","ǌ":"nj","ǋ":"Nj","Ǌ":"NJ","№":"No","ͷ":"ᴎ","и":"ᴎ","𐑍":"ᴎ","ņ":"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o","ｏ":"o","ℴ":"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o","ο":"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o","σ":"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o","о":"o","ჿ":"o","օ":"o","ס":"o","ه":"o","𞸤":"o","𞹤":"o","𞺄":"o","ﻫ":"o","ﻬ":"o","ﻪ":"o","ﻩ":"o","ھ":"o","ﮬ":"o","ﮭ":"o","ﮫ":"o","ﮪ":"o","ہ":"o","ﮨ":"o","ﮩ":"o","ﮧ":"o","ﮦ":"o","ە":"o","ഠ":"o","ဝ":"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O","Ｏ":"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O","Ο":"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O","О":"O","Օ":"O","ⵔ":"O","ዐ":"O","ଠ":"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º","ǒ":"ŏ","Ǒ":"Ŏ","ۿ":"ô","Ő":"Ö","ø":"o̸","ꬾ":"o̸","Ø":"O̸","ⵁ":"O̸","Ǿ":"Ó̸","ɵ":"o̵","ꝋ":"o̵","ө":"o̵","ѳ":"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵","Ɵ":"O̵","Ꝋ":"O̵","θ":"O̵","ϑ":"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵","Θ":"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵","Ө":"O̵","Ѳ":"O̵","ⴱ":"O̵","Ꮎ":"O̵","Ꮻ":"O̵","ꭴ":"ơ","ﳙ":"oٰ","🄁":"O,","🄀":"O.","ơ":"o\'","Ơ":"O\'","Ꭴ":"O\'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀","œ":"oe","Œ":"OE","ɶ":"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO","ﳗ":"oج","ﱑ":"oج","ﳘ":"oم","ﱒ":"oم","ﶓ":"oمج","ﶔ":"oمم","ﱓ":"oى","ﱔ":"oى","ൟ":"oരo","တ":"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p","ｐ":"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p","ρ":"p","ϱ":"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p","р":"p","Ｐ":"P","ℙ":"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P","Ρ":"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P","Р":"P","Ꮲ":"P","ᑭ":"P","ꓑ":"P","𐊕":"P","ƥ":"p̔","ᵽ":"p̵","ᑷ":"p·","ᒆ":"P\'","ᴩ":"ᴘ","ꮲ":"ᴘ","φ":"ɸ","ϕ":"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ","ф":"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q","գ":"q","զ":"q","ℚ":"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q","ʠ":"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ","κ":"ĸ","ϰ":"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ","к":"ĸ","ꮶ":"ĸ","қ":"ĸ̩","ҟ":"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r","г":"r","ꮁ":"r","𝈖":"R","ℛ":"R","ℜ":"R","ℝ":"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R","Ʀ":"R","Ꭱ":"R","Ꮢ":"R","𐒴":"R","ᖇ":"R","ꓣ":"R","𖼵":"R","ɽ":"r̨","ɼ":"r̩","ɍ":"r̵","ғ":"r̵","ᵲ":"r̴","ґ":"r\'","𑣣":"rn","m":"rn","ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸","ɱ":"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ","я":"ᴙ","ᵳ":"ɾ̴","℩":"ɿ","ｓ":"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s","ƽ":"s","ѕ":"s","ꮪ":"s","𑣁":"s","𐑈":"s","Ｓ":"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S","Ѕ":"S","Տ":"S","Ꮥ":"S","Ꮪ":"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S","ʂ":"s̨","ᵴ":"s̴","ꞵ":"ß","β":"ß","ϐ":"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß","Ᏸ":"ß","🝜":"sss","ﬆ":"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ","Σ":"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T","Ｔ":"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T","Τ":"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T","Т":"T","Ꭲ":"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T","ƭ":"t̔","⍡":"T̈","Ⱦ":"T̸","Ț":"Ţ","Ʈ":"T̨","Ҭ":"T̩","₮":"T⃫","ŧ":"t̵","Ŧ":"T̵","ᵵ":"t̴","Ⴀ":"Ꞇ","Ꜩ":"T3","ʨ":"tɕ","℡":"TEL","ꝷ":"tf","ʦ":"ts","ʧ":"tʃ","ꜩ":"tȝ","τ":"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ","т":"ᴛ","ꭲ":"ᴛ","ҭ":"ᴛ̩","ţ":"ƫ","ț":"ƫ","Ꮏ":"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u","ʋ":"u","υ":"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u","ս":"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U","Ս":"U","ሀ":"U","𐓎":"U","ᑌ":"U","ꓴ":"U","𖽂":"U","𑢸":"U","ǔ":"ŭ","Ǔ":"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵","Ꮜ":"U̵","ᑘ":"U·","ᑧ":"U\'","ᵫ":"ue","ꭣ":"uo","ṃ":"ꭑ","պ":"ɰ","ሣ":"ɰ","℧":"Ʊ","ᘮ":"Ʊ","ᘴ":"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v","ｖ":"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v","ν":"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v","ѵ":"v","ט":"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V","Ѵ":"V","ⴸ":"V","Ꮩ":"V","ᐯ":"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵","ᐻ":"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ","Λ":"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ","Л":"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ","ᐱ":"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦","ᐽ":"Ʌ·","ɯ":"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w","ѡ":"w","ԝ":"w","ա":"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W","Ꮃ":"W","Ꮤ":"W","ꓪ":"W","ѽ":"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ","м":"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x","ｘ":"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x","х":"x","ᕁ":"x","ᕽ":"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X","Ｘ":"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X","Χ":"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X","Х":"X","ⵝ":"X","ᚷ":"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ","Ҳ":"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll","ɣ":"y","ᶌ":"y","ｙ":"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y","ʏ":"y","ỿ":"y","ꭚ":"y","γ":"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y","у":"y","ү":"y","ყ":"y","𑣜":"y","Ｙ":"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y","Υ":"Y","ϒ":"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y","У":"Y","Ү":"Y","Ꭹ":"Y","Ꮍ":"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y","ƴ":"y̔","ɏ":"y̵","ұ":"y̵","¥":"Y̵","Ɏ":"Y̵","Ұ":"Y̵","ʒ":"ȝ","ꝫ":"ȝ","ⳍ":"ȝ","ӡ":"ȝ","ჳ":"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z","Ｚ":"Z","ℤ":"Z","ℨ":"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z","Ζ":"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z","Ꮓ":"Z","ꓜ":"Z","𑢩":"Z","ʐ":"z̨","ƶ":"z̵","Ƶ":"Z̵","ȥ":"z̦","Ȥ":"Z̦","ᵶ":"z̴","ƿ":"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ","ϩ":"ƨ","ꙅ":"ƨ","ь":"ƅ","ꮟ":"ƅ","ы":"ƅi","ꭾ":"ɂ","ˤ":"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ","Г":"Γ","Ꮁ":"Γ","ᒥ":"Γ","𖼇":"Γ","Ғ":"Γ̵","ᒯ":"Γ·","Ґ":"Γ\'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ","ᐃ":"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲","ᐏ":"Δ·","ᐬ":"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ","µ":"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ","ϖ":"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π","п":"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π","П":"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ","ϛ":"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ","Ф":"Φ","Փ":"Φ","ቀ":"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ","ѱ":"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ","Ѱ":"Ψ","𐓑":"Ψ","ᛘ":"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω","Ω":"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω","ᘯ":"Ω","ᘵ":"Ω","𐊶":"Ω","⍹":"ω̲","ώ":"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ","җ":"ж̩","Җ":"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И","Й":"Ѝ","Ҋ":"Ѝ̦","ѝ":"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ","Ꮗ":"Ѡ","ᗯ":"Ѡ","Ѽ":"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ","ӌ":"ҷ","Ӌ":"Ҷ","Ҿ":"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ","և":"եւ","ኔ":"ձ","ﬔ":"մե","ﬕ":"մի","ﬗ":"մխ","ﬓ":"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո","በ":"Ո","ᑎ":"Ո","ꓵ":"Ո","ᑚ":"Ո·","ᑨ":"Ո\'","ﬖ":"վն","₽":"Ք","˓":"ՙ","ʿ":"ՙ","ℵ":"א","ﬡ":"א","אָ":"אַ","אּ":"אַ","ﭏ":"אל","ℶ":"ב","ℷ":"ג","ℸ":"ד","ﬢ":"ד","ﬣ":"ה","יּ":"יִ","ﬤ":"כ","ﬥ":"ל","ﬦ":"ם","ﬠ":"ע","ﬧ":"ר","שׂ":"שׁ","שּ":"שׁ","שּׂ":"שּׁ","ﬨ":"ת","ﺀ":"ء","۽":"ء͈","ﺂ":"آ","ﺁ":"آ","ﭑ":"ٱ","ﭐ":"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب","ﺑ":"ب","ﺒ":"ب","ﺐ":"ب","ﺏ":"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ","ﲠ":"بo","ﳢ":"بo","ﲜ":"بج","ﰅ":"بج","ﲝ":"بح","ﰆ":"بح","ﷂ":"بحى","ﲞ":"بخ","ﰇ":"بخ","ﳒ":"بخ","ﱋ":"بخ","ﶞ":"بخى","ﱪ":"بر","ﱫ":"بز","ﲟ":"بم","ﳡ":"بم","ﱬ":"بم","ﰈ":"بم","ﱭ":"بن","ﱮ":"بى","ﰉ":"بى","ﱯ":"بى","ﰊ":"بى","ﭔ":"ٻ","ﭕ":"ٻ","ﭓ":"ٻ","ﭒ":"ٻ","ې":"ٻ","ﯦ":"ٻ","ﯧ":"ٻ","ﯥ":"ٻ","ﯤ":"ٻ","ﭜ":"ڀ","ﭝ":"ڀ","ﭛ":"ڀ","ﭚ":"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة","ö":"ة","ﺔ":"ة","ﺓ":"ة","ۃ":"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت","ﺗ":"ت","ﺘ":"ت","ﺖ":"ت","ﺕ":"ت","ﲥ":"تo","ﳤ":"تo","ﲡ":"تج","ﰋ":"تج","ﵐ":"تجم","ﶠ":"تجى","ﶟ":"تجى","ﲢ":"تح","ﰌ":"تح","ﵒ":"تحج","ﵑ":"تحج","ﵓ":"تحم","ﲣ":"تخ","ﰍ":"تخ","ﵔ":"تخم","ﶢ":"تخى","ﶡ":"تخى","ﱰ":"تر","ﱱ":"تز","ﲤ":"تم","ﳣ":"تم","ﱲ":"تم","ﰎ":"تم","ﵕ":"تمج","ﵖ":"تمح","ﵗ":"تمخ","ﶤ":"تمى","ﶣ":"تمى","ﱳ":"تن","ﱴ":"تى","ﰏ":"تى","ﱵ":"تى","ﰐ":"تى","ﭠ":"ٺ","ﭡ":"ٺ","ﭟ":"ٺ","ﭞ":"ٺ","ﭤ":"ٿ","ﭥ":"ٿ","ﭣ":"ٿ","ﭢ":"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج","ﺟ":"ج","ﺠ":"ج","ﺞ":"ج","ﺝ":"ج","ﲧ":"جح","ﰕ":"جح","ﶦ":"جحى","ﶾ":"جحى","ﷻ":"جل جلlلo","ﲨ":"جم","ﰖ":"جم","ﵙ":"جمح","ﵘ":"جمح","ﶧ":"جمى","ﶥ":"جمى","ﴝ":"جى","ﴁ":"جى","ﴞ":"جى","ﴂ":"جى","ﭸ":"ڃ","ﭹ":"ڃ","ﭷ":"ڃ","ﭶ":"ڃ","ﭴ":"ڄ","ﭵ":"ڄ","ﭳ":"ڄ","ﭲ":"ڄ","ﭼ":"چ","ﭽ":"چ","ﭻ":"چ","ﭺ":"چ","ﮀ":"ڇ","ﮁ":"ڇ","ﭿ":"ڇ","ﭾ":"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح","ﺣ":"ح","ﺤ":"ح","ﺢ":"ح","ﺡ":"ح","څ":"حۛ","ځ":"حٔ","ݲ":"حٔ","ﲩ":"حج","ﰗ":"حج","ﶿ":"حجى","ﲪ":"حم","ﰘ":"حم","ﵛ":"حمى","ﵚ":"حمى","ﴛ":"حى","ﳿ":"حى","ﴜ":"حى","ﴀ":"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ","ﺧ":"خ","ﺨ":"خ","ﺦ":"خ","ﺥ":"خ","ﲫ":"خج","ﰙ":"خج","ﰚ":"خح","ﲬ":"خم","ﰛ":"خم","ﴟ":"خى","ﴃ":"خى","ﴠ":"خى","ﴄ":"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د","ﺪ":"د","ﺩ":"د","ڈ":"دؕ","ﮉ":"دؕ","ﮈ":"دؕ","ڎ":"دۛ","ﮇ":"دۛ","ﮆ":"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ","ﺬ":"ذ","ﺫ":"ذ","ﱛ":"ذٰ","ڋ":"ڊؕ","ﮅ":"ڌ","ﮄ":"ڌ","ﮃ":"ڍ","ﮂ":"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر","ﺮ":"ر","ﺭ":"ر","ڑ":"رؕ","ﮍ":"رؕ","ﮌ":"رؕ","ژ":"رۛ","ﮋ":"رۛ","ﮊ":"رۛ","ڒ":"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ","ﱜ":"رٰ","ﷶ":"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز","ﺰ":"ز","ﺯ":"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س","ﺳ":"س","ﺴ":"س","ﺲ":"س","ﺱ":"س","ش":"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ","ﺷ":"سۛ","ﺸ":"سۛ","ﺶ":"سۛ","ﺵ":"سۛ","ݾ":"س̂","ﴱ":"سo","ﳨ":"سo","ﴲ":"سۛo","ﳪ":"سۛo","ﲭ":"سج","ﴴ":"سج","ﰜ":"سج","ﴭ":"سۛج","ﴷ":"سۛج","ﴥ":"سۛج","ﴉ":"سۛج","ﵝ":"سجح","ﵞ":"سجى","ﵩ":"سۛجى","ﲮ":"سح","ﴵ":"سح","ﰝ":"سح","ﴮ":"سۛح","ﴸ":"سۛح","ﴦ":"سۛح","ﴊ":"سۛح","ﵜ":"سحج","ﵨ":"سۛحم","ﵧ":"سۛحم","ﶪ":"سۛحى","ﲯ":"سخ","ﴶ":"سخ","ﰞ":"سخ","ﴯ":"سۛخ","ﴹ":"سۛخ","ﴧ":"سۛخ","ﴋ":"سۛخ","ﶨ":"سخى","ﷆ":"سخى","ﴪ":"سر","ﴎ":"سر","ﴩ":"سۛر","ﴍ":"سۛر","ﲰ":"سم","ﳧ":"سم","ﰟ":"سم","ﴰ":"سۛم","ﳩ":"سۛم","ﴨ":"سۛم","ﴌ":"سۛم","ﵡ":"سمج","ﵠ":"سمح","ﵟ":"سمح","ﵫ":"سۛمخ","ﵪ":"سۛمخ","ﵣ":"سمم","ﵢ":"سمم","ﵭ":"سۛمم","ﵬ":"سۛمم","ﴗ":"سى","ﳻ":"سى","ﴘ":"سى","ﳼ":"سى","ﴙ":"سۛى","ﳽ":"سۛى","ﴚ":"سۛى","ﳾ":"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص","ﺻ":"ص","ﺼ":"ص","ﺺ":"ص","ﺹ":"ص","ڞ":"صۛ","ࢯ":"ص̤̣","ﲱ":"صح","ﰠ":"صح","ﵥ":"صحح","ﵤ":"صحح","ﶩ":"صحى","ﲲ":"صخ","ﴫ":"صر","ﴏ":"صر","ﷵ":"صلعم","ﷹ":"صلى","ﷰ":"صلى","ﷺ":"صلى lللo علىo وسلم","ﲳ":"صم","ﰡ":"صم","ﷅ":"صمم","ﵦ":"صمم","ﴡ":"صى","ﴅ":"صى","ﴢ":"صى","ﴆ":"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض","ﺿ":"ض","ﻀ":"ض","ﺾ":"ض","ﺽ":"ض","ﲴ":"ضج","ﰢ":"ضج","ﲵ":"ضح","ﰣ":"ضح","ﵮ":"ضحى","ﶫ":"ضحى","ﲶ":"ضخ","ﰤ":"ضخ","ﵰ":"ضخم","ﵯ":"ضخم","ﴬ":"ضر","ﴐ":"ضر","ﲷ":"ضم","ﰥ":"ضم","ﴣ":"ضى","ﴇ":"ضى","ﴤ":"ضى","ﴈ":"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط","ﻃ":"ط","ﻄ":"ط","ﻂ":"ط","ﻁ":"ط","ڟ":"طۛ","ﲸ":"طح","ﰦ":"طح","ﴳ":"طم","ﴺ":"طم","ﰧ":"طم","ﵲ":"طمح","ﵱ":"طمح","ﵳ":"طمم","ﵴ":"طمى","ﴑ":"طى","ﳵ":"طى","ﴒ":"طى","ﳶ":"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ","ﻇ":"ظ","ﻈ":"ظ","ﻆ":"ظ","ﻅ":"ظ","ﲹ":"ظم","ﴻ":"ظم","ﰨ":"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع","ﻋ":"ع","ﻌ":"ع","ﻊ":"ع","ﻉ":"ع","ﲺ":"عج","ﰩ":"عج","ﷄ":"عجم","ﵵ":"عجم","ﷷ":"علىo","ﲻ":"عم","ﰪ":"عم","ﵷ":"عمم","ﵶ":"عمم","ﵸ":"عمى","ﶶ":"عمى","ﴓ":"عى","ﳷ":"عى","ﴔ":"عى","ﳸ":"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ","ﻏ":"غ","ﻐ":"غ","ﻎ":"غ","ﻍ":"غ","ﲼ":"غج","ﰫ":"غج","ﲽ":"غم","ﰬ":"غم","ﵹ":"غمم","ﵻ":"غمى","ﵺ":"غمى","ﴕ":"غى","ﳹ":"غى","ﴖ":"غى","ﳺ":"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف","ﻓ":"ف","ﻔ":"ف","ﻒ":"ف","ﻑ":"ف","ڧ":"ف","ﲾ":"فج","ﰭ":"فج","ﲿ":"فح","ﰮ":"فح","ﳀ":"فخ","ﰯ":"فخ","ﵽ":"فخم","ﵼ":"فخم","ﳁ":"فم","ﰰ":"فم","ﷁ":"فمى","ﱼ":"فى","ﰱ":"فى","ﱽ":"فى","ﰲ":"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ","ڤ":"ڡۛ","ﭬ":"ڡۛ","ﭭ":"ڡۛ","ﭫ":"ڡۛ","ﭪ":"ڡۛ","ڨ":"ڡۛ","ࢤ":"ڢۛ","ﭰ":"ڦ","ﭱ":"ڦ","ﭯ":"ڦ","ﭮ":"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق","ﻗ":"ق","ﻘ":"ق","ﻖ":"ق","ﻕ":"ق","ﳂ":"قح","ﰳ":"قح","ﷱ":"قلى","ﳃ":"قم","ﰴ":"قم","ﶴ":"قمح","ﵾ":"قمح","ﵿ":"قمم","ﶲ":"قمى","ﱾ":"قى","ﰵ":"قى","ﱿ":"قى","ﰶ":"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك","ﻛ":"ك","ﻜ":"ك","ﻚ":"ك","ﻙ":"ك","ک":"ك","ﮐ":"ك","ﮑ":"ك","ﮏ":"ك","ﮎ":"ك","ڪ":"ك","ڭ":"كۛ","ﯕ":"كۛ","ﯖ":"كۛ","ﯔ":"كۛ","ﯓ":"كۛ","ݣ":"كۛ","ﲀ":"كl","ﰷ":"كl","ﳄ":"كج","ﰸ":"كج","ﳅ":"كح","ﰹ":"كح","ﳆ":"كخ","ﰺ":"كخ","ﳇ":"كل","ﳫ":"كل","ﲁ":"كل","ﰻ":"كل","ﳈ":"كم","ﳬ":"كم","ﲂ":"كم","ﰼ":"كم","ﷃ":"كمم","ﶻ":"كمم","ﶷ":"كمى","ﲃ":"كى","ﰽ":"كى","ﲄ":"كى","ﰾ":"كى","ݢ":"ڬ","ﮔ":"گ","ﮕ":"گ","ﮓ":"گ","ﮒ":"گ","ࢰ":"گ","ڴ":"گۛ","ﮜ":"ڱ","ﮝ":"ڱ","ﮛ":"ڱ","ﮚ":"ڱ","ﮘ":"ڳ","ﮙ":"ڳ","ﮗ":"ڳ","ﮖ":"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل","ﻟ":"ل","ﻠ":"ل","ﻞ":"ل","ﻝ":"ل","ڷ":"لۛ","ڵ":"ل̆","ﻼ":"لl","ﻻ":"لl","ﻺ":"لlٕ","ﻹ":"لlٕ","ﻸ":"لlٴ","ﻷ":"لlٴ","ﳍ":"لo","ﻶ":"لآ","ﻵ":"لآ","ﳉ":"لج","ﰿ":"لج","ﶃ":"لجج","ﶄ":"لجج","ﶺ":"لجم","ﶼ":"لجم","ﶬ":"لجى","ﳊ":"لح","ﱀ":"لح","ﶵ":"لحم","ﶀ":"لحم","ﶂ":"لحى","ﶁ":"لحى","ﳋ":"لخ","ﱁ":"لخ","ﶆ":"لخم","ﶅ":"لخم","ﳌ":"لم","ﳭ":"لم","ﲅ":"لم","ﱂ":"لم","ﶈ":"لمح","ﶇ":"لمح","ﶭ":"لمى","ﲆ":"لى","ﱃ":"لى","ﲇ":"لى","ﱄ":"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م","ﻣ":"م","ﻤ":"م","ﻢ":"م","ﻡ":"م","ࢧ":"مۛ","۾":"م͈","ﲈ":"مl","ﳎ":"مج","ﱅ":"مج","ﶌ":"مجح","ﶒ":"مجخ","ﶍ":"مجم","ﷀ":"مجى","ﳏ":"مح","ﱆ":"مح","ﶉ":"محج","ﶊ":"محم","ﷴ":"محمد","ﶋ":"محى","ﳐ":"مخ","ﱇ":"مخ","ﶎ":"مخج","ﶏ":"مخم","ﶹ":"مخى","ﳑ":"مم","ﲉ":"مم","ﱈ":"مم","ﶱ":"ممى","ﱉ":"مى","ﱊ":"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن","ﻧ":"ن","ﻨ":"ن","ﻦ":"ن","ﻥ":"ن","ݨ":"نؕ","ݩ":"ن̆","ﳖ":"نo","ﳯ":"نo","ﶸ":"نجح","ﶽ":"نجح","ﶘ":"نجم","ﶗ":"نجم","ﶙ":"نجى","ﷇ":"نجى","ﳓ":"نح","ﱌ":"نح","ﶕ":"نحم","ﶖ":"نحى","ﶳ":"نحى","ﳔ":"نخ","ﱍ":"نخ","ﲊ":"نر","ﲋ":"نز","ﳕ":"نم","ﳮ":"نم","ﲌ":"نم","ﱎ":"نم","ﶛ":"نمى","ﶚ":"نمى","ﲍ":"نن","ﲎ":"نى","ﱏ":"نى","ﲏ":"نى","ﱐ":"نى","ۂ":"ۀ","ﮥ":"ۀ","ﮤ":"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و","ﻮ":"و","ﻭ":"و","ࢱ":"و","ۋ":"وۛ","ﯟ":"وۛ","ﯞ":"وۛ","ۇ":"و̓","ﯘ":"و̓","ﯗ":"و̓","ۆ":"و̆","ﯚ":"و̆","ﯙ":"و̆","ۉ":"و̂","ﯣ":"و̂","ﯢ":"و̂","ۈ":"وٰ","ﯜ":"وٰ","ﯛ":"وٰ","ؤ":"وٴ","ﺆ":"وٴ","ﺅ":"وٴ","ٶ":"وٴ","ٷ":"و̓ٴ","ﯝ":"و̓ٴ","ﷸ":"وسلم","ﯡ":"ۅ","ﯠ":"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى","ں":"ى","𞸝":"ى","𞹝":"ى","ﮟ":"ى","ﮞ":"ى","ࢽ":"ى","ﯨ":"ى","ﯩ":"ى","ﻰ":"ى","ﻯ":"ى","ي":"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى","ﻳ":"ى","ﻴ":"ى","ﻲ":"ى","ﻱ":"ى","ی":"ى","ﯾ":"ى","ﯿ":"ى","ﯽ":"ى","ﯼ":"ى","ے":"ى","ﮯ":"ى","ﮮ":"ى","ٹ":"ىؕ","ﭨ":"ىؕ","ﭩ":"ىؕ","ﭧ":"ىؕ","ﭦ":"ىؕ","ڻ":"ىؕ","ﮢ":"ىؕ","ﮣ":"ىؕ","ﮡ":"ىؕ","ﮠ":"ىؕ","پ":"ىۛ","ﭘ":"ىۛ","ﭙ":"ىۛ","ﭗ":"ىۛ","ﭖ":"ىۛ","ث":"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ","ﺛ":"ىۛ","ﺜ":"ىۛ","ﺚ":"ىۛ","ﺙ":"ىۛ","ڽ":"ىۛ","ۑ":"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆","ێ":"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ","ﲐ":"ىٰ","ﱝ":"ىٰ","ﳞ":"ىo","ﳱ":"ىo","ﳦ":"ىۛo","ئ":"ىٴ","ﺋ":"ىٴ","ﺌ":"ىٴ","ﺊ":"ىٴ","ﺉ":"ىٴ","ٸ":"ىٴ","ﯫ":"ىٴl","ﯪ":"ىٴl","ﲛ":"ىٴo","ﳠ":"ىٴo","ﯭ":"ىٴo","ﯬ":"ىٴo","ﯸ":"ىٴٻ","ﯷ":"ىٴٻ","ﯶ":"ىٴٻ","ﲗ":"ىٴج","ﰀ":"ىٴج","ﲘ":"ىٴح","ﰁ":"ىٴح","ﲙ":"ىٴخ","ﱤ":"ىٴر","ﱥ":"ىٴز","ﲚ":"ىٴم","ﳟ":"ىٴم","ﱦ":"ىٴم","ﰂ":"ىٴم","ﱧ":"ىٴن","ﯯ":"ىٴو","ﯮ":"ىٴو","ﯱ":"ىٴو̓","ﯰ":"ىٴو̓","ﯳ":"ىٴو̆","ﯲ":"ىٴو̆","ﯵ":"ىٴوٰ","ﯴ":"ىٴوٰ","ﯻ":"ىٴى","ﯺ":"ىٴى","ﱨ":"ىٴى","ﯹ":"ىٴى","ﰃ":"ىٴى","ﱩ":"ىٴى","ﰄ":"ىٴى","ﳚ":"ىج","ﱕ":"ىج","ﰑ":"ىۛج","ﶯ":"ىجى","ﳛ":"ىح","ﱖ":"ىح","ﶮ":"ىحى","ﳜ":"ىخ","ﱗ":"ىخ","ﲑ":"ىر","ﱶ":"ىۛر","ﲒ":"ىز","ﱷ":"ىۛز","ﳝ":"ىم","ﳰ":"ىم","ﲓ":"ىم","ﱘ":"ىم","ﲦ":"ىۛم","ﳥ":"ىۛم","ﱸ":"ىۛم","ﰒ":"ىۛم","ﶝ":"ىمم","ﶜ":"ىمم","ﶰ":"ىمى","ﲔ":"ىن","ﱹ":"ىۛن","ﲕ":"ىى","ﱙ":"ىى","ﲖ":"ىى","ﱚ":"ىى","ﱺ":"ىۛى","ﰓ":"ىۛى","ﱻ":"ىۛى","ﰔ":"ىۛى","ﮱ":"ۓ","ﮰ":"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ","Մ":"ሆ","Ռ":"ቡ","Ի":"ኮ","Պ":"ጣ","आ":"अा","ऒ":"अाॆ","ओ":"अाे","औ":"अाै","ऄ":"अॆ","ऑ":"अॉ","ऍ":"एॅ","ऎ":"एॆ","ऐ":"एे","ई":"र्इ","ઽ":"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्","আ":"অা","ৠ":"ঋৃ","ৡ":"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ","ਉ":"ੳੁ","ਊ":"ੳੂ","ਆ":"ਅਾ","ਐ":"ਅੈ","ਔ":"ਅੌ","ਇ":"ੲਿ","ਈ":"ੲੀ","ਏ":"ੲੇ","આ":"અા","ઑ":"અાૅ","ઓ":"અાે","ઔ":"અાૈ","ઍ":"અૅ","એ":"અે","ઐ":"અૈ","ଆ":"ଅା","௮":"அ","ர":"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ","ഉ":"உ","ஊ":"உள","ഊ":"உൗ","௭":"எ","௷":"எவ","ஜ":"ஐ","ജ":"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி","ണ":"ண","௺":"நீ","௴":"மீ","௰":"ய","ഴ":"ழ","ௗ":"ள","ை":"ன","ശ":"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ","ಅ":"అ","ಆ":"ఆ","ಇ":"ఇ","ౠ":"ఋా","ౡ":"ఌా","ಒ":"ఒ","ఔ":"ఒౌ","ಔ":"ఒౌ","ఓ":"ఒౕ","ಓ":"ఒౕ","ಜ":"జ","ಞ":"ఞ","ఢ":"డ̣","ಣ":"ణ","థ":"ధּ","భ":"బ̣","ಯ":"య","ఠ":"రּ","ಱ":"ఱ","ಲ":"ల","ష":"వ̣","హ":"వా","మ":"వు","ూ":"ుా","ౄ":"ృా","ೡ":"ಌಾ","ഈ":"ഇൗ","ഐ":"എെ","ഓ":"ഒാ","ഔ":"ഒൗ","ൡ":"ഞ","൫":"ദ്ര","൹":"നു","ഌ":"നു","ങ":"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ","റ":"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳","ฃ":"ข","ด":"ค","ต":"ค","ม":"ฆ","ຈ":"จ","ซ":"ช","ฏ":"ฎ","ท":"ฑ","ບ":"บ","ປ":"ป","ຝ":"ฝ","ພ":"พ","ຟ":"ฟ","ฦ":"ภ","ຍ":"ย","។":"ฯ","ๅ":"า","ำ":"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู","แ":"เเ","ໜ":"ຫນ","ໝ":"ຫມ","ຳ":"̊າ","༂":"འུྂཿ","༃":"འུྂ༔","ཪ":"ར","ༀ":"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ","က":"ဂာ","ၰ":"ဃှ","ၦ":"ပှ","ဟ":"ပာ","ၯ":"ပာှ","ၾ":"ၽှ","ဩ":"သြ","ဪ":"သြော်","႞":"ႃ̊","ឣ":"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ","ᢖ":"ᡜ","ᡕ":"ᠵ","ῶ":"Ꮿ","ᐍ":"ᐁ·","ᐫ":"ᐁᐠ","ᐑ":"ᐄ·","ᐓ":"ᐅ·","ᐭ":"ᐅᐠ","ᐕ":"ᐆ·","ᐘ":"ᐊ·","ᐮ":"ᐊᐠ","ᐚ":"ᐋ·","ᣝ":"ᐞᣟ","ᓑ":"ᐡ","ᕀ":"ᐩ","ᐿ":"ᐲ·","ᑃ":"ᐴ·","⍩":"ᐵ","ᑇ":"ᐹ·","ᑜ":"ᑏ·","⸧":"ᑐ","⊃":"ᑐ","ᑞ":"ᑐ·","ᑩ":"ᑐ\'","⟉":"ᑐ/","⫗":"ᑐᑕ","ᑠ":"ᑑ·","⸦":"ᑕ","⊂":"ᑕ","ᑢ":"ᑕ·","ᑪ":"ᑕ\'","ᑤ":"ᑖ·","ᑵ":"ᑫ·","ᒅ":"ᑫ\'","ᑹ":"ᑮ·","ᑽ":"ᑰ·","ᘃ":"ᒉ","ᒓ":"ᒉ·","ᒕ":"ᒋ·","ᒗ":"ᒌ·","ᒛ":"ᒎ·","ᘂ":"ᒐ","ᒝ":"ᒐ·","ᒟ":"ᒑ·","ᒭ":"ᒣ·","ᒱ":"ᒦ·","ᒳ":"ᒧ·","ᒵ":"ᒨ·","ᒹ":"ᒫ·","ᓊ":"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·","ᓌ":"ᓇ·","ᓎ":"ᓈ·","ᘄ":"ᓓ","ᓝ":"ᓓ·","ᓟ":"ᓕ·","ᓡ":"ᓖ·","ᓣ":"ᓗ·","ᓥ":"ᓘ·","ᘇ":"ᓚ","ᓧ":"ᓚ·","ᓩ":"ᓛ·","ᓷ":"ᓭ·","ᓹ":"ᓯ·","ᓻ":"ᓰ·","ᓽ":"ᓱ·","ᓿ":"ᓲ·","ᔁ":"ᓴ·","ᔃ":"ᓵ·","ᔌ":"ᔋ<","ᔎ":"ᔋb","ᔍ":"ᔋᑕ","ᔏ":"ᔋᒐ","ᔘ":"ᔐ·","ᔚ":"ᔑ·","ᔜ":"ᔒ·","ᔞ":"ᔓ·","ᔠ":"ᔔ·","ᔢ":"ᔕ·","ᔤ":"ᔖ·","ᔲ":"ᔨ·","ᔴ":"ᔩ·","ᔶ":"ᔪ·","ᔸ":"ᔫ·","ᔺ":"ᔭ·","ᔼ":"ᔮ·","ᘢ":"ᕃ","ᣠ":"ᕃ·","ᘣ":"ᕆ","ᘤ":"ᕊ","ᕏ":"ᕌ·","ᖃ":"ᕐb","ᖄ":"ᕐḃ","ᖁ":"ᕐd","ᕿ":"ᕐP","ᙯ":"ᕐᑫ","ᕾ":"ᕐᑬ","ᖀ":"ᕐᑮ","ᖂ":"ᕐᑰ","ᖅ":"ᕐᒃ","ᕜ":"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·","ᕩ":"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·","ᖑ":"ᖕJ","ᙰ":"ᖕᒉ","ᖎ":"ᖕᒊ","ᖏ":"ᖕᒋ","ᖐ":"ᖕᒌ","ᖒ":"ᖕᒎ","ᖓ":"ᖕᒐ","ᖔ":"ᖕᒑ","ᙳ":"ᖖJ","ᙱ":"ᖖᒋ","ᙲ":"ᖖᒌ","ᙴ":"ᖖᒎ","ᙵ":"ᖖᒐ","ᙶ":"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ","ˡ":"ᣳ","ʳ":"ᣴ","ˢ":"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ","ᛡ":"ᚼ","⍿":"ᚽ","ᛂ":"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥","ㄱ":"ᄀ","ᆨ":"ᄀ","ᄁ":"ᄀᄀ","ㄲ":"ᄀᄀ","ᆩ":"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ","ᇃ":"ᄀᄅ","ᇻ":"ᄀᄇ","ᆪ":"ᄀᄉ","ㄳ":"ᄀᄉ","ᇄ":"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ","ㄴ":"ᄂ","ᆫ":"ᄂ","ᄓ":"ᄂᄀ","ᇅ":"ᄂᄀ","ᄔ":"ᄂᄂ","ㅥ":"ᄂᄂ","ᇿ":"ᄂᄂ","ᄕ":"ᄂᄃ","ㅦ":"ᄂᄃ","ᇆ":"ᄂᄃ","ퟋ":"ᄂᄅ","ᄖ":"ᄂᄇ","ᅛ":"ᄂᄉ","ᇇ":"ᄂᄉ","ㅧ":"ᄂᄉ","ᅜ":"ᄂᄌ","ᆬ":"ᄂᄌ","ㄵ":"ᄂᄌ","ퟌ":"ᄂᄎ","ᇉ":"ᄂᄐ","ᅝ":"ᄂᄒ","ᆭ":"ᄂᄒ","ㄶ":"ᄂᄒ","ᇈ":"ᄂᅀ","ㅨ":"ᄂᅀ","ㄷ":"ᄃ","ᆮ":"ᄃ","ᄗ":"ᄃᄀ","ᇊ":"ᄃᄀ","ᄄ":"ᄃᄃ","ㄸ":"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ","ᇋ":"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ","ㄹ":"ᄅ","ᆯ":"ᄅ","ꥤ":"ᄅᄀ","ᆰ":"ᄅᄀ","ㄺ":"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ","ᇌ":"ᄅᄀᄉ","ㅩ":"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ","ᄘ":"ᄅᄂ","ᇍ":"ᄅᄂ","ꥦ":"ᄅᄃ","ᇎ":"ᄅᄃ","ㅪ":"ᄅᄃ","ꥧ":"ᄅᄃᄃ","ᇏ":"ᄅᄃᄒ","ᄙ":"ᄅᄅ","ᇐ":"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ","ᆱ":"ᄅᄆ","ㄻ":"ᄅᄆ","ᇑ":"ᄅᄆᄀ","ᇒ":"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ","ᆲ":"ᄅᄇ","ㄼ":"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ","ᇓ":"ᄅᄇᄉ","ㅫ":"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ","ᇕ":"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ","ᇔ":"ᄅᄇᄒ","ꥬ":"ᄅᄉ","ᆳ":"ᄅᄉ","ㄽ":"ᄅᄉ","ᇖ":"ᄅᄉᄉ","ᄛ":"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ","ᇘ":"ᄅᄏ","ᆴ":"ᄅᄐ","ㄾ":"ᄅᄐ","ᆵ":"ᄅᄑ","ㄿ":"ᄅᄑ","ᄚ":"ᄅᄒ","ㅀ":"ᄅᄒ","ᄻ":"ᄅᄒ","ᆶ":"ᄅᄒ","ퟲ":"ᄅᄒ","ᇗ":"ᄅᅀ","ㅬ":"ᄅᅀ","ퟛ":"ᄅᅌ","ᇙ":"ᄅᅙ","ㅭ":"ᄅᅙ","ퟜ":"ᄅᅙᄒ","ㅁ":"ᄆ","ᆷ":"ᄆ","ꥯ":"ᄆᄀ","ᇚ":"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ","ᇛ":"ᄆᄅ","ퟠ":"ᄆᄆ","ᄜ":"ᄆᄇ","ㅮ":"ᄆᄇ","ᇜ":"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ","ᇝ":"ᄆᄉ","ㅯ":"ᄆᄉ","ᇞ":"ᄆᄉᄉ","ᄝ":"ᄆᄋ","ㅱ":"ᄆᄋ","ᇢ":"ᄆᄋ","ퟢ":"ᄆᄌ","ᇠ":"ᄆᄎ","ᇡ":"ᄆᄒ","ᇟ":"ᄆᅀ","ㅰ":"ᄆᅀ","ㅂ":"ᄇ","ᆸ":"ᄇ","ᄞ":"ᄇᄀ","ㅲ":"ᄇᄀ","ᄟ":"ᄇᄂ","ᄠ":"ᄇᄃ","ㅳ":"ᄇᄃ","ퟣ":"ᄇᄃ","ᇣ":"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ","ᄈ":"ᄇᄇ","ㅃ":"ᄇᄇ","ퟦ":"ᄇᄇ","ᄬ":"ᄇᄇᄋ","ㅹ":"ᄇᄇᄋ","ᄡ":"ᄇᄉ","ㅄ":"ᄇᄉ","ᆹ":"ᄇᄉ","ᄢ":"ᄇᄉᄀ","ㅴ":"ᄇᄉᄀ","ᄣ":"ᄇᄉᄃ","ㅵ":"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ","ᄤ":"ᄇᄉᄇ","ᄥ":"ᄇᄉᄉ","ᄦ":"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ","ᄫ":"ᄇᄋ","ㅸ":"ᄇᄋ","ᇦ":"ᄇᄋ","ᄧ":"ᄇᄌ","ㅶ":"ᄇᄌ","ퟨ":"ᄇᄌ","ᄨ":"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ","ᄩ":"ᄇᄐ","ㅷ":"ᄇᄐ","ᄪ":"ᄇᄑ","ᇤ":"ᄇᄑ","ꥴ":"ᄇᄒ","ᇥ":"ᄇᄒ","ㅅ":"ᄉ","ᆺ":"ᄉ","ᄭ":"ᄉᄀ","ㅺ":"ᄉᄀ","ᇧ":"ᄉᄀ","ᄮ":"ᄉᄂ","ㅻ":"ᄉᄂ","ᄯ":"ᄉᄃ","ㅼ":"ᄉᄃ","ᇨ":"ᄉᄃ","ᄰ":"ᄉᄅ","ᇩ":"ᄉᄅ","ᄱ":"ᄉᄆ","ퟪ":"ᄉᄆ","ᄲ":"ᄉᄇ","ㅽ":"ᄉᄇ","ᇪ":"ᄉᄇ","ᄳ":"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ","ᄊ":"ᄉᄉ","ㅆ":"ᄉᄉ","ᆻ":"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ","ᄴ":"ᄉᄉᄉ","ᄵ":"ᄉᄋ","ᄶ":"ᄉᄌ","ㅾ":"ᄉᄌ","ퟯ":"ᄉᄌ","ᄷ":"ᄉᄎ","ퟰ":"ᄉᄎ","ᄸ":"ᄉᄏ","ᄹ":"ᄉᄐ","ퟱ":"ᄉᄐ","ᄺ":"ᄉᄑ","ퟮ":"ᄉᅀ","ㅇ":"ᄋ","ᆼ":"ᄋ","ᅁ":"ᄋᄀ","ᇬ":"ᄋᄀ","ᇭ":"ᄋᄀᄀ","ᅂ":"ᄋᄃ","ꥶ":"ᄋᄅ","ᅃ":"ᄋᄆ","ᅄ":"ᄋᄇ","ᅅ":"ᄋᄉ","ᇱ":"ᄋᄉ","ㆂ":"ᄋᄉ","ᅇ":"ᄋᄋ","ㆀ":"ᄋᄋ","ᇮ":"ᄋᄋ","ᅈ":"ᄋᄌ","ᅉ":"ᄋᄎ","ᇯ":"ᄋᄏ","ᅊ":"ᄋᄐ","ᅋ":"ᄋᄑ","ꥷ":"ᄋᄒ","ᅆ":"ᄋᅀ","ᇲ":"ᄋᅀ","ㆃ":"ᄋᅀ","ㅈ":"ᄌ","ᆽ":"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ","ᅍ":"ᄌᄋ","ᄍ":"ᄌᄌ","ㅉ":"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ","ㅊ":"ᄎ","ᆾ":"ᄎ","ᅒ":"ᄎᄏ","ᅓ":"ᄎᄒ","ㅋ":"ᄏ","ᆿ":"ᄏ","ㅌ":"ᄐ","ᇀ":"ᄐ","ꥹ":"ᄐᄐ","ㅍ":"ᄑ","ᇁ":"ᄑ","ᅖ":"ᄑᄇ","ᇳ":"ᄑᄇ","ퟺ":"ᄑᄉ","ᅗ":"ᄑᄋ","ㆄ":"ᄑᄋ","ᇴ":"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ","ㅎ":"ᄒ","ᇂ":"ᄒ","ᇵ":"ᄒᄂ","ᇶ":"ᄒᄅ","ᇷ":"ᄒᄆ","ᇸ":"ᄒᄇ","ꥻ":"ᄒᄉ","ᅘ":"ᄒᄒ","ㆅ":"ᄒᄒ","ᄽ":"ᄼᄼ","ᄿ":"ᄾᄾ","ㅿ":"ᅀ","ᇫ":"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ","ㆁ":"ᅌ","ᇰ":"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ","ᅏ":"ᅎᅎ","ᅑ":"ᅐᅐ","ㆆ":"ᅙ","ᇹ":"ᅙ","ꥼ":"ᅙᅙ","ㅤ":"ᅠ","ㅏ":"ᅡ","ᆣ":"ᅡー","ᅶ":"ᅡᅩ","ᅷ":"ᅡᅮ","ᅢ":"ᅡ丨","ㅐ":"ᅡ丨","ㅑ":"ᅣ","ᅸ":"ᅣᅩ","ᅹ":"ᅣᅭ","ᆤ":"ᅣᅮ","ᅤ":"ᅣ丨","ㅒ":"ᅣ丨","ㅓ":"ᅥ","ᅼ":"ᅥー","ᅺ":"ᅥᅩ","ᅻ":"ᅥᅮ","ᅦ":"ᅥ丨","ㅔ":"ᅥ丨","ㅕ":"ᅧ","ᆥ":"ᅧᅣ","ᅽ":"ᅧᅩ","ᅾ":"ᅧᅮ","ᅨ":"ᅧ丨","ㅖ":"ᅧ丨","ㅗ":"ᅩ","ᅪ":"ᅩᅡ","ㅘ":"ᅩᅡ","ᅫ":"ᅩᅡ丨","ㅙ":"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨","ᅿ":"ᅩᅥ","ᆀ":"ᅩᅥ丨","ힰ":"ᅩᅧ","ᆁ":"ᅩᅧ丨","ᆂ":"ᅩᅩ","ힱ":"ᅩᅩ丨","ᆃ":"ᅩᅮ","ᅬ":"ᅩ丨","ㅚ":"ᅩ丨","ㅛ":"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨","ᆄ":"ᅭᅣ","ㆇ":"ᅭᅣ","ᆆ":"ᅭᅣ","ᆅ":"ᅭᅣ丨","ㆈ":"ᅭᅣ丨","ힴ":"ᅭᅥ","ᆇ":"ᅭᅩ","ᆈ":"ᅭ丨","ㆉ":"ᅭ丨","ㅜ":"ᅮ","ᆉ":"ᅮᅡ","ᆊ":"ᅮᅡ丨","ᅯ":"ᅮᅥ","ㅝ":"ᅮᅥ","ᆋ":"ᅮᅥー","ᅰ":"ᅮᅥ丨","ㅞ":"ᅮᅥ丨","ힵ":"ᅮᅧ","ᆌ":"ᅮᅧ丨","ᆍ":"ᅮᅮ","ᅱ":"ᅮ丨","ㅟ":"ᅮ丨","ힶ":"ᅮ丨丨","ㅠ":"ᅲ","ᆎ":"ᅲᅡ","ힷ":"ᅲᅡ丨","ᆏ":"ᅲᅥ","ᆐ":"ᅲᅥ丨","ᆑ":"ᅲᅧ","ㆊ":"ᅲᅧ","ᆒ":"ᅲᅧ丨","ㆋ":"ᅲᅧ丨","ힸ":"ᅲᅩ","ᆓ":"ᅲᅮ","ᆔ":"ᅲ丨","ㆌ":"ᅲ丨","ㆍ":"ᆞ","ퟅ":"ᆞᅡ","ᆟ":"ᆞᅥ","ퟆ":"ᆞᅥ丨","ᆠ":"ᆞᅮ","ᆢ":"ᆞᆞ","ᆡ":"ᆞ丨","ㆎ":"ᆞ丨","ヘ":"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄","不":"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨","ᅵ":"丨","ㅣ":"丨","⼁":"丨","ᆜ":"丨ー","ᆘ":"丨ᅡ","ᆙ":"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨","ᆚ":"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ","ᆛ":"丨ᅮ","ퟃ":"丨ᅲ","ᆝ":"丨ᆞ","ퟄ":"丨丨","串":"串","丸":"丸","丹":"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀","亂":"亂","㇚":"亅","⼅":"亅","了":"了","ニ":"二","⼆":"二","𠄢":"𠄢","⼇":"亠","亮":"亮","⼈":"人","イ":"亻","⺅":"亻","什":"什","仌":"仌","令":"令","你":"你","倂":"併","倂":"併","侀":"侀","來":"來","例":"例","侮":"侮","侮":"侮","侻":"侻","便":"便","值":"値","倫":"倫","偺":"偺","備":"備","像":"像","僚":"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿","兀":"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全","兩":"兩","ハ":"八","⼋":"八","六":"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况","冷":"冷","凉":"凉","凌":"凌","凜":"凜","凞":"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃","切":"切","切":"切","列":"列","利":"利","㓟":"㓟","刺":"刺","刻":"刻","剆":"剆","割":"割","剷":"剷","劉":"劉","𠠄":"𠠄","カ":"力","力":"力","⼒":"力","劣":"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉","勒":"勒","勞":"勞","勤":"勤","勤":"勤","勵":"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕","北":"北","北":"北","⼕":"匚","⼖":"匸","匿":"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博","ト":"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即","卵":"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶","參":"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣","ロ":"口","⼝":"口","囗":"口","⼞":"口","句":"句","叫":"叫","叱":"叱","吆":"吆","吏":"吏","吝":"吝","吸":"吸","呂":"呂","呈":"呈","周":"周","咞":"咞","咢":"咢","咽":"咽","䎛":"㖈","哶":"哶","唐":"唐","啓":"啓","啟":"啓","啕":"啕","啣":"啣","善":"善","善":"善","喇":"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳","嗀":"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器","囹":"囹","圖":"圖","圗":"圗","⼟":"土","士":"土","⼠":"土","型":"型","城":"城","㦳":"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀","塚":"塚","塚":"塚","塞":"塞","填":"塡","壿":"墫","墬":"墬","墳":"墳","壘":"壘","壟":"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊","タ":"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄","奈":"奈","契":"契","奔":"奔","奢":"奢","女":"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦","嬀":"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀","宅":"宅","𡧈":"𡧈","寃":"寃","寘":"寘","寧":"寧","寧":"寧","寧":"寧","寮":"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸","尿":"尿","屠":"屠","屢":"屢","層":"層","履":"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦","崙":"崙","嵃":"嵃","嵐":"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲","嶺":"嶺","⼮":"巛","巢":"巢","エ":"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾","帲":"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干","年":"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广","度":"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶","廊":"廊","廊":"廊","廉":"廉","廒":"廒","廓":"廓","廙":"廙","廬":"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱","弄":"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳","律":"律","㣣":"㣣","徚":"徚","復":"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志","念":"念","忹":"忹","怒":"怒","怜":"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘","惡":"惡","𢛔":"𢛔","愈":"愈","慨":"慨","慄":"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎","憐":"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲","懶":"懶","懶":"懶","戀":"戀","⼽":"戈","成":"成","戛":"戛","戮":"戮","戴":"戴","⼾":"戶","戸":"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱","拉":"拉","拏":"拏","拓":"拓","拔":"拔","拼":"拼","拾":"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨","捻":"捻","掃":"掃","掠":"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮","搉":"㩁","撚":"撚","撝":"撝","擄":"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬","數":"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗","料":"料","⽄":"斤","⽅":"方","旅":"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日","易":"易","曶":"㫚","㫤":"㫤","晉":"晉","晩":"晚","晴":"晴","晴":"晴","暑":"暑","暑":"暑","暈":"暈","㬈":"㬈","暜":"暜","暴":"暴","曆":"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰","更":"更","書":"書","⽉":"月","𣍟":"𣍟","肦":"朌","胐":"朏","胊":"朐","脁":"朓","胶":"㬵","朗":"朗","朗":"朗","朗":"朗","脧":"朘","望":"望","望":"望","幐":"㬺","䐠":"㬻","𣎓":"𣎓","膧":"朣","𣎜":"𣎜","⽊":"木","李":"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃","柿":"杮","杻":"杻","枅":"枅","林":"林","㭉":"㭉","𣏕":"𣏕","柳":"柳","柺":"柺","栗":"栗","栟":"栟","桒":"桒","𣑭":"𣑭","梁":"梁","梅":"梅","梅":"梅","梎":"梎","梨":"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝","槩":"㮣","樧":"榝","榣":"榣","槪":"槪","樂":"樂","樂":"樂","樂":"樂","樓":"樓","𣚣":"𣚣","檨":"檨","櫓":"櫓","櫛":"櫛","欄":"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲","歷":"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟","殮":"殮","⽎":"殳","殺":"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧","沈":"沈","沿":"沿","泌":"泌","泍":"泍","泥":"泥","𣲼":"𣲼","洛":"洛","洞":"洞","洴":"洴","派":"派","流":"流","流":"流","流":"流","洖":"洖","浩":"浩","浪":"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞","淋":"淋","淚":"淚","淪":"淪","淹":"淹","渚":"渚","港":"港","湮":"湮","潙":"溈","滋":"滋","滋":"滋","溜":"溜","溺":"溺","滇":"滇","滑":"滑","滛":"滛","㴳":"㴳","漏":"漏","漢":"漢","漢":"漢","漣":"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆","濫":"濫","濾":"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災","炙":"炙","炭":"炭","烈":"烈","烙":"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅","煉":"煉","𤋮":"𤋮","熜":"熜","燎":"燎","燐":"燐","𤎫":"𤎫","爐":"爐","爛":"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛","牢":"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯","狀":"狀","𤜵":"𤜵","狼":"狼","猪":"猪","猪":"猪","𤠔":"𤠔","獵":"獵","獺":"獺","⽞":"玄","率":"率","率":"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥","玲":"玲","㺸":"㺸","㺸":"㺸","珞":"珞","琉":"琉","理":"理","琢":"琢","瑇":"瑇","瑜":"瑜","瑩":"瑩","瑱":"瑱","瑱":"瑱","璅":"璅","璉":"璉","璘":"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶","留":"留","略":"略","異":"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒","痢":"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝","療":"療","癩":"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼","益":"益","益":"益","盛":"盛","盧":"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳","省":"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹","晣":"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝","硏":"研","硎":"硎","硫":"硫","碌":"碌","碌":"碌","碑":"碑","磊":"磊","磌":"磌","磌":"磌","磻":"磻","䃣":"䃣","礪":"礪","⽰":"示","⺭":"礻","礼":"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝","神":"神","祥":"祥","視":"視","視":"視","祿":"祿","𥚚":"𥚚","禍":"禍","禎":"禎","福":"福","福":"福","𥛅":"𥛅","禮":"禮","⽱":"禸","⽲":"禾","秊":"秊","䄯":"䄯","秫":"秫","稜":"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱","立":"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹","笠":"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐","簾":"簾","籠":"籠","⽶":"米","类":"类","粒":"粒","精":"精","糒":"糒","糖":"糖","糨":"糨","䊠":"䊠","糣":"糣","糧":"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀","紐":"紐","索":"索","累":"累","絶":"絕","絣":"絣","絛":"絛","綠":"綠","綾":"綾","緇":"緇","練":"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉","縷":"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙","罹":"罹","罺":"罺","羅":"羅","𦌾":"𦌾","⽺":"羊","羕":"羕","羚":"羚","羽":"羽","⽻":"羽","翺":"翺","老":"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳","聆":"聆","聠":"聠","𦖨":"𦖨","聯":"聯","聰":"聰","聾":"聾","⾀":"聿","⺺":"肀","⾁":"肉","肋":"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙","腁":"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵","朦":"䑃","臘":"臘","⾂":"臣","臨":"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮","良":"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽","若":"若","若":"若","苦":"苦","𦬼":"𦬼","茶":"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓","菉":"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華","菱":"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭","落":"落","葉":"葉","蔿":"蒍","𦳕":"𦳕","𦵫":"𦵫","蓮":"蓮","蓱":"蓱","蓳":"蓳","蓼":"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬","藍":"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡","藺":"藺","蘆":"蘆","䕫":"䕫","蘒":"蘒","蘭":"蘭","𧃒":"𧃒","虁":"蘷","蘿":"蘿","⾌":"虍","⻁":"虎","虐":"虐","虜":"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊","螺":"螺","蠁":"蠁","䗹":"䗹","蠟":"蠟","⾎":"血","行":"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤","裂":"裂","𧙧":"𧙧","裏":"裏","裗":"裗","裞":"裞","裡":"裡","裸":"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁","襤":"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆","見":"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦","詽":"訮","訞":"䚶","䚾":"䚾","䛇":"䛇","誠":"誠","說":"說","說":"說","調":"調","請":"請","諒":"諒","論":"論","諭":"諭","諭":"諭","諸":"諸","諸":"諸","諾":"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹","識":"識","讀":"讀","讏":"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆","豈":"豈","豕":"豕","⾗":"豕","豣":"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁","賂":"賂","賈":"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起","趆":"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼","跺":"跥","路":"路","跰":"跰","躛":"躗","⾝":"身","車":"車","⾞":"車","軔":"軔","輧":"軿","輦":"輦","輪":"輪","輸":"輸","輸":"輸","輻":"輻","轢":"轢","⻋":"车","⾟":"辛","辞":"辞","辰":"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡","連":"連","逸":"逸","逸":"逸","遲":"遲","遼":"遼","𨗒":"𨗒","𨗭":"𨗭","邏":"邏","⾢":"邑","邔":"邔","郎":"郎","郞":"郎","郞":"郎","郱":"郱","都":"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉","酪":"酪","醙":"醙","醴":"醴","⾤":"釆","里":"里","⾥":"里","量":"量","金":"金","⾦":"金","鈴":"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼","錄":"錄","鍊":"鍊","鎮":"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕","閭":"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝","阮":"阮","陋":"陋","降":"降","陵":"陵","陸":"陸","陼":"陼","隆":"隆","隣":"隣","䧦":"䧦","⾪":"隶","隷":"隷","隸":"隷","隸":"隷","⾫":"隹","雃":"雃","離":"離","難":"難","難":"難","⾬":"雨","零":"零","雷":"雷","霣":"霣","𩅅":"𩅅","露":"露","靈":"靈","⾭":"靑","⻘":"青","靖":"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋","領":"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻","類":"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢","飯":"飯","飼":"飼","䬳":"䬳","館":"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂","駱":"駱","駾":"駾","驪":"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚","魯":"魯","鱀":"鱀","鱗":"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎","鶴":"鶴","𪄅":"𪄅","䳸":"䳸","鷺":"鷺","𪈎":"𪈎","鸞":"鸞","鹃":"鹂","⿄":"鹵","鹿":"鹿","⿅":"鹿","𪊑":"𪊑","麗":"麗","麟":"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍","黎":"黎","䵖":"䵖","⿊":"黑","黒":"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿","龍":"龍","⿓":"龍","龎":"龎","⻰":"龙","龜":"龜","龜":"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"}')})),n.register("bziKh",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("cksMj"),a=n("hxnqR"),s=n("hcUaE"),u=n("giCK6"),l=n("eQNFO"),c=n("9b5VH"),d=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],f=function(e){(0,o.default)(r,e);var t=(0,u.default)(r);function r(e){var n;return(0,i.default)(this,r),n=t.call(this),e instanceof Error?(n.originalError=e,e=e.message):(n.originalError=new Error(e),n.originalError.stack=n.stack),n.name="AbortError",n.message=e,n}return r}((0,s.default)(Error)),h=function(e,t){return new Promise((function(n,i){t=(0,a.default)({onFailedAttempt:function(){},retries:10},t);var o,s=c.operation(t);s.attempt((o=(0,r.default)((function(r){var o,a;return(0,l.__generator)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,10]),[4,e(r)];case 1:return n.apply(void 0,[u.sent()]),[3,10];case 2:return(o=u.sent())instanceof Error?o instanceof f?(s.stop(),i(o.originalError),[3,9]):[3,3]:(i(new TypeError('Non-error was thrown: "'.concat(o,'". You should only throw errors.'))),[2]);case 3:return o instanceof TypeError&&(l=o.message,!d.includes(l))?(s.stop(),i(o),[3,9]):[3,4];case 4:!function(e,t,r){var n=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=n}(o,r,t),u.label=5;case 5:return u.trys.push([5,7,,8]),[4,t.onFailedAttempt(o)];case 6:return u.sent(),[3,8];case 7:return a=u.sent(),i(a),[2];case 8:s.retry(o)||i(s.mainError()),u.label=9;case 9:return[3,10];case 10:return[2]}var l}))})),function(e){return o.apply(this,arguments)}))}))};e.exports=h,e.exports.default=h,e.exports.AbortError=f})),n.register("9b5VH",(function(e,t){e.exports=n("xtVO1")})),n.register("xtVO1",(function(t,r){var i,o,a,s;e(t.exports,"operation",(function(){return i}),(function(e){return i=e})),e(t.exports,"timeouts",(function(){return o}),(function(e){return o=e})),e(t.exports,"createTimeout",(function(){return a}),(function(e){return a=e})),e(t.exports,"wrap",(function(){return s}),(function(e){return s=e}));var u=n("ctVP9");i=function(e){var t=o(e);return new u(t,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},o=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},a=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},s=function(e,t,r){if(t instanceof Array&&(r=t,t=null),!r)for(var n in r=[],e)"function"==typeof e[n]&&r.push(n);for(var o=0;o<r.length;o++){var a=r[o],s=e[a];e[a]=function(r){var n=i(t),o=Array.prototype.slice.call(arguments,1),a=o.pop();o.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),a.apply(this,arguments))})),n.attempt((function(){r.apply(e,o)}))}.bind(e,s),e[a].options=t}}})),n.register("ctVP9",(function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,a=(e[o]||0)+1;e[o]=a,a>=r&&(t=i,r=a)}return t}})),n.register("3F1o7",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_TIMESTAMP=e.exports.M_LOCATION=e.exports.M_ASSET=e.exports.LocationAssetType=void 0;var r,i,o=n("kLCn9");n("1CE7S"),e.exports.LocationAssetType=r,(i=r||(e.exports.LocationAssetType=r={})).Self="m.self",i.Pin="m.pin";var a=new o.UnstableValue("m.asset","org.matrix.msc3488.asset");e.exports.M_ASSET=a;var s=new o.UnstableValue("m.ts","org.matrix.msc3488.ts");e.exports.M_TIMESTAMP=s;var u=new o.UnstableValue("m.location","org.matrix.msc3488.location");e.exports.M_LOCATION=u})),n.register("kLCn9",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("9oGi2"),u=n("giCK6"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnstableValue=e.exports.ServerControlledNamespacedValue=e.exports.NamespacedValue=void 0;var c=l(n("3rHpI")),d=function(){function e(t,r){if((0,i.default)(this,e),this.stable=t,this.unstable=r,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return(0,o.default)(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"names",get:function(){var e=[this.name],t=this.altName;return t&&e.push(t),e}},{key:"matches",value:function(e){return this.name===e||this.altName===e}},{key:"findIn",value:function(e){var t=void 0;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();e.exports.NamespacedValue=d;var f=function(e){(0,a.default)(n,e);var t=(0,u.default)(n);function n(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];var u;return(0,i.default)(this,n),u=t.call.apply(t,[this].concat((0,s.default)(o))),(0,c.default)((0,r.default)(u),"preferUnstable",!1),u}return(0,o.default)(n,[{key:"setPreferUnstable",value:function(e){this.preferUnstable=e}},{key:"name",get:function(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}]),n}(d);e.exports.ServerControlledNamespacedValue=f;var h=function(e){(0,a.default)(r,e);var t=(0,u.default)(r);function r(e,n){var o;if((0,i.default)(this,r),!(o=t.call(this,e,n)).unstable)throw new Error("Unstable value must be supplied");return o}return(0,o.default)(r,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),r}(d);e.exports.UnstableValue=h})),n.register("1CE7S",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TEXT_NODE_TYPE=void 0;var r=new(n("kLCn9").UnstableValue)("m.text","org.matrix.msc1767.text");e.exports.TEXT_NODE_TYPE=r})),n.register("7Ud45",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ReceiptType=e.exports.MAIN_ROOM_TIMELINE=void 0,e.exports.ReceiptType=r,(n=r||(e.exports.ReceiptType=r={})).Read="m.read",n.FullyRead="m.fully_read",n.ReadPrivate="m.read.private";e.exports.MAIN_ROOM_TIMELINE="main"})),n.register("QJIyW",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MemoryStore=void 0;var u=s(n("3rHpI")),l=n("c9Npn"),c=n("bcGqc");function d(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}var f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this;(0,i.default)(this,e),(0,u.default)(this,"rooms",{}),(0,u.default)(this,"users",{}),(0,u.default)(this,"syncToken",null),(0,u.default)(this,"filters",{}),(0,u.default)(this,"accountData",{}),(0,u.default)(this,"localStorage",void 0),(0,u.default)(this,"oobMembers",{}),(0,u.default)(this,"pendingEvents",{}),(0,u.default)(this,"clientOptions",void 0),(0,u.default)(this,"pendingToDeviceBatches",[]),(0,u.default)(this,"nextToDeviceBatchId",0),(0,u.default)(this,"onRoomMember",(function(e,t,n){if("invite"!==n.membership){var i=r.users[n.userId]||new l.User(n.userId);n.name&&(i.setDisplayName(n.name),n.events.member&&i.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&i.setAvatarUrl(n.events.member.getContent().avatar_url),r.users[i.userId]=i}})),this.localStorage=t.localStorage}return(0,o.default)(e,[{key:"getSyncToken",value:function(){return this.syncToken}},{key:"isNewlyCreated",value:function(){return Promise.resolve(!0)}},{key:"setSyncToken",value:function(e){this.syncToken=e}},{key:"storeRoom",value:function(e){var t=this;this.rooms[e.roomId]=e,e.currentState.on(c.RoomStateEvent.Members,this.onRoomMember),e.currentState.getMembers().forEach((function(r){t.onRoomMember(null,e.currentState,r)}))}},{key:"getRoom",value:function(e){return this.rooms[e]||null}},{key:"getRooms",value:function(){return Object.values(this.rooms)}},{key:"removeRoom",value:function(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(c.RoomStateEvent.Members,this.onRoomMember),delete this.rooms[e]}},{key:"getRoomSummaries",value:function(){return Object.values(this.rooms).map((function(e){return e.summary}))}},{key:"storeUser",value:function(e){this.users[e.userId]=e}},{key:"getUser",value:function(e){return this.users[e]||null}},{key:"getUsers",value:function(){return Object.values(this.users)}},{key:"scrollback",value:function(e,t){return[]}},{key:"storeEvents",value:function(e,t,r,n){}},{key:"storeFilter",value:function(e){null!=e&&e.userId&&null!=e&&e.filterId&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)}},{key:"getFilter",value:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null}},{key:"getFilterIdByName",value:function(e){if(!this.localStorage)return null;var t="mxjssdk_memory_filter_"+e;try{var r=this.localStorage.getItem(t);if(d(r))return r}catch(e){}return null}},{key:"setFilterIdByName",value:function(e,t){if(this.localStorage){var r="mxjssdk_memory_filter_"+e;try{d(t)?this.localStorage.setItem(r,t):this.localStorage.removeItem(r)}catch(e){}}}},{key:"storeAccountDataEvents",value:function(e){var t=this;e.forEach((function(e){!Object.keys(e.getContent()).length?delete t.accountData[e.getType()]:t.accountData[e.getType()]=e}))}},{key:"getAccountData",value:function(e){return this.accountData[e]}},{key:"setSyncData",value:function(e){return Promise.resolve()}},{key:"wantsSave",value:function(){return!1}},{key:"save",value:function(e){}},{key:"startup",value:function(){return Promise.resolve()}},{key:"getSavedSync",value:function(){return Promise.resolve(null)}},{key:"getSavedSyncToken",value:function(){return Promise.resolve(null)}},{key:"deleteAllData",value:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}},{key:"getOutOfBandMembers",value:function(e){return Promise.resolve(this.oobMembers[e]||null)}},{key:"setOutOfBandMembers",value:function(e,t){return this.oobMembers[e]=t,Promise.resolve()}},{key:"clearOutOfBandMembers",value:function(e){return this.oobMembers={},Promise.resolve()}},{key:"getClientOptions",value:function(){return Promise.resolve(this.clientOptions)}},{key:"storeClientOptions",value:function(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}},{key:"getPendingEvents",value:function(e){var t=this;return(0,r.default)((function(){var r;return(0,a.__generator)(this,(function(n){return[2,null!==(r=t.pendingEvents[e])&&void 0!==r?r:[]]}))}))()}},{key:"setPendingEvents",value:function(e,t){var n=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(r){return n.pendingEvents[e]=t,[2]}))}))()}},{key:"saveToDeviceBatches",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:a.eventType,txnId:a.txnId,batch:a.batch})}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return Promise.resolve()}},{key:"getOldestToDeviceBatch",value:function(){var e=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(t){return 0===e.pendingToDeviceBatches.length?[2,null]:[2,e.pendingToDeviceBatches[0]]}))}))()}},{key:"removeToDeviceBatch",value:function(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter((function(t){return t.id!==e})),Promise.resolve()}}]),e}();e.exports.MemoryStore=f})),n.register("c9Npn",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("giCK6"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UserEvent=e.exports.User=void 0;var l,c,d=u(n("3rHpI")),f=n("6MMVS");e.exports.UserEvent=l,(c=l||(e.exports.UserEvent=l={})).DisplayName="User.displayName",c.AvatarUrl="User.avatarUrl",c.Presence="User.presence",c.CurrentlyActive="User.currentlyActive",c.LastPresenceTs="User.lastPresenceTs";var h=function(e){(0,a.default)(n,e);var t=(0,s.default)(n);function n(e){var o;return(0,i.default)(this,n),(o=t.call(this)).userId=e,(0,d.default)((0,r.default)(o),"modified",-1),(0,d.default)((0,r.default)(o),"displayName",void 0),(0,d.default)((0,r.default)(o),"rawDisplayName",void 0),(0,d.default)((0,r.default)(o),"avatarUrl",void 0),(0,d.default)((0,r.default)(o),"presenceStatusMsg",void 0),(0,d.default)((0,r.default)(o),"presence","offline"),(0,d.default)((0,r.default)(o),"lastActiveAgo",0),(0,d.default)((0,r.default)(o),"lastPresenceTs",0),(0,d.default)((0,r.default)(o),"currentlyActive",!1),(0,d.default)((0,r.default)(o),"events",{}),o.displayName=e,o.rawDisplayName=e,o.updateModifiedTime(),o}return(0,o.default)(n,[{key:"setPresenceEvent",value:function(e){if("m.presence"===e.getType()){var t=null===this.events.presence;this.events.presence=e;var r=[];(e.getContent().presence!==this.presence||t)&&r.push(l.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push(l.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push(l.DisplayName),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&r.push(l.CurrentlyActive),this.presence=e.getContent().presence,r.push(l.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();var n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this.emit(u,e,this)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}}},{key:"setDisplayName",value:function(e){var t=this.displayName;this.displayName=e,e!==t&&this.updateModifiedTime()}},{key:"setRawDisplayName",value:function(e){this.rawDisplayName=e}},{key:"setAvatarUrl",value:function(e){var t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}},{key:"updateModifiedTime",value:function(){this.modified=Date.now()}},{key:"getLastModifiedTime",value:function(){return this.modified}},{key:"getLastActiveTs",value:function(){return this.lastPresenceTs-this.lastActiveAgo}}]),n}(f.TypedEventEmitter);e.exports.User=h})),n.register("6MMVS",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("61A8y"),a=n("5gj45"),s=n("cksMj"),u=n("9oGi2"),l=n("giCK6");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TypedEventEmitter=e.exports.EventEmitterEvents=void 0;var c,d,f=n("guIx5");e.exports.EventEmitterEvents=c,(d=c||(e.exports.EventEmitterEvents=c={})).NewListener="newListener",d.RemoveListener="removeListener",d.Error="error";var h=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"addListener",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"addListener",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var s;return(s=(0,o.default)((0,a.default)(n.prototype),"emit",this)).call.apply(s,[this,e].concat((0,u.default)(r)))}},{key:"eventNames",value:function(){return(0,o.default)((0,a.default)(n.prototype),"eventNames",this).call(this)}},{key:"listenerCount",value:function(e){return(0,o.default)((0,a.default)(n.prototype),"listenerCount",this).call(this,e)}},{key:"listeners",value:function(e){return(0,o.default)((0,a.default)(n.prototype),"listeners",this).call(this,e)}},{key:"off",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"off",this).call(this,e,t)}},{key:"on",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"once",this).call(this,e,t)}},{key:"prependListener",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"prependListener",this).call(this,e,t)}},{key:"prependOnceListener",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"prependOnceListener",this).call(this,e,t)}},{key:"removeAllListeners",value:function(e){return(0,o.default)((0,a.default)(n.prototype),"removeAllListeners",this).call(this,e)}},{key:"removeListener",value:function(e,t){return(0,o.default)((0,a.default)(n.prototype),"removeListener",this).call(this,e,t)}},{key:"rawListeners",value:function(e){return(0,o.default)((0,a.default)(n.prototype),"rawListeners",this).call(this,e)}}]),n}(f.EventEmitter);e.exports.TypedEventEmitter=h})),n.register("guIx5",(function(e,t){var r,i=n("aojpe"),o="object"==typeof Reflect?Reflect:null,a=o&&"function"==typeof o.apply?o.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&y(e,"error",t,r)}(e,i,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===e?"undefined":(0,i.default)(e)))}function d(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function f(e,t,r,n){var i,o,a,s;if(c(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=d(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function v(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):m(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+(void 0===e?"undefined":(0,i.default)(e)));e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return d(this)},u.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var l=u.length,c=m(u,l);for(r=0;r<l;++r)a(c[r],this,t)}return!0},u.prototype.addListener=function(e,t){return f(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return f(this,e,t,!0)},u.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},u.prototype.removeListener=function(e,t){var r,n,i,o,a;if(c(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return v(this,e,!0)},u.prototype.rawListeners=function(e){return v(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},u.prototype.listenerCount=g,u.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}})),n.register("bcGqc",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("cksMj"),l=n("9oGi2"),c=n("giCK6"),d=n("eQNFO"),f=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomStateEvent=e.exports.RoomState=void 0;var h,p,v,g,m=f(n("3rHpI")),y=n("9SRK1"),b=n("jtqeE"),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),w=n("8bPbt"),S=n("jEuTn"),E=n("7pEi8"),k=n("6MMVS"),M=n("afpjH"),C=n("k2cpO"),I=n("lB6qO");function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,m.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}(p=h||(h={}))[p.NotStarted=0]="NotStarted",p[p.InProgress=1]="InProgress",p[p.Finished=2]="Finished",e.exports.RoomStateEvent=v,(g=v||(e.exports.RoomStateEvent=v={})).Events="RoomState.events",g.Members="RoomState.members",g.NewMember="RoomState.newMember",g.Update="RoomState.update",g.BeaconLiveness="RoomState.BeaconLiveness",g.Marker="RoomState.Marker";var O=function(e){(0,u.default)(n,e);var t=(0,c.default)(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{status:h.NotStarted};return(0,o.default)(this,n),(i=t.call(this)).roomId=e,i.oobMemberFlags=a,(0,m.default)((0,r.default)(i),"reEmitter",new C.TypedReEmitter((0,r.default)(i))),(0,m.default)((0,r.default)(i),"sentinels",{}),(0,m.default)((0,r.default)(i),"displayNameToUserIds",new Map),(0,m.default)((0,r.default)(i),"userIdsToDisplayNames",{}),(0,m.default)((0,r.default)(i),"tokenToInvite",{}),(0,m.default)((0,r.default)(i),"joinedMemberCount",null),(0,m.default)((0,r.default)(i),"summaryJoinedMemberCount",null),(0,m.default)((0,r.default)(i),"invitedMemberCount",null),(0,m.default)((0,r.default)(i),"summaryInvitedMemberCount",null),(0,m.default)((0,r.default)(i),"modified",-1),(0,m.default)((0,r.default)(i),"members",{}),(0,m.default)((0,r.default)(i),"events",new Map),(0,m.default)((0,r.default)(i),"paginationToken",null),(0,m.default)((0,r.default)(i),"beacons",new Map),(0,m.default)((0,r.default)(i),"_liveBeaconIds",[]),i.updateModifiedTime(),i}return(0,a.default)(n,[{key:"getJoinedMemberCount",value:function(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce((function(e,t){return"join"===t.membership?e+1:e}),0)),this.joinedMemberCount)}},{key:"setJoinedMemberCount",value:function(e){this.summaryJoinedMemberCount=e}},{key:"getInvitedMemberCount",value:function(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce((function(e,t){return"invite"===t.membership?e+1:e}),0)),this.invitedMemberCount)}},{key:"setInvitedMemberCount",value:function(e){this.summaryInvitedMemberCount=e}},{key:"getMembers",value:function(){return Object.values(this.members)}},{key:"getMembersExcept",value:function(e){return this.getMembers().filter((function(t){return!e.includes(t.userId)}))}},{key:"getMember",value:function(e){return this.members[e]||null}},{key:"getSentinelMember",value:function(e){if(!e)return null;var t=this.sentinels[e];if(void 0===t){t=new y.RoomMember(this.roomId,e);var r=this.members[e];null!=r&&r.events.member&&t.setMembershipEvent(r.events.member,this),this.sentinels[e]=t}return t}},{key:"getStateEvents",value:function(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());var r=this.events.get(e).get(t);return r||null}},{key:"hasLiveBeacons",get:function(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}},{key:"liveBeaconIds",get:function(){return this._liveBeaconIds}},{key:"clone",value:function(){var e=new n(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=h.NotStarted,Array.from(this.events.values()).forEach((function(t){e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==h.Finished&&this.getMembers().forEach((function(t){var r;t.isOutOfBand()&&(null===(r=e.getMember(t.userId))||void 0===r||r.markOutOfBand())})),e}},{key:"setUnknownStateEvents",value:function(e){var t=this,r=e.filter((function(e){return!t.events.has(e.getType())||!t.events.get(e.getType()).has(e.getStateKey())}));this.setStateEvents(r)}},{key:"setStateEvents",value:function(e,t){var r=this;this.updateModifiedTime(),e.forEach((function(e){if(e.getRoomId()===r.roomId&&e.isState()){I.M_BEACON_INFO.matches(e.getType())&&r.setBeacon(e);var t,n=r.getStateEventMatching(e);if(r.setStateEvent(e),e.getType()===w.EventType.RoomMember)r.updateDisplayNameCache(e.getStateKey(),null!==(t=e.getContent().displayname)&&void 0!==t?t:""),r.updateThirdPartyTokenCache(e);r.emit(v.Events,e,r,n)}})),this.onBeaconLivenessChange(),e.forEach((function(e){if(e.getRoomId()===r.roomId&&e.isState())if(e.getType()===w.EventType.RoomMember){var n=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);var i=r.getOrCreateMember(n,e);i.setMembershipEvent(e,r),r.updateMember(i),r.emit(v.Members,e,r,i)}else if(e.getType()===w.EventType.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(r.members).forEach((function(t){var n=t.getLastModifiedTime();t.setPowerLevelEvent(e),n!==t.getLastModifiedTime()&&r.emit(v.Members,e,r,t)})),r.sentinels={}}else w.UNSTABLE_MSC2716_MARKER.matches(e.getType())&&r.emit(v.Marker,e,t)})),this.emit(v.Update,this)}},{key:"processBeaconEvents",value:function(e,t){if(e.length&&this.beacons.size){var r=(0,l.default)(this.beacons.values()).reduce((function(e,t){return x(x({},e),{},(0,s.default)({},t.beaconInfoId,t))}),{}),n=function(e,t){if(I.M_BEACON.matches(t.getType())){var n=r[e];n&&n.addLocations([t])}};e.forEach((function(e){var o,a=null===(o=e.getRelation())||void 0===o?void 0:o.event_id;a&&r[a]&&(t.decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()?e.once(S.MatrixEventEvent.Decrypted,(0,i.default)((function(){return(0,d.__generator)(this,(function(t){return n(a,e),[2]}))}))):n(a,e))}))}}},{key:"getOrCreateMember",value:function(e,t){var r=this.members[e];return r||(r=new y.RoomMember(this.roomId,e),this.members[e]=r,this.emit(v.NewMember,t,this,r)),r}},{key:"setStateEvent",value:function(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}},{key:"setBeacon",value:function(e){var t=(0,M.getBeaconInfoIdentifier)(e);if(this.beacons.has(t)){var r,n=this.beacons.get(t);return e.isRedacted()?void(n.beaconInfoId===(null===(r=e.getRedactionEvent())||void 0===r?void 0:r.redacts)&&(n.destroy(),this.beacons.delete(t))):n.update(e)}if(!e.isRedacted()){var i=new M.Beacon(e);this.reEmitter.reEmit(i,[M.BeaconEvent.New,M.BeaconEvent.Update,M.BeaconEvent.Destroy,M.BeaconEvent.LivenessChange]),this.emit(M.BeaconEvent.New,e,i),i.on(M.BeaconEvent.LivenessChange,this.onBeaconLivenessChange.bind(this)),i.on(M.BeaconEvent.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(i.identifier,i)}}},{key:"onBeaconLivenessChange",value:function(){this._liveBeaconIds=Array.from(this.beacons.values()).filter((function(e){return e.isLive})).map((function(e){return e.identifier})),this.emit(v.BeaconLiveness,this,this.hasLiveBeacons)}},{key:"getStateEventMatching",value:function(e){var t,r;return null!==(t=null===(r=this.events.get(e.getType()))||void 0===r?void 0:r.get(e.getStateKey()))&&void 0!==t?t:null}},{key:"updateMember",value:function(e){var t=this.getStateEvents(w.EventType.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}},{key:"needsOutOfBandMembers",value:function(){return this.oobMemberFlags.status===h.NotStarted}},{key:"outOfBandMembersReady",value:function(){return this.oobMemberFlags.status===h.Finished}},{key:"markOutOfBandMembersStarted",value:function(){this.oobMemberFlags.status===h.NotStarted&&(this.oobMemberFlags.status=h.InProgress)}},{key:"markOutOfBandMembersFailed",value:function(){this.oobMemberFlags.status===h.InProgress&&(this.oobMemberFlags.status=h.NotStarted)}},{key:"clearOutOfBandMembers",value:function(){var e=this,t=0;Object.keys(this.members).forEach((function(r){e.members[r].isOutOfBand()&&(++t,delete e.members[r])})),b.logger.log("LL: RoomState removed ".concat(t," members...")),this.oobMemberFlags.status=h.NotStarted}},{key:"setOutOfBandMembers",value:function(e){var t=this;b.logger.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===h.InProgress&&(b.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=h.Finished,e.forEach((function(e){return t.setOutOfBandMember(e)})),this.emit(v.Update,this))}},{key:"setOutOfBandMember",value:function(e){if(e.getType()===w.EventType.RoomMember){var t=e.getStateKey(),r=this.getMember(t);if(!r||r.isOutOfBand()){var n=this.getOrCreateMember(t,e);n.setMembershipEvent(e,this),n.markOutOfBand(),this.updateDisplayNameCache(n.userId,n.name),this.setStateEvent(e),this.updateMember(n),this.emit(v.Members,e,this,n)}}}},{key:"setTypingEvent",value:function(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}},{key:"getInviteForThreePidToken",value:function(e){return this.tokenToInvite[e]||null}},{key:"updateModifiedTime",value:function(){this.modified=Date.now()}},{key:"getLastModifiedTime",value:function(){return this.modified}},{key:"getUserIdsWithDisplayName",value:function(e){var t;return null!==(t=this.displayNameToUserIds.get(_.removeHiddenChars(e)))&&void 0!==t?t:[]}},{key:"maySendRedactionForEvent",value:function(e,t){var r=this.getMember(t);if(!r||"leave"===r.membership)return!1;if(e.status||e.isRedacted())return!1;var n=this.maySendEvent(w.EventType.RoomRedaction,t);return e.getSender()===t?n:this.hasSufficientPowerLevelFor("redact",r.powerLevel)}},{key:"hasSufficientPowerLevelFor",value:function(e,t){var r=this.getStateEvents(w.EventType.RoomPowerLevels,""),n={};r&&(n=r.getContent());var i=50;return _.isNumber(n[e])&&(i=n[e]),t>=i}},{key:"maySendMessage",value:function(e){return this.maySendEventOfType(w.EventType.RoomMessage,e,!1)}},{key:"maySendEvent",value:function(e,t){return this.maySendEventOfType(e,t,!1)}},{key:"mayClientSendStateEvent",value:function(e,t){return!(t.isGuest()||!t.credentials.userId)&&this.maySendStateEvent(e,t.credentials.userId)}},{key:"maySendStateEvent",value:function(e,t){return this.maySendEventOfType(e,t,!0)}},{key:"maySendEventOfType",value:function(e,t,r){var n,i=this.getStateEvents(w.EventType.RoomPowerLevels,""),o={},a=0,s=0,u=0;if(i){o=(n=i.getContent()).events||{},a=Number.isSafeInteger(n.state_default)?n.state_default:50;var l=n.users&&n.users[t];Number.isSafeInteger(l)?u=l:Number.isSafeInteger(n.users_default)&&(u=n.users_default),Number.isSafeInteger(n.events_default)&&(s=n.events_default)}var c=r?a:s;return Number.isSafeInteger(o[e])&&(c=o[e]),u>=c}},{key:"mayTriggerNotifOfType",value:function(e,t){var r=this.getMember(t);if(!r)return!1;var n=this.getStateEvents(w.EventType.RoomPowerLevels,""),i=50;return n&&n.getContent()&&n.getContent().notifications&&_.isNumber(n.getContent().notifications[e])&&(i=n.getContent().notifications[e]),r.powerLevel>=i}},{key:"getJoinRule",value:function(){var e,t=this.getStateEvents(w.EventType.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||E.JoinRule.Invite}},{key:"getHistoryVisibility",value:function(){var e,t=this.getStateEvents(w.EventType.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||E.HistoryVisibility.Shared}},{key:"getGuestAccess",value:function(){var e,t=this.getStateEvents(w.EventType.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||E.GuestAccess.Forbidden}},{key:"updateThirdPartyTokenCache",value:function(e){if(e.getContent().third_party_invite){var t=(e.getContent().third_party_invite.signed||{}).token;if(t)this.getStateEvents(w.EventType.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}}},{key:"updateDisplayNameCache",value:function(e,t){var r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){var n=_.removeHiddenChars(r),i=this.displayNameToUserIds.get(n);if(i){var o=i.filter((function(t){return t!==e}));this.displayNameToUserIds.set(n,o)}}this.userIdsToDisplayNames[e]=t;var a=t&&_.removeHiddenChars(t);if(a){var s,u=null!==(s=this.displayNameToUserIds.get(a))&&void 0!==s?s:[];u.push(e),this.displayNameToUserIds.set(a,u)}}}]),n}(k.TypedEventEmitter);e.exports.RoomState=O})),n.register("9SRK1",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("giCK6"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomMemberEvent=e.exports.RoomMember=void 0;var l,c,d=u(n("3rHpI")),f=n("kMq5l"),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),p=n("jtqeE"),v=n("6MMVS"),g=n("8bPbt");function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}e.exports.RoomMemberEvent=l,(c=l||(e.exports.RoomMemberEvent=l={})).Membership="RoomMember.membership",c.Name="RoomMember.name",c.PowerLevel="RoomMember.powerLevel",c.Typing="RoomMember.typing";var y=function(e){(0,a.default)(n,e);var t=(0,s.default)(n);function n(e,o){var a;return(0,i.default)(this,n),(a=t.call(this)).roomId=e,a.userId=o,(0,d.default)((0,r.default)(a),"_isOutOfBand",!1),(0,d.default)((0,r.default)(a),"modified",-1),(0,d.default)((0,r.default)(a),"requestedProfileInfo",!1),(0,d.default)((0,r.default)(a),"typing",!1),(0,d.default)((0,r.default)(a),"name",void 0),(0,d.default)((0,r.default)(a),"rawDisplayName",void 0),(0,d.default)((0,r.default)(a),"powerLevel",0),(0,d.default)((0,r.default)(a),"powerLevelNorm",0),(0,d.default)((0,r.default)(a),"user",void 0),(0,d.default)((0,r.default)(a),"membership",void 0),(0,d.default)((0,r.default)(a),"disambiguate",!1),(0,d.default)((0,r.default)(a),"events",{}),a.name=o,a.rawDisplayName=o,a.updateModifiedTime(),a}return(0,o.default)(n,[{key:"markOutOfBand",value:function(){this._isOutOfBand=!0}},{key:"isOutOfBand",value:function(){return this._isOutOfBand}},{key:"setMembershipEvent",value:function(e,t){var r,n,i=null!==(r=e.getDirectionalContent().displayname)&&void 0!==r?r:"";if(e.getType()===g.EventType.RoomMember){this._isOutOfBand=!1,this.events.member=e;var o=this.membership;this.membership=e.getDirectionalContent().membership,void 0===this.membership&&p.logger.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=function(e,t,r){return!(!t||t===e)&&(!!h.removeHiddenChars(t)&&(!!r&&(!!b.test(t)||(!!_.test(t)||!!r.getUserIdsWithDisplayName(t).some((function(t){return t!==e}))))))}(this.userId,i,t);var a=this.name;this.name=function(e,t,r){return t&&t!==e?r?h.removeDirectionOverrideChars(t)+" ("+e+")":h.removeHiddenChars(t)?h.removeDirectionOverrideChars(t):e:e}(this.userId,i,this.disambiguate),this.rawDisplayName=h.removeDirectionOverrideChars(null!==(n=e.getDirectionalContent().displayname)&&void 0!==n?n:""),this.rawDisplayName&&h.removeHiddenChars(this.rawDisplayName)||(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(l.Membership,e,this,o)),a!==this.name&&(this.updateModifiedTime(),this.emit(l.Name,e,this,a))}}},{key:"setPowerLevelEvent",value:function(e){if(e.getType()===g.EventType.RoomPowerLevels&&""===e.getStateKey()){var t=e.getDirectionalContent(),r=t.users_default||0,n=t.users||{};Object.values(n).forEach((function(e){r=Math.max(r,e)}));var i=this.powerLevel,o=this.powerLevelNorm;void 0!==n[this.userId]&&Number.isInteger(n[this.userId])?this.powerLevel=n[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,r>0&&(this.powerLevelNorm=100*this.powerLevel/r),i===this.powerLevel&&o===this.powerLevelNorm||(this.updateModifiedTime(),this.emit(l.PowerLevel,e,this))}}},{key:"setTypingEvent",value:function(e){if("m.typing"===e.getType()){var t=this.typing;this.typing=!1;var r=e.getContent().user_ids;Array.isArray(r)&&(-1!==r.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit(l.Typing,e,this)))}}},{key:"updateModifiedTime",value:function(){this.modified=Date.now()}},{key:"getLastModifiedTime",value:function(){return this.modified}},{key:"isKicked",value:function(){return"leave"===this.membership&&void 0!==this.events.member&&this.events.member.getSender()!==this.events.member.getStateKey()}},{key:"getDMInviter",value:function(){if(this.events.member){var e=this.events.member,t=e.getContent(),r=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),r=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return r}}},{key:"getAvatarUrl",value:function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5?arguments[5]:void 0,a=this.getMxcAvatarUrl();if(!a&&!i)return null;var s=(0,f.getHttpUriForMxc)(e,a,t,r,n,o);return s||null}},{key:"getMxcAvatarUrl",value:function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:void 0}}]),n}(v.TypedEventEmitter);e.exports.RoomMember=y;var b=/@.+:.+/,_=/[\u200E\u200F\u202A-\u202F]/})),n.register("kMq5l",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.getHttpUriForMxc=function(e,t,n,i,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return a?t:"";var s=t.slice(6),u="/_matrix/media/r0/download/",l={};n&&(l.width=Math.round(n).toString());i&&(l.height=Math.round(i).toString());o&&(l.method=o);Object.keys(l).length>0&&(u="/_matrix/media/r0/thumbnail/");var c=s.indexOf("#"),d="";c>=0&&(d=s.slice(c),s=s.slice(0,c));var f=0===Object.keys(l).length?"":"?"+r.encodeParams(l);return e+u+s+f+d};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(n("e8gas"));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}})),n.register("8bPbt",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UNSTABLE_MSC3089_TREE_SUBTYPE=e.exports.UNSTABLE_MSC3089_LEAF=e.exports.UNSTABLE_MSC3089_BRANCH=e.exports.UNSTABLE_MSC3088_PURPOSE=e.exports.UNSTABLE_MSC3088_ENABLED=e.exports.UNSTABLE_MSC2716_MARKER=e.exports.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=e.exports.ToDeviceMessageId=e.exports.RoomType=e.exports.RoomCreateTypeField=e.exports.RelationType=e.exports.PUSHER_ENABLED=e.exports.PUSHER_DEVICE_ID=e.exports.MsgType=e.exports.MSC3912_RELATION_BASED_REDACTIONS_PROP=e.exports.LOCAL_NOTIFICATION_SETTINGS_PREFIX=e.exports.EventType=e.exports.EVENT_VISIBILITY_CHANGE_TYPE=void 0;var r,i,o,a,s,u,l=n("kLCn9");e.exports.EventType=r,(i=r||(e.exports.EventType=r={})).RoomCanonicalAlias="m.room.canonical_alias",i.RoomCreate="m.room.create",i.RoomJoinRules="m.room.join_rules",i.RoomMember="m.room.member",i.RoomThirdPartyInvite="m.room.third_party_invite",i.RoomPowerLevels="m.room.power_levels",i.RoomName="m.room.name",i.RoomTopic="m.room.topic",i.RoomAvatar="m.room.avatar",i.RoomPinnedEvents="m.room.pinned_events",i.RoomEncryption="m.room.encryption",i.RoomHistoryVisibility="m.room.history_visibility",i.RoomGuestAccess="m.room.guest_access",i.RoomServerAcl="m.room.server_acl",i.RoomTombstone="m.room.tombstone",i.SpaceChild="m.space.child",i.SpaceParent="m.space.parent",i.RoomRedaction="m.room.redaction",i.RoomMessage="m.room.message",i.RoomMessageEncrypted="m.room.encrypted",i.Sticker="m.sticker",i.CallInvite="m.call.invite",i.CallCandidates="m.call.candidates",i.CallAnswer="m.call.answer",i.CallHangup="m.call.hangup",i.CallReject="m.call.reject",i.CallSelectAnswer="m.call.select_answer",i.CallNegotiate="m.call.negotiate",i.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",i.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",i.CallReplaces="m.call.replaces",i.CallAssertedIdentity="m.call.asserted_identity",i.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",i.KeyVerificationRequest="m.key.verification.request",i.KeyVerificationStart="m.key.verification.start",i.KeyVerificationCancel="m.key.verification.cancel",i.KeyVerificationMac="m.key.verification.mac",i.KeyVerificationDone="m.key.verification.done",i.KeyVerificationKey="m.key.verification.key",i.KeyVerificationAccept="m.key.verification.accept",i.KeyVerificationReady="m.key.verification.ready",i.RoomMessageFeedback="m.room.message.feedback",i.Reaction="m.reaction",i.PollStart="org.matrix.msc3381.poll.start",i.Typing="m.typing",i.Receipt="m.receipt",i.Presence="m.presence",i.FullyRead="m.fully_read",i.Tag="m.tag",i.SpaceOrder="org.matrix.msc3230.space_order",i.PushRules="m.push_rules",i.Direct="m.direct",i.IgnoredUserList="m.ignored_user_list",i.RoomKey="m.room_key",i.RoomKeyRequest="m.room_key_request",i.ForwardedRoomKey="m.forwarded_room_key",i.Dummy="m.dummy",i.GroupCallPrefix="org.matrix.msc3401.call",i.GroupCallMemberPrefix="org.matrix.msc3401.call.member",e.exports.RelationType=o,(a=o||(e.exports.RelationType=o={})).Annotation="m.annotation",a.Replace="m.replace",a.Reference="m.reference",a.Thread="m.thread",e.exports.MsgType=s,(u=s||(e.exports.MsgType=s={})).Text="m.text",u.Emote="m.emote",u.Notice="m.notice",u.Image="m.image",u.File="m.file",u.Audio="m.audio",u.Location="m.location",u.Video="m.video",u.KeyVerificationRequest="m.key.verification.request";var c,d;e.exports.RoomCreateTypeField="type",e.exports.RoomType=c,(d=c||(e.exports.RoomType=c={})).Space="m.space",d.UnstableCall="org.matrix.msc3417.call",d.ElementVideo="io.element.video";e.exports.ToDeviceMessageId="org.matrix.msgid";var f=new l.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose");e.exports.UNSTABLE_MSC3088_PURPOSE=f;var h=new l.UnstableValue("m.enabled","org.matrix.msc3088.enabled");e.exports.UNSTABLE_MSC3088_ENABLED=h;var p=new l.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree");e.exports.UNSTABLE_MSC3089_TREE_SUBTYPE=p;var v=new l.UnstableValue("m.leaf","org.matrix.msc3089.leaf");e.exports.UNSTABLE_MSC3089_LEAF=v;var g=new l.UnstableValue("m.branch","org.matrix.msc3089.branch");e.exports.UNSTABLE_MSC3089_BRANCH=g;var m=new l.UnstableValue("m.room.marker","org.matrix.msc2716.marker");e.exports.UNSTABLE_MSC2716_MARKER=m;var y=new l.UnstableValue("with_relations","org.matrix.msc3912.with_relations");e.exports.MSC3912_RELATION_BASED_REDACTIONS_PROP=y;var b=new l.UnstableValue("io.element.functional_members","io.element.functional_members");e.exports.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=b;var _=new l.UnstableValue("m.visibility","org.matrix.msc3531.visibility");e.exports.EVENT_VISIBILITY_CHANGE_TYPE=_;var w=new l.UnstableValue("enabled","org.matrix.msc3881.enabled");e.exports.PUSHER_ENABLED=w;var S=new l.UnstableValue("device_id","org.matrix.msc3881.device_id");e.exports.PUSHER_DEVICE_ID=S;var E=new l.UnstableValue("m.local_notification_settings","org.matrix.msc3890.local_notification_settings");e.exports.LOCAL_NOTIFICATION_SETTINGS_PREFIX=E})),n.register("jEuTn",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("cksMj"),l=n("mBz5n"),c=n("giCK6"),d=n("eQNFO"),f=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),Object.defineProperty(e.exports,"EventStatus",{enumerable:!0,get:function(){return k.EventStatus}}),e.exports.MatrixEventEvent=e.exports.MatrixEvent=void 0;var h,p,v=f(n("3rHpI")),g=n("ghTXl"),m=n("jtqeE"),y=n("8bPbt"),b=n("e8gas"),_=n("1lFBd"),w=n("k2cpO"),S=n("6MMVS"),E=n("e9CEv"),k=n("8ySly"),M=Object.freeze({visible:!0});e.exports.MatrixEventEvent=h,(p=h||(e.exports.MatrixEventEvent=h={})).Decrypted="Event.decrypted",p.BeforeRedaction="Event.beforeRedaction",p.VisibilityChange="Event.visibilityChange",p.LocalEventIdReplaced="Event.localEventIdReplaced",p.Status="Event.status",p.Replaced="Event.replaced",p.RelationsCreated="Event.relationsCreated";var C=function(e){(0,u.default)(n,e);var t=(0,c.default)(n);function n(){var e,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.default)(this,n),(e=t.call(this)).event=a,(0,v.default)((0,r.default)(e),"pushActions",null),(0,v.default)((0,r.default)(e),"_replacingEvent",null),(0,v.default)((0,r.default)(e),"_localRedactionEvent",null),(0,v.default)((0,r.default)(e),"_isCancelled",!1),(0,v.default)((0,r.default)(e),"clearEvent",void 0),(0,v.default)((0,r.default)(e),"visibility",M),(0,v.default)((0,r.default)(e),"_hasCachedExtEv",!1),(0,v.default)((0,r.default)(e),"_cachedExtEv",void 0),(0,v.default)((0,r.default)(e),"senderCurve25519Key",null),(0,v.default)((0,r.default)(e),"claimedEd25519Key",null),(0,v.default)((0,r.default)(e),"forwardingCurve25519KeyChain",[]),(0,v.default)((0,r.default)(e),"untrusted",null),(0,v.default)((0,r.default)(e),"decryptionPromise",null),(0,v.default)((0,r.default)(e),"retryDecryption",!1),(0,v.default)((0,r.default)(e),"txnId",void 0),(0,v.default)((0,r.default)(e),"thread",void 0),(0,v.default)((0,r.default)(e),"threadId",void 0),(0,v.default)((0,r.default)(e),"localTimestamp",void 0),(0,v.default)((0,r.default)(e),"sender",null),(0,v.default)((0,r.default)(e),"target",null),(0,v.default)((0,r.default)(e),"status",null),(0,v.default)((0,r.default)(e),"error",null),(0,v.default)((0,r.default)(e),"forwardLooking",!0),(0,v.default)((0,r.default)(e),"verificationRequest",void 0),(0,v.default)((0,r.default)(e),"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((function(e){"string"==typeof a[e]&&(a[e]=(0,b.internaliseString)(a[e]))})),["membership","avatar_url","displayname"].forEach((function(e){var t;"string"==typeof(null===(t=a.content)||void 0===t?void 0:t[e])&&(a.content[e]=(0,b.internaliseString)(a.content[e]))})),["rel_type"].forEach((function(e){var t,r;"string"==typeof(null===(t=a.content)||void 0===t||null===(r=t["m.relates_to"])||void 0===r?void 0:r[e])&&(a.content["m.relates_to"][e]=(0,b.internaliseString)(a.content["m.relates_to"][e]))})),e.txnId=a.txn_id,e.localTimestamp=Date.now()-(null!==(i=e.getAge())&&void 0!==i?i:0),e.reEmitter=new w.TypedReEmitter((0,r.default)(e)),e}return(0,a.default)(n,[{key:"unstableExtensibleEvent",get:function(){return this._hasCachedExtEv||(this._cachedExtEv=g.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}},{key:"invalidateExtensibleEvent",value:function(){this._hasCachedExtEv=!1}},{key:"getEffectiveEvent",value:function(){var e=Object.assign({},this.getContent()),t=!0,r=!1,n=void 0;if(this.getWireType()===y.EventType.RoomMessageEncrypted)try{for(var i,o=Object.entries(this.getWireContent())[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,l.default)(i.value,2),s=a[0],u=a[1];["algorithm","ciphertext","device_id","sender_key","session_id"].includes(s)||void 0===e[s]&&(e[s]=u)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return Object.assign({},this.event,this.clearEvent,{content:e})}},{key:"getId",value:function(){return this.event.event_id}},{key:"getSender",value:function(){return this.event.sender||this.event.user_id}},{key:"getType",value:function(){return this.clearEvent?this.clearEvent.type:this.event.type}},{key:"getWireType",value:function(){return this.event.type}},{key:"getRoomId",value:function(){return this.event.room_id}},{key:"getTs",value:function(){return this.event.origin_server_ts}},{key:"getDate",value:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}},{key:"getDetails",value:function(){var e="id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()),t=this.getRoomId();t&&(e+=" room=".concat(t));var r=this.getDate();return r&&(e+=" ts=".concat(r.toISOString())),e}},{key:"getOriginalContent",value:function(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}},{key:"getContent",value:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}},{key:"getWireContent",value:function(){return this.event.content||{}}},{key:"threadRootId",get:function(){var e,t,r=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];return(null==r?void 0:r.rel_type)===_.THREAD_RELATION_TYPE.name?r.event_id:(null===(t=this.getThread())||void 0===t?void 0:t.id)||this.threadId}},{key:"isThreadRoot",get:function(){var e;return!!this.getServerAggregatedRelation(_.THREAD_RELATION_TYPE.name)||(null===(e=this.getThread())||void 0===e?void 0:e.id)===this.getId()}},{key:"replyEventId",get:function(){var e,t=this.getContent()["m.relates_to"]||this.getWireContent()["m.relates_to"];return null==t||null===(e=t["m.in_reply_to"])||void 0===e?void 0:e.event_id}},{key:"relationEventId",get:function(){var e,t;return null===(e=this.getWireContent())||void 0===e||null===(t=e["m.relates_to"])||void 0===t?void 0:t.event_id}},{key:"getPrevContent",value:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}}},{key:"getDirectionalContent",value:function(){return this.forwardLooking?this.getContent():this.getPrevContent()}},{key:"getAge",value:function(){return this.getUnsigned().age||this.event.age}},{key:"getLocalAge",value:function(){return Date.now()-this.localTimestamp}},{key:"getStateKey",value:function(){return this.event.state_key}},{key:"isState",value:function(){return void 0!==this.event.state_key}},{key:"makeEncrypted",value:function(e,t,r,n){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=r,this.claimedEd25519Key=n}},{key:"isBeingDecrypted",value:function(){return null!=this.decryptionPromise}},{key:"getDecryptionPromise",value:function(){return this.decryptionPromise}},{key:"isDecryptionFailure",value:function(){var e,t;return"m.bad.encrypted"===(null===(e=this.clearEvent)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.msgtype)}},{key:"shouldAttemptDecryption",value:function(){return!this.isRedacted()&&(!this.isBeingDecrypted()&&(!this.clearEvent&&!!this.isEncrypted()))}},{key:"attemptDecryption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this;return(0,i.default)((function(){var n,i;return(0,d.__generator)(this,(function(o){if(!r.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(n=r.clearEvent&&!r.isDecryptionFailure(),i=t.forceRedecryptIfUntrusted&&r.isKeySourceUntrusted(),n&&!i)throw new Error("Attempt to decrypt event which has already been decrypted");return r.decryptionPromise?(m.logger.log("Event ".concat(r.getId()," already being decrypted; queueing a retry")),r.retryDecryption=!0,[2,r.decryptionPromise]):(r.decryptionPromise=r.decryptionLoop(e,t),[2,r.decryptionPromise])}))}))()}},{key:"cancelAndResendKeyRequest",value:function(e,t){var r=this.getWireContent();return e.requestRoomKey({algorithm:r.algorithm,room_id:this.getRoomId(),session_id:r.session_id,sender_key:r.sender_key},this.getKeyRequestRecipients(t),!0)}},{key:"getKeyRequestRecipients",value:function(e){var t=this.getWireContent(),r=[{userId:e,deviceId:"*"}],n=this.getSender();return n!==e&&r.push({userId:n,deviceId:t.device_id}),r}},{key:"decryptionLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this;return(0,i.default)((function(){var n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return[4,Promise.resolve()];case 1:s.sent(),s.label=2;case 2:0,r.retryDecryption=!1,i=void 0,s.label=3;case 3:return s.trys.push([3,7,,8]),e?[3,4]:(n=r.badEncryptedMessage("Encryption not enabled"),[3,6]);case 4:return[4,e.decryptEvent(r)];case 5:n=s.sent(),!0===t.isRetry&&m.logger.info("Decrypted event on retry (".concat(r.getDetails(),")")),s.label=6;case 6:return[3,8];case 7:return o=s.sent(),a=o instanceof E.DecryptionError?o.detailedString:String(o),i=o,r.retryDecryption?(m.logger.log("Error decrypting event (".concat(r.getDetails(),"), but retrying: ").concat(a)),[3,2]):(m.logger.warn("Error decrypting event (".concat(r.getDetails(),"): ").concat(a)),n=r.badEncryptedMessage(String(o)),[3,8]);case 8:return r.decryptionPromise=null,r.retryDecryption=!1,r.setClearData(n),r.setPushActions(null),!1!==t.emit&&r.emit(h.Decrypted,r,i),[2];case 9:return[2]}}))}))()}},{key:"badEncryptedMessage",value:function(e){return{clearEvent:{type:y.EventType.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}}},{key:"setClearData",value:function(e){var t,r;this.clearEvent=e.clearEvent,this.senderCurve25519Key=null!==(t=e.senderCurve25519Key)&&void 0!==t?t:null,this.claimedEd25519Key=null!==(r=e.claimedEd25519Key)&&void 0!==r?r:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}},{key:"getClearContent",value:function(){return this.clearEvent?this.clearEvent.content:null}},{key:"isEncrypted",value:function(){return!this.isState()&&this.event.type===y.EventType.RoomMessageEncrypted}},{key:"getSenderKey",value:function(){return this.senderCurve25519Key}},{key:"getKeysClaimed",value:function(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}},{key:"getClaimedEd25519Key",value:function(){return this.claimedEd25519Key}},{key:"getForwardingCurve25519KeyChain",value:function(){return this.forwardingCurve25519KeyChain}},{key:"isKeySourceUntrusted",value:function(){return!!this.untrusted}},{key:"getUnsigned",value:function(){return this.event.unsigned||{}}},{key:"setUnsigned",value:function(e){this.event.unsigned=e}},{key:"unmarkLocallyRedacted",value:function(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}},{key:"markLocallyRedacted",value:function(e){this._localRedactionEvent||(this.emit(h.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}},{key:"applyVisibilityEvent",value:function(e){var t,r,n=null===(t=null==e?void 0:e.visible)||void 0===t||t,i=null!==(r=null==e?void 0:e.reason)&&void 0!==r?r:null,o=!1;this.visibility.visible!==n?o=!0:this.visibility.visible||this.visibility.reason===i||(o=!0),o&&(this.visibility=n?M:Object.freeze({visible:!1,reason:i}),this.emit(h.VisibilityChange,this,n))}},{key:"messageVisibility",value:function(){return this.visibility}},{key:"makeRedacted",value:function(e){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");for(var t in this._localRedactionEvent=null,this.emit(h.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&!T.has(t)&&delete this.event[t];this.isEncrypted()&&(this.clearEvent=void 0);var r=this.getType()in R?R[this.getType()]:{},n=this.getContent();for(var i in n)n.hasOwnProperty(i)&&!r[i]&&delete n[i];this.invalidateExtensibleEvent()}},{key:"isRedacted",value:function(){return Boolean(this.getUnsigned().redacted_because)}},{key:"isRedaction",value:function(){return this.getType()===y.EventType.RoomRedaction}},{key:"asVisibilityChange",value:function(){if(!y.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType()))return null;var e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;var t=e.event_id;if(!t)return null;var r=this.getWireContent(),n=!!r.visible,i=r.reason;return i&&"string"!=typeof i?null:{visible:n,reason:i,eventId:t}}},{key:"isVisibilityEvent",value:function(){return y.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType())}},{key:"getRedactionEvent",value:function(){var e,t,r,n;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null!==(r=null===(n=this.clearEvent)||void 0===n?void 0:n.unsigned.redacted_because)&&void 0!==r?r:null:null!==(t=this.event.unsigned)&&void 0!==t&&t.redacted_because?this.event.unsigned.redacted_because:{}:null}},{key:"getPushActions",value:function(){return this.pushActions}},{key:"setPushActions",value:function(e){this.pushActions=e}},{key:"handleRemoteEcho",value:function(e){var t=this.getUnsigned(),r=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit(h.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-this.getAge()}},{key:"isSending",value:function(){return!!this.status}},{key:"setStatus",value:function(e){this.status=e,this.emit(h.Status,this,e)}},{key:"replaceLocalEventId",value:function(e){this.event.event_id=e,this.emit(h.LocalEventIdReplaced,this)}},{key:"isRelation",value:function(e){var t,r=null===(t=this.getWireContent())||void 0===t?void 0:t["m.relates_to"];return(!this.isState()||(null==r?void 0:r.rel_type)!==y.RelationType.Replace)&&!(null==r||!r.rel_type||!r.event_id||e&&r.rel_type!==e)}},{key:"getRelation",value:function(){var e;return this.isRelation()&&null!==(e=this.getWireContent()["m.relates_to"])&&void 0!==e?e:null}},{key:"makeReplaced",value:function(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=null!=e?e:null,this.emit(h.Replaced,this),this.invalidateExtensibleEvent())}},{key:"getAssociatedStatus",value:function(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}},{key:"getServerAggregatedRelation",value:function(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}},{key:"replacingEventId",value:function(){var e=this.getServerAggregatedRelation(y.RelationType.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}},{key:"replacingEvent",value:function(){return this._replacingEvent}},{key:"replacingEventDate",value:function(){var e=this.getServerAggregatedRelation(y.RelationType.Replace);if(e){var t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent){var r;return null!==(r=this._replacingEvent.getDate())&&void 0!==r?r:void 0}}},{key:"localRedactionEvent",value:function(){return this._localRedactionEvent}},{key:"getAssociatedId",value:function(){var e=this.getRelation();return this.replyEventId?this.replyEventId:e?e.event_id:this.isRedaction()?this.event.redacts:void 0}},{key:"hasAssocation",value:function(){return!!this.getAssociatedId()}},{key:"hasAssociation",value:function(){return!!this.getAssociatedId()}},{key:"updateAssociatedId",value:function(e){var t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}},{key:"flagCancelled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e}},{key:"isCancelled",value:function(){return this._isCancelled}},{key:"toSnapshot",value:function(){var e=new n(JSON.parse(JSON.stringify(this.event))),t=!0,r=!1,i=void 0;try{for(var o,a=Object.entries(this)[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=(0,l.default)(o.value,2),u=s[0],c=s[1];"event"!==u&&(e[u]=c)}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}return e}},{key:"isEquivalentTo",value:function(e){if(!e)return!1;if(e===this)return!0;var t=(0,b.deepSortedObjectEntries)(this.event),r=(0,b.deepSortedObjectEntries)(e.event);return JSON.stringify(t)===JSON.stringify(r)}},{key:"toJSON",value:function(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}},{key:"setVerificationRequest",value:function(e){this.verificationRequest=e}},{key:"setTxnId",value:function(e){this.txnId=e}},{key:"getTxnId",value:function(){return this.txnId}},{key:"setThread",value:function(e){this.thread&&this.reEmitter.stopReEmitting(this.thread,[_.ThreadEvent.Update]),this.thread=e,this.setThreadId(null==e?void 0:e.id),e&&this.reEmitter.reEmit(e,[_.ThreadEvent.Update])}},{key:"getThread",value:function(){return this.thread}},{key:"setThreadId",value:function(e){this.threadId=e}}]),n}(S.TypedEventEmitter);e.exports.MatrixEvent=C;var I,T=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),R=(I={},(0,s.default)(I,y.EventType.RoomMember,{membership:1}),(0,s.default)(I,y.EventType.RoomCreate,{creator:1}),(0,s.default)(I,y.EventType.RoomJoinRules,{join_rule:1}),(0,s.default)(I,y.EventType.RoomPowerLevels,{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}),I)})),n.register("ghTXl",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0});var r=n("5li9i");Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===r[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return r[t]}}))}));var i=n("ceJVl");Object.keys(i).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===i[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return i[t]}}))}));var o=n("epRdy");Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))}));var a=n("8qwGp");Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))}));var s=n("cUdfU");Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===s[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return s[t]}}))}));var u=n("bX7CS");Object.keys(u).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===u[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return u[t]}}))}));var l=n("1j7TF");Object.keys(l).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===l[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return l[t]}}))}));var c=n("f8PLG");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var d=n("k6a37");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=n("aqBvm");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var h=n("cPHPH");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var p=n("jEK46");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var v=n("7Yenj");Object.keys(v).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===v[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return v[t]}}))}));var g=n("htqPq");Object.keys(g).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===g[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return g[t]}}))}));var m=n("arVHE");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var y=n("klVwd");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=n("1taYN");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var _=n("fvuck");Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var w=n("1RnW2");Object.keys(w).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===w[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return w[t]}}))}));var S=n("ay7w5");Object.keys(S).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===S[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return S[t]}}))}));var E=n("8P30T");Object.keys(E).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===E[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return E[t]}}))}))})),n.register("5li9i",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ExtensibleEvents=void 0;var r=n("cUdfU"),i=n("epRdy"),o=n("k6a37"),a=n("aqBvm"),s=n("htqPq"),u=n("fvuck"),l=n("cPHPH");function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"interpreters",new r.NamespacedMap([[o.LEGACY_M_ROOM_MESSAGE,o.parseMRoomMessage],[s.M_MESSAGE,a.parseMMessage],[s.M_EMOTE,a.parseMMessage],[s.M_NOTICE,a.parseMMessage],[u.M_POLL_START,l.parseMPoll],[u.M_POLL_RESPONSE,l.parseMPoll],[u.M_POLL_END,l.parseMPoll]])),h(this,"_unknownInterpretOrder",[s.M_MESSAGE])}var t,n,d;return t=e,d=[{key:"defaultInstance",get:function(){return e._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return e.defaultInstance.unknownInterpretOrder},set:function(t){e.defaultInstance.unknownInterpretOrder=t}},{key:"registerInterpreter",value:function(t,r){e.defaultInstance.registerInterpreter(t,r)}},{key:"parse",value:function(t){return e.defaultInstance.parse(t)}}],(n=[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var t,r=c(this.unknownInterpretOrder);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.interpreters.has(n)){var o=this.interpreters.get(n)(e);if(o)return o}}}catch(e){r.e(e)}finally{r.f()}return null}catch(e){if(e instanceof i.InvalidEventError)return null;throw e}}}])&&f(t.prototype,n),d&&f(t,d),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.ExtensibleEvents=p,h(p,"_defaultInstance",new p)})),n.register("cUdfU",(function(e,t){"use strict";function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.NamespacedMap=void 0;var o=function(){function e(t){var n,i,o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,i="internalMap",o=new Map,i in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,t){var a,s=r(t);try{for(s.s();!(a=s.n()).done;){var u=a.value;this.set(u[0],u[1])}}catch(e){s.e(e)}finally{s.f()}}}var t,n,o;return t=e,(n=[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}])&&i(t.prototype,n),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.NamespacedMap=o})),n.register("epRdy",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return a(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)},o(e)}function a(e,t,r){return a=s()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&u(i,r.prototype),i},a.apply(null,arguments)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InvalidEventError=void 0;var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(f,e);var t,r,o,a,c,d=(t=f,r=s(),function(){var e,n=l(t);if(r){var o=l(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return i(this,e)});function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),d.call(this,e)}return o=f,a&&n(o.prototype,a),c&&n(o,c),Object.defineProperty(o,"prototype",{writable:!1}),o}(o(Error));e.exports.InvalidEventError=c})),n.register("k6a37",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LEGACY_M_ROOM_MESSAGE=void 0,e.exports.parseMRoomMessage=function(e){var t,n,a;if(s.M_MESSAGE.findIn(e.content)||s.M_TEXT.findIn(e.content))return new r.MessageEvent(e);var u,d=null===(t=e.content)||void 0===t?void 0:t.msgtype,f=null===(n=e.content)||void 0===n?void 0:n.body,h="org.matrix.custom.html"===(null===(a=e.content)||void 0===a?void 0:a.format)?e.content.formatted_body:null;return"m.text"===d?new r.MessageEvent(l(l({},e),{},{content:l(l({},e.content),{},(u={},c(u,s.M_TEXT.name,f),c(u,s.M_HTML.name,h),u))})):"m.notice"===d?new i.NoticeEvent(l(l({},e),{},{content:l(l({},e.content),{},(p={},c(p,s.M_TEXT.name,f),c(p,s.M_HTML.name,h),p))})):"m.emote"===d?new o.EmoteEvent(l(l({},e),{},{content:l(l({},e.content),{},(v={},c(v,s.M_TEXT.name,f),c(v,s.M_HTML.name,h),v))})):null;var p,v};var r=n("arVHE"),i=n("1taYN"),o=n("klVwd"),a=n("8qwGp"),s=n("htqPq");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=new a.NamespacedValue("m.room.message");e.exports.LEGACY_M_ROOM_MESSAGE=d})),n.register("arVHE",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MessageEvent=void 0;var i=n("7Yenj"),o=n("bX7CS"),a=n("epRdy"),s=n("htqPq"),u=n("f8PLG");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=g(e);if(t){var i=g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p(this,r)}}function p(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(l,e);var t,r,n,i=h(l);function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),m(v(t=i.call(this,e)),"text",void 0),m(v(t),"html",void 0),m(v(t),"renderings",void 0);var r=s.M_MESSAGE.findIn(t.wireContent),n=s.M_TEXT.findIn(t.wireContent),u=s.M_HTML.findIn(t.wireContent);if((0,o.isProvided)(r)){if(!Array.isArray(r))throw new a.InvalidEventError("m.message contents must be an array");var c=r.find((function(e){return!(0,o.isProvided)(e.mimetype)||"text/plain"===e.mimetype})),d=r.find((function(e){return"text/html"===e.mimetype}));if(!c)throw new a.InvalidEventError("m.message is missing a plain text representation");t.text=c.body,t.html=null==d?void 0:d.body,t.renderings=r}else{if(!(0,o.isOptionalAString)(n))throw new a.InvalidEventError("Missing textual representation for event");t.text=n,t.html=u,t.renderings=[{body:n,mimetype:"text/plain"}],t.html&&t.renderings.push({body:t.html,mimetype:"text/html"})}return t}return t=l,n=[{key:"from",value:function(e,t){var r;return new l({type:s.M_MESSAGE.name,content:(r={},m(r,s.M_TEXT.name,e),m(r,s.M_HTML.name,t),r)})}}],(r=[{key:"isEmote",get:function(){return s.M_EMOTE.matches(this.wireFormat.type)||(0,o.isProvided)(s.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return s.M_NOTICE.matches(this.wireFormat.type)||(0,o.isProvided)(s.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,u.isEventTypeSame)(e,s.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=m({},s.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;void 0!==t&&"text/plain"!==t||(e=m({},s.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:c(c({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}])&&d(t.prototype,r),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(i.ExtensibleEvent);e.exports.MessageEvent=y})),n.register("7Yenj",(function(e,t){"use strict";function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ExtensibleEvent=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wireFormat=t}var t,n,i;return t=e,(n=[{key:"wireContent",get:function(){return this.wireFormat.content}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.ExtensibleEvent=n})),n.register("bX7CS",(function(e,t){"use strict";function r(e){return null!=e}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isOptionalAString=function(e){return r(e)&&"string"==typeof e},e.exports.isProvided=r})),n.register("htqPq",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_TEXT=e.exports.M_NOTICE=e.exports.M_MESSAGE=e.exports.M_HTML=e.exports.M_EMOTE=void 0;var r=n("8qwGp"),i=new r.UnstableValue("m.message","org.matrix.msc1767.message");e.exports.M_MESSAGE=i;var o=new r.UnstableValue("m.text","org.matrix.msc1767.text");e.exports.M_TEXT=o;var a=new r.UnstableValue("m.html","org.matrix.msc1767.html");e.exports.M_HTML=a;var s=new r.UnstableValue("m.emote","org.matrix.msc1767.emote");e.exports.M_EMOTE=s;var u=new r.UnstableValue("m.notice","org.matrix.msc1767.notice");e.exports.M_NOTICE=u})),n.register("8qwGp",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=a(e);if(t){var i=a(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return o(this,r)}}function o(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnstableValue=e.exports.NamespacedValue=void 0;var c=function(){function e(t,r){if(s(this,e),this.stable=t,this.unstable=r,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return l(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();e.exports.NamespacedValue=c;var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}(r,e);var t=i(r);function r(e,n){var i;if(s(this,r),!(i=t.call(this,e,n)).unstable)throw new Error("Unstable value must be supplied");return i}return l(r,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),r}(c);e.exports.UnstableValue=d})),n.register("f8PLG",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var r=t,n=e;return r.matches(n.name)||r.matches(n.altName)}})),n.register("1taYN",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.NoticeEvent=void 0;var i=n("arVHE"),o=n("htqPq"),a=n("f8PLG");function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=c(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},l.apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(c,e);var t,r,n,i=f(c);function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),i.call(this,e)}return t=c,n=[{key:"from",value:function(e,t){var r;return new c({type:o.M_NOTICE.name,content:(r={},s(r,o.M_TEXT.name,e),s(r,o.M_HTML.name,t),r)})}}],(r=[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,a.isEventTypeSame)(e,o.M_NOTICE)||l(p(c.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=l(p(c.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}])&&u(t.prototype,r),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(i.MessageEvent);e.exports.NoticeEvent=v})),n.register("klVwd",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EmoteEvent=void 0;var i=n("arVHE"),o=n("htqPq"),a=n("f8PLG");function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=c(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},l.apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(c,e);var t,r,n,i=f(c);function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),i.call(this,e)}return t=c,n=[{key:"from",value:function(e,t){var r;return new c({type:o.M_EMOTE.name,content:(r={},s(r,o.M_TEXT.name,e),s(r,o.M_HTML.name,t),r)})}}],(r=[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,a.isEventTypeSame)(e,o.M_EMOTE)||l(p(c.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=l(p(c.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}])&&u(t.prototype,r),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(i.MessageEvent);e.exports.EmoteEvent=v})),n.register("aqBvm",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.parseMMessage=function(e){if(i.M_EMOTE.matches(e.type))return new o.EmoteEvent(e);if(i.M_NOTICE.matches(e.type))return new a.NoticeEvent(e);return new r.MessageEvent(e)};var r=n("arVHE"),i=n("htqPq"),o=n("klVwd"),a=n("1taYN")})),n.register("fvuck",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_POLL_START=e.exports.M_POLL_RESPONSE=e.exports.M_POLL_KIND_UNDISCLOSED=e.exports.M_POLL_KIND_DISCLOSED=e.exports.M_POLL_END=void 0;var r=n("8qwGp"),i=new r.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");e.exports.M_POLL_KIND_DISCLOSED=i;var o=new r.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");e.exports.M_POLL_KIND_UNDISCLOSED=o;var a=new r.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");e.exports.M_POLL_START=a;var s=new r.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");e.exports.M_POLL_RESPONSE=s;var u=new r.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");e.exports.M_POLL_END=u})),n.register("cPHPH",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.parseMPoll=function(e){if(r.M_POLL_START.matches(e.type))return new i.PollStartEvent(e);if(r.M_POLL_RESPONSE.matches(e.type))return new o.PollResponseEvent(e);if(r.M_POLL_END.matches(e.type))return new a.PollEndEvent(e);return null};var r=n("fvuck"),i=n("1RnW2"),o=n("ay7w5"),a=n("8P30T")})),n.register("1RnW2",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollStartEvent=e.exports.PollAnswerSubevent=void 0;var i=n("fvuck"),o=n("arVHE"),a=n("htqPq"),s=n("epRdy"),u=n("8qwGp"),l=n("f8PLG"),c=n("7Yenj");function d(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function b(e,t){return b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},b(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=E(e);if(t){var i=E(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return w(this,r)}}function w(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=function(e){y(r,e);var t=_(r);function r(e){var n;v(this,r),k(S(n=t.call(this,e)),"id",void 0);var i=e.content.id;if(!i||"string"!=typeof i)throw new s.InvalidEventError("Answer ID must be a non-empty string");return n.id=i,n}return m(r,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:p({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new r({type:"org.matrix.sdk.poll.answer",content:k({id:e},a.M_TEXT.name,t)})}}]),r}(o.MessageEvent);e.exports.PollAnswerSubevent=M;var C=function(e){y(r,e);var t=_(r);function r(e){var n;v(this,r),k(S(n=t.call(this,e)),"question",void 0),k(S(n),"kind",void 0),k(S(n),"rawKind",void 0),k(S(n),"maxSelections",void 0),k(S(n),"answers",void 0);var a=i.M_POLL_START.findIn(n.wireContent);if(!a.question)throw new s.InvalidEventError("A question is required");if(n.question=new o.MessageEvent({type:"org.matrix.sdk.poll.question",content:a.question}),n.rawKind=a.kind,i.M_POLL_KIND_DISCLOSED.matches(n.rawKind)?n.kind=i.M_POLL_KIND_DISCLOSED:n.kind=i.M_POLL_KIND_UNDISCLOSED,n.maxSelections=Number.isFinite(a.max_selections)&&a.max_selections>0?a.max_selections:1,!Array.isArray(a.answers))throw new s.InvalidEventError("Poll answers must be an array");var u=a.answers.slice(0,20).map((function(e){return new M({type:"org.matrix.sdk.poll.answer",content:e})}));if(u.length<=0)throw new s.InvalidEventError("No answers available");return n.answers=u,n}return m(r,[{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,i.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:i.M_POLL_START.name,content:(e={},k(e,i.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map((function(e){return e.serialize().content}))}),k(e,a.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map((function(e,t){return"".concat(t+1,". ").concat(e.text)})).join("\n"))),e)}}}],[{key:"from",value:function(e,t,n){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new r({type:i.M_POLL_START.name,content:(o={},k(o,a.M_TEXT.name,e),k(o,i.M_POLL_START.name,{question:k({},a.M_TEXT.name,e),kind:n instanceof u.NamespacedValue?n.name:n,max_selections:s,answers:t.map((function(e){return k({id:T()},a.M_TEXT.name,e)}))}),o)})}}]),r}(c.ExtensibleEvent);e.exports.PollStartEvent=C;var I="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function T(){return d(Array(16)).map((function(){return I.charAt(Math.floor(Math.random()*I.length))})).join("")}})),n.register("ay7w5",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollResponseEvent=void 0;var i=n("7Yenj"),o=n("fvuck"),a=n("epRdy"),s=n("jEK46"),u=n("f8PLG");function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(f,e);var t,r,n,i=d(f);function f(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),v(h(t=i.call(this,e)),"internalAnswerIds",void 0),v(h(t),"internalSpoiled",void 0),v(h(t),"pollEventId",void 0);var r=t.wireContent["m.relates_to"];if(!s.REFERENCE_RELATION.matches(null==r?void 0:r.rel_type)||"string"!=typeof(null==r?void 0:r.event_id))throw new a.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=r.event_id,t.validateAgainst(null),t}return t=f,n=[{key:"from",value:function(e,t){return new f({type:o.M_POLL_RESPONSE.name,content:v({"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:t}},o.M_POLL_RESPONSE.name,{answers:e})})}}],(r=[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=o.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var r=t.answers;if(r.some((function(e){return"string"!=typeof e}))||0===r.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(r.some((function(t){return!e.answers.some((function(e){return e.id===t}))})))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);r=r.slice(0,e.maxSelections)}this.internalAnswerIds=r,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,u.isEventTypeSame)(e,o.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:o.M_POLL_RESPONSE.name,content:v({"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:this.pollEventId}},o.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}])&&l(t.prototype,r),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),f}(i.ExtensibleEvent);e.exports.PollResponseEvent=g})),n.register("jEK46",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.REFERENCE_RELATION=void 0;var r=new(n("8qwGp").NamespacedValue)("m.reference");e.exports.REFERENCE_RELATION=r})),n.register("8P30T",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollEndEvent=void 0;var i=n("fvuck"),o=n("epRdy"),a=n("jEK46"),s=n("arVHE"),u=n("htqPq"),l=n("f8PLG");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v(this,r)}}function v(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(v,e);var t,r,n,c=p(v);function v(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),y(g(t=c.call(this,e)),"pollEventId",void 0),y(g(t),"closingMessage",void 0);var r=t.wireContent["m.relates_to"];if(!a.REFERENCE_RELATION.matches(null==r?void 0:r.rel_type)||"string"!=typeof(null==r?void 0:r.event_id))throw new o.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=r.event_id,t.closingMessage=new s.MessageEvent(t.wireFormat),t}return t=v,n=[{key:"from",value:function(e,t){var r;return new v({type:i.M_POLL_END.name,content:(r={"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:e}},y(r,i.M_POLL_END.name,{}),y(r,u.M_TEXT.name,t),r)})}}],(r=[{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,i.M_POLL_END)}},{key:"serialize",value:function(){return{type:i.M_POLL_END.name,content:d(y({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:this.pollEventId}},i.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}])&&f(t.prototype,r),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),v}(n("7Yenj").ExtensibleEvent);e.exports.PollEndEvent=b})),n.register("ceJVl",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("1j7TF",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LegacyMsgType=void 0,e.exports.isEventLike=function(e,t){var n=e.content;if(t===r.Text)return o.M_MESSAGE.matches(e.type)||"m.room.message"===e.type&&"m.text"===(null==n?void 0:n.msgtype);if(t===r.Emote)return o.M_EMOTE.matches(e.type)||"m.room.message"===e.type&&"m.emote"===(null==n?void 0:n.msgtype);if(t===r.Notice)return o.M_NOTICE.matches(e.type)||"m.room.message"===e.type&&"m.notice"===(null==n?void 0:n.msgtype);return!1};var r,i,o=n("htqPq");e.exports.LegacyMsgType=r,(i=r||(e.exports.LegacyMsgType=r={})).Text="m.text",i.Notice="m.notice",i.Emote="m.emote"})),n.register("1lFBd",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("61A8y"),u=n("5gj45"),l=n("cksMj"),c=n("giCK6"),d=n("eQNFO"),f=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ThreadFilterType=e.exports.ThreadEvent=e.exports.Thread=e.exports.THREAD_RELATION_TYPE=e.exports.FeatureSupport=e.exports.FILTER_RELATED_BY_SENDERS=e.exports.FILTER_RELATED_BY_REL_TYPES=void 0,e.exports.determineFeatureSupport=function(e,t){return e?v.Stable:t?v.Experimental:v.None},e.exports.threadFilterTypeToFilter=function(e){if(e===P.My)return"participated";return"all"};var h,p,v,g,m=f(n("3rHpI")),y=n("4uAg3"),b=n("k2cpO"),_=n("8bPbt"),w=n("jEuTn"),S=n("aBvOl"),E=n("jjL6E"),k=n("5xqDi"),M=n("kLCn9"),C=n("jtqeE"),I=n("6KBJA"),T=n("7Ud45");function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,m.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.ThreadEvent=h,(p=h||(e.exports.ThreadEvent=h={})).New="Thread.new",p.Update="Thread.update",p.NewReply="Thread.newReply",p.ViewThread="Thread.viewThread",p.Delete="Thread.delete",e.exports.FeatureSupport=v,(g=v||(e.exports.FeatureSupport=v={}))[g.None=0]="None",g[g.Experimental=1]="Experimental",g[g.Stable=2]="Stable";var O=function(e){(0,l.default)(n,e);var t=(0,c.default)(n);function n(e,a,s){var u,l;(0,o.default)(this,n),(u=t.call(this)).id=e,u.rootEvent=a,(0,m.default)((0,r.default)(u),"timelineSet",void 0),(0,m.default)((0,r.default)(u),"timeline",[]),(0,m.default)((0,r.default)(u),"_currentUserParticipated",!1),(0,m.default)((0,r.default)(u),"reEmitter",void 0),(0,m.default)((0,r.default)(u),"lastEvent",void 0),(0,m.default)((0,r.default)(u),"replyCount",0),(0,m.default)((0,r.default)(u),"lastPendingEvent",void 0),(0,m.default)((0,r.default)(u),"pendingReplyCount",0),(0,m.default)((0,r.default)(u),"room",void 0),(0,m.default)((0,r.default)(u),"client",void 0),(0,m.default)((0,r.default)(u),"pendingEventOrdering",void 0),(0,m.default)((0,r.default)(u),"initialEventsFetched",!n.hasServerSideSupport),(0,m.default)((0,r.default)(u),"replayEvents",[]),(0,m.default)((0,r.default)(u),"onBeforeRedaction",(function(e,t){null!=e&&e.isRelation(U.name)&&u.room.eventShouldLiveIn(e).threadId===u.id&&e.getId()!==u.id&&!t.status&&(u.replyCount--,u.updatePendingReplyCount(),u.emit(h.Update,(0,r.default)(u)))}));var c,f=(0,r.default)(u);(0,m.default)((0,r.default)(u),"onRedaction",(c=(0,i.default)((function(e){var t,r,n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:if(e.threadRootId!==f.id)return[2];if(!(f.replyCount<=0))return[3,1];t=!0,r=!1,n=void 0;try{for(i=f.timeline[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)a=o.value,f.clearEventMetadata(a)}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}return f.lastEvent=f.rootEvent,f._currentUserParticipated=!1,f.emit(h.Delete,f),[3,3];case 1:return[4,f.updateThreadMetadata()];case 2:s.sent(),s.label=3;case 3:return[2]}}))})),function(e){return c.apply(this,arguments)})),(0,m.default)((0,r.default)(u),"onTimelineEvent",(function(e,t,r){r||t.addLocalEchoReceipt(e.getSender(),e,T.ReceiptType.Read),u.onEcho(e,null!=r&&r)})),(0,m.default)((0,r.default)(u),"onLocalEcho",(function(e){u.onEcho(e,!1)}));var p=(0,r.default)(u);if((0,m.default)((0,r.default)(u),"onEcho",function(){var e=(0,i.default)((function(e,t){return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return e.threadRootId!==p.id||p.lastEvent===e?[2]:[4,p.updateThreadMetadata()];case 1:return r.sent(),e.isRelation(U.name)?(t||p.emit(h.NewReply,p,e),[2]):[2]}}))}));return function(t,r){return e.apply(this,arguments)}}()),null==s||!s.room)throw new Error("element-web#22141: A thread requires a room in order to function");return u.room=s.room,u.client=s.client,u.pendingEventOrdering=null!==(l=s.pendingEventOrdering)&&void 0!==l?l:y.PendingEventOrdering.Chronological,u.timelineSet=new E.EventTimelineSet(u.room,{timelineSupport:!0,pendingEvents:!0},u.client,(0,r.default)(u)),u.reEmitter=new b.TypedReEmitter((0,r.default)(u)),u.reEmitter.reEmit(u.timelineSet,[k.RoomEvent.Timeline,k.RoomEvent.TimelineReset]),u.room.on(w.MatrixEventEvent.BeforeRedaction,u.onBeforeRedaction),u.room.on(k.RoomEvent.Redaction,u.onRedaction),u.room.on(k.RoomEvent.LocalEchoUpdated,u.onLocalEcho),u.timelineSet.on(k.RoomEvent.Timeline,u.onTimelineEvent),u.processReceipts(s.receipts),u.updateThreadMetadata(),u.setEventMetadata(u.rootEvent),u}return(0,a.default)(n,[{key:"fetchRootEvent",value:function(){var e=this;return(0,i.default)((function(){var t,r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:e.rootEvent=e.room.findEventById(e.id),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.client.fetchRoomEvent(e.roomId,e.id)];case 2:return t=i.sent(),r=e.client.getEventMapper(),e.rootEvent=r(t),[3,4];case 3:return n=i.sent(),C.logger.error("Failed to fetch thread root to construct thread with",n),[3,4];case 4:return[4,e.processEvent(e.rootEvent)];case 5:return i.sent(),[2]}}))}))()}},{key:"roomState",get:function(){return this.room.getLiveTimeline().getState(S.EventTimeline.FORWARDS)}},{key:"addEventToTimeline",value:function(e,t){this.findEventById(e.getId())||(this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState}),this.timeline=this.events)}},{key:"addEvents",value:function(e,t){var r=this;e.forEach((function(e){return r.addEvent(e,t,!1)})),this.updateThreadMetadata()}},{key:"addEvent",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this;return(0,i.default)((function(){var i,a,s,u,l;return(0,d.__generator)(this,(function(c){if(o.setEventMetadata(e),i=o.lastReply(),a=!i||e.localTimestamp>=i.localTimestamp,n.hasServerSideSupport){if(!t&&o.initialEventsFetched&&a)o.addEventToTimeline(e,!1),o.fetchEditsWhereNeeded(e);else if(e.isRelation(_.RelationType.Annotation)||e.isRelation(_.RelationType.Replace))return o.initialEventsFetched?o.addEventToTimeline(e,t):null===(l=o.replayEvents)||void 0===l||l.push(e),null===(s=o.timelineSet.relations)||void 0===s||s.aggregateParentEvent(e),null===(u=o.timelineSet.relations)||void 0===u||u.aggregateChildEvent(e,o.timelineSet),[2]}else o.addEventToTimeline(e,t),o.client.decryptEventIfNeeded(e,{});return n.hasServerSideSupport&&o.rootEvent||!e.isRelation(U.name)||o.replyCount++,r&&(o.emit(h.NewReply,o,e),o.updateThreadMetadata()),[2]}))}))()}},{key:"processEvent",value:function(e){var t=this;return(0,i.default)((function(){return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return e?(t.setEventMetadata(e),[4,t.fetchEditsWhereNeeded(e)]):[3,2];case 1:r.sent(),r.label=2;case 2:return t.timeline=t.events,[2]}}))}))()}},{key:"processReceipts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=a.eventId,u=a.receiptType,l=a.userId,c=a.receipt,d=a.synthetic;this.addReceiptToStructure(s,u,l,c,d)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"getRootEventBundledRelationship",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rootEvent;return null==e?void 0:e.getServerAggregatedRelation(U.name)}},{key:"processRootEvent",value:function(){var e=this;return(0,i.default)((function(){var t,r;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:return t=e.getRootEventBundledRelationship(),n.hasServerSideSupport&&t?(e.replyCount=t.count,e._currentUserParticipated=!!t.current_user_participated,r=e.client.getEventMapper(),e.lastEvent=r(x(x({},t.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),[4,e.processEvent(e.lastEvent)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))()}},{key:"updatePendingReplyCount",value:function(){var e=this,t=(this.pendingEventOrdering===y.PendingEventOrdering.Detached?this.room.getPendingEvents():this.events).filter((function(t){var r;return t.threadRootId===e.id&&t.isRelation(U.name)&&null!==t.status&&t.getId()!==(null===(r=e.lastEvent)||void 0===r?void 0:r.getId())}));this.lastPendingEvent=t.length?t[t.length-1]:void 0,this.pendingReplyCount=t.length}},{key:"resetLiveTimeline",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,c;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:return n=r.liveTimeline,r.timelineSet.resetLiveTimeline(null!=e?e:void 0,null!=t?t:void 0),i=r.liveTimeline,e?[4,r.client.createMessagesRequest(r.roomId,e,1,S.Direction.Forward)]:[3,2];case 1:s=d.sent(),o=s.end,d.label=2;case 2:return t?[4,r.client.createMessagesRequest(r.roomId,t,1,S.Direction.Backward)]:[3,4];case 3:u=d.sent(),a=u.start,d.label=4;case 4:return t&&n.getPaginationToken(S.Direction.Forward)===t&&n.setPaginationToken(null!==(l=a)&&void 0!==l?l:null,S.Direction.Forward),e&&i.getPaginationToken(S.Direction.Backward)===e&&i.setPaginationToken(null!==(c=o)&&void 0!==c?c:null,S.Direction.Backward),[2]}}))}))()}},{key:"updateThreadMetadata",value:function(){var e=this;return(0,i.default)((function(){var t,r,i,o,a,s,u;return(0,d.__generator)(this,(function(l){switch(l.label){case 0:return e.updatePendingReplyCount(),n.hasServerSideSupport?e.initialEventsFetched?[3,2]:[4,e.processRootEvent()]:[3,4];case 1:l.sent(),l.label=2;case 2:return[4,e.fetchRootEvent()];case 3:l.sent(),l.label=4;case 4:return[4,e.processRootEvent()];case 5:if(l.sent(),e.initialEventsFetched)return[3,11];e.initialEventsFetched=!0,l.label=6;case 6:return l.trys.push([6,10,,11]),0===e.replyCount&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,S.Direction.Backward),[3,9]):[3,7];case 7:return[4,e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0,limit:Math.max(1,e.length)})];case 8:l.sent(),l.label=9;case 9:t=!0,r=!1,i=void 0;try{for(o=e.replayEvents[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)s=a.value,e.addEvent(s,!1)}catch(e){r=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw i}}return e.replayEvents=null,e.emit(k.RoomEvent.TimelineReset,e.room,e.timelineSet,!0),[3,11];case 10:return u=l.sent(),C.logger.error("Failed to load start of newly created thread: ",u),e.initialEventsFetched=!1,[3,11];case 11:return e.emit(h.Update,e),[2]}}))}))()}},{key:"fetchEditsWhereNeeded",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=this;return(0,i.default)((function(){return(0,d.__generator)(this,(function(e){return[2,Promise.all(t.filter((function(e){return e.isEncrypted()})).map((function(e){if(!e.isRelation())return n.client.relations(n.roomId,e.getId(),_.RelationType.Replace,e.getType(),{limit:1}).then((function(t){t.events.length&&e.makeReplaced(t.events[0])})).catch((function(e){C.logger.error("Failed to load edits for encrypted thread event",e)}))})))]}))}))()}},{key:"setEventMetadata",value:function(e){e&&(S.EventTimeline.setEventMetadata(e,this.roomState,!1),e.setThread(this))}},{key:"clearEventMetadata",value:function(e){var t,r,n;e&&(e.setThread(void 0),null===(t=e.event)||void 0===t||null===(r=t.unsigned)||void 0===r||null===(n=r["m.relations"])||void 0===n||delete n[U.name])}},{key:"findEventById",value:function(e){return this.timelineSet.findEventById(e)}},{key:"lastReply",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!0},t=this.timeline.length-1;t>=0;t--){var r=this.timeline[t];if(e(r))return r}return null}},{key:"roomId",get:function(){return this.room.roomId}},{key:"length",get:function(){return this.replyCount+this.pendingReplyCount}},{key:"replyToEvent",get:function(){var e,t;return null!==(e=null!==(t=this.lastPendingEvent)&&void 0!==t?t:this.lastEvent)&&void 0!==e?e:this.lastReply()}},{key:"events",get:function(){return this.liveTimeline.getEvents()}},{key:"has",value:function(e){return this.timelineSet.findEventById(e)instanceof w.MatrixEvent}},{key:"hasCurrentUserParticipated",get:function(){return this._currentUserParticipated}},{key:"liveTimeline",get:function(){return this.timelineSet.getLiveTimeline()}},{key:"getUnfilteredTimelineSet",value:function(){return this.timelineSet}},{key:"addReceipt",value:function(e,t){throw new Error("Unsupported function on the thread model")}},{key:"getEventReadUpTo",value:function(e,t){var r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){var o=i.getTs()<this.room.getOldestThreadedReceiptTs(),a=i.getId();if(o&&a)return a}var l=(0,s.default)((0,u.default)(n.prototype),"getEventReadUpTo",this).call(this,e,t);if(i){var c=this.room.getLastUnthreadedReceiptFor(e);if(!c)return l;for(var d=(null===(f=this.timeline)||void 0===f?void 0:f.length)-1;d>=0;--d){var f,h,p=this.timeline[d];if(p.getId()===l)return l;if(p.getTs()<c.ts)return null!==(h=p.getId())&&void 0!==h?h:l}}return l}},{key:"hasUserReadEvent",value:function(e,t){if(e===this.client.getUserId()){var r,i,o,a,l,c,d=(null!==(r=null===(i=this.lastReply())||void 0===i?void 0:i.getTs())&&void 0!==r?r:0)<this.room.getOldestThreadedReceiptTs(),f=null!==(o=null===(a=this.room.getLastUnthreadedReceiptFor(e))||void 0===a?void 0:a.ts)&&void 0!==o?o:0,h=(null!==(l=null==this||null===(c=this.lastReply())||void 0===c?void 0:c.getTs())&&void 0!==l?l:0)<f;if(d||h)return!0}return(0,s.default)((0,u.default)(n.prototype),"hasUserReadEvent",this).call(this,e,t)}}],[{key:"setServerSideSupport",value:function(e){n.hasServerSideSupport=e,e!==v.Stable&&(A.setPreferUnstable(!0),D.setPreferUnstable(!0),U.setPreferUnstable(!0))}},{key:"setServerSideListSupport",value:function(e){n.hasServerSideListSupport=e}},{key:"setServerSideFwdPaginationSupport",value:function(e){n.hasServerSideFwdPaginationSupport=e}}]),n}(I.ReadReceipt);e.exports.Thread=O,(0,m.default)(O,"hasServerSideSupport",v.None),(0,m.default)(O,"hasServerSideListSupport",v.None),(0,m.default)(O,"hasServerSideFwdPaginationSupport",v.None);var A=new M.ServerControlledNamespacedValue("related_by_senders","io.element.relation_senders");e.exports.FILTER_RELATED_BY_SENDERS=A;var D=new M.ServerControlledNamespacedValue("related_by_rel_types","io.element.relation_types");e.exports.FILTER_RELATED_BY_REL_TYPES=D;var P,L,U=new M.ServerControlledNamespacedValue("m.thread","io.element.thread");e.exports.THREAD_RELATION_TYPE=U,e.exports.ThreadFilterType=P,(L=P||(e.exports.ThreadFilterType=P={}))[L.My=0]="My",L[L.All=1]="All"})),n.register("4uAg3",(function(e,t){var i=n("Yawv5"),o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("dLRop"),l=n("cksMj"),c=n("mBz5n"),d=n("9oGi2"),f=n("aojpe"),h=n("giCK6"),p=n("eQNFO"),v=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UNSTABLE_MSC3852_LAST_SEEN_UA=e.exports.RoomVersionStability=e.exports.PendingEventOrdering=e.exports.MatrixClient=e.exports.M_AUTHENTICATION=e.exports.ClientEvent=e.exports.CRYPTO_ENABLED=void 0,e.exports.fixNotificationCountOnDecryption=De;var g=v(n("30Q0q")),m=v(n("3rHpI")),y=n("kk8uI"),b=n("jEuTn"),_=n("Vikqw"),w=n("iTgYJ"),S=n("hwbWG"),E=n("bkEVI"),k=ge(n("e8gas")),M=n("aBvOl"),C=n("gzOOt"),I=n("cCXi5"),T=ge(n("dbGKv")),R=n("k2cpO"),x=n("4F3LH"),O=n("jtqeE"),A=n("7c1B9"),D=n("6BFg8"),P=n("9sA0w"),L=n("gKhTH"),U=n("i92LU"),j=n("c9Npn"),N=n("kMq5l"),B=n("gXzzd"),F=n("8YZJm"),K=n("9qbZC"),q=ge(n("8RGNK")),W=n("5xqDi"),V=n("8bPbt"),H=n("7pEi8"),G=n("fdAIX"),z=n("94a5L"),Y=n("jioY8"),Z=n("4lFhK"),$=n("kilBp"),J=n("2jbfh"),Q=n("fu2Ru"),X=n("hEqf2"),ee=n("40nYe"),te=n("6MMVS"),re=n("7Ud45"),ne=n("9XadD"),ie=n("1lFBd"),oe=n("lB6qO"),ae=n("kLCn9"),se=n("8mfsd"),ue=n("c1Ywa"),le=n("fFuZ6"),ce=n("8iV7r"),de=n("g5Lla"),fe=["server","limit","since"];function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){(0,m.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ve(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ve=function(e){return e?r:t})(e)}function ge(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=ve(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}var me=(0,P.isCryptoAvailable)();e.exports.CRYPTO_ENABLED=me;var ye,be,_e,we,Se,Ee,ke=216e5,Me=6e5,Ce=new ae.UnstableValue("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent");e.exports.UNSTABLE_MSC3852_LAST_SEEN_UA=Ce,e.exports.PendingEventOrdering=ye,(be=ye||(e.exports.PendingEventOrdering=ye={})).Chronological="chronological",be.Detached="detached",e.exports.RoomVersionStability=_e,(we=_e||(e.exports.RoomVersionStability=_e={})).Stable="stable",we.Unstable="unstable",(Ee=Se||(Se={})).MasterKey="master_key",Ee.SelfSigningKey="self_signing_key",Ee.UserSigningKey="user_signing_key";var Ie=new ae.UnstableValue("m.authentication","org.matrix.msc2965.authentication");e.exports.M_AUTHENTICATION=Ie;var Te,Re,xe="$";e.exports.ClientEvent=Te,(Re=Te||(e.exports.ClientEvent=Te={})).Sync="sync",Re.Event="event",Re.ToDeviceEvent="toDeviceEvent",Re.AccountData="accountData",Re.Room="Room",Re.DeleteRoom="deleteRoom",Re.SyncUnexpectedError="sync.unexpectedError",Re.ClientWellKnown="WellKnown.client",Re.ReceivedVoipEvent="received_voip_event",Re.TurnServers="turnServers",Re.TurnServersError="turnServers.error";var Oe=new ae.UnstableValue("action","org.matrix.msc3824.action"),Ae=function(e){(0,l.default)(v,e);var t=(0,h.default)(v);function v(e){var r,n;(0,a.default)(this,v),r=t.call(this),(0,m.default)((0,i.default)(r),"reEmitter",new R.TypedReEmitter((0,i.default)(r))),(0,m.default)((0,i.default)(r),"olmVersion",null),(0,m.default)((0,i.default)(r),"usingExternalCrypto",!1),(0,m.default)((0,i.default)(r),"store",void 0),(0,m.default)((0,i.default)(r),"deviceId",void 0),(0,m.default)((0,i.default)(r),"credentials",void 0),(0,m.default)((0,i.default)(r),"pickleKey",void 0),(0,m.default)((0,i.default)(r),"scheduler",void 0),(0,m.default)((0,i.default)(r),"clientRunning",!1),(0,m.default)((0,i.default)(r),"timelineSupport",!1),(0,m.default)((0,i.default)(r),"urlPreviewCache",{}),(0,m.default)((0,i.default)(r),"identityServer",void 0),(0,m.default)((0,i.default)(r),"http",void 0),(0,m.default)((0,i.default)(r),"crypto",void 0),(0,m.default)((0,i.default)(r),"cryptoBackend",void 0),(0,m.default)((0,i.default)(r),"cryptoCallbacks",void 0),(0,m.default)((0,i.default)(r),"callEventHandler",void 0),(0,m.default)((0,i.default)(r),"groupCallEventHandler",void 0),(0,m.default)((0,i.default)(r),"supportsCallTransfer",!1),(0,m.default)((0,i.default)(r),"forceTURN",!1),(0,m.default)((0,i.default)(r),"iceCandidatePoolSize",0),(0,m.default)((0,i.default)(r),"idBaseUrl",void 0),(0,m.default)((0,i.default)(r),"baseUrl",void 0),(0,m.default)((0,i.default)(r),"canSupportVoip",!1),(0,m.default)((0,i.default)(r),"peekSync",null),(0,m.default)((0,i.default)(r),"isGuestAccount",!1),(0,m.default)((0,i.default)(r),"ongoingScrollbacks",{}),(0,m.default)((0,i.default)(r),"notifTimelineSet",null),(0,m.default)((0,i.default)(r),"cryptoStore",void 0),(0,m.default)((0,i.default)(r),"verificationMethods",void 0),(0,m.default)((0,i.default)(r),"fallbackICEServerAllowed",!1),(0,m.default)((0,i.default)(r),"roomList",void 0),(0,m.default)((0,i.default)(r),"syncApi",void 0),(0,m.default)((0,i.default)(r),"roomNameGenerator",void 0),(0,m.default)((0,i.default)(r),"pushRules",void 0),(0,m.default)((0,i.default)(r),"syncLeftRoomsPromise",void 0),(0,m.default)((0,i.default)(r),"syncedLeftRooms",!1),(0,m.default)((0,i.default)(r),"clientOpts",void 0),(0,m.default)((0,i.default)(r),"clientWellKnownIntervalID",void 0),(0,m.default)((0,i.default)(r),"canResetTimelineCallback",void 0),(0,m.default)((0,i.default)(r),"canSupport",new Map),(0,m.default)((0,i.default)(r),"pushProcessor",new C.PushProcessor((0,i.default)(r))),(0,m.default)((0,i.default)(r),"serverVersionsPromise",void 0),(0,m.default)((0,i.default)(r),"cachedCapabilities",void 0),(0,m.default)((0,i.default)(r),"clientWellKnown",void 0),(0,m.default)((0,i.default)(r),"clientWellKnownPromise",void 0),(0,m.default)((0,i.default)(r),"turnServers",[]),(0,m.default)((0,i.default)(r),"turnServersExpiry",0),(0,m.default)((0,i.default)(r),"checkTurnServersIntervalID",void 0),(0,m.default)((0,i.default)(r),"exportedOlmDeviceToImport",void 0),(0,m.default)((0,i.default)(r),"txnCtr",0),(0,m.default)((0,i.default)(r),"mediaHandler",new X.MediaHandler((0,i.default)(r))),(0,m.default)((0,i.default)(r),"sessionId",void 0),(0,m.default)((0,i.default)(r),"pendingEventEncryption",new Map),(0,m.default)((0,i.default)(r),"useE2eForGroupCall",!0),(0,m.default)((0,i.default)(r),"toDeviceMessageQueue",void 0),(0,m.default)((0,i.default)(r),"ignoredInvites",void 0),(0,m.default)((0,i.default)(r),"startCallEventHandler",(function(){r.isInitialSyncComplete()&&(r.callEventHandler.start(),r.groupCallEventHandler.start(),r.off(Te.Sync,r.startCallEventHandler))})),e.baseUrl=k.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=k.ensureNoTrailingSlash(e.idBaseUrl),r.baseUrl=e.baseUrl,r.idBaseUrl=e.idBaseUrl,r.identityServer=e.identityServer,r.usingExternalCrypto=null!==(n=e.usingExternalCrypto)&&void 0!==n&&n,r.store=e.store||new _.StubStore,r.deviceId=e.deviceId||null,r.sessionId=(0,z.randomString)(10);var s=e.userId||null;r.credentials={userId:s},r.http=new D.MatrixHttpApi((0,i.default)(r),{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,prefix:D.ClientPrefix.R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?r.deviceId?O.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):r.credentials.userId?O.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(r.deviceId=e.deviceToImport.deviceId,r.credentials.userId=e.deviceToImport.userId,r.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):O.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(r.pickleKey=e.pickleKey),r.scheduler=e.scheduler;var u,l=(0,i.default)(r);return r.scheduler&&r.scheduler.setProcessFunction((u=(0,o.default)((function(e){var t,r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:return t=l.getRoom(e.getRoomId()),e.status!==b.EventStatus.SENDING&&l.updatePendingEventStatus(t,e,b.EventStatus.SENDING),[4,l.sendEventHttpRequest(e)];case 1:return r=n.sent(),t&&t.updatePendingEvent(e,b.EventStatus.SENT,r.event_id),[2,r]}}))})),function(e){return u.apply(this,arguments)})),(0,w.supportsMatrixCall)()&&(r.callEventHandler=new E.CallEventHandler((0,i.default)(r)),r.groupCallEventHandler=new ee.GroupCallEventHandler((0,i.default)(r)),r.canSupportVoip=!0,r.on(Te.Sync,r.startCallEventHandler)),r.timelineSupport=Boolean(e.timelineSupport),r.cryptoStore=e.cryptoStore,r.verificationMethods=e.verificationMethods,r.cryptoCallbacks=e.cryptoCallbacks||{},r.forceTURN=e.forceTURN||!1,r.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,r.supportsCallTransfer=e.supportsCallTransfer||!1,r.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,void 0!==e.useE2eForGroupCall&&(r.useE2eForGroupCall=e.useE2eForGroupCall),r.roomList=new x.RoomList(r.cryptoStore),r.roomNameGenerator=e.roomNameGenerator,r.toDeviceMessageQueue=new se.ToDeviceMessageQueue((0,i.default)(r)),r.on(b.MatrixEventEvent.Decrypted,(function(e){De((0,i.default)(r),e)})),r.on(W.RoomEvent.Receipt,(function(e,t){if(t&&r.isRoomEncrypted(t.roomId)){var n=e.getContent();if(!(Object.keys(n).filter((function(e){var t=!0,i=!1,o=void 0;try{for(var a,s=Object.entries(n[e])[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var u=(0,c.default)(a.value,2),l=u[0],d=u[1];if(k.isSupportedReceiptType(l)&&(d&&Object.keys(d).includes(r.getUserId())))return!0}}catch(e){i=!0,o=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw o}}return!1})).length>0))return;for(var i=t.getLiveTimeline().getEvents(),o=0,a=i.length-1;a>=0;a--){var s;if(a===i.length-20)return;var u=i[a];if(t.hasUserReadEvent(r.getUserId(),u.getId()))break;var l=r.getPushActionsForEvent(u);o+=null!=l&&null!==(s=l.tweaks)&&void 0!==s&&s.highlight?1:0}t.setUnreadNotificationCount(W.NotificationCountType.Highlight,o)}})),r.ignoredInvites=new ue.IgnoredInvites((0,i.default)(r)),r}return(0,s.default)(v,[{key:"startClient",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a,s,u;return(0,p.__generator)(this,(function(l){switch(l.label){case 0:if(t.clientRunning)return[2];t.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e}),(n=t.getUserId())&&t.store.storeUser(new j.User(n)),t.canSupportVoip&&(t.checkTurnServersIntervalID=setInterval((function(){t.checkTurnServers()}),Me),t.checkTurnServers()),t.syncApi&&(O.logger.error("Still have sync object whilst not running: stopping old one"),t.syncApi.stop()),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,t.getVersions()];case 2:return l.sent(),[4,t.doesServerSupportThread()];case 3:return i=l.sent(),o=i.threads,a=i.list,s=i.fwdPagination,ie.Thread.setServerSideSupport(o),ie.Thread.setServerSideListSupport(a),ie.Thread.setServerSideFwdPaginationSupport(s),[3,5];case 4:return u=l.sent(),O.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",u),[3,5];case 5:return t.clientOpts=null!==(r=e)&&void 0!==r?r:{},t.clientOpts.slidingSync?t.syncApi=new ne.SlidingSyncSdk(t.clientOpts.slidingSync,t,t.clientOpts,t.buildSyncApiOptions()):t.syncApi=new y.SyncApi(t,t.clientOpts,t.buildSyncApiOptions()),t.syncApi.sync(),void 0!==t.clientOpts.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval((function(){t.fetchClientWellKnown()}),1e3*t.clientOpts.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.toDeviceMessageQueue.start(),[2]}}))}))()}},{key:"buildSyncApiOptions",value:function(){var e=this;return{crypto:this.crypto,cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:function(t){return!!e.canResetTimelineCallback&&e.canResetTimelineCallback(t)}}}},{key:"stopClient",value:function(){var e,t,n,i,o;null===(e=this.cryptoBackend)||void 0===e||e.stop(),this.clientRunning&&(O.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=void 0,null===(n=this.peekSync)||void 0===n||n.stopPeeking(),null===(i=this.callEventHandler)||void 0===i||i.stop(),null===(o=this.groupCallEventHandler)||void 0===o||o.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,r.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,void 0!==this.clientWellKnownIntervalID&&r.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop())}},{key:"rehydrateDevice",value:function(){var e=this;return(0,o.default)((function(){var t,n,i,o,a,s;return(0,p.__generator)(this,(function(u){switch(u.label){case 0:if(e.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");return e.cryptoCallbacks.getDehydrationKey?[4,e.getDehydratedDevice()]:[2];case 1:if(!(t=u.sent()))return[2];if(!t.device_data||!t.device_id)return O.logger.info("no dehydrated device found"),[2];n=new r.Olm.Account,u.label=2;case 2:return u.trys.push([2,5,,6]),(i=t.device_data).algorithm!==F.DEHYDRATION_ALGORITHM?(O.logger.warn("Wrong algorithm for dehydrated device"),[2]):(O.logger.log("unpickling dehydrated device"),[4,e.cryptoCallbacks.getDehydrationKey(i,(function(e){n.unpickle(new Uint8Array(e),i.account)}))]);case 3:return o=u.sent(),n.unpickle(o,i.account),O.logger.log("unpickled device"),[4,e.http.authedRequest(D.Method.Post,"/dehydrated_device/claim",void 0,{device_id:t.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})];case 4:return u.sent().success?(e.deviceId=t.device_id,O.logger.info("using dehydrated device"),a=e.pickleKey||"DEFAULT_KEY",e.exportedOlmDeviceToImport={pickledAccount:n.pickle(a),sessions:[],pickleKey:a},n.free(),[2,e.deviceId]):(n.free(),O.logger.info("not using dehydrated device"),[2]);case 5:return s=u.sent(),n.free(),O.logger.warn("could not unpickle",s),[3,6];case 6:return[2]}}))}))()}},{key:"getDehydratedDevice",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,p.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.http.authedRequest(D.Method.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})];case 1:return[2,r.sent()];case 2:return t=r.sent(),O.logger.info("could not get dehydrated device",t),[2];case 3:return[2]}}))}))()}},{key:"setDehydrationKey",value:function(e,t,r){var n=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(i){return n.crypto?[2,n.crypto.dehydrationManager.setKeyAndQueueDehydration(e,t,r)]:(O.logger.warn("not dehydrating device if crypto is not enabled"),[2])}))}))()}},{key:"createDehydratedDevice",value:function(e,t,r){var n=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return n.crypto?[4,n.crypto.dehydrationManager.setKey(e,t,r)]:(O.logger.warn("not dehydrating device if crypto is not enabled"),[2]);case 1:return i.sent(),[2,n.crypto.dehydrationManager.dehydrateDevice()]}}))}))()}},{key:"exportDevice",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,p.__generator)(this,(function(r){switch(r.label){case 0:return e.crypto?(t={userId:e.credentials.userId,deviceId:e.deviceId},[4,e.crypto.olmDevice.export()]):(O.logger.warn("not exporting device if crypto is not enabled"),[2]);case 1:return[2,(t.olmDevice=r.sent(),t)]}}))}))()}},{key:"clearStores",value:function(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var e=[];e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData());var t,n=(t=(0,o.default)((function(){var e,t,n,i;return(0,p.__generator)(this,(function(o){switch(o.label){case 0:try{e=r.indexedDB}catch(e){return[2]}t=0,n=["".concat(de.RUST_SDK_STORE_PREFIX,"::matrix-sdk-crypto"),"".concat(de.RUST_SDK_STORE_PREFIX,"::matrix-sdk-crypto-meta")],o.label=1;case 1:return t<n.length?(i=n[t],[4,new Promise((function(t,r){O.logger.info("Removing IndexedDB instance ".concat(i));var n=e.deleteDatabase(i);n.onsuccess=function(e){O.logger.info("Removed IndexedDB instance ".concat(i)),t(0)},n.onerror=function(e){O.logger.warn("Failed to remove IndexedDB instance ".concat(i,":"),e),t(0)},n.onblocked=function(e){O.logger.info("cannot yet remove IndexedDB instance ".concat(i))}}))]):[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))})),function(){return t.apply(this,arguments)});return e.push(n()),Promise.all(e).then()}},{key:"getUserId",value:function(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}},{key:"getSafeUserId",value:function(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}},{key:"getDomain",value:function(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}},{key:"getUserIdLocalpart",value:function(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}},{key:"getDeviceId",value:function(){return this.deviceId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"supportsVoip",value:function(){return this.canSupportVoip}},{key:"getMediaHandler",value:function(){return this.mediaHandler}},{key:"setForceTURN",value:function(e){this.forceTURN=e}},{key:"setSupportsCallTransfer",value:function(e){this.supportsCallTransfer=e}},{key:"getUseE2eForGroupCall",value:function(){return this.useE2eForGroupCall}},{key:"createCall",value:function(e){return(0,w.createNewMatrixCall)(this,e)}},{key:"createGroupCall",value:function(e,t,r,n,i,a){var s=this;return(0,o.default)((function(){var o;return(0,p.__generator)(this,(function(u){if(s.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));if(!(o=s.getRoom(e)))throw new Error("Cannot find room ".concat(e));return[2,new Q.GroupCall(s,o,t,r,n,void 0,i,a).create()]}))}))()}},{key:"waitUntilRoomReadyForGroupCalls",value:function(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}},{key:"getGroupCallForRoom",value:function(e){return this.groupCallEventHandler.groupCalls.get(e)||null}},{key:"getSyncState",value:function(){var e,t;return null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.getSyncState())&&void 0!==e?e:null}},{key:"getSyncStateData",value:function(){return this.syncApi?this.syncApi.getSyncStateData():null}},{key:"isInitialSyncComplete",value:function(){var e=this.getSyncState();return!!e&&(e===y.SyncState.Prepared||e===y.SyncState.Syncing)}},{key:"isGuest",value:function(){return this.isGuestAccount}},{key:"setGuest",value:function(e){this.isGuestAccount=e}},{key:"getScheduler",value:function(){return this.scheduler}},{key:"retryImmediately",value:function(){var e,t;return this.toDeviceMessageQueue.sendQueue(),null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.retryImmediately())&&void 0!==e&&e}},{key:"getNotifTimelineSet",value:function(){return this.notifTimelineSet}},{key:"setNotifTimelineSet",value:function(e){this.notifTimelineSet=e}},{key:"getCapabilities",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,r=(new Date).getTime();return this.cachedCapabilities&&!e&&r<this.cachedCapabilities.expiration?(O.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(D.Method.Get,"/capabilities").catch((function(e){return O.logger.error(e),{}})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.capabilities||{},i=Object.keys(n).length?ke:6e4+5e3*Math.random();return t.cachedCapabilities={capabilities:n,expiration:r+i},O.logger.log("Caching capabilities: ",n),n}))}},{key:"initCrypto",value:function(){var e=this;return(0,o.default)((function(){var t,r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:if(!(0,P.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(e.cryptoBackend)return O.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient"),[2];if(!e.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");return O.logger.log("Crypto: Starting up crypto store..."),[4,e.cryptoStore.startup()];case 1:return n.sent(),O.logger.log("Crypto: initialising roomlist..."),[4,e.roomList.init()];case 2:if(n.sent(),null===(t=e.getUserId()))throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===e.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");return r=new P.Crypto(e,t,e.deviceId,e.store,e.cryptoStore,e.roomList,e.verificationMethods),e.reEmitter.reEmit(r,[P.CryptoEvent.KeyBackupFailed,P.CryptoEvent.KeyBackupSessionsRemaining,P.CryptoEvent.RoomKeyRequest,P.CryptoEvent.RoomKeyRequestCancellation,P.CryptoEvent.Warning,P.CryptoEvent.DevicesUpdated,P.CryptoEvent.WillUpdateDevices,P.CryptoEvent.DeviceVerificationChanged,P.CryptoEvent.UserTrustStatusChanged,P.CryptoEvent.KeysChanged]),O.logger.log("Crypto: initialising crypto object..."),[4,r.init({exportedOlmDevice:e.exportedOlmDeviceToImport,pickleKey:e.pickleKey})];case 3:return n.sent(),delete e.exportedOlmDeviceToImport,e.olmVersion=P.Crypto.getOlmVersion(),r.registerEventHandlers(e),e.cryptoBackend=e.crypto=r,e.crypto.uploadDeviceKeys().catch((function(e){O.logger.error("Error uploading device keys",e)})),[2]}}))}))()}},{key:"initRustCrypto",value:function(){var e=this;return(0,o.default)((function(){var t,r;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:if(e.cryptoBackend)return O.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient"),[2];if(null===(t=e.getUserId()))throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===(r=e.getDeviceId()))throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");return[4,Promise.resolve().then((function(){return n("kej0e")})).then((function(e){return ge(e)}))];case 1:return[4,i.sent().initRustCrypto(e.http,t,r)];case 2:return e.cryptoBackend=i.sent(),[2]}}))}))()}},{key:"isCryptoEnabled",value:function(){return!!this.cryptoBackend}},{key:"getDeviceEd25519Key",value:function(){var e,t;return null!==(e=null===(t=this.crypto)||void 0===t?void 0:t.getDeviceEd25519Key())&&void 0!==e?e:null}},{key:"getDeviceCurve25519Key",value:function(){var e,t;return null!==(e=null===(t=this.crypto)||void 0===t?void 0:t.getDeviceCurve25519Key())&&void 0!==e?e:null}},{key:"uploadKeys",value:function(){return(0,o.default)((function(){return(0,p.__generator)(this,(function(e){return O.logger.warn("MatrixClient.uploadKeys is deprecated"),[2]}))}))()}},{key:"downloadKeys",value:function(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}},{key:"getStoredDevicesForUser",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}},{key:"getStoredDevice",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}},{key:"setDeviceVerified",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.setDeviceVerification(e,t,r,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),n}},{key:"setDeviceBlocked",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,r,null)}},{key:"setDeviceKnown",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,null,r)}},{key:"setDeviceVerification",value:function(e,t,r,n,i){var a=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(o){switch(o.label){case 0:if(!a.crypto)throw new Error("End-to-end encryption disabled");return[4,a.crypto.setDeviceVerification(e,t,r,n,i)];case 1:return o.sent(),[2]}}))}))()}},{key:"requestVerificationDM",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}},{key:"findVerificationRequestDMInProgress",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}},{key:"getVerificationRequestsToDeviceInProgress",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}},{key:"requestVerification",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}},{key:"beginKeyVerification",value:function(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,r)}},{key:"checkSecretStorageKey",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}},{key:"setGlobalBlacklistUnverifiedDevices",value:function(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices=e,e}},{key:"getGlobalBlacklistUnverifiedDevices",value:function(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices}},{key:"setGlobalErrorOnUnknownDevices",value:function(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.globalErrorOnUnknownDevices=e}},{key:"getGlobalErrorOnUnknownDevices",value:function(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalErrorOnUnknownDevices}},{key:"getCrossSigningId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.CrossSigningKey.Master;if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}},{key:"getStoredCrossSigningForUser",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}},{key:"checkUserTrust",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(e)}},{key:"checkDeviceTrust",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}},{key:"checkIfOwnDeviceCrossSigned",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkIfOwnDeviceCrossSigned(e)}},{key:"checkOwnCrossSigningTrust",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}},{key:"checkCrossSigningPrivateKey",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}},{key:"legacyDeviceVerification",value:function(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,r)}},{key:"prepareToEncrypt",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.prepareToEncrypt(e)}},{key:"userHasCrossSigningKeys",value:function(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.userHasCrossSigningKeys()}},{key:"isCrossSigningReady",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}},{key:"bootstrapCrossSigning",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}},{key:"getCryptoTrustCrossSignedDevices",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}},{key:"setCryptoTrustCrossSignedDevices",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.setCryptoTrustCrossSignedDevices(e)}},{key:"countSessionsNeedingBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}},{key:"getEventEncryptionInfo",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(e)}},{key:"createRecoveryKeyFromPassphrase",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}},{key:"isSecretStorageReady",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}},{key:"bootstrapSecretStorage",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}},{key:"addSecretStorageKey",value:function(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,r)}},{key:"hasSecretStorageKey",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}},{key:"storeSecret",value:function(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,r)}},{key:"getSecret",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}},{key:"isSecretStored",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e)}},{key:"requestSecret",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}},{key:"getDefaultSecretStorageKeyId",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}},{key:"setDefaultSecretStorageKeyId",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}},{key:"checkSecretStoragePrivateKey",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}},{key:"getEventSenderDeviceInfo",value:function(e){var t=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(r){return t.crypto?[2,t.crypto.getEventSenderDeviceInfo(e)]:[2,null]}))}))()}},{key:"isEventSenderVerified",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.getEventSenderDeviceInfo(e)];case 1:return(r=n.sent())?[2,r.isVerified()]:[2,!1]}}))}))()}},{key:"getOutgoingRoomKeyRequest",value:function(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");var t=e.getWireContent(),r={session_id:t.session_id,sender_key:t.sender_key,algorithm:t.algorithm,room_id:e.getRoomId()};return r.session_id&&r.sender_key&&r.algorithm&&r.room_id?this.crypto.cryptoStore.getOutgoingRoomKeyRequest(r):Promise.resolve(null)}},{key:"cancelAndResendEventRoomKeyRequest",value:function(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}},{key:"setRoomEncryption",value:function(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}},{key:"isRoomEncrypted",value:function(e){var t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents(V.EventType.RoomEncryption,"")||this.roomList.isRoomEncrypted(e))}},{key:"encryptAndSendToDevices",value:function(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.encryptAndSendToDevices(e,t)}},{key:"forceDiscardSession",value:function(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}},{key:"exportRoomKeys",value:function(){return this.cryptoBackend?this.cryptoBackend.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}},{key:"importRoomKeys",value:function(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}},{key:"checkKeyBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.checkKeyBackup()}},{key:"getKeyBackupVersion",value:function(){var e=this;return(0,o.default)((function(){var t,r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.http.authedRequest(D.Method.Get,"/room_keys/version",void 0,void 0,{prefix:D.ClientPrefix.V3})];case 1:return t=n.sent(),[3,3];case 2:if("M_NOT_FOUND"===(r=n.sent()).errcode)return[2,null];throw r;case 3:return Y.BackupManager.checkBackupVersion(t),[2,t]}}))}))()}},{key:"isKeyBackupTrusted",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.isKeyBackupTrusted(e)}},{key:"getKeyBackupEnabled",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}},{key:"enableKeyBackup",value:function(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}},{key:"disableKeyBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}},{key:"prepareKeyBackupVersion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{secureSecretStorage:!1},r=this;return(0,o.default)((function(){var n,i,o,a,s;return(0,p.__generator)(this,(function(u){switch(u.label){case 0:if(!r.crypto)throw new Error("End-to-end encryption disabled");return[4,r.crypto.backupManager.prepareKeyBackupVersion(e)];case 1:return n=u.sent(),i=n.algorithm,o=n.auth_data,a=n.recovery_key,s=n.privateKey,t.secureSecretStorage?[4,r.storeSecret("m.megolm_backup.v1",(0,T.encodeBase64)(s))]:[3,3];case 2:u.sent(),O.logger.info("Key backup private key stored in secret storage"),u.label=3;case 3:return[2,{algorithm:i,auth_data:o,recovery_key:a}]}}))}))()}},{key:"isKeyBackupKeyStored",value:function(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1"))}},{key:"createKeyBackupVersion",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:if(!t.crypto)throw new Error("End-to-end encryption disabled");return[4,t.crypto.backupManager.createKeyBackupVersion(e)];case 1:return i.sent(),r={algorithm:e.algorithm,auth_data:e.auth_data},[4,t.crypto.signObject(r.auth_data)];case 2:return i.sent(),t.cryptoCallbacks.getCrossSigningKey&&t.crypto.crossSigningInfo.getId()?[4,t.crypto.crossSigningInfo.signObject(r.auth_data,"master")]:[3,4];case 3:i.sent(),i.label=4;case 4:return[4,t.http.authedRequest(D.Method.Post,"/room_keys/version",void 0,r,{prefix:D.ClientPrefix.V3})];case 5:return n=i.sent(),[4,t.checkKeyBackup()];case 6:return i.sent(),t.getKeyBackupEnabled()||O.logger.error("Key backup not usable even though we just created it"),[2,n]}}))}))()}},{key:"deleteKeyBackupVersion",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:if(!t.crypto)throw new Error("End-to-end encryption disabled");return t.crypto.backupManager.version&&t.crypto.backupManager.disableKeyBackup(),r=k.encodeUri("/room_keys/version/$version",{$version:e}),[4,t.http.authedRequest(D.Method.Delete,r,void 0,void 0,{prefix:D.ClientPrefix.V3})];case 1:return n.sent(),[2]}}))}))()}},{key:"makeKeyBackupPath",value:function(e,t,r){return{path:void 0!==t?k.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?k.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===r?void 0:{version:r}}}},{key:"sendKeyBackup",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o;return(0,p.__generator)(this,(function(a){switch(a.label){case 0:if(!i.crypto)throw new Error("End-to-end encryption disabled");return o=i.makeKeyBackupPath(e,t,r),[4,i.http.authedRequest(D.Method.Put,o.path,o.queryData,n,{prefix:D.ClientPrefix.V3})];case 1:return a.sent(),[2]}}))}))()}},{key:"scheduleAllGroupSessionsForBackup",value:function(){var e=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(t){switch(t.label){case 0:if(!e.crypto)throw new Error("End-to-end encryption disabled");return[4,e.crypto.backupManager.scheduleAllGroupSessionsForBackup()];case 1:return t.sent(),[2]}}))}))()}},{key:"flagAllGroupSessionsForBackup",value:function(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}},{key:"isValidRecoveryKey",value:function(e){try{return(0,L.decodeRecoveryKey)(e),!0}catch(e){return!1}}},{key:"keyBackupKeyFromPassword",value:function(e,t){return(0,U.keyFromAuthData)(t.auth_data,e)}},{key:"keyBackupKeyFromRecoveryKey",value:function(e){return(0,L.decodeRecoveryKey)(e)}},{key:"restoreKeyBackupWithPassword",value:function(e,t,r,n,i){var a=this;return(0,o.default)((function(){var o;return(0,p.__generator)(this,(function(s){switch(s.label){case 0:return[4,(0,U.keyFromAuthData)(n.auth_data,e)];case 1:return o=s.sent(),[2,a.restoreKeyBackup(o,t,r,n,i)]}}))}))()}},{key:"restoreKeyBackupWithSecretStorage",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o,a,s,u;return(0,p.__generator)(this,(function(l){switch(l.label){case 0:if(!i.crypto)throw new Error("End-to-end encryption disabled");return[4,i.getSecret("m.megolm_backup.v1")];case 1:return o=l.sent(),(a=(0,P.fixBackupKey)(o))?[4,i.crypto.getSecretStorageKey()]:[3,4];case 2:return s=l.sent(),[4,i.storeSecret("m.megolm_backup.v1",a,[s[0]])];case 3:l.sent(),l.label=4;case 4:return u=(0,T.decodeBase64)(a||o),[2,i.restoreKeyBackup(u,t,r,e,n)]}}))}))()}},{key:"restoreKeyBackupWithRecoveryKey",value:function(e,t,r,n,i){var o=(0,L.decodeRecoveryKey)(e);return this.restoreKeyBackup(o,t,r,n,i)}},{key:"restoreKeyBackupWithCache",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o;return(0,p.__generator)(this,(function(a){switch(a.label){case 0:if(!i.crypto)throw new Error("End-to-end encryption disabled");return[4,i.crypto.getSessionBackupPrivateKey()];case 1:if(!(o=a.sent()))throw new Error("Couldn't get key");return[2,i.restoreKeyBackup(o,e,t,r,n)]}}))}))()}},{key:"restoreKeyBackup",value:function(e,t,r,n,i){var a=this;return(0,o.default)((function(){var s,l,d,f,h,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x,A,P,L,U,j,N,B,F,K,q,W,V,H,G;return(0,p.__generator)(this,(function(z){switch(z.label){case 0:if(s=null==i?void 0:i.cacheCompleteCallback,l=null==i?void 0:i.progressCallback,!a.crypto)throw new Error("End-to-end encryption disabled");return d=0,f=[],h=a.makeKeyBackupPath(t,r,n.version),[4,Y.BackupManager.makeAlgorithm(n,(0,o.default)((function(){return(0,p.__generator)(this,(function(t){return[2,e]}))})))];case 1:g=z.sent(),m=g.untrusted,z.label=2;case 2:return z.trys.push([2,,20,21]),[4,g.keyMatches(e)];case 3:return z.sent()?(a.crypto.storeSessionBackupPrivateKey(e).catch((function(e){O.logger.warn("Error caching session backup key:",e)})).then(s),l&&l({stage:"fetch"}),[4,a.http.authedRequest(D.Method.Get,h.path,h.queryData,void 0,{prefix:D.ClientPrefix.V3})]):[2,Promise.reject(new D.MatrixError({errcode:v.RESTORE_BACKUP_ERROR_BAD_KEY}))];case 4:if(!(y=z.sent()).rooms)return[3,13];b=y.rooms,_=!0,w=!1,S=void 0,z.label=5;case 5:z.trys.push([5,10,11,12]),E=Object.entries(b)[Symbol.iterator](),z.label=6;case 6:return(_=(k=E.next()).done)?[3,9]:(M=(0,c.default)(k.value,2),C=M[0],(I=M[1]).sessions?(d+=Object.keys(I.sessions).length,[4,g.decryptSessions(I.sessions)]):[3,8]);case 7:T=z.sent(),R=!0,x=!1,A=void 0;try{for(P=T[Symbol.iterator]();!(R=(L=P.next()).done);R=!0)(U=L.value).room_id=C,f.push(U)}catch(e){x=!0,A=e}finally{try{R||null==P.return||P.return()}finally{if(x)throw A}}z.label=8;case 8:return _=!0,[3,6];case 9:return[3,12];case 10:return j=z.sent(),w=!0,S=j,[3,12];case 11:try{_||null==E.return||E.return()}finally{if(w)throw S}return[7];case 12:return[3,19];case 13:return y.sessions?(N=y.sessions,d=Object.keys(N).length,[4,g.decryptSessions(N)]):[3,15];case 14:f=z.sent(),B=!0,F=!1,K=void 0;try{for(q=f[Symbol.iterator]();!(B=(W=q.next()).done);B=!0)W.value.room_id=t}catch(e){F=!0,K=e}finally{try{B||null==q.return||q.return()}finally{if(F)throw K}}return[3,19];case 15:d=1,z.label=16;case 16:return z.trys.push([16,18,,19]),[4,g.decryptSessions((0,u.default)({},r,y))];case 17:return V=c.default.apply(void 0,[z.sent(),1]),(H=V[0]).room_id=t,H.session_id=r,f.push(H),[3,19];case 18:return G=z.sent(),O.logger.log("Failed to decrypt megolm session from backup",G),[3,19];case 19:return[3,21];case 20:return g.free(),[7];case 21:return[4,a.importRoomKeys(f,{progressCallback:l,untrusted:m,source:"backup"})];case 22:return z.sent(),[4,a.checkKeyBackup()];case 23:return z.sent(),[2,{total:d,imported:f.length}]}}))}))()}},{key:"deleteKeysFromBackup",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i;return(0,p.__generator)(this,(function(o){switch(o.label){case 0:if(!n.crypto)throw new Error("End-to-end encryption disabled");return i=n.makeKeyBackupPath(e,t,r),[4,n.http.authedRequest(D.Method.Delete,i.path,i.queryData,void 0,{prefix:D.ClientPrefix.V3})];case 1:return o.sent(),[2]}}))}))()}},{key:"sendSharedHistoryKeys",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l,d,f,h,v,g;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:if(!r.crypto)throw new Error("End-to-end encryption disabled");return(n=r.roomList.getRoomEncryption(e))?[4,r.crypto.downloadKeys(t)]:(O.logger.error("Unknown room.  Not sharing decryption keys"),[2]);case 1:i=p.sent(),o={},a=!0,s=!1,u=void 0;try{for(l=Object.entries(i)[Symbol.iterator]();!(a=(d=l.next()).done);a=!0)f=(0,c.default)(d.value,2),h=f[0],v=f[1],o[h]=Object.values(v)}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}return(g=r.crypto.getRoomDecryptor(e,n.algorithm)).sendSharedHistoryInboundSessions?[4,g.sendSharedHistoryInboundSessions(o)]:[3,3];case 2:return p.sent(),[3,4];case 3:O.logger.warn("Algorithm does not support sharing previous keys",n.algorithm),p.label=4;case 4:return[2]}}))}))()}},{key:"getMediaConfig",value:function(){return this.http.authedRequest(D.Method.Get,"/config",void 0,void 0,{prefix:D.MediaPrefix.R0})}},{key:"getRoom",value:function(e){return e?this.store.getRoom(e):null}},{key:"getRooms",value:function(){return this.store.getRooms()}},{key:"getVisibleRooms",value:function(){var e=this.store.getRooms(),t=new Set,r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value.findPredecessorRoomId();s&&t.add(s)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return e.filter((function(e){return!e.currentState.getStateEvents(V.EventType.RoomTombstone,"")||!t.has(e.roomId)}))}},{key:"getUser",value:function(e){return this.store.getUser(e)}},{key:"getUsers",value:function(){return this.store.getUsers()}},{key:"setAccountData",value:function(e,t){var r=this,n=k.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return(0,D.retryNetworkOperation)(5,(function(){return r.http.authedRequest(D.Method.Put,n,void 0,t)}))}},{key:"getAccountData",value:function(e){return this.store.getAccountData(e)}},{key:"getAccountDataFromServer",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o;return(0,p.__generator)(this,(function(a){switch(a.label){case 0:if(t.isInitialSyncComplete())return(r=t.store.getAccountData(e))?[2,r.getContent()]:[2,null];n=k.encodeUri("/user/$userId/account_data/$type",{$userId:t.credentials.userId,$type:e}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.http.authedRequest(D.Method.Get,n)];case 2:return[2,a.sent()];case 3:if(i=a.sent(),"M_NOT_FOUND"===(null===(o=i.data)||void 0===o?void 0:o.errcode))return[2,null];throw i;case 4:return[2]}}))}))()}},{key:"deleteAccountData",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i;return(0,p.__generator)(this,(function(o){switch(o.label){case 0:return(r=t.canSupport.get(ce.Feature.AccountDataDeletion))!==ce.ServerSupport.Unsupported?[3,2]:[4,t.setAccountData(e,{})];case 1:return o.sent(),[2];case 2:return n=k.encodeUri("/user/$userId/account_data/$type",{$userId:t.getSafeUserId(),$type:e}),i=r===ce.ServerSupport.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0,[4,t.http.authedRequest(D.Method.Delete,n,void 0,void 0,i)];case 3:return[2,o.sent()]}}))}))()}},{key:"getIgnoredUsers",value:function(){var e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}},{key:"setIgnoredUsers",value:function(e){var t={ignored_users:{}};return e.forEach((function(e){t.ignored_users[e]={}})),this.setAccountData("m.ignored_user_list",t)}},{key:"isUserIgnored",value:function(e){return this.getIgnoredUsers().includes(e)}},{key:"joinRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l,c,d,f,h;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:if(void 0===t.syncRoom&&(t.syncRoom=!0),null!=(n=r.getRoom(e))&&n.hasMembershipState(r.credentials.userId,"join"))return[2,Promise.resolve(n)];i=Promise.resolve(),t.inviteSignUrl&&((o=new URL(t.inviteSignUrl)).searchParams.set("mxid",r.credentials.userId),i=r.http.requestOtherUrl(D.Method.Post,o)),a={},t.viaServers&&(a.server_name=t.viaServers),p.label=1;case 1:return p.trys.push([1,4,,5]),s={},[4,i];case 2:return(u=p.sent())&&(s.third_party_signed=u),l=k.encodeUri("/join/$roomid",{$roomid:e}),[4,r.http.authedRequest(D.Method.Post,l,a,s)];case 3:return c=p.sent(),d=c.room_id,f=new y.SyncApi(r,r.clientOpts,r.buildSyncApiOptions()),h=f.createRoom(d),t.syncRoom,[2,h];case 4:throw p.sent();case 5:return[2]}}))}))()}},{key:"resendEvent",value:function(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,b.EventStatus.SENDING),this.encryptAndSendEvent(t,e)}},{key:"cancelPendingEvent",value:function(e){if(![b.EventStatus.QUEUED,b.EventStatus.NOT_SENT,b.EventStatus.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===b.EventStatus.ENCRYPTING?this.pendingEventEncryption.delete(e.getId()):this.scheduler&&e.status===b.EventStatus.QUEUED&&this.scheduler.removeEventFromQueue(e);var t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,b.EventStatus.CANCELLED)}},{key:"setRoomName",value:function(e,t){return this.sendStateEvent(e,V.EventType.RoomName,{name:t})}},{key:"setRoomTopic",value:function(e,t,r){var n=q.makeTopicContent(t,r);return this.sendStateEvent(e,V.EventType.RoomTopic,n)}},{key:"getRoomTags",value:function(e){var t=k.encodeUri("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"setRoomTag",value:function(e,t,r){var n=k.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(D.Method.Put,n,void 0,r)}},{key:"deleteRoomTag",value:function(e,t){var r=k.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(D.Method.Delete,r)}},{key:"setRoomAccountData",value:function(e,t,r){var n=k.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(D.Method.Put,n,void 0,r)}},{key:"setPowerLevel",value:function(e,t,r,n){var i={users:{}};n.getType()===V.EventType.RoomPowerLevels&&(i=k.deepCopy(n.getContent()));var o=!0,a=!1,s=void 0;if(Array.isArray(t))try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;i.users[c]=r}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}else i.users[t]=r;var d=k.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(D.Method.Put,d,void 0,i)}},{key:"unstable_createLiveBeacon",value:function(e,t){var r=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(n){return[2,r.unstable_setLiveBeacon(e,t)]}))}))()}},{key:"unstable_setLiveBeacon",value:function(e,t){var r=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(n){return[2,r.sendStateEvent(e,oe.M_BEACON_INFO.name,t,r.getUserId())]}))}))()}},{key:"sendEvent",value:function(e,t,r,n,i){var o,a,s,u,l;if(null!=t&&t.startsWith(xe)||null===t?(l=i,u=n,s=r,a=t):(l=n,u=r,s=t,a=null),a&&(null===(o=u["m.relates_to"])||void 0===o||!o.rel_type)){var c,d,f=!(null===(c=u["m.relates_to"])||void 0===c||!c["m.in_reply_to"]);u["m.relates_to"]=pe(pe({},u["m.relates_to"]),{},{rel_type:ie.THREAD_RELATION_TYPE.name,event_id:a,is_falling_back:!f});var h,p,v=null===(d=this.getRoom(e))||void 0===d?void 0:d.getThread(a);if(v&&!f)u["m.relates_to"]["m.in_reply_to"]={event_id:null!==(h=null===(p=v.lastReply((function(e){return e.isRelation(ie.THREAD_RELATION_TYPE.name)&&!e.status})))||void 0===p?void 0:p.getId())&&void 0!==h?h:a}}return this.sendCompleteEvent(e,a,{type:s,content:u},l)}},{key:"sendCompleteEvent",value:function(e,t,r,n){n||(n=this.makeTxnId());var i=new b.MatrixEvent(Object.assign(r,{event_id:"~"+e+":"+n,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),a=t?null==o?void 0:o.getThread(t):void 0;a&&i.setThread(a),this.reEmitter.reEmit(i,[b.MatrixEventEvent.Replaced,b.MatrixEventEvent.VisibilityChange]),null==o||o.reEmitter.reEmit(i,[b.MatrixEventEvent.BeforeRedaction]);var s=i.getAssociatedId();if(null!=s&&s.startsWith("~")){var u=null==o?void 0:o.getPendingEvents().find((function(e){return e.getId()===s}));null==u||u.once(b.MatrixEventEvent.LocalEventIdReplaced,(function(){i.updateAssociatedId(u.getId())}))}var l=i.getType();return O.logger.log("sendEvent of type ".concat(l," in ").concat(e," with txnId ").concat(n)),i.setTxnId(n),i.setStatus(b.EventStatus.SENDING),null==o||o.addPendingEvent(i,n),i.status===b.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(o,i)}},{key:"encryptAndSendEvent",value:function(e,t){var r=this,n=!1;return Promise.resolve().then((function(){var i=r.encryptEventIfNeeded(t,null!=e?e:void 0);return i?(r.pendingEventEncryption.set(t.getId(),i),r.updatePendingEventStatus(e,t,b.EventStatus.ENCRYPTING),i.then((function(){r.pendingEventEncryption.has(t.getId())?r.updatePendingEventStatus(e,t,b.EventStatus.SENDING):n=!0}))):null})).then((function(){if(n)return{};var i=null;return r.scheduler&&(i=r.scheduler.queueEvent(t))&&r.scheduler.getQueueForEvent(t).length>1&&r.updatePendingEventStatus(e,t,b.EventStatus.QUEUED),i||(i=r.sendEventHttpRequest(t),e&&(i=i.then((function(r){return e.updatePendingEvent(t,b.EventStatus.SENT,r.event_id),r})))),i})).catch((function(n){O.logger.error("Error sending event",n.stack||n);try{t.error=n,r.updatePendingEventStatus(e,t,b.EventStatus.NOT_SENT)}catch(e){O.logger.error("Exception in error handler!",e.stack||n)}throw n instanceof D.MatrixError&&(n.event=t),n}))}},{key:"encryptEventIfNeeded",value:function(e,t){if(e.isEncrypted())return null;if(e.isRedaction())return null;if(!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.crypto&&this.usingExternalCrypto)return null;if(e.getType()===V.EventType.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(e,t)}},{key:"getEncryptedIfNeededEventType",value:function(e,t){return t===V.EventType.Reaction?t:this.isRoomEncrypted(e)?V.EventType.RoomMessageEncrypted:t}},{key:"updatePendingEventStatus",value:function(e,t,r){e?e.updatePendingEvent(t,r):t.setStatus(r)}},{key:"sendEventHttpRequest",value:function(e){var t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));var r,n={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};if(e.isState()){var i="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(i="/rooms/$roomId/state/$eventType/$stateKey"),r=k.encodeUri(i,n)}else if(e.isRedaction()){r=k.encodeUri("/rooms/$roomId/redact/$redactsEventId/$txnId",pe({$redactsEventId:e.event.redacts},n))}else r=k.encodeUri("/rooms/$roomId/send/$eventType/$txnId",n);return this.http.authedRequest(D.Method.Put,r,void 0,e.getWireContent()).then((function(t){return O.logger.log("Event sent to ".concat(e.getRoomId()," with event id ").concat(t.event_id)),t}))}},{key:"redactEvent",value:function(e,t,r,n,i){var o,a,s,l,c;null!==(o=r)&&void 0!==o&&o.startsWith(xe)||(i=n,n=r,r=t,t=null);var d=null===(a=i)||void 0===a?void 0:a.reason;if(null!==(s=i)&&void 0!==s&&s.with_relations&&this.canSupport.get(ce.Feature.RelationBasedRedactions)===ce.ServerSupport.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(r," txnId: ").concat(n," threadId ").concat(t));var f=null!==(l=i)&&void 0!==l&&l.with_relations?(0,u.default)({},this.canSupport.get(ce.Feature.RelationBasedRedactions)===ce.ServerSupport.Stable?V.MSC3912_RELATION_BASED_REDACTIONS_PROP.stable:V.MSC3912_RELATION_BASED_REDACTIONS_PROP.unstable,null===(c=i)||void 0===c?void 0:c.with_relations):{};return this.sendCompleteEvent(e,t,{type:V.EventType.RoomRedaction,content:pe(pe({},f),{},{reason:d}),redacts:r},n)}},{key:"sendMessage",value:function(e,t,r,n){"string"!=typeof t&&null!==t&&(n=r,r=t,t=null);var i=V.EventType.RoomMessage,o=r;return this.sendEvent(e,t,i,o,n)}},{key:"sendTextMessage",value:function(e,t,r,n){var i;null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(n=r,r=t,t=null);var o=q.makeTextMessage(r);return this.sendMessage(e,t,o,n)}},{key:"sendNotice",value:function(e,t,r,n){var i;null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(n=r,r=t,t=null);var o=q.makeNotice(r);return this.sendMessage(e,t,o,n)}},{key:"sendEmoteMessage",value:function(e,t,r,n){var i;null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(n=r,r=t,t=null);var o=q.makeEmoteMessage(r);return this.sendMessage(e,t,o,n)}},{key:"sendImageMessage",value:function(e,t,r,n){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Image";null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(o=n||"Image",n=r,r=t,t=null);var a={msgtype:V.MsgType.Image,url:r,info:n,body:o};return this.sendMessage(e,t,a)}},{key:"sendStickerMessage",value:function(e,t,r,n){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Sticker";null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(o=n||"Sticker",n=r,r=t,t=null);var a={url:r,info:n,body:o};return this.sendEvent(e,t,V.EventType.Sticker,a)}},{key:"sendHtmlMessage",value:function(e,t,r,n){var i;null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(n=r,r=t,t=null);var o=q.makeHtmlMessage(r,n);return this.sendMessage(e,t,o)}},{key:"sendHtmlNotice",value:function(e,t,r,n){var i;null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(n=r,r=t,t=null);var o=q.makeHtmlNotice(r,n);return this.sendMessage(e,t,o)}},{key:"sendHtmlEmote",value:function(e,t,r,n){var i;null!==(i=t)&&void 0!==i&&i.startsWith(xe)||null===t||(n=r,r=t,t=null);var o=q.makeHtmlEmote(r,n);return this.sendMessage(e,t,o)}},{key:"sendReceipt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this;return(0,o.default)((function(){var o,a,s,u;return(0,p.__generator)(this,(function(l){return i.isGuest()?[2,Promise.resolve({})]:(o=k.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),i.canSupport.get(ce.Feature.ThreadUnreadNotifications)!==ce.ServerSupport.Unsupported&&!n&&(a=!!e.threadRootId,r=pe(pe({},r),{},{thread_id:a?e.threadRootId:re.MAIN_ROOM_TIMELINE})),s=i.http.authedRequest(D.Method.Post,o,void 0,r||{}),(u=i.getRoom(e.getRoomId()))&&i.credentials.userId&&u.addLocalEchoReceipt(i.credentials.userId,e,t),[2,s])}))}))()}},{key:"sendReadReceipt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.ReceiptType.Read,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this;return(0,o.default)((function(){var i,o;return(0,p.__generator)(this,(function(a){if(!e)return[2];if(i=e.getId(),null!=(o=n.getRoom(e.getRoomId()))&&o.hasPendingEvent(i))throw new Error("Cannot set read receipt to a pending event (".concat(i,")"));return[2,n.sendReceipt(e,t,{},r)]}))}))()}},{key:"setRoomReadMarkers",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o,a,s;return(0,p.__generator)(this,(function(u){switch(u.label){case 0:if((o=i.getRoom(e))&&o.hasPendingEvent(t))throw new Error("Cannot set read marker to a pending event (".concat(t,")"));if(r){if(a=r.getId(),null!=o&&o.hasPendingEvent(a))throw new Error("Cannot set read receipt to a pending event (".concat(a,")"));null==o||o.addLocalEchoReceipt(i.credentials.userId,r,re.ReceiptType.Read)}if(n){if(s=n.getId(),null!=o&&o.hasPendingEvent(s))throw new Error("Cannot set read receipt to a pending event (".concat(s,")"));null==o||o.addLocalEchoReceipt(i.credentials.userId,n,re.ReceiptType.ReadPrivate)}return[4,i.setRoomReadMarkersHttpRequest(e,t,a,s)];case 1:return[2,u.sent()]}}))}))()}},{key:"getUrlPreview",value:function(e,t){t=6e4*Math.floor(t/6e4);var r=new URL(e);r.hash="";var n=t+"_"+(e=r.toString()),i=this.urlPreviewCache[n];if(i)return i;var o=this.http.authedRequest(D.Method.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:D.MediaPrefix.R0});return this.urlPreviewCache[n]=o,o}},{key:"sendTyping",value:function(e,t,r){if(this.isGuest())return Promise.resolve({});var n=k.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),i={typing:t};return t&&(i.timeout=r||2e4),this.http.authedRequest(D.Method.Put,n,void 0,i)}},{key:"getRoomUpgradeHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getRoom(e);if(!r)return[];for(var n=[r],i=r.currentState.getStateEvents(V.EventType.RoomCreate,"");i;){var o=i.getContent().predecessor;if(!o||!o.room_id)break;var a=this.getRoom(o.room_id);if(!a)break;if(t){var s=a.currentState.getStateEvents(V.EventType.RoomTombstone,"");if(!s||s.getContent().replacement_room!==a.roomId)break}n.splice(0,0,a),i=a.currentState.getStateEvents(V.EventType.RoomCreate,"")}for(var u=r.currentState.getStateEvents(V.EventType.RoomTombstone,"");u;){var l=this.getRoom(u.getContent().replacement_room);if(!l)break;if(l.roomId===r.roomId)break;if(t){if(!(i=l.currentState.getStateEvents(V.EventType.RoomCreate,""))||!i.getContent().predecessor)break;var c=i.getContent().predecessor;if(c.room_id!==r.roomId)break}n.push(l);var d=new Set(n.map((function(e){return e.roomId})));if(d.size<n.length)return n.slice(0,n.length-1);u=(r=l).currentState.getStateEvents(V.EventType.RoomTombstone,"")}return n}},{key:"invite",value:function(e,t,r){return this.membershipChange(e,t,"invite",r)}},{key:"inviteByEmail",value:function(e,t){return this.inviteByThreePid(e,"email",t)}},{key:"inviteByThreePid",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i,o,a,s,u,l;return(0,p.__generator)(this,(function(c){switch(c.label){case 0:return o=k.encodeUri("/rooms/$roomId/invite",{$roomId:e}),(a=n.getIdentityServerUrl(!0))?(s={id_server:a,medium:t,address:r},(u=null!==(i=n.identityServer)&&void 0!==i&&i.getAccessToken)?[4,n.doesServerAcceptIdentityAccessToken()]:[3,2]):[2,Promise.reject(new D.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}))];case 1:u=c.sent(),c.label=2;case 2:return u?[4,n.identityServer.getAccessToken()]:[3,4];case 3:(l=c.sent())&&(s.id_access_token=l),c.label=4;case 4:return[2,n.http.authedRequest(D.Method.Post,o,void 0,s)]}}))}))()}},{key:"leave",value:function(e){return this.membershipChange(e,void 0,"leave")}},{key:"leaveRoomChain",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this,n=this.getRoomUpgradeHistory(e),i=n;if(!t){i=[];var o=!0,a=!1,s=void 0;try{for(var u,l=n[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(i.push(c),c.roomId===e)break}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}}var d={},f=[],h=function(e){return r.leave(e).then((function(){delete d[e]})).catch((function(t){d[e]=t}))},p=!0,v=!1,g=void 0;try{for(var m,y=i[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var b=m.value;f.push(h(b.roomId))}}catch(e){v=!0,g=e}finally{try{p||null==y.return||y.return()}finally{if(v)throw g}}return Promise.all(f).then((function(){return d}))}},{key:"ban",value:function(e,t,r){return this.membershipChange(e,t,"ban",r)}},{key:"forget",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this,n=this.membershipChange(e,void 0,"forget");return t?n.then((function(t){return r.store.removeRoom(e),r.emit(Te.DeleteRoom,e),t})):n}},{key:"unban",value:function(e,t){var r=k.encodeUri("/rooms/$roomId/unban",{$roomId:e}),n={user_id:t};return this.http.authedRequest(D.Method.Post,r,void 0,n)}},{key:"kick",value:function(e,t,r){var n=k.encodeUri("/rooms/$roomId/kick",{$roomId:e}),i={user_id:t,reason:r};return this.http.authedRequest(D.Method.Post,n,void 0,i)}},{key:"membershipChange",value:function(e,t,r,n){var i=k.encodeUri("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(D.Method.Post,i,void 0,{user_id:t,reason:n})}},{key:"getPushActionsForEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.getPushActions()&&!t||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}},{key:"setProfileInfo",value:function(e,t){var r=k.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(D.Method.Put,r,void 0,t)}},{key:"setDisplayName",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.setProfileInfo("displayname",{displayname:e})];case 1:return r=i.sent(),(n=t.getUser(t.getUserId()))&&(n.displayName=e,n.emit(j.UserEvent.DisplayName,n.events.presence,n)),[2,r]}}))}))()}},{key:"setAvatarUrl",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.setProfileInfo("avatar_url",{avatar_url:e})];case 1:return r=i.sent(),(n=t.getUser(t.getUserId()))&&(n.avatarUrl=e,n.emit(j.UserEvent.AvatarUrl,n.events.presence,n)),[2,r]}}))}))()}},{key:"mxcUrlToHttp",value:function(e,t,r,n,i){return(0,N.getHttpUriForMxc)(this.baseUrl,e,t,r,n,i)}},{key:"setPresence",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:if(r=k.encodeUri("/presence/$userId/status",{$userId:t.credentials.userId}),-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return[4,t.http.authedRequest(D.Method.Put,r,void 0,e)];case 1:return n.sent(),[2]}}))}))()}},{key:"getPresence",value:function(e){var t=k.encodeUri("/presence/$userId/status",{$userId:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"scrollback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,r=this,n=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){var o=Date.now()-i.errorTs;n=Math.max(3e3-o,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);var a=this.store.scrollback(e,t).length;if(a===t)return Promise.resolve(e);t-=a;var s=new Promise((function(i,o){(0,k.sleep)(n).then((function(){return r.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,M.Direction.Backward)})).then((function(t){var n,o,a=t.chunk.map(r.getEventMapper());if(t.state){var s=t.state.map(r.getEventMapper());e.currentState.setUnknownStateEvents(s)}var u=(0,c.default)(e.partitionThreadedEvents(a),2),l=u[0],d=u[1];r.processBeaconEvents(e,l),e.addEventsToTimeline(l,!0,e.getLiveTimeline()),r.processThreadEvents(e,d,!0),e.oldState.paginationToken=null!==(n=t.end)&&void 0!==n?n:null,0===t.chunk.length&&(e.oldState.paginationToken=null),r.store.storeEvents(e,a,null!==(o=t.end)&&void 0!==o?o:null,!0),delete r.ongoingScrollbacks[e.roomId],i(e)})).catch((function(t){r.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},o(t)}))}));return i={promise:s},this.ongoingScrollbacks[e.roomId]=i,s}},{key:"getEventMapper",value:function(e){return(0,G.eventMapperFor)(this,e||{})}},{key:"getEventTimeline",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l,f,h,v,g,m,y,b;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:if(!r.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(null==e||!e.room)throw new Error("getEventTimeline only supports room timelines");return e.getTimelineForEvent(t)?[2,e.getTimelineForEvent(t)]:e.thread&&r.supportsExperimentalThreads()?[2,r.getThreadTimeline(e,t)]:(s=k.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),u=void 0,null!==(n=r.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(u={filter:JSON.stringify(S.Filter.LAZY_LOADING_MESSAGES_FILTER)}),[4,r.http.authedRequest(D.Method.Get,s,u)]);case 1:if(!(l=p.sent()).event)throw new Error("'event' not in '/context' result - homeserver too old?");return e.getTimelineForEvent(t)?[2,e.getTimelineForEvent(t)]:(f=r.getEventMapper(),(h=f(l.event)).isRelation(ie.THREAD_RELATION_TYPE.name)?(O.logger.warn("Tried loading a regular timeline at the position of a thread event"),[2,void 0]):(v=(0,d.default)(l.events_after.reverse().map(f)).concat([h],(0,d.default)(l.events_before.map(f))),(g=e.getTimelineForEvent(v[0].getId()))?g.getState(M.EventTimeline.BACKWARDS).setUnknownStateEvents(l.state.map(f)):((g=e.addTimeline()).initialiseState(l.state.map(f)),g.getState(M.EventTimeline.FORWARDS).paginationToken=l.end),m=(0,c.default)(e.room.partitionThreadedEvents(v),2),y=m[0],b=m[1],e.addEventsToTimeline(y,!0,g,l.start),r.processThreadEvents(e.room,b,!0),r.processBeaconEvents(e.room,y),[2,null!==(i=null!==(o=e.getTimelineForEvent(t))&&void 0!==o?o:null===(a=e.room.findThreadForEvent(h))||void 0===a?void 0:a.liveTimeline)&&void 0!==i?i:g]))}}))}))()}},{key:"getThreadTimeline",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l,c,f,h,v,g,m,y,b,_,w,E,C,I,T,R,x,O,A,P,L,U,j,N,B,F,K,q,W,V,H,G,z,Y,Z;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:if(!r.supportsExperimentalThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");return i=k.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),o={limit:"0"},null!==(n=r.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(o.filter=JSON.stringify(S.Filter.LAZY_LOADING_MESSAGES_FILTER)),[4,r.http.authedRequest(D.Method.Get,i,o)];case 1:if(a=p.sent(),s=r.getEventMapper(),u=s(a.event),!e.canContain(u))return[2,void 0];if(!ie.Thread.hasServerSideSupport)return[3,29];if(!ie.Thread.hasServerSideFwdPaginationSupport)return[3,14];if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");return h=e.thread,[4,r.fetchRelations(e.room.roomId,h.id,ie.THREAD_RELATION_TYPE.name,null,{dir:M.Direction.Backward,from:a.start})];case 2:return v=p.sent(),[4,r.fetchRelations(e.room.roomId,h.id,ie.THREAD_RELATION_TYPE.name,null,{dir:M.Direction.Forward,from:a.end})];case 3:g=p.sent(),m=(0,d.default)(g.chunk.reverse().map(s)).concat([u],(0,d.default)(v.chunk.map(s))),y=!0,b=!1,_=void 0,p.label=4;case 4:p.trys.push([4,9,10,11]),w=m[Symbol.iterator](),p.label=5;case 5:return(y=(E=w.next()).done)?[3,8]:(C=E.value,[4,null===(I=e.thread)||void 0===I?void 0:I.processEvent(C)]);case 6:p.sent(),p.label=7;case 7:return y=!0,[3,5];case 8:return[3,11];case 9:return z=p.sent(),b=!0,_=z,[3,11];case 10:try{y||null==w.return||w.return()}finally{if(b)throw _}return[7];case 11:return(T=e.getTimelineForEvent(u.getId()))?T.getState(M.EventTimeline.BACKWARDS).setUnknownStateEvents(a.state.map(s)):(T=e.addTimeline()).initialiseState(a.state.map(s)),e.addEventsToTimeline(m,!0,T,g.next_batch),v.next_batch?[3,13]:[4,r.fetchRoomEvent(e.room.roomId,h.id)];case 12:R=p.sent(),e.addEventsToTimeline([s(R)],!0,T,null),p.label=13;case 13:return T.setPaginationToken(null!==(l=v.next_batch)&&void 0!==l?l:null,M.Direction.Backward),T.setPaginationToken(null!==(c=g.next_batch)&&void 0!==c?c:null,M.Direction.Forward),r.processBeaconEvents(e.room,m),[2,null!==(f=e.getTimelineForEvent(t))&&void 0!==f?f:T];case 14:return O=e.thread,[4,r.fetchRelations(e.room.roomId,O.id,ie.THREAD_RELATION_TYPE.name,null,{dir:M.Direction.Backward,from:a.start})];case 15:A=p.sent(),P=[],L=a.end,p.label=16;case 16:return L?[4,r.fetchRelations(e.room.roomId,O.id,ie.THREAD_RELATION_TYPE.name,null,{dir:M.Direction.Forward,from:L})]:[3,18];case 17:return N=p.sent(),L=null!==(j=N.next_batch)&&void 0!==j?j:null,(U=P).push.apply(U,(0,d.default)(N.chunk)),[3,16];case 18:B=(0,d.default)(P.reverse().map(s)).concat([u],(0,d.default)(A.chunk.map(s))),F=!0,K=!1,q=void 0,p.label=19;case 19:p.trys.push([19,24,25,26]),W=B[Symbol.iterator](),p.label=20;case 20:return(F=(V=W.next()).done)?[3,23]:(H=V.value,[4,null===(G=e.thread)||void 0===G?void 0:G.processEvent(H)]);case 21:p.sent(),p.label=22;case 22:return F=!0,[3,20];case 23:return[3,26];case 24:return z=p.sent(),K=!0,q=z,[3,26];case 25:try{F||null==W.return||W.return()}finally{if(K)throw q}return[7];case 26:return(Y=e.getLiveTimeline()).getState(M.EventTimeline.BACKWARDS).setUnknownStateEvents(a.state.map(s)),e.addEventsToTimeline(B,!0,Y,null),A.next_batch?[3,28]:[4,r.fetchRoomEvent(e.room.roomId,O.id)];case 27:Z=p.sent(),e.addEventsToTimeline([s(Z)],!0,Y,null),p.label=28;case 28:return Y.setPaginationToken(null!==(x=A.next_batch)&&void 0!==x?x:null,M.Direction.Backward),Y.setPaginationToken(null,M.Direction.Forward),r.processBeaconEvents(e.room,B),[2,Y];case 29:return[2]}}))}))()}},{key:"getLatestTimeline",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a,s,u,l,c,d;return(0,p.__generator)(this,(function(f){switch(f.label){case 0:if(!t.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");return null===e.threadListType?[3,2]:[4,t.createThreadListMessagesRequest(e.room.roomId,null,1,M.Direction.Backward,e.threadListType,e.getFilter())];case 1:return i=f.sent(),r=null===(n=i.chunk)||void 0===n?void 0:n[0],[3,6];case 2:return e.thread&&ie.Thread.hasServerSideSupport?[4,t.fetchRelations(e.room.roomId,e.thread.id,ie.THREAD_RELATION_TYPE.name,null,{dir:M.Direction.Backward,limit:1})]:[3,4];case 3:return a=f.sent(),r=null===(o=a.chunk)||void 0===o?void 0:o[0],[3,6];case 4:return l=k.encodeUri("/rooms/$roomId/messages",{$roomId:e.room.roomId}),c={dir:"b"},null!==(s=t.clientOpts)&&void 0!==s&&s.lazyLoadMembers&&(c.filter=JSON.stringify(S.Filter.LAZY_LOADING_MESSAGES_FILTER)),[4,t.http.authedRequest(D.Method.Get,l,c)];case 5:d=f.sent(),r=null===(u=d.chunk)||void 0===u?void 0:u[0],f.label=6;case 6:if(!r)throw new Error("No message returned when trying to construct getLatestTimeline");return[2,t.getEventTimeline(e,r.event_id)]}}))}))()}},{key:"createMessagesRequest",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=k.encodeUri("/rooms/$roomId/messages",{$roomId:e}),s={limit:n.toString(),dir:i};t&&(s.from=t);var u,l=null;(null!==(r=this.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(l=Object.assign({},S.Filter.LAZY_LOADING_MESSAGES_FILTER)),o)&&(l=l||{},Object.assign(l,null===(u=o.getRoomTimelineFilterComponent())||void 0===u?void 0:u.toJSON()));return l&&(s.filter=JSON.stringify(l)),this.http.authedRequest(D.Method.Get,a,s)}},{key:"createThreadListMessagesRequest",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.Direction.Backward,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ie.ThreadFilterType.All,a=arguments.length>5?arguments[5]:void 0,s=k.encodeUri("/rooms/$roomId/threads",{$roomId:e}),u={limit:n.toString(),dir:i,include:(0,ie.threadFilterTypeToFilter)(o)};t&&(u.from=t);var l,c={};(null!==(r=this.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(c=pe({},S.Filter.LAZY_LOADING_MESSAGES_FILTER)),a)&&(c=pe(pe({},c),null===(l=a.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON()));Object.keys(c).length&&(u.filter=JSON.stringify(c));var d={prefix:ie.Thread.hasServerSideListSupport===ie.FeatureSupport.Stable?"/_matrix/client/v1":"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(D.Method.Get,s,u,void 0,d).then((function(e){var t;return pe(pe({},e),{},{chunk:null===(t=e.chunk)||void 0===t?void 0:t.reverse(),start:e.prev_batch,end:e.next_batch})}))}},{key:"paginateEventTimeline",value:function(e,t){var r=this,n=e.getTimelineSet()===this.notifTimelineSet,i=this.getRoom(e.getRoomId()),a=e.getTimelineSet().threadListType,s=e.getTimelineSet().thread,u=(t=t||{}).backwards||!1;if(n&&!u)throw new Error("paginateNotifTimeline can only paginate backwards");var l,d,f,h=u?M.EventTimeline.BACKWARDS:M.EventTimeline.FORWARDS,v=e.getPaginationToken(h),g=e.paginationRequests[h];if(g)return g;if(n){var m;"/notifications",l={limit:(null!==(m=t.limit)&&void 0!==m?m:30).toString(),only:"highlight"},v&&"end"!==v&&(l.from=v);var y=this;d=this.http.authedRequest(D.Method.Get,"/notifications",l).then((f=(0,o.default)((function(t){var r,n,i,o,a,s;return(0,p.__generator)(this,(function(l){for(r=t.next_token,n=[],i=0;i<t.notifications.length;i++)o=t.notifications[i],(a=y.getEventMapper()(o.event)).setPushActions(C.PushProcessor.actionListToActionsObject(o.actions)),a.event.room_id=o.room_id,n[i]=a;return(s=e.getTimelineSet()).addEventsToTimeline(n,u,e,r),y.processBeaconEvents(s.room,n),u&&!t.next_token&&e.setPaginationToken(null,h),[2,Boolean(t.next_token)]}))})),function(e){return f.apply(this,arguments)})).finally((function(){e.paginationRequests[h]=null})),e.paginationRequests[h]=d}else if(null!==a){if(!i)throw new Error("Unknown room "+e.getRoomId());if(!ie.Thread.hasServerSideFwdPaginationSupport&&h===M.Direction.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");d=this.createThreadListMessagesRequest(e.getRoomId(),v,t.limit,h,a,e.getFilter()).then((function(t){if(t.state){var n=e.getState(h),o=t.state.map(r.getEventMapper());n.setUnknownStateEvents(o)}var a=t.end,s=t.chunk.map(r.getEventMapper());return e.getTimelineSet().addEventsToTimeline(s,u,e,a),r.processBeaconEvents(i,s),r.processThreadRoots(i,s,u),u&&t.end==t.start&&e.setPaginationToken(null,h),t.end!==t.start})).finally((function(){e.paginationRequests[h]=null})),e.paginationRequests[h]=d}else if(s){var b,_,w=this.getRoom(null!==(b=e.getRoomId())&&void 0!==b?b:void 0);if(!w)throw new Error("Unknown room "+e.getRoomId());var S=this;d=this.fetchRelations(null!==(_=e.getRoomId())&&void 0!==_?_:"",s.id,ie.THREAD_RELATION_TYPE.name,null,{dir:h,limit:t.limit,from:null!=v?v:void 0}).then(function(){var t=(0,o.default)((function(t){var r,n,i,o,a,l,c,d,f,v,g,m,y,b;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:r=S.getEventMapper(),n=t.chunk.map(r),i=!0,o=!1,a=void 0,p.label=1;case 1:p.trys.push([1,6,7,8]),l=n.slice().reverse()[Symbol.iterator](),p.label=2;case 2:return(i=(c=l.next()).done)?[3,5]:(d=c.value,[4,null==s?void 0:s.processEvent(d)]);case 3:p.sent(),f=d.getSender(),u&&null!==(null==s?void 0:s.getEventReadUpTo(f))||w.addLocalEchoReceipt(f,d,re.ReceiptType.Read),p.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return v=p.sent(),o=!0,a=v,[3,8];case 7:try{i||null==l.return||l.return()}finally{if(o)throw a}return[7];case 8:return g=t.next_batch,(m=e.getTimelineSet()).addEventsToTimeline(n,u,e,null!=g?g:null),g||!u?[3,10]:[4,S.fetchRoomEvent(null!==(y=e.getRoomId())&&void 0!==y?y:"",s.id)];case 9:b=p.sent(),m.addEventsToTimeline([r(b)],!0,e,null),p.label=10;case 10:return S.processBeaconEvents(m.room,n),u&&!g&&e.setPaginationToken(null,h),[2,Boolean(g)]}}))}));return function(e){return t.apply(this,arguments)}}()).finally((function(){e.paginationRequests[h]=null})),e.paginationRequests[h]=d}else{if(!i)throw new Error("Unknown room "+e.getRoomId());d=this.createMessagesRequest(e.getRoomId(),v,t.limit,h,e.getFilter()).then((function(t){if(t.state){var n=e.getState(h),o=t.state.map(r.getEventMapper());n.setUnknownStateEvents(o)}var a=t.end,s=t.chunk.map(r.getEventMapper()),l=e.getTimelineSet(),d=(0,c.default)(i.partitionThreadedEvents(s),1)[0];l.addEventsToTimeline(d,u,e,a),r.processBeaconEvents(i,d),r.processThreadRoots(i,d.filter((function(e){return e.getServerAggregatedRelation(ie.THREAD_RELATION_TYPE.name)})),!1);var f=void 0===t.end||t.end===t.start;return u&&f&&e.setPaginationToken(null,h),!f})).finally((function(){e.paginationRequests[h]=null})),e.paginationRequests[h]=d}return d}},{key:"resetNotifTimelineSet",value:function(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}},{key:"peekInRoom",value:function(e){var t;return null===(t=this.peekSync)||void 0===t||t.stopPeeking(),this.peekSync=new y.SyncApi(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e)}},{key:"stopPeeking",value:function(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}},{key:"setGuestAccess",value:function(e,t){var r=this.sendStateEvent(e,V.EventType.RoomGuestAccess,{guest_access:t.allowJoin?"can_join":"forbidden"},""),n=Promise.resolve(void 0);return t.allowRead&&(n=this.sendStateEvent(e,V.EventType.RoomHistoryVisibility,{history_visibility:"world_readable"},"")),Promise.all([n,r]).then()}},{key:"requestRegisterEmailToken",value:function(e,t,r,n){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:n})}},{key:"requestRegisterMsisdnToken",value:function(e,t,r,n,i){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:n,next_link:i})}},{key:"requestAdd3pidEmailToken",value:function(e,t,r,n){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:n})}},{key:"requestAdd3pidMsisdnToken",value:function(e,t,r,n,i){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:n,next_link:i})}},{key:"requestPasswordEmailToken",value:function(e,t,r,n){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:n})}},{key:"requestPasswordMsisdnToken",value:function(e,t,r,n,i){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:n,next_link:i})}},{key:"requestTokenFromEndpoint",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s;return(0,p.__generator)(this,(function(u){switch(u.label){case 0:return n=Object.assign({},t),[4,r.doesServerSupportSeparateAddAndBind()];case 1:return u.sent()||!r.idBaseUrl?[3,5]:(o=new URL(r.idBaseUrl),n.id_server=o.host,(a=null!==(i=r.identityServer)&&void 0!==i&&i.getAccessToken)?[4,r.doesServerAcceptIdentityAccessToken()]:[3,3]);case 2:a=u.sent(),u.label=3;case 3:return a?[4,r.identityServer.getAccessToken()]:[3,5];case 4:(s=u.sent())&&(n.id_access_token=s),u.label=5;case 5:return[2,r.http.request(D.Method.Post,e,void 0,n)]}}))}))()}},{key:"getRoomPushRule",value:function(e,t){var r,n;if(this.pushRules)return null===(r=this.pushRules[e])||void 0===r||null===(n=r.room)||void 0===n?void 0:n.find((function(e){return e.rule_id===t}));throw new Error("SyncApi.sync() must be done before accessing to push rules.")}},{key:"setRoomMutePushRule",value:function(e,t,r){var n,i=this,o=!1,a=this.getRoomPushRule(e,t);if(null!=a&&a.actions.includes(J.PushRuleActionName.DontNotify)&&(o=!0),r)if(a){if(!o){var s=k.defer();this.deletePushRule(e,J.PushRuleKind.RoomSpecific,a.rule_id).then((function(){i.addPushRule(e,J.PushRuleKind.RoomSpecific,t,{actions:[J.PushRuleActionName.DontNotify]}).then((function(){s.resolve()})).catch((function(e){s.reject(e)}))})).catch((function(e){s.reject(e)})),n=s.promise}}else n=this.addPushRule(e,J.PushRuleKind.RoomSpecific,t,{actions:[J.PushRuleActionName.DontNotify]});else o&&(n=this.deletePushRule(e,J.PushRuleKind.RoomSpecific,a.rule_id));if(n)return new Promise((function(e,t){n.then((function(){i.getPushRules().then((function(t){i.pushRules=t,e()})).catch((function(e){t(e)}))})).catch((function(e){i.getPushRules().then((function(r){i.pushRules=r,t(e)})).catch((function(r){t(e)}))}))}))}},{key:"searchMessageText",value:function(e){var t={search_term:e.query};return"keys"in e&&(t.keys=e.keys),this.search({body:{search_categories:{room_events:t}}})}},{key:"searchRoomEvents",value:function(e){var t=this,r={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:$.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:r,results:[],highlights:[]};return this.search({body:r}).then((function(e){return t.processRoomEventsSearch(n,e)}))}},{key:"backPaginateRoomEventsSearch",value:function(e){var t=this;if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var r={body:e._query,next_batch:e.next_batch},n=this.search(r,e.abortSignal).then((function(r){return t.processRoomEventsSearch(e,r)})).finally((function(){e.pendingRequest=void 0}));return e.pendingRequest=n,n}},{key:"processRoomEventsSearch",value:function(e,t){var r,n,i=t.search_categories.room_events;e.count=i.count,e.next_batch=i.next_batch;var o=new Set(i.highlights);e.highlights.forEach((function(e){o.add(e)})),e.highlights=Array.from(o);for(var a=this.getEventMapper(),s=null!==(r=null===(n=i.results)||void 0===n?void 0:n.length)&&void 0!==r?r:0,u=0;u<s;u++){var l=B.SearchResult.fromJson(i.results[u],a),c=this.getRoom(l.context.getEvent().getRoomId()),d=!0,f=!1,h=void 0;if(c)try{for(var p,v=l.context.getTimeline()[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var g=p.value,m=c.getMember(g.getSender());!g.sender&&m&&(g.sender=m)}}catch(e){f=!0,h=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw h}}e.results.push(l)}return e}},{key:"syncLeftRooms",value:function(){var e=this;if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var t=new y.SyncApi(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=t.syncLeftRooms(),this.syncLeftRoomsPromise.then((function(){O.logger.log("Marking success of sync left room request"),e.syncedLeftRooms=!0})).finally((function(){e.syncLeftRoomsPromise=void 0})),this.syncLeftRoomsPromise}},{key:"createFilter",value:function(e){var t=this,r=k.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(D.Method.Post,r,void 0,e).then((function(r){var n=S.Filter.fromJson(t.credentials.userId,r.filter_id,e);return t.store.storeFilter(n),n}))}},{key:"getFilter",value:function(e,t,r){var n=this;if(r){var i=this.store.getFilter(e,t);if(i)return Promise.resolve(i)}var o=k.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(D.Method.Get,o).then((function(r){var i=S.Filter.fromJson(e,t,r);return n.store.storeFilter(i),i}))}},{key:"getOrCreateFilter",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l;return(0,p.__generator)(this,(function(c){switch(c.label){case 0:if(!(n=r.store.getFilterIdByName(e)))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r.getFilter(r.credentials.userId,n,!0)];case 2:return(o=c.sent())&&(a=o.getDefinition(),s=t.getDefinition(),k.deepCompare(a,s)&&(i=n)),[3,4];case 3:if("M_UNKNOWN"!==(u=c.sent()).errcode&&"M_NOT_FOUND"!==u.errcode)throw u;return[3,4];case 4:i||r.store.setFilterIdByName(e,void 0),c.label=5;case 5:return i?[2,i]:[4,r.createFilter(t.getDefinition())];case 6:return l=c.sent(),r.store.setFilterIdByName(e,l.filterId),[2,l.filterId]}}))}))()}},{key:"getOpenIdToken",value:function(){var e=k.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(D.Method.Post,e,void 0,{})}},{key:"turnServer",value:function(){return this.http.authedRequest(D.Method.Get,"/voip/turnServer")}},{key:"getTurnServers",value:function(){return this.turnServers||[]}},{key:"getTurnServersExpiry",value:function(){return this.turnServersExpiry}},{key:"pollingTurnServers",get:function(){return void 0!==this.checkTurnServersIntervalID}},{key:"checkTurnServers",value:function(){var e=this;return(0,o.default)((function(){var t,n,i,o,a;return(0,p.__generator)(this,(function(s){switch(s.label){case 0:return e.canSupportVoip?(t=!1,(n=e.turnServersExpiry-Date.now())>Me?(O.logger.debug("TURN creds are valid for another "+n+" ms: not fetching new ones."),t=!0,[3,5]):[3,1]):[2];case 1:O.logger.debug("Fetching new TURN credentials"),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.turnServer()];case 3:return(i=s.sent()).uris&&(O.logger.log("Got TURN URIs: "+i.uris+" refresh in "+i.ttl+" secs"),o={urls:i.uris,username:i.username,credential:i.password},e.turnServers=[o],e.turnServersExpiry=Date.now()+1e3*i.ttl,t=!0,e.emit(Te.TurnServers,e.turnServers)),[3,5];case 4:return a=s.sent(),O.logger.error("Failed to get TURN URIs",a),403===a.httpStatus?(O.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==e.checkTurnServersIntervalID&&r.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(Te.TurnServersError,a,!0)):e.emit(Te.TurnServersError,a,!1),[3,5];case 5:return[2,t]}}))}))()}},{key:"setFallbackICEServerAllowed",value:function(e){this.fallbackICEServerAllowed=e}},{key:"isFallbackICEServerAllowed",value:function(){return this.fallbackICEServerAllowed}},{key:"isSynapseAdministrator",value:function(){var e=k.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(D.Method.Get,e,void 0,void 0,{prefix:""}).then((function(e){return e.admin}))}},{key:"whoisSynapseUser",value:function(e){var t=k.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(D.Method.Get,t,void 0,void 0,{prefix:""})}},{key:"deactivateSynapseUser",value:function(e){var t=k.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(D.Method.Post,t,void 0,void 0,{prefix:""})}},{key:"fetchClientWellKnown",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,p.__generator)(this,(function(r){switch(r.label){case 0:return e.clientWellKnownPromise=I.AutoDiscovery.getRawClientConfig(null!==(t=e.getDomain())&&void 0!==t?t:void 0),[4,e.clientWellKnownPromise];case 1:return e.clientWellKnown=r.sent(),e.emit(Te.ClientWellKnown,e.clientWellKnown),[2]}}))}))()}},{key:"getClientWellKnown",value:function(){return this.clientWellKnown}},{key:"waitForClientWellKnown",value:function(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}},{key:"storeClientOptions",value:function(){var e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((function(t){var r=(0,c.default)(t,2),n=(r[0],r[1]);return e.includes(void 0===n?"undefined":(0,f.default)(n))})).reduce((function(e,t){var r=(0,c.default)(t,2),n=r[0],i=r[1];return e[n]=i,e}),{});return this.store.storeClientOptions(t)}},{key:"_unstable_getSharedRooms",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i;return(0,p.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.doesServerSupportUnstableFeature("uk.half-shot.msc2666")];case 1:return r=o.sent(),[4,t.doesServerSupportUnstableFeature("uk.half-shot.msc2666.mutual_rooms")];case 2:if(n=o.sent(),!r&&!n)throw Error("Server does not support mutual_rooms API");return i=k.encodeUri("/uk.half-shot.msc2666/user/".concat(n?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),[4,t.http.authedRequest(D.Method.Get,i,void 0,void 0,{prefix:D.ClientPrefix.Unstable})];case 3:return[2,o.sent().joined]}}))}))()}},{key:"getVersions",value:function(){var e=this;return(0,o.default)((function(){var t,r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:return e.serverVersionsPromise?[2,e.serverVersionsPromise]:(e.serverVersionsPromise=e.http.request(D.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((function(t){throw e.serverVersionsPromise=void 0,t})),[4,e.serverVersionsPromise]);case 1:return t=n.sent(),[4,(0,ce.buildFeatureSupportMap)(t)];case 2:return e.canSupport=n.sent(),r=e.canSupport.get(ce.Feature.ThreadUnreadNotifications),le.UNREAD_THREAD_NOTIFICATIONS.setPreferUnstable(r===ce.ServerSupport.Unstable),[2,e.serverVersionsPromise]}}))}))()}},{key:"isVersionSupported",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,p.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.getVersions()];case 1:return[2,(r=n.sent().versions)&&r.includes(e)]}}))}))()}},{key:"doesServerSupportLazyLoading",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,e.getVersions()];case 1:return(t=i.sent())?(r=t.versions,n=t.unstable_features,[2,r&&r.includes("r0.5.0")||n&&n["m.lazy_load_members"]]):[2,!1]}}))}))()}},{key:"doesServerRequireIdServerParam",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,e.getVersions()];case 1:return(t=i.sent())?(r=t.versions)&&r.includes("r0.6.0")?[2,!1]:(n=t.unstable_features)?void 0===n["m.require_identity_server"]?[2,!0]:[2,n["m.require_identity_server"]]:[2,!0]:[2,!0]}}))}))()}},{key:"doesServerAcceptIdentityAccessToken",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,e.getVersions()];case 1:return(t=i.sent())?(r=t.versions,n=t.unstable_features,[2,r&&r.includes("r0.6.0")||n&&n["m.id_access_token"]]):[2,!1]}}))}))()}},{key:"doesServerSupportSeparateAddAndBind",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,e.getVersions()];case 1:return(t=i.sent())?(r=t.versions,n=t.unstable_features,[2,(null==r?void 0:r.includes("r0.6.0"))||(null==n?void 0:n["m.separate_add_and_bind"])]):[2,!1]}}))}))()}},{key:"doesServerSupportUnstableFeature",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.getVersions()];case 1:return(r=i.sent())?[2,(n=r.unstable_features)&&!!n[e]]:[2,!1]}}))}))()}},{key:"doesServerForceEncryptionForPreset",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i;return(0,p.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.getVersions()];case 1:return(r=o.sent())?(n=r.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e,[2,n&&!!n["io.element.e2ee_forced.".concat(i)]]):[2,!1]}}))}))()}},{key:"doesServerSupportThread",value:function(){var e=this;return(0,o.default)((function(){var t,r,n,i,o,a,s;return(0,p.__generator)(this,(function(u){switch(u.label){case 0:return[4,e.isVersionSupported("v1.4")];case 1:if(u.sent())return[2,{threads:ie.FeatureSupport.Stable,list:ie.FeatureSupport.Stable,fwdPagination:ie.FeatureSupport.Stable}];u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")])];case 3:return t=c.default.apply(void 0,[u.sent(),6]),r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],[2,{threads:(0,ie.determineFeatureSupport)(n,r),list:(0,ie.determineFeatureSupport)(o,i),fwdPagination:(0,ie.determineFeatureSupport)(s,a)}];case 4:return u.sent(),[2,{threads:ie.FeatureSupport.None,list:ie.FeatureSupport.None,fwdPagination:ie.FeatureSupport.None}];case 5:return[2]}}))}))()}},{key:"doesServerSupportLogoutDevices",value:function(){return this.isVersionSupported("r0.6.1")}},{key:"hasLazyLoadMembersEnabled",value:function(){var e;return!(null===(e=this.clientOpts)||void 0===e||!e.lazyLoadMembers)}},{key:"setCanResetTimelineCallback",value:function(e){this.canResetTimelineCallback=e}},{key:"getCanResetTimelineCallback",value:function(){return this.canResetTimelineCallback}},{key:"relations",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{dir:M.Direction.Backward},a=this;return(0,o.default)((function(){var o,s,u,l,d,f,h,v,g,m;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:return u=n?a.getEncryptedIfNeededEventType(e,n):null,[4,Promise.all([a.fetchRoomEvent(e,t),a.fetchRelations(e,t,r,u,i)])];case 1:return l=c.default.apply(void 0,[p.sent(),2]),d=l[0],f=l[1],h=a.getEventMapper(),v=d?h(d):void 0,g=f.chunk.map(h),u!==V.EventType.RoomMessageEncrypted?[3,3]:(m=v?g.concat(v):g,[4,Promise.all(m.map((function(e){return a.decryptEventIfNeeded(e)})))]);case 2:p.sent(),null!==n&&(g=g.filter((function(e){return e.getType()===n}))),p.label=3;case 3:return v&&r===V.RelationType.Replace&&(g=g.filter((function(e){return e.getSender()===v.getSender()}))),[2,{originalEvent:null!=v?v:null,events:g,nextBatch:null!==(o=f.next_batch)&&void 0!==o?o:null,prevBatch:null!==(s=f.prev_batch)&&void 0!==s?s:null}]}}))}))()}},{key:"getCrossSigningCacheCallbacks",value:function(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}},{key:"generateClientSecret",value:function(){return(0,z.randomString)(32)}},{key:"decryptEventIfNeeded",value:function(e,t){return e.shouldAttemptDecryption()&&this.isCryptoEnabled()&&e.attemptDecryption(this.cryptoBackend,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}},{key:"termsUrlForService",value:function(e,t){switch(e){case A.SERVICE_TYPES.IS:return this.http.getUrl("/terms",void 0,D.IdentityPrefix.V2,t);case A.SERVICE_TYPES.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",t);default:throw new Error("Unsupported service type")}}},{key:"getHomeserverUrl",value:function(){return this.baseUrl}},{key:"getIdentityServerUrl",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r&&(null!==(e=this.idBaseUrl)&&void 0!==e&&e.startsWith("http://")||null!==(t=this.idBaseUrl)&&void 0!==t&&t.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}},{key:"setIdentityServerUrl",value:function(e){this.idBaseUrl=k.ensureNoTrailingSlash(e),this.http.setIdBaseUrl(this.idBaseUrl)}},{key:"getAccessToken",value:function(){return this.http.opts.accessToken||null}},{key:"setAccessToken",value:function(e){this.http.opts.accessToken=e}},{key:"isLoggedIn",value:function(){return void 0!==this.http.opts.accessToken}},{key:"makeTxnId",value:function(){return"m"+(new Date).getTime()+"."+this.txnCtr++}},{key:"isUsernameAvailable",value:function(e){return this.http.authedRequest(D.Method.Get,"/register/available",{username:e}).then((function(e){return e.available})).catch((function(e){return"M_USER_IN_USE"!==e.errcode&&Promise.reject(e)}))}},{key:"register",value:function(e,t,r,n,i,o,a){!0===i?i={email:!0}:null!=i&&!1!==i||(i={}),r&&(n.session=r);var s={auth:n,refresh_token:!0};return null!=e&&(s.username=e),null!=t&&(s.password=t),i.email&&(s.bind_email=!0),i.msisdn&&(s.bind_msisdn=!0),null!=o&&(s.guest_access_token=o),null!=a&&(s.inhibit_login=a),null!=t&&(s.x_show_msisdn=!0),this.registerRequest(s)}},{key:"registerGuest",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).body;return this.registerRequest(e||{},"guest")}},{key:"registerRequest",value:function(e,t){var r={};return t&&(r.kind=t),this.http.request(D.Method.Post,"/register",r,e)}},{key:"refreshToken",value:function(e){return this.http.authedRequest(D.Method.Post,"/refresh",void 0,{refresh_token:e},{prefix:D.ClientPrefix.V1,inhibitLogoutEmit:!0})}},{key:"loginFlows",value:function(){return this.http.request(D.Method.Get,"/login")}},{key:"login",value:function(e,t){var r=this,n={type:e};return Object.assign(n,t),this.http.authedRequest(D.Method.Post,"/login",void 0,n).then((function(e){return e.access_token&&e.user_id&&(r.http.opts.accessToken=e.access_token,r.credentials={userId:e.user_id}),e}))}},{key:"loginWithPassword",value:function(e,t){return this.login("m.login.password",{user:e,password:t})}},{key:"loginWithSAML2",value:function(e){return this.login("m.login.saml2",{relay_state:e})}},{key:"getCasLoginUrl",value:function(e){return this.getSsoLoginUrl(e,"cas")}},{key:"getSsoLoginUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sso",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i="/login/"+t+"/redirect";r&&(i+="/"+r);var o=(0,u.default)({redirectUrl:e},Oe.unstable,n);return this.http.getUrl(i,o,D.ClientPrefix.R0).href}},{key:"loginWithToken",value:function(e){return this.login("m.login.token",{token:e})}},{key:"logout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;return(0,o.default)((function(){var r,n,i;return(0,p.__generator)(this,(function(o){switch(o.label){case 0:if(null===(r=t.crypto)||void 0===r||null===(n=r.backupManager)||void 0===n||!n.getKeyBackupEnabled())return[3,5];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,t.crypto.backupManager.backupPendingKeys(200)];case 2:return o.sent()>0?[3,1]:[3,3];case 3:return[3,5];case 4:return i=o.sent(),O.logger.error("Key backup request failed when logging out. Some keys may be missing from backup",i),[3,5];case 5:return e&&(t.stopClient(),t.http.abort()),[2,t.http.authedRequest(D.Method.Post,"/logout")]}}))}))()}},{key:"deactivateAccount",value:function(e,t){var r={};return e&&(r.auth=e),void 0!==t&&(r.erase=t),this.http.authedRequest(D.Method.Post,"/account/deactivate",void 0,r)}},{key:"requestLoginToken",value:function(e){var t={auth:e};return this.http.authedRequest(D.Method.Post,"/org.matrix.msc3882/login/token",void 0,t,{prefix:D.ClientPrefix.Unstable})}},{key:"getFallbackAuthUrl",value:function(e,t){var r=k.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:t},D.ClientPrefix.R0).href}},{key:"createRoom",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a,s,u,l,c;return(0,p.__generator)(this,(function(d){switch(d.label){case 0:return n=(e.invite_3pid||[]).filter((function(e){return!e.id_access_token})),(i=n.length>0&&null!==(r=t.identityServer)&&void 0!==r&&r.getAccessToken)?[4,t.doesServerAcceptIdentityAccessToken()]:[3,2];case 1:i=d.sent(),d.label=2;case 2:return i?[4,t.identityServer.getAccessToken()]:[3,4];case 3:if(o=d.sent(),a=!0,s=!1,u=void 0,o)try{for(l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0)c.value.id_access_token=o}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}d.label=4;case 4:return[2,t.http.authedRequest(D.Method.Post,"/createRoom",void 0,e)]}}))}))()}},{key:"fetchRelations",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{dir:M.Direction.Backward},o=i;ie.Thread.hasServerSideFwdPaginationSupport===ie.FeatureSupport.Experimental&&(o=(0,k.replaceParam)("dir","org.matrix.msc3715.dir",o));var a=k.encodeParams(o),s="/rooms/$roomId/relations/$eventId";null!==r?(s+="/$relationType",null!==n&&(s+="/$eventType")):null!==n&&(O.logger.warn("eventType: ".concat(n," ignored when fetching\n            relations as relationType is null")),n=null);var u=k.encodeUri(s+"?"+a,{$roomId:e,$eventId:t,$relationType:r,$eventType:n});return this.http.authedRequest(D.Method.Get,u,void 0,void 0,{prefix:D.ClientPrefix.V1})}},{key:"roomState",value:function(e){var t=k.encodeUri("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"fetchRoomEvent",value:function(e,t){var r=k.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(D.Method.Get,r)}},{key:"members",value:function(e,t,r,n){var i={};t&&(i.membership=t),r&&(i.not_membership=r),n&&(i.at=n);var o=k.encodeParams(i),a=k.encodeUri("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(D.Method.Get,a)}},{key:"upgradeRoom",value:function(e,t){var r=k.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(D.Method.Post,r,void 0,{new_version:t})}},{key:"getStateEvent",value:function(e,t,r){var n={$roomId:e,$eventType:t,$stateKey:r},i=k.encodeUri("/rooms/$roomId/state/$eventType",n);return void 0!==r&&(i=k.encodeUri(i+"/$stateKey",n)),this.http.authedRequest(D.Method.Get,i)}},{key:"sendStateEvent",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={$roomId:e,$eventType:t,$stateKey:n},a=k.encodeUri("/rooms/$roomId/state/$eventType",o);return void 0!==n&&(a=k.encodeUri(a+"/$stateKey",o)),this.http.authedRequest(D.Method.Put,a,void 0,r,i)}},{key:"roomInitialSync",value:function(e,t){var r,n=k.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(D.Method.Get,n,{limit:null!==(r=null==t?void 0:t.toString())&&void 0!==r?r:"30"})}},{key:"setRoomReadMarkersHttpRequest",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o,a,s,l;return(0,p.__generator)(this,(function(c){switch(c.label){case 0:return o=k.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),a={},(0,u.default)(a,re.ReceiptType.FullyRead,t),(0,u.default)(a,re.ReceiptType.Read,r),s=a,[4,i.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")];case 1:return(l=c.sent())?[3,3]:[4,i.isVersionSupported("v1.4")];case 2:l=c.sent(),c.label=3;case 3:return l&&(s[re.ReceiptType.ReadPrivate]=n),[2,i.http.authedRequest(D.Method.Post,o,void 0,s)]}}))}))()}},{key:"getJoinedRooms",value:function(){var e=k.encodeUri("/joined_rooms",{});return this.http.authedRequest(D.Method.Get,e)}},{key:"getJoinedRoomMembers",value:function(e){var t=k.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"publicRooms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.server,r=e.limit,n=e.since,i=(0,g.default)(e,fe),o={server:t,limit:r,since:n};return 0===Object.keys(i).length?this.http.authedRequest(D.Method.Get,"/publicRooms",o):this.http.authedRequest(D.Method.Post,"/publicRooms",o,i)}},{key:"createAlias",value:function(e,t){var r=k.encodeUri("/directory/room/$alias",{$alias:e}),n={room_id:t};return this.http.authedRequest(D.Method.Put,r,void 0,n)}},{key:"deleteAlias",value:function(e){var t=k.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(D.Method.Delete,t)}},{key:"getLocalAliases",value:function(e){var t=k.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),r=D.ClientPrefix.V3;return this.http.authedRequest(D.Method.Get,t,void 0,void 0,{prefix:r})}},{key:"getRoomIdForAlias",value:function(e){var t=k.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"resolveRoomAlias",value:function(e){var t=k.encodeUri("/directory/room/$alias",{$alias:e});return this.http.request(D.Method.Get,t)}},{key:"getRoomDirectoryVisibility",value:function(e){var t=k.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"setRoomDirectoryVisibility",value:function(e,t){var r=k.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(D.Method.Put,r,void 0,{visibility:t})}},{key:"setRoomDirectoryVisibilityAppService",value:function(e,t,r){var n=k.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(D.Method.Put,n,void 0,{visibility:r})}},{key:"searchUserDirectory",value:function(e){var t=e.term,r=e.limit,n={search_term:t};return void 0!==r&&(n.limit=r),this.http.authedRequest(D.Method.Post,"/user_directory/search",void 0,n)}},{key:"uploadContent",value:function(e,t){return this.http.uploadContent(e,t)}},{key:"cancelUpload",value:function(e){return this.http.cancelUpload(e)}},{key:"getCurrentUploads",value:function(){return this.http.getCurrentUploads()}},{key:"getProfileInfo",value:function(e,t){var r=t?k.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):k.encodeUri("/profile/$userId",{$userId:e});return this.http.authedRequest(D.Method.Get,r)}},{key:"getThreePids",value:function(){return this.http.authedRequest(D.Method.Get,"/account/3pid")}},{key:"addThreePid",value:function(e,t){var r={threePidCreds:e,bind:t};return this.http.authedRequest(D.Method.Post,"/account/3pid",void 0,r)}},{key:"addThreePidOnly",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return r="/account/3pid/add",[4,t.isVersionSupported("r0.6.0")];case 1:return n=i.sent()?D.ClientPrefix.R0:D.ClientPrefix.Unstable,[2,t.http.authedRequest(D.Method.Post,r,void 0,e,{prefix:n})]}}))}))()}},{key:"bindThreePid",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return r="/account/3pid/bind",[4,t.isVersionSupported("r0.6.0")];case 1:return n=i.sent()?D.ClientPrefix.R0:D.ClientPrefix.Unstable,[2,t.http.authedRequest(D.Method.Post,r,void 0,e,{prefix:n})]}}))}))()}},{key:"unbindThreePid",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o;return(0,p.__generator)(this,(function(a){switch(a.label){case 0:return n="/account/3pid/unbind",i={medium:e,address:t,id_server:r.getIdentityServerUrl(!0)},[4,r.isVersionSupported("r0.6.0")];case 1:return o=a.sent()?D.ClientPrefix.R0:D.ClientPrefix.Unstable,[2,r.http.authedRequest(D.Method.Post,n,void 0,i,{prefix:o})]}}))}))()}},{key:"deleteThreePid",value:function(e,t){return this.http.authedRequest(D.Method.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}},{key:"setPassword",value:function(e,t,r){var n={auth:e,new_password:t,logout_devices:r};return this.http.authedRequest(D.Method.Post,"/account/password",void 0,n)}},{key:"getDevices",value:function(){return this.http.authedRequest(D.Method.Get,"/devices")}},{key:"getDevice",value:function(e){var t=k.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(D.Method.Get,t)}},{key:"setDeviceDetails",value:function(e,t){var r=k.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(D.Method.Put,r,void 0,t)}},{key:"deleteDevice",value:function(e,t){var r=k.encodeUri("/devices/$device_id",{$device_id:e}),n={};return t&&(n.auth=t),this.http.authedRequest(D.Method.Delete,r,void 0,n)}},{key:"deleteMultipleDevices",value:function(e,t){var r={devices:e};t&&(r.auth=t);return this.http.authedRequest(D.Method.Post,"/delete_devices",void 0,r)}},{key:"getPushers",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,p.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.http.authedRequest(D.Method.Get,"/pushers")];case 1:return t=r.sent(),[4,e.doesServerSupportUnstableFeature("org.matrix.msc3881")];case 2:return r.sent()||(t.pushers=t.pushers.map((function(e){return e.hasOwnProperty(V.PUSHER_ENABLED.name)||(e[V.PUSHER_ENABLED.name]=!0),e}))),[2,t]}}))}))()}},{key:"setPusher",value:function(e){return this.http.authedRequest(D.Method.Post,"/pushers/set",void 0,e)}},{key:"setLocalNotificationSettings",value:function(e,t){var r="".concat(V.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name,".").concat(e);return this.setAccountData(r,t)}},{key:"getPushRules",value:function(){return this.http.authedRequest(D.Method.Get,"/pushrules/").then((function(e){return C.PushProcessor.rewriteDefaultRules(e)}))}},{key:"addPushRule",value:function(e,t,r,n){var i=k.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this.http.authedRequest(D.Method.Put,i,void 0,n)}},{key:"deletePushRule",value:function(e,t,r){var n=k.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this.http.authedRequest(D.Method.Delete,n)}},{key:"setPushRuleEnabled",value:function(e,t,r,n){var i=k.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:r});return this.http.authedRequest(D.Method.Put,i,void 0,{enabled:n})}},{key:"setPushRuleActions",value:function(e,t,r,n){var i=k.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:r});return this.http.authedRequest(D.Method.Put,i,void 0,{actions:n})}},{key:"search",value:function(e,t){var r=e.body,n=e.next_batch,i={};return n&&(i.next_batch=n),this.http.authedRequest(D.Method.Post,"/search",i,r,{abortSignal:t})}},{key:"uploadKeysRequest",value:function(e,t){return this.http.authedRequest(D.Method.Post,"/keys/upload",void 0,e)}},{key:"uploadKeySignatures",value:function(e){return this.http.authedRequest(D.Method.Post,"/keys/signatures/upload",void 0,e,{prefix:D.ClientPrefix.V3})}},{key:"downloadKeysForUsers",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).token,r={device_keys:{}};return void 0!==t&&(r.token=t),e.forEach((function(e){r.device_keys[e]=[]})),this.http.authedRequest(D.Method.Post,"/keys/query",void 0,r)}},{key:"claimOneTimeKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signed_curve25519",r=arguments.length>2?arguments[2]:void 0,n={};void 0===t&&(t="signed_curve25519");var i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=(0,c.default)(s.value,2),d=l[0],f=l[1],h=n[d]||{};n[d]=h,h[f]=t}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}var p={one_time_keys:n};r&&(p.timeout=r);var v="/keys/claim";return this.http.authedRequest(D.Method.Post,v,void 0,p)}},{key:"getKeyChanges",value:function(e,t){var r={from:e,to:t};return this.http.authedRequest(D.Method.Get,"/keys/changes",r)}},{key:"uploadDeviceSigningKeys",value:function(e,t){var r=Object.assign({},t);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(D.Method.Post,"/keys/device_signing/upload",void 0,r,{prefix:D.ClientPrefix.Unstable})}},{key:"registerWithIdentityServer",value:function(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var t=this.http.getUrl("/account/register",void 0,D.IdentityPrefix.V2,this.idBaseUrl);return this.http.requestOtherUrl(D.Method.Post,t,e)}},{key:"requestEmailToken",value:function(e,t,r,n,i){var o={client_secret:t,email:e,send_attempt:null==r?void 0:r.toString(),next_link:n};return this.http.idServerRequest(D.Method.Post,"/validate/email/requestToken",o,D.IdentityPrefix.V2,i)}},{key:"requestMsisdnToken",value:function(e,t,r,n,i,o){var a={client_secret:r,country:e,phone_number:t,send_attempt:null==n?void 0:n.toString(),next_link:i};return this.http.idServerRequest(D.Method.Post,"/validate/msisdn/requestToken",a,D.IdentityPrefix.V2,o)}},{key:"submitMsisdnToken",value:function(e,t,r,n){var i={sid:e,client_secret:t,token:r};return this.http.idServerRequest(D.Method.Post,"/validate/msisdn/submitToken",i,D.IdentityPrefix.V2,n)}},{key:"submitMsisdnTokenOtherUrl",value:function(e,t,r,n){var i={sid:t,client_secret:r,token:n};return this.http.requestOtherUrl(D.Method.Post,e,i)}},{key:"getIdentityHashDetails",value:function(e){return this.http.idServerRequest(D.Method.Get,"/hash_details",void 0,D.IdentityPrefix.V2,e)}},{key:"identityHashedLookup",value:function(e,t){var n=this;return(0,o.default)((function(){var i,o,a,s,u,l,c,d,f,h,v,g,m,y;return(0,p.__generator)(this,(function(p){switch(p.label){case 0:return i={},[4,n.getIdentityHashDetails(t)];case 1:if(!(o=p.sent())||!o.lookup_pepper||!o.algorithms)throw new Error("Unsupported identity server: bad response");if(i.pepper=o.lookup_pepper,a={},o.algorithms.includes("sha256"))s=new r.Olm.Utility,i.addresses=e.map((function(e){var t=e[0].toLowerCase(),r=e[1].toLowerCase(),n=s.sha256("".concat(t," ").concat(r," ").concat(i.pepper)).replace(/\+/g,"-").replace(/\//g,"_");return a[n]=e[0],n})),i.algorithm="sha256";else{if(!o.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");i.addresses=e.map((function(e){var t=e[0].toLowerCase(),r=e[1].toLowerCase(),n="".concat(t," ").concat(r);return a[n]=e[0],n})),i.algorithm="none"}return[4,n.http.idServerRequest(D.Method.Post,"/lookup",i,D.IdentityPrefix.V2,t)];case 2:if(null==(u=p.sent())||!u.mappings)return[2,[]];l=[],c=!0,d=!1,f=void 0;try{for(h=Object.keys(u.mappings)[Symbol.iterator]();!(c=(v=h.next()).done);c=!0){if(g=v.value,m=u.mappings[g],!(y=a[g]))throw new Error("Identity server returned more results than expected");l.push({address:y,mxid:m})}}catch(e){d=!0,f=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw f}}return[2,l]}}))}))()}},{key:"lookupThreePid",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i,o;return(0,p.__generator)(this,(function(a){switch(a.label){case 0:return[4,n.identityHashedLookup([[t,e]],r)];case 1:return i=a.sent(),(o=i.find((function(e){return e.address===t})))?[2,{address:t,medium:e,mxid:o.mxid}]:[2,{}]}}))}))()}},{key:"bulkLookupThreePids",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l,c,d;return(0,p.__generator)(this,(function(f){switch(f.label){case 0:return[4,r.identityHashedLookup(e.map((function(e){return[e[1],e[0]]})),t)];case 1:n=f.sent(),i=[],o=!0,a=!1,s=void 0;try{for(u=n[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){if(c=l.value,!(d=e.find((function(e){return e[1]===c.address}))))throw new Error("Identity sever returned unexpected results");i.push([d[0],c.address,c.mxid])}}catch(e){a=!0,s=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw s}}return[2,{threepids:i}]}}))}))()}},{key:"getIdentityAccount",value:function(e){return this.http.idServerRequest(D.Method.Get,"/account",void 0,D.IdentityPrefix.V2,e)}},{key:"sendToDevice",value:function(e,t,r){var n=k.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),i={messages:t},o=Object.keys(t).reduce((function(e,r){return e[r]=Object.keys(t[r]),e}),{});return O.logger.log("PUT ".concat(n),o),this.http.authedRequest(D.Method.Put,n,void 0,i)}},{key:"queueToDevice",value:function(e){return this.toDeviceMessageQueue.queueBatch(e)}},{key:"getThirdpartyProtocols",value:function(){return this.http.authedRequest(D.Method.Get,"/thirdparty/protocols").then((function(e){if(!e||"object"!=typeof e)throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e}))}},{key:"getThirdpartyLocation",value:function(e,t){var r=k.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(D.Method.Get,r,t)}},{key:"getThirdpartyUser",value:function(e,t){var r=k.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(D.Method.Get,r,t)}},{key:"getTerms",value:function(e,t){var r=this.termsUrlForService(e,t);return this.http.requestOtherUrl(D.Method.Get,r)}},{key:"agreeToTerms",value:function(e,t,r,n){var i=this.termsUrlForService(e,t),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(D.Method.Post,i,{user_accepts:n},{headers:o})}},{key:"reportEvent",value:function(e,t,r,n){var i=k.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(D.Method.Post,i,void 0,{score:r,reason:n})}},{key:"getRoomHierarchy",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=this,a=k.encodeUri("/rooms/$roomId/hierarchy",{$roomId:e}),s={suggested_only:String(n),max_depth:null==r?void 0:r.toString(),from:i,limit:null==t?void 0:t.toString()};return this.http.authedRequest(D.Method.Get,a,s,void 0,{prefix:D.ClientPrefix.V1}).catch((function(e){if("M_UNRECOGNIZED"===e.errcode)return o.http.authedRequest(D.Method.Get,a,s,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw e}))}},{key:"unstableCreateFileTree",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,p.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.createRoom({name:e,preset:H.Preset.PrivateChat,power_level_content_override:pe(pe({},Z.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{},{users:(0,u.default)({},t.getUserId(),100)}),creation_content:(0,u.default)({},V.RoomCreateTypeField,V.RoomType.Space),initial_state:[{type:V.UNSTABLE_MSC3088_PURPOSE.name,state_key:V.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:(0,u.default)({},V.UNSTABLE_MSC3088_ENABLED.name,!0)},{type:V.EventType.RoomEncryption,state_key:"",content:{algorithm:T.MEGOLM_ALGORITHM}}]})];case 1:return r=i.sent(),n=r.room_id,[2,new Z.MSC3089TreeSpace(t,n)]}}))}))()}},{key:"unstableGetFileTreeSpace",value:function(e){var t,r,n=this.getRoom(e);if("join"!==(null==n?void 0:n.getMyMembership()))return null;var i=n.currentState.getStateEvents(V.EventType.RoomCreate,""),o=n.currentState.getStateEvents(V.UNSTABLE_MSC3088_PURPOSE.name,V.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!i)throw new Error("Expected single room create event");return null!=o&&null!==(t=o.getContent())&&void 0!==t&&t[V.UNSTABLE_MSC3088_ENABLED.name]?(null===(r=i.getContent())||void 0===r?void 0:r[V.RoomCreateTypeField])!==V.RoomType.Space?null:new Z.MSC3089TreeSpace(this,e):null}},{key:"slidingSync",value:function(e,t,r){var n={};e.pos&&(n.pos=e.pos,delete e.pos),e.timeout&&(n.timeout=e.timeout,delete e.timeout);var i=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(D.Method.Post,"/sync",n,e,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:t,localTimeoutMs:i,abortSignal:r})}},{key:"supportsExperimentalThreads",value:function(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.experimentalThreadSupport)||!1}},{key:"getRoomSummary",value:function(e,t){var r=this;return(0,o.default)((function(){var n;return(0,p.__generator)(this,(function(i){return n=k.encodeUri("/rooms/$roomid/summary",{$roomid:e}),[2,r.http.authedRequest(D.Method.Get,n,{via:t},void 0,{prefix:"/_matrix/client/unstable/im.nheko.summary"})]}))}))()}},{key:"processThreadEvents",value:function(e,t,r){e.processThreadedEvents(t,r)}},{key:"processThreadRoots",value:function(e,t,r){e.processThreadRoots(t,r)}},{key:"processBeaconEvents",value:function(e,t){null!=t&&t.length&&e&&e.currentState.processBeaconEvents(t,this)}},{key:"whoami",value:function(){var e=this;return(0,o.default)((function(){return(0,p.__generator)(this,(function(t){return[2,e.http.authedRequest(D.Method.Get,"/account/whoami")]}))}))()}},{key:"timestampToEvent",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i,o,a;return(0,p.__generator)(this,(function(s){switch(s.label){case 0:i=k.encodeUri("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:t.toString(),dir:r},s.label=1;case 1:return s.trys.push([1,3,,6]),[4,n.http.authedRequest(D.Method.Get,i,o,void 0,{prefix:D.ClientPrefix.V1})];case 2:return[2,s.sent()];case 3:return"M_UNRECOGNIZED"!==(a=s.sent()).errcode||400!==a.httpStatus&&404!==a.httpStatus&&405!==a.httpStatus?[3,5]:[4,n.http.authedRequest(D.Method.Get,i,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"})];case 4:return[2,s.sent()];case 5:throw a;case 6:return[2]}}))}))()}}]),v}(te.TypedEventEmitter);function De(e,t){var r,n,i=t.getPushActions(),o=e.getPushActionsForEvent(t,!0),a=e.getRoom(t.getRoomId());if(a&&e.getUserId()){var s=!!t.threadRootId&&!t.isThreadRoot,u=a.getUnreadCountForEventContext(W.NotificationCountType.Highlight,t),l=!(null==i||null===(r=i.tweaks)||void 0===r||!r.highlight),c=!(null==o||null===(n=o.tweaks)||void 0===n||!n.highlight);if(l!==c||u>0){var d;if(s){var f=a.getThread(t.threadRootId);d=!f||f.hasUserReadEvent(e.getUserId(),t.getId())}else d=a.hasUserReadEvent(e.getUserId(),t.getId());if(!d){var h,p=u;c&&!l&&p++,!c&&l&&p--,s?a.setThreadUnreadNotificationCount(t.threadRootId,W.NotificationCountType.Highlight,p):a.setUnreadNotificationCount(W.NotificationCountType.Highlight,p),(null!==(h=s?a.getThreadUnreadNotificationCount(t.threadRootId,W.NotificationCountType.Total):a.getRoomUnreadNotificationCount(W.NotificationCountType.Total))&&void 0!==h?h:0)<p&&(s?a.setThreadUnreadNotificationCount(t.threadRootId,W.NotificationCountType.Total,p):a.setUnreadNotificationCount(W.NotificationCountType.Total,p))}}}}e.exports.MatrixClient=Ae,(0,m.default)(Ae,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")})),n.register("30Q0q",(function(e,t){var r=n("7x8mS");e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("7x8mS",(function(e,t){e.exports=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("kk8uI",(function(e,t){var i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("mBz5n"),u=n("9oGi2"),l=n("eQNFO"),c=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SyncState=e.exports.SyncApi=void 0,e.exports._createAndReEmitRoom=q,e.exports.defaultClientOpts=N,e.exports.defaultSyncApiOpts=B;var d=c(n("3rHpI")),f=n("c9Npn"),h=n("5xqDi"),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),v=n("hwbWG"),g=n("aBvOl"),m=n("gzOOt"),y=n("jtqeE"),b=n("bzllY"),_=n("4uAg3"),w=n("6BFg8"),S=n("8bPbt"),E=n("bcGqc"),k=n("9SRK1"),M=n("afpjH"),C=n("fFuZ6"),I=n("8iV7r");function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,d.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O,A;e.exports.SyncState=O,(A=O||(e.exports.SyncState=O={})).Error="ERROR",A.Prepared="PREPARED",A.Stopped="STOPPED",A.Syncing="SYNCING",A.Catchup="CATCHUP",A.Reconnecting="RECONNECTING";var D,P,L=["org.matrix.msc2716v3"];function U(e,t){return"FILTER_SYNC_".concat(e)+(t?"_"+t:"")}function j(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;(n=y.logger).log.apply(n,(0,u.default)(t))}function N(e){return x({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:3e4,pendingEventOrdering:_.PendingEventOrdering.Chronological,experimentalThreadSupport:!1},e)}function B(e){return x({canResetEntireTimeline:function(e){return!1}},e)}(P=D||(D={})).Offline="offline",P.Online="online",P.Unavailable="unavailable";var F=function(){function e(t,r,n){var a=this;(0,o.default)(this,e),this.client=t,(0,d.default)(this,"opts",void 0),(0,d.default)(this,"syncOpts",void 0),(0,d.default)(this,"_peekRoom",null),(0,d.default)(this,"currentSyncRequest",void 0),(0,d.default)(this,"abortController",void 0),(0,d.default)(this,"syncState",null),(0,d.default)(this,"syncStateData",void 0),(0,d.default)(this,"catchingUp",!1),(0,d.default)(this,"running",!1),(0,d.default)(this,"keepAliveTimer",void 0),(0,d.default)(this,"connectionReturnedDefer",void 0),(0,d.default)(this,"notifEvents",[]),(0,d.default)(this,"failedSyncCount",0),(0,d.default)(this,"storeIsInvalid",!1);var s=this;(0,d.default)(this,"getPushRules",(0,i.default)((function(){var e,t;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),j("Getting push rules..."),[4,s.client.getPushRules()];case 1:return e=r.sent(),j("Got push rules"),s.client.pushRules=e,[3,4];case 2:return t=r.sent(),y.logger.error("Getting push rules failed",t),s.shouldAbortSync(t)?[2]:(j("Waiting for saved sync before retrying push rules..."),[4,s.recoverFromSyncStartupError(s.savedSyncPromise,t)]);case 3:return r.sent(),[2,s.getPushRules()];case 4:return[2]}}))}))),(0,d.default)(this,"buildDefaultFilter",(function(){var e=new v.Filter(a.client.credentials.userId);return a.client.canSupport.get(I.Feature.ThreadUnreadNotifications)!==I.ServerSupport.Unsupported&&e.setUnreadThreadNotifications(!0),e}));var u=this;(0,d.default)(this,"checkLazyLoadStatus",(0,i.default)((function(){var e,t,r;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return j("Checking lazy load status..."),u.opts.lazyLoadMembers&&u.client.isGuest()&&(u.opts.lazyLoadMembers=!1),u.opts.lazyLoadMembers?(j("Checking server lazy load support..."),[4,u.client.doesServerSupportLazyLoading()]):[3,2];case 1:n.sent()?(j("Enabling lazy load on sync filter..."),u.opts.filter||(u.opts.filter=u.buildDefaultFilter()),u.opts.filter.setLazyLoadMembers(!0)):(j("LL: lazy loading requested but not supported by server, so disabling"),u.opts.lazyLoadMembers=!1),n.label=2;case 2:return j("Checking whether lazy loading has changed in store..."),[4,u.wasLazyLoadingToggled(u.opts.lazyLoadMembers)];case 3:if(n.sent())return u.storeIsInvalid=!0,e=new b.InvalidStoreError(b.InvalidStoreState.ToggledLazyLoading,!!u.opts.lazyLoadMembers),u.updateSyncState(O.Error,{error:e}),y.logger.warn("InvalidStoreError: store is not usable: stopping sync."),[2];u.opts.lazyLoadMembers&&(null===(t=u.syncOpts.crypto)||void 0===t||t.enableLazyLoading()),n.label=4;case 4:return n.trys.push([4,6,,7]),j("Storing client options..."),[4,u.client.storeClientOptions()];case 5:return n.sent(),j("Stored client options"),[3,7];case 6:throw r=n.sent(),y.logger.error("Storing client options failed",r),r;case 7:return[2]}}))})));var c=this;(0,d.default)(this,"getFilter",(0,i.default)((function(){var e,t,r;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:j("Getting filter..."),e=c.opts.filter?c.opts.filter:c.buildDefaultFilter(),n.label=1;case 1:return n.trys.push([1,3,,5]),[4,c.client.getOrCreateFilter(U(c.client.credentials.userId),e)];case 2:return t=n.sent(),[3,5];case 3:return r=n.sent(),y.logger.error("Getting filter failed",r),c.shouldAbortSync(r)?[2,{}]:(j("Waiting for saved sync before retrying filter..."),[4,c.recoverFromSyncStartupError(c.savedSyncPromise,r)]);case 4:return n.sent(),[2,c.getFilter()];case 5:return[2,{filter:e,filterId:t}]}}))}))),(0,d.default)(this,"savedSyncPromise",void 0),(0,d.default)(this,"onOnline",(function(){j("Browser thinks we are back online"),a.startKeepAlives(0)})),this.opts=N(r),this.syncOpts=B(n),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[h.RoomEvent.Timeline,h.RoomEvent.TimelineReset])}return(0,a.default)(e,[{key:"createRoom",value:function(e){var t=this,r=q(this.client,e,this.opts);return r.on(E.RoomStateEvent.Marker,(function(e,n){t.onMarkerStateEvent(r,e,n)})),r}},{key:"onMarkerStateEvent",value:function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).timelineWasEmpty;if(r)y.logger.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh.");else{var n=L.includes(e.getVersion())||t.getSender()===e.getCreator();n?(y.logger.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(t.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(h.RoomEvent.HistoryImportedWithinTimeline,t,e)):y.logger.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}}},{key:"syncLeftRooms",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,o,a,s,u,c;return(0,l.__generator)(this,(function(d){switch(d.label){case 0:return r=e.client,(n=new v.Filter(e.client.credentials.userId)).setTimelineLimit(1),n.setIncludeLeaveRooms(!0),o=e.opts.pollTimeout+8e4,[4,r.getOrCreateFilter(U(r.credentials.userId,"LEFT_ROOMS"),n)];case 1:return a=d.sent(),s={timeout:0,filter:a},[4,r.http.authedRequest(w.Method.Get,"/sync",s,void 0,{localTimeoutMs:o})];case 2:return u=d.sent(),c=[],null!==(t=u.rooms)&&void 0!==t&&t.leave&&(c=e.mapSyncResponseToRoomArray(u.rooms.leave)),[4,Promise.all(c.map((f=(0,i.default)((function(t){var n,i,o;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:return n=t.room,t.isBrandNewRoom?(t.timeline=t.timeline||{prev_batch:null,events:[]},i=e.mapSyncEventsFormat(t.timeline,n),o=e.mapSyncEventsFormat(t.state,n),n.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,g.EventTimeline.BACKWARDS),[4,e.injectRoomEvents(n,o,i)]):[2];case 1:return a.sent(),n.recalculate(),r.store.storeRoom(n),r.emit(_.ClientEvent.Room,n),e.processEventsForNotifs(n,i),[2,n]}}))})),function(e){return f.apply(this,arguments)})))];case 3:return[2,d.sent().filter(Boolean)]}var f}))}))()}},{key:"peek",value:function(e){var t,r=this;if((null===(t=this._peekRoom)||void 0===t?void 0:t.roomId)===e)return Promise.resolve(this._peekRoom);var n=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((function(e){e.messages=e.messages||{chunk:[]},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];var t=p.deepCopy(e.state).map(n.getEventMapper()),i=e.state.map(n.getEventMapper()),o=e.messages.chunk.map(n.getEventMapper());return Array.isArray(e.presence)&&e.presence.map(n.getEventMapper()).forEach((function(e){var t=n.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=K(n,e.getContent().user_id)).setPresenceEvent(e),n.store.storeUser(t)),n.emit(_.ClientEvent.Event,e)})),e.messages.start&&(r._peekRoom.oldState.paginationToken=e.messages.start),r._peekRoom.oldState.setStateEvents(t),r._peekRoom.currentState.setStateEvents(i),r.resolveInvites(r._peekRoom),r._peekRoom.recalculate(),r._peekRoom.addEventsToTimeline(o.reverse(),!0,r._peekRoom.getLiveTimeline(),e.messages.start),n.store.storeRoom(r._peekRoom),n.emit(_.ClientEvent.Room,r._peekRoom),r.peekPoll(r._peekRoom),r._peekRoom}))}},{key:"stopPeeking",value:function(){this._peekRoom=null}},{key:"peekPoll",value:function(e,t){var r,n=this;this._peekRoom===e?this.client.http.authedRequest(w.Method.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,{localTimeoutMs:5e4,abortSignal:null===(r=this.abortController)||void 0===r?void 0:r.signal}).then((function(t){if(n._peekRoom===e){t.chunk.filter((function(e){return"m.presence"===e.type})).map(n.client.getEventMapper()).forEach((function(e){var t=n.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=K(n.client,e.getContent().user_id)).setPresenceEvent(e),n.client.store.storeUser(t)),n.client.emit(_.ClientEvent.Event,e)}));var r=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(n.client.getEventMapper());e.addLiveEvents(r),n.peekPoll(e,t.end)}else j("Stopped peeking in room %s",e.roomId)}),(function(r){y.logger.error("[%s] Peek poll failed: %s",e.roomId,r),setTimeout((function(){n.peekPoll(e,t)}),3e4)})):j("Stopped peeking in room %s",e.roomId)}},{key:"getSyncState",value:function(){return this.syncState}},{key:"getSyncStateData",value:function(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}},{key:"recoverFromSyncStartupError",value:function(e,t){var r=this;return(0,i.default)((function(){var n;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,e];case 1:return i.sent(),n=r.startKeepAlives(),r.updateSyncState(O.Error,{error:t}),[4,n];case 2:return i.sent(),[2]}}))}))()}},{key:"wasLazyLoadingToggled",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;return(0,i.default)((function(){var r,n;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return r=!1,[4,t.client.store.isNewlyCreated()];case 1:return i.sent()?[3,3]:[4,t.client.store.getClientOptions()];case 2:return(n=i.sent())&&(r=!!n.lazyLoadMembers),[2,r!==e];case 3:return[2,!1]}}))}))()}},{key:"shouldAbortSync",value:function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(y.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(O.Error,{error:e}),!0)}},{key:"sync",value:function(){var e=this;return(0,i.default)((function(){var t,n,i,o,a,s,u,c,d;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return e.running=!0,e.abortController=new AbortController,null===(t=r.window)||void 0===t||null===(n=t.addEventListener)||void 0===n||n.call(t,"online",e.onOnline,!1),e.client.isGuest()?[2,e.doSync({})]:(j("Getting saved sync token..."),i=e.client.store.getSavedSyncToken().then((function(e){return j("Got saved sync token"),e})),e.savedSyncPromise=e.client.store.getSavedSync().then((function(t){if(j("Got reply from saved sync, exists? ".concat(!!t)),t)return e.syncFromCache(t)})).catch((function(e){y.logger.error("Getting saved sync failed",e)})),[4,e.getPushRules()]);case 1:return l.sent(),[4,e.checkLazyLoadStatus()];case 2:return l.sent(),[4,e.getFilter()];case 3:return o=l.sent(),a=o.filterId,(s=o.filter)?(e.client.resetNotifTimelineSet(),e.currentSyncRequest?[3,5]:(u=a,[4,i])):[2];case 4:(c=l.sent())?j("Sending first sync request..."):(j("Sending initial sync request..."),(d=e.buildDefaultFilter()).setDefinition(s.getDefinition()),d.setTimelineLimit(e.opts.initialSyncLimit),u=JSON.stringify(d.getDefinition())),e.currentSyncRequest=e.doSyncRequest({filter:u},c),l.label=5;case 5:return j("Waiting for saved sync before starting sync processing..."),[4,e.savedSyncPromise];case 6:return l.sent(),[2,e.doSync({filter:a})]}}))}))()}},{key:"stop",value:function(){var e,t,n;j("SyncApi.stop"),null===(e=r.window)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.running=!1,null===(n=this.abortController)||void 0===n||n.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}},{key:"retryImmediately",value:function(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}},{key:"syncFromCache",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:j("sync(): not doing HTTP hit, instead returning stored /sync data"),r=e.nextBatch,t.client.store.setSyncToken(r),n={nextSyncToken:r,catchingUp:!1,fromCache:!0},i={next_batch:r,rooms:e.roomsData,account_data:{events:e.accountData}},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.processSyncResponse(n,i)];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),y.logger.error("Error processing cached sync",o),[3,4];case 4:return t.storeIsInvalid||t.updateSyncState(O.Prepared,n),[2]}}))}))()}},{key:"doSync",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a;return(0,l.__generator)(this,(function(s){switch(s.label){case 0:if(!t.running)return[3,18];r=t.client.store.getSyncToken(),s.label=1;case 1:return s.trys.push([1,3,5,6]),t.currentSyncRequest||(t.currentSyncRequest=t.doSyncRequest(e,r)),[4,t.currentSyncRequest];case 2:return n=s.sent(),[3,6];case 3:return i=s.sent(),[4,t.onSyncError(i)];case 4:return s.sent()?[2]:[3,0];case 5:return t.currentSyncRequest=void 0,[7];case 6:return t.client.store.setSyncToken(n.next_batch),t.failedSyncCount=0,[4,t.client.store.setSyncData(n)];case 7:return s.sent(),o={oldSyncToken:null!=r?r:void 0,nextSyncToken:n.next_batch,catchingUp:t.catchingUp},t.syncOpts.crypto?[4,t.syncOpts.crypto.onSyncWillProcess(o)]:[3,9];case 8:s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,t.processSyncResponse(o,n)];case 10:return s.sent(),[3,12];case 11:return a=s.sent(),y.logger.error("Caught /sync error",a),t.client.emit(_.ClientEvent.SyncUnexpectedError,a),[3,12];case 12:return o.catchingUp=t.catchingUp,e.hasSyncedBefore||(t.updateSyncState(O.Prepared,o),e.hasSyncedBefore=!0),t.syncOpts.cryptoCallbacks?[4,t.syncOpts.cryptoCallbacks.onSyncCompleted(o)]:[3,14];case 13:s.sent(),s.label=14;case 14:return t.updateSyncState(O.Syncing,o),t.client.store.wantsSave()?t.syncOpts.crypto?[4,t.syncOpts.crypto.saveDeviceList(0)]:[3,16]:[3,17];case 15:s.sent(),s.label=16;case 16:t.client.store.save(),s.label=17;case 17:return[3,0];case 18:return t.running||(j("Sync no longer running: exiting."),t.connectionReturnedDefer&&(t.connectionReturnedDefer.reject(),t.connectionReturnedDefer=void 0),t.updateSyncState(O.Stopped)),[2]}}))}))()}},{key:"doSyncRequest",value:function(e,t){var r,n=this.getSyncParams(e,t);return this.client.http.authedRequest(w.Method.Get,"/sync",n,void 0,{localTimeoutMs:n.timeout+8e4,abortSignal:null===(r=this.abortController)||void 0===r?void 0:r.signal})}},{key:"getSyncParams",value:function(e,t){var r=this.opts.pollTimeout;(this.getSyncState()!==O.Syncing||this.catchingUp)&&(this.catchingUp=!0,r=0);var n=e.filter;this.client.isGuest()&&!n&&(n=this.getGuestFilter());var i={filter:n,timeout:r};return this.opts.disablePresence&&(i.set_presence=D.Offline),t?i.since=t:i._cacheBuster=Date.now(),[O.Reconnecting,O.Error].includes(this.getSyncState())&&(i.timeout=0),i}},{key:"onSyncError",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return t.running?(y.logger.error("/sync error %s",e),t.shouldAbortSync(e)?[2,!0]:(t.failedSyncCount++,y.logger.log("Number of consecutive failed sync requests:",t.failedSyncCount),j("Starting keep-alive"),r=t.startKeepAlives(),t.currentSyncRequest=void 0,t.updateSyncState(t.failedSyncCount>=3?O.Error:O.Reconnecting,{error:e}),[4,r])):(j("Sync no longer running: exiting"),t.connectionReturnedDefer&&(t.connectionReturnedDefer.reject(),t.connectionReturnedDefer=void 0),t.updateSyncState(O.Stopped),[2,!0]);case 1:return n.sent()&&t.getSyncState()===O.Error&&t.updateSyncState(O.Catchup,{catchingUp:!0}),[2,!1]}}))}))()}},{key:"processSyncResponse",value:function(e,t){var r=this;return(0,i.default)((function(){var n,o,a,u,c,d,f,v,b,w,E,k;return(0,l.__generator)(this,(function(M){switch(M.label){case 0:return a=r.client,Array.isArray(null===(n=t.presence)||void 0===n?void 0:n.events)&&t.presence.events.map(a.getEventMapper()).forEach((function(e){var t=a.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=K(a,e.getSender())).setPresenceEvent(e),a.store.storeUser(t)),a.emit(_.ClientEvent.Event,e)})),Array.isArray(null===(o=t.account_data)||void 0===o?void 0:o.events)&&(u=t.account_data.events.map(a.getEventMapper()),c=u.reduce((function(e,t){return e[t.getType()]=a.store.getAccountData(t.getType()),e}),{}),a.store.storeAccountDataEvents(u),u.forEach((function(e){if(e.getType()===S.EventType.PushRules){var t=e.getContent();a.pushRules=m.PushProcessor.rewriteDefaultRules(t)}var r=c[e.getType()];return a.emit(_.ClientEvent.AccountData,e,r),e}))),t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0?(d=t.to_device.events,r.syncOpts.cryptoCallbacks?[4,r.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(d)]:[3,2]):[3,3];case 1:d=M.sent(),M.label=2;case 2:return f=[],d.map(a.getEventMapper({toDevice:!0})).map((function(e){if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&f.push(t)}return e})).forEach((function(e){var t=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=t.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var r=t.transaction_id;f.includes(r)&&e.flagCancelled()}a.emit(_.ClientEvent.ToDeviceEvent,e)}else y.logger.log("Ignoring undecryptable to-device event from "+e.getSender())})),[3,4];case 3:r.catchingUp=!1,M.label=4;case 4:return v=[],b=[],w=[],t.rooms&&(t.rooms.invite&&(v=r.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(b=r.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(w=r.mapSyncResponseToRoomArray(t.rooms.leave))),r.notifEvents=[],[4,p.promiseMapSeries(v,(I=(0,i.default)((function(e){var t,n,i,o,s,u,c,d,f,h,p,v;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return n=e.room,i=r.mapSyncEventsFormat(e.invite_state,n),[4,r.injectRoomEvents(n,i)];case 1:return l.sent(),o=null===(t=n.currentState.getStateEvents(S.EventType.RoomMember,a.getUserId()))||void 0===t?void 0:t.getSender(),a.isCryptoEnabled()?[4,a.crypto.cryptoStore.takeParkedSharedHistory(n.roomId)]:[3,10];case 2:s=l.sent(),u=!0,c=!1,d=void 0,l.label=3;case 3:l.trys.push([3,8,9,10]),f=s[Symbol.iterator](),l.label=4;case 4:return(u=(h=f.next()).done)?[3,7]:(p=h.value).senderId!==o?[3,6]:[4,a.crypto.olmDevice.addInboundGroupSession(n.roomId,p.senderKey,p.forwardingCurve25519KeyChain,p.sessionId,p.sessionKey,p.keysClaimed,!0,{sharedHistory:!0,untrusted:!0})];case 5:l.sent(),l.label=6;case 6:return u=!0,[3,4];case 7:return[3,10];case 8:return v=l.sent(),c=!0,d=v,[3,10];case 9:try{u||null==f.return||f.return()}finally{if(c)throw d}return[7];case 10:return e.isBrandNewRoom?(n.recalculate(),a.store.storeRoom(n),a.emit(_.ClientEvent.Room,n)):n.recalculate(),i.forEach((function(e){a.emit(_.ClientEvent.Event,e)})),[2]}}))})),function(e){return I.apply(this,arguments)}))];case 5:return M.sent(),[4,p.promiseMapSeries(b,function(){var t=(0,i.default)((function(t){var n,i,o,u,c,d,f,p,v,m,b,w,E,k,M,I,T,R,x,O,A,D,P,L,U,N,B,F,K,q,W,V,H,G;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(i=t.room,o=r.mapSyncEventsFormat(t.state,i),u=r.mapSyncEventsFormat(t.timeline,i,!1),c=r.mapSyncEventsFormat(t.ephemeral),d=r.mapSyncEventsFormat(t.account_data),f=a.isRoomEncrypted(i.roomId),t.unread_notifications&&(i.setUnreadNotificationCount(h.NotificationCountType.Total,null!==(p=t.unread_notifications.notification_count)&&void 0!==p?p:0),(!f||i.getUnreadNotificationCount(h.NotificationCountType.Highlight)<=0)&&i.setUnreadNotificationCount(h.NotificationCountType.Highlight,null!==(v=t.unread_notifications.highlight_count)&&void 0!==v?v:0)),m=null!==(n=t[C.UNREAD_THREAD_NOTIFICATIONS.name])&&void 0!==n?n:t[C.UNREAD_THREAD_NOTIFICATIONS.altName]){i.resetThreadUnreadNotificationCount(Object.keys(m)),b=!0,w=!1,E=void 0;try{for(k=Object.entries(m)[Symbol.iterator]();!(b=(M=k.next()).done);b=!0)I=(0,s.default)(M.value,2),T=I[0],R=I[1],i.setThreadUnreadNotificationCount(T,h.NotificationCountType.Total,null!==(x=R.notification_count)&&void 0!==x?x:0),O=i.getThreadUnreadNotificationCount(T,h.NotificationCountType.Highlight)<=0,(!f||f&&O)&&i.setThreadUnreadNotificationCount(T,h.NotificationCountType.Highlight,null!==(A=R.highlight_count)&&void 0!==A?A:0)}catch(e){w=!0,E=e}finally{try{b||null==k.return||k.return()}finally{if(w)throw E}}}else i.resetThreadUnreadNotificationCount();if(t.timeline=t.timeline||{},t.isBrandNewRoom)null!==t.timeline.prev_batch&&i.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,g.EventTimeline.BACKWARDS);else if(t.timeline.limited){for(D=!0,P=u.length-1;P>=0;P--)if(L=u[P].getId(),i.getTimelineForEvent(L)){j("Already have event ".concat(L," in limited sync - not resetting")),D=!1,u.splice(0,P);break}D&&(i.resetLiveTimeline(t.timeline.prev_batch,r.syncOpts.canResetEntireTimeline(i.roomId)?null:null!==(U=e.oldSyncToken)&&void 0!==U?U:null),a.resetNotifTimelineSet())}if(!r.syncOpts.crypto)return[3,8];N=!0,B=!1,F=void 0,l.label=1;case 1:l.trys.push([1,6,7,8]),K=o.concat(u)[Symbol.iterator](),l.label=2;case 2:return(N=(q=K.next()).done)?[3,5]:(W=q.value).isState()&&W.getType()===S.EventType.RoomEncryption&&""===W.getStateKey()?[4,r.syncOpts.crypto.onCryptoEvent(i,W)]:[3,4];case 3:l.sent(),l.label=4;case 4:return N=!0,[3,2];case 5:return[3,8];case 6:return V=l.sent(),B=!0,F=V,[3,8];case 7:try{N||null==K.return||K.return()}finally{if(B)throw F}return[7];case 8:return l.trys.push([8,10,,11]),[4,r.injectRoomEvents(i,o,u,e.fromCache)];case 9:return l.sent(),[3,11];case 10:return H=l.sent(),y.logger.error("Failed to process events on room ".concat(i.roomId,":"),H),[3,11];case 11:return t.summary&&i.setSummary(t.summary),i.addEphemeralEvents(c),i.addAccountData(d),i.recalculate(),t.isBrandNewRoom&&(a.store.storeRoom(i),a.emit(_.ClientEvent.Room,i)),r.processEventsForNotifs(i,u),G=function(e){return a.emit(_.ClientEvent.Event,e)},o.forEach(G),u.forEach(G),c.forEach(G),d.forEach(G),i.decryptCriticalEvents(),[2]}}))}));return function(e){return t.apply(this,arguments)}}())];case 6:return M.sent(),[4,p.promiseMapSeries(w,function(){var e=(0,i.default)((function(e){var t,n,i,o;return(0,l.__generator)(this,(function(s){switch(s.label){case 0:return t=e.room,n=r.mapSyncEventsFormat(e.state,t),i=r.mapSyncEventsFormat(e.timeline,t),o=r.mapSyncEventsFormat(e.account_data),[4,r.injectRoomEvents(t,n,i)];case 1:return s.sent(),t.addAccountData(o),t.recalculate(),e.isBrandNewRoom&&(a.store.storeRoom(t),a.emit(_.ClientEvent.Room,t)),r.processEventsForNotifs(t,i),n.forEach((function(e){a.emit(_.ClientEvent.Event,e)})),i.forEach((function(e){a.emit(_.ClientEvent.Event,e)})),o.forEach((function(e){a.emit(_.ClientEvent.Event,e)})),[2]}}))}));return function(t){return e.apply(this,arguments)}}())];case 7:return M.sent(),e.oldSyncToken&&r.notifEvents.length&&(r.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),r.notifEvents.forEach((function(e){var t;null===(t=a.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e)}))),t.device_lists&&r.syncOpts.crypto?[4,r.syncOpts.crypto.handleDeviceListChanges(e,t.device_lists)]:[3,9];case 8:M.sent(),M.label=9;case 9:return r.syncOpts.crypto&&t.device_one_time_keys_count&&(E=t.device_one_time_keys_count.signed_curve25519||0,r.syncOpts.crypto.updateOneTimeKeyCount(E)),r.syncOpts.crypto&&(t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"])&&(k=t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"],r.syncOpts.crypto.setNeedsNewFallback(Array.isArray(k)&&!k.includes("signed_curve25519"))),[2]}var I}))}))()}},{key:"startKeepAlives",value:function(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=p.defer()),this.connectionReturnedDefer.promise}},{key:"pokeKeepAlive",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this,n=function(){clearTimeout(r.keepAliveTimer),r.connectionReturnedDefer&&(r.connectionReturnedDefer.resolve(t),r.connectionReturnedDefer=void 0)};this.client.http.request(w.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3,abortSignal:null===(e=this.abortController)||void 0===e?void 0:e.signal}).then((function(){n()}),(function(e){400==e.httpStatus||404==e.httpStatus?r.keepAliveTimer=setTimeout(n,2e3):(t=!0,r.keepAliveTimer=setTimeout(r.pokeKeepAlive.bind(r,t),5e3+Math.floor(5e3*Math.random())),r.updateSyncState(O.Error,{error:e}))}))}},{key:"mapSyncResponseToRoomArray",value:function(e){var t=this,r=this.client;return Object.keys(e).map((function(n){var i=e[n],o=r.store.getRoom(n),a=!1;return o||(o=t.createRoom(n),a=!0),i.room=o,i.isBrandNewRoom=a,i}))}},{key:"mapSyncEventsFormat",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!Array.isArray(e.events))return[];var n=this.client.getEventMapper({decrypt:r});return e.events.map((function(e){return t&&(e.room_id=t.roomId),n(e)}))}},{key:"resolveInvites",value:function(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership("invite").forEach((function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var n=t.getUser(r.userId);(n?Promise.resolve({avatar_url:n.avatarUrl,displayname:n.displayName}):t.getProfileInfo(r.userId)).then((function(t){var n=r.events.member;"invite"===(null==n?void 0:n.getContent().membership)&&(n.getContent().avatar_url=t.avatar_url,n.getContent().displayname=t.displayname,r.setMembershipEvent(n,e.currentState))}),(function(e){}))}}))}}},{key:"injectRoomEvents",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this;return(0,i.default)((function(){var i,a,s,u,c,d,f,h;return(0,l.__generator)(this,(function(l){if(i=e.getLiveTimeline(),a=0==i.getEvents().length){s=!0,u=!1,c=void 0;try{for(d=t[Symbol.iterator]();!(s=(f=d.next()).done);s=!0)h=f.value,o.client.getPushActionsForEvent(h)}catch(e){u=!0,c=e}finally{try{s||null==d.return||d.return()}finally{if(u)throw c}}i.initialiseState(t,{timelineWasEmpty:a})}return o.resolveInvites(e),e.recalculate(),a||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(r||[],{fromCache:n,timelineWasEmpty:a}),o.client.processBeaconEvents(e,r),[2]}))}))()}},{key:"processEventsForNotifs",value:function(e,t){var r=!0,n=!1,i=void 0;if(this.client.getNotifTimelineSet())try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s,u=o.value,l=this.client.getPushActionsForEvent(u);null!=l&&l.notify&&null!==(s=l.tweaks)&&void 0!==s&&s.highlight&&this.notifEvents.push(u)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"getGuestFilter",value:function(){return"{}"}},{key:"updateSyncState",value:function(e,t){var r=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(_.ClientEvent.Sync,this.syncState,r,t)}}]),e}();function K(e,t){var r=new f.User(t);return e.reEmitter.reEmit(r,[f.UserEvent.AvatarUrl,f.UserEvent.DisplayName,f.UserEvent.Presence,f.UserEvent.CurrentlyActive,f.UserEvent.LastPresenceTs]),r}function q(e,t,r){var n=e.timelineSupport,i=new h.Room(t,e,e.getUserId(),{lazyLoadMembers:r.lazyLoadMembers,pendingEventOrdering:r.pendingEventOrdering,timelineSupport:n});return e.reEmitter.reEmit(i,[h.RoomEvent.Name,h.RoomEvent.Redaction,h.RoomEvent.RedactionCancelled,h.RoomEvent.Receipt,h.RoomEvent.Tags,h.RoomEvent.LocalEchoUpdated,h.RoomEvent.AccountData,h.RoomEvent.MyMembership,h.RoomEvent.Timeline,h.RoomEvent.TimelineReset,E.RoomStateEvent.Events,E.RoomStateEvent.Members,E.RoomStateEvent.NewMember,E.RoomStateEvent.Update,M.BeaconEvent.New,M.BeaconEvent.Update,M.BeaconEvent.Destroy,M.BeaconEvent.LivenessChange]),i.on(E.RoomStateEvent.NewMember,(function(t,r,n){var i;n.user=null!==(i=e.getUser(n.userId))&&void 0!==i?i:void 0,e.reEmitter.reEmit(n,[k.RoomMemberEvent.Name,k.RoomMemberEvent.Typing,k.RoomMemberEvent.PowerLevel,k.RoomMemberEvent.Membership])})),i}e.exports.SyncApi=F})),n.register("5xqDi",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("cksMj"),l=n("mBz5n"),c=n("9oGi2"),d=n("giCK6"),f=n("eQNFO"),h=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomNameType=e.exports.RoomEvent=e.exports.Room=e.exports.NotificationCountType=e.exports.KNOWN_SAFE_ROOM_VERSION=void 0;var p=h(n("3rHpI")),v=n("jjL6E"),g=n("aBvOl"),m=n("kMq5l"),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=L(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),b=n("jEuTn"),_=n("8ySly"),w=n("9SRK1"),S=n("da1nQ"),E=n("jtqeE"),k=n("k2cpO"),M=n("8bPbt"),C=n("4uAg3"),I=n("hwbWG"),T=n("bcGqc"),R=n("afpjH"),x=n("1lFBd"),O=n("7Ud45"),A=n("agUax"),D=n("6KBJA"),P=n("8iV7r");function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(L=function(e){return e?r:t})(e)}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,p.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.KNOWN_SAFE_ROOM_VERSION="9";var N,B,F,K,q=["1","2","3","4","5","6","7","8","9"];e.exports.NotificationCountType=N,(B=N||(e.exports.NotificationCountType=N={})).Highlight="highlight",B.Total="total",e.exports.RoomEvent=F,(K=F||(e.exports.RoomEvent=F={})).MyMembership="Room.myMembership",K.Tags="Room.tags",K.AccountData="Room.accountData",K.Receipt="Room.receipt",K.Name="Room.name",K.Redaction="Room.redaction",K.RedactionCancelled="Room.redactionCancelled",K.LocalEchoUpdated="Room.localEchoUpdated",K.Timeline="Room.timeline",K.TimelineReset="Room.timelineReset",K.TimelineRefresh="Room.TimelineRefresh",K.OldStateUpdated="Room.OldStateUpdated",K.CurrentStateUpdated="Room.CurrentStateUpdated",K.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",K.UnreadNotifications="Room.UnreadNotifications";var W,V=function(e){(0,u.default)(n,e);var t=(0,d.default)(n);function n(e,a,s){var u,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,o.default)(this,n),(u=t.call(this)).roomId=e,u.client=a,u.myUserId=s,u.opts=l,(0,p.default)((0,r.default)(u),"reEmitter",void 0),(0,p.default)((0,r.default)(u),"txnToEvent",{}),(0,p.default)((0,r.default)(u),"notificationCounts",{}),(0,p.default)((0,r.default)(u),"threadNotifications",new Map),(0,p.default)((0,r.default)(u),"cachedThreadReadReceipts",new Map),(0,p.default)((0,r.default)(u),"oldestThreadedReceiptTs",1/0),(0,p.default)((0,r.default)(u),"unthreadedReceipts",new Map),(0,p.default)((0,r.default)(u),"timelineSets",void 0),(0,p.default)((0,r.default)(u),"threadsTimelineSets",[]),(0,p.default)((0,r.default)(u),"filteredTimelineSets",{}),(0,p.default)((0,r.default)(u),"timelineNeedsRefresh",!1),(0,p.default)((0,r.default)(u),"pendingEventList",void 0),(0,p.default)((0,r.default)(u),"blacklistUnverifiedDevices",void 0),(0,p.default)((0,r.default)(u),"selfMembership",void 0),(0,p.default)((0,r.default)(u),"summaryHeroes",null),(0,p.default)((0,r.default)(u),"getTypeWarning",!1),(0,p.default)((0,r.default)(u),"getVersionWarning",!1),(0,p.default)((0,r.default)(u),"membersPromise",void 0),(0,p.default)((0,r.default)(u),"name",void 0),(0,p.default)((0,r.default)(u),"normalizedName",void 0),(0,p.default)((0,r.default)(u),"tags",{}),(0,p.default)((0,r.default)(u),"accountData",{}),(0,p.default)((0,r.default)(u),"summary",null),(0,p.default)((0,r.default)(u),"timeline",void 0),(0,p.default)((0,r.default)(u),"oldState",void 0),(0,p.default)((0,r.default)(u),"currentState",void 0),(0,p.default)((0,r.default)(u),"relations",new A.RelationsContainer(u.client,(0,r.default)(u))),(0,p.default)((0,r.default)(u),"threads",new Map),(0,p.default)((0,r.default)(u),"lastThread",void 0),(0,p.default)((0,r.default)(u),"visibilityEvents",new Map),(0,p.default)((0,r.default)(u),"threadTimelineSetsPromise",null),(0,p.default)((0,r.default)(u),"threadsReady",!1),(0,p.default)((0,r.default)(u),"updateThreadRootEvents",(function(e,t,r){var n,i;e.length&&(u.updateThreadRootEvent(null===(n=u.threadsTimelineSets)||void 0===n?void 0:n[0],e,t,r),e.hasCurrentUserParticipated&&u.updateThreadRootEvent(null===(i=u.threadsTimelineSets)||void 0===i?void 0:i[1],e,t,r))})),(0,p.default)((0,r.default)(u),"updateThreadRootEvent",(function(e,t,r,n){e&&t.rootEvent&&(n&&e.removeEvent(t.id),x.Thread.hasServerSideSupport?e.addLiveEvent(t.rootEvent,{duplicateStrategy:v.DuplicateStrategy.Replace,fromCache:!1,roomState:u.currentState}):e.addEventToTimeline(t.rootEvent,e.getLiveTimeline(),{toStartOfTimeline:r}))})),(0,p.default)((0,r.default)(u),"applyRedaction",(function(e){if(e.isRedaction()){var t=e.event.redacts,n=t?u.findEventById(t):void 0;if(n){if(n.makeRedacted(e),n.isState()){var i=u.currentState.getStateEvents(n.getType(),n.getStateKey());(null==i?void 0:i.getId())===n.getId()&&u.currentState.setStateEvents([n])}u.emit(F.Redaction,e,(0,r.default)(u)),u.visibilityEvents.delete(t),n.isVisibilityEvent()&&u.redactVisibilityChangeEvent(e)}}})),u.setMaxListeners(100),u.reEmitter=new k.TypedReEmitter((0,r.default)(u)),l.pendingEventOrdering=l.pendingEventOrdering||C.PendingEventOrdering.Chronological,u.name=e,u.normalizedName=e,u.timelineSets=[new v.EventTimelineSet((0,r.default)(u),l)],u.reEmitter.reEmit(u.getUnfilteredTimelineSet(),[F.Timeline,F.TimelineReset]),u.fixUpLegacyTimelineFields(),u.opts.pendingEventOrdering===C.PendingEventOrdering.Detached&&(u.pendingEventList=[],u.client.store.getPendingEvents(u.roomId).then((function(e){var t,n=u.client.getEventMapper({toDevice:!1,decrypt:!1}),o=(0,r.default)(u);e.forEach((t=(0,i.default)((function(e){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return t=n(e),[4,a.decryptEventIfNeeded(t)];case 1:return r.sent(),t.setStatus(_.EventStatus.NOT_SENT),o.addPendingEvent(t,t.getTxnId()),[2]}}))})),function(e){return t.apply(this,arguments)}))}))),u.opts.lazyLoadMembers?u.membersPromise=void 0:u.membersPromise=Promise.resolve(!1),u}return(0,a.default)(n,[{key:"createThreadsTimelineSets",value:function(){var e=this;return(0,i.default)((function(){var t,r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:if(e.threadTimelineSetsPromise)return[2,e.threadTimelineSetsPromise];if(null===(t=e.client)||void 0===t||!t.supportsExperimentalThreads())return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(x.ThreadFilterType.My)]),[4,e.threadTimelineSetsPromise];case 2:return n=i.sent(),(r=e.threadsTimelineSets).push.apply(r,(0,c.default)(n)),[2,n];case 3:return i.sent(),e.threadTimelineSetsPromise=null,[2,null];case 4:return[2,null]}}))}))()}},{key:"decryptCriticalEvents",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return e.client.isCryptoEnabled()?(t=e.getEventReadUpTo(e.client.getUserId(),!0),r=e.getLiveTimeline().getEvents(),n=r.findIndex((function(e){return e.event.event_id===t})),i=r.slice(n).reverse().map((function(t){return e.client.decryptEventIfNeeded(t,{isRetry:!0})})),[4,Promise.allSettled(i)]):[2];case 1:return o.sent(),[2]}}))}))()}},{key:"decryptAllEvents",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return e.client.isCryptoEnabled()?(t=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map((function(t){return e.client.decryptEventIfNeeded(t,{isRetry:!0})})),[4,Promise.allSettled(t)]):[2];case 1:return r.sent(),[2]}}))}))()}},{key:"getCreator",value:function(){var e,t=this.currentState.getStateEvents(M.EventType.RoomCreate,"");return null!==(e=null==t?void 0:t.getContent().creator)&&void 0!==e?e:null}},{key:"getVersion",value:function(){var e,t=this.currentState.getStateEvents(M.EventType.RoomCreate,"");return t?null!==(e=t.getContent().room_version)&&void 0!==e?e:"1":(this.getVersionWarning||(E.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}},{key:"shouldUpgradeToVersion",value:function(){return q.includes(this.getVersion())?null:"9"}},{key:"getRecommendedVersion",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s,u,l,c;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:return[4,e.client.getCapabilities()];case 1:if(t=d.sent(),!(r=t["m.room_versions"])){r={default:"9",available:{}},n=!0,i=!1,o=void 0;try{for(a=q[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)u=s.value,r.available[u]=C.RoomVersionStability.Stable}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}}return(l=e.checkVersionAgainstCapability(r)).urgent&&l.needsUpgrade?(E.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),[4,e.client.getCapabilities(!0)]):[3,3];case 2:if(c=d.sent(),!(r=c["m.room_versions"]))return E.logger.warn("No room version capability - assuming upgrade required."),[2,l];l=e.checkVersionAgainstCapability(r),d.label=3;case 3:return[2,l]}}))}))()}},{key:"checkVersionAgainstCapability",value:function(e){var t=this.getVersion();E.logger.log("[".concat(this.roomId,"] Current version: ").concat(t)),E.logger.log("[".concat(this.roomId,"] Version capability: "),e);var r={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((function(t){return"stable"===e.available[t]})).includes(t)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?E.logger.warn("URGENT upgrade required on ".concat(this.roomId)):E.logger.warn("Non-urgent upgrade required on ".concat(this.roomId))),r}},{key:"userMayUpgradeRoom",value:function(e){return this.currentState.maySendStateEvent(M.EventType.RoomTombstone,e)}},{key:"getPendingEvents",value:function(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}},{key:"removePendingEvent",value:function(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var t=y.removeElement(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}},{key:"hasPendingEvent",value:function(e){var t,r;return null!==(t=null===(r=this.pendingEventList)||void 0===r?void 0:r.some((function(t){return t.getId()===e})))&&void 0!==t&&t}},{key:"getPendingEvent",value:function(e){var t,r;return null!==(t=null===(r=this.pendingEventList)||void 0===r?void 0:r.find((function(t){return t.getId()===e})))&&void 0!==t?t:null}},{key:"getLiveTimeline",value:function(){return this.getUnfilteredTimelineSet().getLiveTimeline()}},{key:"getLastActiveTimestamp",value:function(){var e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}},{key:"getMyMembership",value:function(){var e;return null!==(e=this.selfMembership)&&void 0!==e?e:"leave"}},{key:"getDMInviter",value:function(){var e,t=this.getMember(this.myUserId);if(t)return t.getDMInviter();if("invite"===this.selfMembership&&2===this.getInvitedAndJoinedMemberCount())return null===(e=this.summaryHeroes)||void 0===e?void 0:e[0]}},{key:"guessDMUserId",value:function(){var e=this,t=this.getMember(this.myUserId);if(t){var r=t.getDMInviter();if(r)return r}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];var n=this.currentState.getMembers().find((function(t){return t.userId!==e.myUserId}));return n?n.userId:this.myUserId}},{key:"getAvatarFallbackMember",value:function(){var e=this;if(!(this.getInvitedAndJoinedMemberCount()>2)){var t=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(t){var r=this.summaryHeroes.map((function(t){return e.getMember(t)})).find((function(e){return!!e}));if(r)return r}var n=this.currentState.getMembers();if(n.length<=2){var i=n.find((function(t){return t.userId!==e.myUserId}));if(i)return i}if(t){var o=this.summaryHeroes.map((function(t){return e.client.getUser(t)})).find((function(e){return!!e}));if(o){var a=new w.RoomMember(this.roomId,o.userId);return a.user=o,a}}}}},{key:"updateMyMembership",value:function(e){var t=this.selfMembership;this.selfMembership=e,t!==e&&("leave"===e&&this.cleanupAfterLeaving(),this.emit(F.MyMembership,this,e,t))}},{key:"loadMembersFromServer",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return t=e.client.store.getSyncToken(),[4,e.client.members(e.roomId,void 0,"leave",null!=t?t:void 0)];case 1:return[2,r.sent().chunk]}}))}))()}},{key:"loadMembers",value:function(){var e=this;return(0,i.default)((function(){var t,r;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return t=!1,[4,e.client.store.getOutOfBandMembers(e.roomId)];case 1:return null===(r=n.sent())||e.client.isCryptoEnabled()&&e.client.isRoomEncrypted(e.roomId)?(t=!0,[4,e.loadMembersFromServer()]):[3,3];case 2:r=n.sent(),E.logger.log("LL: got ".concat(r.length," ")+"members from server for room ".concat(e.roomId)),n.label=3;case 3:return[2,{memberEvents:r.map(e.client.getEventMapper()),fromServer:t}]}}))}))()}},{key:"membersLoaded",value:function(){return!this.opts.lazyLoadMembers||this.currentState.outOfBandMembersReady()}},{key:"loadMembersIfNeeded",value:function(){var e=this;if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var t=this.loadMembers().then((function(t){return e.currentState.setOutOfBandMembers(t.memberEvents),t.fromServer})).catch((function(t){throw e.membersPromise=void 0,e.currentState.markOutOfBandMembersFailed(),t}));return t.then((function(t){if(t){var r=e.currentState.getMembers().filter((function(e){return e.isOutOfBand()})).map((function(e){var t;return null===(t=e.events.member)||void 0===t?void 0:t.event}));return E.logger.log("LL: telling store to write ".concat(r.length)+" members for room ".concat(e.roomId)),e.client.store.setOutOfBandMembers(e.roomId,r).catch((function(e){E.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((function(e){E.logger.error(e)})),this.membersPromise=t,this.membersPromise}},{key:"clearLoadedMembersIfNeeded",value:function(){var e=this;return(0,i.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return e.opts.lazyLoadMembers&&e.membersPromise?[4,e.loadMembersIfNeeded()]:[3,3];case 1:return t.sent(),[4,e.client.store.clearOutOfBandMembers(e.roomId)];case 2:t.sent(),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0,t.label=3;case 3:return[2]}}))}))()}},{key:"cleanupAfterLeaving",value:function(){var e=this;this.clearLoadedMembersIfNeeded().catch((function(t){E.logger.error("error after clearing loaded members from "+"room ".concat(e.roomId," after leaving")),E.logger.log(t)}))}},{key:"refreshLiveTimeline",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s,u;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:return t=e.getLiveTimeline(),r=t.getPaginationToken(g.EventTimeline.FORWARDS),n=t.getPaginationToken(g.EventTimeline.BACKWARDS),i=t.getEvents(),o=i[i.length-1],E.logger.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(t.toString()," ")+"forwardPaginationToken=".concat(r," ")+"backwardPaginationToken=".concat(n)),a=e.getUnfilteredTimelineSet(),o?[3,2]:[4,e.client.getLatestTimeline(a)];case 1:return s=l.sent(),[3,4];case 2:return e.resetLiveTimeline(null,null),e.emit(F.TimelineRefresh,e,a),[4,e.client.getEventTimeline(a,o.getId())];case 3:s=l.sent(),l.label=4;case 4:return!(u=a.getLiveTimeline())||null===u.getPaginationToken(g.Direction.Forward)&&null===u.getPaginationToken(g.Direction.Backward)&&0===u.getEvents().length?(E.logger.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),s.setPaginationToken(r,g.EventTimeline.FORWARDS),a.setLiveTimeline(s),e.fixUpLegacyTimelineFields()):E.logger.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(F.TimelineRefresh,e,a),[2]}}))}))()}},{key:"resetLiveTimeline",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=this.timelineSets[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value.resetLiveTimeline(null!=e?e:void 0,null!=t?t:void 0)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}var s=!0,u=!1,l=void 0;try{for(var c,d=this.threads.values()[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){c.value.resetLiveTimeline(e,t)}}catch(e){u=!0,l=e}finally{try{s||null==d.return||d.return()}finally{if(u)throw l}}this.fixUpLegacyTimelineFields()}},{key:"fixUpLegacyTimelineFields",value:function(){var e=this.oldState,t=this.currentState;this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(g.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(g.EventTimeline.FORWARDS),e!==this.oldState&&this.emit(F.OldStateUpdated,this,e,this.oldState),t!==this.currentState&&(this.emit(F.CurrentStateUpdated,this,t,this.currentState),this.reEmitter.stopReEmitting(t,[T.RoomStateEvent.Events,T.RoomStateEvent.Members,T.RoomStateEvent.NewMember,T.RoomStateEvent.Update,T.RoomStateEvent.Marker,R.BeaconEvent.New,R.BeaconEvent.Update,R.BeaconEvent.Destroy,R.BeaconEvent.LivenessChange]),this.reEmitter.reEmit(this.currentState,[T.RoomStateEvent.Events,T.RoomStateEvent.Members,T.RoomStateEvent.NewMember,T.RoomStateEvent.Update,T.RoomStateEvent.Marker,R.BeaconEvent.New,R.BeaconEvent.Update,R.BeaconEvent.Destroy,R.BeaconEvent.LivenessChange]))}},{key:"hasUnverifiedDevices",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s;return(0,f.__generator)(this,(function(u){switch(u.label){case 0:return e.client.isRoomEncrypted(e.roomId)?[4,e.getEncryptionTargetMembers()]:[2,!1];case 1:t=u.sent(),r=!0,n=!1,i=void 0;try{for(o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)if(s=a.value,e.client.getStoredDevicesForUser(s.userId).some((function(e){return e.isUnverified()})))return[2,!0]}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return[2,!1]}}))}))()}},{key:"getTimelineSets",value:function(){return this.timelineSets}},{key:"getUnfilteredTimelineSet",value:function(){return this.timelineSets[0]}},{key:"getTimelineForEvent",value:function(e){var t=this.findEventById(e),r=this.findThreadForEvent(t);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}},{key:"addTimeline",value:function(){return this.getUnfilteredTimelineSet().addTimeline()}},{key:"setTimelineNeedsRefresh",value:function(e){this.timelineNeedsRefresh=e}},{key:"getTimelineNeedsRefresh",value:function(){return this.timelineNeedsRefresh}},{key:"findEventById",value:function(e){var t=this.getUnfilteredTimelineSet().findEventById(e);if(!t)for(var r=this.getThreads(),n=0;n<r.length;n++){if(t=r[n].findEventById(e))return t}return t}},{key:"getUnreadNotificationCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.Total,t=this.getRoomUnreadNotificationCount(e),r=!0,n=!1,i=void 0;if(this.client.canSupport.get(P.Feature.ThreadUnreadNotifications)!==P.ServerSupport.Unsupported)try{for(var o,a=this.threadNotifications.values()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s,u=o.value;t+=null!==(s=u[e])&&void 0!==s?s:0}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"getUnreadCountForEventContext",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.Total,r=arguments.length>1?arguments[1]:void 0,n=!!r.threadRootId&&!r.isThreadRoot;return null!==(e=n?this.getThreadUnreadNotificationCount(r.threadRootId,t):this.getRoomUnreadNotificationCount(t))&&void 0!==e?e:0}},{key:"getRoomUnreadNotificationCount",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.Total;return null!==(e=this.notificationCounts[t])&&void 0!==e?e:0}},{key:"getThreadUnreadNotificationCount",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.Total;return null!==(t=null===(r=this.threadNotifications.get(e))||void 0===r?void 0:r[n])&&void 0!==t?t:0}},{key:"hasThreadUnreadNotification",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.threadNotifications.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o,a,s=n.value;if((null!==(o=s.highlight)&&void 0!==o?o:0)>0||(null!==(a=s.total)&&void 0!==a?a:0)>0)return!0}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}return!1}},{key:"setThreadUnreadNotificationCount",value:function(e,t,r){var n,i,o=j({highlight:null===(n=this.threadNotifications.get(e))||void 0===n?void 0:n.highlight,total:null===(i=this.threadNotifications.get(e))||void 0===i?void 0:i.total},(0,s.default)({},t,r));this.threadNotifications.set(e,o),this.emit(F.UnreadNotifications,o,e)}},{key:"threadsAggregateNotificationType",get:function(){var e=null,t=!0,r=!1,n=void 0;try{for(var i,o=this.threadNotifications.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a,s,u=i.value;if((null!==(a=u.highlight)&&void 0!==a?a:0)>0)return N.Highlight;(null!==(s=u.total)&&void 0!==s?s:0)>0&&!e&&(e=N.Total)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return e}},{key:"resetThreadUnreadNotificationCount",value:function(e){if(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.threadNotifications[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,l.default)(i.value,1)[0];e.includes(a)||this.threadNotifications.delete(a)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}else this.threadNotifications.clear();this.emit(F.UnreadNotifications)}},{key:"setUnreadNotificationCount",value:function(e,t){this.notificationCounts[e]=t,this.emit(F.UnreadNotifications,this.notificationCounts)}},{key:"setSummary",value:function(e){var t=this,r=e["m.heroes"],n=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(r)&&(this.summaryHeroes=r.filter((function(e){return e!==t.myUserId})))}},{key:"setBlacklistUnverifiedDevices",value:function(e){this.blacklistUnverifiedDevices=e}},{key:"getBlacklistUnverifiedDevices",value:function(){return void 0===this.blacklistUnverifiedDevices?null:this.blacklistUnverifiedDevices}},{key:"getAvatarUrl",value:function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this.currentState.getStateEvents(M.EventType.RoomAvatar,"");if(!o&&!i)return null;var a=o?o.getContent().url:null;return a?(0,m.getHttpUriForMxc)(e,a,t,r,n):null}},{key:"getMxcAvatarUrl",value:function(){var e,t;return(null===(e=this.currentState.getStateEvents(M.EventType.RoomAvatar,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.url)||null}},{key:"getCanonicalAlias",value:function(){var e=this.currentState.getStateEvents(M.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}},{key:"getAltAliases",value:function(){var e=this.currentState.getStateEvents(M.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}},{key:"addEventsToTimeline",value:function(e,t,r,n){r.getTimelineSet().addEventsToTimeline(e,t,r,n)}},{key:"getThread",value:function(e){var t;return null!==(t=this.threads.get(e))&&void 0!==t?t:null}},{key:"getThreads",value:function(){return Array.from(this.threads.values())}},{key:"getMember",value:function(e){return this.currentState.getMember(e)}},{key:"getMembers",value:function(){return this.currentState.getMembers()}},{key:"getJoinedMembers",value:function(){return this.getMembersWithMembership("join")}},{key:"getJoinedMemberCount",value:function(){return this.currentState.getJoinedMemberCount()}},{key:"getInvitedMemberCount",value:function(){return this.currentState.getInvitedMemberCount()}},{key:"getInvitedAndJoinedMemberCount",value:function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}},{key:"getMembersWithMembership",value:function(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}},{key:"getEncryptionTargetMembers",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.loadMembersIfNeeded()];case 1:return r.sent(),t=e.getMembersWithMembership("join"),e.shouldEncryptForInvitedMembers()&&(t=t.concat(e.getMembersWithMembership("invite"))),[2,t]}}))}))()}},{key:"shouldEncryptForInvitedMembers",value:function(){var e,t=this.currentState.getStateEvents(M.EventType.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}},{key:"getDefaultRoomName",value:function(e){return this.calculateRoomName(e,!0)}},{key:"hasMembershipState",value:function(e,t){var r=this.getMember(e);return!!r&&r.membership===t}},{key:"getOrCreateFilteredTimelineSet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.prepopulateTimeline,n=void 0===r||r,i=t.useSyncEvents,o=void 0===i||i,a=t.pendingEvents,s=void 0===a||a;if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var u=Object.assign({filter:e,pendingEvents:s},this.opts),l=new v.EventTimelineSet(this,u);this.reEmitter.reEmit(l,[F.Timeline,F.TimelineReset]),o&&(this.filteredTimelineSets[e.filterId]=l,this.timelineSets.push(l));var c=this.getLiveTimeline();if(n){c.getEvents().forEach((function(e){l.addLiveEvent(e)}));for(var d=c;d.getNeighbouringTimeline(g.EventTimeline.BACKWARDS);)d=d.getNeighbouringTimeline(g.EventTimeline.BACKWARDS);l.getLiveTimeline().setPaginationToken(d.getPaginationToken(g.EventTimeline.BACKWARDS),g.EventTimeline.BACKWARDS)}else if(o){var f=c.getPaginationToken(g.Direction.Forward);l.getLiveTimeline().setPaginationToken(f,g.Direction.Backward)}return l}},{key:"getThreadListFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.ThreadFilterType.All,t=this;return(0,i.default)((function(){var r,n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return r=t.client.getUserId(),n=new I.Filter(r),i={room:{timeline:(0,s.default)({},x.FILTER_RELATED_BY_REL_TYPES.name,[x.THREAD_RELATION_TYPE.name])}},e===x.ThreadFilterType.My&&(i.room.timeline[x.FILTER_RELATED_BY_SENDERS.name]=[r]),n.setDefinition(i),[4,t.client.getOrCreateFilter("THREAD_PANEL_".concat(t.roomId,"_").concat(e),n)];case 1:return o=a.sent(),n.filterId=o,[2,n]}}))}))()}},{key:"createThreadTimelineSet",value:function(e){var t=this;return(0,i.default)((function(){var r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return x.Thread.hasServerSideListSupport?(r=new v.EventTimelineSet(t,j(j({},t.opts),{},{pendingEvents:!1}),void 0,void 0,null!=e?e:x.ThreadFilterType.All),t.reEmitter.reEmit(r,[F.Timeline,F.TimelineReset]),[3,4]):[3,1];case 1:return x.Thread.hasServerSideSupport?[4,t.getThreadListFilter(e)]:[3,3];case 2:return n=i.sent(),r=t.getOrCreateFilteredTimelineSet(n,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1}),[3,4];case 3:r=new v.EventTimelineSet(t,{pendingEvents:!1}),Array.from(t.threads).forEach((function(n){var i=(0,l.default)(n,2)[1];if(0!==i.length){var o=i.timeline.some((function(e){return e.getSender()===t.client.getUserId()}));(e!==x.ThreadFilterType.My||o)&&r.getLiveTimeline().addEvent(i.rootEvent,{toStartOfTimeline:!1})}})),i.label=4;case 4:return[2,r]}}))}))()}},{key:"processThreadRoots",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;g.EventTimeline.setEventMetadata(s,this.currentState,t),this.getThread(s.getId())||this.createThread(s.getId(),s,[],t)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"fetchRoomThreads",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s,u,l,c,d,h,p,m,y,b;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return e.threadsReady||!e.client.supportsExperimentalThreads()?[2]:x.Thread.hasServerSideListSupport?[4,Promise.all([e.fetchRoomThreadList(x.ThreadFilterType.All),e.fetchRoomThreadList(x.ThreadFilterType.My)])]:[3,2];case 1:return f.sent(),[3,5];case 2:return[4,e.getThreadListFilter()];case 3:return t=f.sent(),[4,e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,g.Direction.Backward,t)];case 4:if(r=f.sent(),!(n=r.chunk).length)return[2];i=n.map(e.client.getEventMapper()).sort((function(e,t){var r=e.getServerAggregatedRelation(x.THREAD_RELATION_TYPE.name),n=t.getServerAggregatedRelation(x.THREAD_RELATION_TYPE.name);return r.latest_event.origin_server_ts-n.latest_event.origin_server_ts})),a=e.getLiveTimeline().getState(g.EventTimeline.FORWARDS),s=!0,u=!1,l=void 0;try{for(c=i[Symbol.iterator]();!(s=(d=c.next()).done);s=!0)h=d.value,m={duplicateStrategy:v.DuplicateStrategy.Ignore,fromCache:!1,roomState:a},null===(p=e.threadsTimelineSets[0])||void 0===p||p.addLiveEvent(h,m),null!=(y=h.getServerAggregatedRelation(x.THREAD_RELATION_TYPE.name))&&y.current_user_participated&&(null===(b=e.threadsTimelineSets[1])||void 0===b||b.addLiveEvent(h,m),o=h)}catch(e){u=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(u)throw l}}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),o&&e.client.decryptEventIfNeeded(o),f.label=5;case 5:return e.on(x.ThreadEvent.NewReply,e.onThreadNewReply),e.on(x.ThreadEvent.Delete,e.onThreadDelete),e.threadsReady=!0,[2]}}))}))()}},{key:"fetchRoomThreadList",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,l,c,d,h,p;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return r=e===x.ThreadFilterType.My?t.threadsTimelineSets[1]:t.threadsTimelineSets[0],[4,t.client.createThreadListMessagesRequest(t.roomId,null,void 0,g.Direction.Backward,r.threadListType,r.getFilter())];case 1:if(n=f.sent(),i=n.chunk,o=n.end,r.getLiveTimeline().setPaginationToken(null!=o?o:null,g.Direction.Backward),!i.length)return[2];a=i.map(t.client.getEventMapper()),t.processThreadRoots(a,!0),s=t.getLiveTimeline().getState(g.EventTimeline.FORWARDS),u=!0,l=!1,c=void 0;try{for(d=a[Symbol.iterator]();!(u=(h=d.next()).done);u=!0)p=h.value,r.addLiveEvent(p,{duplicateStrategy:v.DuplicateStrategy.Replace,fromCache:!1,roomState:s})}catch(e){l=!0,c=e}finally{try{u||null==d.return||d.return()}finally{if(l)throw c}}return[2]}}))}))()}},{key:"onThreadNewReply",value:function(e){this.updateThreadRootEvents(e,!1,!0)}},{key:"onThreadDelete",value:function(e){var t;this.threads.delete(e.id);var r=this.getTimelineForEvent(e.id),n=null==r||null===(t=r.getEvents())||void 0===t?void 0:t.find((function(t){return t.getId()===e.id}));n?e.clearEventMetadata(n):E.logger.debug("onThreadDelete: Could not find root event in room timeline");var i=!0,o=!1,a=void 0;try{for(var s,u=this.threadsTimelineSets[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){s.value.removeEvent(e.id)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}},{key:"removeFilteredTimelineSet",value:function(e){var t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var r=this.timelineSets.indexOf(t);r>-1&&this.timelineSets.splice(r,1)}},{key:"eventShouldLiveIn",value:function(e,t,r){var n,i;if(null===(n=this.client)||void 0===n||!n.supportsExperimentalThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||null!=r&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};if(e.isRelation(x.THREAD_RELATION_TYPE.name))return{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:e.threadRootId};var o=e.getAssociatedId(),a=null!==(i=this.findEventById(o))&&void 0!==i?i:null==t?void 0:t.find((function(e){return e.getId()===o}));return a&&(e.isRelation()||e.isRedaction())?this.eventShouldLiveIn(a,t,r):null!=r&&r.has(e.relationEventId)?{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.relationEventId}:{shouldLiveInRoom:!0,shouldLiveInThread:!1}}},{key:"findThreadForEvent",value:function(e){if(!e)return null;var t=this.eventShouldLiveIn(e).threadId;return t?this.getThread(t):null}},{key:"addThreadedEvents",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.getThread(e);if(!n){var i,o=null!==(i=this.findEventById(e))&&void 0!==i?i:t.find((function(t){return t.getId()===e}));n=this.createThread(e,o,t,r)}n.addEvents(t,r)}},{key:"processThreadedEvents",value:function(e,t){var r=this;e.forEach(this.applyRedaction);var n={},i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c,d=s.value,f=this.eventShouldLiveIn(d),h=f.threadId;f.shouldLiveInThread&&!n[h]&&(n[h]=[]),null===(c=n[h])||void 0===c||c.push(d)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}Object.entries(n).map((function(e){var n=(0,l.default)(e,2),i=n[0],o=n[1];return r.addThreadedEvents(i,o,t)}))}},{key:"createThread",value:function(e,t){var r,n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(t){var s=this.relations.getAllChildEventsForEvent(t.getId());null!=s&&s.length&&(o=o.concat(s.filter((function(e){return!e.isRelation(M.RelationType.Replace)}))))}var u=new x.Thread(e,t,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:null!==(r=this.cachedThreadReadReceipts.get(e))&&void 0!==r?r:[]});this.cachedThreadReadReceipts.delete(e),u.addEvents(o,!1),this.threads.set(u.id,u),this.reEmitter.reEmit(u,[x.ThreadEvent.Delete,x.ThreadEvent.Update,x.ThreadEvent.NewReply,F.Timeline,F.TimelineReset]);var l=(null===(n=this.lastThread)||void 0===n?void 0:n.rootEvent)&&(null==t?void 0:t.localTimestamp)&&(null===(i=this.lastThread.rootEvent)||void 0===i?void 0:i.localTimestamp)<(null==t?void 0:t.localTimestamp);return this.lastThread&&!l||(this.lastThread=u),this.threadsReady&&this.updateThreadRootEvents(u,a,!1),this.emit(x.ThreadEvent.New,u,a),u}},{key:"processLiveEvent",value:function(e){if(this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId)for(var t in this.txnToEvent){if(this.txnToEvent[t].getId()===e.getId()){E.logger.debug("processLiveEvent: found sent event without txn ID: ",t,e.getId());var r=e.getUnsigned();r.transaction_id=t,e.setUnsigned(r);break}}}},{key:"addLiveEvent",value:function(e,t){var r=t.duplicateStrategy,n=t.timelineWasEmpty,i=t.fromCache,o=!0,a=!1,s=void 0;try{for(var u,l=this.timelineSets[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){u.value.addLiveEvent(e,{duplicateStrategy:r,fromCache:i,timelineWasEmpty:n})}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}e.sender&&e.getType()!==M.EventType.RoomRedaction&&this.addReceipt((0,D.synthesizeReceipt)(e.sender.userId,e,O.ReceiptType.Read),!0)}},{key:"addPendingEvent",value:function(e,t){if(e.status!==_.EventStatus.SENDING&&e.status!==_.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);g.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(g.EventTimeline.FORWARDS),!1),this.txnToEvent[t]=e;var r=!0,n=!1,i=void 0;if(this.pendingEventList){if(this.pendingEventList.some((function(e){return e.status===_.EventStatus.NOT_SENT}))&&(E.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(_.EventStatus.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var o=e.event.redacts,a=this.pendingEventList.find((function(e){return e.getId()===o}));!a&&o&&(a=this.findEventById(o)),a&&(a.markLocallyRedacted(e),this.emit(F.Redaction,e,this))}}else try{for(var s,u=this.timelineSets[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;l.getFilter()?l.getFilter().filterRoomTimeline([e]).length&&l.addEventToTimeline(e,l.getLiveTimeline(),{toStartOfTimeline:!1}):l.addEventToTimeline(e,l.getLiveTimeline(),{toStartOfTimeline:!1})}}catch(e){n=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(n)throw i}}this.emit(F.LocalEchoUpdated,e,this)}},{key:"savePendingEvents",value:function(){var e=this;if(this.pendingEventList){var t=this.pendingEventList.map((function(e){return j(j({},e.event),{},{txn_id:e.getTxnId()})})).filter((function(t){var r=t.type===M.EventType.RoomMessageEncrypted,n=e.client.isRoomEncrypted(e.roomId);return r||!n}));this.client.store.setPendingEvents(this.roomId,t)}}},{key:"aggregateNonLiveRelation",value:function(e){this.relations.aggregateChildEvent(e)}},{key:"getEventForTxnId",value:function(e){return this.txnToEvent[e]}},{key:"handleRemoteEcho",value:function(e,t){var r=t.getId(),n=e.getId(),i=t.status;E.logger.debug("Got remote echo for event ".concat(r," -> ").concat(n," old status ").concat(i)),delete this.txnToEvent[e.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(r),t.handleRemoteEcho(e.event);var o=this.eventShouldLiveIn(e),a=o.shouldLiveInRoom,s=o.threadId,u=s?this.getThread(s):null;null==u||u.timelineSet.handleRemoteEcho(t,r,n);var l=!0,c=!1,d=void 0;if(a)try{for(var f,h=this.timelineSets[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){f.value.handleRemoteEcho(t,r,n)}}catch(e){c=!0,d=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw d}}this.emit(F.LocalEchoUpdated,t,this,r,i)}},{key:"updatePendingEvent",value:function(e,t,r){if(E.logger.log("setting pendingEvent status to ".concat(t," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(r)),t==_.EventStatus.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==_.EventStatus.SENT&&this.getTimelineForEvent(r)){var n=this.findEventById(r);if(!(null==n?void 0:n.getUnsigned().transaction_id)&&n){var i=n.getUnsigned();i.transaction_id=e.getTxnId(),n.setUnsigned(i),this.removeEvent(n.getId()),this.handleRemoteEcho(n,e)}return}var o=e.status,a=e.getId();if(!o)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var s=z[o];if(null==s||!s.includes(t))throw new Error("Invalid EventStatus transition ".concat(o,"->").concat(t));if(e.setStatus(t),t==_.EventStatus.SENT){e.replaceLocalEventId(r);var u=this.eventShouldLiveIn(e),l=u.shouldLiveInRoom,c=u.threadId,d=c?this.getThread(c):void 0;null==d||d.timelineSet.replaceEventId(a,r);var f=!0,h=!1,p=void 0;if(l)try{for(var v,g=this.timelineSets[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){v.value.replaceEventId(a,r)}}catch(e){h=!0,p=e}finally{try{f||null==g.return||g.return()}finally{if(h)throw p}}}else if(t==_.EventStatus.CANCELLED){if(this.pendingEventList){var m=this.getPendingEvent(a);this.removePendingEvent(a),null!=m&&m.isRedaction()&&this.revertRedactionLocalEcho(m)}this.removeEvent(a)}this.savePendingEvents(),this.emit(F.LocalEchoUpdated,e,this,a,o)}},{key:"revertRedactionLocalEcho",value:function(e){var t=e.event.redacts;if(t){var r=this.getUnfilteredTimelineSet().findEventById(t);r&&(r.unmarkLocallyRedacted(),this.emit(F.RedactionCancelled,e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}}},{key:"addLiveEvents",value:function(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this,a=t,s=!1;if("object"==typeof t?(a=(r=t).duplicateStrategy,i=void 0!==(n=r.fromCache)&&n,s=r.timelineWasEmpty):void 0!==t&&E.logger.warn("Overload deprecated: `Room.addLiveEvents(events, duplicateStrategy?, fromCache?)` is deprecated in favor of the overload with `Room.addLiveEvents(events, IAddLiveEventOptions)`"),a&&-1===["replace","ignore"].indexOf(a))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(var u=0;u<this.timelineSets.length;u++){var c=this.timelineSets[u].getLiveTimeline();if(c.getPaginationToken(g.EventTimeline.FORWARDS))throw new Error("live timeline "+u+" is no longer live - it has a pagination token ("+c.getPaginationToken(g.EventTimeline.FORWARDS)+")");if(c.getNeighbouringTimeline(g.EventTimeline.FORWARDS))throw new Error("live timeline ".concat(u," is no longer live - it has a neighbouring timeline"))}var d=this.findThreadRoots(e),f={},h={duplicateStrategy:a,fromCache:i,timelineWasEmpty:s},p=!0,v=!1,m=void 0;try{for(var y,b=e[Symbol.iterator]();!(p=(y=b.next()).done);p=!0){var _,w=y.value;if(this.processLiveEvent(w),w.getUnsigned().transaction_id){var S=this.txnToEvent[w.getUnsigned().transaction_id];if(S){this.handleRemoteEcho(w,S);continue}}var k=this.eventShouldLiveIn(w,e,d),M=k.shouldLiveInRoom,C=k.shouldLiveInThread,I=k.threadId;C&&!f[null!=I?I:""]&&(f[null!=I?I:""]=[]),null===(_=f[null!=I?I:""])||void 0===_||_.push(w),M&&this.addLiveEvent(w,h)}}catch(e){v=!0,m=e}finally{try{p||null==b.return||b.return()}finally{if(v)throw m}}Object.entries(f).forEach((function(e){var t=(0,l.default)(e,2),r=t[0],n=t[1];o.addThreadedEvents(r,n,!1)}))}},{key:"partitionThreadedEvents",value:function(e){var t=this;if(this.client.supportsExperimentalThreads()){var r=this.findThreadRoots(e);return e.reduce((function(n,i){var o=t.eventShouldLiveIn(i,e,r),a=o.shouldLiveInRoom,s=o.shouldLiveInThread,u=o.threadId;return a&&n[0].push(i),s&&(i.setThreadId(null!=u?u:""),n[1].push(i)),n}),[[],[]])}return[e,[]]}},{key:"findThreadRoots",value:function(e){var t=new Set,r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s,u=o.value;if(u.isRelation(x.THREAD_RELATION_TYPE.name))t.add(null!==(s=u.relationEventId)&&void 0!==s?s:"")}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"addReceipt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this,n=e.getContent();Object.keys(n).forEach((function(e){Object.keys(n[e]).forEach((function(i){Object.keys(n[e][i]).forEach((function(o){var a,s,u,l,d=n[e][i][o],f=!d.thread_id||d.thread_id===O.MAIN_ROOM_TIMELINE,h=f?r:r.threads.get(null!==(a=d.thread_id)&&void 0!==a?a:"");h?h.addReceiptToStructure(e,i,o,d,t):r.cachedThreadReadReceipts.set(d.thread_id,(0,c.default)(null!==(l=r.cachedThreadReadReceipts.get(d.thread_id))&&void 0!==l?l:[]).concat([{eventId:e,receiptType:i,userId:o,receipt:d,synthetic:t}]));o===r.client.getUserId()&&!f&&d.ts<r.oldestThreadedReceiptTs&&(r.oldestThreadedReceiptTs=d.ts),!d.thread_id&&d.ts>(null!==(s=null===(u=r.unthreadedReceipts.get(o))||void 0===u?void 0:u.ts)&&void 0!==s?s:0)&&r.unthreadedReceipts.set(o,d)}))}))})),this.emit(F.Receipt,e,this)}},{key:"addEphemeralEvents",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a.getType()===M.EventType.Typing?this.currentState.setTypingEvent(a):a.getType()===M.EventType.Receipt&&this.addReceipt(a)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"removeEvents",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.removeEvent(a)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"removeEvent",value:function(e){var t=!1,r=!0,n=!1,i=void 0;try{for(var o,a=this.timelineSets[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value.removeEvent(e);s&&(s.isRedaction()&&this.revertRedactionLocalEcho(s),t=!0)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"recalculate",value:function(){var e=this,t=this.currentState.getStateEvents(M.EventType.RoomMember,this.myUserId);if(t){var r=t.getContent().membership;if(this.updateMyMembership(r),"invite"===r)(t.getUnsigned().invite_room_state||[]).forEach((function(t){e.currentState.getStateEvents(t.type,t.state_key)||e.currentState.setStateEvents([new b.MatrixEvent({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}))}var n=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,y.normalize)(this.name),this.summary=new S.RoomSummary(this.roomId,{title:this.name}),n!==this.name&&this.emit(F.Name,this)}},{key:"addTags",value:function(e){this.tags=e.getContent().tags||{},this.emit(F.Tags,e,this)}},{key:"addAccountData",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;"m.tag"===a.getType()&&this.addTags(a);var s=this.accountData[a.getType()];this.accountData[a.getType()]=a,this.emit(F.AccountData,a,this,s)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"getAccountData",value:function(e){return this.accountData[e]}},{key:"maySendMessage",value:function(){return"join"===this.getMyMembership()&&(this.client.isRoomEncrypted(this.roomId)?this.currentState.maySendEvent(M.EventType.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(M.EventType.RoomMessage,this.myUserId))}},{key:"canInvite",value:function(e){var t="join"===this.getMyMembership(),r=this.currentState.getStateEvents(M.EventType.RoomPowerLevels,""),n=r&&r.getContent(),i=this.getMember(e);return n&&i&&n.invite>i.powerLevel&&(t=!1),t}},{key:"getJoinRule",value:function(){return this.currentState.getJoinRule()}},{key:"getHistoryVisibility",value:function(){return this.currentState.getHistoryVisibility()}},{key:"getGuestAccess",value:function(){return this.currentState.getGuestAccess()}},{key:"getType",value:function(){var e=this.currentState.getStateEvents(M.EventType.RoomCreate,"");if(e)return e.getContent()[M.RoomCreateTypeField];this.getTypeWarning||(E.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}},{key:"isSpaceRoom",value:function(){return this.getType()===M.RoomType.Space}},{key:"isCallRoom",value:function(){return this.getType()===M.RoomType.UnstableCall}},{key:"isElementVideoRoom",value:function(){return this.getType()===M.RoomType.ElementVideo}},{key:"findPredecessorRoomId",value:function(){var e=this.getLiveTimeline().getState(g.EventTimeline.FORWARDS);if(!e)return null;var t=e.getStateEvents(M.EventType.RoomCreate,"");if(t){var r=t.getContent().predecessor;if(r){var n=r.room_id;if(n)return n}}return null}},{key:"roomNameGenerator",value:function(e){if(this.client.roomNameGenerator){var t=this.client.roomNameGenerator(this.roomId,e);if(null!==t)return t}switch(e.type){case H.Actual:return e.name;case H.Generated:return"Inviting"===e.subtype?"Inviting ".concat(Y(e.names,e.count)):Y(e.names,e.count);case H.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}},{key:"calculateRoomName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;if(!t){var n=this.currentState.getStateEvents(M.EventType.RoomName,"");if(null!=n&&n.getContent().name)return this.roomNameGenerator({type:H.Actual,name:n.getContent().name})}var i=this.getCanonicalAlias();if(i)return this.roomNameGenerator({type:H.Actual,name:i});var o=this.currentState.getJoinedMemberCount(),a=this.currentState.getInvitedMemberCount(),s=o+a-1,u=[],l=this.currentState.getStateEvents(M.UNSTABLE_ELEMENT_FUNCTIONAL_USERS.name,"");Array.isArray(null==l?void 0:l.getContent().service_members)&&(u=l.getContent().service_members);var c=[];if(this.summaryHeroes)this.summaryHeroes.forEach((function(e){if(u.includes(e))s--;else{var t=r.getMember(e);c.push(t?t.name:e)}}));else{var d=this.currentState.getMembers().filter((function(t){return t.userId!==e&&("invite"===t.membership||"join"===t.membership)}));d=d.filter((function(e){var t=e.userId;return!u.includes(t)||(s--,!1)})),d.sort((function(e,t){return y.compare(e.userId,t.userId)})),d=d.slice(0,5),c=d.map((function(e){return e.name}))}if(s)return this.roomNameGenerator({type:H.Generated,names:c,count:s});var f=this.getMyMembership();if("join"==f){var h=this.currentState.getStateEvents(M.EventType.RoomThirdPartyInvite);if(null!=h&&h.length){var p=h.map((function(e){return e.getContent().display_name}));return this.roomNameGenerator({type:H.Generated,subtype:"Inviting",names:p,count:p.length+1})}}var v,g=c;return g.length||(g=this.currentState.getMembers().filter((function(t){return t.userId!==e&&"invite"!==t.membership&&"join"!==t.membership})).map((function(e){return e.name}))),g.length&&(v=this.roomNameGenerator({type:H.Generated,names:g,count:g.length+1})),this.roomNameGenerator({type:H.EmptyRoom,oldName:v})}},{key:"applyNewVisibilityEvent",value:function(e){var t=e.asVisibilityChange();if(t){var r=e.getSender();if(r)if(M.EVENT_VISIBILITY_CHANGE_TYPE.name&&this.currentState.maySendStateEvent(M.EVENT_VISIBILITY_CHANGE_TYPE.name,r)||M.EVENT_VISIBILITY_CHANGE_TYPE.altName&&this.currentState.maySendStateEvent(M.EVENT_VISIBILITY_CHANGE_TYPE.altName,r)){var n=this.visibilityEvents.get(t.eventId);if(n){for(var i=n.length-1,o=Math.max(0,n.length-30);i>=o;--i){if(n[i].getTs()<e.getTs())break}-1===i?n.unshift(e):n.splice(i+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);var a=this.findEventById(t.eventId);a&&a.applyVisibilityEvent(t)}}}},{key:"redactVisibilityChangeEvent",value:function(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var t=e.getRelation(),r=null==t?void 0:t.event_id,n=this.visibilityEvents.get(r);if(n){var i=n.findIndex((function(t){return t.getId()===e.getId()}));if(-1!==i&&(n.splice(i,1),i===n.length)){var o=this.findEventById(r);if(!o)return;if(0===i)this.visibilityEvents.delete(r),o.applyVisibilityEvent();else{var a=n[n.length-1].asVisibilityChange();if(!a)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(a)}}}}},{key:"applyPendingVisibilityEvents",value:function(e){var t=this.visibilityEvents.get(e.getId());if(t&&0!=t.length){var r=t[t.length-1],n=r.asVisibilityChange();n&&(n.visible,r.getTs()<e.getTs()||e.applyVisibilityEvent(n))}}},{key:"getOldestThreadedReceiptTs",value:function(){return this.oldestThreadedReceiptTs}},{key:"getLastUnthreadedReceiptFor",value:function(e){return this.unthreadedReceipts.get(e)}}]),n}(D.ReadReceipt);e.exports.Room=V;var H,G,z=(W={},(0,s.default)(W,_.EventStatus.ENCRYPTING,[_.EventStatus.SENDING,_.EventStatus.NOT_SENT,_.EventStatus.CANCELLED]),(0,s.default)(W,_.EventStatus.SENDING,[_.EventStatus.ENCRYPTING,_.EventStatus.QUEUED,_.EventStatus.NOT_SENT,_.EventStatus.SENT]),(0,s.default)(W,_.EventStatus.QUEUED,[_.EventStatus.SENDING,_.EventStatus.CANCELLED]),(0,s.default)(W,_.EventStatus.SENT,[]),(0,s.default)(W,_.EventStatus.NOT_SENT,[_.EventStatus.SENDING,_.EventStatus.QUEUED,_.EventStatus.CANCELLED]),(0,s.default)(W,_.EventStatus.CANCELLED,[]),W);function Y(e,t){var r=t-1;return e.length?1===e.length&&r<=1?e[0]:2===e.length&&r<=2?"".concat(e[0]," and ").concat(e[1]):r>1?"".concat(e[0]," and ").concat(r," others"):"".concat(e[0]," and 1 other"):"Empty room"}e.exports.RoomNameType=H,(G=H||(e.exports.RoomNameType=H={}))[G.EmptyRoom=0]="EmptyRoom",G[G.Generated=1]="Generated",G[G.Actual=2]="Actual"})),n.register("jjL6E",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("giCK6"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventTimelineSet=e.exports.DuplicateStrategy=void 0;var l,c,d,f=u(n("3rHpI")),h=n("aBvOl"),p=n("jtqeE"),v=n("5xqDi"),g=n("6MMVS"),m=n("agUax");l=p.logger.log.bind(p.logger),e.exports.DuplicateStrategy=c,(d=c||(e.exports.DuplicateStrategy=c={})).Ignore="ignore",d.Replace="replace";var y=function(e){(0,a.default)(n,e);var t=(0,s.default)(n);function n(e){var o,a,s,u,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,i.default)(this,n),(o=t.call(this)).room=e,o.thread=d,o.threadListType=p,(0,f.default)((0,r.default)(o),"relations",void 0),(0,f.default)((0,r.default)(o),"timelineSupport",void 0),(0,f.default)((0,r.default)(o),"displayPendingEvents",void 0),(0,f.default)((0,r.default)(o),"liveTimeline",void 0),(0,f.default)((0,r.default)(o),"timelines",void 0),(0,f.default)((0,r.default)(o),"_eventIdToTimeline",new Map),(0,f.default)((0,r.default)(o),"filter",void 0),o.timelineSupport=Boolean(l.timelineSupport),o.liveTimeline=new h.EventTimeline((0,r.default)(o)),o.displayPendingEvents=!1!==l.pendingEvents,o.timelines=[o.liveTimeline],o._eventIdToTimeline=new Map,o.filter=l.filter,o.relations=null!==(a=null===(s=o.room)||void 0===s?void 0:s.relations)&&void 0!==a?a:new m.RelationsContainer(null!==(u=null==e?void 0:e.client)&&void 0!==u?u:c),o}return(0,o.default)(n,[{key:"getTimelines",value:function(){return this.timelines}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){this.filter=e}},{key:"getPendingEvents",value:function(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}},{key:"getLiveTimeline",value:function(){return this.liveTimeline}},{key:"setLiveTimeline",value:function(e){this.liveTimeline=e}},{key:"eventIdToTimeline",value:function(e){return this._eventIdToTimeline.get(e)}},{key:"replaceEventId",value:function(e,t){var r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,r))}},{key:"resetLiveTimeline",value:function(e,t){var r=!this.timelineSupport||!t,n=this.liveTimeline,i=r?n.forkLive(h.EventTimeline.FORWARDS):n.fork(h.EventTimeline.FORWARDS);r?(this.timelines=[i],this._eventIdToTimeline=new Map):this.timelines.push(i),t&&n.setPaginationToken(t,h.EventTimeline.FORWARDS),i.setPaginationToken(null!=e?e:null,h.EventTimeline.BACKWARDS),this.liveTimeline=i,this.emit(v.RoomEvent.TimelineReset,this.room,this,r)}},{key:"getTimelineForEvent",value:function(e){if(null==e)return null;var t=this._eventIdToTimeline.get(e);return void 0===t?null:t}},{key:"findEventById",value:function(e){var t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}},{key:"addTimeline",value:function(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new h.EventTimeline(this);return this.timelines.push(e),e}},{key:"addEventsToTimeline",value:function(e,t,r,n){if(!r)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&r==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!this.filter||(e=this.filter.filterRoomTimeline(e)).length){var i=t?h.EventTimeline.BACKWARDS:h.EventTimeline.FORWARDS,o=t?h.EventTimeline.FORWARDS:h.EventTimeline.BACKWARDS,a=!1,s=!1,u=!0,c=!1,d=void 0;try{for(var f,v=e[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){var g=f.value,m=g.getId(),y=this._eventIdToTimeline.get(m);if(y)if(s=!1,y!=r){var b=r.getNeighbouringTimeline(i);if(b)l(y==b?"Event "+m+" in neighbouring timeline - switching to "+y:"Event "+m+" already in a different timeline "+y),r=y;else{p.logger.info("Already have timeline for "+m+" - joining timeline "+r+" to "+y);var _=y===this.liveTimeline,w=r===this.liveTimeline,S=i===h.EventTimeline.BACKWARDS&&_,E=i===h.EventTimeline.FORWARDS&&w;S||E?(S&&p.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+y+")"),E&&p.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+r+")")):(r.setNeighbouringTimeline(y,i),y.setNeighbouringTimeline(r,o),r=y,a=!0)}}else l("Event "+m+" already in timeline "+r);else this.addEventToTimeline(g,r,{toStartOfTimeline:t}),s=!0,a=!0}}catch(e){c=!0,d=e}finally{try{u||null==v.return||v.return()}finally{if(c)throw d}}if(s||!a){if(i===h.EventTimeline.FORWARDS&&r===this.liveTimeline)return p.logger.warn({lastEventWasNew:s,didUpdate:a}),void p.logger.warn("Refusing to set forwards pagination token of live timeline "+"".concat(r," to ").concat(n));r.setPaginationToken(null!=n?n:null,i)}}}},{key:"addLiveEvent",value:function(e,t){var r,n,i,o,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,u=t||c.Ignore;if("object"==typeof t?(u=void 0===(i=(n=t).duplicateStrategy)?c.Ignore:i,a=void 0!==(o=n.fromCache)&&o,s=n.roomState,r=n.timelineWasEmpty):void 0!==t&&p.logger.warn("Overload deprecated: `EventTimelineSet.addLiveEvent(event, duplicateStrategy?, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addLiveEvent(event, IAddLiveEventOptions)`"),this.filter){var d=this.filter.filterRoomTimeline([e]);if(!d.length)return}var f=this._eventIdToTimeline.get(e.getId());if(f)if(u===c.Replace){l("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var v=f.getEvents(),g=0;g<v.length;g++)if(v[g].getId()===e.getId()){s||(s=f.getState(h.EventTimeline.FORWARDS)),h.EventTimeline.setEventMetadata(e,s,!1),v[g]=e;break}}else l("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:a,roomState:s,timelineWasEmpty:r})}},{key:"addEventToTimeline",value:function(e,t,r){var n,i,o,a,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,l=!!r;if("object"==typeof r?(l=(i=r).toStartOfTimeline,s=void 0!==(o=i.fromCache)&&o,u=i.roomState,n=i.timelineWasEmpty):void 0!==r&&p.logger.warn("Overload deprecated: `EventTimelineSet.addEventToTimeline(event, timeline, toStartOfTimeline, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addEventToTimeline(event, timeline, IAddEventToTimelineOptions)`"),t.getTimelineSet()!==this)throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(a=this.thread)||void 0===a?void 0:a.id,")"));if(this.room&&!this.canContain(e)){var c,d="event=".concat(e.getId());return e.threadRootId&&(d+="(belongs to thread=".concat(e.threadRootId,")")),void p.logger.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(d," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(c=this.thread)||void 0===c?void 0:c.id,")"))}var f=e.getId();t.addEvent(e,{toStartOfTimeline:l,roomState:u,timelineWasEmpty:n}),this._eventIdToTimeline.set(f,t),this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this);var h={timeline:t,liveEvent:!l&&t==this.liveTimeline&&!s};this.emit(v.RoomEvent.Timeline,e,this.room,Boolean(l),!1,h)}},{key:"handleRemoteEcho",value:function(e,t,r){var n=this._eventIdToTimeline.get(t);n?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(r,n)):this.filter&&!this.filter.filterRoomTimeline([e]).length||this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1})}},{key:"removeEvent",value:function(e){var t=this._eventIdToTimeline.get(e);if(!t)return null;var r=t.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);var n={timeline:t};this.emit(v.RoomEvent.Timeline,r,this.room,void 0,!0,n)}return r}},{key:"compareEventOrdering",value:function(e,t){if(e==t)return 0;var r=this._eventIdToTimeline.get(e),n=this._eventIdToTimeline.get(t);if(void 0===r)return null;if(void 0===n)return null;if(r===n){for(var i=void 0,o=void 0,a=r.getEvents(),s=0;s<a.length&&(void 0===i||void 0===o);s++){var u=a[s].getId();u==e&&(i=s),u==t&&(o=s)}return i-o}for(var l=r;l;){if(l===n)return-1;l=l.getNeighbouringTimeline(h.EventTimeline.FORWARDS)}for(l=r;l;){if(l===n)return 1;l=l.getNeighbouringTimeline(h.EventTimeline.BACKWARDS)}return null}},{key:"canContain",value:function(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var t=this.room.eventShouldLiveIn(e),r=t.threadId,n=t.shouldLiveInRoom;return this.thread?this.thread.id===r:n}}]),n}(g.TypedEventEmitter);e.exports.EventTimelineSet=y})),n.register("aBvOl",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("dLRop"),a=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventTimeline=e.exports.Direction=void 0;var s,u,l=a(n("3rHpI")),c=n("jtqeE"),d=n("bcGqc"),f=n("8bPbt");e.exports.Direction=s,(u=s||(e.exports.Direction=s={})).Backward="b",u.Forward="f";var h=function(){function e(t){var n,i,a;(0,r.default)(this,e),this.eventTimelineSet=t,(0,l.default)(this,"roomId",void 0),(0,l.default)(this,"name",void 0),(0,l.default)(this,"events",[]),(0,l.default)(this,"baseIndex",0),(0,l.default)(this,"startState",void 0),(0,l.default)(this,"endState",void 0),(0,l.default)(this,"startToken",null),(0,l.default)(this,"endToken",null),(0,l.default)(this,"prevTimeline",null),(0,l.default)(this,"nextTimeline",null),(0,l.default)(this,"paginationRequests",(a={},(0,o.default)(a,s.Backward,null),(0,o.default)(a,s.Forward,null),a)),this.roomId=null!==(n=null===(i=t.room)||void 0===i?void 0:i.roomId)&&void 0!==n?n:null,this.roomId&&(this.startState=new d.RoomState(this.roomId),this.endState=new d.RoomState(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}return(0,i.default)(e,[{key:"initialiseState",value:function(e){var t,r,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).timelineWasEmpty;if(this.events.length>0)throw new Error("Cannot initialise state after events are added");null===(t=this.startState)||void 0===t||t.setStateEvents(e,{timelineWasEmpty:n}),null===(r=this.endState)||void 0===r||r.setStateEvents(e,{timelineWasEmpty:n})}},{key:"forkLive",value:function(t){var r=this.getState(t),n=new e(this.eventTimelineSet);return n.startState=null==r?void 0:r.clone(),n.endState=r,this.endState=null==r?void 0:r.clone(),n}},{key:"fork",value:function(t){var r=this.getState(t),n=new e(this.eventTimelineSet);return n.startState=null==r?void 0:r.clone(),n.endState=null==r?void 0:r.clone(),n}},{key:"getRoomId",value:function(){return this.roomId}},{key:"getFilter",value:function(){return this.eventTimelineSet.getFilter()}},{key:"getTimelineSet",value:function(){return this.eventTimelineSet}},{key:"getBaseIndex",value:function(){return this.baseIndex}},{key:"getEvents",value:function(){return this.events}},{key:"getState",value:function(t){if(t==e.BACKWARDS)return this.startState;if(t==e.FORWARDS)return this.endState;throw new Error("Invalid direction '"+t+"'")}},{key:"getPaginationToken",value:function(e){return this.roomId?this.getState(e).paginationToken:e===s.Backward?this.startToken:this.endToken}},{key:"setPaginationToken",value:function(e,t){this.roomId?this.getState(t).paginationToken=e:t===s.Backward?this.startToken=e:this.endToken=e}},{key:"getNeighbouringTimeline",value:function(t){if(t==e.BACKWARDS)return this.prevTimeline;if(t==e.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+t+"'")}},{key:"setNeighbouringTimeline",value:function(t,r){if(this.getNeighbouringTimeline(r))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+r+")");if(r==e.BACKWARDS)this.prevTimeline=t;else{if(r!=e.FORWARDS)throw new Error("Invalid direction '"+r+"'");this.nextTimeline=t}this.setPaginationToken(null,r)}},{key:"addEvent",value:function(t,r,n){var i,o,a=!!r;"object"==typeof r?(a=(o=r).toStartOfTimeline,n=o.roomState,i=o.timelineWasEmpty):void 0!==r&&c.logger.warn("Overload deprecated: `EventTimeline.addEvent(event, toStartOfTimeline, roomState?)` is deprecated in favor of the overload with `EventTimeline.addEvent(event, IAddEventOptions)`"),n||(n=a?this.startState:this.endState);var s,u,l=this.getTimelineSet();l.room&&(e.setEventMetadata(t,n,a),t.isState()&&l.room.getUnfilteredTimelineSet()===l&&(null===(s=n)||void 0===s||s.setStateEvents([t],{timelineWasEmpty:i}),t.sender&&(t.getType()!==f.EventType.RoomMember||a)||e.setEventMetadata(t,n,a)));u=a?0:this.events.length,this.events.splice(u,0,t),a&&this.baseIndex++}},{key:"removeEvent",value:function(e){for(var t=this.events.length-1;t>=0;t--){var r=this.events[t];if(r.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,r}return null}},{key:"toString",value:function(){return this.name}}],[{key:"setEventMetadata",value:function(e,t,r){var n,i,o,a;null!==(n=e.sender)&&void 0!==n&&null!==(i=n.events)&&void 0!==i&&i.member||(e.sender=t.getSentinelMember(e.getSender())),null!==(o=e.target)&&void 0!==o&&null!==(a=o.events)&&void 0!==a&&a.member||e.getType()!==f.EventType.RoomMember||(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&r&&(e.forwardLooking=!1)}}]),e}();e.exports.EventTimeline=h,(0,l.default)(h,"BACKWARDS",s.Backward),(0,l.default)(h,"FORWARDS",s.Forward)})),n.register("agUax",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("9oGi2"),a=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RelationsContainer=void 0;var s=a(n("3rHpI")),u=n("33szU"),l=n("jEuTn"),c=function(){function e(t,n){(0,r.default)(this,e),this.client=t,this.room=n,(0,s.default)(this,"relations",new Map)}return(0,i.default)(e,[{key:"getChildEventsForEvent",value:function(e,t,r){var n,i;return null===(n=this.relations.get(e))||void 0===n||null===(i=n.get(t))||void 0===i?void 0:i.get(r)}},{key:"getAllChildEventsForEvent",value:function(e){var t,r,n=null!==(r=this.relations.get(e))&&void 0!==r?r:new Map,i=[],a=!0,s=!1,u=void 0,l=!0,c=!1,d=void 0;try{for(var f,h=n.values()[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var p=f.value;try{for(var v,g=p.values()[Symbol.iterator]();!(a=(v=g.next()).done);a=!0){var m=v.value;(t=i).push.apply(t,(0,o.default)(m.getRelations()))}}catch(e){s=!0,u=e}finally{try{a||null==g.return||g.return()}finally{if(s)throw u}}}}catch(e){c=!0,d=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw d}}return i}},{key:"aggregateParentEvent",value:function(e){var t=this.relations.get(e.getId());if(t){var r=!0,n=!1,i=void 0,o=!0,a=!1,s=void 0;try{for(var u,l=t.values()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;try{for(var d,f=c.values()[Symbol.iterator]();!(r=(d=f.next()).done);r=!0){d.value.setTargetEvent(e)}}catch(e){n=!0,i=e}finally{try{r||null==f.return||f.return()}finally{if(n)throw i}}}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}}}},{key:"aggregateChildEvent",value:function(e,t){var r=this;if(!e.isRedacted()&&e.status!==l.EventStatus.CANCELLED){var n=e.getRelation();if(n){var i=function(){e.isDecryptionFailure()?e.once(l.MatrixEventEvent.Decrypted,i):r.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption())e.once(l.MatrixEventEvent.Decrypted,i);else{var o=n.event_id,a=n.rel_type,s=e.getType(),c=this.relations.get(o);c||(c=new Map,this.relations.set(o,c));var d=c.get(a);d||(d=new Map,c.set(a,d));var f=d.get(s);if(!f){var h,p,v;f=new u.Relations(a,s,this.client),d.set(s,f);var g=null!==(h=this.room)&&void 0!==h?h:null==t?void 0:t.room,m=null!==(p=null!==(v=null==t?void 0:t.findEventById(o))&&void 0!==v?v:null==g?void 0:g.findEventById(o))&&void 0!==p?p:null==g?void 0:g.getPendingEvent(o);m&&f.setTargetEvent(m)}f.addEvent(e)}}}}}]),e}();e.exports.RelationsContainer=c})),n.register("33szU",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("9oGi2"),l=n("giCK6"),c=n("eQNFO"),d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RelationsEvent=e.exports.Relations=void 0;var f,h,p=d(n("3rHpI")),v=n("jEuTn"),g=n("jtqeE"),m=n("8bPbt"),y=n("6MMVS"),b=n("5xqDi");e.exports.RelationsEvent=f,(h=f||(e.exports.RelationsEvent=f={})).Add="Relations.add",h.Remove="Relations.remove",h.Redaction="Relations.redaction";var _=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(e,a,s,u){var l;(0,o.default)(this,n),(l=t.call(this)).relationType=e,l.eventType=a,l.altEventTypes=u,(0,p.default)((0,r.default)(l),"relationEventIds",new Set),(0,p.default)((0,r.default)(l),"relations",new Set),(0,p.default)((0,r.default)(l),"annotationsByKey",{}),(0,p.default)((0,r.default)(l),"annotationsBySender",{}),(0,p.default)((0,r.default)(l),"sortedAnnotationsByKey",[]),(0,p.default)((0,r.default)(l),"targetEvent",null),(0,p.default)((0,r.default)(l),"creationEmitted",!1),(0,p.default)((0,r.default)(l),"client",void 0),(0,p.default)((0,r.default)(l),"onEventStatus",(function(e,t){e.isSending()?t===v.EventStatus.CANCELLED&&(e.removeListener(v.MatrixEventEvent.Status,l.onEventStatus),l.removeEvent(e)):e.removeListener(v.MatrixEventEvent.Status,l.onEventStatus)}));var d,h=(0,r.default)(l);return(0,p.default)((0,r.default)(l),"onBeforeRedaction",(d=(0,i.default)((function(e){var t;return(0,c.__generator)(this,(function(r){switch(r.label){case 0:return h.relations.has(e)?(h.relations.delete(e),h.relationType!==m.RelationType.Annotation?[3,1]:(h.removeAnnotationFromAggregation(e),[3,3])):[2];case 1:return h.relationType!==m.RelationType.Replace||!h.targetEvent||h.targetEvent.isState()?[3,3]:[4,h.getLastReplacement()];case 2:t=r.sent(),h.targetEvent.makeReplaced(t),r.label=3;case 3:return e.removeListener(v.MatrixEventEvent.BeforeRedaction,h.onBeforeRedaction),h.emit(f.Redaction,e),[2]}}))})),function(e){return d.apply(this,arguments)})),l.client=s instanceof b.Room?s.client:s,l}return(0,a.default)(n,[{key:"addEvent",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o;return(0,c.__generator)(this,(function(a){switch(a.label){case 0:return t.relationEventIds.has(e.getId())?[2]:(r=e.getRelation())?(n=r.rel_type,i=e.getType(),t.relationType===n&&function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return[t].concat((0,u.default)(r)).includes(e)}(i,t.eventType,t.altEventTypes)?(e.isSending()&&e.on(v.MatrixEventEvent.Status,t.onEventStatus),t.relations.add(e),t.relationEventIds.add(e.getId()),t.relationType!==m.RelationType.Annotation?[3,1]:(t.addAnnotationToAggregation(e),[3,3])):(g.logger.error("Event relation info doesn't match this container"),[2])):(g.logger.error("Event must have relation info"),[2]);case 1:return t.relationType!==m.RelationType.Replace||!t.targetEvent||t.targetEvent.isState()?[3,3]:[4,t.getLastReplacement()];case 2:o=a.sent(),t.targetEvent.makeReplaced(o),a.label=3;case 3:return e.on(v.MatrixEventEvent.BeforeRedaction,t.onBeforeRedaction),t.emit(f.Add,e),t.maybeEmitCreated(),[2]}}))}))()}},{key:"removeEvent",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return t.relations.has(e)?(t.relations.delete(e),t.relationType!==m.RelationType.Annotation?[3,1]:(t.removeAnnotationFromAggregation(e),[3,3])):[2];case 1:return t.relationType!==m.RelationType.Replace||!t.targetEvent||t.targetEvent.isState()?[3,3]:[4,t.getLastReplacement()];case 2:r=n.sent(),t.targetEvent.makeReplaced(r),n.label=3;case 3:return t.emit(f.Remove,e),[2]}}))}))()}},{key:"getRelations",value:function(){return(0,u.default)(this.relations)}},{key:"addAnnotationToAggregation",value:function(e){var t,r=(null!==(t=e.getRelation())&&void 0!==t?t:{}).key;if(r){var n=this.annotationsByKey[r];n||(n=this.annotationsByKey[r]=new Set,this.sortedAnnotationsByKey.push([r,n])),n.add(e),this.sortedAnnotationsByKey.sort((function(e,t){var r=e[1];return t[1].size-r.size}));var i=e.getSender(),o=this.annotationsBySender[i];o||(o=this.annotationsBySender[i]=new Set),o.add(e)}}},{key:"removeAnnotationFromAggregation",value:function(e){var t,r=(null!==(t=e.getRelation())&&void 0!==t?t:{}).key;if(r){var n=this.annotationsByKey[r];n&&(n.delete(e),this.sortedAnnotationsByKey.sort((function(e,t){var r=e[1];return t[1].size-r.size})));var i=e.getSender(),o=this.annotationsBySender[i];o&&o.delete(e)}}},{key:"getSortedAnnotationsByKey",value:function(){return this.relationType!==m.RelationType.Annotation?null:this.sortedAnnotationsByKey}},{key:"getAnnotationsBySender",value:function(){return this.relationType!==m.RelationType.Annotation?null:this.annotationsBySender}},{key:"getLastReplacement",value:function(){var e=this;return(0,i.default)((function(){var t,r,n;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return e.relationType!==m.RelationType.Replace?[2,null]:e.targetEvent?(t=e.targetEvent.getServerAggregatedRelation(m.RelationType.Replace),r=null==t?void 0:t.origin_server_ts,null!=(n=e.getRelations().reduce((function(t,n){return n.getSender()!==e.targetEvent.getSender()||r&&r>n.getTs()||t&&t.getTs()>n.getTs()?t:n}),null))&&n.shouldAttemptDecryption()&&e.client.isCryptoEnabled()?[4,n.attemptDecryption(e.client.crypto)]:[3,2]):[2,null];case 1:return i.sent(),[3,4];case 2:return null!=n&&n.isBeingDecrypted()?[4,n.getDecryptionPromise()]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2,n]}}))}))()}},{key:"setTargetEvent",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return t.targetEvent?[2]:(t.targetEvent=e,t.relationType!==m.RelationType.Replace||t.targetEvent.isState()?[3,2]:[4,t.getLastReplacement()]);case 1:(r=n.sent())&&t.targetEvent.makeReplaced(r),n.label=2;case 2:return t.maybeEmitCreated(),[2]}}))}))()}},{key:"maybeEmitCreated",value:function(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit(v.MatrixEventEvent.RelationsCreated,this.relationType,this.eventType))}}]),n}(y.TypedEventEmitter);e.exports.Relations=_})),n.register("8ySly",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventStatus=void 0,e.exports.EventStatus=r,(n=r||(e.exports.EventStatus=r={})).NOT_SENT="not_sent",n.ENCRYPTING="encrypting",n.SENDING="sending",n.QUEUED="queued",n.SENT="sent",n.CANCELLED="cancelled"})),n.register("da1nQ",(function(e,t){var r=n("kxanC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomSummary=void 0;e.exports.RoomSummary=function e(t,n){(0,r.default)(this,e),this.roomId=t}})),n.register("k2cpO",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("61A8y"),a=n("5gj45"),s=n("cksMj"),u=n("9oGi2"),l=n("giCK6"),c=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TypedReEmitter=e.exports.ReEmitter=void 0;var d=c(n("3rHpI")),f=function(){function e(t){(0,r.default)(this,e),this.target=t,(0,d.default)(this,"reEmitters",new Map)}return(0,i.default)(e,[{key:"reEmit",value:function(e,t){var r=this,n=this.reEmitters.get(e);n||(n=new Map,this.reEmitters.set(e,n));var i=!0,o=!1,a=void 0;try{for(var s,l=function(){var t=s.value,i=function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];var a;"error"===t&&0===r.target.listenerCount("error")||(a=r.target).emit.apply(a,[t].concat((0,u.default)(i),[e]))};e.on(t,i),n.set(t,i)},c=t[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)l()}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}}},{key:"stopReEmitting",value:function(e,t){var r=this.reEmitters.get(e);if(r){var n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;e.off(u,r.get(u)),r.delete(u)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}0===r.size&&this.reEmitters.delete(e)}}}]),e}();e.exports.ReEmitter=f;var h=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(e){return(0,r.default)(this,n),t.call(this,e)}return(0,i.default)(n,[{key:"reEmit",value:function(e,t){(0,o.default)((0,a.default)(n.prototype),"reEmit",this).call(this,e,t)}},{key:"stopReEmitting",value:function(e,t){(0,o.default)((0,a.default)(n.prototype),"stopReEmitting",this).call(this,e,t)}}]),n}(f);e.exports.TypedReEmitter=h})),n.register("hwbWG",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("dLRop"),a=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Filter=void 0;var s=a(n("3rHpI")),u=n("fFuZ6"),l=n("hnF9z");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){for(var n=t.split("."),i=e,o=0;o<n.length-1;o++)i[n[o]]||(i[n[o]]={}),i=i[n[o]];i[n[n.length-1]]=r}var h=function(){function e(t,n){(0,r.default)(this,e),this.userId=t,this.filterId=n,(0,s.default)(this,"definition",{}),(0,s.default)(this,"roomFilter",void 0),(0,s.default)(this,"roomTimelineFilter",void 0)}return(0,i.default)(e,[{key:"getFilterId",value:function(){return this.filterId}},{key:"getDefinition",value:function(){return this.definition}},{key:"setDefinition",value:function(e){this.definition=e;var t=e.room,r={};t&&(t.rooms&&(r.rooms=t.rooms),t.rooms&&(r.not_rooms=t.not_rooms)),this.roomFilter=new l.FilterComponent(r,this.userId),this.roomTimelineFilter=new l.FilterComponent((null==t?void 0:t.timeline)||{},this.userId)}},{key:"getRoomTimelineFilterComponent",value:function(){return this.roomTimelineFilter}},{key:"filterRoomTimeline",value:function(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}},{key:"setTimelineLimit",value:function(e){f(this.definition,"room.timeline.limit",e)}},{key:"setUnreadThreadNotifications",value:function(e){var t,r,n;this.definition=d(d({},this.definition),{},{room:d(d({},null===(t=this.definition)||void 0===t?void 0:t.room),{},{timeline:d(d({},null===(r=this.definition)||void 0===r||null===(n=r.room)||void 0===n?void 0:n.timeline),{},(0,o.default)({},u.UNREAD_THREAD_NOTIFICATIONS.name,e))})})}},{key:"setLazyLoadMembers",value:function(e){f(this.definition,"room.state.lazy_load_members",e)}},{key:"setIncludeLeaveRooms",value:function(e){f(this.definition,"room.include_leave",e)}}],[{key:"fromJson",value:function(t,r,n){var i=new e(t,r);return i.setDefinition(n),i}}]),e}();e.exports.Filter=h,(0,s.default)(h,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})})),n.register("fFuZ6",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UNREAD_THREAD_NOTIFICATIONS=void 0;var r=new(n("kLCn9").ServerControlledNamespacedValue)("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");e.exports.UNREAD_THREAD_NOTIFICATIONS=r})),n.register("hnF9z",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("dLRop");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.FilterComponent=void 0;var a=n("1lFBd");var s=function(){function e(t,n){(0,r.default)(this,e),this.filterJson=t,this.userId=n}return(0,i.default)(e,[{key:"check",value:function(e){var t,r,n=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},i=Object.keys(n),o=[];return this.userId&&null!=n&&null!==(r=n[a.THREAD_RELATION_TYPE.name])&&void 0!==r&&r.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,i,o)}},{key:"toJSON",value:function(){var e;return e={types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null},(0,o.default)(e,a.FILTER_RELATED_BY_SENDERS.name,this.filterJson[a.FILTER_RELATED_BY_SENDERS.name]||[]),(0,o.default)(e,a.FILTER_RELATED_BY_REL_TYPES.name,this.filterJson[a.FILTER_RELATED_BY_REL_TYPES.name]||[]),e}},{key:"checkFields",value:function(e,t,r,n,i,o){var s={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){var r=t.slice(0,-1);return e.slice(0,r.length)===r}return e===t}(r,e)}};for(var u in s){var l=s[u],c="not_"+u,d=this.filterJson[c];if(null!=d&&d.some(l))return!1;var f=this.filterJson[u];if(f&&!f.some(l))return!1}var h=this.filterJson.contains_url;if(void 0!==h&&h!==n)return!1;var p=this.filterJson[a.FILTER_RELATED_BY_REL_TYPES.name];if(void 0!==p&&!this.arrayMatchesFilter(p,i))return!1;var v=this.filterJson[a.FILTER_RELATED_BY_SENDERS.name];return!(void 0!==v&&!this.arrayMatchesFilter(v,o))}},{key:"arrayMatchesFilter",value:function(e,t){return t.length>0&&e.every((function(e){return t.includes(e)}))}},{key:"filter",value:function(e){return e.filter(this.check,this)}},{key:"limit",value:function(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}]),e}();e.exports.FilterComponent=s})),n.register("afpjH",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("giCK6"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isTimestampInDuration=e.exports.getBeaconInfoIdentifier=e.exports.BeaconEvent=e.exports.Beacon=void 0;var l,c,d=u(n("3rHpI")),f=n("8RGNK"),h=n("e8gas"),p=n("6MMVS");e.exports.BeaconEvent=l,(c=l||(e.exports.BeaconEvent=l={})).New="Beacon.new",c.Update="Beacon.update",c.LivenessChange="Beacon.LivenessChange",c.Destroy="Beacon.Destroy",c.LocationUpdate="Beacon.LocationUpdate";var v=function(e,t,r){return r>=e&&e+t>=r};e.exports.isTimestampInDuration=v;var g=function(e){return"".concat(e.getRoomId(),"_").concat(e.getStateKey())};e.exports.getBeaconInfoIdentifier=g;var m=function(e){(0,a.default)(n,e);var t=(0,s.default)(n);function n(e){var o;return(0,i.default)(this,n),(o=t.call(this)).rootEvent=e,(0,d.default)((0,r.default)(o),"roomId",void 0),(0,d.default)((0,r.default)(o),"_beaconInfo",void 0),(0,d.default)((0,r.default)(o),"_isLive",void 0),(0,d.default)((0,r.default)(o),"livenessWatchTimeout",void 0),(0,d.default)((0,r.default)(o),"_latestLocationEvent",void 0),(0,d.default)((0,r.default)(o),"clearLatestLocation",(function(){o._latestLocationEvent=void 0,o.emit(l.LocationUpdate,o.latestLocationState)})),o.setBeaconInfo(o.rootEvent),o.roomId=o.rootEvent.getRoomId(),o}return(0,o.default)(n,[{key:"isLive",get:function(){return!!this._isLive}},{key:"identifier",get:function(){return g(this.rootEvent)}},{key:"beaconInfoId",get:function(){return this.rootEvent.getId()}},{key:"beaconInfoOwner",get:function(){return this.rootEvent.getStateKey()}},{key:"beaconInfoEventType",get:function(){return this.rootEvent.getType()}},{key:"beaconInfo",get:function(){return this._beaconInfo}},{key:"latestLocationState",get:function(){return this._latestLocationEvent&&(0,f.parseBeaconContent)(this._latestLocationEvent.getContent())}},{key:"latestLocationEvent",get:function(){return this._latestLocationEvent}},{key:"update",value:function(e){if(g(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(l.Update,e,this),this.clearLatestLocation())}},{key:"destroy",value:function(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(l.Destroy,this.identifier)}},{key:"monitorLiveness",value:function(){var e=this;if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.beaconInfo)if(this.isLive){var t=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();t>1&&(this.livenessWatchTimeout=setTimeout((function(){e.monitorLiveness()}),t))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout((function(){e.monitorLiveness()}),this.beaconInfo.timestamp-Date.now()))}},{key:"addLocations",value:function(e){var t,r=this;if(this.isLive){var n=null===(t=e.filter((function(e){var t=e.getContent(),n=(0,f.parseBeaconContent)(t);if(!n.uri||!n.timestamp)return!1;var i=n.timestamp;return r._beaconInfo.timestamp&&v(r._beaconInfo.timestamp,r._beaconInfo.timeout,i)&&(!r.latestLocationState||i>r.latestLocationState.timestamp)})).sort(h.sortEventsByLatestContentTimestamp))||void 0===t?void 0:t[0];n&&(this._latestLocationEvent=n,this.emit(l.LocationUpdate,this.latestLocationState))}}},{key:"setBeaconInfo",value:function(e){this._beaconInfo=(0,f.parseBeaconInfoContent)(e.getContent()),this.checkLiveness()}},{key:"checkLiveness",value:function(){var e,t,r=this.isLive;if(this.beaconInfo){var n=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!(null===(e=this._beaconInfo)||void 0===e||!e.live)&&!!n&&v(n,null===(t=this._beaconInfo)||void 0===t?void 0:t.timeout,Date.now()),r!==this.isLive&&this.emit(l.LivenessChange,this.isLive,this)}}}]),n}(p.TypedEventEmitter);e.exports.Beacon=m})),n.register("8RGNK",(function(e,t){var r=n("dLRop"),i=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.makeBeaconInfoContent=e.exports.makeBeaconContent=e.exports.getTextForLocationEvent=void 0,e.exports.makeEmoteMessage=function(e){return{msgtype:s.MsgType.Emote,body:e}},e.exports.makeHtmlEmote=function(e,t){return{msgtype:s.MsgType.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}},e.exports.makeHtmlMessage=function(e,t){return{msgtype:s.MsgType.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}},e.exports.makeHtmlNotice=function(e,t){return{msgtype:s.MsgType.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}},e.exports.makeLocationContent=void 0,e.exports.makeNotice=function(e){return{msgtype:s.MsgType.Notice,body:e}},e.exports.makeTextMessage=function(e){return{msgtype:s.MsgType.Text,body:e}},e.exports.parseTopicContent=e.exports.parseLocationEvent=e.exports.parseBeaconInfoContent=e.exports.parseBeaconContent=e.exports.makeTopicContent=void 0;var o=i(n("3rHpI")),a=n("ghTXl"),s=n("8bPbt"),u=n("1CE7S"),l=n("3F1o7"),c=n("753BW");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var f=function(e,t,r,n){var i="at ".concat(new Date(r).toISOString());return[t===l.LocationAssetType.Self?"User":void 0,"Location",n?'"'.concat(n,'"'):void 0,e,i].filter(Boolean).join(" ")};e.exports.getTextForLocationEvent=f;var h=function(e,t,n,i,a){var c,h=null!=e?e:f(t,a||l.LocationAssetType.Self,n,i),p=n?(0,r.default)({},l.M_TIMESTAMP.name,n):{};return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}((c={msgtype:s.MsgType.Location,body:h,geo_uri:t},(0,r.default)(c,l.M_LOCATION.name,{description:i,uri:t}),(0,r.default)(c,l.M_ASSET.name,{type:a||l.LocationAssetType.Self}),(0,r.default)(c,u.TEXT_NODE_TYPE.name,h),c),p)};e.exports.makeLocationContent=h;e.exports.parseLocationEvent=function(e){var t,r,n=l.M_LOCATION.findIn(e),i=l.M_ASSET.findIn(e),o=l.M_TIMESTAMP.findIn(e),a=u.TEXT_NODE_TYPE.findIn(e),s=null!==(t=null==n?void 0:n.uri)&&void 0!==t?t:null==e?void 0:e.geo_uri,c=null==n?void 0:n.description,d=null!==(r=null==i?void 0:i.type)&&void 0!==r?r:l.LocationAssetType.Self,f=null!=a?a:e.body;return h(f,s,null!=o?o:void 0,c,d)};e.exports.makeTopicContent=function(e,t){var n=[{body:e,mimetype:"text/plain"}];return(0,a.isProvided)(t)&&n.push({body:t,mimetype:"text/html"}),(0,r.default)({topic:e},c.M_TOPIC.name,n)};e.exports.parseTopicContent=function(e){var t,r,n,i=c.M_TOPIC.findIn(e);return{text:null!==(t=null==i||null===(r=i.find((function(e){return!(0,a.isProvided)(e.mimetype)||"text/plain"===e.mimetype})))||void 0===r?void 0:r.body)&&void 0!==t?t:e.topic,html:null==i||null===(n=i.find((function(e){return"text/html"===e.mimetype})))||void 0===n?void 0:n.body}};e.exports.makeBeaconInfoContent=function(e,t,n,i,o){var a;return a={description:n,timeout:e,live:t},(0,r.default)(a,l.M_TIMESTAMP.name,o||Date.now()),(0,r.default)(a,l.M_ASSET.name,{type:null!=i?i:l.LocationAssetType.Self}),a};e.exports.parseBeaconInfoContent=function(e){var t,r=e.description,n=e.timeout,i=e.live,o=null!==(t=l.M_TIMESTAMP.findIn(e))&&void 0!==t?t:void 0,a=l.M_ASSET.findIn(e);return{description:r,timeout:n,live:i,assetType:null==a?void 0:a.type,timestamp:o}};e.exports.makeBeaconContent=function(e,t,n,i){var o;return o={},(0,r.default)(o,l.M_LOCATION.name,{description:i,uri:e}),(0,r.default)(o,l.M_TIMESTAMP.name,t),(0,r.default)(o,"m.relates_to",{rel_type:a.REFERENCE_RELATION.name,event_id:n}),o};e.exports.parseBeaconContent=function(e){var t,r=l.M_LOCATION.findIn(e),n=null!==(t=l.M_TIMESTAMP.findIn(e))&&void 0!==t?t:void 0;return{description:null==r?void 0:r.description,uri:null==r?void 0:r.uri,timestamp:n}}})),n.register("753BW",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_TOPIC=void 0;var r=new(n("kLCn9").UnstableValue)("m.topic","org.matrix.msc3765.topic");e.exports.M_TOPIC=r})),n.register("6KBJA",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("cksMj"),u=n("mBz5n"),l=n("9oGi2"),c=n("giCK6"),d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ReadReceipt=void 0,e.exports.synthesizeReceipt=b;var f=d(n("3rHpI")),h=n("7Ud45"),p=n("6MMVS"),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=y(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),g=n("jEuTn"),m=n("8bPbt");function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(y=function(e){return e?r:t})(e)}function b(e,t,r){var n;return new g.MatrixEvent({content:(0,a.default)({},t.getId(),(0,a.default)({},r,(0,a.default)({},e,{ts:t.getTs(),thread_id:null!==(n=t.threadRootId)&&void 0!==n?n:h.MAIN_ROOM_TIMELINE}))),type:m.EventType.Receipt,room_id:t.getRoomId()})}var _=function(e){(0,s.default)(n,e);var t=(0,c.default)(n);function n(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];var s;return(0,i.default)(this,n),s=t.call.apply(t,[this].concat((0,l.default)(o))),(0,f.default)((0,r.default)(s),"receipts",{}),(0,f.default)((0,r.default)(s),"receiptCacheByEventId",{}),(0,f.default)((0,r.default)(s),"timeline",void 0),s}return(0,o.default)(n,[{key:"getReadReceiptForUserId",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.ReceiptType.Read,o=(0,u.default)(null!==(t=null===(r=this.receipts[i])||void 0===r?void 0:r[e])&&void 0!==t?t:[],2),a=o[0],s=o[1];return n?a:null!=s?s:a}},{key:"getEventReadUpTo",value:function(e){var t,r,n,i,o,a,s,u,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=this.getUnfilteredTimelineSet(),d=this.getReadReceiptForUserId(e,l,h.ReceiptType.Read),f=this.getReadReceiptForUserId(e,l,h.ReceiptType.ReadPrivate);(null!=d&&d.eventId&&null!=f&&f.eventId&&(a=c.compareEventOrdering(null==d?void 0:d.eventId,null==f?void 0:f.eventId)),!a&&null!=d&&null!==(t=d.data)&&void 0!==t&&t.ts&&null!=f&&null!==(r=f.data)&&void 0!==r&&r.ts)&&(a=(null==d||null===(s=d.data)||void 0===s?void 0:s.ts)-(null==f||null===(u=f.data)||void 0===u?void 0:u.ts));return a?null!==(o=a<0?null==f?void 0:f.eventId:null==d?void 0:d.eventId)&&void 0!==o?o:null:null!==(n=null!==(i=null==f?void 0:f.eventId)&&void 0!==i?i:null==d?void 0:d.eventId)&&void 0!==n?n:null}},{key:"addReceiptToStructure",value:function(e,t,r,n,i){var o,a;this.receipts[t]||(this.receipts[t]={}),this.receipts[t][r]||(this.receipts[t][r]=[null,null]);var s,u=this.receipts[t][r],l=u[0];i&&(l=null!==(s=u[1])&&void 0!==s?s:u[0]);if(l){var c=this.getUnfilteredTimelineSet().compareEventOrdering(l.eventId,e);if(null!==c&&c>=0)return}var d={eventId:e,data:n},f=i?u[0]:d,h=i?d:u[1],p=null;f&&h&&(p=this.getUnfilteredTimelineSet().compareEventOrdering(f.eventId,h.eventId));var v=null===p||p<0,g=null!==(o=u[1])&&void 0!==o?o:u[0];if(i&&v?u[1]=d:i||(u[0]=d,v||(u[1]=null)),g!==(null!==(a=u[1])&&void 0!==a?a:u[0])){if(g&&this.receiptCacheByEventId[g.eventId]){var m=g.eventId;this.receiptCacheByEventId[m]=this.receiptCacheByEventId[m].filter((function(e){return e.type!==t||e.userId!==r})),this.receiptCacheByEventId[m].length<1&&delete this.receiptCacheByEventId[m]}this.receiptCacheByEventId[e]||(this.receiptCacheByEventId[e]=[]),this.receiptCacheByEventId[e].push({userId:r,type:t,data:n})}}},{key:"getReceiptsForEvent",value:function(e){return this.receiptCacheByEventId[e.getId()]||[]}},{key:"addLocalEchoReceipt",value:function(e,t,r){this.addReceipt(b(e,t,r),!0)}},{key:"getUsersReadUpTo",value:function(e){return this.getReceiptsForEvent(e).filter((function(e){return v.isSupportedReceiptType(e.type)})).map((function(e){return e.userId}))}},{key:"hasUserReadEvent",value:function(e,t){var r,n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(null!==(r=this.timeline)&&void 0!==r&&r.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(var i=(null===(o=this.timeline)||void 0===o?void 0:o.length)-1;i>=0;--i){var o,a=this.timeline[i];if(a.getId()===t)return!1;if(a.getId()===n)return!0}return!1}}]),n}(p.TypedEventEmitter);e.exports.ReadReceipt=_})),n.register("8iV7r",(function(e,t){var r,i,o,a,s,u=n("2swew"),l=n("dLRop"),c=n("mBz5n"),d=n("eQNFO");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ServerSupport=e.exports.Feature=void 0,e.exports.buildFeatureSupportMap=function(e){return h.apply(this,arguments)},e.exports.ServerSupport=r,(i=r||(e.exports.ServerSupport=r={}))[i.Stable=0]="Stable",i[i.Unstable=1]="Unstable",i[i.Unsupported=2]="Unsupported",e.exports.Feature=o,(a=o||(e.exports.Feature=o={})).Thread="Thread",a.ThreadUnreadNotifications="ThreadUnreadNotifications",a.LoginTokenRequest="LoginTokenRequest",a.RelationBasedRedactions="RelationBasedRedactions",a.AccountDataDeletion="AccountDataDeletion";var f=(s={},(0,l.default)(s,o.Thread,{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"}),(0,l.default)(s,o.ThreadUnreadNotifications,{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"}),(0,l.default)(s,o.LoginTokenRequest,{unstablePrefixes:["org.matrix.msc3882"]}),(0,l.default)(s,o.RelationBasedRedactions,{unstablePrefixes:["org.matrix.msc3912"]}),(0,l.default)(s,o.AccountDataDeletion,{unstablePrefixes:["org.matrix.msc3391"]}),s);function h(){return(h=(0,u.default)((function(e){var t,n,i,o,a,s,u,l,h,p,v,g,m,y,b;return(0,d.__generator)(this,(function(d){t=new Map,n=!0,i=!1,o=void 0;try{for(a=Object.entries(f)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)u=(0,c.default)(s.value,2),l=u[0],h=u[1],y=null!==(p=null===(v=e.versions)||void 0===v?void 0:v.includes(h.matrixVersion||""))&&void 0!==p&&p,b=null!==(g=null===(m=h.unstablePrefixes)||void 0===m?void 0:m.every((function(t){var r;return!0===(null===(r=e.unstable_features)||void 0===r?void 0:r[t])})))&&void 0!==g&&g,y?t.set(l,r.Stable):b?t.set(l,r.Unstable):t.set(l,r.Unsupported)}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return[2,t]}))}))).apply(this,arguments)}})),n.register("gzOOt",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PushProcessor=void 0;var a=o(n("3rHpI")),s=n("e8gas"),u=n("jtqeE"),l=n("2jbfh"),c=n("8bPbt");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=[l.PushRuleKind.Override,l.PushRuleKind.ContentSpecific,l.PushRuleKind.RoomSpecific,l.PushRuleKind.SenderSpecific,l.PushRuleKind.Underride],p=[{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:l.ConditionKind.EventMatch,key:"type",pattern:"m.reaction"}],actions:[l.PushRuleActionName.DontNotify]},{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:l.ConditionKind.EventMatch,key:"type",pattern:c.EventType.RoomServerAcl},{kind:l.ConditionKind.EventMatch,key:"state_key",pattern:""}],actions:[]}],v=[{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:l.ConditionKind.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:l.ConditionKind.CallStarted}],actions:[l.PushRuleActionName.Notify,{set_tweak:l.TweakName.Sound,value:"default"}]}],g=function(){function e(t){(0,r.default)(this,e),this.client=t}return(0,i.default)(e,[{key:"matchingRuleFromKindSet",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=h[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=t[s];if(u){var l=!0,c=!1,d=void 0;try{for(var p,v=u[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var g=p.value;if(g.enabled){var m=this.templateRuleToRaw(s,g);if(m&&this.ruleMatchesEvent(m,e))return f(f({},g),{},{kind:s})}}}catch(e){c=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(c)throw d}}}}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return null}},{key:"templateRuleToRaw",value:function(e,t){var r={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case l.PushRuleKind.Underride:case l.PushRuleKind.Override:r.conditions=t.conditions;break;case l.PushRuleKind.RoomSpecific:if(!t.rule_id)return null;r.conditions.push({kind:l.ConditionKind.EventMatch,key:"room_id",value:t.rule_id});break;case l.PushRuleKind.SenderSpecific:if(!t.rule_id)return null;r.conditions.push({kind:l.ConditionKind.EventMatch,key:"user_id",value:t.rule_id});break;case l.PushRuleKind.ContentSpecific:if(!t.pattern)return null;r.conditions.push({kind:l.ConditionKind.EventMatch,key:"content.body",pattern:t.pattern})}return r}},{key:"eventFulfillsCondition",value:function(e,t){switch(e.kind){case l.ConditionKind.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case l.ConditionKind.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case l.ConditionKind.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case l.ConditionKind.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t);case l.ConditionKind.CallStarted:case l.ConditionKind.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,t)}return!1}},{key:"eventFulfillsSenderNotifPermCondition",value:function(e,t){var r=e.key;if(!r)return!1;var n=this.client.getRoom(t.getRoomId());return!(null==n||!n.currentState)&&n.currentState.mayTriggerNotifOfType(r,t.getSender())}},{key:"eventFulfillsRoomMemberCountCondition",value:function(e,t){if(!e.is)return!1;var r=this.client.getRoom(t.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;var n=r.currentState.getJoinedMemberCount(),i=e.is.match(/^([=<>]*)(\d*)$/);if(!i)return!1;var o=i[1],a=parseInt(i[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return n==a;case"<":return n<a;case">":return n>a;case"<=":return n<=a;case">=":return n>=a;default:return!1}}},{key:"eventFulfillsDisplayNameCondition",value:function(e,t){var r,n=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(n=t.getClearContent()),!n||!n.body||"string"!=typeof n.body)return!1;var i=this.client.getRoom(t.getRoomId()),o=null==i||null===(r=i.currentState)||void 0===r?void 0:r.getMember(this.client.credentials.userId);if(!o)return!1;var a=o.name,u=new RegExp("(^|\\W)"+(0,s.escapeRegExp)(a)+"(\\W|$)","i");return n.body.search(u)>-1}},{key:"eventFulfillsEventMatchCondition",value:function(e,t){if(!e.key)return!1;var r=this.valueForDottedKey(e.key,t);if("string"!=typeof r)return!1;if(e.value)return e.value===r;if("string"!=typeof e.pattern)return!1;var n="content.body"===e.key?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$");return!!r.match(n)}},{key:"eventFulfillsCallStartedCondition",value:function(e,t){return["m.ring","m.prompt"].includes(t.getContent()["m.intent"])&&!("m.terminated"in t.getContent())&&(t.getPrevContent()["m.terminated"]!==t.getContent()["m.terminated"]||(0,s.deepCompare)(t.getPrevContent(),{}))}},{key:"createCachedRegex",value:function(t,r,n){return e.cachedGlobToRegex[r]||(e.cachedGlobToRegex[r]=new RegExp(t+(0,s.globToRegexp)(r)+n,"i")),e.cachedGlobToRegex[r]}},{key:"valueForDottedKey",value:function(e,t){var r,n=e.split("."),i=n[0];for("content"===i?(r=t.getContent(),n.shift()):"type"===i?(r=t.getType(),n.shift()):r=t.event;n.length>0;){var o=n.shift();if((0,s.isNullOrUndefined)(r[o]))return null;r=r[o]}return r}},{key:"matchingRuleForEventWithRulesets",value:function(e,t){return t?e.getSender()===this.client.credentials.userId?null:this.matchingRuleFromKindSet(e,t.global):null}},{key:"pushActionsForEventAndRulesets",value:function(t,r){var n=this.matchingRuleForEventWithRulesets(t,r);if(!n)return{};var i=e.actionListToActionsObject(n.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight=n.kind==l.PushRuleKind.ContentSpecific),i}},{key:"ruleMatchesEvent",value:function(e,t){var r,n=this;return!(null!==(r=e.conditions)&&void 0!==r&&r.some((function(e){return!n.eventFulfillsCondition(e,t)})))}},{key:"actionsForEvent",value:function(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}},{key:"getPushRuleById",value:function(e){for(var t=0,r=["global"];t<r.length;t++){var n,i=r[t];if(void 0!==(null===(n=this.client.pushRules)||void 0===n?void 0:n[i])){var o=!0,a=!1,s=void 0;try{for(var u,l=h[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(void 0!==this.client.pushRules[i][c]){var d=!0,f=!1,p=void 0;try{for(var v,g=this.client.pushRules[i][c][Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var m=v.value;if(m.rule_id===e)return m}}catch(e){f=!0,p=e}finally{try{d||null==g.return||g.return()}finally{if(f)throw p}}}}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}}}return null}}],[{key:"actionListToActionsObject",value:function(e){var t={notify:!1,tweaks:{}},r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;s===l.PushRuleActionName.Notify?t.notify=!0:"object"==typeof s&&(void 0===s.value&&(s.value=!0),t.tweaks[s.set_tweak]=s.value)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"rewriteDefaultRules",value:function(e){var t,r=JSON.parse(JSON.stringify(e));r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.override||(r.global.underride=[]);var n=r.global.override,i=!0,o=!1,a=void 0;try{for(var s,l=function(){var e=s.value,t=n.find((function(t){return t.rule_id===e.rule_id}));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{var r=e.rule_id;u.logger.warn("Adding default global override for ".concat(r)),n.push(e)}},c=p[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)l()}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}var d=null!==(t=r.global.underride)&&void 0!==t?t:[],f=!0,h=!1,g=void 0;try{for(var m,y=function(){var e=m.value,t=d.find((function(t){return t.rule_id===e.rule_id}));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{var r=e.rule_id;u.logger.warn("Adding default global underride for ".concat(r)),d.push(e)}},b=v[Symbol.iterator]();!(f=(m=b.next()).done);f=!0)y()}catch(e){h=!0,g=e}finally{try{f||null==b.return||b.return()}finally{if(h)throw g}}return r}}]),e}();e.exports.PushProcessor=g,(0,a.default)(g,"cachedGlobToRegex",{})})),n.register("2jbfh",(function(e,t){"use strict";var r,n,i,o,a,s;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TweakName=e.exports.RuleId=e.exports.PushRuleKind=e.exports.PushRuleActionName=e.exports.DMMemberCountCondition=e.exports.ConditionOperator=e.exports.ConditionKind=void 0,e.exports.isDmMemberCountCondition=function(e){return"==2"===e||"2"===e},e.exports.PushRuleActionName=r,(n=r||(e.exports.PushRuleActionName=r={})).DontNotify="dont_notify",n.Notify="notify",n.Coalesce="coalesce",e.exports.TweakName=i,(o=i||(e.exports.TweakName=i={})).Highlight="highlight",o.Sound="sound",e.exports.ConditionOperator=a,(s=a||(e.exports.ConditionOperator=a={})).ExactEquals="==",s.LessThan="<",s.GreaterThan=">",s.GreaterThanOrEqual=">=",s.LessThanOrEqual="<=";var u,l,c,d,f,h;e.exports.DMMemberCountCondition="2",e.exports.ConditionKind=u,(l=u||(e.exports.ConditionKind=u={})).EventMatch="event_match",l.ContainsDisplayName="contains_display_name",l.RoomMemberCount="room_member_count",l.SenderNotificationPermission="sender_notification_permission",l.CallStarted="call_started",l.CallStartedPrefix="org.matrix.msc3914.call_started",e.exports.PushRuleKind=c,(d=c||(e.exports.PushRuleKind=c={})).Override="override",d.ContentSpecific="content",d.RoomSpecific="room",d.SenderSpecific="sender",d.Underride="underride",e.exports.RuleId=f,(h=f||(e.exports.RuleId=f={})).Master=".m.rule.master",h.ContainsDisplayName=".m.rule.contains_display_name",h.ContainsUserName=".m.rule.contains_user_name",h.AtRoomNotification=".m.rule.roomnotif",h.DM=".m.rule.room_one_to_one",h.EncryptedDM=".m.rule.encrypted_room_one_to_one",h.Message=".m.rule.message",h.EncryptedMessage=".m.rule.encrypted",h.InviteToSelf=".m.rule.invite_for_me",h.MemberEvent=".m.rule.member_event",h.IncomingCall=".m.rule.call",h.SuppressNotices=".m.rule.suppress_notices",h.Tombstone=".m.rule.tombstone"})),n.register("bzllY",(function(e,t){var r=n("kxanC"),i=n("cksMj"),o=n("hcUaE"),a=n("giCK6"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.KeySignatureUploadError=e.exports.InvalidStoreState=e.exports.InvalidStoreError=e.exports.InvalidCryptoStoreState=e.exports.InvalidCryptoStoreError=void 0;var u,l,c=s(n("3rHpI"));e.exports.InvalidStoreState=u,(l=u||(e.exports.InvalidStoreState=u={}))[l.ToggledLazyLoading=0]="ToggledLazyLoading";var d,f=function(e){(0,i.default)(n,e);var t=(0,a.default)(n);function n(e,i){var o;(0,r.default)(this,n);var a="Store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again";return(o=t.call(this,a)).reason=e,o.value=i,o.name="InvalidStoreError",o}return n}((0,o.default)(Error));e.exports.InvalidStoreError=f,(0,c.default)(f,"TOGGLED_LAZY_LOADING",u.ToggledLazyLoading),e.exports.InvalidCryptoStoreState=d,(d||(e.exports.InvalidCryptoStoreState=d={})).TooNew="TOO_NEW";var h=function(e){(0,i.default)(n,e);var t=(0,a.default)(n);function n(e){var i;(0,r.default)(this,n);var o="Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again";return(i=t.call(this,o)).reason=e,i.name="InvalidCryptoStoreError",i}return n}((0,o.default)(Error));e.exports.InvalidCryptoStoreError=h,(0,c.default)(h,"TOO_NEW",d.TooNew);var p=function(e){(0,i.default)(n,e);var t=(0,a.default)(n);function n(e,i){var o;return(0,r.default)(this,n),(o=t.call(this,e)).value=i,o}return n}((0,o.default)(Error));e.exports.KeySignatureUploadError=p})),n.register("6BFg8",(function(e,t){var i=n("Yawv5"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("9oGi2"),l=n("giCK6"),c=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0});var d={MatrixHttpApi:!0};e.exports.MatrixHttpApi=void 0;var f=c(n("3rHpI")),h=n("joAkx"),p=n("iJZCZ");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(d,t)||t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var v=S(n("e8gas")),g=S(n("8haOs")),m=n("5ShWb");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(d,t)||t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var y=n("irlqL");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(d,t)||t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=n("fpxk0");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(d,t)||t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var _=n("81Tbg");function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(w=function(e){return e?r:t})(e)}function S(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=w(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(d,t)||t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var E=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var s;return(0,o.default)(this,n),s=t.call.apply(t,[this].concat((0,u.default)(r))),(0,f.default)((0,i.default)(s),"uploads",[]),s}return(0,a.default)(n,[{key:"uploadContent",value:function(e){var t,n,i,o,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=this,l=null===(t=s.includeFilename)||void 0===t||t,c=null!==(n=s.abortController)&&void 0!==n?n:new AbortController,d=null!==(i=null!==(o=s.type)&&void 0!==o?o:e.type)&&void 0!==i?i:"application/octet-stream",f=null!==(a=s.name)&&void 0!==a?a:e.name,h={loaded:0,total:0,abortController:c},_=v.defer();if(r.XMLHttpRequest){var w=new r.XMLHttpRequest,S=function(){w.abort(),_.reject(new Error("Timeout"))},E=g.setTimeout(S,3e4);w.onreadystatechange=function(){if(w.readyState===r.XMLHttpRequest.DONE){g.clearTimeout(E);try{if(0===w.status)throw new DOMException(w.statusText,"AbortError");if(!w.responseText)throw new Error("No response body.");w.status>=400?_.reject((0,b.parseErrorResponse)(w,w.responseText)):_.resolve(JSON.parse(w.responseText))}catch(e){if("AbortError"===e.name)return void _.reject(e);_.reject(new y.ConnectionError("request failed",e))}}},w.upload.onprogress=function(e){var t;g.clearTimeout(E),h.loaded=e.loaded,h.total=e.total,E=g.setTimeout(S,3e4),null===(t=s.progressHandler)||void 0===t||t.call(s,{loaded:e.loaded,total:e.total})};var k=this.getUrl("/upload",void 0,p.MediaPrefix.R0);l&&f&&k.searchParams.set("filename",encodeURIComponent(f)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&k.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),w.open(m.Method.Post,k.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&w.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),w.setRequestHeader("Content-Type",d),w.send(e),c.signal.addEventListener("abort",(function(){w.abort()}))}else{var M={};l&&f&&(M.filename=f);var C={"Content-Type":d};this.authedRequest(m.Method.Post,"/upload",M,e,{prefix:p.MediaPrefix.R0,headers:C,abortSignal:c.signal}).then((function(e){return u.opts.onlyData?e:e.json()})).then(_.resolve,_.reject)}return h.promise=_.promise.finally((function(){v.removeElement(u.uploads,(function(e){return e===h}))})),c.signal.addEventListener("abort",(function(){v.removeElement(u.uploads,(function(e){return e===h})),_.reject(new DOMException("Aborted","AbortError"))})),this.uploads.push(h),h.promise}},{key:"cancelUpload",value:function(e){var t=this.uploads.find((function(t){return t.promise===e}));return!!t&&(t.abortController.abort(),!0)}},{key:"getCurrentUploads",value:function(){return this.uploads}},{key:"getContentUri",value:function(){return{base:this.opts.baseUrl,path:p.MediaPrefix.R0+"/upload",params:{access_token:this.opts.accessToken}}}}]),n}(h.FetchHttpApi);e.exports.MatrixHttpApi=E})),n.register("joAkx",(function(e,t){var i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("eQNFO"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.FetchHttpApi=void 0;var l=u(n("3rHpI")),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),d=n("5ShWb"),f=n("irlqL"),h=n("81Tbg"),p=n("fpxk0");function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}var g=function(){function e(t,r){var n;(0,o.default)(this,e),this.eventEmitter=t,this.opts=r,(0,l.default)(this,"abortController",new AbortController),c.checkObjectHasKeys(r,["baseUrl","prefix"]),r.onlyData=!!r.onlyData,r.useAuthorizationHeader=null===(n=r.useAuthorizationHeader)||void 0===n||n}return(0,a.default)(e,[{key:"abort",value:function(){this.abortController.abort(),this.abortController=new AbortController}},{key:"fetch",value:function(e,t){return this.opts.fetchFn?this.opts.fetchFn(e,t):r.fetch(e,t)}},{key:"setIdBaseUrl",value:function(e){this.opts.idBaseUrl=e}},{key:"idServerRequest",value:function(e,t,r,n,i){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,a=void 0;e===d.Method.Get?o=r:a=r;var s=this.getUrl(t,o,n,this.opts.idBaseUrl),u={json:!0,headers:{}};return i&&(u.headers.Authorization="Bearer ".concat(i)),this.requestOtherUrl(e,s,a,u)}},{key:"authedRequest",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=this;r||(r={}),this.opts.accessToken&&(this.opts.useAuthorizationHeader?(i.headers||(i.headers={}),i.headers.Authorization||(i.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken));var a=this.request(e,t,r,n,i);return a.catch((function(e){"M_UNKNOWN_TOKEN"!=e.errcode||null!=i&&i.inhibitLogoutEmit?"M_CONSENT_NOT_GIVEN"==e.errcode&&o.eventEmitter.emit(h.HttpApiEvent.NoConsent,e.message,e.data.consent_uri):o.eventEmitter.emit(h.HttpApiEvent.SessionLoggedOut,e)})),a}},{key:"request",value:function(e,t,r,n,i){var o=this.getUrl(t,r,null==i?void 0:i.prefix,null==i?void 0:i.baseUrl);return this.requestOtherUrl(e,o,n,i)}},{key:"requestOtherUrl",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=this;return(0,i.default)((function(){var i,a,u,l,c,d,h,v,g,m,y,b,_,w,S,E,k,M;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:c=Object.assign({},n.headers||{}),d=null===(i=n.json)||void 0===i||i,h=d&&(null==r||null===(a=r.constructor)||void 0===a?void 0:a.name)===Object.name,d&&(h&&!c["Content-Type"]&&(c["Content-Type"]="application/json"),c.Accept||(c.Accept="application/json")),v=null!==(u=n.localTimeoutMs)&&void 0!==u?u:o.opts.localTimeoutMs,g=null!==(l=n.keepAlive)&&void 0!==l&&l,m=[o.abortController.signal],void 0!==v&&m.push((0,p.timeoutSignal)(v)),n.abortSignal&&m.push(n.abortSignal),y=h?JSON.stringify(r):r,b=(0,p.anySignal)(m),_=b.signal,w=b.cleanup,s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,o.fetch(t,{signal:_,method:e,body:y,headers:c,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:g})];case 2:return S=s.sent(),[3,5];case 3:if("AbortError"===(E=s.sent()).name)throw E;throw new f.ConnectionError("fetch failed",E);case 4:return w(),[7];case 5:return S.ok?[3,7]:(k=p.parseErrorResponse,M=[S],[4,S.text()]);case 6:throw k.apply(void 0,M.concat([s.sent()]));case 7:return o.opts.onlyData?[2,d?S.json():S.text()]:[2,S]}}))}))()}},{key:"getUrl",value:function(e,t,r,n){var i=new URL((null!=n?n:this.opts.baseUrl)+(null!=r?r:this.opts.prefix)+e);return t&&c.encodeParams(t,i.searchParams),i}}]),e}();e.exports.FetchHttpApi=g})),n.register("5ShWb",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Method=void 0,e.exports.Method=r,(n=r||(e.exports.Method=r={})).Get="GET",n.Put="PUT",n.Post="POST",n.Delete="DELETE"})),n.register("irlqL",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("hcUaE"),u=n("giCK6"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixError=e.exports.HTTPError=e.exports.ConnectionError=void 0;var c=l(n("3rHpI")),d=function(e){(0,a.default)(r,e);var t=(0,u.default)(r);function r(e,n){var o;return(0,i.default)(this,r),(o=t.call(this,e)).httpStatus=n,o}return r}((0,s.default)(Error));e.exports.HTTPError=d;var f=function(e){(0,a.default)(n,e);var t=(0,u.default)(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0;(0,i.default)(this,n);var l=o.error||"Unknown message";return a&&(l="[".concat(a,"] ").concat(l)),s&&(l="".concat(l," (").concat(s,")")),(e=t.call(this,"MatrixError: ".concat(l),a)).httpStatus=a,e.url=s,e.event=u,(0,c.default)((0,r.default)(e),"errcode",void 0),(0,c.default)((0,r.default)(e),"data",void 0),e.errcode=o.errcode,e.name=o.errcode||"Unknown error code",e.data=o,e}return n}(d);e.exports.MatrixError=f;var h=function(e){(0,a.default)(r,e);var t=(0,u.default)(r);function r(e,n){return(0,i.default)(this,r),t.call(this,e+(n?": ".concat(n.message):""))}return(0,o.default)(r,[{key:"name",get:function(){return"ConnectionError"}}]),r}((0,s.default)(Error));e.exports.ConnectionError=h})),n.register("81Tbg",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.HttpApiEvent=void 0,e.exports.HttpApiEvent=r,(n=r||(e.exports.HttpApiEvent=r={})).SessionLoggedOut="Session.logged_out",n.NoConsent="no_consent"})),n.register("fpxk0",(function(e,t){var r=n("2swew"),i=n("eQNFO");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.anySignal=function(e){var t=new AbortController;function r(){var t=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.removeEventListener("abort",n)}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}}function n(){t.abort(),r()}var i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.aborted){n();break}l.addEventListener("abort",n)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return{signal:t.signal,cleanup:r}},e.exports.parseErrorResponse=function(e,t){var r,n,i;try{i=function(e){var t;t=l(e)?e.getResponseHeader("Content-Type"):e.headers.get("Content-Type");if(!t)return null;try{return(0,o.parse)(t)}catch(e){throw new Error("Error parsing Content-Type '".concat(t,"': ").concat(e))}}(e)}catch(e){return e}return"application/json"===(null===(r=i)||void 0===r?void 0:r.type)&&t?new u.MatrixError(JSON.parse(t),e.status,l(e)?e.responseURL:e.url):"text/plain"===(null===(n=i)||void 0===n?void 0:n.type)?new u.HTTPError("Server returned ".concat(e.status," error: ").concat(t),e.status):new u.HTTPError("Server returned ".concat(e.status," error"),e.status)},e.exports.retryNetworkOperation=function(e,t){return c.apply(this,arguments)},e.exports.timeoutSignal=function(e){var t=new AbortController;return setTimeout((function(){t.abort()}),e),t.signal};var o=n("2u5cr"),a=n("jtqeE"),s=n("e8gas"),u=n("irlqL");function l(e){return"getResponseHeader"in e}function c(){return(c=(0,r.default)((function(e,t){var r,n,o,l;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:r=0,n=null,i.label=1;case 1:if(!(r<e))return[3,8];i.label=2;case 2:return i.trys.push([2,6,,7]),r>0?(o=1e3*Math.pow(2,r),a.logger.log("network operation failed ".concat(r," times, retrying in ").concat(o,"ms...")),[4,(0,s.sleep)(o)]):[3,4];case 3:i.sent(),i.label=4;case 4:return[4,t()];case 5:return[2,i.sent()];case 6:if(!((l=i.sent())instanceof u.ConnectionError))throw l;return r+=1,n=l,[3,7];case 7:return[3,1];case 8:throw n}}))}))).apply(this,arguments)}})),n.register("2u5cr",(function(t,r){
/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
var n;e(t.exports,"parse",(function(){return n}),(function(e){return n=e}));var i=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,o=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,a=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,u=/([\\"])/g,l=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(a.test(t))return t;if(t.length>0&&!o.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(u,"\\$1")+'"'}function d(e){this.parameters=Object.create(null),this.type=e}n=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;"function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var r=t.indexOf(";"),n=-1!==r?t.slice(0,r).trim():t.trim();if(!l.test(n))throw new TypeError("invalid media type");var o=new d(n.toLowerCase());if(-1!==r){var a,u,c;for(i.lastIndex=r;u=i.exec(t);){if(u.index!==r)throw new TypeError("invalid parameter format");r+=u[0].length,a=u[1].toLowerCase(),34===(c=u[2]).charCodeAt(0)&&-1!==(c=c.slice(1,-1)).indexOf("\\")&&(c=c.replace(s,"$1")),o.parameters[a]=c}if(r!==t.length)throw new TypeError("invalid parameter format")}return o}})),n.register("iJZCZ",(function(e,t){"use strict";var r,n,i,o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MediaPrefix=e.exports.IdentityPrefix=e.exports.ClientPrefix=void 0,e.exports.ClientPrefix=r,(n=r||(e.exports.ClientPrefix=r={})).R0="/_matrix/client/r0",n.V1="/_matrix/client/v1",n.V3="/_matrix/client/v3",n.Unstable="/_matrix/client/unstable",e.exports.IdentityPrefix=i,(i||(e.exports.IdentityPrefix=i={})).V2="/_matrix/identity/v2",e.exports.MediaPrefix=o,(o||(e.exports.MediaPrefix=o={})).R0="/_matrix/media/r0"})),n.register("8haOs",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.clearTimeout=function(e){if(0===s.length)return;var t;for(t=0;t<s.length;t++){if(s[t].key==e){s.splice(t,1);break}}0===t&&l()},e.exports.setTimeout=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];(t=t||0)<0&&(t=0);var o=Date.now()+t,c=a++;u("setTimeout: scheduling cb",c,"at",o,"(delay",t,")");var f={runAt:o,func:e,params:n,key:c},h=d(s,(function(e){return e.runAt-o}));return s.splice(h,0,f),l(),c};var i,o=n("jtqeE"),a=0,s=[],u=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]};function l(){i&&r.clearTimeout(i);var e=s[0];if(e){var t=Date.now(),n=Math.min(e.runAt-t,1e3);u("scheduleRealCallback: now:",t,"delay:",n),i=r.setTimeout(c,n)}else u("scheduleRealCallback: no more callbacks, not rescheduling")}function c(){var e=Date.now();u("runCallbacks: now:",e);for(var t=[];;){var n=s[0];if(!n||n.runAt>e)break;var i=s.shift();u("runCallbacks: popping",i.key),t.push(i)}l();var a=!0,c=!1,d=void 0;try{for(var f,h=t[Symbol.iterator]();!(a=(f=h.next()).done);a=!0){var p=f.value;try{p.func.apply(r,p.params)}catch(e){o.logger.error("Uncaught exception in callback function",e)}}}catch(e){c=!0,d=e}finally{try{a||null==h.return||h.return()}finally{if(c)throw d}}}function d(e,t){for(var r=0,n=e.length;r<n;){var i=r+n>>1;t(e[i])>0?n=i:r=i+1}return r}})),n.register("Vikqw",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.StubStore=void 0;var u=s(n("3rHpI")),l=function(){function e(){(0,i.default)(this,e),(0,u.default)(this,"accountData",{}),(0,u.default)(this,"fromToken",null)}return(0,o.default)(e,[{key:"isNewlyCreated",value:function(){return Promise.resolve(!0)}},{key:"getSyncToken",value:function(){return this.fromToken}},{key:"setSyncToken",value:function(e){this.fromToken=e}},{key:"storeRoom",value:function(e){}},{key:"getRoom",value:function(e){return null}},{key:"getRooms",value:function(){return[]}},{key:"removeRoom",value:function(e){}},{key:"getRoomSummaries",value:function(){return[]}},{key:"storeUser",value:function(e){}},{key:"getUser",value:function(e){return null}},{key:"getUsers",value:function(){return[]}},{key:"scrollback",value:function(e,t){return[]}},{key:"storeEvents",value:function(e,t,r,n){}},{key:"storeFilter",value:function(e){}},{key:"getFilter",value:function(e,t){return null}},{key:"getFilterIdByName",value:function(e){return null}},{key:"setFilterIdByName",value:function(e,t){}},{key:"storeAccountDataEvents",value:function(e){}},{key:"getAccountData",value:function(e){}},{key:"setSyncData",value:function(e){return Promise.resolve()}},{key:"wantsSave",value:function(){return!1}},{key:"save",value:function(){}},{key:"startup",value:function(){return Promise.resolve()}},{key:"getSavedSync",value:function(){return Promise.resolve(null)}},{key:"getSavedSyncToken",value:function(){return Promise.resolve(null)}},{key:"deleteAllData",value:function(){return Promise.resolve()}},{key:"getOutOfBandMembers",value:function(){return Promise.resolve(null)}},{key:"setOutOfBandMembers",value:function(e,t){return Promise.resolve()}},{key:"clearOutOfBandMembers",value:function(){return Promise.resolve()}},{key:"getClientOptions",value:function(){return Promise.resolve(void 0)}},{key:"storeClientOptions",value:function(e){return Promise.resolve()}},{key:"getPendingEvents",value:function(e){return(0,r.default)((function(){return(0,a.__generator)(this,(function(e){return[2,[]]}))}))()}},{key:"setPendingEvents",value:function(e,t){return Promise.resolve()}},{key:"saveToDeviceBatches",value:function(e){return(0,r.default)((function(){return(0,a.__generator)(this,(function(e){return[2,Promise.resolve()]}))}))()}},{key:"getOldestToDeviceBatch",value:function(){return Promise.resolve(null)}},{key:"removeToDeviceBatch",value:function(e){return(0,r.default)((function(){return(0,a.__generator)(this,(function(e){return[2,Promise.resolve()]}))}))()}}]),e}();e.exports.StubStore=l})),n.register("iTgYJ",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("cksMj"),l=n("mBz5n"),c=n("9oGi2"),d=n("hcUaE"),f=n("giCK6"),h=n("eQNFO"),p=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixCall=e.exports.CallType=e.exports.CallState=e.exports.CallParty=e.exports.CallEvent=e.exports.CallErrorCode=e.exports.CallError=e.exports.CallDirection=void 0,e.exports.createNewMatrixCall=function(e,t,r){if(!Q())return null;var n=!!r&&r.forceTURN,i={client:e,roomId:t,invitee:null==r?void 0:r.invitee,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||n,opponentDeviceId:null==r?void 0:r.opponentDeviceId,opponentSessionId:null==r?void 0:r.opponentSessionId,groupCallId:null==r?void 0:r.groupCallId},o=new $(i);return e.reEmitter.reEmit(o,Object.values(C)),o},e.exports.genCallID=z,e.exports.setTracksEnabled=J,e.exports.supportsMatrixCall=Q;var v,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x=p(n("3rHpI")),O=n("329cj"),A=n("63YOu"),D=n("jtqeE"),P=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=W(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),L=n("8bPbt"),U=n("94a5L"),j=n("ipwmE"),N=n("3Jrxc"),B=n("6MMVS"),F=n("1fjoF"),K=n("fu2Ru"),q=n("6BFg8");function W(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(W=function(e){return e?r:t})(e)}function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){(0,x.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}(g=v||(v={})).AUDIO="audio",g.VIDEO="video",(m||(m={})).OPUS="opus",e.exports.CallState=y,(b=y||(e.exports.CallState=y={})).Fledgling="fledgling",b.InviteSent="invite_sent",b.WaitLocalMedia="wait_local_media",b.CreateOffer="create_offer",b.CreateAnswer="create_answer",b.Connecting="connecting",b.Connected="connected",b.Ringing="ringing",b.Ended="ended",e.exports.CallType=_,(w=_||(e.exports.CallType=_={})).Voice="voice",w.Video="video",e.exports.CallDirection=S,(E=S||(e.exports.CallDirection=S={})).Inbound="inbound",E.Outbound="outbound",e.exports.CallParty=k,(M=k||(e.exports.CallParty=k={})).Local="local",M.Remote="remote",e.exports.CallEvent=C,(I=C||(e.exports.CallEvent=C={})).Hangup="hangup",I.State="state",I.Error="error",I.Replaced="replaced",I.LocalHoldUnhold="local_hold_unhold",I.RemoteHoldUnhold="remote_hold_unhold",I.HoldUnhold="hold_unhold",I.FeedsChanged="feeds_changed",I.AssertedIdentityChanged="asserted_identity_changed",I.LengthChanged="length_changed",I.DataChannel="datachannel",I.SendVoipEvent="send_voip_event",e.exports.CallErrorCode=T,(R=T||(e.exports.CallErrorCode=T={})).UserHangup="user_hangup",R.LocalOfferFailed="local_offer_failed",R.NoUserMedia="no_user_media",R.UnknownDevices="unknown_devices",R.SendInvite="send_invite",R.CreateAnswer="create_answer",R.CreateOffer="create_offer",R.SendAnswer="send_answer",R.SetRemoteDescription="set_remote_description",R.SetLocalDescription="set_local_description",R.AnsweredElsewhere="answered_elsewhere",R.IceFailed="ice_failed",R.InviteTimeout="invite_timeout",R.Replaced="replaced",R.SignallingFailed="signalling_timeout",R.UserBusy="user_busy",R.Transfered="transferred",R.NewSession="new_session";var G=function(e){(0,u.default)(n,e);var t=(0,f.default)(n);function n(e,i,a){var s;return(0,o.default)(this,n),s=t.call(this,i+": "+a),(0,x.default)((0,r.default)(s),"code",void 0),s.code=e,s}return n}((0,d.default)(Error));function z(){return Date.now().toString()+(0,U.randomString)(16)}function Y(e){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:e?12e3:void 0}]}function Z(e,t){return e+":"+t}e.exports.CallError=G;var $=function(e){(0,u.default)(n,e);var t=(0,f.default)(n);function n(e){var a,s;(0,o.default)(this,n),a=t.call(this),(0,x.default)((0,r.default)(a),"roomId",void 0),(0,x.default)((0,r.default)(a),"callId",void 0),(0,x.default)((0,r.default)(a),"invitee",void 0),(0,x.default)((0,r.default)(a),"hangupParty",void 0),(0,x.default)((0,r.default)(a),"hangupReason",void 0),(0,x.default)((0,r.default)(a),"direction",void 0),(0,x.default)((0,r.default)(a),"ourPartyId",void 0),(0,x.default)((0,r.default)(a),"peerConn",void 0),(0,x.default)((0,r.default)(a),"toDeviceSeq",0),(0,x.default)((0,r.default)(a),"isPtt",!1),(0,x.default)((0,r.default)(a),"_state",y.Fledgling),(0,x.default)((0,r.default)(a),"client",void 0),(0,x.default)((0,r.default)(a),"forceTURN",void 0),(0,x.default)((0,r.default)(a),"turnServers",void 0),(0,x.default)((0,r.default)(a),"candidateSendQueue",[]),(0,x.default)((0,r.default)(a),"candidateSendTries",0),(0,x.default)((0,r.default)(a),"candidatesEnded",!1),(0,x.default)((0,r.default)(a),"feeds",[]),(0,x.default)((0,r.default)(a),"transceivers",new Map),(0,x.default)((0,r.default)(a),"inviteOrAnswerSent",!1),(0,x.default)((0,r.default)(a),"waitForLocalAVStream",!1),(0,x.default)((0,r.default)(a),"successor",void 0),(0,x.default)((0,r.default)(a),"opponentMember",void 0),(0,x.default)((0,r.default)(a),"opponentVersion",void 0),(0,x.default)((0,r.default)(a),"opponentPartyId",void 0),(0,x.default)((0,r.default)(a),"opponentCaps",void 0),(0,x.default)((0,r.default)(a),"iceDisconnectedTimeout",void 0),(0,x.default)((0,r.default)(a),"inviteTimeout",void 0),(0,x.default)((0,r.default)(a),"removeTrackListeners",new Map),(0,x.default)((0,r.default)(a),"remoteOnHold",!1),(0,x.default)((0,r.default)(a),"callStatsAtEnd",void 0),(0,x.default)((0,r.default)(a),"makingOffer",!1),(0,x.default)((0,r.default)(a),"ignoreOffer",!1),(0,x.default)((0,r.default)(a),"responsePromiseChain",void 0),(0,x.default)((0,r.default)(a),"remoteCandidateBuffer",new Map),(0,x.default)((0,r.default)(a),"remoteAssertedIdentity",void 0),(0,x.default)((0,r.default)(a),"remoteSDPStreamMetadata",void 0),(0,x.default)((0,r.default)(a),"callLengthInterval",void 0),(0,x.default)((0,r.default)(a),"callStartTime",void 0),(0,x.default)((0,r.default)(a),"opponentDeviceId",void 0),(0,x.default)((0,r.default)(a),"opponentDeviceInfo",void 0),(0,x.default)((0,r.default)(a),"opponentSessionId",void 0),(0,x.default)((0,r.default)(a),"groupCallId",void 0),(0,x.default)((0,r.default)(a),"gotLocalIceCandidate",(function(e){if(e.candidate){if(a.candidatesEnded)return void D.logger.warn("Got candidate after candidates have ended - ignoring!");if(D.logger.debug("Call "+a.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),a.callHasEnded())return;""===e.candidate.candidate?a.queueCandidate(null):a.queueCandidate(e.candidate)}})),(0,x.default)((0,r.default)(a),"onIceGatheringStateChange",(function(e){var t;D.logger.debug("Call ".concat(a.callId," ice gathering state changed to  ").concat(a.peerConn.iceGatheringState)),"complete"===(null===(t=a.peerConn)||void 0===t?void 0:t.iceGatheringState)&&a.queueCandidate(null)})),(0,x.default)((0,r.default)(a),"getLocalOfferFailed",(function(e){D.logger.error("Call ".concat(a.callId," Failed to get local offer"),e),a.emit(C.Error,new G(T.LocalOfferFailed,"Failed to get local offer!",e)),a.terminate(k.Local,T.LocalOfferFailed,!1)})),(0,x.default)((0,r.default)(a),"getUserMediaFailed",(function(e){a.successor?a.successor.getUserMediaFailed(e):(D.logger.warn("Failed to get user media - ending call ".concat(a.callId),e),a.emit(C.Error,new G(T.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),a.terminate(k.Local,T.NoUserMedia,!1))})),(0,x.default)((0,r.default)(a),"onIceConnectionStateChanged",(function(){var e,t,r,n,i;if(!a.callHasEnded()){if(D.logger.debug("Call ID "+a.callId+": ICE connection state changed to: "+(null===(e=a.peerConn)||void 0===e?void 0:e.iceConnectionState)),["connected","completed"].includes(null!==(t=null===(r=a.peerConn)||void 0===r?void 0:r.iceConnectionState)&&void 0!==t?t:""))clearTimeout(a.iceDisconnectedTimeout),a.state=y.Connected,a.callLengthInterval||a.callStartTime||(a.callStartTime=Date.now(),a.callLengthInterval=setInterval((function(){a.emit(C.LengthChanged,Math.round((Date.now()-a.callStartTime)/1e3))}),1e3));else if("failed"==(null===(n=a.peerConn)||void 0===n?void 0:n.iceConnectionState)){var o;null!==(o=a.peerConn)&&void 0!==o&&o.restartIce?(a.candidatesEnded=!1,a.peerConn.restartIce()):(D.logger.info("Hanging up call ".concat(a.callId," (ICE failed and no ICE restart method)")),a.hangup(T.IceFailed,!1))}else"disconnected"==(null===(i=a.peerConn)||void 0===i?void 0:i.iceConnectionState)&&(a.iceDisconnectedTimeout=setTimeout((function(){D.logger.info("Hanging up call ".concat(a.callId," (ICE disconnected for too long)")),a.hangup(T.IceFailed,!1)}),3e4),a.state=y.Connecting);var s=!0,u=!1,l=void 0;if(a.isPtt&&["failed","disconnected"].includes(a.peerConn.iceConnectionState))try{for(var c,d=a.getRemoteFeeds()[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){c.value.setAudioVideoMuted(!0,!0)}}catch(e){u=!0,l=e}finally{try{s||null==d.return||d.return()}finally{if(u)throw l}}}})),(0,x.default)((0,r.default)(a),"onSignallingStateChanged",(function(){var e;D.logger.debug("call ".concat(a.callId,": Signalling state changed to: ").concat(null===(e=a.peerConn)||void 0===e?void 0:e.signalingState))})),(0,x.default)((0,r.default)(a),"onTrack",(function(e){if(0!==e.streams.length){var t=e.streams[0];if(a.pushRemoteFeed(t),!a.removeTrackListeners.has(t)){var r=function(){0===t.getTracks().length&&(D.logger.info("Call ".concat(a.callId," removing track streamId: ").concat(t.id)),a.deleteFeedByStream(t),t.removeEventListener("removetrack",r),a.removeTrackListeners.delete(t))};t.addEventListener("removetrack",r),a.removeTrackListeners.set(t,r)}}else D.logger.warn("Call ".concat(a.callId," Streamless ").concat(e.track.kind," found: ignoring."))})),(0,x.default)((0,r.default)(a),"onDataChannel",(function(e){a.emit(C.DataChannel,e.channel)}));var u=(0,r.default)(a);if((0,x.default)((0,r.default)(a),"onNegotiationNeeded",(0,i.default)((function(){return(0,h.__generator)(this,(function(e){return D.logger.info("Call ".concat(u.callId," Negotiation is needed!")),u.state!==y.CreateOffer&&0===u.opponentVersion?(D.logger.info("Call ".concat(u.callId," Opponent does not support renegotiation: ignoring negotiationneeded event")),[2]):(u.queueGotLocalOffer(),[2])}))}))),(0,x.default)((0,r.default)(a),"onHangupReceived",(function(e){D.logger.debug("Hangup received for call ID "+a.callId),a.partyIdMatches(e)||a.state===y.Ringing?a.terminate(k.Remote,e.reason||T.UserHangup,!0):D.logger.info("Call ".concat(a.callId," Ignoring message from party ID ").concat(e.party_id,": our partner is ").concat(a.opponentPartyId))})),(0,x.default)((0,r.default)(a),"onRejectReceived",(function(e){D.logger.debug("Reject received for call ID "+a.callId),[y.InviteSent,y.Ringing].includes(a.state)||a.state===y.Fledgling&&a.direction===S.Inbound?a.terminate(k.Remote,e.reason||T.UserHangup,!0):D.logger.debug("Call ".concat(a.callId," is in state: ").concat(a.state,": ignoring reject"))})),(0,x.default)((0,r.default)(a),"onAnsweredElsewhere",(function(e){D.logger.debug("Call "+a.callId+" answered elsewhere"),a.terminate(k.Remote,T.AnsweredElsewhere,!0)})),a.roomId=e.roomId,a.invitee=e.invitee,a.client=e.client,!a.client.deviceId)throw new Error("Client must have a device ID to start calls");a.forceTURN=null!==(s=e.forceTURN)&&void 0!==s&&s,a.ourPartyId=a.client.deviceId,a.opponentDeviceId=e.opponentDeviceId,a.opponentSessionId=e.opponentSessionId,a.groupCallId=e.groupCallId,a.turnServers=e.turnServers||[],0===a.turnServers.length&&a.client.isFallbackICEServerAllowed()&&a.turnServers.push({urls:["stun:turn.matrix.org"]});var l=!0,c=!1,d=void 0;try{for(var f,p=a.turnServers[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var v=f.value;P.checkObjectHasKeys(v,["urls"])}}catch(e){c=!0,d=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw d}}return a.callId=z(),a}return(0,a.default)(n,[{key:"placeVoiceCall",value:function(){var e=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.placeCall(!0,!1)];case 1:return t.sent(),[2]}}))}))()}},{key:"placeVideoCall",value:function(){var e=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.placeCall(!0,!0)];case 1:return t.sent(),[2]}}))}))()}},{key:"createDataChannel",value:function(e,t){var r=this.peerConn.createDataChannel(e,t);return this.emit(C.DataChannel,r),r}},{key:"getOpponentMember",value:function(){return this.opponentMember}},{key:"getOpponentDeviceId",value:function(){return this.opponentDeviceId}},{key:"getOpponentSessionId",value:function(){return this.opponentSessionId}},{key:"opponentCanBeTransferred",value:function(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}},{key:"opponentSupportsDTMF",value:function(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}},{key:"getRemoteAssertedIdentity",value:function(){return this.remoteAssertedIdentity}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;this._state=e,this.emit(C.State,e,t)}},{key:"type",get:function(){return this.hasLocalUserMediaVideoTrack||this.hasRemoteUserMediaVideoTrack?_.Video:_.Voice}},{key:"hasLocalUserMediaVideoTrack",get:function(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getVideoTracks().length)}},{key:"hasRemoteUserMediaVideoTrack",get:function(){return this.getRemoteFeeds().some((function(e){var t;return e.purpose===j.SDPStreamMetadataPurpose.Usermedia&&(null===(t=e.stream)||void 0===t?void 0:t.getVideoTracks().length)}))}},{key:"hasLocalUserMediaAudioTrack",get:function(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getAudioTracks().length)}},{key:"hasRemoteUserMediaAudioTrack",get:function(){return this.getRemoteFeeds().some((function(e){var t;return e.purpose===j.SDPStreamMetadataPurpose.Usermedia&&!(null===(t=e.stream)||void 0===t||!t.getAudioTracks().length)}))}},{key:"localUsermediaFeed",get:function(){return this.getLocalFeeds().find((function(e){return e.purpose===j.SDPStreamMetadataPurpose.Usermedia}))}},{key:"localScreensharingFeed",get:function(){return this.getLocalFeeds().find((function(e){return e.purpose===j.SDPStreamMetadataPurpose.Screenshare}))}},{key:"localUsermediaStream",get:function(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}},{key:"localScreensharingStream",get:function(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}},{key:"remoteUsermediaFeed",get:function(){return this.getRemoteFeeds().find((function(e){return e.purpose===j.SDPStreamMetadataPurpose.Usermedia}))}},{key:"remoteScreensharingFeed",get:function(){return this.getRemoteFeeds().find((function(e){return e.purpose===j.SDPStreamMetadataPurpose.Screenshare}))}},{key:"remoteUsermediaStream",get:function(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}},{key:"remoteScreensharingStream",get:function(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}},{key:"getFeedByStreamId",value:function(e){return this.getFeeds().find((function(t){return t.stream.id===e}))}},{key:"getFeeds",value:function(){return this.feeds}},{key:"getLocalFeeds",value:function(){return this.feeds.filter((function(e){return e.isLocal()}))}},{key:"getRemoteFeeds",value:function(){return this.feeds.filter((function(e){return!e.isLocal()}))}},{key:"initOpponentCrypto",value:function(){var e=this;return(0,i.default)((function(){var t,r,n;return(0,h.__generator)(this,(function(i){switch(i.label){case 0:if(!e.opponentDeviceId)return[2];if(!e.client.getUseE2eForGroupCall())return[2];if(!e.client.isCryptoEnabled())return e.opponentDeviceInfo=new F.DeviceInfo(e.opponentDeviceId),[2];if(!e.client.crypto)throw new Error("Crypto is not initialised.");if(!(r=e.invitee||(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId)))throw new Error("Couldn't find opponent user ID to init crypto");return[4,e.client.crypto.deviceList.downloadKeys([r],!1)];case 1:if(n=i.sent(),e.opponentDeviceInfo=n[r][e.opponentDeviceId],void 0===e.opponentDeviceInfo)throw new K.GroupCallUnknownDeviceError(r);return[2]}}))}))()}},{key:"getLocalSDPStreamMetadata",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={},r=!0,n=!1,i=void 0;try{for(var o,a=this.getLocalFeeds()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;e&&(s.sdpMetadataStreamId=s.stream.id),t[s.sdpMetadataStreamId]={purpose:s.purpose,audio_muted:s.isAudioMuted(),video_muted:s.isVideoMuted()}}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"noIncomingFeeds",value:function(){return!this.feeds.some((function(e){return!e.isLocal()}))}},{key:"pushRemoteFeed",value:function(e){if(this.opponentSupportsSDPStreamMetadata()){var t=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,n=this.remoteSDPStreamMetadata[e.id].audio_muted,i=this.remoteSDPStreamMetadata[e.id].video_muted;r?this.getFeedByStreamId(e.id)?D.logger.warn("Ignoring stream with id ".concat(e.id," because we already have a feed for it")):(this.feeds.push(new N.CallFeed({client:this.client,call:this,roomId:this.roomId,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:n,videoMuted:i})),this.emit(C.FeedsChanged,this.feeds),D.logger.info("Call ".concat(this.callId,' pushed remote stream (id="').concat(e.id,'", ')+'active="'.concat(e.active,'", purpose=').concat(r,")"))):D.logger.warn("Call ".concat(this.callId," Ignoring stream with id ").concat(e.id," because we didn't get any metadata about it"))}else this.pushRemoteFeedWithoutMetadata(e)}},{key:"pushRemoteFeedWithoutMetadata",value:function(e){var t,r=this.getOpponentMember().userId,n=j.SDPStreamMetadataPurpose.Usermedia,i=null===(t=this.feeds.find((function(e){return!e.isLocal()})))||void 0===t?void 0:t.stream;i&&e.id!==i.id?D.logger.warn("Call ".concat(this.callId," Ignoring new stream ID ").concat(e.id,": we already have stream ID ").concat(i.id)):this.getFeedByStreamId(e.id)?D.logger.warn("Ignoring stream with id ".concat(e.id," because we already have a feed for it")):(this.feeds.push(new N.CallFeed({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n})),this.emit(C.FeedsChanged,this.feeds),D.logger.info("Call ".concat(this.callId,' pushed remote stream (id="').concat(e.id,'", active="').concat(e.active,'")')))}},{key:"pushNewLocalFeed",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.client.getUserId();J(e.getAudioTracks(),!0),J(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)?D.logger.warn("Ignoring stream with id ".concat(e.id," because we already have a feed for it")):this.pushLocalFeed(new N.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:t}),r)}},{key:"pushLocalFeed",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.feeds.some((function(t){return e.stream.id===t.stream.id})))D.logger.info("Ignoring duplicate local stream ".concat(e.stream.id," in call ").concat(this.callId));else{this.feeds.push(e);var r=!0,n=!1,i=void 0;if(t)try{for(var o,a=this,s=function(){var t=o.value;D.logger.info("Call ".concat(a.callId," ")+"Adding track ("+'id="'.concat(t.id,'", ')+'kind="'.concat(t.kind,'", ')+'streamId="'.concat(e.stream.id,'", ')+'streamPurpose="'.concat(e.purpose,'", ')+"enabled=".concat(t.enabled)+") to peer connection");var r=Z(e.purpose,t.kind);if(a.transceivers.has(r)){var n=a.transceivers.get(r);n.sender.setStreams&&n.sender.setStreams(e.stream),n.sender.replaceTrack(t),n.direction="inactive"===n.direction?"sendonly":"sendrecv"}else{var i=a.peerConn.addTrack(t,e.stream),s=a.peerConn.getTransceivers().find((function(e){return e.sender===i}));s?a.transceivers.set(r,s):D.logger.warn("Didn't find a matching transceiver after adding track!")}},u=e.stream.getTracks()[Symbol.iterator]();!(r=(o=u.next()).done);r=!0)s()}catch(e){n=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(n)throw i}}D.logger.info("Call ".concat(this.callId," ")+"Pushed local stream "+'(id="'.concat(e.stream.id,'", ')+'active="'.concat(e.stream.active,'", ')+'purpose="'.concat(e.purpose,'")')),this.emit(C.FeedsChanged,this.feeds)}}},{key:"removeLocalFeed",value:function(e){for(var t=0,r=[Z(e.purpose,"audio"),Z(e.purpose,"video")];t<r.length;t++){var n=r[t];if(this.transceivers.has(n)){var i=this.transceivers.get(n);i.sender&&this.peerConn.removeTrack(i.sender)}}e.purpose===j.SDPStreamMetadataPurpose.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}},{key:"deleteAllFeeds",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.feeds[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o.isLocal()&&this.groupCallId||o.dispose()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.feeds=[],this.emit(C.FeedsChanged,this.feeds)}},{key:"deleteFeedByStream",value:function(e){var t=this.getFeedByStreamId(e.id);t?this.deleteFeed(t):D.logger.warn("Call ".concat(this.callId," Didn't find the feed with stream id ").concat(e.id," to delete"))}},{key:"deleteFeed",value:function(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(C.FeedsChanged,this.feeds)}},{key:"getCurrentCallStats",value:function(){var e=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(t){return e.callHasEnded()?[2,e.callStatsAtEnd]:[2,e.collectCallStats()]}))}))()}},{key:"collectCallStats",value:function(){var e=this;return(0,i.default)((function(){var t,r;return(0,h.__generator)(this,(function(n){switch(n.label){case 0:return e.peerConn?[4,e.peerConn.getStats()]:[2];case 1:return t=n.sent(),r=[],t.forEach((function(e){r.push(e)})),[2,r]}}))}))()}},{key:"initWithInvite",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u;return(0,h.__generator)(this,(function(l){switch(l.label){case 0:return n=e.getContent(),t.direction=S.Inbound,[4,t.client.checkTurnServers()];case 1:return l.sent()||D.logger.warn("Call ".concat(t.callId," Failed to get TURN credentials! Proceeding with call anyway...")),(i=n[j.SDPStreamMetadataKey])?t.updateRemoteSDPStreamMetadata(i):D.logger.debug("Call ".concat(t.callId," did not get any SDPStreamMetadata! Can not send/receive multiple streams")),t.peerConn=t.createPeerConnection(),t.chooseOpponent(e),[4,t.initOpponentCrypto()];case 2:l.sent(),l.label=3;case 3:return l.trys.push([3,6,,7]),[4,t.peerConn.setRemoteDescription(n.offer)];case 4:return l.sent(),[4,t.addBufferedIceCandidates()];case 5:return l.sent(),[3,7];case 6:return o=l.sent(),D.logger.debug("Call ".concat(t.callId," failed to set remote description"),o),t.terminate(k.Local,T.SetRemoteDescription,!1),[2];case 7:return(a=null===(r=t.feeds.find((function(e){return!e.isLocal()})))||void 0===r?void 0:r.stream)&&0!==a.getTracks().length?(t.state=y.Ringing,e.getLocalAge()&&(s=setTimeout((function(){t.state==y.Ringing&&(D.logger.debug("Call ".concat(t.callId," invite has expired. Hanging up.")),t.hangupParty=k.Remote,t.state=y.Ended,t.stopAllMedia(),"closed"!=t.peerConn.signalingState&&t.peerConn.close(),t.emit(C.Hangup,t))}),n.lifetime-e.getLocalAge()),u=function(e){e!==y.Ringing&&(clearTimeout(s),t.off(C.State,u))},t.on(C.State,u)),[2]):(D.logger.error("Call ".concat(t.callId," no remote stream or no tracks after setting remote description!")),t.terminate(k.Local,T.SetRemoteDescription,!1),[2])}}))}))()}},{key:"initWithHangup",value:function(e){this.state=y.Ended}},{key:"shouldAnswerWithMediaType",value:function(e,t,r){return e&&!t?(D.logger.warn("Call ".concat(this.callId," Unable to answer with ").concat(r," because the other side isn't sending it either.")),!1):P.isNullOrUndefined(e)||e===t||this.opponentSupportsSDPStreamMetadata()?null!=e?e:t:(D.logger.warn("Call ".concat(this.callId," Unable to answer with ").concat(r,"=").concat(e," because the other side doesn't support it. Answering with ").concat(r,"=").concat(t,".")),t)}},{key:"answer",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,c;return(0,h.__generator)(this,(function(d){switch(d.label){case 0:if(r.inviteOrAnswerSent)return[2];if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(r.localUsermediaStream||r.waitForLocalAVStream)return[3,8];n=r.state,i=r.shouldAnswerWithMediaType(e,r.hasRemoteUserMediaAudioTrack,"audio"),o=r.shouldAnswerWithMediaType(t,r.hasRemoteUserMediaVideoTrack,"video"),r.state=y.WaitLocalMedia,r.waitForLocalAVStream=!0,d.label=1;case 1:return d.trys.push([1,3,,7]),[4,r.client.getMediaHandler().getUserMediaStream(i,o)];case 2:return s=d.sent(),r.waitForLocalAVStream=!1,u=new N.CallFeed({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:null!==(a=r.client.getDeviceId())&&void 0!==a?a:void 0,stream:s,purpose:j.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1}),l=[u],r.localScreensharingFeed&&l.push(r.localScreensharingFeed),r.answerWithCallFeeds(l),[3,7];case 3:return c=d.sent(),o?(D.logger.warn("Call ".concat(r.callId," Failed to getUserMedia(), trying to getUserMedia() without video")),r.state=n,r.waitForLocalAVStream=!1,[4,r.answer(i,!1)]):[3,5];case 4:return d.sent(),[3,6];case 5:return r.getUserMediaFailed(c),[2];case 6:return[3,7];case 7:return[3,9];case 8:r.waitForLocalAVStream&&(r.state=y.WaitLocalMedia),d.label=9;case 9:return[2]}}))}))()}},{key:"answerWithCallFeeds",value:function(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}},{key:"replacedBy",value:function(e){D.logger.debug("Call ".concat(this.callId," replaced by ").concat(e.callId)),this.state===y.WaitLocalMedia?(D.logger.debug("Call ".concat(this.callId," telling new call ").concat(e.callId," to wait for local media")),e.waitForLocalAVStream=!0):[y.CreateOffer,y.InviteSent].includes(this.state)&&(e.direction===S.Outbound?e.queueGotCallFeedsForAnswer([]):(D.logger.debug("Call ".concat(this.callId," handing local stream to new call ").concat(e.callId)),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map((function(e){return e.clone()}))))),this.successor=e,this.emit(C.Replaced,e),this.hangup(T.Replaced,!0)}},{key:"hangup",value:function(e,t){if(!this.callHasEnded()&&(D.logger.debug("Ending call ".concat(this.callId," with reason ").concat(e)),this.terminate(k.Local,e,!t),![y.Fledgling,y.WaitLocalMedia].includes(this.state))){var r={};(this.opponentVersion&&0!==this.opponentVersion||e!==T.UserHangup)&&(r.reason=e),this.sendVoipEvent(L.EventType.CallHangup,r)}}},{key:"reject",value:function(){if(this.state!==y.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return D.logger.info("Call ".concat(this.callId," Opponent version is less than 1 (").concat(this.opponentVersion,"): sending hangup instead of reject")),void this.hangup(T.UserHangup,!0);D.logger.debug("Rejecting call: "+this.callId),this.terminate(k.Local,T.UserHangup,!0),this.sendVoipEvent(L.EventType.CallReject,{})}},{key:"upgradeCall",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a;return(0,h.__generator)(this,(function(s){switch(s.label){case 0:if(!e&&!t)return[2];if(!r.opponentSupportsSDPStreamMetadata())return[2];s.label=1;case 1:return s.trys.push([1,4,,5]),D.logger.debug("Upgrading call ".concat(r.callId,": audio?=").concat(e," video?=").concat(t)),n=e||r.hasLocalUserMediaAudioTrack,i=t||r.hasLocalUserMediaVideoTrack,[4,r.client.getMediaHandler().getUserMediaStream(n,i,!1)];case 2:return o=s.sent(),[4,r.updateLocalUsermediaStream(o,e,t)];case 3:return s.sent(),[3,5];case 4:return a=s.sent(),D.logger.error("Call ".concat(r.callId," Failed to upgrade the call"),a),r.emit(C.Error,new G(T.NoUserMedia,"Failed to get camera access: ",a)),[3,5];case 5:return[2]}}))}))()}},{key:"opponentSupportsSDPStreamMetadata",value:function(){return Boolean(this.remoteSDPStreamMetadata)}},{key:"isScreensharing",value:function(){return Boolean(this.localScreensharingStream)}},{key:"setScreensharingEnabled",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l;return(0,h.__generator)(this,(function(c){switch(c.label){case 0:if(e&&r.isScreensharing())return D.logger.warn("Call ".concat(r.callId," There is already a screensharing stream - there is nothing to do!")),[2,!0];if(!e&&!r.isScreensharing())return D.logger.warn("Call ".concat(r.callId," There already isn't a screensharing stream - there is nothing to do!")),[2,!1];if(!r.opponentSupportsSDPStreamMetadata())return[2,r.setScreensharingEnabledWithoutMetadataSupport(e,t)];if(D.logger.debug("Call ".concat(r.callId," set screensharing enabled? ").concat(e)),!e)return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r.client.getMediaHandler().getScreensharingStream(t)];case 2:return(n=c.sent())?(r.pushNewLocalFeed(n,j.SDPStreamMetadataPurpose.Screenshare),[2,!0]):[2,!1];case 3:return i=c.sent(),D.logger.error("Call ".concat(r.callId," Failed to get screen-sharing stream:"),i),[2,!1];case 4:return[3,6];case 5:for(o=r.transceivers.get(Z(j.SDPStreamMetadataPurpose.Screenshare,"audio")),a=r.transceivers.get(Z(j.SDPStreamMetadataPurpose.Screenshare,"video")),s=0,u=[o,a];s<u.length;s++)(l=u[s])&&l.sender&&r.peerConn.removeTrack(l.sender);return r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),[2,!1];case 6:return[2]}}))}))()}},{key:"setScreensharingEnabledWithoutMetadataSupport",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,c,d;return(0,h.__generator)(this,(function(f){switch(f.label){case 0:if(D.logger.debug("Call ".concat(r.callId," Set screensharing enabled? ").concat(e," using replaceTrack()")),!e)return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,r.client.getMediaHandler().getScreensharingStream(t)];case 2:return(i=f.sent())?(o=i.getTracks().find((function(e){return"video"===e.kind})),null==(a=null===(n=r.transceivers.get(Z(j.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===n?void 0:n.sender)||a.replaceTrack(null!=o?o:null),r.pushNewLocalFeed(i,j.SDPStreamMetadataPurpose.Screenshare,!1),[2,!0]):[2,!1];case 3:return s=f.sent(),D.logger.error("Call ".concat(r.callId," Failed to get screen-sharing stream:"),s),[2,!1];case 4:return[3,6];case 5:return c=null===(u=r.localUsermediaStream)||void 0===u?void 0:u.getTracks().find((function(e){return"video"===e.kind})),null==(d=null===(l=r.transceivers.get(Z(j.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===l?void 0:l.sender)||d.replaceTrack(null!=c?c:null),r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),[2,!1];case 6:return[2]}}))}))()}},{key:"updateLocalUsermediaStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this;return(0,i.default)((function(){var i,o,a,s,u,l,c,d,f,p,v,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x,O,A,P,L,U,N,B,F,K;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:i=n.localUsermediaFeed,o=t||!i.isAudioMuted()&&!n.remoteOnHold,a=r||!i.isVideoMuted()&&!n.remoteOnHold,D.logger.log("call ".concat(n.callId," updateLocalUsermediaStream stream ").concat(e.id," audioEnabled ").concat(o," videoEnabled ").concat(a)),J(e.getAudioTracks(),o),J(e.getVideoTracks(),a),s=!0,u=!1,l=void 0;try{for(c=n.localUsermediaStream.getTracks()[Symbol.iterator]();!(s=(d=c.next()).done);s=!0)f=d.value,n.localUsermediaStream.removeTrack(f),f.stop()}catch(e){u=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(u)throw l}}p=!0,v=!1,g=void 0;try{for(m=e.getTracks()[Symbol.iterator]();!(p=(y=m.next()).done);p=!0)b=y.value,n.localUsermediaStream.addTrack(b)}catch(e){v=!0,g=e}finally{try{p||null==m.return||m.return()}finally{if(v)throw g}}for(_=0,w=["audio","video"];_<w.length;_++)S=w[_],(k=null===(E=n.transceivers.get(Z(j.SDPStreamMetadataPurpose.Usermedia,S)))||void 0===E?void 0:E.sender)&&!e.getTracks().find((function(e){return e.kind===S}))&&(null===(M=n.peerConn)||void 0===M||M.removeTrack(k));C=!0,I=!1,T=void 0,h.label=1;case 1:h.trys.push([1,9,10,11]),R=e.getTracks()[Symbol.iterator](),h.label=2;case 2:if(C=(x=R.next()).done)return[3,8];if(O=x.value,A=Z(j.SDPStreamMetadataPurpose.Usermedia,O.kind),P=n.transceivers.get(A),L=null==P?void 0:P.sender,U=!1,!L)return[3,6];h.label=3;case 3:return h.trys.push([3,5,,6]),D.logger.info("Call ".concat(n.callId," ")+"Replacing track ("+'id="'.concat(O.id,'", ')+'kind="'.concat(O.kind,'", ')+'streamId="'.concat(e.id,'", ')+'streamPurpose="'.concat(i.purpose,'"')+") to peer connection"),[4,L.replaceTrack(O)];case 4:return h.sent(),P.direction="inactive"===P.direction?"sendonly":"sendrecv",U=!0,[3,6];case 5:return N=h.sent(),D.logger.warn("replaceTrack failed: adding new transceiver instead",N),[3,6];case 6:U||(D.logger.info("Call ".concat(n.callId," ")+"Adding track ("+'id="'.concat(O.id,'", ')+'kind="'.concat(O.kind,'", ')+'streamId="'.concat(e.id,'", ')+'streamPurpose="'.concat(i.purpose,'"')+") to peer connection"),B=n.peerConn.addTrack(O,n.localUsermediaStream),(F=n.peerConn.getTransceivers().find((function(e){return e.sender===B})))?n.transceivers.set(A,F):D.logger.warn("Couldn't find matching transceiver for newly added track!")),h.label=7;case 7:return C=!0,[3,2];case 8:return[3,11];case 9:return K=h.sent(),I=!0,T=K,[3,11];case 10:try{C||null==R.return||R.return()}finally{if(I)throw T}return[7];case 11:return[2]}}))}))()}},{key:"setLocalVideoMuted",value:function(e){var t=this;return(0,i.default)((function(){var r,n;return(0,h.__generator)(this,(function(i){switch(i.label){case 0:return D.logger.log("call ".concat(t.callId," setLocalVideoMuted ").concat(e)),[4,t.client.getMediaHandler().hasVideoDevice()];case 1:return i.sent()?t.hasLocalUserMediaVideoTrack||e?[3,3]:[4,t.upgradeCall(!1,!0)]:[2,t.isLocalVideoMuted()];case 2:return i.sent(),[2,t.isLocalVideoMuted()];case 3:return t.opponentSupportsSDPStreamMetadata()?[4,t.client.getMediaHandler().getUserMediaStream(!0,!e)]:[3,6];case 4:return r=i.sent(),[4,t.updateLocalUsermediaStream(r)];case 5:return i.sent(),[3,7];case 6:null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(null,e),i.label=7;case 7:return t.updateMuteStatus(),[4,t.sendMetadataUpdate()];case 8:return i.sent(),[2,t.isLocalVideoMuted()]}}))}))()}},{key:"isLocalVideoMuted",value:function(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())&&void 0!==e&&e}},{key:"setMicrophoneMuted",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,h.__generator)(this,(function(n){switch(n.label){case 0:return D.logger.log("call ".concat(t.callId," setMicrophoneMuted ").concat(e)),[4,t.client.getMediaHandler().hasAudioDevice()];case 1:return n.sent()?t.hasLocalUserMediaAudioTrack||e?[3,3]:[4,t.upgradeCall(!0,!1)]:[2,t.isMicrophoneMuted()];case 2:case 4:return n.sent(),[2,t.isMicrophoneMuted()];case 3:return null===(r=t.localUsermediaFeed)||void 0===r||r.setAudioVideoMuted(e,null),t.updateMuteStatus(),[4,t.sendMetadataUpdate()]}}))}))()}},{key:"isMicrophoneMuted",value:function(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isAudioMuted())&&void 0!==e&&e}},{key:"isRemoteOnHold",value:function(){return this.remoteOnHold}},{key:"setRemoteOnHold",value:function(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;var t=!0,r=!1,n=void 0;try{for(var i,o=this.peerConn.getTransceivers()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.direction=e?"sendonly":"sendrecv"}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(C.RemoteHoldUnhold,this.remoteOnHold)}}},{key:"isLocalOnHold",value:function(){if(this.state!==y.Connected)return!1;var e=!0,t=!0,r=!1,n=void 0;try{for(var i,o=this.peerConn.getTransceivers()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;["inactive","recvonly"].includes(a.currentDirection)||(e=!1)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return e}},{key:"sendDtmfDigit",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.peerConn.getSenders()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a,s=i.value;if("audio"===(null===(a=s.track)||void 0===a?void 0:a.kind)&&s.dtmf)return void s.dtmf.insertDTMF(e)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}throw new Error("Unable to find a track to send DTMF on")}},{key:"updateMuteStatus",value:function(){var e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;D.logger.log("call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(t)),J(this.localUsermediaStream.getAudioTracks(),!e),J(this.localUsermediaStream.getVideoTracks(),!t)}},{key:"sendMetadataUpdate",value:function(){var e=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.sendVoipEvent(L.EventType.CallSDPStreamMetadataChangedPrefix,(0,s.default)({},j.SDPStreamMetadataKey,e.getLocalSDPStreamMetadata()))];case 1:return t.sent(),[2]}}))}))()}},{key:"gotCallFeedsForInvite",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.successor)this.successor.queueGotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this.pushLocalFeed(s)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}t&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=y.CreateOffer,D.logger.debug("Call ".concat(this.callId," gotUserMediaForInvite"))}}},{key:"sendAnswer",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o;return(0,h.__generator)(this,(function(a){switch(a.label){case 0:(t=(0,s.default)({answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type}},j.SDPStreamMetadataKey,e.getLocalSDPStreamMetadata(!0))).capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},r=e.discardDuplicateCandidates(),D.logger.info("Call ".concat(e.callId," Discarding ").concat(r," candidates that will be sent in answer")),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.sendVoipEvent(L.EventType.CallAnswer,t)];case 2:return a.sent(),e.inviteOrAnswerSent=!0,[3,4];case 3:throw n=a.sent(),e.state=y.Ringing,n instanceof q.MatrixError&&n.event&&e.client.cancelPendingEvent(n.event),i=T.SendAnswer,o="Failed to send answer","UnknownDeviceError"==n.name&&(i=T.UnknownDevices,o="Unknown devices present in the room"),e.emit(C.Error,new G(i,o,n)),n;case 4:return e.sendCandidateQueue(),[2]}}))}))()}},{key:"queueGotCallFeedsForAnswer",value:function(e){var t=this;this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((function(){return t.gotCallFeedsForAnswer(e)})):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}},{key:"mungeSdp",value:function(e,t){var r=(0,A.parse)(e.sdp);r.media.forEach((function(e){var r=new Map,n=new Map,i=!0,o=!1,a=void 0;try{for(var s,u=e.rtp[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r.set(l.payload,l.codec),n.set(l.codec,l.payload)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}var c=!0,d=!1,f=void 0;try{for(var h,p=t[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value;if(v.mediaType===e.type)if(n.has(v.codec)){var g=[];void 0!==v.enableDtx&&g.push("usedtx=".concat(v.enableDtx?"1":"0")),void 0!==v.maxAverageBitrate&&g.push("maxaveragebitrate=".concat(v.maxAverageBitrate));var m=!1,y=!0,b=!1,_=void 0;try{for(var w,S=e.fmtp[Symbol.iterator]();!(y=(w=S.next()).done);y=!0){var E=w.value;r.get(E.payload)===v.codec&&(m=!0,E.config+=";"+g.join(";"))}}catch(e){b=!0,_=e}finally{try{y||null==S.return||S.return()}finally{if(b)throw _}}m||e.fmtp.push({payload:n.get(v.codec),config:g.join(";")})}else D.logger.info("Ignoring SDP modifications for ".concat(v.codec," as it's not present."))}}catch(e){d=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}})),e.sdp=(0,A.write)(r)}},{key:"createOffer",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.peerConn.createOffer()];case 1:return t=r.sent(),e.mungeSdp(t,Y(e.isPtt)),[2,t]}}))}))()}},{key:"createAnswer",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.peerConn.createAnswer()];case 1:return t=r.sent(),e.mungeSdp(t,Y(e.isPtt)),[2,t]}}))}))()}},{key:"gotCallFeedsForAnswer",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,l,c;return(0,h.__generator)(this,(function(d){switch(d.label){case 0:if(t.callHasEnded())return[2];t.waitForLocalAVStream=!1,r=!0,n=!1,i=void 0;try{for(o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)s=a.value,t.pushLocalFeed(s)}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}t.state=y.CreateAnswer,d.label=1;case 1:return d.trys.push([1,3,,4]),t.getRidOfRTXCodecs(),[4,t.createAnswer()];case 2:return u=d.sent(),[3,4];case 3:return l=d.sent(),D.logger.debug("Call ".concat(t.callId," Failed to create answer: "),l),t.terminate(k.Local,T.CreateAnswer,!0),[2];case 4:return d.trys.push([4,7,,8]),[4,t.peerConn.setLocalDescription(u)];case 5:return d.sent(),t.callHasEnded()?[2]:(t.state=y.Connecting,[4,new Promise((function(e){setTimeout(e,200)}))]);case 6:return d.sent(),t.callHasEnded()?[2]:(t.sendAnswer(),[3,8]);case 7:return c=d.sent(),D.logger.debug("Call ".concat(t.callId," Error setting local description!"),c),t.terminate(k.Local,T.SetLocalDescription,!0),[2];case 8:return[2]}}))}))()}},{key:"onRemoteIceCandidatesReceived",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a;return(0,h.__generator)(this,(function(s){switch(s.label){case 0:return t.callHasEnded()?[2]:(r=e.getContent(),(n=r.candidates)?(i=0===r.version?null:r.party_id||null,void 0===t.opponentPartyId?(i&&(D.logger.info("Call ".concat(t.callId," Buffering ").concat(n.length," candidates until we pick an opponent")),a=t.remoteCandidateBuffer.get(i)||[],(o=a).push.apply(o,(0,c.default)(n)),t.remoteCandidateBuffer.set(i,a)),[2]):t.partyIdMatches(r)?[4,t.addIceCandidates(n)]:(D.logger.info("Call ".concat(t.callId," ")+"Ignoring candidates from party ID ".concat(r.party_id,": ")+"we have chosen party ID ".concat(t.opponentPartyId)),[2])):(D.logger.info("Call ".concat(t.callId," Ignoring candidates event with no candidates!")),[2]));case 1:return s.sent(),[2]}}))}))()}},{key:"onAnswerReceived",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o;return(0,h.__generator)(this,(function(a){switch(a.label){case 0:return r=e.getContent(),D.logger.debug("Got answer for call ID ".concat(t.callId," from party ID ").concat(r.party_id)),t.callHasEnded()?(D.logger.debug("Ignoring answer because call ID ".concat(t.callId," has ended")),[2]):void 0!==t.opponentPartyId?(D.logger.info("Call ".concat(t.callId," ")+"Ignoring answer from party ID ".concat(r.party_id,": ")+"we already have an answer/reject from ".concat(t.opponentPartyId)),[2]):(t.chooseOpponent(e),[4,t.addBufferedIceCandidates()]);case 1:a.sent(),t.state=y.Connecting,(n=r[j.SDPStreamMetadataKey])?t.updateRemoteSDPStreamMetadata(n):D.logger.warn("Call ".concat(t.callId," Did not get any SDPStreamMetadata! Can not send/receive multiple streams")),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,t.peerConn.setRemoteDescription(r.answer)];case 3:return a.sent(),[3,5];case 4:return i=a.sent(),D.logger.debug("Call ".concat(t.callId," Failed to set remote description"),i),t.terminate(k.Local,T.SetRemoteDescription,!1),[2];case 5:if(null===t.opponentPartyId)return[3,9];a.label=6;case 6:return a.trys.push([6,8,,9]),[4,t.sendVoipEvent(L.EventType.CallSelectAnswer,{selected_party_id:t.opponentPartyId})];case 7:return a.sent(),[3,9];case 8:return o=a.sent(),D.logger.warn("Call ".concat(t.callId," Failed to send select_answer event"),o),[3,9];case 9:return[2]}}))}))()}},{key:"onSelectAnswerReceived",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,h.__generator)(this,(function(n){switch(n.label){case 0:return t.direction!==S.Inbound?(D.logger.warn("Call ".concat(t.callId," Got select_answer for an outbound call: ignoring")),[2]):null==(r=e.getContent().selected_party_id)?(D.logger.warn("Call ".concat(t.callId," Got nonsensical select_answer with null/undefined selected_party_id: ignoring")),[2]):r===t.ourPartyId?[3,2]:(D.logger.info("Call ".concat(t.callId," Got select_answer for party ID ").concat(r,": we are party ID ").concat(t.ourPartyId,".")),[4,t.terminate(k.Remote,T.AnsweredElsewhere,!0)]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))()}},{key:"onNegotiateReceived",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,u,l,c,d,f,p;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:if(r=e.getContent(),!(n=r.description)||!n.sdp||!n.type)return D.logger.info("Call ".concat(t.callId," Ignoring invalid m.call.negotiate event")),[2];if(i=t.direction===S.Inbound,o="offer"===n.type&&(t.makingOffer||"stable"!==t.peerConn.signalingState),t.ignoreOffer=!i&&o,t.ignoreOffer)return D.logger.info("Call ".concat(t.callId," Ignoring colliding negotiate event because we're impolite")),[2];a=t.isLocalOnHold(),(u=r[j.SDPStreamMetadataKey])?t.updateRemoteSDPStreamMetadata(u):D.logger.warn("Call ".concat(t.callId," Received negotiation event without SDPStreamMetadata!")),h.label=1;case 1:return h.trys.push([1,9,,10]),[4,t.peerConn.setRemoteDescription(n)];case 2:if(h.sent(),"offer"!==n.type)return[3,8];h.label=3;case 3:return h.trys.push([3,5,,6]),t.getRidOfRTXCodecs(),[4,t.createAnswer()];case 4:return c=h.sent(),[3,6];case 5:return d=h.sent(),D.logger.debug("Call ".concat(t.callId," Failed to create answer: "),d),t.terminate(k.Local,T.CreateAnswer,!0),[2];case 6:return[4,t.peerConn.setLocalDescription(c)];case 7:h.sent(),t.sendVoipEvent(L.EventType.CallNegotiate,(0,s.default)({description:null===(l=t.peerConn.localDescription)||void 0===l?void 0:l.toJSON()},j.SDPStreamMetadataKey,t.getLocalSDPStreamMetadata(!0))),h.label=8;case 8:return[3,10];case 9:return f=h.sent(),D.logger.warn("Call ".concat(t.callId," Failed to complete negotiation"),f),[3,10];case 10:return p=t.isLocalOnHold(),a!==p&&(t.emit(C.LocalHoldUnhold,p),t.emit(C.HoldUnhold,p)),[2]}}))}))()}},{key:"updateRemoteSDPStreamMetadata",value:function(e){this.remoteSDPStreamMetadata=P.recursivelyAssign(this.remoteSDPStreamMetadata||{},e,!0);var t=!0,r=!1,n=void 0;try{for(var i,o=this.getRemoteFeeds()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a,s=i.value,u=s.stream.id,l=this.remoteSDPStreamMetadata[u];s.setAudioVideoMuted(null==l?void 0:l.audio_muted,null==l?void 0:l.video_muted),s.purpose=null===(a=this.remoteSDPStreamMetadata[u])||void 0===a?void 0:a.purpose}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"onSDPStreamMetadataChangedReceived",value:function(e){var t=e.getContent()[j.SDPStreamMetadataKey];this.updateRemoteSDPStreamMetadata(t)}},{key:"onAssertedIdentityReceived",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,h.__generator)(this,(function(n){return(r=e.getContent()).asserted_identity?(t.remoteAssertedIdentity={id:r.asserted_identity.id,displayName:r.asserted_identity.display_name},t.emit(C.AssertedIdentityChanged),[2]):[2]}))}))()}},{key:"callHasEnded",value:function(){return this.state===y.Ended}},{key:"queueGotLocalOffer",value:function(){var e=this;this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((function(){return e.wrappedGotLocalOffer()})):this.responsePromiseChain=this.wrappedGotLocalOffer()}},{key:"wrappedGotLocalOffer",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:e.makingOffer=!0,r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,e.gotLocalOffer()];case 2:return r.sent(),[3,5];case 3:return t=r.sent(),e.getLocalOfferFailed(t),[2];case 4:return e.makingOffer=!1,[7];case 5:return[2]}}))}))()}},{key:"gotLocalOffer",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s,u,l,c,d;return(0,h.__generator)(this,(function(f){switch(f.label){case 0:if(D.logger.debug("Call ".concat(e.callId," Setting local description")),e.callHasEnded())return D.logger.debug("Ignoring newly created offer on call ID "+e.callId+" because the call has ended"),[2];f.label=1;case 1:return f.trys.push([1,3,,4]),e.getRidOfRTXCodecs(),[4,e.createOffer()];case 2:return t=f.sent(),[3,4];case 3:return r=f.sent(),D.logger.debug("Call ".concat(e.callId," Failed to create offer: "),r),e.terminate(k.Local,T.CreateOffer,!0),[2];case 4:return f.trys.push([4,6,,7]),[4,e.peerConn.setLocalDescription(t)];case 5:return f.sent(),[3,7];case 6:return n=f.sent(),D.logger.debug("Call ".concat(e.callId," Error setting local description!"),n),e.terminate(k.Local,T.SetLocalDescription,!0),[2];case 7:return"gathering"!==e.peerConn.iceGatheringState?[3,9]:[4,new Promise((function(e){setTimeout(e,200)}))];case 8:f.sent(),f.label=9;case 9:if(e.callHasEnded())return[2];i=e.state===y.CreateOffer?L.EventType.CallInvite:L.EventType.CallNegotiate,o={lifetime:6e4},i===L.EventType.CallInvite&&e.invitee&&(o.invitee=e.invitee),e.state===y.CreateOffer?o.offer=null===(a=e.peerConn.localDescription)||void 0===a?void 0:a.toJSON():o.description=null===(s=e.peerConn.localDescription)||void 0===s?void 0:s.toJSON(),o.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},o[j.SDPStreamMetadataKey]=e.getLocalSDPStreamMetadata(!0),u=e.discardDuplicateCandidates(),D.logger.info("Call ".concat(e.callId," Discarding ").concat(u," candidates that will be sent in offer")),f.label=10;case 10:return f.trys.push([10,12,,13]),[4,e.sendVoipEvent(i,o)];case 11:return f.sent(),[3,13];case 12:return l=f.sent(),D.logger.error("Call ".concat(e.callId," Failed to send invite"),l),l instanceof q.MatrixError&&l.event&&e.client.cancelPendingEvent(l.event),c=T.SignallingFailed,d="Signalling failed",e.state===y.CreateOffer&&(c=T.SendInvite,d="Failed to send invite"),"UnknownDeviceError"==l.name&&(c=T.UnknownDevices,d="Unknown devices present in the room"),e.emit(C.Error,new G(c,d,l)),e.terminate(k.Local,c,!1),[2];case 13:return e.sendCandidateQueue(),e.state===y.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=y.InviteSent,e.inviteTimeout=setTimeout((function(){e.inviteTimeout=void 0,e.state===y.InviteSent&&e.hangup(T.InviteTimeout,!1)}),6e4)),[2]}}))}))()}},{key:"getRidOfRTXCodecs",value:function(){if(RTCRtpReceiver.getCapabilities&&RTCRtpSender.getCapabilities){var e=RTCRtpReceiver.getCapabilities("video").codecs,t=RTCRtpSender.getCapabilities("video").codecs,r=(0,c.default)(t).concat((0,c.default)(e)),n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if("video/rtx"===u.mimeType){var l=r.indexOf(u);r.splice(l,1)}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}var d=this.transceivers.get(Z(j.SDPStreamMetadataPurpose.Screenshare,"video"));d&&d.setCodecPreferences(r)}}},{key:"sendVoipEvent",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a,u,l;return(0,h.__generator)(this,(function(c){switch(c.label){case 0:return n=Object.assign({},t,{version:"1",call_id:r.callId,party_id:r.ourPartyId,conf_id:r.groupCallId}),r.opponentDeviceId?(o=r.toDeviceSeq++,a=H(H({},n),{},(0,s.default)({device_id:r.client.deviceId,sender_session_id:r.client.getSessionId(),dest_session_id:r.opponentSessionId,seq:o},L.ToDeviceMessageId,(0,O.default)())),r.emit(C.SendVoipEvent,{type:"toDevice",eventType:e,userId:r.invitee||(null===(i=r.getOpponentMember())||void 0===i?void 0:i.userId),opponentDeviceId:r.opponentDeviceId,content:a}),u=r.invitee||r.getOpponentMember().userId,r.client.getUseE2eForGroupCall()?[4,r.client.encryptAndSendToDevices([{userId:u,deviceInfo:r.opponentDeviceInfo}],{type:e,content:a})]:[3,2]):[3,5];case 1:return c.sent(),[3,4];case 2:return[4,r.client.sendToDevice(e,(0,s.default)({},u,(0,s.default)({},r.opponentDeviceId,a)))];case 3:c.sent(),c.label=4;case 4:return[3,7];case 5:return r.emit(C.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:r.roomId,content:n,userId:r.invitee||(null===(l=r.getOpponentMember())||void 0===l?void 0:l.userId)}),[4,r.client.sendEvent(r.roomId,e,n)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))()}},{key:"queueCandidate",value:function(e){var t=this;if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state!==y.Ringing&&this.inviteOrAnswerSent){var r=this.direction===S.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((function(){t.sendCandidateQueue()}),r)}}},{key:"discardDuplicateCandidates",value:function(){for(var e=0,t=[],r=0;r<this.candidateSendQueue.length;r++){var n=this.candidateSendQueue[r];""===n.candidate?t.push(n):e++}return this.candidateSendQueue=t,e}},{key:"transfer",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i;return(0,h.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.client.getProfileInfo(e)];case 1:return r=o.sent(),n=z(),i={replacement_id:z(),target_user:{id:e,display_name:r.displayname,avatar_url:r.avatar_url},create_call:n},[4,t.sendVoipEvent(L.EventType.CallReplaces,i)];case 2:return o.sent(),[4,t.terminate(k.Local,T.Transfered,!0)];case 3:return o.sent(),[2]}}))}))()}},{key:"transferToCall",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,l,c,d,f;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:return(i=null===(r=e.getOpponentMember())||void 0===r?void 0:r.userId)?[4,t.client.getProfileInfo(i)]:[3,2];case 1:return a=h.sent(),[3,3];case 2:a=void 0,h.label=3;case 3:return o=a,(s=null===(n=t.getOpponentMember())||void 0===n?void 0:n.userId)?[4,t.client.getProfileInfo(s)]:[3,5];case 4:return l=h.sent(),[3,6];case 5:l=void 0,h.label=6;case 6:return u=l,c=z(),d={replacement_id:z(),target_user:{id:s,display_name:null==u?void 0:u.displayname,avatar_url:null==u?void 0:u.avatar_url},await_call:c},[4,e.sendVoipEvent(L.EventType.CallReplaces,d)];case 7:return h.sent(),f={replacement_id:z(),target_user:{id:i,display_name:null==o?void 0:o.displayname,avatar_url:null==o?void 0:o.avatar_url},create_call:c},[4,t.sendVoipEvent(L.EventType.CallReplaces,f)];case 8:return h.sent(),[4,t.terminate(k.Local,T.Transfered,!0)];case 9:return h.sent(),[4,e.terminate(k.Local,T.Transfered,!0)];case 10:return h.sent(),[2]}}))}))()}},{key:"terminate",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,s,u,c,d,f;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:if(n.callHasEnded())return[2];n.hangupParty=e,n.hangupReason=t,n.state=y.Ended,n.inviteTimeout&&(clearTimeout(n.inviteTimeout),n.inviteTimeout=void 0),n.callLengthInterval&&(clearInterval(n.callLengthInterval),n.callLengthInterval=void 0),i=!0,o=!1,a=void 0;try{for(s=n.removeTrackListeners[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)c=(0,l.default)(u.value,2),d=c[0],f=c[1],d.removeEventListener("removetrack",f)}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return n.removeTrackListeners.clear(),[4,n.collectCallStats()];case 1:return n.callStatsAtEnd=h.sent(),n.stopAllMedia(),n.deleteAllFeeds(),n.peerConn&&"closed"!==n.peerConn.signalingState&&n.peerConn.close(),r&&n.emit(C.Hangup,n),n.client.callEventHandler.calls.delete(n.callId),[2]}}))}))()}},{key:"stopAllMedia",value:function(){D.logger.debug("Call ".concat(this.callId," stopping all media"));var e=!0,t=!1,r=void 0;try{for(var n,i=this.feeds[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;if(o.isLocal()&&o.purpose===j.SDPStreamMetadataPurpose.Usermedia)this.client.getMediaHandler().stopUserMediaStream(o.stream);else if(o.isLocal()&&o.purpose===j.SDPStreamMetadataPurpose.Screenshare)this.client.getMediaHandler().stopScreensharingStream(o.stream);else if(!o.isLocal()){D.logger.debug("Stopping remote stream",o.stream.id);var a=!0,s=!1,u=void 0;try{for(var l,c=o.stream.getTracks()[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){l.value.stop()}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}},{key:"checkForErrorListener",value:function(){if(0===this.listeners(B.EventEmitterEvents.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}},{key:"sendCandidateQueue",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a;return(0,h.__generator)(this,(function(s){switch(s.label){case 0:if(0===e.candidateSendQueue.length||e.callHasEnded())return[2];t=e.candidateSendQueue,e.candidateSendQueue=[],++e.candidateSendTries,r={candidates:t.map((function(e){return e.toJSON()}))},e.candidatesEnded&&r.candidates.push({candidate:""}),D.logger.debug("Call ".concat(e.callId," attempting to send ").concat(t.length," candidates")),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.sendVoipEvent(L.EventType.CallCandidates,r)];case 2:return s.sent(),e.candidateSendTries=0,e.sendCandidateQueue(),[3,4];case 3:return(n=s.sent())instanceof q.MatrixError&&n.event&&e.client.cancelPendingEvent(n.event),(i=e.candidateSendQueue).push.apply(i,(0,c.default)(t)),e.candidateSendTries>5?(D.logger.debug("Call ".concat(e.callId," failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),n),o=T.SignallingFailed,"Signalling failed",e.emit(C.Error,new G(o,"Signalling failed",n)),e.hangup(o,!1),[2]):(a=500*Math.pow(2,e.candidateSendTries),++e.candidateSendTries,D.logger.debug("Call ".concat(e.callId," failed to send candidates. Retrying in ").concat(a,"ms"),n),setTimeout((function(){e.sendCandidateQueue()}),a),[3,4]);case 4:return[2]}}))}))()}},{key:"placeCall",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a;return(0,h.__generator)(this,(function(s){switch(s.label){case 0:if(!e)throw new Error("You CANNOT start a call without audio");r.state=y.WaitLocalMedia,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,r.client.getMediaHandler().getUserMediaStream(e,t)];case 2:return J((i=s.sent()).getAudioTracks(),!0),J(i.getVideoTracks(),!0),o=new N.CallFeed({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:null!==(n=r.client.getDeviceId())&&void 0!==n?n:void 0,stream:i,purpose:j.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1}),[4,r.placeCallWithCallFeeds([o])];case 3:return s.sent(),[3,5];case 4:return a=s.sent(),r.getUserMediaFailed(a),[2];case 5:return[2]}}))}))()}},{key:"placeCallWithCallFeeds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(n){switch(n.label){case 0:return r.checkForErrorListener(),r.direction=S.Outbound,[4,r.initOpponentCrypto()];case 1:return n.sent(),r.client.callEventHandler.calls.set(r.callId,r),[4,r.client.checkTurnServers()];case 2:return n.sent()||D.logger.warn("Call ".concat(r.callId," Failed to get TURN credentials! Proceeding with call anyway...")),r.peerConn=r.createPeerConnection(),r.gotCallFeedsForInvite(e,t),[2]}}))}))()}},{key:"createPeerConnection",value:function(){var e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel),e}},{key:"partyIdMatches",value:function(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}},{key:"chooseOpponent",value:function(e){var t,r=e.getContent();D.logger.debug("Call ".concat(this.callId," choosing opponent party ID ").concat(r.party_id)),this.opponentVersion=r.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=null!==(t=this.client.getRoom(this.roomId).getMember(e.getSender()))&&void 0!==t?t:void 0}},{key:"addBufferedIceCandidates",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:return(t=e.remoteCandidateBuffer.get(e.opponentPartyId))?(D.logger.info("Call ".concat(e.callId," Adding ").concat(t.length," buffered candidates for opponent ").concat(e.opponentPartyId)),[4,e.addIceCandidates(t)]):[3,2];case 1:r.sent(),r.label=2;case 2:return e.remoteCandidateBuffer.clear(),[2]}}))}))()}},{key:"addIceCandidates",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,l;return(0,h.__generator)(this,(function(c){switch(c.label){case 0:r=!0,n=!1,i=void 0,c.label=1;case 1:c.trys.push([1,8,9,10]),o=e[Symbol.iterator](),c.label=2;case 2:if(r=(a=o.next()).done)return[3,7];null!==(s=a.value).sdpMid&&void 0!==s.sdpMid||null!==s.sdpMLineIndex&&void 0!==s.sdpMLineIndex?D.logger.debug("Call ".concat(t.callId," got remote ICE ").concat(s.sdpMid," candidate: ").concat(s.candidate)):D.logger.debug("Call ".concat(t.callId," got remote ICE end-of-candidates")),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,t.peerConn.addIceCandidate(s)];case 4:return c.sent(),[3,6];case 5:return u=c.sent(),t.ignoreOffer||D.logger.info("Call ".concat(t.callId," failed to add remote ICE candidate"),u),[3,6];case 6:return r=!0,[3,2];case 7:return[3,10];case 8:return l=c.sent(),n=!0,i=l,[3,10];case 9:try{r||null==o.return||o.return()}finally{if(n)throw i}return[7];case 10:return[2]}}))}))()}},{key:"hasPeerConnection",get:function(){return Boolean(this.peerConn)}}]),n}(B.TypedEventEmitter);function J(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value.enabled=t}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}function Q(){if("undefined"==typeof window||"undefined"==typeof document)return!1;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return D.logger.error("WebRTC is not supported in this browser / environment"),!1}catch(e){return D.logger.error("Exception thrown when trying to access WebRTC",e),!1}return!0}e.exports.MatrixCall=$})),n.register("329cj",(function(t,r){e(t.exports,"default",(function(){return s}));var i=n("iG0Kz"),o=n("fASeB"),a=n("R55PU");var s=function(e,t,r){if(i.default.randomUUID&&!t&&!e)return i.default.randomUUID();var n=(e=e||{}).random||(e.rng||o.default)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var s=0;s<16;++s)t[r+s]=n[s];return t}return(0,a.unsafeStringify)(n)}})),n.register("iG0Kz",(function(t,r){e(t.exports,"default",(function(){return n}));var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}})),n.register("fASeB",(function(t,r){var n;e(t.exports,"default",(function(){return o}));var i=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}})),n.register("R55PU",(function(t,r){e(t.exports,"unsafeStringify",(function(){return a}));n("g5evM");for(var i=[],o=0;o<256;++o)i.push((o+256).toString(16).slice(1));function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}})),n.register("g5evM",(function(t,r){e(t.exports,"default",(function(){return o}));var i=n("gn2zx");var o=function(e){return"string"==typeof e&&i.default.test(e)}})),n.register("gn2zx",(function(t,r){e(t.exports,"default",(function(){return n}));var n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i})),n.register("63YOu",(function(t,r){var i,o;e(t.exports,"write",(function(){return i}),(function(e){return i=e})),e(t.exports,"parse",(function(){return o}),(function(e){return o=e}));var a=n("93WiR"),s=n("gSIy6");i=s,o=a.parse,a.parseParams,a.parseFmtpConfig,a.parsePayloads,a.parseRemoteCandidates,a.parseImageAttributes,a.parseSimulcastStreamList})),n.register("93WiR",(function(t,r){var i,o,a,s,u,l,c;e(t.exports,"parse",(function(){return i}),(function(e){return i=e})),e(t.exports,"parseParams",(function(){return o}),(function(e){return o=e})),e(t.exports,"parseFmtpConfig",(function(){return a}),(function(e){return a=e})),e(t.exports,"parsePayloads",(function(){return s}),(function(e){return s=e})),e(t.exports,"parseRemoteCandidates",(function(){return u}),(function(e){return u=e})),e(t.exports,"parseImageAttributes",(function(){return l}),(function(e){return l=e})),e(t.exports,"parseSimulcastStreamList",(function(){return c}),(function(e){return c=e}));var d=function(e){return String(Number(e))===e?Number(e):e},f=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=d(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=d(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},h=n("ioYRp"),p=RegExp.prototype.test.bind(/^([a-z])=(.*)/);i=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(p).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var o=0;o<(h[t]||[]).length;o+=1){var a=h[t][o];if(a.reg.test(i))return f(a,n,i)}})),t.media=r,t};var v=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=d(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};a=o=function(e){return e.split(/;\s?/).reduce(v,{})},s=function(e){return e.toString().split(" ").map(Number)},u=function(e){for(var t=[],r=e.split(" ").map(d),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},l=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(v,{})}))},c=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=d(e):(t=d(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}})),n.register("ioYRp",(function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),n.register("gSIy6",(function(e,t){var r=n("ioYRp"),i=/%[sdv%]/g,o=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},a=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return o.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||s,i=t.innerOrder||u,o=[];return n.forEach((function(t){r[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(a(t,r,e))}))}))})),e.media.forEach((function(e){o.push(a("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(a(t,r,e))}))}))}))})),o.join("\r\n")+"\r\n"}})),n.register("94a5L",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.randomLowercaseString=function(e){return i(e,r)},e.exports.randomString=function(e){return i(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")},e.exports.randomUppercaseString=function(e){return i(e,n)};var r="abcdefghijklmnopqrstuvwxyz",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function i(e,t){for(var r="",n=0;n<e;++n)r+=t.charAt(Math.floor(Math.random()*t.length));return r}})),n.register("ipwmE",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SDPStreamMetadataPurpose=e.exports.SDPStreamMetadataKey=void 0;var r,n;e.exports.SDPStreamMetadataKey="org.matrix.msc3077.sdp_stream_metadata",e.exports.SDPStreamMetadataPurpose=r,(n=r||(e.exports.SDPStreamMetadataPurpose=r={})).Usermedia="m.usermedia",n.Screenshare="m.screenshare"})),n.register("3Jrxc",(function(e,t){var r=n("Yawv5"),i=n("kxanC"),o=n("hWDD9"),a=n("cksMj"),s=n("giCK6"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SPEAKING_THRESHOLD=e.exports.CallFeedEvent=e.exports.CallFeed=void 0;var l=u(n("3rHpI")),c=n("ipwmE"),d=n("kllza"),f=n("jtqeE"),h=n("6MMVS"),p=n("iTgYJ");e.exports.SPEAKING_THRESHOLD=-60;var v,g;e.exports.CallFeedEvent=v,(g=v||(e.exports.CallFeedEvent=v={})).NewStream="new_stream",g.MuteStateChanged="mute_state_changed",g.LocalVolumeChanged="local_volume_changed",g.VolumeChanged="volume_changed",g.ConnectedChanged="connected_changed",g.Speaking="speaking",g.Disposed="disposed";var m=function(e){(0,a.default)(n,e);var t=(0,s.default)(n);function n(e){var o;return(0,i.default)(this,n),o=t.call(this),(0,l.default)((0,r.default)(o),"stream",void 0),(0,l.default)((0,r.default)(o),"sdpMetadataStreamId",void 0),(0,l.default)((0,r.default)(o),"userId",void 0),(0,l.default)((0,r.default)(o),"deviceId",void 0),(0,l.default)((0,r.default)(o),"purpose",void 0),(0,l.default)((0,r.default)(o),"speakingVolumeSamples",void 0),(0,l.default)((0,r.default)(o),"client",void 0),(0,l.default)((0,r.default)(o),"call",void 0),(0,l.default)((0,r.default)(o),"roomId",void 0),(0,l.default)((0,r.default)(o),"audioMuted",void 0),(0,l.default)((0,r.default)(o),"videoMuted",void 0),(0,l.default)((0,r.default)(o),"localVolume",1),(0,l.default)((0,r.default)(o),"measuringVolumeActivity",!1),(0,l.default)((0,r.default)(o),"audioContext",void 0),(0,l.default)((0,r.default)(o),"analyser",void 0),(0,l.default)((0,r.default)(o),"frequencyBinCount",void 0),(0,l.default)((0,r.default)(o),"speakingThreshold",-60),(0,l.default)((0,r.default)(o),"speaking",!1),(0,l.default)((0,r.default)(o),"volumeLooperTimeout",void 0),(0,l.default)((0,r.default)(o),"_disposed",!1),(0,l.default)((0,r.default)(o),"_connected",!1),(0,l.default)((0,r.default)(o),"onAddTrack",(function(){o.emit(v.NewStream,o.stream)})),(0,l.default)((0,r.default)(o),"onCallState",(function(e){e===p.CallState.Connected?o.connected=!0:e===p.CallState.Connecting&&(o.connected=!1)})),(0,l.default)((0,r.default)(o),"volumeLooper",(function(){if(o.analyser&&o.measuringVolumeActivity){o.analyser.getFloatFrequencyData(o.frequencyBinCount);var e=-1/0,t=!0,r=!1,n=void 0;try{for(var i,a=o.frequencyBinCount[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;s>e&&(e=s)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}o.speakingVolumeSamples.shift(),o.speakingVolumeSamples.push(e),o.emit(v.VolumeChanged,e);var u=!1,l=!0,c=!1,d=void 0;try{for(var f,h=o.speakingVolumeSamples[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){if(f.value>o.speakingThreshold){u=!0;break}}}catch(e){c=!0,d=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw d}}o.speaking!==u&&(o.speaking=u,o.emit(v.Speaking,o.speaking)),o.volumeLooperTimeout=setTimeout(o.volumeLooper,200)}})),o.client=e.client,o.call=e.call,o.roomId=e.roomId,o.userId=e.userId,o.deviceId=e.deviceId,o.purpose=e.purpose,o.audioMuted=e.audioMuted,o.videoMuted=e.videoMuted,o.speakingVolumeSamples=new Array(8).fill(-1/0),o.sdpMetadataStreamId=e.stream.id,o.updateStream(null,e.stream),o.stream=e.stream,o.hasAudioTrack&&o.initVolumeMeasuring(),e.call&&(e.call.addListener(p.CallEvent.State,o.onCallState),o.onCallState(e.call.state)),o}return(0,o.default)(n,[{key:"connected",get:function(){return this.isLocal()||this._connected},set:function(e){this._connected=e,this.emit(v.ConnectedChanged,this.connected)}},{key:"hasAudioTrack",get:function(){return this.stream.getAudioTracks().length>0}},{key:"updateStream",value:function(e,t){t!==e&&(e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?this.initVolumeMeasuring():this.measureVolumeActivity(!1),this.emit(v.NewStream,this.stream))}},{key:"initVolumeMeasuring",value:function(){this.hasAudioTrack&&(this.audioContext||(this.audioContext=(0,d.acquireContext)()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}},{key:"getMember",value:function(){var e,t=this.client.getRoom(this.roomId);return null!==(e=null==t?void 0:t.getMember(this.userId))&&void 0!==e?e:null}},{key:"isLocal",value:function(){return this.userId===this.client.getUserId()&&(void 0===this.deviceId||this.deviceId===this.client.getDeviceId())}},{key:"isAudioMuted",value:function(){return 0===this.stream.getAudioTracks().length||this.audioMuted}},{key:"isVideoMuted",value:function(){return 0===this.stream.getVideoTracks().length||this.videoMuted}},{key:"isSpeaking",value:function(){return this.speaking}},{key:"setNewStream",value:function(e){this.updateStream(this.stream,e)}},{key:"setAudioVideoMuted",value:function(e,t){null!==e&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),null!==t&&(this.videoMuted=t),this.emit(v.MuteStateChanged,this.audioMuted,this.videoMuted)}},{key:"measureVolumeActivity",value:function(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(v.VolumeChanged,-1/0)}},{key:"setSpeakingThreshold",value:function(e){this.speakingThreshold=e}},{key:"clone",value:function(){var e=this.client.getMediaHandler(),t=this.stream.clone();return f.logger.log("callFeed cloning stream ".concat(this.stream.id," newStream ").concat(t.id)),this.purpose===c.SDPStreamMetadataPurpose.Usermedia?e.userMediaStreams.push(t):e.screensharingStreams.push(t),new n({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:t,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}},{key:"dispose",value:function(){var e,t;clearTimeout(this.volumeLooperTimeout),null===(e=this.stream)||void 0===e||e.removeEventListener("addtrack",this.onAddTrack),null===(t=this.call)||void 0===t||t.removeListener(p.CallEvent.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,(0,d.releaseContext)()),this._disposed=!0,this.emit(v.Disposed)}},{key:"disposed",get:function(){return this._disposed},set:function(e){this._disposed=e}},{key:"getLocalVolume",value:function(){return this.localVolume}},{key:"setLocalVolume",value:function(e){this.localVolume=e,this.emit(v.LocalVolumeChanged,e)}}]),n}(h.TypedEventEmitter);e.exports.CallFeed=m})),n.register("kllza",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.releaseContext=e.exports.acquireContext=void 0;var r=null,n=0;e.exports.acquireContext=function(){return null===r&&(r=new AudioContext),n++,r};e.exports.releaseContext=function(){var e;0===--n&&(null===(e=r)||void 0===e||e.close(),r=null)}})),n.register("1fjoF",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DeviceInfo=void 0;var a,s,u=o(n("3rHpI"));(s=a||(a={}))[s.Blocked=-1]="Blocked",s[s.Unverified=0]="Unverified",s[s.Verified=1]="Verified";var l=function(){function e(t){(0,r.default)(this,e),this.deviceId=t,(0,u.default)(this,"algorithms",[]),(0,u.default)(this,"keys",{}),(0,u.default)(this,"verified",a.Unverified),(0,u.default)(this,"known",!1),(0,u.default)(this,"unsigned",{}),(0,u.default)(this,"signatures",{})}return(0,i.default)(e,[{key:"toStorage",value:function(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}},{key:"getFingerprint",value:function(){return this.keys["ed25519:"+this.deviceId]}},{key:"getIdentityKey",value:function(){return this.keys["curve25519:"+this.deviceId]}},{key:"getDisplayName",value:function(){return this.unsigned.device_display_name||null}},{key:"isBlocked",value:function(){return this.verified==a.Blocked}},{key:"isVerified",value:function(){return this.verified==a.Verified}},{key:"isUnverified",value:function(){return this.verified==a.Unverified}},{key:"isKnown",value:function(){return!0===this.known}}],[{key:"fromStorage",value:function(t,r){var n=new e(r);for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}}]),e}();e.exports.DeviceInfo=l,(0,u.default)(l,"DeviceVerification",{VERIFIED:a.Verified,UNVERIFIED:a.Unverified,BLOCKED:a.Blocked})})),n.register("fu2Ru",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("fIDX1"),l=n("mBz5n"),c=n("9oGi2"),d=n("hcUaE"),f=n("giCK6"),h=n("eQNFO"),p=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.OtherUserSpeakingError=e.exports.GroupCallUnknownDeviceError=e.exports.GroupCallType=e.exports.GroupCallTerminationReason=e.exports.GroupCallState=e.exports.GroupCallIntent=e.exports.GroupCallEvent=e.exports.GroupCallErrorCode=e.exports.GroupCallError=e.exports.GroupCall=void 0;var v,g,m,y,b,_,w,S,E,k=p(n("3rHpI")),M=n("6MMVS"),C=n("3Jrxc"),I=n("iTgYJ"),T=n("bcGqc"),R=n("jtqeE"),x=n("k2cpO"),O=n("ipwmE"),A=n("8bPbt"),D=n("bkEVI"),P=n("40nYe"),L=n("e8gas");function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,k.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.GroupCallIntent=v,(g=v||(e.exports.GroupCallIntent=v={})).Ring="m.ring",g.Prompt="m.prompt",g.Room="m.room",e.exports.GroupCallType=m,(y=m||(e.exports.GroupCallType=m={})).Video="m.video",y.Voice="m.voice",e.exports.GroupCallTerminationReason=b,(b||(e.exports.GroupCallTerminationReason=b={})).CallEnded="call_ended",e.exports.GroupCallEvent=_,(w=_||(e.exports.GroupCallEvent=_={})).GroupCallStateChanged="group_call_state_changed",w.ActiveSpeakerChanged="active_speaker_changed",w.CallsChanged="calls_changed",w.UserMediaFeedsChanged="user_media_feeds_changed",w.ScreenshareFeedsChanged="screenshare_feeds_changed",w.LocalScreenshareStateChanged="local_screenshare_state_changed",w.LocalMuteStateChanged="local_mute_state_changed",w.ParticipantsChanged="participants_changed",w.Error="error",e.exports.GroupCallErrorCode=S,(E=S||(e.exports.GroupCallErrorCode=S={})).NoUserMedia="no_user_media",E.UnknownDevice="unknown_device",E.PlaceCallFailed="place_call_failed";var N=function(e){(0,s.default)(n,e);var t=(0,f.default)(n);function n(e,i,a){var s;return(0,o.default)(this,n),a?(s=t.call(this,i+": "+a),(0,k.default)((0,r.default)(s),"code",void 0)):(s=t.call(this,i),(0,k.default)((0,r.default)(s),"code",void 0)),s.code=e,(0,u.default)(s)}return n}((0,d.default)(Error));e.exports.GroupCallError=N;var B=function(e){(0,s.default)(r,e);var t=(0,f.default)(r);function r(e){var n;return(0,o.default)(this,r),(n=t.call(this,S.UnknownDevice,"No device found for "+e)).userId=e,n}return r}(N);e.exports.GroupCallUnknownDeviceError=B;var F,K,q=function(e){(0,s.default)(r,e);var t=(0,f.default)(r);function r(){return(0,o.default)(this,r),t.call(this,"Cannot unmute: another user is speaking")}return r}((0,d.default)(Error));e.exports.OtherUserSpeakingError=q,e.exports.GroupCallState=F,(K=F||(e.exports.GroupCallState=F={})).LocalCallFeedUninitialized="local_call_feed_uninitialized",K.InitializingLocalCallFeed="initializing_local_call_feed",K.LocalCallFeedInitialized="local_call_feed_initialized",K.Entered="entered",K.Ended="ended";var W=36e5;function V(e){var t;return(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId)||e.invitee||null}var H=function(e){(0,s.default)(n,e);var t=(0,f.default)(n);function n(e,i,a,s,u,c,d,f){var h,p,v;return(0,o.default)(this,n),(h=t.call(this)).client=e,h.room=i,h.type=a,h.isPtt=s,h.intent=u,h.dataChannelsEnabled=d,h.dataChannelOptions=f,(0,k.default)((0,r.default)(h),"activeSpeakerInterval",1e3),(0,k.default)((0,r.default)(h),"retryCallInterval",5e3),(0,k.default)((0,r.default)(h),"participantTimeout",15e3),(0,k.default)((0,r.default)(h),"pttMaxTransmitTime",2e4),(0,k.default)((0,r.default)(h),"activeSpeaker",void 0),(0,k.default)((0,r.default)(h),"localCallFeed",void 0),(0,k.default)((0,r.default)(h),"localScreenshareFeed",void 0),(0,k.default)((0,r.default)(h),"localDesktopCapturerSourceId",void 0),(0,k.default)((0,r.default)(h),"userMediaFeeds",[]),(0,k.default)((0,r.default)(h),"screenshareFeeds",[]),(0,k.default)((0,r.default)(h),"groupCallId",void 0),(0,k.default)((0,r.default)(h),"calls",new Map),(0,k.default)((0,r.default)(h),"callHandlers",new Map),(0,k.default)((0,r.default)(h),"activeSpeakerLoopInterval",void 0),(0,k.default)((0,r.default)(h),"retryCallLoopInterval",void 0),(0,k.default)((0,r.default)(h),"retryCallCounts",new Map),(0,k.default)((0,r.default)(h),"reEmitter",void 0),(0,k.default)((0,r.default)(h),"transmitTimer",null),(0,k.default)((0,r.default)(h),"participantsExpirationTimer",null),(0,k.default)((0,r.default)(h),"resendMemberStateTimer",null),(0,k.default)((0,r.default)(h),"initWithAudioMuted",!1),(0,k.default)((0,r.default)(h),"initWithVideoMuted",!1),(0,k.default)((0,r.default)(h),"_state",F.LocalCallFeedUninitialized),(0,k.default)((0,r.default)(h),"_participants",new Map),(0,k.default)((0,r.default)(h),"_creationTs",null),(0,k.default)((0,r.default)(h),"_enteredViaAnotherSession",!1),(0,k.default)((0,r.default)(h),"onIncomingCall",(function(e){var t,r;if(e.roomId===h.room.roomId)if(e.state===I.CallState.Ringing){if(!e.groupCallId||e.groupCallId!==h.groupCallId)return R.logger.log("Incoming call with groupCallId ".concat(e.groupCallId," ignored because it doesn't match the current group call")),void e.reject();var n=null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId;if(void 0!==n){var i=null!==(r=h.calls.get(n))&&void 0!==r?r:new Map,o=i.get(e.getOpponentDeviceId());(null==o?void 0:o.callId)!==e.callId&&(R.logger.log("GroupCall: incoming call from ".concat(n," with ID ").concat(e.callId)),o&&h.disposeCall(o,I.CallErrorCode.Replaced),h.initCall(e),e.answerWithCallFeeds(h.getLocalFeeds().map((function(e){return e.clone()}))),i.set(e.getOpponentDeviceId(),e),h.calls.set(n,i),h.emit(_.CallsChanged,h.calls))}else R.logger.warn("Incoming call with no member. Ignoring.")}else R.logger.warn("Incoming call no longer in ringing state. Ignoring.")})),(0,k.default)((0,r.default)(h),"onRetryCallLoop",(function(){var e=!1,t=!0,r=!1,n=void 0;try{for(var i,o=h.participants[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,l.default)(i.value,2),s=a[0].userId,u=a[1],c=h.calls.get(s),d=h.retryCallCounts.get(s),f=!0,p=!1,v=void 0;try{for(var g,m=u[Symbol.iterator]();!(f=(g=m.next()).done);f=!0){var y,b,_=(0,l.default)(g.value,2),w=_[0],S=_[1],E=null==c?void 0:c.get(w),k=null!==(y=null===(b=d)||void 0===b?void 0:b.get(w))&&void 0!==y?y:0;(null==E?void 0:E.getOpponentSessionId())!==S.sessionId&&h.wantsOutgoingCall(s,w)&&k<3&&(void 0===d&&(d=new Map,h.retryCallCounts.set(s,d)),d.set(w,k+1),e=!0)}}catch(e){p=!0,v=e}finally{try{f||null==m.return||m.return()}finally{if(p)throw v}}}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}e&&h.placeOutgoingCalls()})),(0,k.default)((0,r.default)(h),"onCallFeedsChanged",(function(e){var t=V(e),r=e.getOpponentDeviceId();if(!t)throw new Error("Cannot change call feeds without user id");var n=h.getUserMediaFeed(t,r),i=e.remoteUsermediaFeed;i!==n&&(!n&&i?h.addUserMediaFeed(i):n&&i?h.replaceUserMediaFeed(n,i):n&&!i&&h.removeUserMediaFeed(n));var o=h.getScreenshareFeed(t,r),a=e.remoteScreensharingFeed;a!==o&&(!o&&a?h.addScreenshareFeed(a):o&&a?h.replaceScreenshareFeed(o,a):o&&!a&&h.removeScreenshareFeed(o))})),(0,k.default)((0,r.default)(h),"onCallStateChanged",(function(e,t,r){var n,i=h.localCallFeed.isAudioMuted();e.localUsermediaStream&&e.isMicrophoneMuted()!==i&&e.setMicrophoneMuted(i);var o=h.localCallFeed.isVideoMuted();e.localUsermediaStream&&e.isLocalVideoMuted()!==o&&e.setLocalVideoMuted(o);var a=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId;if(t===I.CallState.Connected&&a){var s=h.retryCallCounts.get(a);null==s||s.delete(e.getOpponentDeviceId()),0===(null==s?void 0:s.size)&&h.retryCallCounts.delete(a)}})),(0,k.default)((0,r.default)(h),"onCallHangup",(function(e){var t,r;if(e.hangupReason!==I.CallErrorCode.Replaced){var n=null!==(t=null===(r=e.getOpponentMember())||void 0===r?void 0:r.userId)&&void 0!==t?t:h.room.getMember(e.invitee).userId,i=h.calls.get(n);(null==i?void 0:i.get(e.getOpponentDeviceId()))===e&&(h.disposeCall(e,e.hangupReason),i.delete(e.getOpponentDeviceId()),0===i.size&&h.calls.delete(n),h.emit(_.CallsChanged,h.calls))}})),(0,k.default)((0,r.default)(h),"onCallReplaced",(function(e,t){var r=e.getOpponentMember().userId,n=h.calls.get(r);void 0===n&&(n=new Map,h.calls.set(r,n)),h.disposeCall(e,I.CallErrorCode.Replaced),h.initCall(t),n.set(e.getOpponentDeviceId(),t),h.emit(_.CallsChanged,h.calls)})),(0,k.default)((0,r.default)(h),"onActiveSpeakerLoop",(function(){var e=void 0,t=void 0,r=!0,n=!1,i=void 0;try{for(var o,a=h.userMediaFeeds[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(!(s.isLocal()&&h.userMediaFeeds.length>1)){var u=s.speakingVolumeSamples.reduce((function(e,t){return e+Math.max(t,C.SPEAKING_THRESHOLD)}))/s.speakingVolumeSamples.length;(!e||u>e)&&(e=u,t=s)}}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}t&&h.activeSpeaker!==t&&e&&e>C.SPEAKING_THRESHOLD&&(h.activeSpeaker=t,h.emit(_.ActiveSpeakerChanged,h.activeSpeaker))})),(0,k.default)((0,r.default)(h),"onRoomState",(function(){return h.updateParticipants()})),(0,k.default)((0,r.default)(h),"onParticipantsChanged",(function(){h.state===F.Entered&&h.placeOutgoingCalls()})),(0,k.default)((0,r.default)(h),"onStateChanged",(function(e,t){e!==F.Entered&&t!==F.Entered&&e!==F.Ended||(h.updateParticipants(),h.updateMemberState().catch((function(e){return R.logger.error("Failed to update member state devices",e)})))})),(0,k.default)((0,r.default)(h),"onLocalFeedsChanged",(function(){h.state===F.Entered&&h.updateMemberState().catch((function(e){return R.logger.error("Failed to update member state feeds",e)}))})),h.reEmitter=new x.ReEmitter((0,r.default)(h)),h.groupCallId=null!=c?c:(0,I.genCallID)(),h.creationTs=null!==(p=null===(v=i.currentState.getStateEvents(A.EventType.GroupCallPrefix,h.groupCallId))||void 0===v?void 0:v.getTs())&&void 0!==p?p:null,h.updateParticipants(),i.on(T.RoomStateEvent.Update,h.onRoomState),h.on(_.ParticipantsChanged,h.onParticipantsChanged),h.on(_.GroupCallStateChanged,h.onStateChanged),h.on(_.LocalScreenshareStateChanged,h.onLocalFeedsChanged),h}return(0,a.default)(n,[{key:"create",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(P.GroupCallEventHandlerEvent.Outgoing,e),t={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0},[4,e.client.sendStateEvent(e.room.roomId,A.EventType.GroupCallPrefix,t,e.groupCallId)];case 1:return r.sent(),[2,e]}}))}))()}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;e!==t&&(this._state=e,this.emit(_.GroupCallStateChanged,e,t))}},{key:"participants",get:function(){return this._participants},set:function(e){var t=this._participants,r=function(e,t){return e.sessionId===t.sessionId&&e.screensharing===t.screensharing};(0,L.mapsEqual)(e,t,(function(e,t){return(0,L.mapsEqual)(e,t,r)}))||(this._participants=e,this.emit(_.ParticipantsChanged,e))}},{key:"creationTs",get:function(){return this._creationTs},set:function(e){this._creationTs=e}},{key:"enteredViaAnotherSession",get:function(){return this._enteredViaAnotherSession},set:function(e){this._enteredViaAnotherSession=e,this.updateParticipants()}},{key:"forEachCall",value:function(e){var t=!0,r=!1,n=void 0,i=!0,o=!1,a=void 0;try{for(var s,u=this.calls.values()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;try{for(var c,d=l.values()[Symbol.iterator]();!(t=(c=d.next()).done);t=!0){e(c.value)}}catch(e){r=!0,n=e}finally{try{t||null==d.return||d.return()}finally{if(r)throw n}}}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}},{key:"getLocalFeeds",value:function(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}},{key:"hasLocalParticipant",value:function(){var e,t;return null!==(e=null===(t=this.participants.get(this.room.getMember(this.client.getUserId())))||void 0===t?void 0:t.has(this.client.getDeviceId()))&&void 0!==e&&e}},{key:"initLocalCallFeed",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o;return(0,h.__generator)(this,(function(a){switch(a.label){case 0:if(R.logger.log("groupCall ".concat(e.groupCallId," initLocalCallFeed")),e.state!==F.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));e.state=F.InitializingLocalCallFeed,r=!1,n=function(e){e===F.LocalCallFeedUninitialized&&(r=!0)},e.on(_.GroupCallStateChanged,n),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,e.client.getMediaHandler().getUserMediaStream(!0,e.type===m.Video)];case 2:return t=a.sent(),[3,5];case 3:throw i=a.sent(),e.state=F.LocalCallFeedUninitialized,i;case 4:return e.off(_.GroupCallStateChanged,n),[7];case 5:if(r)throw new Error("Group call disposed");return o=new C.CallFeed({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:t,purpose:O.SDPStreamMetadataPurpose.Usermedia,audioMuted:e.initWithAudioMuted||0===t.getAudioTracks().length||e.isPtt,videoMuted:e.initWithVideoMuted||0===t.getVideoTracks().length}),(0,I.setTracksEnabled)(t.getAudioTracks(),!o.isAudioMuted()),(0,I.setTracksEnabled)(t.getVideoTracks(),!o.isVideoMuted()),e.localCallFeed=o,e.addUserMediaFeed(o),e.state=F.LocalCallFeedInitialized,[2,o]}}))}))()}},{key:"updateLocalUsermediaStream",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i;return(0,h.__generator)(this,(function(o){return t.localCallFeed&&(r=t.localCallFeed.stream,t.localCallFeed.setNewStream(e),n=t.localCallFeed.isAudioMuted(),i=t.localCallFeed.isVideoMuted(),R.logger.log("groupCall ".concat(t.groupCallId," updateLocalUsermediaStream oldStream ").concat(r.id," newStream ").concat(e.id," micShouldBeMuted ").concat(n," vidShouldBeMuted ").concat(i)),(0,I.setTracksEnabled)(e.getAudioTracks(),!n),(0,I.setTracksEnabled)(e.getVideoTracks(),!i),t.client.getMediaHandler().stopUserMediaStream(r)),[2]}))}))()}},{key:"enter",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a;return(0,h.__generator)(this,(function(s){switch(s.label){case 0:return e.state!==F.LocalCallFeedUninitialized?[3,2]:[4,e.initLocalCallFeed()];case 1:return s.sent(),[3,3];case 2:if(e.state!==F.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));s.label=3;case 3:R.logger.log("Entered group call ".concat(e.groupCallId)),e.state=F.Entered,e.client.on(D.CallEventHandlerEvent.Incoming,e.onIncomingCall),t=!0,r=!1,n=void 0;try{for(i=e.client.callEventHandler.calls.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)a=o.value,e.onIncomingCall(a)}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}return e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval),[2]}}))}))()}},{key:"dispose",value:function(){var e=this;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),null!==this.transmitTimer&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),void 0!==this.retryCallLoopInterval&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.state===F.Entered&&(this.forEachCall((function(t){return e.disposeCall(t,I.CallErrorCode.UserHangup)})),this.calls.clear(),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(D.CallEventHandlerEvent.Incoming,this.onIncomingCall))}},{key:"leave",value:function(){this.dispose(),this.state=F.LocalCallFeedUninitialized}},{key:"terminate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this;return(0,i.default)((function(){var r;return(0,h.__generator)(this,(function(n){switch(n.label){case 0:return t.dispose(),t.room.off(T.RoomStateEvent.Update,t.onRoomState),t.client.groupCallEventHandler.groupCalls.delete(t.room.roomId),t.client.emit(P.GroupCallEventHandlerEvent.Ended,t),t.state=F.Ended,e?(r=t.room.currentState.getStateEvents(A.EventType.GroupCallPrefix,t.groupCallId),[4,t.client.sendStateEvent(t.room.roomId,A.EventType.GroupCallPrefix,j(j({},r.getContent()),{},{"m.terminated":b.CallEnded}),t.groupCallId)]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))()}},{key:"isLocalVideoMuted",value:function(){return!this.localCallFeed||this.localCallFeed.isVideoMuted()}},{key:"isMicrophoneMuted",value:function(){return!this.localCallFeed||this.localCallFeed.isAudioMuted()}},{key:"setMicrophoneMuted",value:function(e){var t=this;return(0,i.default)((function(){var r,n,o;return(0,h.__generator)(this,(function(a){switch(a.label){case 0:return(r=!e)?[4,t.client.getMediaHandler().hasAudioDevice()]:[3,2];case 1:r=!a.sent(),a.label=2;case 2:return r?[2,!1]:(n=!e&&t.isPtt,t.isPtt&&(!e&&t.isMicrophoneMuted()?t.transmitTimer=setTimeout((function(){t.setMicrophoneMuted(!0)}),t.pttMaxTransmitTime):e&&!t.isMicrophoneMuted()&&(null!==t.transmitTimer&&clearTimeout(t.transmitTimer),t.transmitTimer=null)),t.forEachCall((function(t){var r;return null===(r=t.localUsermediaFeed)||void 0===r?void 0:r.setAudioVideoMuted(e,null)})),s=(0,i.default)((function(){var e;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:return e=[],t.forEachCall((function(t){return e.push(t.sendMetadataUpdate())})),[4,Promise.all(e).catch((function(e){return R.logger.info("Failed to send some metadata updates",e)}))];case 1:return r.sent(),[2]}}))})),o=function(){return s.apply(this,arguments)},n?[4,o()]:[3,4]);case 3:a.sent(),a.label=4;case 4:return t.localCallFeed?(R.logger.log("groupCall ".concat(t.groupCallId," setMicrophoneMuted stream ").concat(t.localCallFeed.stream.id," muted ").concat(e)),t.localCallFeed.setAudioVideoMuted(e,null),(0,I.setTracksEnabled)(t.localCallFeed.stream.getAudioTracks(),!e)):(R.logger.log("groupCall ".concat(t.groupCallId," setMicrophoneMuted no stream muted ").concat(e)),t.initWithAudioMuted=e),t.forEachCall((function(t){return(0,I.setTracksEnabled)(t.localUsermediaFeed.stream.getAudioTracks(),!e)})),t.emit(_.LocalMuteStateChanged,e,t.isLocalVideoMuted()),n?[3,6]:[4,o()];case 5:a.sent(),a.label=6;case 6:return[2,!0]}var s}))}))()}},{key:"setLocalVideoMuted",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i;return(0,h.__generator)(this,(function(o){switch(o.label){case 0:return(r=!e)?[4,t.client.getMediaHandler().hasVideoDevice()]:[3,2];case 1:r=!o.sent(),o.label=2;case 2:return r?[2,!1]:t.localCallFeed?(R.logger.log("groupCall ".concat(t.groupCallId," setLocalVideoMuted stream ").concat(t.localCallFeed.stream.id," muted ").concat(e)),[4,t.client.getMediaHandler().getUserMediaStream(!0,!e)]):[3,5];case 3:return n=o.sent(),[4,t.updateLocalUsermediaStream(n)];case 4:return o.sent(),t.localCallFeed.setAudioVideoMuted(null,e),(0,I.setTracksEnabled)(t.localCallFeed.stream.getVideoTracks(),!e),[3,6];case 5:R.logger.log("groupCall ".concat(t.groupCallId," setLocalVideoMuted no stream muted ").concat(e)),t.initWithVideoMuted=e,o.label=6;case 6:return i=[],t.forEachCall((function(t){return i.push(t.setLocalVideoMuted(e))})),[4,Promise.all(i)];case 7:return o.sent(),t.emit(_.LocalMuteStateChanged,t.isMicrophoneMuted(),e),[2,!0]}}))}))()}},{key:"setScreensharingEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,c,d;return(0,h.__generator)(this,(function(f){switch(f.label){case 0:if(e===r.isScreensharing())return[2,e];if(!e)return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),R.logger.log("Asking for screensharing permissions..."),[4,r.client.getMediaHandler().getScreensharingStream(t)];case 2:n=f.sent(),i=!0,o=!1,a=void 0;try{for(s=n.getTracks()[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)l=u.value,c=function(){r.setScreensharingEnabled(!1),l.removeEventListener("ended",c)},l.addEventListener("ended",c)}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return R.logger.log("Screensharing permissions granted. Setting screensharing enabled on all calls"),r.localDesktopCapturerSourceId=t.desktopCapturerSourceId,r.localScreenshareFeed=new C.CallFeed({client:r.client,roomId:r.room.roomId,userId:r.client.getUserId(),deviceId:r.client.getDeviceId(),stream:n,purpose:O.SDPStreamMetadataPurpose.Screenshare,audioMuted:!1,videoMuted:!1}),r.addScreenshareFeed(r.localScreenshareFeed),r.emit(_.LocalScreenshareStateChanged,!0,r.localScreenshareFeed,r.localDesktopCapturerSourceId),r.forEachCall((function(e){return e.pushLocalFeed(r.localScreenshareFeed.clone())})),[2,!0];case 3:if(d=f.sent(),t.throwOnFail)throw d;return R.logger.error("Enabling screensharing error",d),r.emit(_.Error,new N(S.NoUserMedia,"Failed to get screen-sharing stream: ",d)),[2,!1];case 4:return[3,6];case 5:return r.forEachCall((function(e){e.localScreensharingFeed&&e.removeLocalFeed(e.localScreensharingFeed)})),r.client.getMediaHandler().stopScreensharingStream(r.localScreenshareFeed.stream),r.removeScreenshareFeed(r.localScreenshareFeed),r.localScreenshareFeed=void 0,r.localDesktopCapturerSourceId=void 0,r.emit(_.LocalScreenshareStateChanged,!1,void 0,void 0),[2,!1];case 6:return[2]}}))}))()}},{key:"isScreensharing",value:function(){return!!this.localScreenshareFeed}},{key:"wantsOutgoingCall",value:function(e,t){var r=this.client.getUserId(),n=this.client.getDeviceId();return e>=r&&(e!==r||t>n)}},{key:"placeOutgoingCalls",value:function(){var e=this,t=!1,r=!0,n=!1,i=void 0;try{for(var o,a=this,s=function(){var r,n=(0,l.default)(o.value,2),i=n[0].userId,s=n[1],u=null!==(r=a.calls.get(i))&&void 0!==r?r:new Map,c=!0,d=!1,f=void 0;try{for(var h,p=a,v=function(){var r=(0,l.default)(h.value,2),n=r[0],o=r[1],a=u.get(n);if((null==a?void 0:a.getOpponentSessionId())!==o.sessionId&&p.wantsOutgoingCall(i,n)){t=!0,void 0!==a&&(R.logger.debug("Replacing call ".concat(a.callId," to ").concat(i," ").concat(n)),p.disposeCall(a,I.CallErrorCode.NewSession));var s=(0,I.createNewMatrixCall)(p.client,p.room.roomId,{invitee:i,opponentDeviceId:n,opponentSessionId:o.sessionId,groupCallId:p.groupCallId});null===s?(R.logger.error("Failed to create call with ".concat(i," ").concat(n)),u.delete(n)):(p.initCall(s),u.set(n,s),R.logger.debug("Placing call to ".concat(i," ").concat(n," (session ").concat(o.sessionId,")")),s.placeCallWithCallFeeds(p.getLocalFeeds().map((function(e){return e.clone()})),o.screensharing).then((function(){e.dataChannelsEnabled&&s.createDataChannel("datachannel",e.dataChannelOptions)})).catch((function(t){R.logger.warn("Failed to place call to ".concat(i),t),t instanceof I.CallError&&t.code===S.UnknownDevice?e.emit(_.Error,t):e.emit(_.Error,new N(S.PlaceCallFailed,"Failed to place call to ".concat(i))),e.disposeCall(s,I.CallErrorCode.SignallingFailed),u.get(n)===s&&u.delete(n)})))}},g=s[Symbol.iterator]();!(c=(h=g.next()).done);c=!0)v()}catch(e){d=!0,f=e}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}u.size>0?a.calls.set(i,u):a.calls.delete(i)},u=this.participants[Symbol.iterator]();!(r=(o=u.next()).done);r=!0)s()}catch(e){n=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(n)throw i}}t&&this.emit(_.CallsChanged,this.calls)}},{key:"getMemberStateEvents",value:function(e){return void 0===e?this.room.currentState.getStateEvents(A.EventType.GroupCallMemberPrefix):this.room.currentState.getStateEvents(A.EventType.GroupCallMemberPrefix,e)}},{key:"initCall",value:function(e){var t=this,r=V(e);if(!r)throw new Error("Cannot init call without user id");var n=function(){return t.onCallFeedsChanged(e)},i=function(r,n){return t.onCallStateChanged(e,r,n)},o=this.onCallHangup,a=function(r){return t.onCallReplaced(e,r)},s=this.callHandlers.get(r);void 0===s&&(s=new Map,this.callHandlers.set(r,s)),s.set(e.getOpponentDeviceId(),{onCallFeedsChanged:n,onCallStateChanged:i,onCallHangup:o,onCallReplaced:a}),e.on(I.CallEvent.FeedsChanged,n),e.on(I.CallEvent.State,i),e.on(I.CallEvent.Hangup,o),e.on(I.CallEvent.Replaced,a),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(I.CallEvent)),n()}},{key:"disposeCall",value:function(e,t){var r=V(e),n=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");var i=this.callHandlers.get(r),o=i.get(n),a=o.onCallFeedsChanged,s=o.onCallStateChanged,u=o.onCallHangup,l=o.onCallReplaced;if(e.removeListener(I.CallEvent.FeedsChanged,a),e.removeListener(I.CallEvent.State,s),e.removeListener(I.CallEvent.Hangup,u),e.removeListener(I.CallEvent.Replaced,l),i.delete(r),0===i.size&&this.callHandlers.delete(r),e.hangupReason!==I.CallErrorCode.Replaced){e.state!==I.CallState.Ended&&e.hangup(t,!1);var c=this.getUserMediaFeed(r,n);c&&this.removeUserMediaFeed(c);var d=this.getScreenshareFeed(r,n);d&&this.removeScreenshareFeed(d)}}},{key:"getUserMediaFeed",value:function(e,t){return this.userMediaFeeds.find((function(r){return r.userId===e&&r.deviceId===t}))}},{key:"addUserMediaFeed",value:function(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(_.UserMediaFeedsChanged,this.userMediaFeeds)}},{key:"replaceUserMediaFeed",value:function(e,t){var r=this.userMediaFeeds.findIndex((function(t){return t.userId===e.userId&&t.deviceId===e.deviceId}));if(-1===r)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,t),e.dispose(),t.measureVolumeActivity(!0),this.emit(_.UserMediaFeedsChanged,this.userMediaFeeds)}},{key:"removeUserMediaFeed",value:function(e){var t=this.userMediaFeeds.findIndex((function(t){return t.userId===e.userId&&t.deviceId===e.deviceId}));if(-1===t)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(t,1),e.dispose(),this.emit(_.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(_.ActiveSpeakerChanged,this.activeSpeaker))}},{key:"getScreenshareFeed",value:function(e,t){return this.screenshareFeeds.find((function(r){return r.userId===e&&r.deviceId===t}))}},{key:"addScreenshareFeed",value:function(e){this.screenshareFeeds.push(e),this.emit(_.ScreenshareFeedsChanged,this.screenshareFeeds)}},{key:"replaceScreenshareFeed",value:function(e,t){var r=this.screenshareFeeds.findIndex((function(t){return t.userId===e.userId&&t.deviceId===e.deviceId}));if(-1===r)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,t),e.dispose(),this.emit(_.ScreenshareFeedsChanged,this.screenshareFeeds)}},{key:"removeScreenshareFeed",value:function(e){var t=this.screenshareFeeds.findIndex((function(t){return t.userId===e.userId&&t.deviceId===e.deviceId}));if(-1===t)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(t,1),e.dispose(),this.emit(_.ScreenshareFeedsChanged,this.screenshareFeeds)}},{key:"updateParticipants",value:function(){var e=this;if(null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state!==F.Ended){var t=new Map,r=Date.now(),n=this.state===F.Entered||this.enteredViaAnotherSession,i=1/0,o=!0,a=!1,s=void 0;try{for(var u,l=this,c=function(){var o=u.value,a=l.room.getMember(o.getStateKey()),s=o.getContent(),c=(Array.isArray(s["m.calls"])?s["m.calls"]:[]).find((function(t){return t["m.call_id"]===e.groupCallId})),d=(Array.isArray(null==c?void 0:c["m.devices"])?c["m.devices"]:[]).filter((function(e){return"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>r&&Array.isArray(e.feeds)}));if(n||(null==a?void 0:a.userId)!==l.client.getUserId()||(d=d.filter((function(t){return t.device_id!==e.client.getDeviceId()}))),d.length>0&&"join"===(null==a?void 0:a.membership)){var f=new Map;t.set(a,f);var h=!0,p=!1,v=void 0;try{for(var g,m=d[Symbol.iterator]();!(h=(g=m.next()).done);h=!0){var y=g.value;f.set(y.device_id,{sessionId:y.session_id,screensharing:y.feeds.some((function(e){return e.purpose===O.SDPStreamMetadataPurpose.Screenshare}))}),y.expires_ts<i&&(i=y.expires_ts)}}catch(e){p=!0,v=e}finally{try{h||null==m.return||m.return()}finally{if(p)throw v}}}},d=this.getMemberStateEvents()[Symbol.iterator]();!(o=(u=d.next()).done);o=!0)c()}catch(e){a=!0,s=e}finally{try{o||null==d.return||d.return()}finally{if(a)throw s}}if(n){var f=this.room.getMember(this.client.getUserId()),h=t.get(f);void 0===h&&(h=new Map,t.set(f,h)),h.has(this.client.getDeviceId())||h.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some((function(e){return e.purpose===O.SDPStreamMetadataPurpose.Screenshare}))})}this.participants=t,i<1/0&&(this.participantsExpirationTimer=setTimeout((function(){return e.updateParticipants()}),i-r))}else this.participants=new Map}},{key:"updateDevices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,d,f,p,v,g,m,y,b,_,w,S,E;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:i=Date.now(),o=r.client.getUserId(),a=r.getMemberStateEvents(o),s=null!==(n=null==a?void 0:a.getContent())&&void 0!==n?n:{},u=Array.isArray(s["m.calls"])?s["m.calls"]:[],l=null,d=[],f=!0,p=!1,v=void 0;try{for(g=u[Symbol.iterator]();!(f=(m=g.next()).done);f=!0)(y=m.value)["m.call_id"]===r.groupCallId?l=y:d.push(y)}catch(e){p=!0,v=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw v}}return null===l&&(l={}),b=Array.isArray(l["m.devices"])?l["m.devices"]:[],_=b.filter((function(e){return"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>i&&Array.isArray(e.feeds)})),null===(w=e(_))?[2]:(S=(0,c.default)(d),w.length>0&&S.push(j(j({},l),{},{"m.call_id":r.groupCallId,"m.devices":w})),E={"m.calls":S},[4,r.client.sendStateEvent(r.room.roomId,A.EventType.GroupCallMemberPrefix,E,o,{keepAlive:t})]);case 1:return h.sent(),[2]}}))}))()}},{key:"addDeviceToMemberState",value:function(){var e=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.updateDevices((function(t){return(0,c.default)(t.filter((function(t){return t.device_id!==e.client.getDeviceId()}))).concat([{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+W,feeds:e.getLocalFeeds().map((function(e){return{purpose:e.purpose}}))}])}))];case 1:return t.sent(),[2]}}))}))()}},{key:"updateMemberState",value:function(){var e=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(t){switch(t.label){case 0:return null!==e.resendMemberStateTimer&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state!==F.Entered?[3,2]:[4,e.addDeviceToMemberState()];case 1:return t.sent(),e.resendMemberStateTimer=setInterval((0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){switch(r.label){case 0:R.logger.log("Resending call member state"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.addDeviceToMemberState()];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),R.logger.error("Failed to resend call member state",t),[3,4];case 4:return[2]}}))})),27e5),[3,4];case 2:return[4,e.updateDevices((function(t){return t.filter((function(t){return t.device_id!==e.client.getDeviceId()}))}),!0)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))()}},{key:"cleanMemberState",value:function(){var e=this;return(0,i.default)((function(){var t,r,n;return(0,h.__generator)(this,(function(i){switch(i.label){case 0:return[4,e.client.getDevices()];case 1:return t=i.sent(),r=t.devices,n=new Map(r.map((function(e){return[e.device_id,e]}))),[4,e.updateDevices((function(t){var r=t.filter((function(t){var r=n.get(t.device_id);return void 0!==(null==r?void 0:r.last_seen_ts)&&!(t.device_id===e.client.getDeviceId()&&e.state!==F.Entered&&!e.enteredViaAnotherSession)}));return r.length===t.length?null:r}))];case 2:return i.sent(),[2]}}))}))()}}]),n}(M.TypedEventEmitter);e.exports.GroupCall=H})),n.register("bkEVI",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.CallEventHandlerEvent=e.exports.CallEventHandler=void 0;var u,l=s(n("3rHpI")),c=n("jtqeE"),d=n("iTgYJ"),f=n("8bPbt"),h=n("4uAg3"),p=n("fu2Ru"),v=n("5xqDi");e.exports.CallEventHandlerEvent=u,(u||(e.exports.CallEventHandlerEvent=u={})).Incoming="Call.incoming";var g=function(){function e(t){var r=this;(0,i.default)(this,e),(0,l.default)(this,"calls",void 0),(0,l.default)(this,"callEventBuffer",void 0),(0,l.default)(this,"nextSeqByCall",new Map),(0,l.default)(this,"toDeviceEventBuffers",new Map),(0,l.default)(this,"client",void 0),(0,l.default)(this,"candidateEventsByCall",void 0),(0,l.default)(this,"eventBufferPromiseChain",void 0),(0,l.default)(this,"onSync",(function(){var e=r.callEventBuffer;r.callEventBuffer=[],r.eventBufferPromiseChain?r.eventBufferPromiseChain=r.eventBufferPromiseChain.then((function(){return r.evaluateEventBuffer(e)})):r.eventBufferPromiseChain=r.evaluateEventBuffer(e)})),(0,l.default)(this,"onRoomTimeline",(function(e){r.callEventBuffer.push(e)})),(0,l.default)(this,"onToDeviceEvent",(function(e){var t=e.getContent();if(t.call_id)if(r.nextSeqByCall.has(t.call_id)||r.nextSeqByCall.set(t.call_id,0),void 0!==t.seq){var n=r.nextSeqByCall.get(t.call_id)||0;if(t.seq!==n){r.toDeviceEventBuffers.has(t.call_id)||r.toDeviceEventBuffers.set(t.call_id,[]);var i=r.toDeviceEventBuffers.get(t.call_id),o=i.findIndex((function(e){return e.getContent().seq>t.seq}));-1===o?i.push(e):i.splice(o,0,e)}else{var a=t.call_id;r.callEventBuffer.push(e),r.nextSeqByCall.set(a,t.seq+1);for(var s=r.toDeviceEventBuffers.get(a),u=s&&s.shift();u&&u.getContent().seq===r.nextSeqByCall.get(a);)r.callEventBuffer.push(u),r.nextSeqByCall.set(a,u.getContent().seq+1),u=s.shift()}}else r.callEventBuffer.push(e);else r.callEventBuffer.push(e)})),this.client=t,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}return(0,o.default)(e,[{key:"start",value:function(){this.client.on(h.ClientEvent.Sync,this.onSync),this.client.on(v.RoomEvent.Timeline,this.onRoomTimeline),this.client.on(h.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)}},{key:"stop",value:function(){this.client.removeListener(h.ClientEvent.Sync,this.onSync),this.client.removeListener(v.RoomEvent.Timeline,this.onRoomTimeline),this.client.removeListener(h.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)}},{key:"evaluateEventBuffer",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,u,l,d,h,p,v,g,m,y,b,_,w,S,E;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return[4,Promise.all(e.map((function(e){return t.client.decryptEventIfNeeded(e)})))];case 1:a.sent(),r=e.filter((function(e){var t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")})),n=new Set,i=!0,o=!1,s=void 0;try{for(u=r[Symbol.iterator]();!(i=(l=u.next()).done);i=!0)d=l.value,(h=d.getType())!==f.EventType.CallAnswer&&h!==f.EventType.CallHangup||n.add(d.getContent().call_id)}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}p=!0,v=!1,g=void 0,a.label=2;case 2:a.trys.push([2,9,10,11]),m=r[Symbol.iterator](),a.label=3;case 3:if(p=(y=m.next()).done)return[3,8];if(b=y.value,_=b.getType(),w=b.getContent().call_id,_===f.EventType.CallInvite&&n.has(w))return[3,7];a.label=4;case 4:return a.trys.push([4,6,,7]),[4,t.handleCallEvent(b)];case 5:return a.sent(),[3,7];case 6:return S=a.sent(),c.logger.error("Caught exception handling call event",S),[3,7];case 7:return p=!0,[3,3];case 8:return[3,11];case 9:return E=a.sent(),v=!0,g=E,[3,11];case 10:try{p||null==m.return||m.return()}finally{if(v)throw g}return[7];case 11:return[2]}}))}))()}},{key:"handleCallEvent",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,l,v,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x,O,A,D,P,L,U,j,N,B,F;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:if(t.client.emit(h.ClientEvent.ReceivedVoipEvent,e),i=e.getContent(),o=e.getRoomId()||(null===(r=t.client.groupCallEventHandler.getGroupCallById(i.conf_id))||void 0===r||null===(n=r.room)||void 0===n?void 0:n.roomId),s=i.conf_id,l=e.getType(),v=e.getSender(),g=i.call_id?t.calls.get(i.call_id):void 0,s){if(!(y=t.client.groupCallEventHandler.getGroupCallById(s)))return c.logger.warn("Cannot find a group call ".concat(s," for event ").concat(l,". Ignoring event.")),[2];if(!(m=i.device_id))return c.logger.warn("Cannot find a device id for ".concat(v,". Ignoring event.")),y.emit(p.GroupCallEvent.Error,new p.GroupCallUnknownDeviceError(v)),[2];if(i.dest_session_id!==t.client.getSessionId())return c.logger.warn("Call event does not match current session id, ignoring."),[2]}if(b=v===t.client.credentials.userId&&(void 0===m||m===t.client.getDeviceId()),!o)return[2];if(l!==f.EventType.CallInvite)return[3,5];if(b)return[2];if(e.getLocalAge()>i.lifetime-3e3)return[2];if(g&&g.state===d.CallState.Ended)return[2];if(g&&c.logger.log("WARN: Already have a MatrixCall with id ".concat(i.call_id," but got an ")+"invite. Clobbering."),i.invitee&&i.invitee!==t.client.getUserId())return[2];if(S=(null!==(_=t.client.getTurnServersExpiry())&&void 0!==_?_:0)-Date.now(),c.logger.info("Current turn creds expire in "+S+" ms"),!(g=null!==(w=(0,d.createNewMatrixCall)(t.client,o,{forceTURN:t.client.forceTURN,opponentDeviceId:m,groupCallId:s,opponentSessionId:i.sender_session_id}))&&void 0!==w?w:void 0))return c.logger.log("Incoming call ID "+i.call_id+" but this client doesn't support WebRTC"),[2];g.callId=i.call_id,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,g.initWithInvite(e)];case 2:return a.sent(),[3,4];case 3:return(E=a.sent())instanceof d.CallError&&(E.code===p.GroupCallErrorCode.UnknownDevice?null===(k=y)||void 0===k||k.emit(p.GroupCallEvent.Error,E):c.logger.error(E)),[3,4];case 4:if(t.calls.set(g.callId,g),M=!0,C=!1,I=void 0,t.candidateEventsByCall.get(g.callId))try{for(T=t.candidateEventsByCall.get(g.callId)[Symbol.iterator]();!(M=(R=T.next()).done);M=!0)x=R.value,g.onRemoteIceCandidatesReceived(x)}catch(e){C=!0,I=e}finally{try{M||null==T.return||T.return()}finally{if(C)throw I}}A=!0,D=!1,P=void 0;try{for(L=t.calls.values()[Symbol.iterator]();!(A=(U=L.next()).done);A=!0)if(j=U.value,B=[d.CallState.WaitLocalMedia,d.CallState.CreateOffer,d.CallState.InviteSent].includes(j.state),g.roomId===j.roomId&&j.direction===d.CallDirection.Outbound&&(null===(N=g.getOpponentMember())||void 0===N?void 0:N.userId)===j.invitee&&B){O=j;break}}catch(e){D=!0,P=e}finally{try{A||null==L.return||L.return()}finally{if(D)throw P}}return O?O.callId>g.callId?(c.logger.log("Glare detected: answering incoming call "+g.callId+" and canceling outgoing call "+O.callId),O.replacedBy(g)):(c.logger.log("Glare detected: rejecting incoming call "+g.callId+" and keeping outgoing call "+O.callId),g.hangup(d.CallErrorCode.Replaced,!0)):t.client.emit(u.Incoming,g),[2];case 5:if(l===f.EventType.CallCandidates)return b||(g?g.onRemoteIceCandidatesReceived(e):(t.candidateEventsByCall.has(i.call_id)||t.candidateEventsByCall.set(i.call_id,[]),t.candidateEventsByCall.get(i.call_id).push(e))),[2];if([f.EventType.CallHangup,f.EventType.CallReject].includes(l))return g?g.state!==d.CallState.Ended&&(l===f.EventType.CallHangup?g.onHangupReceived(i):g.onRejectReceived(i),g.state===d.CallState.Ended&&t.calls.delete(i.call_id)):(g=null!==(F=(0,d.createNewMatrixCall)(t.client,o,{opponentDeviceId:m,opponentSessionId:i.sender_session_id}))&&void 0!==F?F:void 0)&&(g.callId=i.call_id,g.initWithHangup(e),t.calls.set(i.call_id,g)),[2];a.label=6;case 6:if(!g||!g.hasPeerConnection)return c.logger.info("Discarding possible call event ".concat(e.getId()," as we don't have a call/peerConn"),l),[2];if(e.getContent().party_id===g.ourPartyId)return[2];switch(l){case f.EventType.CallAnswer:b?g.state===d.CallState.Ringing&&g.onAnsweredElsewhere(i):g.onAnswerReceived(e);break;case f.EventType.CallSelectAnswer:g.onSelectAnswerReceived(e);break;case f.EventType.CallNegotiate:g.onNegotiateReceived(e);break;case f.EventType.CallAssertedIdentity:case f.EventType.CallAssertedIdentityPrefix:g.onAssertedIdentityReceived(e);break;case f.EventType.CallSDPStreamMetadataChanged:case f.EventType.CallSDPStreamMetadataChangedPrefix:g.onSDPStreamMetadataChangedReceived(e)}return[2]}}))}))()}}]),e}();e.exports.CallEventHandler=g})),n.register("40nYe",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("9oGi2"),s=n("eQNFO"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.GroupCallEventHandlerEvent=e.exports.GroupCallEventHandler=void 0;var l,c,d=u(n("3rHpI")),f=n("4uAg3"),h=n("fu2Ru"),p=n("bcGqc"),v=n("jtqeE"),g=n("8bPbt"),m=n("kk8uI");e.exports.GroupCallEventHandlerEvent=l,(c=l||(e.exports.GroupCallEventHandlerEvent=l={})).Incoming="GroupCall.incoming",c.Outgoing="GroupCall.outgoing",c.Ended="GroupCall.ended",c.Participants="GroupCall.participants";var y=function(){function e(t){var r=this;(0,i.default)(this,e),this.client=t,(0,d.default)(this,"groupCalls",new Map),(0,d.default)(this,"roomDeferreds",new Map),(0,d.default)(this,"onRoomsChanged",(function(e){r.createGroupCallForRoom(e)})),(0,d.default)(this,"onRoomStateChanged",(function(e,t){if(e.getType()===g.EventType.GroupCallPrefix){var n=e.getStateKey(),i=e.getContent(),o=r.groupCalls.get(t.roomId);o||i["m.terminated"]?o&&o.groupCallId===n?i["m.terminated"]?o.terminate(!1):i["m.type"]!==o.type&&v.logger.warn("The group call type changed for room: ".concat(t.roomId,". Changing the group call type is currently unsupported.")):o&&o.groupCallId!==n&&v.logger.warn("Multiple group calls detected for room: ".concat(t.roomId,". Multiple group calls are currently unsupported.")):r.createGroupCallFromRoomStateEvent(e)}}))}return(0,o.default)(e,[{key:"start",value:function(){var e=this;return(0,r.default)((function(){var t,r,n,i,o,a,u;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return e.client.getSyncState()===m.SyncState.Syncing?[3,2]:(v.logger.debug("Waiting for client to start syncing..."),[4,new Promise((function(t){var r=function(){if(e.client.getSyncState()===m.SyncState.Syncing)return e.client.off(f.ClientEvent.Sync,r),t()};e.client.on(f.ClientEvent.Sync,r)}))]);case 1:s.sent(),s.label=2;case 2:t=e.client.getRooms(),r=!0,n=!1,i=void 0;try{for(o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)u=a.value,e.createGroupCallForRoom(u)}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e.client.on(f.ClientEvent.Room,e.onRoomsChanged),e.client.on(p.RoomStateEvent.Events,e.onRoomStateChanged),[2]}}))}))()}},{key:"stop",value:function(){this.client.removeListener(p.RoomStateEvent.Events,this.onRoomStateChanged)}},{key:"getRoomDeferred",value:function(e){var t,r=this.roomDeferreds.get(e);void 0===r&&((r={prom:new Promise((function(e){t=e}))}).resolve=t,this.roomDeferreds.set(e,r));return r}},{key:"waitUntilRoomReadyForGroupCalls",value:function(e){return this.getRoomDeferred(e).prom}},{key:"getGroupCallById",value:function(e){return(0,a.default)(this.groupCalls.values()).find((function(t){return t.groupCallId===e}))}},{key:"createGroupCallForRoom",value:function(e){var t=e.currentState.getStateEvents(g.EventType.GroupCallPrefix),r=t.sort((function(e,t){return t.getTs()-e.getTs()})),n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(!u.getContent()["m.terminated"]){v.logger.debug("Choosing group call ".concat(u.getStateKey()," with TS ")+"".concat(u.getTs()," for room ").concat(e.roomId," from ").concat(t.length," possible calls.")),this.createGroupCallFromRoomStateEvent(u);break}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}v.logger.info("Group call event handler processed room",e.roomId),this.getRoomDeferred(e.roomId).resolve()}},{key:"createGroupCallFromRoomStateEvent",value:function(e){var t=e.getRoomId(),r=e.getContent(),n=this.client.getRoom(t);if(n){var i=e.getStateKey(),o=r["m.type"];if(Object.values(h.GroupCallType).includes(o)){var a=r["m.intent"];if(Object.values(h.GroupCallIntent).includes(a)){var s,u=Boolean(r["io.element.ptt"]);if(null!=r&&r.dataChannelsEnabled&&null!=r&&r.dataChannelOptions){var c=r.dataChannelOptions;s={ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits,protocol:c.protocol}}var d=new h.GroupCall(this.client,n,o,u,a,i,null==r?void 0:r.dataChannelsEnabled,s);return this.groupCalls.set(n.roomId,d),this.client.emit(l.Incoming,d),d}v.logger.warn("Received invalid group call intent ".concat(o," for room ").concat(t,"."))}else v.logger.warn("Received invalid group call type ".concat(o," for room ").concat(t,"."))}else v.logger.warn("Couldn't find room ".concat(t," for GroupCall"))}}]),e}();e.exports.GroupCallEventHandler=y})),n.register("cCXi5",(function(e,t){var i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("eQNFO"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.AutoDiscoveryAction=e.exports.AutoDiscovery=void 0;var l,c,d,f,h=u(n("3rHpI")),p=n("jtqeE"),v=n("6BFg8");e.exports.AutoDiscoveryAction=l,(c=l||(e.exports.AutoDiscoveryAction=l={})).SUCCESS="SUCCESS",c.IGNORE="IGNORE",c.PROMPT="PROMPT",c.FAIL_PROMPT="FAIL_PROMPT",c.FAIL_ERROR="FAIL_ERROR",(f=d||(d={})).Invalid="Invalid homeserver discovery response",f.GenericFailure="Failed to get autodiscovery configuration from server",f.InvalidHsBaseUrl="Invalid base_url for m.homeserver",f.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",f.InvalidIsBaseUrl="Invalid base_url for m.identity_server",f.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",f.InvalidIs="Invalid identity server discovery response",f.MissingWellknown="No .well-known JSON file found",f.InvalidJson="Invalid JSON";var g=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,null,[{key:"fromDiscoveryConfig",value:function(t){var r=this;return(0,i.default)((function(){var n,i,o,a,u,c,d;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return i={"m.homeserver":{state:e.FAIL_ERROR,error:e.ERROR_INVALID,base_url:null},"m.identity_server":{state:e.PROMPT,error:null,base_url:null}},t&&t["m.homeserver"]?t["m.homeserver"].base_url?(o=r.sanitizeWellKnownUrl(t["m.homeserver"].base_url))?[4,r.fetchWellKnownObject("".concat(o,"/_matrix/client/versions"))]:(p.logger.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=e.ERROR_INVALID_HS_BASE_URL,[2,Promise.resolve(i)]):(p.logger.error("No m.homeserver base_url in config"),i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID_HS_BASE_URL,[2,Promise.resolve(i)]):(p.logger.error("No m.homeserver key in config"),i["m.homeserver"].state=e.FAIL_PROMPT,i["m.homeserver"].error=e.ERROR_INVALID,[2,Promise.resolve(i)]);case 1:return(a=s.sent())&&null!==(n=a.raw)&&void 0!==n&&n.versions?(i["m.homeserver"]={state:e.SUCCESS,error:null,base_url:o},u="",t["m.identity_server"]?(c={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:e.FAIL_PROMPT,error:e.ERROR_INVALID_IS,base_url:null}},(u=r.sanitizeWellKnownUrl(t["m.identity_server"].base_url))?[4,r.fetchWellKnownObject("".concat(u,"/_matrix/identity/v2"))]:(p.logger.error("Invalid base_url for m.identity_server"),c["m.identity_server"].error=e.ERROR_INVALID_IS_BASE_URL,[2,Promise.resolve(c)])):[3,3]):(p.logger.error("Invalid /versions response"),i["m.homeserver"].error=e.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=o,[2,Promise.resolve(i)]);case 2:if(null==(d=s.sent())||!d.raw||d.action!==l.SUCCESS)return p.logger.error("Invalid /v2 response"),c["m.identity_server"].error=e.ERROR_INVALID_IDENTITY_SERVER,c["m.identity_server"].base_url=u,[2,Promise.resolve(c)];s.label=3;case 3:return u&&u.toString().length>0&&(i["m.identity_server"]={state:e.SUCCESS,error:null,base_url:u}),Object.keys(t).forEach((function(e){if("m.homeserver"===e||"m.identity_server"===e){var r=["error","state","base_url"],n=!0,o=!1,a=void 0;try{for(var s,u=Object.keys(t[e])[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;r.includes(l)||(i[e][l]=t[e][l])}}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}}else i[e]=t[e]})),[2,Promise.resolve(i)]}}))}))()}},{key:"findClientConfig",value:function(t){var r=this;return(0,i.default)((function(){var n,i;return(0,s.__generator)(this,(function(o){switch(o.label){case 0:if(!t||"string"!=typeof t||0===t.length)throw new Error("'domain' must be a string of non-zero length");return n={"m.homeserver":{state:e.FAIL_ERROR,error:e.ERROR_INVALID,base_url:null},"m.identity_server":{state:e.PROMPT,error:null,base_url:null}},[4,r.fetchWellKnownObject("https://".concat(t,"/.well-known/matrix/client"))];case 1:return(i=o.sent())&&i.action===l.SUCCESS?[2,e.fromDiscoveryConfig(i.raw)]:(p.logger.error("No response or error when parsing .well-known"),i.reason&&p.logger.error(i.reason),i.action===l.IGNORE?n["m.homeserver"]={state:e.PROMPT,error:null,base_url:null}:(n["m.homeserver"].state=e.FAIL_PROMPT,n["m.homeserver"].error=e.ERROR_INVALID),[2,Promise.resolve(n)])}}))}))()}},{key:"getRawClientConfig",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");return[4,t.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"))];case 1:return(r=n.sent())?[2,r.raw||{}]:[2,{}]}}))}))()}},{key:"sanitizeWellKnownUrl",value:function(e){if(!e)return!1;try{var t,r;try{r=new URL(e)}catch(e){p.logger.error("Could not parse url",e)}if(null===(t=r)||void 0===t||!t.hostname)return!1;if("http:"!==r.protocol&&"https:"!==r.protocol)return!1;var n=r.port?":".concat(r.port):"",i=r.pathname?r.pathname:"",o="".concat(r.protocol,"//").concat(r.hostname).concat(n).concat(i);return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(e){return p.logger.error(e),!1}}},{key:"fetch",value:function(e,t){return this.fetchFn?this.fetchFn(e,t):r.fetch(e,t)}},{key:"setFetchFn",value:function(t){e.fetchFn=t}},{key:"fetchWellKnownObject",value:function(t){return(0,i.default)((function(){var r,n,i,o,a,u,c;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,e.fetch(t,{method:v.Method.Get,signal:(0,v.timeoutSignal)(5e3)})];case 1:return 404===(r=s.sent()).status?[2,{raw:{},action:l.IGNORE,reason:e.ERROR_MISSING_WELLKNOWN}]:r.ok?[3,3]:[2,{raw:{},action:l.FAIL_PROMPT,reason:"General failure"}];case 2:return n=s.sent(),o="","object"==typeof(i=n)&&(o=null==i?void 0:i.message),[2,{error:i,raw:{},action:l.FAIL_PROMPT,reason:o||"General failure"}];case 3:return s.trys.push([3,5,,6]),a={},[4,r.json()];case 4:return[2,(a.raw=s.sent(),a.action=l.SUCCESS,a)];case 5:return u=s.sent(),[2,{error:c=u,raw:{},action:l.FAIL_PROMPT,reason:"SyntaxError"===(null==c?void 0:c.name)?e.ERROR_INVALID_JSON:e.ERROR_INVALID}];case 6:return[2]}}))}))()}}]),e}();e.exports.AutoDiscovery=g,(0,h.default)(g,"ERROR_INVALID",d.Invalid),(0,h.default)(g,"ERROR_GENERIC_FAILURE",d.GenericFailure),(0,h.default)(g,"ERROR_INVALID_HS_BASE_URL",d.InvalidHsBaseUrl),(0,h.default)(g,"ERROR_INVALID_HOMESERVER",d.InvalidHomeserver),(0,h.default)(g,"ERROR_INVALID_IS_BASE_URL",d.InvalidIsBaseUrl),(0,h.default)(g,"ERROR_INVALID_IDENTITY_SERVER",d.InvalidIdentityServer),(0,h.default)(g,"ERROR_INVALID_IS",d.InvalidIs),(0,h.default)(g,"ERROR_MISSING_WELLKNOWN",d.MissingWellknown),(0,h.default)(g,"ERROR_INVALID_JSON",d.InvalidJson),(0,h.default)(g,"ALL_ERRORS",Object.keys(d)),(0,h.default)(g,"FAIL_ERROR",l.FAIL_ERROR),(0,h.default)(g,"FAIL_PROMPT",l.FAIL_PROMPT),(0,h.default)(g,"PROMPT",l.PROMPT),(0,h.default)(g,"SUCCESS",l.SUCCESS),(0,h.default)(g,"fetchFn",void 0)})),n.register("dbGKv",(function(e,t){var i=n("2swew"),o=n("mBz5n"),a=n("9oGi2"),s=n("eQNFO"),u=n("1irm0").Buffer,l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.OLM_ALGORITHM=e.exports.MEGOLM_BACKUP_ALGORITHM=e.exports.MEGOLM_ALGORITHM=void 0,e.exports.decodeBase64=function(e){return u.from(e,"base64")},e.exports.encodeBase64=T,e.exports.encodeUnpaddedBase64=function(e){return T(e).replace(/=+$/g,"")},e.exports.encryptMessageForDevice=function(e,t,r,n,i,o,a){return w.apply(this,arguments)},e.exports.ensureOlmSessionsForDevices=function(e,t,r){return E.apply(this,arguments)},e.exports.getExistingOlmSessions=function(e,t,r){return S.apply(this,arguments)},e.exports.isOlmEncrypted=function(e){if(!e.getSenderKey())return p.logger.error("Event has no sender key (not encrypted?)"),!1;if(e.getWireType()!==v.EventType.RoomMessageEncrypted||!["m.olm.v1.curve25519-aes-sha2"].includes(e.getWireContent().algorithm))return p.logger.error("Event was not encrypted using an appropriate algorithm"),!1;return!0},e.exports.pkSign=function(e,t,n,i){var o=!1;if(t instanceof Uint8Array){var a=new r.Olm.PkSigning;i=a.init_with_seed(t),t=a,o=!0}var s=e.signatures||{};delete e.signatures;var u=e.unsigned;e.unsigned&&delete e.unsigned;try{var l=s[n]||{};return s[n]=l,l["ed25519:"+i]=t.sign(h.default.stringify(e))}finally{e.signatures=s,u&&(e.unsigned=u),o&&t.free()}},e.exports.pkVerify=function(e,t,n){var i="ed25519:"+t;if(!(e.signatures&&e.signatures[n]&&e.signatures[n][i]))throw new Error("No signature");var o=e.signatures[n][i],a=new r.Olm.Utility,s=e.signatures;delete e.signatures;var u=e.unsigned;e.unsigned&&delete e.unsigned;try{a.ed25519_verify(t,h.default.stringify(e),o)}finally{e.signatures=s,u&&(e.unsigned=u),a.free()}},e.exports.verifySignature=C;var c,d,f=l(n("3rHpI")),h=l(n("7ZwSr")),p=n("jtqeE"),v=n("8bPbt");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}(d=c||(c={})).Olm="m.olm.v1.curve25519-aes-sha2",d.Megolm="m.megolm.v1.aes-sha2",d.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2";var y=c.Olm;e.exports.OLM_ALGORITHM=y;var b=c.Megolm;e.exports.MEGOLM_ALGORITHM=b;var _=c.MegolmBackup;function w(){return(w=(0,i.default)((function(e,t,r,n,i,o,a){var u,l,c;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return u=o.getIdentityKey(),[4,n.getSessionIdForDevice(u)];case 1:return null===(l=s.sent())?(p.logger.log("[olmlib.encryptMessageForDevice] Unable to find Olm session for device "+"".concat(i,":").concat(o.deviceId)),[2]):(p.logger.log("[olmlib.encryptMessageForDevice] Using Olm session ".concat(l," for device ")+"".concat(i,":").concat(o.deviceId)),c=m({sender:t,sender_device:r,keys:{ed25519:n.deviceEd25519Key},recipient:i,recipient_keys:{ed25519:o.getFingerprint()}},a),[4,n.encryptMessage(u,l,JSON.stringify(c))]);case 2:return e[u]=s.sent(),[2]}}))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function(e,t,r){var n,a,u,l,c,d,f,h,p,v,g,m,y,b,_,w,S,E,k;return(0,s.__generator)(this,(function(t){switch(t.label){case 0:n={},a={},u=[],l=!0,c=!1,d=void 0,f=!0,h=!1,p=void 0;try{for(v=Object.entries(r)[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){m=(0,o.default)(g.value,2),y=m[0],b=m[1];try{for(_=b[Symbol.iterator]();!(l=(w=_.next()).done);l=!0)S=w.value,E=S.deviceId,k=S.getIdentityKey(),u.push((0,i.default)((function(){var t;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.getSessionIdForDevice(k,!0)];case 1:return null===(t=r.sent())?(n[y]=n[y]||[],n[y].push(S)):(a[y]=a[y]||{},a[y][E]={device:S,sessionId:t}),[2]}}))}))())}catch(e){c=!0,d=e}finally{try{l||null==_.return||_.return()}finally{if(c)throw d}}}}catch(e){h=!0,p=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw p}}return[4,Promise.all(u)];case 1:return t.sent(),[2,[n,a]]}}))}))).apply(this,arguments)}function E(){return E=(0,i.default)((function(e,t,r){var n,i,u,l,c,d,f,h,v,g,m,y,b,_,w,S,E,M,C,I,T,R,x,O,A,D,P,L,U,j,N,B,F,K,q,W,V,H,G,z,Y,Z,$,J,Q,X,ee,te,re,ne,ie,oe,ae,se,ue,le,ce,de,fe,he,pe,ve,ge,me,ye,be,_e,we,Se,Ee,ke,Me=arguments;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:n=Me.length>3&&void 0!==Me[3]&&Me[3],i=Me.length>4?Me[4]:void 0,u=Me.length>5?Me[5]:void 0,l=Me.length>6&&void 0!==Me[6]?Me[6]:p.logger,d=[],f={},h={},v=!0,g=!1,m=void 0,y=!0,b=!1,_=void 0;try{for(w=Object.entries(r)[Symbol.iterator]();!(y=(S=w.next()).done);y=!0){E=(0,o.default)(S.value,2),M=E[1];try{for(C=M[Symbol.iterator]();!(v=(I=C.next()).done);v=!0)T=I.value,(R=T.getIdentityKey())!==e.deviceCurve25519Key&&(e.sessionsInProgress[R]||(e.sessionsInProgress[R]=new Promise((function(t){h[R]=function(r){delete e.sessionsInProgress[R],t(r)}}))))}catch(e){g=!0,m=e}finally{try{v||null==C.return||C.return()}finally{if(g)throw m}}}}catch(e){b=!0,_=e}finally{try{y||null==w.return||w.return()}finally{if(b)throw _}}x=!0,O=!1,A=void 0,s.label=1;case 1:s.trys.push([1,12,13,14]),D=Object.entries(r)[Symbol.iterator](),s.label=2;case 2:if(x=(P=D.next()).done)return[3,11];L=(0,o.default)(P.value,2),U=L[0],j=L[1],f[U]={},N=!0,B=!1,F=void 0,s.label=3;case 3:s.trys.push([3,8,9,10]),K=j[Symbol.iterator](),s.label=4;case 4:return(N=(q=K.next()).done)?[3,7]:(W=q.value,V=W.deviceId,(H=W.getIdentityKey())===e.deviceCurve25519Key?(l.info("Attempted to start session with ourself! Ignoring"),f[U][V]={device:W,sessionId:null},[3,6]):(G="for ".concat(H," (").concat(U,":").concat(V,")"),[4,e.getSessionIdForDevice(H,!!h[H],l)]));case 5:null!==(z=s.sent())&&h[H]&&h[H](),(null===z||n)&&(n?l.info("Forcing new Olm session ".concat(G)):l.info("Making new Olm session ".concat(G)),d.push([U,V])),f[U][V]={device:W,sessionId:z},s.label=6;case 6:return N=!0,[3,4];case 7:return[3,10];case 8:return Y=s.sent(),B=!0,F=Y,[3,10];case 9:try{N||null==K.return||K.return()}finally{if(B)throw F}return[7];case 10:return x=!0,[3,2];case 11:return[3,14];case 12:return Y=s.sent(),O=!0,A=Y,[3,14];case 13:try{x||null==D.return||D.return()}finally{if(O)throw A}return[7];case 14:if(0===d.length)return[2,f];Z="signed_curve25519",J="one-time keys for ".concat(d.length," devices"),s.label=15;case 15:return s.trys.push([15,17,,18]),l.debug("Claiming ".concat(J)),[4,t.claimOneTimeKeys(d,Z,i)];case 16:return $=s.sent(),l.debug("Claimed ".concat(J)),[3,18];case 17:Q=s.sent(),X=!0,ee=!1,te=void 0;try{for(re=Object.values(h)[Symbol.iterator]();!(X=(ne=re.next()).done);X=!0)(0,ne.value)()}catch(e){ee=!0,te=e}finally{try{X||null==re.return||re.return()}finally{if(ee)throw te}}throw l.log("Failed to claim ".concat(J),Q,d),Q;case 18:u&&"failures"in $&&(c=u).push.apply(c,(0,a.default)(Object.keys($.failures))),ie=$.one_time_keys||{},oe=[],ae=!0,se=!1,ue=void 0;try{for(le=Object.entries(r)[Symbol.iterator]();!(ae=(ce=le.next()).done);ae=!0){de=(0,o.default)(ce.value,2),fe=de[0],he=de[1],pe=ie[fe]||{},ve=!0,ge=!1,me=void 0;try{for(ye=he[Symbol.iterator]();!(ve=(be=ye.next()).done);ve=!0)if(_e=be.value,we=_e.deviceId,(Se=_e.getIdentityKey())!==e.deviceCurve25519Key&&(!f[fe][we].sessionId||n)){for(var Ce in Ee=pe[we]||{},ke=null,Ee)0===Ce.indexOf(Z+":")&&(ke=Ee[Ce]);ke?oe.push(k(e,ke,fe,_e).then((function(e){h[Se]&&h[Se](null!=e?e:void 0),f[fe][we].sessionId=e}),(function(e){throw h[Se]&&h[Se](),e}))):(l.warn("No one-time keys (alg=".concat(Z,") ")+"for device ".concat(fe,":").concat(we)),h[Se]&&h[Se]())}}catch(e){ge=!0,me=e}finally{try{ve||null==ye.return||ye.return()}finally{if(ge)throw me}}}}catch(e){se=!0,ue=e}finally{try{ae||null==le.return||le.return()}finally{if(se)throw ue}}return J="Olm sessions for ".concat(oe.length," devices"),l.debug("Starting ".concat(J)),[4,Promise.all(oe)];case 19:return s.sent(),l.debug("Started ".concat(J)),[2,f]}}))})),E.apply(this,arguments)}function k(e,t,r,n){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function(e,t,r,n){var i,o,a,u;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:i=n.deviceId,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,C(e,t,r,i,n.getFingerprint())];case 2:return s.sent(),[3,4];case 3:return o=s.sent(),p.logger.error("Unable to verify signature on one-time key for device "+r+":"+i+":",o),[2,null];case 4:return s.trys.push([4,6,,7]),[4,e.createOutboundSession(n.getIdentityKey(),t.key)];case 5:return a=s.sent(),[3,7];case 6:return u=s.sent(),p.logger.error("Error starting olm session with device "+r+":"+i+": "+u),[2,null];case 7:return p.logger.log("Started new olm sessionid "+a+" for device "+r+":"+i),[2,a]}}))}))).apply(this,arguments)}function C(e,t,r,n,i){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function(e,t,r,n,i){var o,a,u,l,c,d;return(0,s.__generator)(this,(function(s){if(o="ed25519:"+n,a=t.signatures||{},u=a[r]||{},!(l=u[o]))throw Error("No signature");return"unsigned"in(c=Object.assign({},t))&&delete c.unsigned,delete c.signatures,d=h.default.stringify(c),e.verifySignature(i,d,l),[2]}))}))).apply(this,arguments)}function T(e){return u.from(e).toString("base64")}e.exports.MEGOLM_BACKUP_ALGORITHM=_})),n.register("4F3LH",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomList=void 0;var u=s(n("3rHpI")),l=n("8A6lK"),c=function(){function e(t){(0,i.default)(this,e),this.cryptoStore=t,(0,u.default)(this,"roomEncryption",{})}return(0,o.default)(e,[{key:"init",value:function(){var e=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ROOMS],(function(t){e.cryptoStore.getEndToEndRooms(t,(function(t){e.roomEncryption=t}))}))];case 1:return t.sent(),[2]}}))}))()}},{key:"getRoomEncryption",value:function(e){return this.roomEncryption[e]||null}},{key:"isRoomEncrypted",value:function(e){return Boolean(this.getRoomEncryption(e))}},{key:"setRoomEncryption",value:function(e,t){var n=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(r){switch(r.label){case 0:return n.roomEncryption[e]=t,[4,n.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ROOMS],(function(r){n.cryptoStore.storeEndToEndRoom(e,t,r)}))];case 1:return r.sent(),[2]}}))}))()}}]),e}();e.exports.RoomList=c})),n.register("8A6lK",(function(e,t){var i=n("kxanC"),o=n("hWDD9"),a=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IndexedDBCryptoStore=void 0;var s=a(n("3rHpI")),u=n("jtqeE"),l=n("f70vt"),c=n("it6PG"),d=v(n("btuQw")),f=n("bzllY"),h=v(n("7YPaw"));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}var g=function(){function e(t,r){(0,i.default)(this,e),this.indexedDB=t,this.dbName=r,(0,s.default)(this,"backendPromise",void 0),(0,s.default)(this,"backend",void 0)}return(0,o.default)(e,[{key:"startup",value:function(){var t=this;return this.backendPromise||(this.backendPromise=new Promise((function(e,r){if(t.indexedDB){u.logger.log("connecting to indexeddb ".concat(t.dbName));var n=t.indexedDB.open(t.dbName,d.VERSION);n.onupgradeneeded=function(e){var t=n.result,r=e.oldVersion;d.upgradeDatabase(t,r)},n.onblocked=function(){u.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=function(e){u.logger.log("Error connecting to indexeddb",e),r(n.error)},n.onsuccess=function(){var r=n.result;u.logger.log("connected to indexeddb ".concat(t.dbName)),e(new d.Backend(r))}}else r(new Error("no indexeddb support available"))})).then((function(t){return t.doTxn("readonly",[e.STORE_INBOUND_GROUP_SESSIONS,e.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(e){t.getEndToEndInboundGroupSession("","",e,(function(){}))})).then((function(){return t}))})).catch((function(e){if("VersionError"===e.name)throw u.logger.warn("Crypto DB is too new for us to use!",e),new f.InvalidCryptoStoreError(f.InvalidCryptoStoreState.TooNew);u.logger.warn("unable to connect to indexeddb ".concat(t.dbName)+": falling back to localStorage store: ".concat(e));try{return new l.LocalStorageCryptoStore(r.localStorage)}catch(e){return u.logger.warn("unable to open localStorage: falling back to in-memory store: ".concat(e)),new c.MemoryCryptoStore}})).then((function(e){return t.backend=e,e}))),this.backendPromise}},{key:"deleteAllData",value:function(){var e=this;return new Promise((function(t,r){if(e.indexedDB){u.logger.log("Removing indexeddb instance: ".concat(e.dbName));var n=e.indexedDB.deleteDatabase(e.dbName);n.onblocked=function(){u.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=function(e){u.logger.log("Error deleting data from indexeddb",e),r(n.error)},n.onsuccess=function(){u.logger.log("Removed indexeddb instance: ".concat(e.dbName)),t()}}else r(new Error("no indexeddb support available"))})).catch((function(e){u.logger.warn("unable to delete IndexedDBCryptoStore: ".concat(e))}))}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}},{key:"getOutgoingRoomKeyRequest",value:function(e){return this.backend.getOutgoingRoomKeyRequest(e)}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,r){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,t,r)}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,r){return this.backend.updateOutgoingRoomKeyRequest(e,t,r)}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){return this.backend.deleteOutgoingRoomKeyRequest(e,t)}},{key:"getAccount",value:function(e,t){this.backend.getAccount(e,t)}},{key:"storeAccount",value:function(e,t){this.backend.storeAccount(e,t)}},{key:"getCrossSigningKeys",value:function(e,t){this.backend.getCrossSigningKeys(e,t)}},{key:"getSecretStorePrivateKey",value:function(e,t,r){this.backend.getSecretStorePrivateKey(e,t,r)}},{key:"storeCrossSigningKeys",value:function(e,t){this.backend.storeCrossSigningKeys(e,t)}},{key:"storeSecretStorePrivateKey",value:function(e,t,r){this.backend.storeSecretStorePrivateKey(e,t,r)}},{key:"countEndToEndSessions",value:function(e,t){this.backend.countEndToEndSessions(e,t)}},{key:"getEndToEndSession",value:function(e,t,r,n){this.backend.getEndToEndSession(e,t,r,n)}},{key:"getEndToEndSessions",value:function(e,t,r){this.backend.getEndToEndSessions(e,t,r)}},{key:"getAllEndToEndSessions",value:function(e,t){this.backend.getAllEndToEndSessions(e,t)}},{key:"storeEndToEndSession",value:function(e,t,r,n){this.backend.storeEndToEndSession(e,t,r,n)}},{key:"storeEndToEndSessionProblem",value:function(e,t,r){return this.backend.storeEndToEndSessionProblem(e,t,r)}},{key:"getEndToEndSessionProblem",value:function(e,t){return this.backend.getEndToEndSessionProblem(e,t)}},{key:"filterOutNotifiedErrorDevices",value:function(e){return this.backend.filterOutNotifiedErrorDevices(e)}},{key:"getEndToEndInboundGroupSession",value:function(e,t,r,n){this.backend.getEndToEndInboundGroupSession(e,t,r,n)}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){this.backend.getAllEndToEndInboundGroupSessions(e,t)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,r,n){this.backend.addEndToEndInboundGroupSession(e,t,r,n)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,r,n){this.backend.storeEndToEndInboundGroupSession(e,t,r,n)}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,r,n){this.backend.storeEndToEndInboundGroupSessionWithheld(e,t,r,n)}},{key:"storeEndToEndDeviceData",value:function(e,t){this.backend.storeEndToEndDeviceData(e,t)}},{key:"getEndToEndDeviceData",value:function(e,t){this.backend.getEndToEndDeviceData(e,t)}},{key:"storeEndToEndRoom",value:function(e,t,r){this.backend.storeEndToEndRoom(e,t,r)}},{key:"getEndToEndRooms",value:function(e,t){this.backend.getEndToEndRooms(e,t)}},{key:"getSessionsNeedingBackup",value:function(e){return this.backend.getSessionsNeedingBackup(e)}},{key:"countSessionsNeedingBackup",value:function(e){return this.backend.countSessionsNeedingBackup(e)}},{key:"unmarkSessionsNeedingBackup",value:function(e,t){return this.backend.unmarkSessionsNeedingBackup(e,t)}},{key:"markSessionsNeedingBackup",value:function(e,t){return this.backend.markSessionsNeedingBackup(e,t)}},{key:"addSharedHistoryInboundGroupSession",value:function(e,t,r,n){this.backend.addSharedHistoryInboundGroupSession(e,t,r,n)}},{key:"getSharedHistoryInboundGroupSessions",value:function(e,t){return this.backend.getSharedHistoryInboundGroupSessions(e,t)}},{key:"addParkedSharedHistory",value:function(e,t,r){this.backend.addParkedSharedHistory(e,t,r)}},{key:"takeParkedSharedHistory",value:function(e,t){return this.backend.takeParkedSharedHistory(e,t)}},{key:"doTxn",value:function(e,t,r,n){return this.backend.doTxn(e,t,r,n)}}],[{key:"exists",value:function(e,t){return h.exists(e,t)}}]),e}();e.exports.IndexedDBCryptoStore=g,(0,s.default)(g,"STORE_ACCOUNT","account"),(0,s.default)(g,"STORE_SESSIONS","sessions"),(0,s.default)(g,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),(0,s.default)(g,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),(0,s.default)(g,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),(0,s.default)(g,"STORE_PARKED_SHARED_HISTORY","parked_shared_history"),(0,s.default)(g,"STORE_DEVICE_DATA","device_data"),(0,s.default)(g,"STORE_ROOMS","rooms"),(0,s.default)(g,"STORE_BACKUP","sessions_needing_backup")})),n.register("f70vt",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("cksMj"),u=n("mBz5n"),l=n("giCK6"),c=n("eQNFO");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LocalStorageCryptoStore=void 0;var d=n("jtqeE"),f=n("it6PG"),h="crypto.",p="crypto.account",v="crypto.cross_signing_keys",g="crypto.notified_error_devices",m="crypto.device_data",y="crypto.inboundgroupsessions/",b="crypto.sessionsneedingbackup";function _(e){return"crypto.sessions/"+e}function w(e){return"crypto.session.problems/"+e}function S(e,t){return y+e+"/"+t}function E(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function k(e){return"crypto.rooms/"+e}var M=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(e){var r;return(0,i.default)(this,n),(r=t.call(this)).store=e,r}return(0,o.default)(n,[{key:"countEndToEndSessions",value:function(e,t){for(var r=0,n=0;n<this.store.length;++n){var i;null!==(i=this.store.key(n))&&void 0!==i&&i.startsWith(_(""))&&++r}t(r)}},{key:"_getEndToEndSessions",value:function(e){var t=C(this.store,_(e)),r={},n=!0,i=!1,o=void 0;try{for(var a,s=Object.entries(t||{})[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=(0,u.default)(a.value,2),c=l[0],d=l[1];r[c]="string"==typeof d?{session:d}:d}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}},{key:"getEndToEndSession",value:function(e,t,r,n){n(this._getEndToEndSessions(e)[t]||{})}},{key:"getEndToEndSessions",value:function(e,t,r){r(this._getEndToEndSessions(e)||{})}},{key:"getAllEndToEndSessions",value:function(e,t){for(var r=0;r<this.store.length;++r){var n;if(null!==(n=this.store.key(r))&&void 0!==n&&n.startsWith(_(""))){var i=this.store.key(r).split("/")[1],o=!0,a=!1,s=void 0;try{for(var u,l=Object.values(this._getEndToEndSessions(i))[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){t(u.value)}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}}}}},{key:"storeEndToEndSession",value:function(e,t,r,n){var i=this._getEndToEndSessions(e)||{};i[t]=r,I(this.store,_(e),i)}},{key:"storeEndToEndSessionProblem",value:function(e,t,n){var i=this;return(0,r.default)((function(){var r,o;return(0,c.__generator)(this,(function(a){return r=w(e),(o=C(i.store,r)||[]).push({type:t,fixed:n,time:Date.now()}),o.sort((function(e,t){return e.time-t.time})),I(i.store,r,o),[2]}))}))()}},{key:"getEndToEndSessionProblem",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i,o,a,s,u,l,d,f;return(0,c.__generator)(this,(function(c){if(r=w(e),!(i=C(n.store,r)||[]).length)return[2,null];o=i[i.length-1],a=!0,s=!1,u=void 0;try{for(l=i[Symbol.iterator]();!(a=(d=l.next()).done);a=!0)if((f=d.value).time>t)return[2,Object.assign({},f,{fixed:o.fixed})]}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}return o.fixed?[2,null]:[2,o]}))}))()}},{key:"filterOutNotifiedErrorDevices",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,u,l,d,f,h;return(0,c.__generator)(this,(function(c){r=C(t.store,g)||{},n=[],i=!0,o=!1,s=void 0;try{for(u=e[Symbol.iterator]();!(i=(l=u.next()).done);i=!0)d=l.value,f=d.userId,h=d.deviceInfo,f in r?h.deviceId in r[f]||(n.push(d),r[f][h.deviceId]=!0):(n.push(d),r[f]=(0,a.default)({},h.deviceId,!0))}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}return I(t.store,g,r),[2,n]}))}))()}},{key:"getEndToEndInboundGroupSession",value:function(e,t,r,n){n(C(this.store,S(e,t)),C(this.store,E(e,t)))}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){for(var r=0;r<this.store.length;++r){var n=this.store.key(r);null!=n&&n.startsWith(y)&&t({senderKey:n.slice(y.length,y.length+43),sessionId:n.slice(y.length+44),sessionData:C(this.store,n)})}t(null)}},{key:"addEndToEndInboundGroupSession",value:function(e,t,r,n){C(this.store,S(e,t))||this.storeEndToEndInboundGroupSession(e,t,r,n)}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,r,n){I(this.store,S(e,t),r)}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,r,n){I(this.store,E(e,t),r)}},{key:"getEndToEndDeviceData",value:function(e,t){t(C(this.store,m))}},{key:"storeEndToEndDeviceData",value:function(e,t){I(this.store,m,e)}},{key:"storeEndToEndRoom",value:function(e,t,r){I(this.store,k(e),t)}},{key:"getEndToEndRooms",value:function(e,t){for(var r={},n=k(""),i=0;i<this.store.length;++i){var o=this.store.key(i);if(null!=o&&o.startsWith(n))r[o.slice(n.length)]=C(this.store,o)}t(r)}},{key:"getSessionsNeedingBackup",value:function(e){var t=this,r=function(r){if(Object.prototype.hasOwnProperty.call(n,r)){var o=r.slice(0,43),a=r.slice(44);if(t.getEndToEndInboundGroupSession(o,a,null,(function(e){i.push({senderKey:o,sessionId:a,sessionData:e})})),e&&i.length>=e)return"break"}},n=C(this.store,b)||{},i=[];for(var o in n){if("break"===r(o))break}return Promise.resolve(i)}},{key:"countSessionsNeedingBackup",value:function(){var e=C(this.store,b)||{};return Promise.resolve(Object.keys(e).length)}},{key:"unmarkSessionsNeedingBackup",value:function(e){var t=C(this.store,b)||{},r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;delete t[s.senderKey+"/"+s.sessionId]}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return I(this.store,b,t),Promise.resolve()}},{key:"markSessionsNeedingBackup",value:function(e){var t=C(this.store,b)||{},r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t[s.senderKey+"/"+s.sessionId]=!0}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return I(this.store,b,t),Promise.resolve()}},{key:"deleteAllData",value:function(){return this.store.removeItem(p),Promise.resolve()}},{key:"getAccount",value:function(e,t){t(C(this.store,p))}},{key:"storeAccount",value:function(e,t){I(this.store,p,t)}},{key:"getCrossSigningKeys",value:function(e,t){t(C(this.store,v))}},{key:"getSecretStorePrivateKey",value:function(e,t,r){t(C(this.store,h+"ssss_cache.".concat(r)))}},{key:"storeCrossSigningKeys",value:function(e,t){I(this.store,v,t)}},{key:"storeSecretStorePrivateKey",value:function(e,t,r){I(this.store,h+"ssss_cache.".concat(t),r)}},{key:"doTxn",value:function(e,t,r){return Promise.resolve(r(null))}}],[{key:"exists",value:function(e){for(var t=e.length,r=0;r<t;r++){var n;if(null!==(n=e.key(r))&&void 0!==n&&n.startsWith(h))return!0}return!1}}]),n}(f.MemoryCryptoStore);function C(e,t){try{return JSON.parse(e.getItem(t))}catch(e){d.logger.log("Error: Failed to get key %s: %s",t,e.message),d.logger.log(e.stack)}return null}function I(e,t,r){e.setItem(t,JSON.stringify(r))}e.exports.LocalStorageCryptoStore=M})),n.register("btuQw",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VERSION=e.exports.Backend=void 0,e.exports.upgradeDatabase=function(e,t){l.logger.log("Upgrading IndexedDBCryptoStore from version ".concat(t)+" to ".concat(p)),h.forEach((function(r,n){t<=n&&r(e)}))};var u=s(n("3rHpI")),l=n("jtqeE"),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas"));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}var f=function(){function e(t){var r=this;(0,i.default)(this,e),this.db=t,(0,u.default)(this,"nextTxnId",0),t.onversionchange=function(){l.logger.log("versionchange for indexeddb ".concat(r.db.name,": closing")),t.close()}}return(0,o.default)(e,[{key:"startup",value:function(){var e=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(t){return[2,e]}))}))()}},{key:"deleteAllData",value:function(){return(0,r.default)((function(){return(0,a.__generator)(this,(function(e){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}))}))()}},{key:"getOrAddOutgoingRoomKeyRequest",value:function(e){var t=this,r=e.requestBody;return new Promise((function(n,i){var o=t.db.transaction("outgoingRoomKeyRequests","readwrite");o.onerror=i,t._getOutgoingRoomKeyRequest(o,r,(function(t){if(t)return l.logger.log("already have key request outstanding for "+"".concat(r.room_id," / ").concat(r.session_id,": ")+"not sending another"),void n(t);l.logger.log("enqueueing key request for ".concat(r.room_id," / ")+r.session_id),o.oncomplete=function(){n(e)},o.objectStore("outgoingRoomKeyRequests").add(e)}))}))}},{key:"getOutgoingRoomKeyRequest",value:function(e){var t=this;return new Promise((function(r,n){var i=t.db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=n,t._getOutgoingRoomKeyRequest(i,e,(function(e){r(e)}))}))}},{key:"_getOutgoingRoomKeyRequest",value:function(e,t,r){var n=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]);n.onsuccess=function(){var e=n.result;if(e){var i=e.value;c.deepCompare(i.requestBody,t)?r(i):e.continue()}else r(null)}}},{key:"getOutgoingRoomKeyRequestByState",value:function(e){if(0===e.length)return Promise.resolve(null);var t,r=0;var n=this.db.transaction("outgoingRoomKeyRequests","readonly"),i=n.objectStore("outgoingRoomKeyRequests"),o=e[r];return i.index("state").openCursor(o).onsuccess=function n(){var i=this.result;if(i)t=i.value;else if(!(++r>=e.length)){var o=e[r];this.source.openCursor(o).onsuccess=n}},g(n).then((function(){return t}))}},{key:"getAllOutgoingRoomKeyRequestsByState",value:function(e){var t=this;return new Promise((function(r,n){var i=t.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);i.onsuccess=function(){return r(i.result)},i.onerror=function(){return n(i.error)}}))}},{key:"getOutgoingRoomKeyRequestsByTarget",value:function(e,t,r){var n=0,i=[];var o=this.db.transaction("outgoingRoomKeyRequests","readonly"),a=o.objectStore("outgoingRoomKeyRequests"),s=r[n];return a.index("state").openCursor(s).onsuccess=function o(){var a=this.result;if(a){var s=a.value;s.recipients.some((function(r){return r.userId===e&&r.deviceId===t}))&&i.push(s),a.continue()}else{if(++n>=r.length)return;var u=r[n];this.source.openCursor(u).onsuccess=o}},g(o).then((function(){return i}))}},{key:"updateOutgoingRoomKeyRequest",value:function(e,t,r){var n=null;var i=this.db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(){var e=this.result;if(e){var i=e.value;i.state==t?(Object.assign(i,r),e.update(i),n=i):l.logger.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(i.state))}},g(i).then((function(){return n}))}},{key:"deleteOutgoingRoomKeyRequest",value:function(e,t){var r=this.db.transaction("outgoingRoomKeyRequests","readwrite"),n=r.objectStore("outgoingRoomKeyRequests").openCursor(e);return n.onsuccess=function(){var e=n.result;if(e){var r=e.value;r.state==t?e.delete():l.logger.warn("Cannot delete room key request in state ".concat(r.state," ")+"(expected ".concat(t,")"))}},g(r)}},{key:"getAccount",value:function(e,t){var r=e.objectStore("account").get("-");r.onsuccess=function(){try{t(r.result||null)}catch(t){v(e,t)}}}},{key:"storeAccount",value:function(e,t){e.objectStore("account").put(t,"-")}},{key:"getCrossSigningKeys",value:function(e,t){var r=e.objectStore("account").get("crossSigningKeys");r.onsuccess=function(){try{t(r.result||null)}catch(t){v(e,t)}}}},{key:"getSecretStorePrivateKey",value:function(e,t,r){var n=e.objectStore("account").get("ssss_cache:".concat(r));n.onsuccess=function(){try{t(n.result||null)}catch(t){v(e,t)}}}},{key:"storeCrossSigningKeys",value:function(e,t){e.objectStore("account").put(t,"crossSigningKeys")}},{key:"storeSecretStorePrivateKey",value:function(e,t,r){e.objectStore("account").put(r,"ssss_cache:".concat(t))}},{key:"countEndToEndSessions",value:function(e,t){var r=e.objectStore("sessions").count();r.onsuccess=function(){try{t(r.result)}catch(t){v(e,t)}}}},{key:"getEndToEndSessions",value:function(e,t,r){var n=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};n.onsuccess=function(){var e=n.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{r(i)}catch(e){v(t,e)}}}},{key:"getEndToEndSession",value:function(e,t,r,n){var i=r.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?n({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):n(null)}catch(e){v(r,e)}}}},{key:"getAllEndToEndSessions",value:function(e,t){var r=e.objectStore("sessions").openCursor();r.onsuccess=function(){try{var n=r.result;n?(t(n.value),n.continue()):t(null)}catch(t){v(e,t)}}}},{key:"storeEndToEndSession",value:function(e,t,r,n){n.objectStore("sessions").put({deviceKey:e,sessionId:t,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}},{key:"storeEndToEndSessionProblem",value:function(e,t,n){var i=this;return(0,r.default)((function(){var r;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return r=i.db.transaction("session_problems","readwrite"),r.objectStore("session_problems").put({deviceKey:e,type:t,fixed:n,time:Date.now()}),[4,g(r)];case 1:return o.sent(),[2]}}))}))()}},{key:"getEndToEndSessionProblem",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i,o,s,u;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return r=null,i=n.db.transaction("session_problems","readwrite"),o=i.objectStore("session_problems"),s=o.index("deviceKey"),(u=s.getAll(e)).onsuccess=function(){var e=u.result;if(e.length){e.sort((function(e,t){return e.time-t.time}));var n=e[e.length-1],i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;if(c.time>t)return void(r=Object.assign({},c,{fixed:n.fixed}))}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}r=n.fixed?null:n}else r=null},[4,g(i)];case 1:return a.sent(),[2,r]}}))}))()}},{key:"filterOutNotifiedErrorDevices",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return r=t.db.transaction("notified_error_devices","readwrite"),n=r.objectStore("notified_error_devices"),i=[],[4,Promise.all(e.map((function(e){return new Promise((function(t){var r=e.userId,o=e.deviceInfo,a=n.get([r,o.deviceId]);a.onsuccess=function(){a.result||(n.put({userId:r,deviceId:o.deviceId}),i.push(e)),t()}}))})))];case 1:return o.sent(),[2,i]}}))}))()}},{key:"getEndToEndInboundGroupSession",value:function(e,t,r,n){var i=!1,o=!1,a=r.objectStore("inbound_group_sessions").get([e,t]);a.onsuccess=function(){try{i=a.result?a.result.session:null,!1!==o&&n(i,o)}catch(e){v(r,e)}};var s=r.objectStore("inbound_group_sessions_withheld").get([e,t]);s.onsuccess=function(){try{o=s.result?s.result.session:null,!1!==i&&n(i,o)}catch(e){v(r,e)}}}},{key:"getAllEndToEndInboundGroupSessions",value:function(e,t){var r=e.objectStore("inbound_group_sessions").openCursor();r.onsuccess=function(){var n=r.result;if(n){try{t({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session})}catch(t){v(e,t)}n.continue()}else try{t(null)}catch(t){v(e,t)}}}},{key:"addEndToEndInboundGroupSession",value:function(e,t,r,n){var i=n.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:r});i.onerror=function(r){var o;"ConstraintError"===(null===(o=i.error)||void 0===o?void 0:o.name)?(r.stopPropagation(),r.preventDefault(),l.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):v(n,new Error("Failed to add inbound group session: "+i.error))}}},{key:"storeEndToEndInboundGroupSession",value:function(e,t,r,n){n.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:r})}},{key:"storeEndToEndInboundGroupSessionWithheld",value:function(e,t,r,n){n.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:r})}},{key:"getEndToEndDeviceData",value:function(e,t){var r=e.objectStore("device_data").get("-");r.onsuccess=function(){try{t(r.result||null)}catch(t){v(e,t)}}}},{key:"storeEndToEndDeviceData",value:function(e,t){t.objectStore("device_data").put(e,"-")}},{key:"storeEndToEndRoom",value:function(e,t,r){r.objectStore("rooms").put(t,e)}},{key:"getEndToEndRooms",value:function(e,t){var r={},n=e.objectStore("rooms").openCursor();n.onsuccess=function(){var i=n.result;if(i)r[i.key]=i.value,i.continue();else try{t(r)}catch(t){v(e,t)}}}},{key:"getSessionsNeedingBackup",value:function(e){var t=this;return new Promise((function(r,n){var i=[],o=t.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");o.onerror=n,o.oncomplete=function(){r(i)};var a=o.objectStore("sessions_needing_backup"),s=o.objectStore("inbound_group_sessions"),u=a.openCursor();u.onsuccess=function(){var t=u.result;if(t){var r=s.get(t.key);r.onsuccess=function(){i.push({senderKey:r.result.senderCurve25519Key,sessionId:r.result.sessionId,sessionData:r.result.session})},(!e||i.length<e)&&t.continue()}}}))}},{key:"countSessionsNeedingBackup",value:function(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));var t=e.objectStore("sessions_needing_backup");return new Promise((function(e,r){var n=t.count();n.onerror=r,n.onsuccess=function(){return e(n.result)}}))}},{key:"unmarkSessionsNeedingBackup",value:function(e,t){var n=this;return(0,r.default)((function(){var r;return(0,a.__generator)(this,(function(i){switch(i.label){case 0:return t||(t=n.db.transaction("sessions_needing_backup","readwrite")),r=t.objectStore("sessions_needing_backup"),[4,Promise.all(e.map((function(e){return new Promise((function(t,n){var i=r.delete([e.senderKey,e.sessionId]);i.onsuccess=t,i.onerror=n}))})))];case 1:return i.sent(),[2]}}))}))()}},{key:"markSessionsNeedingBackup",value:function(e,t){var n=this;return(0,r.default)((function(){var r;return(0,a.__generator)(this,(function(i){switch(i.label){case 0:return t||(t=n.db.transaction("sessions_needing_backup","readwrite")),r=t.objectStore("sessions_needing_backup"),[4,Promise.all(e.map((function(e){return new Promise((function(t,n){var i=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=n}))})))];case 1:return i.sent(),[2]}}))}))()}},{key:"addSharedHistoryInboundGroupSession",value:function(e,t,r,n){n||(n=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));var i=n.objectStore("shared_history_inbound_group_sessions"),o=i.get([e]);o.onsuccess=function(){var n=(o.result||{sessions:[]}).sessions;n.push([t,r]),i.put({roomId:e,sessions:n})}}},{key:"getSharedHistoryInboundGroupSessions",value:function(e,t){t||(t=this.db.transaction("shared_history_inbound_group_sessions","readonly"));var r=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise((function(e,t){r.onsuccess=function(){var t=(r.result||{sessions:[]}).sessions;e(t)},r.onerror=t}))}},{key:"addParkedSharedHistory",value:function(e,t,r){r||(r=this.db.transaction("parked_shared_history","readwrite"));var n=r.objectStore("parked_shared_history"),i=n.get([e]);i.onsuccess=function(){var r=(i.result||{parked:[]}).parked;r.push(t),n.put({roomId:e,parked:r})}}},{key:"takeParkedSharedHistory",value:function(e,t){t||(t=this.db.transaction("parked_shared_history","readwrite"));var r=t.objectStore("parked_shared_history").openCursor(e);return new Promise((function(e,t){r.onsuccess=function(){var t=r.result;if(t){var n=t.value;t.delete(),e(n)}else e([])},r.onerror=t}))}},{key:"doTxn",value:function(e,t,r){arguments.length>3&&void 0!==arguments[3]||l.logger;var n=this.db.transaction(t,e),i=g(n),o=r(n);return i.then((function(){return o}))}}]),e}();e.exports.Backend=f;var h=[function(e){!function(e){var t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e)},function(e){e.createObjectStore("account")},function(e){e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},function(e){e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},function(e){e.createObjectStore("device_data")},function(e){e.createObjectStore("rooms")},function(e){e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},function(e){e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},function(e){e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},function(e){e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},function(e){e.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],p=h.length;function v(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function g(e){return new Promise((function(t,r){e.oncomplete=function(){void 0!==e._mx_abortexception&&r(e._mx_abortexception),t(null)},e.onerror=function(t){void 0!==e._mx_abortexception?r(e._mx_abortexception):(l.logger.log("Error performing indexeddb txn",t),r(e.error))},e.onabort=function(t){void 0!==e._mx_abortexception?r(e._mx_abortexception):(l.logger.log("Error performing indexeddb txn",t),r(e.error))}}))}e.exports.VERSION=p})),n.register("7YPaw",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.exists=function(e,t){return new Promise((function(r,n){var i=!0,o=e.open(t);o.onupgradeneeded=function(){i=!1},o.onblocked=function(){return n(o.error)},o.onsuccess=function(){o.result.close(),i||e.deleteDatabase(t),r(i)},o.onerror=function(){return n(o.error)}}))}})),n.register("7c1B9",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SERVICE_TYPES=void 0,e.exports.SERVICE_TYPES=r,(n=r||(e.exports.SERVICE_TYPES=r={})).IS="SERVICE_TYPE_IS",n.IM="SERVICE_TYPE_IM"})),n.register("9sA0w",(function(e,t){var i=n("Yawv5"),o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("dLRop"),l=n("cksMj"),c=n("mBz5n"),d=n("giCK6"),f=n("eQNFO"),h=n("1irm0").Buffer,p=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IncomingRoomKeyRequest=e.exports.CryptoEvent=e.exports.Crypto=void 0,e.exports.fixBackupKey=oe,e.exports.isCryptoAvailable=function(){return Boolean(r.Olm)},e.exports.verificationMethods=void 0;var v=p(n("3rHpI")),g=p(n("7ZwSr")),m=n("329cj"),y=n("8bPbt"),b=n("k2cpO"),_=n("jtqeE"),w=n("kdObl"),S=$(n("dbGKv")),E=n("f5Jvc"),k=n("1fjoF"),M=$(n("e9CEv")),C=n("f1UAv"),I=n("kMusr"),T=n("4zzqM"),R=n("8WN5v"),x=n("8A6lK"),O=n("dhSCK"),A=n("1zJ3N"),D=n("i92LU"),P=n("gKhTH"),L=n("cRTHW"),U=n("g3CPh"),j=n("g0WMg"),N=n("jOM7c"),B=n("bzllY"),F=n("5zTlo"),K=n("8YZJm"),q=n("jioY8"),W=n("5xqDi"),V=n("9SRK1"),H=n("jEuTn"),G=n("4uAg3"),z=n("6MMVS"),Y=n("bcGqc");function Z(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Z=function(e){return e?r:t})(e)}function $(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=Z(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Q,X=k.DeviceInfo.DeviceVerification,ee=(Q={},(0,u.default)(Q,O.ReciprocateQRCode.NAME,O.ReciprocateQRCode),(0,u.default)(Q,A.SAS.NAME,A.SAS),(0,u.default)(Q,O.SHOW_QR_CODE_METHOD,N.IllegalMethod),(0,u.default)(Q,O.SCAN_QR_CODE_METHOD,N.IllegalMethod),Q),te={RECIPROCATE_QR_CODE:O.ReciprocateQRCode.NAME,SAS:A.SAS.NAME};e.exports.verificationMethods=te;var re,ne;e.exports.CryptoEvent=re,(ne=re||(e.exports.CryptoEvent=re={})).DeviceVerificationChanged="deviceVerificationChanged",ne.UserTrustStatusChanged="userTrustStatusChanged",ne.UserCrossSigningUpdated="userCrossSigningUpdated",ne.RoomKeyRequest="crypto.roomKeyRequest",ne.RoomKeyRequestCancellation="crypto.roomKeyRequestCancellation",ne.KeyBackupStatus="crypto.keyBackupStatus",ne.KeyBackupFailed="crypto.keyBackupFailed",ne.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",ne.KeySignatureUploadFailure="crypto.keySignatureUploadFailure",ne.VerificationRequest="crypto.verification.request",ne.Warning="crypto.warning",ne.WillUpdateDevices="crypto.willUpdateDevices",ne.DevicesUpdated="crypto.devicesUpdated",ne.KeysChanged="crossSigning.keysChanged";var ie=function(e){"use strict";(0,l.default)(n,e);var t=(0,d.default)(n);function n(e,r,s,u,l,c,d){var h;(0,a.default)(this,n),(h=t.call(this)).baseApis=e,h.userId=r,h.deviceId=s,h.clientStore=u,h.cryptoStore=l,h.roomList=c,(0,v.default)((0,i.default)(h),"backupManager",void 0),(0,v.default)((0,i.default)(h),"crossSigningInfo",void 0),(0,v.default)((0,i.default)(h),"olmDevice",void 0),(0,v.default)((0,i.default)(h),"deviceList",void 0),(0,v.default)((0,i.default)(h),"dehydrationManager",void 0),(0,v.default)((0,i.default)(h),"secretStorage",void 0),(0,v.default)((0,i.default)(h),"reEmitter",void 0),(0,v.default)((0,i.default)(h),"verificationMethods",void 0),(0,v.default)((0,i.default)(h),"supportedAlgorithms",void 0),(0,v.default)((0,i.default)(h),"outgoingRoomKeyRequestManager",void 0),(0,v.default)((0,i.default)(h),"toDeviceVerificationRequests",void 0),(0,v.default)((0,i.default)(h),"inRoomVerificationRequests",void 0),(0,v.default)((0,i.default)(h),"trustCrossSignedDevices",!0),(0,v.default)((0,i.default)(h),"lastOneTimeKeyCheck",null),(0,v.default)((0,i.default)(h),"oneTimeKeyCheckInProgress",!1),(0,v.default)((0,i.default)(h),"roomEncryptors",new Map),(0,v.default)((0,i.default)(h),"roomDecryptors",new Map),(0,v.default)((0,i.default)(h),"deviceKeys",{}),(0,v.default)((0,i.default)(h),"globalBlacklistUnverifiedDevices",!1),(0,v.default)((0,i.default)(h),"globalErrorOnUnknownDevices",!0),(0,v.default)((0,i.default)(h),"receivedRoomKeyRequests",[]),(0,v.default)((0,i.default)(h),"receivedRoomKeyRequestCancellations",[]),(0,v.default)((0,i.default)(h),"processingRoomKeyRequests",!1),(0,v.default)((0,i.default)(h),"lazyLoadMembers",!1),(0,v.default)((0,i.default)(h),"roomDeviceTrackingState",{}),(0,v.default)((0,i.default)(h),"lastNewSessionForced",{}),(0,v.default)((0,i.default)(h),"sendKeyRequestsImmediately",!1),(0,v.default)((0,i.default)(h),"oneTimeKeyCount",void 0),(0,v.default)((0,i.default)(h),"needsNewFallback",void 0),(0,v.default)((0,i.default)(h),"fallbackCleanup",void 0);var p,g=(0,i.default)(h);if((0,v.default)((0,i.default)(h),"onDeviceListUserCrossSigningUpdated",(p=(0,o.default)((function(e){var t,r,n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return e!==g.userId?[3,4]:(t=g.deviceList.getStoredCrossSigningForUser(e),r=t?t.getId():null,n=g.crossSigningInfo.getId(),i=n!==r,n&&r&&!i?[4,g.checkOwnCrossSigningTrust()]:[3,2]);case 1:return a.sent(),[3,3];case 2:g.storeTrustedSelfKeys(null),g.emit(re.KeysChanged,{}),g.emit(re.UserTrustStatusChanged,g.userId,g.checkUserTrust(e)),a.label=3;case 3:return[3,6];case 4:return[4,g.checkDeviceVerifications(e)];case 5:a.sent(),(o=g.deviceList.getStoredCrossSigningForUser(e))&&(o.updateCrossSigningVerifiedBefore(g.checkUserTrust(e).isCrossSigningVerified()),g.deviceList.setRawStoredCrossSigningForUser(e,o.toStorage())),g.emit(re.UserTrustStatusChanged,e,g.checkUserTrust(e)),a.label=6;case 6:return[2]}}))})),function(e){return p.apply(this,arguments)})),(0,v.default)((0,i.default)(h),"onMembership",(function(e,t,r){try{h.onRoomMembership(e,t,r)}catch(e){_.logger.error("Error handling membership change:",e)}})),(0,v.default)((0,i.default)(h),"onToDeviceEvent",(function(e){try{_.logger.log("received to-device ".concat(e.getType()," from: ")+"".concat(e.getSender()," id: ").concat(e.getContent()[y.ToDeviceMessageId])),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?h.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?h.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?h.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?h.secretStorage.onSecretReceived(e):"m.room_key.withheld"===e.getType()?h.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?h.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?h.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption((0,i.default)(h)),e.once(H.MatrixEventEvent.Decrypted,(function(e){h.onToDeviceEvent(e)})))}catch(e){_.logger.error("Error handling toDeviceEvent:",e)}})),(0,v.default)((0,i.default)(h),"onTimelineEvent",(function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.liveEvent,a=void 0===o||o;if(U.InRoomChannel.validateEvent(e,h.baseApis)){var s=function(e){var t=new U.InRoomChannel(h.baseApis,e.getRoomId());return new L.VerificationRequest(t,h.verificationMethods,h.baseApis)};h.handleVerificationEvent(e,h.inRoomVerificationRequests,s,a)}})),h.reEmitter=new b.TypedReEmitter((0,i.default)(h)),d){h.verificationMethods=new Map;var m=!0,k=!1,I=void 0;try{for(var x,O=d[Symbol.iterator]();!(m=(x=O.next()).done);m=!0){var A=x.value;"string"==typeof A?ee[A]&&h.verificationMethods.set(A,ee[A]):A.NAME?h.verificationMethods.set(A.NAME,A):_.logger.warn("Excluding unknown verification method ".concat(A))}}catch(e){k=!0,I=e}finally{try{m||null==O.return||O.return()}finally{if(k)throw I}}}else h.verificationMethods=new Map(Object.entries(ee));var D=(0,i.default)(h);h.backupManager=new q.BackupManager(e,(0,o.default)((function(){var e,t,r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return[4,D.getSessionBackupPrivateKey()];case 1:return(e=i.sent())?[2,e]:[4,D.getSecret("m.megolm_backup.v1")];case 2:return(t=i.sent())?(r=oe(t))?[4,D.getSecretStorageKey()]:[3,5]:[3,6];case 3:return n=i.sent(),[4,D.storeSecret("m.megolm_backup.v1",r,[n[0]])];case 4:i.sent(),i.label=5;case 5:return[2,S.decodeBase64(r||t)];case 6:if(D.baseApis.cryptoCallbacks&&D.baseApis.cryptoCallbacks.getBackupKey)return[2,D.baseApis.cryptoCallbacks.getBackupKey()];throw new Error("Unable to get private key")}}))}))),h.olmDevice=new w.OlmDevice(l),h.deviceList=new E.DeviceList(e,l,h.olmDevice),h.deviceList.on(re.UserCrossSigningUpdated,h.onDeviceListUserCrossSigningUpdated),h.reEmitter.reEmit(h.deviceList,[re.DevicesUpdated,re.WillUpdateDevices]),h.supportedAlgorithms=Array.from(M.DECRYPTION_CLASSES.keys()),h.outgoingRoomKeyRequestManager=new R.OutgoingRoomKeyRequestManager(e,h.deviceId,h.cryptoStore),h.toDeviceVerificationRequests=new j.ToDeviceRequests,h.inRoomVerificationRequests=new U.InRoomRequests;var P=h.baseApis.cryptoCallbacks||{},N=(0,C.createCryptoStoreCacheCallbacks)(l,h.olmDevice);h.crossSigningInfo=new C.CrossSigningInfo(r,P,N),h.secretStorage=new T.SecretStorage(e,P,e),h.dehydrationManager=new K.DehydrationManager((0,i.default)(h));var B=(0,i.default)(h);return!P.getCrossSigningKey&&P.getSecretStorageKey&&(P.getCrossSigningKey=function(){var e=(0,o.default)((function(e){return(0,f.__generator)(this,(function(t){return[2,C.CrossSigningInfo.getFromSecretStorage(e,B.secretStorage)]}))}));return function(t){return e.apply(this,arguments)}}()),h}return(0,s.default)(n,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.exportedOlmDevice,n=e.pickleKey,i=this;return(0,o.default)((function(){var e,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return _.logger.log("Crypto: initialising Olm..."),[4,r.Olm.init()];case 1:return a.sent(),_.logger.log(t?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),[4,i.olmDevice.init({fromExportedDevice:t,pickleKey:n})];case 2:return a.sent(),_.logger.log("Crypto: loading device list..."),[4,i.deviceList.load()];case 3:return a.sent(),i.deviceKeys["ed25519:"+i.deviceId]=i.olmDevice.deviceEd25519Key,i.deviceKeys["curve25519:"+i.deviceId]=i.olmDevice.deviceCurve25519Key,_.logger.log("Crypto: fetching own devices..."),(e=i.deviceList.getRawStoredDevicesForUser(i.userId))||(e={}),e[i.deviceId]||(_.logger.log("Crypto: adding this device to the store..."),o={keys:i.deviceKeys,algorithms:i.supportedAlgorithms,verified:X.VERIFIED,known:!0},e[i.deviceId]=o,i.deviceList.storeDevicesForUser(i.userId,e),i.deviceList.saveIfDirty()),[4,i.cryptoStore.doTxn("readonly",[x.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){i.cryptoStore.getCrossSigningKeys(e,(function(e){e&&0!==Object.keys(e).length&&(_.logger.log("Loaded cross-signing public keys from crypto store"),i.crossSigningInfo.setKeys(e))}))}))];case 4:return a.sent(),i.deviceList.startTrackingDeviceList(i.userId),_.logger.log("Crypto: checking for key backup..."),i.backupManager.checkAndStart(),[2]}}))}))()}},{key:"getCryptoTrustCrossSignedDevices",value:function(){return this.trustCrossSignedDevices}},{key:"setCryptoTrustCrossSignedDevices",value:function(e){this.trustCrossSignedDevices=e;var t=!0,r=!1,n=void 0;try{for(var i,o=this.deviceList.getKnownUserIds()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=this.deviceList.getRawStoredDevicesForUser(a),u=!0,l=!1,c=void 0;try{for(var d,f=Object.keys(s)[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var h=d.value,p=this.checkDeviceTrust(a,h);if(!p.isLocallyVerified()&&p.isCrossSigningVerified()){var v=this.deviceList.getStoredDevice(a,h);this.emit(re.DeviceVerificationChanged,a,h,v)}}}catch(e){l=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"createRecoveryKeyFromPassphrase",value:function(e){return(0,o.default)((function(){var t,n,i,o,a;return(0,f.__generator)(this,(function(s){switch(s.label){case 0:t=new r.Olm.PkDecryption,s.label=1;case 1:return s.trys.push([1,,5,6]),n={},e?[4,(0,D.keyFromPassphrase)(e)]:[3,3];case 2:return i=s.sent(),n.passphrase={algorithm:"m.pbkdf2",iterations:i.iterations,salt:i.salt},n.pubkey=t.init_with_private_key(i.key),[3,4];case 3:n.pubkey=t.generate_key(),s.label=4;case 4:return o=t.get_private_key(),a=(0,P.encodeRecoveryKey)(o),[2,{keyInfo:n,encodedPrivateKey:a,privateKey:o}];case 5:return null==t||t.free(),[7];case 6:return[2]}}))}))()}},{key:"userHasCrossSigningKeys",value:function(){var e=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.downloadKeys([e.userId])];case 1:return t.sent(),[2,null!==e.deviceList.getStoredCrossSigningForUser(e.userId)]}}))}))()}},{key:"isCrossSigningReady",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return t=e.crossSigningInfo.getId(),[4,e.crossSigningInfo.isStoredInKeyCache()];case 1:return(n=i.sent())?[3,3]:[4,e.crossSigningInfo.isStoredInSecretStorage(e.secretStorage)];case 2:n=i.sent(),i.label=3;case 3:return r=n,[2,!(!t||!r)]}}))}))()}},{key:"isSecretStorageReady",value:function(){var e=this;return(0,o.default)((function(){var t,r,n,i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,e.secretStorage.hasKey()];case 1:return t=o.sent(),[4,e.crossSigningInfo.isStoredInSecretStorage(e.secretStorage)];case 2:return r=o.sent(),(i=!e.backupManager.getKeyBackupEnabled())?[3,4]:[4,e.baseApis.isKeyBackupKeyStored()];case 3:i=o.sent(),o.label=4;case 4:return n=i,[2,!!(t&&r&&n)]}}))}))()}},{key:"bootstrapCrossSigning",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.authUploadDeviceSigningKeys,r=e.setupNewCrossSigning,n=this;return(0,o.default)((function(){var e,i,a,s,u,l,c,d,h,p;return(0,f.__generator)(this,(function(v){switch(v.label){case 0:return _.logger.log("Bootstrapping cross-signing"),e=n.baseApis.cryptoCallbacks,i=new I.EncryptionSetupBuilder(n.baseApis.store.accountData,e),a=new C.CrossSigningInfo(n.userId,i.crossSigningCallbacks,i.crossSigningCallbacks),s=function(){var e=(0,o.default)((function(){var e,r;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return a.resetKeys(),[4,n.signObject(a.keys.master)];case 1:return o.sent(),i.addCrossSigningKeys(t,a.keys),e=n.deviceList.getStoredDevice(n.userId,n.deviceId),[4,a.signDevice(n.userId,e)];case 2:return r=o.sent(),i.addKeySignature(n.userId,n.deviceId,r),n.backupManager.backupInfo?[4,a.signObject(n.backupManager.backupInfo.auth_data,"master")]:[3,4];case 3:o.sent(),i.addSessionBackup(n.backupManager.backupInfo),o.label=4;case 4:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),u=n.crossSigningInfo.getId(),[4,n.crossSigningInfo.isStoredInKeyCache()];case 1:return l=v.sent(),[4,n.crossSigningInfo.isStoredInSecretStorage(n.secretStorage)];case 2:return c=v.sent(),d=l||c,_.logger.log({setupNewCrossSigning:r,publicKeysOnDevice:u,privateKeysInCache:l,privateKeysInStorage:c,privateKeysExistSomewhere:d}),d&&!r?[3,4]:(_.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),[4,s()]);case 3:return v.sent(),[3,7];case 4:return u&&l?(_.logger.log("Cross-signing public keys trusted and private keys found locally"),[3,7]):[3,5];case 5:return c?(_.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),[4,n.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0})]):[3,7];case 6:v.sent(),v.label=7;case 7:return!(h=i.crossSigningCallbacks.privateKeys).size||n.baseApis.cryptoCallbacks.saveCrossSigningKeys?[3,10]:[4,(p=new T.SecretStorage(i.accountDataClientAdapter,i.ssssCryptoCallbacks,void 0)).hasKey()];case 8:return v.sent()?(_.logger.log("Storing new cross-signing private keys in secret storage"),[4,C.CrossSigningInfo.storeInSecretStorage(h,p)]):[3,10];case 9:v.sent(),v.label=10;case 10:return[4,i.buildOperation().apply(n)];case 11:return v.sent(),[4,i.persist(n)];case 12:return v.sent(),_.logger.log("Cross-signing ready"),[2]}}))}))()}},{key:"bootstrapSecretStorage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.createSecretStorageKey,r=void 0===t?(0,o.default)((function(){return(0,f.__generator)(this,(function(e){return[2,{}]}))})):t,n=e.keyBackupInfo,i=e.setupNewKeyBackup,a=e.setupNewSecretStorage,s=e.getKeyBackupPassphrase,l=this;return(0,o.default)((function(){var e,t,d,h,p,v,g,m,y,b,w,E,k,M,R,x,O,A,D,L,U,j,N,B,K,q,W,V,H,G,z,Y;return(0,f.__generator)(this,(function(Z){switch(Z.label){case 0:return _.logger.log("Bootstrapping Secure Secret Storage"),e=l.baseApis.cryptoCallbacks,t=new I.EncryptionSetupBuilder(l.baseApis.store.accountData,e),d=new T.SecretStorage(t.accountDataClientAdapter,t.ssssCryptoCallbacks,void 0),h=null,p=function(){var e=(0,o.default)((function(e,r){var n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return r&&(e.key=r),[4,d.addKey(T.SECRET_STORAGE_ALGORITHM_V1_AES,e)];case 1:return n=a.sent(),i=n.keyId,o=n.keyInfo,r&&t.ssssCryptoCallbacks.addPrivateKey(i,o,r),[4,d.setDefaultKeyId(i)];case 2:return a.sent(),[2,i]}}))}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,o.default)((function(e,r){var n,i,o,a,s,c,d;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return r.mac?[3,4]:[4,null===(n=(i=l.baseApis.cryptoCallbacks).getSecretStorageKey)||void 0===n?void 0:n.call(i,{keys:(0,u.default)({},e,r)},"")];case 1:return(o=f.sent())?(a=o[1],t.ssssCryptoCallbacks.addPrivateKey(e,r,a),[4,(0,F.calculateKeyCheck)(a)]):[3,4];case 2:return s=f.sent(),c=s.iv,d=s.mac,r.iv=c,r.mac=d,[4,t.setAccountData("m.secret_storage.key.".concat(e),r)];case 3:f.sent(),f.label=4;case 4:return[2]}}))}));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=(0,o.default)((function(e){var t,r;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return(t=l.crossSigningInfo.getId())?[4,l.crossSigningInfo.isStoredInKeyCache("master")]:[3,2];case 1:t=n.sent(),n.label=2;case 2:if(!t)return[3,7];n.label=3;case 3:return n.trys.push([3,5,,6]),_.logger.log("Adding cross-signing signature to key backup"),[4,l.crossSigningInfo.signObject(e,"master")];case 4:return n.sent(),[3,6];case 5:return r=n.sent(),_.logger.error("Signing key backup with cross-signing keys failed",r),[3,6];case 6:return[3,8];case 7:_.logger.warn("Cross-signing keys not available, skipping signature on key backup"),n.label=8;case 8:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),[4,l.getSecretStorageKey()];case 1:return m=Z.sent(),y=(0,c.default)(m||[null,null],2),b=y[0],w=y[1],E=!a&&w&&w.algorithm===T.SECRET_STORAGE_ALGORITHM_V1_AES,_.logger.log({keyBackupInfo:n,setupNewKeyBackup:i,setupNewSecretStorage:a,storageExists:E,oldKeyInfo:w}),E||n?[3,4]:(_.logger.log("Secret storage does not exist, creating new storage key"),[4,r()]);case 2:return k=Z.sent(),M=k.keyInfo,R=void 0===M?{}:M,x=k.privateKey,[4,p(R,x)];case 3:return h=Z.sent(),[3,13];case 4:return E||!n?[3,11]:(_.logger.log("Secret storage does not exist, using key backup key"),[4,l.getSessionBackupPrivateKey()]);case 5:return(A=Z.sent())?[3,7]:[4,null==s?void 0:s()];case 6:A=Z.sent(),Z.label=7;case 7:return O=A,D={},n.auth_data.private_key_salt&&n.auth_data.private_key_iterations&&(D.passphrase={algorithm:"m.pbkdf2",iterations:n.auth_data.private_key_iterations,salt:n.auth_data.private_key_salt,bits:256}),[4,p(D,O)];case 8:return h=Z.sent(),[4,d.store("m.megolm_backup.v1",S.encodeBase64(O),[h])];case 9:return Z.sent(),[4,g(n.auth_data)];case 10:return Z.sent(),t.addSessionBackup(n),[3,13];case 11:return _.logger.log("Secret storage exists"),w&&w.algorithm===T.SECRET_STORAGE_ALGORITHM_V1_AES?[4,v(b,w)]:[3,13];case 12:Z.sent(),Z.label=13;case 13:return(U=!l.baseApis.cryptoCallbacks.saveCrossSigningKeys)?[4,l.isCrossSigningReady()]:[3,15];case 14:U=Z.sent(),Z.label=15;case 15:return(L=U)?(j=h)?[3,17]:[4,l.crossSigningInfo.isStoredInSecretStorage(d)]:[3,18];case 16:j=!Z.sent(),Z.label=17;case 17:L=j,Z.label=18;case 18:return L?(_.logger.log("Copying cross-signing private keys from cache to secret storage"),[4,l.crossSigningInfo.getCrossSigningKeysFromCache()]):[3,21];case 19:return N=Z.sent(),[4,C.CrossSigningInfo.storeInSecretStorage(N,d)];case 20:Z.sent(),Z.label=21;case 21:return!i||n?[3,26]:(_.logger.log("Creating new message key backup version"),[4,l.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1})]);case 22:return B=Z.sent(),K=(0,P.decodeRecoveryKey)(B.recovery_key),[4,d.store("m.megolm_backup.v1",S.encodeBase64(K))];case 23:return Z.sent(),q={algorithm:B.algorithm,auth_data:B.auth_data},[4,g(q.auth_data)];case 24:return Z.sent(),[4,l.signObject(q.auth_data)];case 25:Z.sent(),t.addSessionBackup(q),Z.label=26;case 26:return[4,d.get("m.megolm_backup.v1")];case 27:return(W=Z.sent())?(_.logger.info("Got session backup key from secret storage: caching"),(V=oe(W))?(H=h||b,[4,d.store("m.megolm_backup.v1",V,H?[H]:null)]):[3,29]):[3,30];case 28:Z.sent(),Z.label=29;case 29:return G=new Uint8Array(S.decodeBase64(V||W)),t.addSessionBackupPrivateKeyToCache(G),[3,35];case 30:return l.backupManager.getKeyBackupEnabled()?[4,l.getSessionBackupPrivateKey()]:[3,35];case 31:return(Y=Z.sent())?[3,33]:[4,null==s?void 0:s()];case 32:Y=Z.sent(),Z.label=33;case 33:return(z=Y)?(_.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),[4,d.store("m.megolm_backup.v1",S.encodeBase64(z))]):(_.logger.error("Key backup is enabled but couldn't get key backup key!"),[2]);case 34:Z.sent(),Z.label=35;case 35:return[4,t.buildOperation().apply(l)];case 36:return Z.sent(),[4,t.persist(l)];case 37:return Z.sent(),_.logger.log("Secure Secret Storage ready"),[2]}}))}))()}},{key:"addSecretStorageKey",value:function(e,t,r){return this.secretStorage.addKey(e,t,r)}},{key:"hasSecretStorageKey",value:function(e){return this.secretStorage.hasKey(e)}},{key:"getSecretStorageKey",value:function(e){return this.secretStorage.getKey(e)}},{key:"storeSecret",value:function(e,t,r){return this.secretStorage.store(e,t,r)}},{key:"getSecret",value:function(e){return this.secretStorage.get(e)}},{key:"isSecretStored",value:function(e){return this.secretStorage.isStored(e)}},{key:"requestSecret",value:function(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}},{key:"getDefaultSecretStorageKeyId",value:function(){return this.secretStorage.getDefaultKeyId()}},{key:"setDefaultSecretStorageKeyId",value:function(e){return this.secretStorage.setDefaultKeyId(e)}},{key:"checkSecretStorageKey",value:function(e,t){return this.secretStorage.checkKey(e,t)}},{key:"checkSecretStoragePrivateKey",value:function(e,t){var n=null;try{return(n=new r.Olm.PkDecryption).init_with_private_key(e)===t}finally{var i;null===(i=n)||void 0===i||i.free()}}},{key:"getSessionBackupPrivateKey",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(t){e.cryptoStore.doTxn("readonly",[x.IndexedDBCryptoStore.STORE_ACCOUNT],(function(r){e.cryptoStore.getSecretStorePrivateKey(r,t,"m.megolm_backup.v1")}))}))];case 1:return(t=i.sent())&&"string"==typeof t?(t=new Uint8Array(S.decodeBase64(oe(t)||t)),[4,e.storeSessionBackupPrivateKey(t)]):[3,3];case 2:i.sent(),i.label=3;case 3:return t&&t.ciphertext?(r=h.from(e.olmDevice.pickleKey),[4,(0,F.decryptAES)(t,r,"m.megolm_backup.v1")]):[3,5];case 4:n=i.sent(),t=S.decodeBase64(n),i.label=5;case 5:return[2,t]}}))}))()}},{key:"storeSessionBackupPrivateKey",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:if(!(e instanceof Uint8Array))throw new Error("storeSessionBackupPrivateKey expects Uint8Array, got ".concat(e));return r=h.from(t.olmDevice.pickleKey),[4,(0,F.encryptAES)(S.encodeBase64(e),r,"m.megolm_backup.v1")];case 1:return n=i.sent(),[2,t.cryptoStore.doTxn("readwrite",[x.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",n)}))]}}))}))()}},{key:"checkCrossSigningPrivateKey",value:function(e,t){var n=null;try{return(n=new r.Olm.PkSigning).init_with_seed(e)===t}finally{var i;null===(i=n)||void 0===i||i.free()}}},{key:"afterCrossSigningLocalKeyChange",value:function(){var e=this;return(0,o.default)((function(){var t,r,n,i,o,a,s,l,d,h,p,v,g,m,y,b,w,S,E,k,M,I,T;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return _.logger.info("Starting cross-signing key change post-processing"),t=e.deviceList.getStoredDevice(e.userId,e.deviceId),[4,e.crossSigningInfo.signDevice(e.userId,t)];case 1:if(r=f.sent(),_.logger.info("Starting background key sig upload for ".concat(e.deviceId)),n=function(t){var i=t.shouldEmit,o=void 0!==i&&i;return e.baseApis.uploadKeySignatures((0,u.default)({},e.userId,(0,u.default)({},e.deviceId,r))).then((function(t){var r=(t||{}).failures;if(Object.keys(r||[]).length>0)throw o&&e.baseApis.emit(re.KeySignatureUploadFailure,r,"afterCrossSigningLocalKeyChange",n),new B.KeySignatureUploadError("Key upload failed",{failures:r});_.logger.info("Finished background key sig upload for ".concat(e.deviceId))})).catch((function(t){_.logger.error("Error during background key sig upload for ".concat(e.deviceId),t)}))},n({shouldEmit:!0}),!(i=e.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications))return[3,22];_.logger.info("Starting device verification upgrade"),o={},a=!0,s=!1,l=void 0,f.label=2;case 2:f.trys.push([2,7,8,9]),d=Object.entries(e.deviceList.crossSigningInfo)[Symbol.iterator](),f.label=3;case 3:return(a=(h=d.next()).done)?[3,6]:(p=(0,c.default)(h.value,2),v=p[0],g=p[1],[4,e.checkForDeviceVerificationUpgrade(v,C.CrossSigningInfo.fromStorage(g,v))]);case 4:(m=f.sent())&&(o[v]=m),f.label=5;case 5:return a=!0,[3,3];case 6:return[3,9];case 7:return I=f.sent(),s=!0,l=I,[3,9];case 8:try{a||null==d.return||d.return()}finally{if(s)throw l}return[7];case 9:if(!(Object.keys(o).length>0))return[3,21];_.logger.info("Found ".concat(Object.keys(o).length," verif users to upgrade")),f.label=10;case 10:return f.trys.push([10,20,,21]),[4,i({users:o})];case 11:if(!(y=f.sent()))return[3,19];b=!0,w=!1,S=void 0,f.label=12;case 12:f.trys.push([12,17,18,19]),E=y[Symbol.iterator](),f.label=13;case 13:return(b=(k=E.next()).done)?[3,16]:(M=k.value)in o?[4,e.baseApis.setDeviceVerified(M,o[M].crossSigningInfo.getId())]:[3,15];case 14:f.sent(),f.label=15;case 15:return b=!0,[3,13];case 16:return[3,19];case 17:return I=f.sent(),w=!0,S=I,[3,19];case 18:try{b||null==E.return||E.return()}finally{if(w)throw S}return[7];case 19:return[3,21];case 20:return T=f.sent(),_.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",T),[3,21];case 21:_.logger.info("Finished device verification upgrade"),f.label=22;case 22:return _.logger.info("Finished cross-signing key change post-processing"),[2]}}))}))()}},{key:"checkForDeviceVerificationUpgrade",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return n=r.crossSigningInfo.checkUserTrust(t),!t.firstUse||n.isVerified()?[3,2]:(i=r.deviceList.getRawStoredDevicesForUser(e),[4,r.checkForValidDeviceSignature(e,t.keys.master,i)]);case 1:if((o=a.sent()).length)return[2,{devices:o.map((function(e){return k.DeviceInfo.fromStorage(i[e],e)})),crossSigningInfo:t}];a.label=2;case 2:return[2]}}))}))()}},{key:"checkForValidDeviceSignature",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i,o,a,s,u,l,d,h,p,v;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:if(i=[],o=!0,a=!1,s=void 0,!(r&&t.signatures&&t.signatures[e]))return[3,10];f.label=1;case 1:f.trys.push([1,8,9,10]),u=Object.keys(t.signatures[e])[Symbol.iterator](),f.label=2;case 2:if(o=(l=u.next()).done)return[3,7];if(d=l.value,h=(0,c.default)(d.split(":",2),2),!((p=h[1])in r)||r[p].verified!==X.VERIFIED)return[3,6];f.label=3;case 3:return f.trys.push([3,5,,6]),[4,S.verifySignature(n.olmDevice,t,e,p,r[p].keys[d])];case 4:return f.sent(),i.push(p),[3,6];case 5:return f.sent(),[3,6];case 6:return o=!0,[3,2];case 7:return[3,10];case 8:return v=f.sent(),a=!0,s=v,[3,10];case 9:try{o||null==u.return||u.return()}finally{if(a)throw s}return[7];case 10:return[2,i]}}))}))()}},{key:"getCrossSigningId",value:function(e){return this.crossSigningInfo.getId(e)}},{key:"getStoredCrossSigningForUser",value:function(e){return this.deviceList.getStoredCrossSigningForUser(e)}},{key:"checkUserTrust",value:function(e){var t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new C.UserTrustLevel(!1,!1,!1)}},{key:"checkDeviceTrust",value:function(e,t){var r=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,r)}},{key:"checkDeviceInfoTrust",value:function(e,t){var r=!(null==t||!t.isVerified()),n=this.deviceList.getStoredCrossSigningForUser(e);if(t&&n){var i=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(n,t,r,i)}return new C.DeviceTrustLevel(!1,!1,r,!1)}},{key:"checkIfOwnDeviceCrossSigned",value:function(e){var t,r=this.deviceList.getStoredDevice(this.userId,e);if(!r)return!1;var n=this.deviceList.getStoredCrossSigningForUser(this.userId);return null!==(t=null==n?void 0:n.checkDeviceTrust(n,r,!1,!0).isCrossSigningVerified())&&void 0!==t&&t}},{key:"checkOwnCrossSigningTrust",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.allowPrivateKeyRequests,r=void 0!==t&&t,n=this;return(0,o.default)((function(){var e,t,i,o,a,s,l,c,d,h,p,v,g,m,y,b,w,S,E,k,M,C,I,T,R,x,O,A;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return e=n.userId,[4,n.downloadKeys([n.userId])];case 1:return f.sent(),[4,n.crossSigningInfo.getCrossSigningKeysFromCache()];case 2:if(t=f.sent(),!(i=n.deviceList.getStoredCrossSigningForUser(e)))return _.logger.error("Got cross-signing update event for user "+e+" but no new cross-signing information found!"),[2];if(o=i.getId(),a=n.crossSigningInfo.getId()!==o,s=i.getId()&&!t.has("master"),a&&_.logger.info("Got new master public key",o),!r||!a&&!s)return[3,6];_.logger.info("Attempting to retrieve cross-signing master private key"),l=null,f.label=3;case 3:return f.trys.push([3,,5,6]),[4,n.crossSigningInfo.getCrossSigningKey("master",o)];case 4:return c=f.sent(),l=c[1],_.logger.info("Got cross-signing master private key"),[3,6];case 5:return null===(d=l)||void 0===d||d.free(),[7];case 6:if(h=n.crossSigningInfo.getId("self_signing"),p=n.crossSigningInfo.getId("user_signing"),n.storeTrustedSelfKeys(i.keys),v=h!==i.getId("self_signing"),g=p!==i.getId("user_signing"),m=i.getId("self_signing")&&!t.has("self_signing"),y=i.getId("user_signing")&&!t.has("user_signing"),b={},v&&_.logger.info("Got new self-signing key",i.getId("self_signing")),!r||!v&&!m)return[3,12];_.logger.info("Attempting to retrieve cross-signing self-signing private key"),w=null,f.label=7;case 7:return f.trys.push([7,,9,10]),[4,n.crossSigningInfo.getCrossSigningKey("self_signing",i.getId("self_signing"))];case 8:return S=f.sent(),w=S[1],_.logger.info("Got cross-signing self-signing private key"),[3,10];case 9:return null===(E=w)||void 0===E||E.free(),[7];case 10:return k=n.deviceList.getStoredDevice(n.userId,n.deviceId),[4,n.crossSigningInfo.signDevice(n.userId,k)];case 11:M=f.sent(),b[n.deviceId]=M,f.label=12;case 12:if(g&&_.logger.info("Got new user-signing key",i.getId("user_signing")),!r||!g&&!y)return[3,16];_.logger.info("Attempting to retrieve cross-signing user-signing private key"),C=null,f.label=13;case 13:return f.trys.push([13,,15,16]),[4,n.crossSigningInfo.getCrossSigningKey("user_signing",i.getId("user_signing"))];case 14:return I=f.sent(),C=I[1],_.logger.info("Got cross-signing user-signing private key"),[3,16];case 15:return null===(T=C)||void 0===T||T.free(),[7];case 16:return a?(R=n.crossSigningInfo.keys.master,[4,n.signObject(R)]):[3,18];case 17:f.sent(),x=R.signatures[n.userId]["ed25519:"+n.deviceId],b[n.crossSigningInfo.getId()]=Object.assign({},R,{signatures:(0,u.default)({},n.userId,(0,u.default)({},"ed25519:"+n.deviceId,x))}),f.label=18;case 18:return(O=Object.keys(b)).length&&(A=function(e){var t=e.shouldEmit,r=void 0!==t&&t;return _.logger.info("Starting background key sig upload for ".concat(O)),n.baseApis.uploadKeySignatures((0,u.default)({},n.userId,b)).then((function(e){var t=(e||{}).failures;if(_.logger.info("Finished background key sig upload for ".concat(O)),Object.keys(t||[]).length>0)throw r&&n.baseApis.emit(re.KeySignatureUploadFailure,t,"checkOwnCrossSigningTrust",A),new B.KeySignatureUploadError("Key upload failed",{failures:t})})).catch((function(e){_.logger.error("Error during background key sig upload for ".concat(O),e)}))})({shouldEmit:!0}),n.emit(re.UserTrustStatusChanged,e,n.checkUserTrust(e)),a?(n.emit(re.KeysChanged,{}),[4,n.afterCrossSigningLocalKeyChange()]):[3,20];case 19:f.sent(),f.label=20;case 20:return[4,n.backupManager.checkKeyBackup()];case 21:return f.sent(),[2]}}))}))()}},{key:"storeTrustedSelfKeys",value:function(e){var t=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return e?t.crossSigningInfo.setKeys(e):t.crossSigningInfo.clearKeys(),[4,t.cryptoStore.doTxn("readwrite",[x.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){t.cryptoStore.storeCrossSigningKeys(e,t.crossSigningInfo.keys)}))];case 1:return r.sent(),[2]}}))}))()}},{key:"checkDeviceVerifications",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return(r=t.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications)?(_.logger.info("Starting device verification upgrade for ".concat(e)),t.crossSigningInfo.keys.user_signing&&(n=t.deviceList.getStoredCrossSigningForUser(e))?[4,t.checkForDeviceVerificationUpgrade(e,n)]:[3,4]):[2];case 1:return(i=o.sent())?[4,r({users:(0,u.default)({},e,i)})]:[3,4];case 2:return o.sent().includes(e)?[4,t.baseApis.setDeviceVerified(e,n.getId())]:[3,4];case 3:o.sent(),o.label=4;case 4:return _.logger.info("Finished device verification upgrade for ".concat(e)),[2]}}))}))()}},{key:"enableLazyLoading",value:function(){this.lazyLoadMembers=!0}},{key:"registerEventHandlers",value:function(e){e.on(V.RoomMemberEvent.Membership,this.onMembership),e.on(G.ClientEvent.ToDeviceEvent,this.onToDeviceEvent),e.on(W.RoomEvent.Timeline,this.onTimelineEvent),e.on(H.MatrixEventEvent.Decrypted,this.onTimelineEvent)}},{key:"start",value:function(){_.logger.warn("MatrixClient.crypto.start() is deprecated")}},{key:"stop",value:function(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}},{key:"getDeviceEd25519Key",value:function(){return this.olmDevice.deviceEd25519Key}},{key:"getDeviceCurve25519Key",value:function(){return this.olmDevice.deviceCurve25519Key}},{key:"setGlobalBlacklistUnverifiedDevices",value:function(e){this.globalBlacklistUnverifiedDevices=e}},{key:"getGlobalBlacklistUnverifiedDevices",value:function(){return this.globalBlacklistUnverifiedDevices}},{key:"uploadDeviceKeys",value:function(){var e=this,t={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(t).then((function(){return e.baseApis.uploadKeysRequest({device_keys:t})}))}},{key:"updateOneTimeKeyCount",value:function(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}},{key:"setNeedsNewFallback",value:function(e){this.needsNewFallback=e}},{key:"getNeedsNewFallback",value:function(){return!!this.needsNewFallback}},{key:"maybeUploadOneTimeKeys",value:function(){var e=this;if(!this.oneTimeKeyCheckInProgress){var t=Date.now();if(!(null!==this.lastOneTimeKeyCheck&&t-this.lastOneTimeKeyCheck<6e4)){this.lastOneTimeKeyCheck=t;var r,n=this.olmDevice.maxNumberOfOneTimeKeys(),i=Math.floor(n/2),a=this,s=(r=(0,o.default)((function(e){var t,r,n;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return i>e||a.getNeedsNewFallback()?i>e?(_.logger.info("generating oneTimeKeys"),t=Math.min(i-e,5),[4,a.olmDevice.generateOneTimeKeys(t)]):[3,2]:[3,7];case 1:o.sent(),o.label=2;case 2:return a.getNeedsNewFallback()?[4,a.olmDevice.getFallbackKey()]:[3,5];case 3:return(r=o.sent()).curve25519&&0!=Object.keys(r.curve25519).length?[3,5]:(_.logger.info("generating fallback key"),a.fallbackCleanup&&(clearTimeout(a.fallbackCleanup),delete a.fallbackCleanup),[4,a.olmDevice.generateFallbackKey()]);case 4:o.sent(),o.label=5;case 5:return _.logger.info("calling uploadOneTimeKeys"),[4,a.uploadOneTimeKeys()];case 6:if(!(n=o.sent()).one_time_key_counts||!n.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");return e=n.one_time_key_counts.signed_curve25519,[3,0];case 7:return[2]}}))})),function(e){return r.apply(this,arguments)});this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((function(){return void 0!==e.oneTimeKeyCount?Promise.resolve(e.oneTimeKeyCount):e.baseApis.uploadKeysRequest({}).then((function(e){return e.one_time_key_counts.signed_curve25519||0}))})).then((function(e){return s(e)})).catch((function(e){_.logger.error("Error uploading one-time keys",e.stack||e)})).finally((function(){e.oneTimeKeyCount=void 0,e.oneTimeKeyCheckInProgress=!1}))}}}},{key:"uploadOneTimeKeys",value:function(){var e=this;return(0,o.default)((function(){var t,r,n,i,o,a,s,u,l,d,h,p,v,g,m,y,b;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return t=[],e.getNeedsNewFallback()?(r={},[4,e.olmDevice.getFallbackKey()]):[3,2];case 1:n=f.sent(),i=!0,o=!1,a=void 0;try{for(s=Object.entries(n.curve25519)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)l=(0,c.default)(u.value,2),d=l[0],h=l[1],p={key:h,fallback:!0},r["signed_curve25519:"+d]=p,t.push(e.signObject(p))}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}e.setNeedsNewFallback(!1),f.label=2;case 2:return[4,e.olmDevice.getOneTimeKeys()];case 3:for(var _ in v=f.sent(),g={},v.curve25519)v.curve25519.hasOwnProperty(_)&&(m={key:v.curve25519[_]},g["signed_curve25519:"+_]=m,t.push(e.signObject(m)));return[4,Promise.all(t)];case 4:return f.sent(),y={one_time_keys:g},r&&(y["org.matrix.msc2732.fallback_keys"]=r,y.fallback_keys=r),[4,e.baseApis.uploadKeysRequest(y)];case 5:return b=f.sent(),r&&(e.fallbackCleanup=setTimeout((function(){delete e.fallbackCleanup,e.olmDevice.forgetOldFallbackKey()}),36e5)),[4,e.olmDevice.markKeysAsPublished()];case 6:return f.sent(),[2,b]}}))}))()}},{key:"downloadKeys",value:function(e,t){return this.deviceList.downloadKeys(e,!!t)}},{key:"getStoredDevicesForUser",value:function(e){return this.deviceList.getStoredDevicesForUser(e)}},{key:"getStoredDevice",value:function(e,t){return this.deviceList.getStoredDevice(e,t)}},{key:"saveDeviceList",value:function(e){return this.deviceList.saveIfDirty(e)}},{key:"setDeviceVerification",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5?arguments[5]:void 0,s=this;return(0,o.default)((function(){var l,d,h,p,v,g,m,y,b,w,S,E,M,C,I,T,R,x,O;return(0,f.__generator)(this,(function(A){switch(A.label){case 0:if(!(l=s.deviceList.getStoredCrossSigningForUser(e))||l.getId()!==t)return[3,5];if(null!==n||null!==i)throw new Error("Cannot set blocked or known for a cross-signing key");if(!r)throw new Error("Cannot set a cross-signing key as unverified");if(d=a?Object.values(a)[0]:null,a&&(1!==Object.values(a).length||d!==l.getId()))throw new Error("Key did not match expected value: expected ".concat(l.getId(),", got ").concat(d));return s.crossSigningInfo.getId()||e!==s.crossSigningInfo.userId||(s.storeTrustedSelfKeys(l.keys),s.emit(re.UserTrustStatusChanged,s.userId,s.checkUserTrust(e))),e===s.userId?[3,4]:(_.logger.info("Master key "+l.getId()+" for "+e+" marked verified. Signing..."),[4,s.crossSigningInfo.signUser(l)]);case 1:return(h=A.sent())?(D=(0,o.default)((function(r){var n,i,o,a;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:return n=r.shouldEmit,i=void 0!==n&&n,_.logger.info("Uploading signature for "+e+"..."),[4,s.baseApis.uploadKeySignatures((0,u.default)({},e,(0,u.default)({},t,h)))];case 1:if(o=l.sent(),a=(o||{}).failures,Object.keys(a||[]).length>0)throw i&&s.baseApis.emit(re.KeySignatureUploadFailure,a,"setDeviceVerification",p),new B.KeySignatureUploadError("Key upload failed",{failures:a});return[2]}}))})),p=function(e){return D.apply(this,arguments)},[4,p({shouldEmit:!0})]):[3,3];case 2:A.sent(),A.label=3;case 3:return[2,h];case 4:return[2,l];case 5:if(!(v=s.deviceList.getRawStoredDevicesForUser(e))||!v[t])throw new Error("Unknown device "+e+":"+t);if(g=v[t],m=g.verified,r){if(y=!0,b=!1,w=void 0,a)try{for(S=Object.entries(a)[Symbol.iterator]();!(y=(E=S.next()).done);y=!0)if(M=(0,c.default)(E.value,2),C=M[0],I=M[1],g.keys[C]!==I)throw new Error("Key did not match expected value: expected ".concat(I,", got ").concat(g.keys[C]))}catch(e){b=!0,w=e}finally{try{y||null==S.return||S.return()}finally{if(b)throw w}}m=X.VERIFIED}else null!==r&&m==X.VERIFIED&&(m=X.UNVERIFIED);return n?m=X.BLOCKED:null!==n&&m==X.BLOCKED&&(m=X.UNVERIFIED),T=g.known,null!==i&&(T=i),g.verified===m&&g.known===T||(g.verified=m,g.known=T,s.deviceList.storeDevicesForUser(e,v),s.deviceList.saveIfDirty()),r&&e===s.userId?(_.logger.info("Own device "+t+" marked verified: signing"),s.checkDeviceTrust(e,t).isCrossSigningVerified()?(_.logger.log("Own device ".concat(t," already cross-signing verified")),[3,8]):[3,6]):[3,10];case 6:return[4,s.crossSigningInfo.signDevice(e,k.DeviceInfo.fromStorage(g,t))];case 7:R=A.sent(),A.label=8;case 8:return R?(x=function(){var r=(0,o.default)((function(r){var n,i,o,a;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:return n=r.shouldEmit,i=void 0!==n&&n,_.logger.info("Uploading signature for "+t),[4,s.baseApis.uploadKeySignatures((0,u.default)({},e,(0,u.default)({},t,R)))];case 1:if(o=l.sent(),a=(o||{}).failures,Object.keys(a||[]).length>0)throw i&&s.baseApis.emit(re.KeySignatureUploadFailure,a,"setDeviceVerification",x),new B.KeySignatureUploadError("Key upload failed",{failures:a});return[2]}}))}));return function(e){return r.apply(this,arguments)}}(),[4,x({shouldEmit:!0})]):[3,10];case 9:A.sent(),A.label=10;case 10:return O=k.DeviceInfo.fromStorage(g,t),s.emit(re.DeviceVerificationChanged,e,t,O),[2,O]}var D}))}))()}},{key:"findVerificationRequestDMInProgress",value:function(e){return this.inRoomVerificationRequests.findRequestInProgress(e)}},{key:"getVerificationRequestsToDeviceInProgress",value:function(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}},{key:"requestVerificationDM",value:function(e,t){var r=this.inRoomVerificationRequests.findRequestInProgress(t);if(r)return Promise.resolve(r);var n=new U.InRoomChannel(this.baseApis,t,e);return this.requestVerificationWithChannel(e,n,this.inRoomVerificationRequests)}},{key:"requestVerification",value:function(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));var r=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(r)return Promise.resolve(r);var n=new j.ToDeviceChannel(this.baseApis,e,t,j.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(e,n,this.toDeviceVerificationRequests)}},{key:"requestVerificationWithChannel",value:function(e,t,r){var n=this;return(0,o.default)((function(){var e,i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return e=new L.VerificationRequest(t,n.verificationMethods,n.baseApis),t.transactionId&&r.setRequestByChannel(t,e),[4,e.sendRequest()];case 1:return o.sent(),(i=r.getRequestByChannel(t))?e=i:(_.logger.log("Crypto: adding new request to "+"requestsByTxnId with id ".concat(t.transactionId," ").concat(t.roomId)),r.setRequestByChannel(t,e)),[2,e]}}))}))()}},{key:"beginKeyVerification",value:function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i){if(!(n=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,i)))throw new Error("No request found for user ".concat(t," with ")+"transactionId ".concat(i))}else{i=j.ToDeviceChannel.makeTransactionId();var o=new j.ToDeviceChannel(this.baseApis,t,[r],i,r);n=new L.VerificationRequest(o,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,n)}return n.beginKeyVerification(e,{userId:t,deviceId:r})}},{key:"legacyDeviceVerification",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i,o,a,s;return(0,f.__generator)(this,(function(u){switch(u.label){case 0:return i=j.ToDeviceChannel.makeTransactionId(),o=new j.ToDeviceChannel(n.baseApis,e,[t],i,t),a=new L.VerificationRequest(o,n.verificationMethods,n.baseApis),n.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,i,a),s=a.beginKeyVerification(r,{userId:e,deviceId:t}),[4,Promise.race([s.verify(),a.waitFor((function(e){return e.started}))])];case 1:return u.sent(),[2,a]}}))}))()}},{key:"getOlmSessionsForUser",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a,s,u,l,c,d,h;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:r=t.getStoredDevicesForUser(e)||[],n={},i=!0,o=!1,a=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),s=r[Symbol.iterator](),f.label=2;case 2:return(i=(u=s.next()).done)?[3,5]:(l=u.value,c=l.getIdentityKey(),[4,t.olmDevice.getSessionInfoForDevice(c)]);case 3:d=f.sent(),n[l.deviceId]={deviceIdKey:c,sessions:d},f.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return h=f.sent(),o=!0,a=h,[3,8];case 7:try{i||null==s.return||s.return()}finally{if(o)throw a}return[7];case 8:return[2,n]}}))}))()}},{key:"getEventSenderDeviceInfo",value:function(e){var t=e.getSenderKey(),r=e.getWireContent().algorithm;if(!t||!r)return null;if(e.isKeySourceUntrusted())return null;var n=this.deviceList.getDeviceByIdentityKey(r,t);if(null===n)return null;var i=e.getClaimedEd25519Key();return i?i!==n.getFingerprint()?(_.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+" but sender device has key "+n.getFingerprint()),null):n:(_.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}},{key:"getEventEncryptionInfo",value:function(e){var t,r,n={};if(n.senderKey=null!==(t=e.getSenderKey())&&void 0!==t?t:void 0,n.algorithm=e.getWireContent().algorithm,!n.senderKey||!n.algorithm)return n.encrypted=!1,n;n.encrypted=!0,e.isKeySourceUntrusted()?n.authenticated=!1:n.authenticated=!0,n.sender=null!==(r=this.deviceList.getDeviceByIdentityKey(n.algorithm,n.senderKey))&&void 0!==r?r:void 0;var i=e.getClaimedEd25519Key();return i||(_.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),n.mismatchedSender=!0),n.sender&&i!==n.sender.getFingerprint()&&(_.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+"but sender device has key "+n.sender.getFingerprint()),n.mismatchedSender=!0),n}},{key:"forceDiscardSession",value:function(e){var t=this.roomEncryptors.get(e);if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()}},{key:"setRoomEncryption",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:if(!(i=n.clientStore.getRoom(e)))throw new Error("Unable to enable encryption tracking devices in unknown room ".concat(e));return[4,n.setRoomEncryptionImpl(i,t)];case 1:return o.sent(),n.lazyLoadMembers||r||n.deviceList.refreshOutdatedDeviceLists(),[2]}}))}))()}},{key:"setRoomEncryptionImpl",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:if(n=e.roomId,!t.algorithm)return _.logger.log("Ignoring setRoomEncryption with no algorithm"),[2];if((i=r.roomList.getRoomEncryption(n))&&JSON.stringify(i)!=JSON.stringify(t))return _.logger.error("Ignoring m.room.encryption event which requests a change of config in "+n),[2];if(r.roomEncryptors.get(n))return[2];if(o=null,i||(o=r.roomList.setRoomEncryption(n,t)),!(a=M.ENCRYPTION_CLASSES.get(t.algorithm)))throw new Error("Unable to encrypt with "+t.algorithm);return s=new a({userId:r.userId,deviceId:r.deviceId,crypto:r,olmDevice:r.olmDevice,baseApis:r.baseApis,roomId:n,config:t}),r.roomEncryptors.set(n,s),o?[4,o]:[3,2];case 1:l.sent(),l.label=2;case 2:return _.logger.log("Enabling encryption in ".concat(n)),e.membersLoaded()?[4,r.trackRoomDevicesImpl(e)]:[3,4];case 3:return l.sent(),[3,5];case 4:u=function(t){e.off(Y.RoomStateEvent.Update,u),e.membersLoaded()&&r.trackRoomDevicesImpl(e).catch((function(e){_.logger.error("Error enabling device tracking in ".concat(n),e)}))},e.on(Y.RoomStateEvent.Update,u),l.label=5;case 5:return[2]}}))}))()}},{key:"trackRoomDevices",value:function(e){var t=this.clientStore.getRoom(e);if(!t)throw new Error("Unable to start tracking devices in unknown room ".concat(e));return this.trackRoomDevicesImpl(t)}},{key:"trackRoomDevicesImpl",value:function(e){var t,r=this,n=e.roomId,i=this,a=(t=(0,o.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return i.roomEncryptors.has(n)?(_.logger.log("Starting to track devices for room ".concat(n," ...")),[4,e.getEncryptionTargetMembers()]):[2];case 1:return t.sent().forEach((function(e){i.deviceList.startTrackingDeviceList(e.userId)})),[2]}}))})),function(){return t.apply(this,arguments)}),s=this.roomDeviceTrackingState[n];return s||(s=a(),this.roomDeviceTrackingState[n]=s.catch((function(e){throw delete r.roomDeviceTrackingState[n],e}))),s}},{key:"ensureOlmSessionsForUsers",value:function(e,t){var r={},n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r[u]=[];var l=this.getStoredDevicesForUser(u)||[],c=!0,d=!1,f=void 0;try{for(var h,p=l[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value;v.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(v.verified!=X.BLOCKED&&r[u].push(v))}}catch(e){d=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return S.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,r,t)}},{key:"exportRoomKeys",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return t=[],[4,e.cryptoStore.doTxn("readonly",[x.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(function(r){e.cryptoStore.getAllEndToEndInboundGroupSessions(r,(function(r){if(null!==r){var n=e.olmDevice.exportInboundGroupSession(r.senderKey,r.sessionId,r.sessionData);delete n.first_known_index,n.algorithm=S.MEGOLM_ALGORITHM,t.push(n)}}))}))];case 1:return r.sent(),[2,t]}}))}))()}},{key:"importRoomKeys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this,n=0,i=0,o=e.length;function a(){var e;null===(e=t.progressCallback)||void 0===e||e.call(t,{stage:"load_keys",successes:n,failures:i,total:o})}return Promise.all(e.map((function(e){return e.room_id&&e.algorithm?r.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((function(){n++,t.progressCallback&&a()})):(_.logger.warn("ignoring room key entry with missing fields",e),i++,t.progressCallback&&a(),null)}))).then()}},{key:"countSessionsNeedingBackup",value:function(){return this.backupManager.countSessionsNeedingBackup()}},{key:"prepareToEncrypt",value:function(e){var t=this.roomEncryptors.get(e.roomId);t&&t.prepareToEncrypt(e)}},{key:"encryptEvent",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");if(n=e.getRoomId(),!(i=r.roomEncryptors.get(n)))throw new Error("Room "+n+" was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");return[4,r.trackRoomDevicesImpl(t)];case 1:return l.sent(),o=e.getContent(),(a=o["m.relates_to"])&&delete(o=Object.assign({},o))["m.relates_to"],(s=o["io.element.performance_metrics"])&&delete(o=Object.assign({},o))["io.element.performance_metrics"],[4,i.encryptMessage(t,e.getType(),o)];case 2:return u=l.sent(),a&&(u["m.relates_to"]=a),s&&(u["io.element.performance_metrics"]=s),e.makeEncrypted("m.room.encrypted",u,r.olmDevice.deviceCurve25519Key,r.olmDevice.deviceEd25519Key),[2]}}))}))()}},{key:"decryptEvent",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a;return(0,f.__generator)(this,(function(s){switch(s.label){case 0:if(!e.isRedacted())return[3,5];if(r=new H.MatrixEvent(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,v.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({room_id:e.getRoomId()},e.getUnsigned().redacted_because)),n=e.getUnsigned().redacted_because,!r.isEncrypted())return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,t.decryptEvent(r)];case 2:return i=s.sent(),n=i.clearEvent,[3,4];case 3:return o=s.sent(),_.logger.warn("Decryption of redaction failed. Falling back to unencrypted event.",o),[3,4];case 4:return[2,{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:n}}}];case 5:return a=e.getWireContent(),[2,t.getRoomDecryptor(e.getRoomId(),a.algorithm).decryptEvent(e)];case 6:return[2]}}))}))()}},{key:"handleDeviceListChanges",value:function(e,t){var r=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return e.oldSyncToken?[4,r.evalDeviceListChanges(t)]:[2];case 1:return n.sent(),[2]}}))}))()}},{key:"requestRoomKey",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this;return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,r).then((function(){n.sendKeyRequestsImmediately&&n.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((function(e){_.logger.error("Error requesting key for event",e)}))}},{key:"cancelRoomKeyRequest",value:function(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((function(e){_.logger.warn("Error clearing pending room key requests",e)}))}},{key:"cancelAndResendAllOutgoingKeyRequests",value:function(){var e=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()];case 1:return t.sent(),[2]}}))}))()}},{key:"onCryptoEvent",value:function(e,t){var r=this;return(0,o.default)((function(){var n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return n=t.getContent(),[4,r.setRoomEncryptionImpl(e,n)];case 1:return i.sent(),[2]}}))}))()}},{key:"onSyncWillProcess",value:function(e){var t=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(r){return e.oldSyncToken||(_.logger.log("Initial sync performed - resetting device tracking state"),t.deviceList.stopTrackingAllDeviceLists(),t.deviceList.startTrackingDeviceList(t.userId),t.roomDeviceTrackingState={}),t.sendKeyRequestsImmediately=!1,[2]}))}))()}},{key:"onSyncCompleted",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,f.__generator)(this,(function(n){return t.deviceList.setSyncToken(null!==(r=e.nextSyncToken)&&void 0!==r?r:null),t.deviceList.saveIfDirty(),t.deviceList.startTrackingDeviceList(t.userId),t.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(t.maybeUploadOneTimeKeys(),t.processReceivedRoomKeyRequests(),t.outgoingRoomKeyRequestManager.sendQueuedRequests(),t.sendKeyRequestsImmediately=!0),[2]}))}))()}},{key:"evalDeviceListChanges",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return Array.isArray(null==e?void 0:e.changed)&&e.changed.forEach((function(e){t.deviceList.invalidateUserDeviceList(e)})),Array.isArray(null==e?void 0:e.left)&&e.left.length?(n=Set.bind,[4,t.getTrackedE2eUsers()]):[3,2];case 1:r=new(n.apply(Set,[void 0,i.sent()])),e.left.forEach((function(e){r.has(e)||t.deviceList.stopTrackingDeviceList(e)})),i.label=2;case 2:return[2]}}))}))()}},{key:"getTrackedE2eUsers",value:function(){var e=this;return(0,o.default)((function(){var t,r,n,i,o,a,s,u,l,c,d,h,p,v;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:t=[],r=!0,n=!1,i=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),o=e.getTrackedE2eRooms()[Symbol.iterator](),f.label=2;case 2:return(r=(a=o.next()).done)?[3,5]:[4,a.value.getEncryptionTargetMembers()];case 3:s=f.sent(),u=!0,l=!1,c=void 0;try{for(d=s[Symbol.iterator]();!(u=(h=d.next()).done);u=!0)p=h.value,t.push(p.userId)}catch(e){l=!0,c=e}finally{try{u||null==d.return||d.return()}finally{if(l)throw c}}f.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return v=f.sent(),n=!0,i=v,[3,8];case 7:try{r||null==o.return||o.return()}finally{if(n)throw i}return[7];case 8:return[2,t]}}))}))()}},{key:"getTrackedE2eRooms",value:function(){var e=this;return this.clientStore.getRooms().filter((function(t){if(!e.roomEncryptors.get(t.roomId))return!1;if(!e.roomDeviceTrackingState[t.roomId])return!1;var r=t.getMyMembership();return"join"===r||"invite"===r}))}},{key:"encryptAndSendToDevices",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,a;return(0,f.__generator)(this,(function(s){switch(s.label){case 0:n={eventType:y.EventType.RoomMessageEncrypted,batch:[]},s.label=1;case 1:return s.trys.push([1,7,,8]),[4,Promise.all(e.map((l=(0,o.default)((function(e){var i,o,a,s;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:return i=e.userId,o=e.deviceInfo,a=o.deviceId,s=(0,u.default)({algorithm:S.OLM_ALGORITHM,sender_key:r.olmDevice.deviceCurve25519Key,ciphertext:{}},y.ToDeviceMessageId,(0,m.default)()),n.batch.push({userId:i,deviceId:a,payload:s}),[4,S.ensureOlmSessionsForDevices(r.olmDevice,r.baseApis,(0,u.default)({},i,[o]))];case 1:return l.sent(),[4,S.encryptMessageForDevice(s.ciphertext,r.userId,r.deviceId,r.olmDevice,i,o,t)];case 2:return l.sent(),[2]}}))})),function(e){return l.apply(this,arguments)})))];case 2:s.sent(),n.batch=n.batch.filter((function(e){return Object.keys(e.payload.ciphertext).length>0||(_.logger.log("No ciphertext for device ".concat(e.userId,":").concat(e.deviceId,": pruning")),!1)})),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,r.baseApis.queueToDevice(n)];case 4:return s.sent(),[3,6];case 5:throw i=s.sent(),_.logger.error("sendToDevice failed",i),i;case 6:return[3,8];case 7:throw a=s.sent(),_.logger.error("encryptAndSendToDevices promises failed",a),a;case 8:return[2]}var l}))}))()}},{key:"preprocessToDeviceMessages",value:function(e){return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){return[2,e.filter((function(e){var t;return!(e.type===y.EventType.RoomMessageEncrypted&&!["m.olm.v1.curve25519-aes-sha2"].includes(null===(t=e.content)||void 0===t?void 0:t.algorithm))||(_.logger.log("Ignoring invalid encrypted to-device event from "+e.sender),!1)}))]}))}))()}},{key:"onRoomKeyEvent",value:function(e){var t=e.getContent();t.room_id&&t.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):_.logger.error("key event is missing fields")}},{key:"onRoomKeyWithheldEvent",value:function(e){var t=e.getContent();if(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key){_.logger.info("Got room key withheld event from ".concat(e.getSender()," ")+"for ".concat(t.algorithm," session ").concat(t.sender_key,"|").concat(t.session_id," ")+"in room ".concat(t.room_id," with code ").concat(t.code," (").concat(t.reason,")"));var r=this.getRoomDecryptor(t.room_id,t.algorithm);if(r.onRoomKeyWithheldEvent&&r.onRoomKeyWithheldEvent(e),!t.room_id){var n=this.getRoomDecryptors(t.algorithm),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){s.value.retryDecryptionFromSender(t.sender_key)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}}else _.logger.error("key withheld event is missing fields")}},{key:"onKeyVerificationMessage",value:function(e){var t=this;if(j.ToDeviceChannel.validateEvent(e,this.baseApis)){this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(function(e){if(j.ToDeviceChannel.canCreateRequest(j.ToDeviceChannel.getEventType(e))){var r=e.getContent(),n=r&&r.from_device;if(n){var i=e.getSender(),o=new j.ToDeviceChannel(t.baseApis,i,[n]);return new L.VerificationRequest(o,t.verificationMethods,t.baseApis)}}}))}}},{key:"handleVerificationEvent",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this;return(0,o.default)((function(){var o,a,s,u,l,c;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:if(!e.isSending()||e.status==H.EventStatus.SENT)return[3,5];d.label=1;case 1:return d.trys.push([1,3,4,5]),[4,new Promise((function(t,r){o=t,a=function(){e.status==H.EventStatus.CANCELLED&&r(new Error("Event status set to CANCELLED."))},e.once(H.MatrixEventEvent.LocalEventIdReplaced,o),e.on(H.MatrixEventEvent.Status,a)}))];case 2:return d.sent(),[3,5];case 3:return s=d.sent(),_.logger.error("error while waiting for the verification event to be sent: ",s),[2];case 4:return e.removeListener(H.MatrixEventEvent.LocalEventIdReplaced,o),e.removeListener(H.MatrixEventEvent.Status,a),[7];case 5:if(u=t.getRequest(e),l=!1,!u){if(!(u=r(e)))return _.logger.log("Crypto: could not find VerificationRequest for "+"".concat(e.getType(),", and could not create one, so ignoring.")),[2];l=!0,t.setRequest(e,u)}e.setVerificationRequest(u),d.label=6;case 6:return d.trys.push([6,8,,9]),[4,u.channel.handleEvent(e,u,n)];case 7:return d.sent(),[3,9];case 8:return c=d.sent(),_.logger.error("error while handling verification event",c),[3,9];case 9:return l&&!u.initiatedByMe&&!u.invalid&&!u.observeOnly&&i.baseApis.emit(re.VerificationRequest,u),[2]}}))}))()}},{key:"onToDeviceBadEncrypted",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a,s,l,c,d,h,p,v,g,b,w,E;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return r=e.getWireContent(),n=e.getSender(),i=r.algorithm,o=r.sender_key,a=function(){var e=t.getRoomDecryptors(S.MEGOLM_ALGORITHM),r=!0,n=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){a.value.retryDecryptionFromSender(o)}}catch(e){n=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}},void 0===n||void 0===o||void 0===o?[2]:(t.lastNewSessionForced[n]=t.lastNewSessionForced[n]||{},(s=t.lastNewSessionForced[n][o]||0)+36e5>Date.now()?(_.logger.debug("New session already forced with device "+n+":"+o+" at "+s+": not forcing another"),[4,t.olmDevice.recordSessionProblem(o,"wedged",!0)]):[3,2]);case 1:case 4:return f.sent(),a(),[2];case 2:return(l=t.deviceList.getDeviceByIdentityKey(i,o))?[3,5]:[4,t.downloadKeys([n],!1)];case 3:return f.sent(),(l=t.deviceList.getDeviceByIdentityKey(i,o))?[3,5]:(_.logger.info("Couldn't find device for identity key "+o+": not re-establishing session"),[4,t.olmDevice.recordSessionProblem(o,"wedged",!1)]);case 5:return(c={})[n]=[l],[4,S.ensureOlmSessionsForDevices(t.olmDevice,t.baseApis,c,!0)];case 6:return f.sent(),t.lastNewSessionForced[n][o]=Date.now(),d=(0,u.default)({algorithm:S.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{}},y.ToDeviceMessageId,(0,m.default)()),[4,S.encryptMessageForDevice(d.ciphertext,t.userId,t.deviceId,t.olmDevice,n,l,{type:"m.dummy"})];case 7:return f.sent(),[4,t.olmDevice.recordSessionProblem(o,"wedged",!0)];case 8:return f.sent(),a(),[4,t.baseApis.sendToDevice("m.room.encrypted",(0,u.default)({},n,(0,u.default)({},l.deviceId,d)))];case 9:return f.sent(),[4,t.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(n,l.deviceId)];case 10:h=f.sent(),p=!0,v=!1,g=void 0;try{for(b=h[Symbol.iterator]();!(p=(w=b.next()).done);p=!0)E=w.value,t.requestRoomKey(E.requestBody,E.recipients,!0)}catch(e){v=!0,g=e}finally{try{p||null==b.return||b.return()}finally{if(v)throw g}}return[2]}}))}))()}},{key:"onRoomMembership",value:function(e,t,r){var n=t.roomId,i=this.roomEncryptors.get(n);if(i){var o;if(n in this.roomDeviceTrackingState)"join"==t.membership?(_.logger.log("Join event for "+t.userId+" in "+n),this.deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&null!==(o=this.clientStore.getRoom(n))&&void 0!==o&&o.shouldEncryptForInvitedMembers()&&(_.logger.log("Invite event for "+t.userId+" in "+n),this.deviceList.startTrackingDeviceList(t.userId));i.onRoomMembership(e,t,r)}}},{key:"onRoomKeyRequestEvent",value:function(e){var t=e.getContent();if("request"===t.action){var r=new ae(e);this.receivedRoomKeyRequests.push(r)}else if("request_cancellation"===t.action){var n=new se(e);this.receivedRoomKeyRequestCancellations.push(n)}}},{key:"processReceivedRoomKeyRequests",value:function(){var e=this;return(0,o.default)((function(){var t,r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:if(e.processingRoomKeyRequests)return[2];e.processingRoomKeyRequests=!0,i.label=1;case 1:return i.trys.push([1,4,5,6]),t=e.receivedRoomKeyRequests,e.receivedRoomKeyRequests=[],r=e.receivedRoomKeyRequestCancellations,e.receivedRoomKeyRequestCancellations=[],[4,Promise.all(t.map((function(t){return e.processReceivedRoomKeyRequest(t)})))];case 2:return i.sent(),[4,Promise.all(r.map((function(t){return e.processReceivedRoomKeyRequestCancellation(t)})))];case 3:return i.sent(),[3,6];case 4:return n=i.sent(),_.logger.error("Error processing room key requsts: ".concat(n)),[3,6];case 5:return e.processingRoomKeyRequests=!1,[7];case 6:return[2]}}))}))()}},{key:"processReceivedRoomKeyRequest",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o,a,s,u,l,c;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:if(r=e.userId,n=e.deviceId,i=e.requestBody,o=i.room_id,a=i.algorithm,_.logger.log("m.room_key_request from ".concat(r,":").concat(n)+" for ".concat(o," / ").concat(i.session_id," (id ").concat(e.requestId,")")),r===t.userId)return[3,5];if(!t.roomEncryptors.get(o))return _.logger.debug("room key request for unencrypted room ".concat(o)),[2];if(s=t.roomEncryptors.get(o),!(u=t.deviceList.getStoredDevice(r,n)))return _.logger.debug("Ignoring keyshare for unknown device ".concat(r,":").concat(n)),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,s.reshareKeyWithDevice(i.sender_key,i.session_id,r,u)];case 2:return d.sent(),[3,4];case 3:return l=d.sent(),_.logger.warn("Failed to re-share keys for session "+i.session_id+" with device "+r+":"+u.deviceId,l),[3,4];case 4:return[2];case 5:return n===t.deviceId?(_.logger.log("Ignoring room key request from ourselves"),[2]):t.roomDecryptors.has(o)?(c=t.roomDecryptors.get(o).get(a))?[4,c.hasKeysForKeyRequest(e)]:(_.logger.log("room key request for unknown alg ".concat(a," in room ").concat(o)),[2]):(_.logger.log("room key request for unencrypted room ".concat(o)),[2]);case 6:return d.sent()?(e.share=function(){c.shareKeysWithDevice(e)},t.checkDeviceTrust(r,n).isVerified()?(_.logger.log("device is already verified: sharing keys"),e.share(),[2]):(t.emit(re.RoomKeyRequest,e),[2])):(_.logger.log("room key request for unknown session ".concat(o," / ")+i.session_id),[2])}}))}))()}},{key:"processReceivedRoomKeyRequestCancellation",value:function(e){var t=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(r){return _.logger.log("m.room_key_request cancellation for ".concat(e.userId,":")+"".concat(e.deviceId," (id ").concat(e.requestId,")")),t.emit(re.RoomKeyRequestCancellation,e),[2]}))}))()}},{key:"getRoomDecryptor",value:function(e,t){var r,n;if(e&&((r=this.roomDecryptors.get(e))||(r=new Map,this.roomDecryptors.set(e,r)),n=r.get(t)))return n;var i=M.DECRYPTION_CLASSES.get(t);if(!i)throw new M.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return n=new i({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:null!=e?e:void 0}),r&&r.set(t,n),n}},{key:"getRoomDecryptors",value:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=this.roomDecryptors.values()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;s.has(e)&&t.push(s.get(e))}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}},{key:"signObject",value:function(e){var t=this;return(0,o.default)((function(){var r,n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return r=e.signatures||{},n=e.unsigned,delete e.signatures,delete e.unsigned,r[t.userId]=r[t.userId]||{},i=r[t.userId],o="ed25519:"+t.deviceId,[4,t.olmDevice.sign(g.default.stringify(e))];case 1:return i[o]=a.sent(),e.signatures=r,void 0!==n&&(e.unsigned=n),[2]}}))}))()}}],[{key:"getOlmVersion",value:function(){return w.OlmDevice.getOlmVersion()}}]),n}(z.TypedEventEmitter);function oe(e){if("string"!=typeof e||e.indexOf(",")<0)return null;var t=Uint8Array.from(e.split(","),(function(e){return parseInt(e)}));return S.encodeBase64(t)}e.exports.Crypto=ie;var ae=function e(t){"use strict";(0,a.default)(this,e),(0,v.default)(this,"userId",void 0),(0,v.default)(this,"deviceId",void 0),(0,v.default)(this,"requestId",void 0),(0,v.default)(this,"requestBody",void 0),(0,v.default)(this,"share",void 0);var r=t.getContent();this.userId=t.getSender(),this.deviceId=r.requesting_device_id,this.requestId=r.request_id,this.requestBody=r.body||{},this.share=function(){throw new Error("don't know how to share keys for this request yet")}};e.exports.IncomingRoomKeyRequest=ae;var se=function e(t){"use strict";(0,a.default)(this,e),(0,v.default)(this,"userId",void 0),(0,v.default)(this,"deviceId",void 0),(0,v.default)(this,"requestId",void 0);var r=t.getContent();this.userId=t.getSender(),this.deviceId=r.requesting_device_id,this.requestId=r.request_id}})),n.register("kdObl",(function(e,t){var i=n("Yawv5"),o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("cksMj"),l=n("9oGi2"),c=n("hcUaE"),d=n("giCK6"),f=n("eQNFO"),h=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WITHHELD_MESSAGES=e.exports.PayloadTooLargeError=e.exports.OlmDevice=void 0;var p=h(n("3rHpI")),v=n("jtqeE"),g=n("8A6lK"),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=y(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e9CEv"));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(y=function(e){return e?r:t})(e)}var b=function(e){(0,u.default)(r,e);var t=(0,d.default)(r);function r(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];var s;return(0,a.default)(this,r),s=t.call.apply(t,[this].concat((0,l.default)(n))),(0,p.default)((0,i.default)(s),"data",{errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"}),s}return r}((0,c.default)(Error));function _(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152)throw new b("Message too long (".concat(e.length," bytes). ")+"The maximum for an encrypted message is ".concat(49152," bytes."))}e.exports.PayloadTooLargeError=b;var w=function(){function e(t){(0,a.default)(this,e),this.cryptoStore=t,(0,p.default)(this,"pickleKey","DEFAULT_KEY"),(0,p.default)(this,"deviceCurve25519Key",null),(0,p.default)(this,"deviceEd25519Key",null),(0,p.default)(this,"maxOneTimeKeys",null),(0,p.default)(this,"outboundGroupSessionStore",{}),(0,p.default)(this,"inboundGroupSessionMessageIndexes",{}),(0,p.default)(this,"sessionsInProgress",{}),(0,p.default)(this,"olmPrekeyPromise",Promise.resolve())}return(0,s.default)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pickleKey,n=e.fromExportedDevice,i=this;return(0,o.default)((function(){var e,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:o=new r.Olm.Account,a.label=1;case 1:return a.trys.push([1,,6,7]),n?(t&&v.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),i.pickleKey=n.pickleKey,[4,i.initialiseFromExportedDevice(n,o)]):[3,3];case 2:return a.sent(),[3,5];case 3:return t&&(i.pickleKey=t),[4,i.initialiseAccount(o)];case 4:a.sent(),a.label=5;case 5:return e=JSON.parse(o.identity_keys()),i.maxOneTimeKeys=o.max_number_of_one_time_keys(),[3,7];case 6:return o.free(),[7];case 7:return i.deviceCurve25519Key=e.curve25519,i.deviceEd25519Key=e.ed25519,[2]}}))}))()}},{key:"initialiseFromExportedDevice",value:function(e,t){var r=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],(function(t){r.cryptoStore.storeAccount(t,e.pickledAccount),e.sessions.forEach((function(e){var n=e.deviceKey,i=e.sessionId,o={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};r.cryptoStore.storeEndToEndSession(n,i,o,t)}))}))];case 1:return n.sent(),t.unpickle(r.pickleKey,e.pickledAccount),[2]}}))}))()}},{key:"initialiseAccount",value:function(e){var t=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(r){t.cryptoStore.getAccount(r,(function(n){null!==n?e.unpickle(t.pickleKey,n):(e.create(),n=e.pickle(t.pickleKey),t.cryptoStore.storeAccount(r,n))}))}))];case 1:return r.sent(),[2]}}))}))()}},{key:"getAccount",value:function(e,t){var n=this;this.cryptoStore.getAccount(e,(function(e){var i=new r.Olm.Account;try{i.unpickle(n.pickleKey,e),t(i)}finally{i.free()}}))}},{key:"storeAccount",value:function(e,t){this.cryptoStore.storeAccount(e,t.pickle(this.pickleKey))}},{key:"export",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return t={pickleKey:e.pickleKey},[4,e.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],(function(r){e.cryptoStore.getAccount(r,(function(e){t.pickledAccount=e})),t.sessions=[],e.cryptoStore.getAllEndToEndSessions(r,(function(e){t.sessions.push(e)}))}))];case 1:return r.sent(),[2,t]}}))}))()}},{key:"getSession",value:function(e,t,r,n){var i=this;this.cryptoStore.getEndToEndSession(e,t,r,(function(e){i.unpickleSession(e,n)}))}},{key:"unpickleSession",value:function(e,t){var n=new r.Olm.Session;try{n.unpickle(this.pickleKey,e.session),t(Object.assign({},e,{session:n}))}finally{n.free()}}},{key:"saveSession",value:function(e,t,r){var n=t.session.session_id(),i=Object.assign(t,{session:t.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,n,i,r)}},{key:"getUtility",value:function(e){var t=new r.Olm.Utility;try{return e(t)}finally{t.free()}}},{key:"sign",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(n){t.getAccount(n,(function(t){r=t.sign(e)}))}))];case 1:return n.sent(),[2,r]}}))}))()}},{key:"getOneTimeKeys",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(r){e.getAccount(r,(function(e){t=JSON.parse(e.one_time_keys())}))}))];case 1:return r.sent(),[2,t]}}))}))()}},{key:"maxNumberOfOneTimeKeys",value:function(){var e;return null!==(e=this.maxOneTimeKeys)&&void 0!==e?e:-1}},{key:"markKeysAsPublished",value:function(){var e=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.getAccount(t,(function(r){r.mark_keys_as_published(),e.storeAccount(t,r)}))}))];case 1:return t.sent(),[2]}}))}))()}},{key:"generateOneTimeKeys",value:function(e){var t=this;return this.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(r){t.getAccount(r,(function(n){n.generate_one_time_keys(e),t.storeAccount(r,n)}))}))}},{key:"generateFallbackKey",value:function(){var e=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.getAccount(t,(function(r){r.generate_fallback_key(),e.storeAccount(t,r)}))}))];case 1:return t.sent(),[2]}}))}))()}},{key:"getFallbackKey",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(r){e.getAccount(r,(function(e){t=JSON.parse(e.unpublished_fallback_key())}))}))];case 1:return r.sent(),[2,t]}}))}))()}},{key:"forgetOldFallbackKey",value:function(){var e=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.getAccount(t,(function(r){r.forget_old_fallback_key(),e.storeAccount(t,r)}))}))];case 1:return t.sent(),[2]}}))}))()}},{key:"createOutboundSession",value:function(e,t){var n=this;return(0,o.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,n.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],(function(o){n.getAccount(o,(function(a){var s=new r.Olm.Session;try{s.create_outbound(a,e,t),i=s.session_id(),n.storeAccount(o,a);var u={session:s,lastReceivedMessageTs:Date.now()};n.saveSession(e,u,o)}finally{s.free()}}))}),v.logger.withPrefix("[createOutboundSession]"))];case 1:return o.sent(),[2,i]}}))}))()}},{key:"createInboundSession",value:function(e,t,n){var i=this;return(0,o.default)((function(){var o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:if(0!==t)throw new Error("Need messageType == 0 to create inbound session");return[4,i.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT,g.IndexedDBCryptoStore.STORE_SESSIONS],(function(a){i.getAccount(a,(function(s){var u=new r.Olm.Session;try{u.create_inbound_from(s,e,n),s.remove_one_time_keys(u),i.storeAccount(a,s);var l=u.decrypt(t,n),c={session:u,lastReceivedMessageTs:Date.now()};i.saveSession(e,c,a),o={payload:l,session_id:u.session_id()}}finally{u.free()}}))}),v.logger.withPrefix("[createInboundSession]"))];case 1:return a.sent(),[2,o]}}))}))()}},{key:"getSessionIdsForDevice",value:function(e){var t=this;return(0,o.default)((function(){var r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:if(r=v.logger.withPrefix("[getSessionIdsForDevice]"),!(e in t.sessionsInProgress))return[3,4];r.debug("Waiting for Olm session for ".concat(e," to be created")),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.sessionsInProgress[e]];case 2:return i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:return[4,t.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SESSIONS],(function(r){t.cryptoStore.getEndToEndSessions(e,r,(function(e){n=Object.keys(e)}))}),r)];case 5:return i.sent(),[2,n]}}))}))()}},{key:"getSessionIdForDevice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=this;return(0,o.default)((function(){var i,o,a,s,u,l,c;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:return[4,n.getSessionInfoForDevice(e,t,r)];case 1:if(0===(i=d.sent()).length)return[2,null];for(o=0,a=1;a<i.length;a++)s=i[a],u=void 0===s.lastReceivedMessageTs?0:s.lastReceivedMessageTs,l=i[o],c=void 0===l.lastReceivedMessageTs?0:l.lastReceivedMessageTs,(u>c||u===c&&s.sessionId<l.sessionId)&&(o=a);return[2,i[o].sessionId]}}))}))()}},{key:"getSessionInfoForDevice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.logger,n=this;return(0,o.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:if(r=r.withPrefix("[getSessionInfoForDevice]"),!(e in n.sessionsInProgress)||t)return[3,4];r.debug("Waiting for Olm session for ".concat(e," to be created")),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.sessionsInProgress[e]];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return i=[],[4,n.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SESSIONS],(function(t){n.cryptoStore.getEndToEndSessions(e,t,(function(e){var t=Object.keys(e).sort(),r=!0,o=!1,a=void 0;try{for(var s,u=function(){var t=s.value;n.unpickleSession(e[t],(function(e){i.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:t})}))},l=t[Symbol.iterator]();!(r=(s=l.next()).done);r=!0)u()}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}}))}),r)];case 5:return o.sent(),[2,i]}}))}))()}},{key:"encryptMessage",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return _(r),[4,n.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_SESSIONS],(function(o){n.getSession(e,t,o,(function(a){var s=a.session.describe();v.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+s),i=a.session.encrypt(r),n.saveSession(e,a,o)}))}),v.logger.withPrefix("[encryptMessage]"))];case 1:return o.sent(),[2,i]}}))}))()}},{key:"decryptMessage",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return[4,i.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_SESSIONS],(function(a){i.getSession(e,t,a,(function(s){var u=s.session.describe();v.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+u),o=s.session.decrypt(r,n),s.lastReceivedMessageTs=Date.now(),i.saveSession(e,s,a)}))}),v.logger.withPrefix("[decryptMessage]"))];case 1:return a.sent(),[2,o]}}))}))()}},{key:"matchesSession",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return 0!==r?[2,!1]:[4,i.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SESSIONS],(function(r){i.getSession(e,t,r,(function(e){o=e.session.matches_inbound(n)}))}),v.logger.withPrefix("[matchesSession]"))];case 1:return a.sent(),[2,o]}}))}))()}},{key:"recordSessionProblem",value:function(e,t,r){var n=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return v.logger.info("Recording problem on olm session with ".concat(e," of type ").concat(t,". Recreating: ").concat(r)),[4,n.cryptoStore.storeEndToEndSessionProblem(e,t,r)];case 1:return i.sent(),[2]}}))}))()}},{key:"sessionMayHaveProblems",value:function(e,t){return this.cryptoStore.getEndToEndSessionProblem(e,t)}},{key:"filterOutNotifiedErrorDevices",value:function(e){return this.cryptoStore.filterOutNotifiedErrorDevices(e)}},{key:"saveOutboundGroupSession",value:function(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}},{key:"getOutboundGroupSession",value:function(e,t){var n=this.outboundGroupSessionStore[e];if(void 0===n)throw new Error("Unknown outbound group session "+e);var i=new r.Olm.OutboundGroupSession;try{return i.unpickle(this.pickleKey,n),t(i)}finally{i.free()}}},{key:"createOutboundGroupSession",value:function(){var e=new r.Olm.OutboundGroupSession;try{return e.create(),this.saveOutboundGroupSession(e),e.session_id()}finally{e.free()}}},{key:"encryptGroupMessage",value:function(e,t){var r=this;return v.logger.log("encrypting msg with megolm session ".concat(e)),_(t),this.getOutboundGroupSession(e,(function(e){var n=e.encrypt(t);return r.saveOutboundGroupSession(e),n}))}},{key:"getOutboundGroupSessionKey",value:function(e){return this.getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))}},{key:"unpickleInboundGroupSession",value:function(e,t){var n=new r.Olm.InboundGroupSession;try{return n.unpickle(this.pickleKey,e.session),t(n)}finally{n.free()}}},{key:"getInboundGroupSession",value:function(e,t,r,n,i){var o=this;this.cryptoStore.getEndToEndInboundGroupSession(t,r,n,(function(t,r){if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");o.unpickleInboundGroupSession(t,(function(e){i(e,t,r)}))}else i(null,null,r)}))}},{key:"addInboundGroupSession",value:function(e,t,n,i,a,s,u){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,c.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,g.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(function(o){c.getInboundGroupSession(e,t,i,o,(function(d,f){var h=new r.Olm.InboundGroupSession;try{if(u?h.import_session(a):h.create(a),i!=h.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(d&&(v.logger.log("Update for megolm session ".concat(t,"|").concat(i)),d.first_known_index()<=h.first_known_index())){if(!f.untrusted||l.untrusted)return void v.logger.log("Keeping existing megolm session ".concat(t,"|").concat(i));if(d.first_known_index()<h.first_known_index())return void(d.export_session(h.first_known_index())===h.export_session(h.first_known_index())?(v.logger.info("Upgrading trust of existing megolm session "+"".concat(t,"|").concat(i," based on newly-received trusted session")),f.untrusted=!1,c.cryptoStore.storeEndToEndInboundGroupSession(t,i,f,o)):v.logger.warn("Newly-received megolm session ".concat(t,"|$sessionId}")+" does not match existing session! Keeping existing session"))}v.logger.info("Storing megolm session ".concat(t,"|").concat(i," with first index ")+h.first_known_index());var p=Object.assign({},l,{room_id:e,session:h.pickle(c.pickleKey),keysClaimed:s,forwardingCurve25519KeyChain:n});c.cryptoStore.storeEndToEndInboundGroupSession(t,i,p,o),!d&&l.sharedHistory&&c.cryptoStore.addSharedHistoryInboundGroupSession(e,t,i,o)}finally{h.free()}}))}),v.logger.withPrefix("[addInboundGroupSession]"))];case 1:return o.sent(),[2]}}))}))()}},{key:"addInboundGroupSessionWithheld",value:function(e,t,r,n,i){var a=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(o){a.cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,r,{room_id:e,code:n,reason:i},o)}))];case 1:return o.sent(),[2]}}))}))()}},{key:"decryptGroupMessage",value:function(e,t,r,n,i,a){var s=this;return(0,o.default)((function(){var o,u;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:return o=null,[4,s.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(l){s.getInboundGroupSession(e,t,r,l,(function(e,c,d){if(null===e||null===c)return d&&(u=new m.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",E(d),{session:t+"|"+r})),void(o=null);var f;try{f=e.decrypt(n)}catch(e){return void(u="OLM.UNKNOWN_MESSAGE_INDEX"===(null==e?void 0:e.message)&&d?new m.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",E(d),{session:t+"|"+r}):e)}var h=f.plaintext;if(void 0===h)h=f;else{var p=t+"|"+r+"|"+f.message_index;if(p in s.inboundGroupSessionMessageIndexes){var v=s.inboundGroupSessionMessageIndexes[p];if(v.id!==i||v.timestamp!==a)return void(u=new Error("Duplicate message index, possible replay attack: "+p))}s.inboundGroupSessionMessageIndexes[p]={id:i,timestamp:a}}c.session=e.pickle(s.pickleKey),s.cryptoStore.storeEndToEndInboundGroupSession(t,r,c,l),o={result:h,keysClaimed:c.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:c.forwardingCurve25519KeyChain||[],untrusted:!!c.untrusted}}))}),v.logger.withPrefix("[decryptGroupMessage]"))];case 1:if(l.sent(),u)throw u;return[2,o]}}))}))()}},{key:"hasInboundSessionKeys",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,n.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(o){n.cryptoStore.getEndToEndInboundGroupSession(t,r,o,(function(n){null!==n?e!==n.room_id?(v.logger.warn("requested keys for inbound group session ".concat(t,"|")+"".concat(r,", with incorrect room_id ")+"(expected ".concat(n.room_id,", ")+"was ".concat(e,")")),i=!1):i=!0:i=!1}))}),v.logger.withPrefix("[hasInboundSessionKeys]"))];case 1:return o.sent(),[2,i]}}))}))()}},{key:"getInboundGroupSessionKey",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return o=null,[4,i.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,g.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(function(a){i.getInboundGroupSession(e,t,r,a,(function(e,t){if(null!==e&&null!==t){void 0===n&&(n=e.first_known_index());var r=e.export_session(n),i=(t.keysClaimed||{}).ed25519||null,a=t.forwardingCurve25519KeyChain||[],s="untrusted"in t?t.untrusted:a.length>0;o={chain_index:n,key:r,forwarding_curve25519_key_chain:a,sender_claimed_ed25519_key:i,shared_history:t.sharedHistory||!1,untrusted:s}}else o=null}))}),v.logger.withPrefix("[getInboundGroupSessionKey]"))];case 1:return a.sent(),[2,o]}}))}))()}},{key:"exportInboundGroupSession",value:function(e,t,r){return this.unpickleInboundGroupSession(r,(function(n){var i=n.first_known_index();return{sender_key:e,sender_claimed_keys:r.keysClaimed,room_id:r.room_id,session_id:t,session_key:n.export_session(i),forwarding_curve25519_key_chain:r.forwardingCurve25519KeyChain||[],first_known_index:n.first_known_index(),"org.matrix.msc3061.shared_history":r.sharedHistory||!1}}))}},{key:"getSharedHistoryInboundGroupSessions",value:function(e){var t=this;return(0,o.default)((function(){var r;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.cryptoStore.doTxn("readonly",[g.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(function(n){r=t.cryptoStore.getSharedHistoryInboundGroupSessions(e,n)}),v.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]"))];case 1:return n.sent(),[2,r]}}))}))()}},{key:"verifySignature",value:function(e,t,r){this.getUtility((function(n){n.ed25519_verify(e,t,r)}))}}],[{key:"getOlmVersion",value:function(){return r.Olm.get_library_version()}}]),e}();e.exports.OlmDevice=w;var S={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function E(e){return e.code&&e.code in S?S[e.code]:e.reason?e.reason:"decryption key withheld"}e.exports.WITHHELD_MESSAGES=S})),n.register("e9CEv",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),n("iQuYR"),n("kKi5e");var r=n("dnQsz");Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===r[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return r[t]}}))}))})),n.register("iQuYR",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("9oGi2"),l=n("giCK6"),c=n("eQNFO"),d=n("fyjrC")(n("3rHpI")),f=n("jtqeE"),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("dbGKv")),p=n("1fjoF"),v=n("dnQsz");function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}var m=p.DeviceInfo.DeviceVerification,y=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var s;return(0,o.default)(this,n),s=t.call.apply(t,[this].concat((0,u.default)(i))),(0,d.default)((0,r.default)(s),"sessionPrepared",!1),(0,d.default)((0,r.default)(s),"prepPromise",null),s}return(0,a.default)(n,[{key:"ensureSession",value:function(e){var t=this;return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((function(){return t.crypto.ensureOlmSessionsForUsers(e)})).then((function(){t.sessionPrepared=!0})).finally((function(){t.prepPromise=null})),this.prepPromise)}},{key:"encryptMessage",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,s,u,l,d,f,p,v,g,y,b,_,w,S,E,k;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return[4,e.getEncryptionTargetMembers()];case 1:return i=c.sent(),o=i.map((function(e){return e.userId})),[4,n.ensureSession(o)];case 2:c.sent(),a={room_id:e.roomId,type:t,content:r},s={algorithm:h.OLM_ALGORITHM,sender_key:n.olmDevice.deviceCurve25519Key,ciphertext:{}},u=[],l=!0,d=!1,f=void 0;try{for(p=o[Symbol.iterator]();!(l=(v=p.next()).done);l=!0){g=v.value,y=n.crypto.getStoredDevicesForUser(g)||[],b=!0,_=!1,w=void 0;try{for(S=y[Symbol.iterator]();!(b=(E=S.next()).done);b=!0)k=E.value,k.getIdentityKey()!=n.olmDevice.deviceCurve25519Key&&k.verified!=m.BLOCKED&&u.push(h.encryptMessageForDevice(s.ciphertext,n.userId,n.deviceId,n.olmDevice,g,k,a))}catch(e){_=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(_)throw w}}}}catch(e){d=!0,f=e}finally{try{l||null==p.return||p.return()}finally{if(d)throw f}}return[2,Promise.all(u).then((function(){return s}))]}}))}))()}}]),n}(v.EncryptionAlgorithm),b=function(e){(0,s.default)(r,e);var t=(0,l.default)(r);function r(){return(0,o.default)(this,r),t.apply(this,arguments)}return(0,a.default)(r,[{key:"decryptEvent",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,l,d;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(r=e.getWireContent(),n=r.sender_key,!(i=r.ciphertext))throw new v.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(t.olmDevice.deviceCurve25519Key in i))throw new v.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");o=i[t.olmDevice.deviceCurve25519Key],c.label=1;case 1:return c.trys.push([1,3,,4]),[4,t.decryptMessage(n,o)];case 2:return a=c.sent(),[3,4];case 3:throw s=c.sent(),new v.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:n,err:s});case 4:if((u=JSON.parse(a)).recipient!=t.userId)throw new v.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+u.recipient);if(u.recipient_keys.ed25519!=t.olmDevice.deviceEd25519Key)throw new v.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:u.recipient_keys.ed25519,our_key:t.olmDevice.deviceEd25519Key});return[4,t.crypto.deviceList.downloadKeys([e.getSender()],!1)];case 5:if(c.sent(),(l=t.crypto.deviceList.getUserByIdentityKey(h.OLM_ALGORITHM,n))!==e.getSender()&&null!=l)throw new v.DecryptionError("OLM_BAD_SENDER","Message claimed to be from "+e.getSender(),{real_sender:l});if(u.sender!=e.getSender())throw new v.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+u.sender,{reported_sender:e.getSender()});if(u.room_id!==e.getRoomId())throw new v.DecryptionError("OLM_BAD_ROOM","Message intended for room "+u.room_id,{reported_room:e.getRoomId()||"ROOM_ID_UNDEFINED"});return d=u.keys||{},[2,{clearEvent:u,senderCurve25519Key:n,claimedEd25519Key:d.ed25519||null}]}}))}))()}},{key:"decryptMessage",value:function(e,t){var r=this;if(0!==t.type)return this.reallyDecryptMessage(e,t);var n=this.olmDevice.olmPrekeyPromise.then((function(){return r.reallyDecryptMessage(e,t)}));return this.olmDevice.olmPrekeyPromise=n.catch((function(){})),n}},{key:"reallyDecryptMessage",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,d,h,p,v,g,m;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return[4,r.olmDevice.getSessionIdsForDevice(e)];case 1:n=c.sent(),i={},o=!0,a=!1,s=void 0,c.label=2;case 2:c.trys.push([2,10,11,12]),u=n[Symbol.iterator](),c.label=3;case 3:if(o=(l=u.next()).done)return[3,9];d=l.value,c.label=4;case 4:return c.trys.push([4,6,,8]),[4,r.olmDevice.decryptMessage(e,d,t.type,t.body)];case 5:return h=c.sent(),f.logger.log("Decrypted Olm message from "+e+" with session "+d),[2,h];case 6:return p=c.sent(),[4,r.olmDevice.matchesSession(e,d,t.type,t.body)];case 7:if(c.sent())throw new Error("Error decrypting prekey message with existing session id "+d+": "+p.message);return i[d]=p.message,[3,8];case 8:return o=!0,[3,3];case 9:return[3,12];case 10:return v=c.sent(),a=!0,s=v,[3,12];case 11:try{o||null==u.return||u.return()}finally{if(a)throw s}return[7];case 12:if(0!==t.type){if(0===n.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(i))}c.label=13;case 13:return c.trys.push([13,15,,16]),[4,r.olmDevice.createInboundSession(e,t.type,t.body)];case 14:return g=c.sent(),[3,16];case 15:throw m=c.sent(),i["(new)"]=m.message,new Error("Error decrypting prekey message: "+JSON.stringify(i));case 16:return f.logger.log("created new inbound Olm session ID "+g.session_id+" with "+e),[2,g.payload]}}))}))()}}]),r}(v.DecryptionAlgorithm);(0,v.registerAlgorithm)(h.OLM_ALGORITHM,y,b)})),n.register("dnQsz",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("hcUaE"),l=n("giCK6"),c=n("eQNFO"),d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnknownDeviceError=e.exports.EncryptionAlgorithm=e.exports.ENCRYPTION_CLASSES=e.exports.DecryptionError=e.exports.DecryptionAlgorithm=e.exports.DECRYPTION_CLASSES=void 0,e.exports.registerAlgorithm=function(e,t,r){h.set(e,t),p.set(e,r)};var f=d(n("3rHpI")),h=new Map;e.exports.ENCRYPTION_CLASSES=h;var p=new Map;e.exports.DECRYPTION_CLASSES=p;var v=function(){function e(t){(0,o.default)(this,e),(0,f.default)(this,"userId",void 0),(0,f.default)(this,"deviceId",void 0),(0,f.default)(this,"crypto",void 0),(0,f.default)(this,"olmDevice",void 0),(0,f.default)(this,"baseApis",void 0),(0,f.default)(this,"roomId",void 0),this.userId=t.userId,this.deviceId=t.deviceId,this.crypto=t.crypto,this.olmDevice=t.olmDevice,this.baseApis=t.baseApis,this.roomId=t.roomId}return(0,a.default)(e,[{key:"prepareToEncrypt",value:function(e){}},{key:"onRoomMembership",value:function(e,t,r){}}]),e}();e.exports.EncryptionAlgorithm=v;var g=function(){function e(t){(0,o.default)(this,e),(0,f.default)(this,"userId",void 0),(0,f.default)(this,"crypto",void 0),(0,f.default)(this,"olmDevice",void 0),(0,f.default)(this,"baseApis",void 0),(0,f.default)(this,"roomId",void 0),this.userId=t.userId,this.crypto=t.crypto,this.olmDevice=t.olmDevice,this.baseApis=t.baseApis,this.roomId=t.roomId}return(0,a.default)(e,[{key:"onRoomKeyEvent",value:function(e){return(0,i.default)((function(){return(0,c.__generator)(this,(function(e){return[2]}))}))()}},{key:"importRoomKey",value:function(e,t){return(0,i.default)((function(){return(0,c.__generator)(this,(function(e){return[2]}))}))()}},{key:"hasKeysForKeyRequest",value:function(e){return Promise.resolve(!1)}},{key:"shareKeysWithDevice",value:function(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}},{key:"retryDecryptionFromSender",value:function(e){return(0,i.default)((function(){return(0,c.__generator)(this,(function(e){return[2,!1]}))}))()}}]),e}();e.exports.DecryptionAlgorithm=g;var m=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(e,i,a){var s;return(0,o.default)(this,n),(s=t.call(this,i)).code=e,(0,f.default)((0,r.default)(s),"detailedString",void 0),s.code=e,s.name="DecryptionError",s.detailedString=function(e,t){var r=e.name+"[msg: "+e.message;t&&(r+=", "+Object.keys(t).map((function(e){return e+": "+t[e]})).join(", "));return r+="]"}((0,r.default)(s),a),s}return n}((0,u.default)(Error));e.exports.DecryptionError=m;var y=function(e){(0,s.default)(r,e);var t=(0,l.default)(r);function r(e,n,i){var a;return(0,o.default)(this,r),(a=t.call(this,e)).devices=n,a.event=i,a.name="UnknownDeviceError",a.devices=n,a}return r}((0,u.default)(Error));e.exports.UnknownDeviceError=y})),n.register("kKi5e",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("cksMj"),l=n("mBz5n"),c=n("9oGi2"),d=n("giCK6"),f=n("eQNFO"),h=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MegolmEncryption=e.exports.MegolmDecryption=void 0,e.exports.isRoomSharedHistory=M;var p=h(n("3rHpI")),v=n("329cj"),g=n("jtqeE"),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=S(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("dbGKv")),y=n("dnQsz"),b=n("kdObl"),_=n("8bPbt"),w=n("8WN5v");function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(S=function(e){return e?r:t})(e)}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,p.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e){var t,r,n=null==e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),i=null==n||null===(r=n.getContent())||void 0===r?void 0:r.history_visibility;return["world_readable","shared"].includes(i)}var C=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,o.default)(this,e),this.sessionId=t,this.sharedHistory=r,(0,p.default)(this,"useCount",0),(0,p.default)(this,"creationTime",void 0),(0,p.default)(this,"sharedWithDevices",{}),(0,p.default)(this,"blockedDevicesNotified",{}),this.creationTime=(new Date).getTime()}return(0,a.default)(e,[{key:"needsRotation",value:function(e,t){var r=(new Date).getTime()-this.creationTime;return(this.useCount>=e||r>=t)&&(g.logger.log("Rotating megolm session after "+this.useCount+" messages, "+r+"ms"),!0)}},{key:"markSharedWithDevice",value:function(e,t,r,n){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]={deviceKey:r,messageIndex:n}}},{key:"markNotifiedBlockedDevice",value:function(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0}},{key:"sharedWithTooManyDevices",value:function(e){for(var t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return g.logger.log("Starting new megolm session because we shared with "+t),!0;for(var r in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(r)&&!e[t].hasOwnProperty(r))return g.logger.log("Starting new megolm session because we shared with "+t+":"+r),!0}return!1}}]),e}(),I=function(e){(0,u.default)(n,e);var t=(0,d.default)(n);function n(e){var i,a,s,u,l;return(0,o.default)(this,n),i=t.call(this,e),(0,p.default)((0,r.default)(i),"setupPromise",Promise.resolve(null)),(0,p.default)((0,r.default)(i),"outboundSessions",{}),(0,p.default)((0,r.default)(i),"sessionRotationPeriodMsgs",void 0),(0,p.default)((0,r.default)(i),"sessionRotationPeriodMs",void 0),(0,p.default)((0,r.default)(i),"encryptionPreparation",void 0),(0,p.default)((0,r.default)(i),"roomId",void 0),i.roomId=e.roomId,i.sessionRotationPeriodMsgs=null!==(a=null===(s=e.config)||void 0===s?void 0:s.rotation_period_msgs)&&void 0!==a?a:100,i.sessionRotationPeriodMs=null!==(u=null===(l=e.config)||void 0===l?void 0:l.rotation_period_ms)&&void 0!==u?u:6048e5,i}return(0,a.default)(n,[{key:"ensureOutboundSession",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this;return(0,i.default)((function(){var a,s;return(0,f.__generator)(this,(function(u){var l;return l=(0,i.default)((function(i){var a,s;return(0,f.__generator)(this,(function(u){switch(u.label){case 0:return a=M(e),[4,o.prepareSession(t,a,i)];case 1:return s=u.sent(),[4,o.shareSession(t,a,n,r,s)];case 2:return u.sent(),[2,s]}}))})),a=function(e){return l.apply(this,arguments)},s=o.setupPromise.then(a),o.setupPromise=s.catch((function(e){return g.logger.error("Failed to setup outbound session in ".concat(o.roomId),e),null})),[2,s]}))}))()}},{key:"prepareSession",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return r&&t!==r.sharedHistory&&(r=null),null!==(i=r)&&void 0!==i&&i.needsRotation(n.sessionRotationPeriodMsgs,n.sessionRotationPeriodMs)&&(g.logger.log("Starting new megolm session because we need to rotate."),r=null),null!==(o=r)&&void 0!==o&&o.sharedWithTooManyDevices(e)&&(r=null),r?[3,2]:(g.logger.log("Starting new megolm session for room ".concat(n.roomId)),[4,n.prepareNewSession(t)]);case 1:r=a.sent(),g.logger.log("Started new megolm session ".concat(r.sessionId," ")+"for room ".concat(n.roomId)),n.outboundSessions[r.sessionId]=r,a.label=2;case 2:return[2,r]}}))}))()}},{key:"shareSession",value:function(e,t,r,n,o){var a=this;return(0,i.default)((function(){var s,u,c,d,h,p,v,y,b,_,w,S,E,k,M,C,I,T,R,x,O,A;return(0,f.__generator)(this,(function(D){switch(D.label){case 0:s={},u=!0,c=!1,d=void 0,h=!0,p=!1,v=void 0;try{for(y=Object.entries(e)[Symbol.iterator]();!(h=(b=y.next()).done);h=!0){_=(0,l.default)(b.value,2),w=_[0],S=_[1];try{for(E=Object.entries(S)[Symbol.iterator]();!(u=(k=E.next()).done);u=!0)M=(0,l.default)(k.value,2),C=M[0],I=M[1],I.getIdentityKey()!=a.olmDevice.deviceCurve25519Key&&(o.sharedWithDevices[w]&&void 0!==o.sharedWithDevices[w][C]||(s[w]=s[w]||[],s[w].push(I)))}catch(e){c=!0,d=e}finally{try{u||null==E.return||E.return()}finally{if(c)throw d}}}}catch(e){p=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw v}}return T=a.olmDevice.getOutboundGroupSessionKey(o.sessionId),R={type:"m.room_key",content:{algorithm:m.MEGOLM_ALGORITHM,room_id:a.roomId,session_id:o.sessionId,session_key:T.key,chain_index:T.chain_index,"org.matrix.msc3061.shared_history":t}},[4,m.getExistingOlmSessions(a.olmDevice,a.baseApis,s)];case 1:return x=l.default.apply(void 0,[D.sent(),2]),O=x[0],A=x[1],[4,Promise.all([(0,i.default)((function(){return(0,f.__generator)(this,(function(e){switch(e.label){case 0:return g.logger.debug("Sharing keys with existing Olm sessions in ".concat(a.roomId),A),[4,a.shareKeyWithOlmSessions(o,T,R,A)];case 1:return e.sent(),g.logger.debug("Shared keys with existing Olm sessions in ".concat(a.roomId)),[2]}}))}))(),(0,i.default)((function(){var e,t,n;return(0,f.__generator)(this,(function(s){switch(s.label){case 0:return g.logger.debug("Sharing keys (start phase 1) with new Olm sessions in ".concat(a.roomId),O),e=[],t=Date.now(),n=[],[4,a.shareKeyWithDevices(o,T,R,O,e,r?1e4:2e3,n)];case 1:return s.sent(),g.logger.debug("Shared keys (end phase 1) with new Olm sessions in ".concat(a.roomId)),!r&&Date.now()-t<1e4?((0,i.default)((function(){var t,r,i,s,u,l,c,d,h,p,v,m,y,b,_,w,S,E;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:t={},r=new Set,i=!0,s=!1,u=void 0;try{for(l=n[Symbol.iterator]();!(i=(c=l.next()).done);i=!0)d=c.value,r.add(d)}catch(e){s=!0,u=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw u}}h=[],p=!0,v=!1,m=void 0;try{for(y=e[Symbol.iterator]();!(p=(b=y.next()).done);p=!0)_=b.value,w=_.userId,S=_.deviceInfo,E=w.slice(w.indexOf(":")+1),r.has(E)?(t[w]=t[w]||[],t[w].push(S)):h.push({userId:w,deviceInfo:S})}catch(e){v=!0,m=e}finally{try{p||null==y.return||y.return()}finally{if(v)throw m}}return g.logger.debug("Sharing keys (start phase 2) with new Olm sessions in ".concat(a.roomId)),[4,a.shareKeyWithDevices(o,T,R,t,h,3e4)];case 1:return f.sent(),g.logger.debug("Shared keys (end phase 2) with new Olm sessions in ".concat(a.roomId)),[4,a.notifyFailedOlmDevices(o,T,h)];case 2:return f.sent(),[2]}}))}))(),[3,4]):[3,2];case 2:return[4,a.notifyFailedOlmDevices(o,T,e)];case 3:s.sent(),s.label=4;case 4:return g.logger.debug("Shared keys (all phases done) with new Olm sessions in ".concat(a.roomId)),[2]}}))}))(),(0,i.default)((function(){var e,t,r,i,s,u,c,d,h,p,v,m,y,b,_,w,S,E;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:g.logger.debug("There are ".concat(Object.entries(n).length," blocked devices in ").concat(a.roomId),Object.entries(n)),g.logger.debug("Notifying newly blocked devices in ".concat(a.roomId)),e={},t=0,r=!0,i=!1,s=void 0;try{for(u=Object.entries(n)[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){d=(0,l.default)(c.value,2),h=d[0],p=d[1],v=!0,m=!1,y=void 0;try{for(b=Object.entries(p)[Symbol.iterator]();!(v=(_=b.next()).done);v=!0)w=(0,l.default)(_.value,2),S=w[0],E=w[1],o.blockedDevicesNotified[h]&&void 0!==o.blockedDevicesNotified[h][S]||(e[h]=e[h]||{},e[h][S]={device:E},t++)}catch(e){m=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw y}}}}catch(e){i=!0,s=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw s}}return[4,a.notifyBlockedDevices(o,e)];case 1:return f.sent(),g.logger.debug("Notified ".concat(t," newly blocked devices in ").concat(a.roomId),e),[2]}}))}))()])];case 2:return D.sent(),[2]}}))}))()}},{key:"prepareNewSession",value:function(e){var t=this;return(0,i.default)((function(){var r,n;return(0,f.__generator)(this,(function(i){switch(i.label){case 0:return r=t.olmDevice.createOutboundGroupSession(),n=t.olmDevice.getOutboundGroupSessionKey(r),[4,t.olmDevice.addInboundGroupSession(t.roomId,t.olmDevice.deviceCurve25519Key,[],r,n.key,{ed25519:t.olmDevice.deviceEd25519Key},!1,{sharedHistory:e})];case 1:return i.sent(),t.crypto.backupManager.backupGroupSession(t.olmDevice.deviceCurve25519Key,r),[2,new C(r,e)]}}))}))()}},{key:"getDevicesWithoutSessions",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=!0,i=!1,o=void 0;try{for(var a,s=Object.entries(t)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=(0,l.default)(a.value,2),c=u[0],d=u[1],f=e[c],h=!0,p=!1,v=void 0;try{for(var g,m=d[Symbol.iterator]();!(h=(g=m.next()).done);h=!0){var y=g.value,b=y.deviceId,_=f[b];_.sessionId||(r.push({userId:c,deviceInfo:y}),delete f[b])}}catch(e){p=!0,v=e}finally{try{h||null==m.return||m.return()}finally{if(p)throw v}}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}},{key:"splitDevices",value:function(e){var t=[],r=[t],n=!0,i=!1,o=void 0;try{for(var a,s=Object.entries(e)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=(0,l.default)(a.value,2),c=u[0],d=u[1],f=!0,h=!1,p=void 0;try{for(var v,g=Object.values(d)[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var m=v.value;t.push({userId:c,deviceInfo:m.device})}}catch(e){h=!0,p=e}finally{try{f||null==g.return||g.return()}finally{if(h)throw p}}t.length>20&&(t=[],r.push(t))}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return 0===t.length&&r.pop(),r}},{key:"encryptAndSendKeysToDevices",value:function(e,t,r,n){return this.crypto.encryptAndSendToDevices(r,n).then((function(){var n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;e.markSharedWithDevice(u.userId,u.deviceInfo.deviceId,u.deviceInfo.getIdentityKey(),t)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}})).catch((function(e){throw g.logger.error("failed to encryptAndSendToDevices",e),e}))}},{key:"sendBlockedNotificationsToDevices",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,u,l,c,d,h,p,g,m,y,b,w,S,E,M,C,I,T,R,x,O,A;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:i={},o=!0,a=!1,u=void 0;try{for(l=t[Symbol.iterator]();!(o=(c=l.next()).done);o=!0)d=c.value,h=d.userId,p=d.deviceInfo,g=p.deviceInfo,m=g.deviceId,"m.no_olm"===(y=k(k({},r),{},(0,s.default)({code:p.code,reason:p.reason},_.ToDeviceMessageId,(0,v.default)()))).code&&(delete y.room_id,delete y.session_id),i[h]||(i[h]={}),i[h][m]=y}catch(e){a=!0,u=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw u}}return[4,n.baseApis.sendToDevice("m.room_key.withheld",i)];case 1:f.sent(),b=!0,w=!1,S=void 0,E=!0,M=!1,C=void 0;try{for(I=Object.keys(i)[Symbol.iterator]();!(E=(T=I.next()).done);E=!0){R=T.value;try{for(x=Object.keys(i[R])[Symbol.iterator]();!(b=(O=x.next()).done);b=!0)A=O.value,e.markNotifiedBlockedDevice(R,A)}catch(e){w=!0,S=e}finally{try{b||null==x.return||x.return()}finally{if(w)throw S}}}}catch(e){M=!0,C=e}finally{try{E||null==I.return||I.return()}finally{if(M)throw C}}return[2]}}))}))()}},{key:"reshareKeyWithDevice",value:function(e,t,r,n){var o=this;return(0,i.default)((function(){var i,a,u,l,c;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:return(i=o.outboundSessions[t])?void 0===i.sharedWithDevices[r]?(g.logger.debug("megolm session ".concat(e,"|").concat(t," never shared with user ").concat(r)),[2]):void 0===(a=i.sharedWithDevices[r][n.deviceId])?(g.logger.debug("megolm session ".concat(e,"|").concat(t," never shared with device ").concat(r,":").concat(n.deviceId)),[2]):a.deviceKey!==n.getIdentityKey()?(g.logger.warn("Megolm session ".concat(e,"|").concat(t," has been shared with device ").concat(n.deviceId," but ")+"with identity key ".concat(a.deviceKey,". Key is now ").concat(n.getIdentityKey(),"!")),[2]):[4,o.olmDevice.getInboundGroupSessionKey(o.roomId,e,t,a.messageIndex)]:(g.logger.debug("megolm session ".concat(e,"|").concat(t," not found: not re-sharing keys")),[2]);case 1:return(u=d.sent())?[4,m.ensureOlmSessionsForDevices(o.olmDevice,o.baseApis,(0,s.default)({},r,[n]))]:(g.logger.warn("No inbound session key found for megolm session ".concat(e,"|").concat(t,": not re-sharing keys")),[2]);case 2:return d.sent(),l={type:"m.forwarded_room_key",content:{algorithm:m.MEGOLM_ALGORITHM,room_id:o.roomId,session_id:t,session_key:u.key,chain_index:u.chain_index,sender_key:e,sender_claimed_ed25519_key:u.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:u.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":u.shared_history||!1}},c=(0,s.default)({algorithm:m.OLM_ALGORITHM,sender_key:o.olmDevice.deviceCurve25519Key,ciphertext:{}},_.ToDeviceMessageId,(0,v.default)()),[4,m.encryptMessageForDevice(c.ciphertext,o.userId,o.deviceId,o.olmDevice,r,n,l)];case 3:return d.sent(),[4,o.baseApis.sendToDevice("m.room.encrypted",(0,s.default)({},r,(0,s.default)({},n.deviceId,c)))];case 4:return d.sent(),g.logger.debug("Re-shared key for megolm session ".concat(e,"|").concat(t," with ").concat(r,":").concat(n.deviceId)),[2]}}))}))()}},{key:"shareKeyWithDevices",value:function(e,t,r,n,o,a,s){var u=this;return(0,i.default)((function(){var i,l;return(0,f.__generator)(this,(function(c){switch(c.label){case 0:return g.logger.debug("Ensuring Olm sessions for devices in ".concat(u.roomId)),[4,m.ensureOlmSessionsForDevices(u.olmDevice,u.baseApis,n,!1,a,s,null===(i=g.logger.withPrefix)||void 0===i?void 0:i.call(g.logger,"[".concat(u.roomId,"]")))];case 1:return l=c.sent(),g.logger.debug("Ensured Olm sessions for devices in ".concat(u.roomId)),u.getDevicesWithoutSessions(l,n,o),g.logger.debug("Sharing keys with newly created Olm sessions in ".concat(u.roomId)),[4,u.shareKeyWithOlmSessions(e,t,r,l)];case 2:return c.sent(),g.logger.debug("Shared keys with newly created Olm sessions in ".concat(u.roomId)),[2]}}))}))()}},{key:"shareKeyWithOlmSessions",value:function(e,t,r,n){var o=this;return(0,i.default)((function(){var i,a,s,u;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:i=o.splitDevices(n),a=0,l.label=1;case 1:if(!(a<i.length))return[3,6];s="megolm keys for ".concat(e.sessionId," ")+"in ".concat(o.roomId," (slice ").concat(a+1,"/").concat(i.length,")"),l.label=2;case 2:return l.trys.push([2,4,,5]),g.logger.debug("Sharing ".concat(s),i[a].map((function(e){return"".concat(e.userId,"/").concat(e.deviceInfo.deviceId)}))),[4,o.encryptAndSendKeysToDevices(e,t.chain_index,i[a],r)];case 3:return l.sent(),g.logger.debug("Shared ".concat(s)),[3,5];case 4:throw u=l.sent(),g.logger.error("Failed to share ".concat(s)),u;case 5:return a++,[3,1];case 6:return[2]}}))}))()}},{key:"notifyFailedOlmDevices",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,s,u,l,c,d,h,p,v,m,y,_,w,S,E,k,M;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:g.logger.debug("Notifying ".concat(r.length," devices we failed to ")+"create Olm sessions in ".concat(n.roomId)),i=!0,o=!1,a=void 0;try{for(s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)l=u.value,c=l.userId,d=l.deviceInfo,h=d.deviceId,e.markSharedWithDevice(c,h,d.getIdentityKey(),t.chain_index)}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return[4,n.olmDevice.filterOutNotifiedErrorDevices(r)];case 1:p=f.sent(),g.logger.debug("Need to notify ".concat(p.length," failed devices ")+"which haven't been notified before in ".concat(n.roomId)),v={},m=!0,y=!1,_=void 0;try{for(w=p[Symbol.iterator]();!(m=(S=w.next()).done);m=!0)E=S.value,k=E.userId,M=E.deviceInfo,v[k]=v[k]||{},v[k][M.deviceId]={device:{code:"m.no_olm",reason:b.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:M}}}catch(e){y=!0,_=e}finally{try{m||null==w.return||w.return()}finally{if(y)throw _}}return[4,n.notifyBlockedDevices(e,v)];case 2:return f.sent(),g.logger.debug("Notified ".concat(p.length," devices we failed to ")+"create Olm sessions in ".concat(n.roomId)),[2]}}))}))()}},{key:"notifyBlockedDevices",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a;return(0,f.__generator)(this,(function(s){switch(s.label){case 0:n={room_id:r.roomId,session_id:e.sessionId,algorithm:m.MEGOLM_ALGORITHM,sender_key:r.olmDevice.deviceCurve25519Key},i=r.splitDevices(t),o=0,s.label=1;case 1:if(!(o<i.length))return[3,6];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,r.sendBlockedNotificationsToDevices(e,i[o],n)];case 3:return s.sent(),g.logger.log("Completed blacklist notification for ".concat(e.sessionId," ")+"in ".concat(r.roomId," (slice ").concat(o+1,"/").concat(i.length,")")),[3,5];case 4:throw a=s.sent(),g.logger.log("blacklist notification for ".concat(e.sessionId," in ")+"".concat(r.roomId," (slice ").concat(o+1,"/").concat(i.length,") failed")),a;case 5:return o++,[3,1];case 6:return[2]}}))}))()}},{key:"prepareToEncrypt",value:function(e){if(null==this.encryptionPreparation){g.logger.debug("Preparing to encrypt events for ".concat(this.roomId));var t=this;this.encryptionPreparation={startTime:Date.now(),promise:(0,i.default)((function(){var r,n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,4,5]),g.logger.debug("Getting devices in ".concat(t.roomId)),[4,t.getDevicesInRoom(e)];case 1:return r=l.default.apply(void 0,[a.sent(),2]),n=r[0],i=r[1],t.crypto.globalErrorOnUnknownDevices&&t.removeUnknownDevices(n),g.logger.debug("Ensuring outbound session in ".concat(t.roomId)),[4,t.ensureOutboundSession(e,n,i,!0)];case 2:return a.sent(),g.logger.debug("Ready to encrypt events for ".concat(t.roomId)),[3,5];case 3:return o=a.sent(),g.logger.error("Failed to prepare to encrypt events for ".concat(t.roomId),o),[3,5];case 4:return delete t.encryptionPreparation,[7];case 5:return[2]}}))}))()}}else{var r=Date.now()-this.encryptionPreparation.startTime;g.logger.debug("Already started preparing to encrypt for ".concat(this.roomId," ")+"".concat(r," ms ago, skipping"))}}},{key:"encryptMessage",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,s,u,c,d,h;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:if(g.logger.log("Starting to encrypt event for ".concat(n.roomId)),null==n.encryptionPreparation)return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,n.encryptionPreparation.promise];case 2:return f.sent(),[3,4];case 3:return f.sent(),[3,4];case 4:return i=n.isVerificationEvent(t,r),[4,n.getDevicesInRoom(e,i)];case 5:return o=l.default.apply(void 0,[f.sent(),2]),a=o[0],s=o[1],n.crypto.globalErrorOnUnknownDevices&&n.checkForUnknownDevices(a),[4,n.ensureOutboundSession(e,a,s)];case 6:return u=f.sent(),c={room_id:n.roomId,type:t,content:r},d=n.olmDevice.encryptGroupMessage(u.sessionId,JSON.stringify(c)),h={algorithm:m.MEGOLM_ALGORITHM,sender_key:n.olmDevice.deviceCurve25519Key,ciphertext:d,session_id:u.sessionId,device_id:n.deviceId},u.useCount++,[2,h]}}))}))()}},{key:"isVerificationEvent",value:function(e,t){switch(e){case _.EventType.KeyVerificationCancel:case _.EventType.KeyVerificationDone:case _.EventType.KeyVerificationMac:case _.EventType.KeyVerificationStart:case _.EventType.KeyVerificationKey:case _.EventType.KeyVerificationReady:case _.EventType.KeyVerificationAccept:return!0;case _.EventType.RoomMessage:return t.msgtype===_.MsgType.KeyVerificationRequest;default:return!1}}},{key:"forceDiscardSession",value:function(){this.setupPromise=this.setupPromise.then((function(){return null}))}},{key:"checkForUnknownDevices",value:function(e){var t={};if(Object.keys(e).forEach((function(r){Object.keys(e[r]).forEach((function(n){var i=e[r][n];i.isUnverified()&&!i.isKnown()&&(t[r]||(t[r]={}),t[r][n]=i)}))})),Object.keys(t).length)throw new y.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}},{key:"removeUnknownDevices",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=Object.entries(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,l.default)(i.value,2),s=a[0],u=a[1],c=!0,d=!1,f=void 0;try{for(var h,p=Object.entries(u)[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=(0,l.default)(h.value,2),g=v[0],m=v[1];m.isUnverified()&&!m.isKnown()&&delete u[g]}}catch(e){d=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}0===Object.keys(u).length&&delete e[s]}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"getDevicesInRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,c,d;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return[4,e.getEncryptionTargetMembers()];case 1:return n=f.sent(),i=n.map((function(e){return e.userId})),o=r.crypto.globalBlacklistUnverifiedDevices,"boolean"==typeof(a=e.getBlacklistUnverifiedDevices())&&(o=a),[4,r.crypto.downloadKeys(i,!1)];case 2:for(var h in s=f.sent(),u={},s)if(s.hasOwnProperty(h))for(var p in l=s[h])l.hasOwnProperty(p)&&(c=r.crypto.checkDeviceTrust(h,p),(l[p].isBlocked()||!c.isVerified()&&o&&!t)&&(u[h]||(u[h]={}),d=l[p].isBlocked(),u[h][p]={code:d?"m.blacklisted":"m.unverified",reason:b.WITHHELD_MESSAGES[d?"m.blacklisted":"m.unverified"],deviceInfo:l[p]},delete l[p]));return[2,[s,u]]}}))}))()}}]),n}(y.EncryptionAlgorithm);e.exports.MegolmEncryption=I;var T=function(e){(0,u.default)(n,e);var t=(0,d.default)(n);function n(e){var i;return(0,o.default)(this,n),i=t.call(this,e),(0,p.default)((0,r.default)(i),"pendingEvents",new Map),(0,p.default)((0,r.default)(i),"olmlib",m),(0,p.default)((0,r.default)(i),"roomId",void 0),i.roomId=e.roomId,i}return(0,a.default)(n,[{key:"decryptEvent",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u;return(0,f.__generator)(this,(function(l){switch(l.label){case 0:if(!(r=e.getWireContent()).sender_key||!r.session_id||!r.ciphertext)throw new y.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");t.addEventToPendingList(e),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,t.olmDevice.decryptGroupMessage(e.getRoomId(),r.sender_key,r.session_id,r.ciphertext,e.getId(),e.getTs())];case 2:return n=l.sent(),[3,4];case 3:if("DecryptionError"===(i=l.sent()).name)throw i;throw o="OLM_DECRYPT_GROUP_MESSAGE_ERROR","OLM.UNKNOWN_MESSAGE_INDEX"===(null==i?void 0:i.message)&&(t.requestKeysForEvent(e),o="OLM_UNKNOWN_MESSAGE_INDEX"),new y.DecryptionError(o,i?i.toString():"Unknown Error: Error is undefined",{session:r.sender_key+"|"+r.session_id});case 4:return null!==n?[3,6]:(t.crypto.backupManager.queryKeyBackupRateLimited(e.getRoomId(),r.session_id).catch((function(){})),t.requestKeysForEvent(e),[4,t.olmDevice.sessionMayHaveProblems(r.sender_key,e.getTs()-12e4)]);case 5:if(a=l.sent())throw g.logger.info("When handling UISI from ".concat(e.getSender()," (sender key ").concat(r.sender_key,"): ")+"recent session problem with that sender: ".concat(a)),s=R[a.type]||R.unknown,a.fixed&&(s+=" Trying to create a new secure channel and re-requesting the keys."),new y.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",s,{session:r.sender_key+"|"+r.session_id});throw new y.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:r.sender_key+"|"+r.session_id});case 6:if(n.untrusted||t.removeEventFromPendingList(e),(u=JSON.parse(n.result)).room_id!==e.getRoomId())throw new y.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+u.room_id);return[2,{clearEvent:u,senderCurve25519Key:n.senderKey,claimedEd25519Key:n.keysClaimed.ed25519,forwardingCurve25519KeyChain:n.forwardingCurve25519KeyChain,untrusted:n.untrusted}]}}))}))()}},{key:"requestKeysForEvent",value:function(e){var t=e.getWireContent(),r=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},r)}},{key:"addEventToPendingList",value:function(e){var t,r=e.getWireContent(),n=r.sender_key,i=r.session_id;this.pendingEvents.has(n)||this.pendingEvents.set(n,new Map);var o=this.pendingEvents.get(n);o.has(i)||o.set(i,new Set),null===(t=o.get(i))||void 0===t||t.add(e)}},{key:"removeEventFromPendingList",value:function(e){var t=e.getWireContent(),r=t.sender_key,n=t.session_id,i=this.pendingEvents.get(r),o=null==i?void 0:i.get(n);o&&(o.delete(e),0===o.size&&i.delete(n),0===i.size&&this.pendingEvents.delete(r))}},{key:"onRoomKeyEvent",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,l,c,d,h,p,v,y,b,_,S,E,k,M,C,I;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return r=e.getContent(),n=e.getSenderKey(),i=[],o=!1,s={},r.room_id&&r.session_key&&r.session_id&&r.algorithm?m.isOlmEncrypted(e)?(r["org.matrix.msc3061.shared_history"]&&(s.sharedHistory=!0),"m.forwarded_room_key"!=e.getType()?[3,6]:(h=t.crypto.deviceList.getDeviceByIdentityKey(m.OLM_ALGORITHM,n),t.baseApis.crypto.deviceList.getUserByIdentityKey(m.OLM_ALGORITHM,n)!==e.getSender()?(g.logger.error("sending device does not belong to the user it claims to be from"),[2]):h?[4,t.crypto.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e.getSender(),h.deviceId,[w.RoomKeyRequestState.Sent])]:[3,2])):(g.logger.error("key event not properly encrypted"),[2]):(g.logger.error("key event is missing fields"),[2]);case 1:return p=f.sent(),[3,3];case 2:p=[],f.label=3;case 3:if(v=p.some((function(e){return e.requestBody.room_id===r.room_id&&e.requestBody.session_id===r.session_id})),y=t.baseApis.getRoom(r.room_id),b=null==y||null===(u=y.getMember(t.userId))||void 0===u?void 0:u.events.member,_=(null==b?void 0:b.getSender())===e.getSender()||(null==b||null===(l=b.getUnsigned())||void 0===l?void 0:l.prev_sender)===e.getSender()&&"invite"===(null==b||null===(c=b.getPrevContent())||void 0===c?void 0:c.membership),S=e.getSender()===t.baseApis.getUserId(),!v&&!S){if(!s.sharedHistory)return g.logger.log("forwarded key not shared history - ignoring"),[2];if(y&&!_)return g.logger.log("forwarded key not from inviter or from us - ignoring"),[2]}return o=!0,(i=(i=Array.isArray(r.forwarding_curve25519_key_chain)?r.forwarding_curve25519_key_chain:[]).slice()).push(n),r.sender_key?(E=r.sender_claimed_ed25519_key)?(a={ed25519:E},y?[3,5]:(k={senderId:e.getSender(),senderKey:r.sender_key,sessionId:r.session_id,sessionKey:r.session_key,keysClaimed:a,forwardingCurve25519KeyChain:i},[4,t.crypto.cryptoStore.doTxn("readwrite",["parked_shared_history"],(function(e){return t.crypto.cryptoStore.addParkedSharedHistory(r.room_id,k,e)}),g.logger.withPrefix("[addParkedSharedHistory]"))])):(g.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field"),[2]):(g.logger.error("forwarded_room_key event is missing sender_key field"),[2]);case 4:return f.sent(),[2];case 5:return M=null!==(d=t.crypto.deviceList.getDeviceByIdentityKey(m.OLM_ALGORITHM,n))&&void 0!==d?d:void 0,C=t.crypto.checkDeviceInfoTrust(e.getSender(),M),S&&!C.isVerified()?[2]:(s.untrusted=!0,n=r.sender_key,[3,7]);case 6:a=e.getKeysClaimed(),f.label=7;case 7:r["org.matrix.msc3061.shared_history"]&&(s.sharedHistory=!0),f.label=8;case 8:return f.trys.push([8,12,,13]),[4,t.olmDevice.addInboundGroupSession(r.room_id,n,i,r.session_id,r.session_key,a,o,s)];case 9:return f.sent(),[4,t.retryDecryption(n,r.session_id,!s.untrusted)];case 10:return f.sent()&&t.crypto.cancelRoomKeyRequest({algorithm:r.algorithm,room_id:r.room_id,session_id:r.session_id,sender_key:n}),[4,t.crypto.backupManager.backupGroupSession(n,r.session_id)];case 11:return f.sent(),[3,13];case 12:return I=f.sent(),g.logger.error("Error handling m.room_key_event: ".concat(I)),[3,13];case 13:return[2]}}))}))()}},{key:"onRoomKeyWithheldEvent",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a;return(0,f.__generator)(this,(function(u){switch(u.label){case 0:return r=e.getContent(),n=r.sender_key,"m.no_olm"!==r.code?[3,11]:(i=e.getSender(),g.logger.warn("".concat(i,":").concat(n," was unable to establish an olm session with us")),[4,t.olmDevice.getSessionIdForDevice(n)]);case 1:return u.sent()?(g.logger.debug("New session already created.  Not creating a new one."),[4,t.olmDevice.recordSessionProblem(n,"no_olm",!0)]):[3,3];case 2:return u.sent(),t.retryDecryptionFromSender(n),[2];case 3:return(o=t.crypto.deviceList.getDeviceByIdentityKey(r.algorithm,n))?[3,6]:[4,t.crypto.downloadKeys([i],!1)];case 4:return u.sent(),(o=t.crypto.deviceList.getDeviceByIdentityKey(r.algorithm,n))?[3,6]:(g.logger.info("Couldn't find device for identity key "+n+": not establishing session"),[4,t.olmDevice.recordSessionProblem(n,"no_olm",!1)]);case 5:return u.sent(),t.retryDecryptionFromSender(n),[2];case 6:return[4,m.ensureOlmSessionsForDevices(t.olmDevice,t.baseApis,(0,s.default)({},i,[o]),!1)];case 7:return u.sent(),a=(0,s.default)({algorithm:m.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{}},_.ToDeviceMessageId,(0,v.default)()),[4,m.encryptMessageForDevice(a.ciphertext,t.userId,void 0,t.olmDevice,i,o,{type:"m.dummy"})];case 8:return u.sent(),[4,t.olmDevice.recordSessionProblem(n,"no_olm",!0)];case 9:return u.sent(),t.retryDecryptionFromSender(n),[4,t.baseApis.sendToDevice("m.room.encrypted",(0,s.default)({},i,(0,s.default)({},o.deviceId,a)))];case 10:return u.sent(),[3,13];case 11:return[4,t.olmDevice.addInboundGroupSessionWithheld(r.room_id,n,r.session_id,r.code,r.reason)];case 12:u.sent(),u.label=13;case 13:return[2]}}))}))()}},{key:"hasKeysForKeyRequest",value:function(e){var t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}},{key:"shareKeysWithDevice",value:function(e){var t=this,r=e.userId,n=e.deviceId,i=this.crypto.getStoredDevice(r,n),o=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,(0,s.default)({},r,[i])).then((function(e){return e[r][n].sessionId?(g.logger.log("sharing keys for session "+o.sender_key+"|"+o.session_id+" with device "+r+":"+n),t.buildKeyForwardingMessage(o.room_id,o.sender_key,o.session_id)):null})).then((function(e){var o=(0,s.default)({algorithm:m.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{}},_.ToDeviceMessageId,(0,v.default)());return t.olmlib.encryptMessageForDevice(o.ciphertext,t.userId,void 0,t.olmDevice,r,i,e).then((function(){var e=(0,s.default)({},r,(0,s.default)({},n,o));return t.baseApis.sendToDevice("m.room.encrypted",e)}))}))}},{key:"buildKeyForwardingMessage",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,n.olmDevice.getInboundGroupSessionKey(e,t,r)];case 1:return i=o.sent(),[2,{type:"m.forwarded_room_key",content:{algorithm:m.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:i.sender_claimed_ed25519_key,session_id:r,session_key:i.key,chain_index:i.chain_index,forwarding_curve25519_key_chain:i.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":i.shared_history||!1}}]}}))}))()}},{key:"importRoomKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.untrusted,n=t.source,i=this,o={};return(r||e.untrusted)&&(o.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(o.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,o).then((function(){"backup"!==n&&i.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((function(e){g.logger.log("Failed to back up megolm session",e)})),i.retryDecryption(e.sender_key,e.session_id,!o.untrusted)}))}},{key:"retryDecryption",value:function(e,t,r){var n=this;return(0,i.default)((function(){var o,a,s;return(0,f.__generator)(this,(function(u){switch(u.label){case 0:return(a=n.pendingEvents.get(e))&&(s=a.get(t))?(g.logger.debug("Retrying decryption on events",(0,c.default)(s)),[4,Promise.all((0,c.default)(s).map((l=(0,i.default)((function(e){return(0,f.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.attemptDecryption(n.crypto,{isRetry:!0,forceRedecryptIfUntrusted:r})];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))})),function(e){return l.apply(this,arguments)})))]):[2,!0];case 1:return u.sent(),[2,!(null!==(o=n.pendingEvents.get(e))&&void 0!==o&&o.has(t))]}var l}))}))()}},{key:"retryDecryptionFromSender",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return(r=t.pendingEvents.get(e))?(t.pendingEvents.delete(e),[4,Promise.all((0,c.default)(r).map((o=(0,i.default)((function(e){var r,n;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return(r=(0,l.default)(e,2))[0],n=r[1],[4,Promise.all((0,c.default)(n).map(function(){var e=(0,i.default)((function(e){return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.attemptDecryption(t.crypto)];case 1:case 2:return r.sent(),[3,3];case 3:return[2]}}))}));return function(t){return e.apply(this,arguments)}}()))];case 1:return o.sent(),[2]}}))})),function(e){return o.apply(this,arguments)})))]):[2,!0];case 1:return n.sent(),[2,!t.pendingEvents.has(e)]}var o}))}))()}},{key:"sendSharedHistoryInboundSessions",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,u,c,d,h,p,y,b,w,S,E,k,M,C,I,T,R,x,O,A,D,P,L,U,j,N,B,F,K,q,W,V,H,G,z,Y;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:return[4,m.ensureOlmSessionsForDevices(t.olmDevice,t.baseApis,e)];case 1:return f.sent(),[4,t.olmDevice.getSharedHistoryInboundGroupSessions(t.roomId)];case 2:r=f.sent(),g.logger.log("Sharing history in ".concat(t.roomId," with users ").concat(Object.keys(e)),r.map((function(e){var t=(0,l.default)(e,2),r=t[0],n=t[1];return"".concat(r,"|").concat(n)}))),n=!0,i=!1,o=void 0,f.label=3;case 3:f.trys.push([3,10,11,12]),a=r[Symbol.iterator](),f.label=4;case 4:return(n=(u=a.next()).done)?[3,9]:(c=(0,l.default)(u.value,2),d=c[0],h=c[1],[4,t.buildKeyForwardingMessage(t.roomId,d,h)]);case 5:p=f.sent(),y=[],b={},w=!0,S=!1,E=void 0;try{for(k=Object.entries(e)[Symbol.iterator]();!(w=(M=k.next()).done);w=!0){C=(0,l.default)(M.value,2),I=C[0],T=C[1],b[I]={},R=!0,x=!1,O=void 0;try{for(A=T[Symbol.iterator]();!(R=(D=A.next()).done);R=!0)P=D.value,L=(0,s.default)({algorithm:m.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{}},_.ToDeviceMessageId,(0,v.default)()),b[I][P.deviceId]=L,y.push(m.encryptMessageForDevice(L.ciphertext,t.userId,void 0,t.olmDevice,I,P,p))}catch(e){x=!0,O=e}finally{try{R||null==A.return||A.return()}finally{if(x)throw O}}}}catch(e){S=!0,E=e}finally{try{w||null==k.return||k.return()}finally{if(S)throw E}}return[4,Promise.all(y)];case 6:f.sent(),U=!0,j=!1,N=void 0;try{for(B=Object.keys(b)[Symbol.iterator]();!(U=(F=B.next()).done);U=!0){K=F.value,q=!0,W=!1,V=void 0;try{for(H=Object.keys(b[K])[Symbol.iterator]();!(q=(G=H.next()).done);q=!0)z=G.value,0===Object.keys(b[K][z].ciphertext).length&&(g.logger.log("No ciphertext for device "+K+":"+z+": pruning"),delete b[K][z])}catch(e){W=!0,V=e}finally{try{q||null==H.return||H.return()}finally{if(W)throw V}}0===Object.keys(b[K]).length&&(g.logger.log("Pruned all devices for user "+K),delete b[K])}}catch(e){j=!0,N=e}finally{try{U||null==B.return||B.return()}finally{if(j)throw N}}return 0===Object.keys(b).length?(g.logger.log("No users left to send to: aborting"),[2]):[4,t.baseApis.sendToDevice("m.room.encrypted",b)];case 7:f.sent(),f.label=8;case 8:return n=!0,[3,4];case 9:return[3,12];case 10:return Y=f.sent(),i=!0,o=Y,[3,12];case 11:try{n||null==a.return||a.return()}finally{if(i)throw o}return[7];case 12:return[2]}}))}))()}}]),n}(y.DecryptionAlgorithm);e.exports.MegolmDecryption=T;var R={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,y.registerAlgorithm)(m.MEGOLM_ALGORITHM,I,T)})),n.register("8WN5v",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("eQNFO"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomKeyRequestState=e.exports.OutgoingRoomKeyRequestManager=void 0;var l=u(n("3rHpI")),c=n("329cj"),d=n("jtqeE"),f=n("8bPbt");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v,g;e.exports.RoomKeyRequestState=v,(g=v||(e.exports.RoomKeyRequestState=v={}))[g.Unsent=0]="Unsent",g[g.Sent=1]="Sent",g[g.CancellationPending=2]="CancellationPending",g[g.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend";var m=function(){function e(t,r,n){(0,i.default)(this,e),this.baseApis=t,this.deviceId=r,this.cryptoStore=n,(0,l.default)(this,"sendOutgoingRoomKeyRequestsTimer",void 0),(0,l.default)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,l.default)(this,"clientRunning",!0)}return(0,o.default)(e,[{key:"stop",value:function(){d.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}},{key:"sendQueuedRequests",value:function(){this.startTimer()}},{key:"queueRoomKeyRequest",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this;return(0,r.default)((function(){var r,o,a,u,l;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return[4,i.cryptoStore.getOutgoingRoomKeyRequest(e)];case 1:return(r=s.sent())?[3,3]:[4,i.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:i.baseApis.makeTxnId(),state:v.Unsent})];case 2:return s.sent(),[3,14];case 3:switch(r.state){case v.CancellationPendingAndWillResend:case v.Unsent:return[3,4];case v.CancellationPending:return[3,5];case v.Sent:return[3,7]}return[3,13];case 4:return[2];case 5:return o=n?v.CancellationPendingAndWillResend:v.Sent,[4,i.cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,v.CancellationPending,{state:o,cancellationTxnId:i.baseApis.makeTxnId()})];case 6:return s.sent(),[3,14];case 7:return n?(a=v.CancellationPendingAndWillResend,[4,i.cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,v.Sent,{state:a,cancellationTxnId:i.baseApis.makeTxnId(),requestTxnId:i.baseApis.makeTxnId()})]):[3,12];case 8:if(!(u=s.sent()))return[2,i.queueRoomKeyRequest(e,t,n)];s.label=9;case 9:return s.trys.push([9,11,,12]),[4,i.sendOutgoingRoomKeyRequestCancellation(u,!0)];case 10:return s.sent(),[3,12];case 11:return l=s.sent(),d.logger.error("Error sending room key request cancellation; will retry later.",l),[3,12];case 12:return[3,14];case 13:throw new Error("unhandled state: "+r.state);case 14:return[2]}}))}))()}},{key:"cancelRoomKeyRequest",value:function(e){var t=this;return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((function(r){if(r)switch(r.state){case v.CancellationPending:case v.CancellationPendingAndWillResend:return;case v.Unsent:return d.logger.log("deleting unnecessary room key request for "+y(e)),t.cryptoStore.deleteOutgoingRoomKeyRequest(r.requestId,v.Unsent);case v.Sent:return t.cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,v.Sent,{state:v.CancellationPending,cancellationTxnId:t.baseApis.makeTxnId()}).then((function(r){r?t.sendOutgoingRoomKeyRequestCancellation(r).catch((function(e){d.logger.error("Error sending room key request cancellation; will retry later.",e),t.startTimer()})):d.logger.log("Tried to cancel room key request for "+y(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+r.state)}}))}},{key:"getOutgoingSentRoomKeyRequest",value:function(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[v.Sent])}},{key:"cancelAndResendAllOutgoingRequests",value:function(){var e=this;return(0,r.default)((function(){var t;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.cryptoStore.getAllOutgoingRoomKeyRequestsByState(v.Sent)];case 1:return t=r.sent(),[2,Promise.all(t.map((function(t){var r=t.requestBody,n=t.recipients;return e.queueRoomKeyRequest(r,n,!0)})))]}}))}))()}},{key:"startTimer",value:function(){var e=this;if(!this.sendOutgoingRoomKeyRequestsTimer){this.sendOutgoingRoomKeyRequestsTimer=setTimeout((function(){if(e.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");e.sendOutgoingRoomKeyRequestsRunning=!0,e.sendOutgoingRoomKeyRequests().finally((function(){e.sendOutgoingRoomKeyRequestsRunning=!1})).catch((function(e){d.logger.warn("error in OutgoingRoomKeyRequestManager: ".concat(e))}))}),500)}}},{key:"sendOutgoingRoomKeyRequests",value:function(){var e=this;return(0,r.default)((function(){var t,r;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:return e.clientRunning?[4,e.cryptoStore.getOutgoingRoomKeyRequestByState([v.CancellationPending,v.CancellationPendingAndWillResend,v.Unsent])]:(e.sendOutgoingRoomKeyRequestsTimer=void 0,[2]);case 1:if(!(t=n.sent()))return e.sendOutgoingRoomKeyRequestsTimer=void 0,[2];n.label=2;case 2:switch(n.trys.push([2,10,,11]),t.state){case v.Unsent:return[3,3];case v.CancellationPending:return[3,5];case v.CancellationPendingAndWillResend:return[3,7]}return[3,9];case 3:return[4,e.sendOutgoingRoomKeyRequest(t)];case 4:return n.sent(),[3,9];case 5:return[4,e.sendOutgoingRoomKeyRequestCancellation(t)];case 6:return n.sent(),[3,9];case 7:return[4,e.sendOutgoingRoomKeyRequestCancellation(t,!0)];case 8:return n.sent(),[3,9];case 9:return[2,e.sendOutgoingRoomKeyRequests()];case 10:return r=n.sent(),d.logger.error("Error sending room key request; will retry later.",r),e.sendOutgoingRoomKeyRequestsTimer=void 0,[3,11];case 11:return[2]}}))}))()}},{key:"sendOutgoingRoomKeyRequest",value:function(e){var t=this;d.logger.log("Requesting keys for ".concat(y(e.requestBody))+" from ".concat(b(e.recipients))+"(id ".concat(e.requestId,")"));var r={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(r,e.recipients,e.requestTxnId||e.requestId).then((function(){return t.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,v.Unsent,{state:v.Sent})}))}},{key:"sendOutgoingRoomKeyRequestCancellation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;d.logger.log("Sending cancellation for key request for "+"".concat(y(e.requestBody)," to ")+"".concat(b(e.recipients)," ")+"(cancellation id ".concat(e.cancellationTxnId,")"));var n={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(n,e.recipients,e.cancellationTxnId).then((function(){return t?r.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,v.CancellationPendingAndWillResend,{state:v.Unsent}):r.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,v.CancellationPending)}))}},{key:"sendMessageToDevices",value:function(e,t,r){var n={},i=!0,o=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=u.value;n[d.userId]||(n[d.userId]={}),n[d.userId][d.deviceId]=p(p({},e),{},(0,a.default)({},f.ToDeviceMessageId,(0,c.default)()))}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return this.baseApis.sendToDevice(f.EventType.RoomKeyRequest,n,r)}}]),e}();function y(e){return e.room_id+" / "+e.session_id}function b(e){return"[".concat(e.map((function(e){return"".concat(e.userId,":").concat(e.deviceId)})).join(","),"]")}e.exports.OutgoingRoomKeyRequestManager=m})),n.register("f5Jvc",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("mBz5n"),l=n("9oGi2"),c=n("giCK6"),d=n("eQNFO"),f=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TrackingStatus=e.exports.DeviceList=void 0;var h,p,v=f(n("3rHpI")),g=n("jtqeE"),m=n("1fjoF"),y=n("f1UAv"),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=k(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("dbGKv")),_=n("8A6lK"),w=n("e8gas"),S=n("6MMVS"),E=n("9sA0w");function k(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(k=function(e){return e?r:t})(e)}e.exports.TrackingStatus=h,(p=h||(e.exports.TrackingStatus=h={}))[p.NotTracked=0]="NotTracked",p[p.PendingDownload=1]="PendingDownload",p[p.DownloadInProgress=2]="DownloadInProgress",p[p.UpToDate=3]="UpToDate";var M=function(e){(0,s.default)(n,e);var t=(0,c.default)(n);function n(e,i,a){var s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:250;return(0,o.default)(this,n),(s=t.call(this)).cryptoStore=i,s.keyDownloadChunkSize=u,(0,v.default)((0,r.default)(s),"devices",{}),(0,v.default)((0,r.default)(s),"crossSigningInfo",{}),(0,v.default)((0,r.default)(s),"userByIdentityKey",{}),(0,v.default)((0,r.default)(s),"deviceTrackingStatus",{}),(0,v.default)((0,r.default)(s),"syncToken",null),(0,v.default)((0,r.default)(s),"keyDownloadsInProgressByUser",new Map),(0,v.default)((0,r.default)(s),"dirty",!1),(0,v.default)((0,r.default)(s),"savePromise",null),(0,v.default)((0,r.default)(s),"resolveSavePromise",null),(0,v.default)((0,r.default)(s),"savePromiseTime",null),(0,v.default)((0,r.default)(s),"saveTimer",null),(0,v.default)((0,r.default)(s),"hasFetched",null),(0,v.default)((0,r.default)(s),"serialiser",void 0),s.serialiser=new C(e,a,(0,r.default)(s)),s}return(0,a.default)(n,[{key:"load",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return[4,e.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_DEVICE_DATA],(function(t){e.cryptoStore.getEndToEndDeviceData(t,(function(t){var r;e.hasFetched=Boolean(t&&t.devices),e.devices=t?t.devices:{},e.crossSigningInfo=t&&t.crossSigningInfo||{},e.deviceTrackingStatus=t?t.trackingStatus:{},e.syncToken=null!==(r=null==t?void 0:t.syncToken)&&void 0!==r?r:null,e.userByIdentityKey={};var n=!0,i=!1,o=void 0;try{for(var a,s=Object.keys(e.devices)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value,l=e.devices[u],c=!0,d=!1,f=void 0;try{for(var h,p=Object.keys(l)[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value,g=l[v].keys["curve25519:"+v];void 0!==g&&(e.userByIdentityKey[g]=u)}}catch(e){d=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}))}))];case 1:s.sent(),t=!0,r=!1,n=void 0;try{for(i=Object.keys(e.deviceTrackingStatus)[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)a=o.value,e.deviceTrackingStatus[a]==h.DownloadInProgress&&(e.deviceTrackingStatus[a]=h.PendingDownload)}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}return[2]}}))}))()}},{key:"stop",value:function(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}},{key:"saveIfDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=this;return(0,i.default)((function(){var r,n,i;return(0,d.__generator)(this,(function(o){return t.dirty?(r=Date.now()+e,t.savePromiseTime&&r<t.savePromiseTime&&(clearTimeout(t.saveTimer),t.saveTimer=null,t.savePromiseTime=null),null===(n=t.savePromise)&&(n=new Promise((function(e){t.resolveSavePromise=e})),t.savePromise=n),null===t.saveTimer&&(i=t.resolveSavePromise,t.savePromiseTime=r,t.saveTimer=setTimeout((function(){g.logger.log("Saving device tracking data",t.syncToken),t.savePromiseTime=null,t.saveTimer=null,t.savePromise=null,t.resolveSavePromise=null,t.cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_DEVICE_DATA],(function(e){var r;t.cryptoStore.storeEndToEndDeviceData({devices:t.devices,crossSigningInfo:t.crossSigningInfo,trackingStatus:t.deviceTrackingStatus,syncToken:null!==(r=t.syncToken)&&void 0!==r?r:void 0},e)})).then((function(){t.dirty=!1,null==i||i(!0)}),(function(e){g.logger.error("Failed to save device tracking data",t.syncToken),g.logger.error(e)}))}),e)),[2,n]):[2,Promise.resolve(!1)]}))}))()}},{key:"getSyncToken",value:function(){return this.syncToken}},{key:"setSyncToken",value:function(e){this.syncToken=e}},{key:"downloadKeys",value:function(e,t){var r=this,n=[],i=[];if(e.forEach((function(e){var o=r.deviceTrackingStatus[e];r.keyDownloadsInProgressByUser.has(e)?(g.logger.log("downloadKeys: already have a download in progress for "+"".concat(e,": awaiting its result")),i.push(r.keyDownloadsInProgressByUser.get(e))):(t||o!=h.UpToDate)&&n.push(e)})),0!=n.length){g.logger.log("downloadKeys: downloading for",n);var o=this.doKeyDownload(n);i.push(o)}return 0===i.length&&g.logger.log("downloadKeys: already have all necessary keys"),Promise.all(i).then((function(){return r.getDevicesFromStore(e)}))}},{key:"getDevicesFromStore",value:function(e){var t=this,r={};return e.forEach((function(e){r[e]={},(t.getStoredDevicesForUser(e)||[]).forEach((function(t){r[e][t.deviceId]=t}))})),r}},{key:"getKnownUserIds",value:function(){return Object.keys(this.devices)}},{key:"getStoredDevicesForUser",value:function(e){var t=this.devices[e];if(!t)return null;var r=[];for(var n in t)t.hasOwnProperty(n)&&r.push(m.DeviceInfo.fromStorage(t[n],n));return r}},{key:"getRawStoredDevicesForUser",value:function(e){return this.devices[e]}},{key:"getStoredCrossSigningForUser",value:function(e){return this.crossSigningInfo[e]?y.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}},{key:"storeCrossSigningForUser",value:function(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}},{key:"getStoredDevice",value:function(e,t){var r=this.devices[e];if(null!=r&&r[t])return m.DeviceInfo.fromStorage(r[t],t)}},{key:"getUserByIdentityKey",value:function(e,t){return e!==b.OLM_ALGORITHM&&e!==b.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}},{key:"getDeviceByIdentityKey",value:function(e,t){var r=this.getUserByIdentityKey(e,t);if(!r)return null;var n=this.devices[r];if(!n)return null;for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];for(var a in o.keys){if(o.keys.hasOwnProperty(a))if(0===a.indexOf("curve25519:"))if(o.keys[a]==t)return m.DeviceInfo.fromStorage(o,i)}}return null}},{key:"storeDevicesForUser",value:function(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}},{key:"startTrackingDeviceList",value:function(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(g.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=h.PendingDownload,this.dirty=!0)}},{key:"stopTrackingDeviceList",value:function(e){this.deviceTrackingStatus[e]&&(g.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=h.NotTracked,this.dirty=!0)}},{key:"stopTrackingAllDeviceLists",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=Object.keys(this.deviceTrackingStatus)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;this.deviceTrackingStatus[o]=h.NotTracked}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.dirty=!0}},{key:"invalidateUserDeviceList",value:function(e){this.deviceTrackingStatus[e]&&(g.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=h.PendingDownload,this.dirty=!0)}},{key:"refreshOutdatedDeviceLists",value:function(){this.saveIfDirty();var e=[],t=!0,r=!1,n=void 0;try{for(var i,o=Object.keys(this.deviceTrackingStatus)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.deviceTrackingStatus[a]==h.PendingDownload&&e.push(a)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return this.doKeyDownload(e)}},{key:"setRawStoredDevicesForUser",value:function(e,t){var r=!0,n=!1,i=void 0;if(void 0!==this.devices[e])try{for(var o,a=Object.entries(this.devices[e])[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=(0,u.default)(o.value,2),l=s[0],c=s[1].keys["curve25519:"+l];delete this.userByIdentityKey[c]}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}this.devices[e]=t;var d=!0,f=!1,h=void 0;try{for(var p,v=Object.entries(t)[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var g=(0,u.default)(p.value,2),m=g[0],y=g[1].keys["curve25519:"+m];this.userByIdentityKey[y]=e}}catch(e){f=!0,h=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw h}}}},{key:"setRawStoredCrossSigningForUser",value:function(e,t){this.crossSigningInfo[e]=t}},{key:"doKeyDownload",value:function(e){var t=this;if(0===e.length)return Promise.resolve();var r=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((function(){n(!0)}),(function(t){throw g.logger.error("Error downloading keys for "+e+":",t),n(!1),t}));e.forEach((function(e){t.keyDownloadsInProgressByUser.set(e,r),t.deviceTrackingStatus[e]==h.PendingDownload&&(t.deviceTrackingStatus[e]=h.DownloadInProgress)}));var n=function(n){t.emit(E.CryptoEvent.WillUpdateDevices,e,!t.hasFetched),e.forEach((function(e){(t.dirty=!0,t.keyDownloadsInProgressByUser.get(e)===r)?(t.keyDownloadsInProgressByUser.delete(e),t.deviceTrackingStatus[e]==h.DownloadInProgress&&(n?(t.deviceTrackingStatus[e]=h.UpToDate,g.logger.log("Device list for",e,"now up to date")):t.deviceTrackingStatus[e]=h.PendingDownload)):g.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),t.saveIfDirty(),t.emit(E.CryptoEvent.DevicesUpdated,e,!t.hasFetched),t.hasFetched=!0};return r}}]),n}(S.TypedEventEmitter);e.exports.DeviceList=M;var C=function(){function e(t,r,n){(0,o.default)(this,e),this.baseApis=t,this.olmDevice=r,this.deviceList=n,(0,v.default)(this,"downloadInProgress",!1),(0,v.default)(this,"keyDownloadsQueuedByUser",{}),(0,v.default)(this,"queuedQueryDeferred",void 0),(0,v.default)(this,"syncToken",void 0)}return(0,a.default)(e,[{key:"updateDevicesForUsers",value:function(e,t){var r=this;return e.forEach((function(e){r.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,w.defer)()),this.syncToken=t,this.downloadInProgress?(g.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}},{key:"doQueuedQueries",value:function(){var e=this,t=function(t){var i=n.slice(t,t+e.deviceList.keyDownloadChunkSize);s.push((function(){return r.baseApis.downloadKeysForUsers(i,a)}))},r=this;if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");var n=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};var o=this.queuedQueryDeferred;this.queuedQueryDeferred=void 0,g.logger.log("Starting key download for",n),this.downloadInProgress=!0;var a={};this.syncToken&&(a.token=this.syncToken);for(var s=[],u=0;u<n.length;u+=this.deviceList.keyDownloadChunkSize)t(u);var c,f=this;return(0,w.chunkPromises)(s,3).then((c=(0,i.default)((function(e){var t,r,i,o,a,s,u,c,h,p,v,m,y,b,_,S;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:a=(t=Object).assign.apply(t,[{}].concat((0,l.default)(e.map((function(e){return e.device_keys||{}}))))),s=(r=Object).assign.apply(r,[{}].concat((0,l.default)(e.map((function(e){return e.master_keys||{}}))))),u=(i=Object).assign.apply(i,[{}].concat((0,l.default)(e.map((function(e){return e.self_signing_keys||{}}))))),c=(o=Object).assign.apply(o,[{}].concat((0,l.default)(e.map((function(e){return e.user_signing_keys||{}}))))),h=!0,p=!1,v=void 0,d.label=1;case 1:d.trys.push([1,9,10,11]),m=n[Symbol.iterator](),d.label=2;case 2:return(h=(y=m.next()).done)?[3,8]:(b=y.value,[4,(0,w.sleep)(5)]);case 3:d.sent(),d.label=4;case 4:return d.trys.push([4,6,,7]),[4,f.processQueryResponseForUser(b,a[b],{master:null==s?void 0:s[b],self_signing:null==u?void 0:u[b],user_signing:null==c?void 0:c[b]})];case 5:return d.sent(),[3,7];case 6:return _=d.sent(),g.logger.error("Error processing keys for ".concat(b,":"),_),[3,7];case 7:return h=!0,[3,2];case 8:return[3,11];case 9:return S=d.sent(),p=!0,v=S,[3,11];case 10:try{h||null==m.return||m.return()}finally{if(p)throw v}return[7];case 11:return[2]}}))})),function(e){return c.apply(this,arguments)})).then((function(){g.logger.log("Completed key download for "+n),r.downloadInProgress=!1,null==o||o.resolve(),r.queuedQueryDeferred&&r.doQueuedQueries()}),(function(e){g.logger.warn("Error downloading keys for "+n+":",e),r.downloadInProgress=!1,null==o||o.reject(e)})),o.promise}},{key:"processQueryResponseForUser",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:return g.logger.log("got device keys for "+e+":",t),g.logger.log("got cross-signing keys for "+e+":",r),i={},(o=n.deviceList.getRawStoredDevicesForUser(e))&&Object.keys(o).forEach((function(e){var t=m.DeviceInfo.fromStorage(o[e],e);i[e]=t})),[4,I(n.olmDevice,e,i,t||{},n.baseApis.getUserId(),n.baseApis.deviceId)];case 1:return u.sent(),a={},Object.keys(i).forEach((function(e){a[e]=i[e].toStorage()})),n.deviceList.setRawStoredDevicesForUser(e,a),r&&(r.master||r.self_signing||r.user_signing)&&((s=n.deviceList.getStoredCrossSigningForUser(e)||new y.CrossSigningInfo(e)).setKeys(r),n.deviceList.setRawStoredCrossSigningForUser(e,s.toStorage()),n.deviceList.emit(E.CryptoEvent.UserCrossSigningUpdated,e)),[2]}}))}))()}}]),e}();function I(e,t,r,n,i,o){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function(e,t,r,n,i,o){var a,s,u,l,c,f;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:for(var h in a=!1,r)if(r.hasOwnProperty(h)&&!(h in n)){if(t===i&&h===o){g.logger.warn("Local device ".concat(h," missing from sync, skipping removal"));continue}g.logger.log("Device "+t+":"+h+" has been removed"),delete r[h],a=!0}for(u in s=[],n)s.push(u);l=0,d.label=1;case 1:return l<s.length?(c=s[l],n.hasOwnProperty(c)?(f=n[c]).user_id!==t?(g.logger.warn("Mismatched user_id "+f.user_id+" in keys from "+t+":"+c),[3,3]):f.device_id!==c?(g.logger.warn("Mismatched device_id "+f.device_id+" in keys from "+t+":"+c),[3,3]):[4,R(e,r,f)]:[3,3]):[3,4];case 2:d.sent()&&(a=!0),d.label=3;case 3:return l++,[3,1];case 4:return[2,a]}}))}))).apply(this,arguments)}function R(e,t,r){return x.apply(this,arguments)}function x(){return(x=(0,i.default)((function(e,t,r){var n,i,o,a,s,u,l,c;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:if(!r.keys)return[2,!1];if(n=r.device_id,i=r.user_id,o="ed25519:"+n,!(a=r.keys[o]))return g.logger.warn("Device "+i+":"+n+" has no ed25519 key"),[2,!1];s=r.unsigned||{},u=r.signatures||{},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,b.verifySignature(e,r,i,n,a)];case 2:return d.sent(),[3,4];case 3:return l=d.sent(),g.logger.warn("Unable to verify signature on device "+i+":"+n+":"+l),[2,!1];case 4:if(n in t){if((c=t[n]).getFingerprint()!=a)return g.logger.warn("Ed25519 key for device "+i+":"+n+" has changed"),[2,!1]}else t[n]=c=new m.DeviceInfo(n);return c.keys=r.keys||{},c.algorithms=r.algorithms||[],c.unsigned=s,c.signatures=u,[2,!0]}}))}))).apply(this,arguments)}})),n.register("f1UAv",(function(e,t){var i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("mBz5n"),l=n("eQNFO"),c=n("1irm0").Buffer,d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UserTrustLevel=e.exports.DeviceTrustLevel=e.exports.CrossSigningLevel=e.exports.CrossSigningInfo=void 0,e.exports.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:(r=(0,i.default)((function(r,n){var i,o,a;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(t){return e.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(function(n){e.getSecretStorePrivateKey(n,t,r)}))}))];case 1:return(i=n.sent())&&i.ciphertext?(o=c.from(t.pickleKey),[4,(0,g.decryptAES)(i,o,r)]):[3,3];case 2:return a=n.sent(),[2,(0,h.decodeBase64)(a)];case 3:return[2,i];case 4:return[2]}}))})),function(e,t){return r.apply(this,arguments)}),storeCrossSigningKeyCache:function(){var r=(0,i.default)((function(r,n){var i,o;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:if(!(n instanceof Uint8Array))throw new Error("storeCrossSigningKeyCache expects Uint8Array, got ".concat(n));return i=c.from(t.pickleKey),[4,(0,g.encryptAES)((0,h.encodeBase64)(n),i,r)];case 1:return o=a.sent(),[2,e.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.storeSecretStorePrivateKey(t,r,o)}))]}}))}));return function(e,t){return r.apply(this,arguments)}}()};var r},e.exports.requestKeysDuringVerification=function(e,t,r){return E.apply(this,arguments)};var f=d(n("3rHpI")),h=n("dbGKv"),p=n("jtqeE"),v=n("8A6lK"),g=n("5zTlo");function m(e){return Object.values(e.keys)[0]}var y,b,_=function(){"use strict";function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,o.default)(this,e),this.userId=t,this.callbacks=r,this.cacheCallbacks=n,(0,f.default)(this,"keys",{}),(0,f.default)(this,"firstUse",!0),(0,f.default)(this,"crossSigningVerifiedBefore",!1)}return(0,a.default)(e,[{key:"toStorage",value:function(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}},{key:"getCrossSigningKey",value:function(e,t){var n=this;return(0,i.default)((function(){var i,o,a,s;function u(e){if(e){var n=new r.Olm.PkSigning,i=n.init_with_seed(e);if(i===t)return[i,n];n.free()}}return(0,l.__generator)(this,(function(r){switch(r.label){case 0:if(i=["master","self_signing","user_signing"].indexOf(e)>=0,!n.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");return void 0===t&&(t=n.getId(e)),o=null,n.cacheCallbacks.getCrossSigningKeyCache&&i?[4,n.cacheCallbacks.getCrossSigningKeyCache(e,t)]:[3,2];case 1:o=r.sent(),r.label=2;case 2:return(a=u(o))?[2,a]:[4,n.callbacks.getCrossSigningKey(e,t)];case 3:return o=r.sent(),(s=u(o))?n.cacheCallbacks.storeCrossSigningKeyCache&&i?[4,n.cacheCallbacks.storeCrossSigningKeyCache(e,o)]:[3,5]:[3,6];case 4:r.sent(),r.label=5;case 5:return[2,s];case 6:if(!o)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}}))}))()}},{key:"isStoredInSecretStorage",value:function(e){return(0,i.default)((function(){var t,r,n,i;function o(e){var r=!0,n=!1,i=void 0;try{for(var o,a=Object.keys(t)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;e[s]||delete t[s]}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}return(0,l.__generator)(this,(function(a){switch(a.label){case 0:return[4,e.isStored("m.cross_signing.master")];case 1:t=a.sent()||{},r=0,n=["self_signing","user_signing"],a.label=2;case 2:return r<n.length?(i=n[r],[4,e.isStored("m.cross_signing.".concat(i))]):[3,5];case 3:o.apply(void 0,[a.sent()||{}]),a.label=4;case 4:return r++,[3,2];case 5:return[2,Object.keys(t).length?t:null]}}))}))()}},{key:"isStoredInKeyCache",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,c,d,f;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(!(r=t.cacheCallbacks))return[2,!1];n=e?[e]:["master","self_signing","user_signing"],i=!0,o=!1,a=void 0,l.label=1;case 1:l.trys.push([1,6,7,8]),s=n[Symbol.iterator](),l.label=2;case 2:return(i=(u=s.next()).done)?[3,5]:(c=u.value,[4,null===(d=r.getCrossSigningKeyCache)||void 0===d?void 0:d.call(r,c)]);case 3:if(!l.sent())return[2,!1];l.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return f=l.sent(),o=!0,a=f,[3,8];case 7:try{i||null==s.return||s.return()}finally{if(o)throw a}return[7];case 8:return[2,!0]}}))}))()}},{key:"getCrossSigningKeysFromCache",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s;return(0,l.__generator)(this,(function(u){switch(u.label){case 0:if(t=new Map,!(r=e.cacheCallbacks))return[2,t];n=0,i=["master","self_signing","user_signing"],u.label=1;case 1:return n<i.length?(o=i[n],[4,null===(a=r.getCrossSigningKeyCache)||void 0===a?void 0:a.call(r,o)]):[3,4];case 2:if(!(s=u.sent()))return[3,3];t.set(o,s),u.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))()}},{key:"getId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"master";if(!this.keys[e])return null;var t=this.keys[e];return m(t)}},{key:"resetKeys",value:function(e){var t=this;return(0,i.default)((function(){var n,i,o,a,c,d,f,p,v;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(!t.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&y.MASTER||!t.keys.master)e=y.MASTER|y.USER_SIGNING|y.SELF_SIGNING;else if(0===e)return[2];n={},i={},l.label=1;case 1:return l.trys.push([1,,5,6]),e&y.MASTER?(o=new r.Olm.PkSigning,n.master=o.generate_seed(),a=o.init_with_seed(n.master),i.master={user_id:t.userId,usage:["master"],keys:(0,s.default)({},"ed25519:"+a,a)},[3,4]):[3,2];case 2:return[4,t.getCrossSigningKey("master")];case 3:c=u.default.apply(void 0,[l.sent(),2]),a=c[0],o=c[1],l.label=4;case 4:if(e&y.SELF_SIGNING){d=new r.Olm.PkSigning;try{n.self_signing=d.generate_seed(),f=d.init_with_seed(n.self_signing),i.self_signing={user_id:t.userId,usage:["self_signing"],keys:(0,s.default)({},"ed25519:"+f,f)},(0,h.pkSign)(i.self_signing,o,t.userId,a)}finally{d.free()}}if(e&y.USER_SIGNING){p=new r.Olm.PkSigning;try{n.user_signing=p.generate_seed(),v=p.init_with_seed(n.user_signing),i.user_signing={user_id:t.userId,usage:["user_signing"],keys:(0,s.default)({},"ed25519:"+v,v)},(0,h.pkSign)(i.user_signing,o,t.userId,a)}finally{p.free()}}return Object.assign(t.keys,i),t.callbacks.saveCrossSigningKeys(n),[3,6];case 5:return o&&o.free(),[7];case 6:return[2]}}))}))()}},{key:"clearKeys",value:function(){this.keys={}}},{key:"setKeys",value:function(e){var t={};if(e.master){if(e.master.user_id!==this.userId){var r="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw p.logger.error(r),new Error(r)}this.keys.master?m(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}var n=m(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){var i="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw p.logger.error(i),new Error(i)}try{(0,h.pkVerify)(e.user_signing,n,this.userId)}catch(e){throw p.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){var o="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw p.logger.error(o),new Error(o)}try{(0,h.pkVerify)(e.self_signing,n,this.userId)}catch(e){throw p.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,delete this.keys.self_signing,delete this.keys.user_signing),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}},{key:"updateCrossSigningVerifiedBefore",value:function(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}},{key:"signObject",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:if(!r.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");return[4,r.getCrossSigningKey(t)];case 1:n=u.default.apply(void 0,[a.sent(),2]),i=n[0],o=n[1];try{return(0,h.pkSign)(e,o,r.userId,i),[2,e]}finally{o.free()}return[2]}}))}))()}},{key:"signUser",value:function(e){var t=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(r){return t.keys.user_signing?[2,t.signObject(e.keys.master,"user_signing")]:(p.logger.info("No user signing key: not signing user"),[2])}))}))()}},{key:"signDevice",value:function(e,t){var r=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(n){if(e!==r.userId)throw new Error("Trying to sign ".concat(e,"'s device; can only sign our own device"));return r.keys.self_signing?[2,r.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing")]:(p.logger.info("No self signing key: not signing device"),[2])}))}))()}},{key:"checkUserTrust",value:function(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new w(!0,!0,this.firstUse);if(!this.keys.user_signing)return new w(!1,!1,e.firstUse);var t,r=e.keys.master,n=this.getId("user_signing");try{(0,h.pkVerify)(r,n,this.userId),t=!0}catch(e){t=!1}return new w(t,e.crossSigningVerifiedBefore,e.firstUse)}},{key:"checkDeviceTrust",value:function(e,t,r,n){var i=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new S(!1,!1,r,n);var a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,h.pkVerify)(o,e.getId(),e.userId),(0,h.pkVerify)(a,m(o),e.userId),S.fromUserTrustLevel(i,r,n)}catch(e){return new S(!1,!1,r,n)}}},{key:"getCacheCallbacks",value:function(){return this.cacheCallbacks}}],[{key:"fromStorage",value:function(t,r){var n=new e(r);for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}},{key:"storeInSecretStorage",value:function(e,t){return(0,i.default)((function(){var r,n,i,o,a,s,c,d,f,p;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:r=!0,n=!1,i=void 0,l.label=1;case 1:l.trys.push([1,6,7,8]),o=e[Symbol.iterator](),l.label=2;case 2:return(r=(a=o.next()).done)?[3,5]:(s=(0,u.default)(a.value,2),c=s[0],d=s[1],f=(0,h.encodeBase64)(d),[4,t.store("m.cross_signing.".concat(c),f)]);case 3:l.sent(),l.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return p=l.sent(),n=!0,i=p,[3,8];case 7:try{r||null==o.return||o.return()}finally{if(n)throw i}return[7];case 8:return[2]}}))}))()}},{key:"getFromSecretStorage",value:function(e,t){return(0,i.default)((function(){var r;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.get("m.cross_signing.".concat(e))];case 1:return(r=n.sent())?[2,(0,h.decodeBase64)(r)]:[2,null]}}))}))()}}]),e}();e.exports.CrossSigningInfo=_,e.exports.CrossSigningLevel=y,(b=y||(e.exports.CrossSigningLevel=y={}))[b.MASTER=4]="MASTER",b[b.USER_SIGNING=2]="USER_SIGNING",b[b.SELF_SIGNING=1]="SELF_SIGNING";var w=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.crossSigningVerified=t,this.crossSigningVerifiedBefore=r,this.tofu=n}return(0,a.default)(e,[{key:"isVerified",value:function(){return this.isCrossSigningVerified()}},{key:"isCrossSigningVerified",value:function(){return this.crossSigningVerified}},{key:"wasCrossSigningVerified",value:function(){return this.crossSigningVerifiedBefore}},{key:"isTofu",value:function(){return this.tofu}}]),e}();e.exports.UserTrustLevel=w;var S=function(){"use strict";function e(t,r,n,i){(0,o.default)(this,e),this.crossSigningVerified=t,this.tofu=r,this.localVerified=n,this.trustCrossSignedDevices=i}return(0,a.default)(e,[{key:"isVerified",value:function(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}},{key:"isCrossSigningVerified",value:function(){return this.crossSigningVerified}},{key:"isLocallyVerified",value:function(){return this.localVerified}},{key:"isTofu",value:function(){return this.tofu}}],[{key:"fromUserTrustLevel",value:function(t,r,n){return new e(t.isCrossSigningVerified(),t.isTofu(),r,n)}}]),e}();function E(){return E=(0,i.default)((function(e,t,r){return(0,l.__generator)(this,(function(n){return e.getUserId()!==t?[2]:(p.logger.log("Cross-signing: Self-verification done; requesting keys"),[2,new Promise((function(t,n){var o,a=e,s=a.crypto.crossSigningInfo,u=new _(s.userId,{getCrossSigningKey:(o=(0,i.default)((function(e){var t,n;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return p.logger.debug("Cross-signing: requesting secret",e,r),[4,a.requestSecret("m.cross_signing.".concat(e),[r]).promise];case 1:return t=i.sent(),n=(0,h.decodeBase64)(t),[2,Uint8Array.from(n)]}}))})),function(e){return o.apply(this,arguments)})},s.getCacheCallbacks());u.keys=s.keys;var c=new Promise((function(e){setTimeout(e,6e4,new Error("Timeout"))})),d=(0,i.default)((function(){var e,t,n;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,a.crypto.getSessionBackupPrivateKey()];case 1:return i.sent()?[3,5]:(p.logger.info("No cached backup key found. Requesting..."),[4,a.requestSecret("m.megolm_backup.v1",[r]).promise]);case 2:return e=i.sent(),p.logger.info("Got key backup key, decoding..."),t=(0,h.decodeBase64)(e),p.logger.info("Decoded backup key, storing..."),[4,a.crypto.storeSessionBackupPrivateKey(Uint8Array.from(t))];case 3:return i.sent(),p.logger.info("Backup key stored. Starting backup restore..."),[4,a.getKeyBackupVersion()];case 4:n=i.sent(),a.restoreKeyBackupWithCache(void 0,void 0,n).then((function(){p.logger.info("Backup restored.")})),i.label=5;case 5:return[2]}}))}))();return Promise.race([Promise.all([u.getCrossSigningKey("master"),u.getCrossSigningKey("self_signing"),u.getCrossSigningKey("user_signing"),d]),c]).then(t,n)})).catch((function(e){p.logger.warn("Cross-signing: failure while requesting keys:",e)}))])}))})),E.apply(this,arguments)}e.exports.DeviceTrustLevel=S})),n.register("5zTlo",(function(e,t){var r=n("2swew"),i=n("mBz5n"),o=n("eQNFO");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.calculateKeyCheck=function(e,t){return l("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)},e.exports.decryptAES=function(e,t,r){return d.apply(this,arguments)},e.exports.encryptAES=l;var a=n("dbGKv"),s=n("5O19e"),u=new Uint8Array(8);function l(e,t,r,n){return c.apply(this,arguments)}function c(){return(c=(0,r.default)((function(e,t,r,n){var u,l,c,d,h,p,v;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return n?u=(0,a.decodeBase64)(n):(u=new Uint8Array(16),s.crypto.getRandomValues(u),u[8]&=127),[4,f(t,r)];case 1:return l=i.default.apply(void 0,[o.sent(),2]),c=l[0],d=l[1],h=(new s.TextEncoder).encode(e),[4,s.subtleCrypto.encrypt({name:"AES-CTR",counter:u,length:64},c,h)];case 2:return p=o.sent(),[4,s.subtleCrypto.sign({name:"HMAC"},d,p)];case 3:return v=o.sent(),[2,{iv:(0,a.encodeBase64)(u),ciphertext:(0,a.encodeBase64)(p),mac:(0,a.encodeBase64)(v)}]}}))}))).apply(this,arguments)}function d(){return(d=(0,r.default)((function(e,t,r){var n,u,l,c,d;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,f(t,r)];case 1:return n=i.default.apply(void 0,[o.sent(),2]),u=n[0],l=n[1],c=(0,a.decodeBase64)(e.ciphertext),[4,s.subtleCrypto.verify({name:"HMAC"},l,(0,a.decodeBase64)(e.mac),c)];case 2:if(!o.sent())throw new Error("Error decrypting secret ".concat(r,": bad MAC"));return[4,s.subtleCrypto.decrypt({name:"AES-CTR",counter:(0,a.decodeBase64)(e.iv),length:64},u,c)];case 3:return d=o.sent(),[2,(new TextDecoder).decode(new Uint8Array(d))]}}))}))).apply(this,arguments)}function f(e,t){return h.apply(this,arguments)}function h(){return(h=(0,r.default)((function(e,t){var r,n,i,a,l,c;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,s.subtleCrypto.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"])];case 1:return r=o.sent(),[4,s.subtleCrypto.deriveBits({name:"HKDF",salt:u,info:(new s.TextEncoder).encode(t),hash:"SHA-256"},r,512)];case 2:return n=o.sent(),i=n.slice(0,32),a=n.slice(32),l=s.subtleCrypto.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),c=s.subtleCrypto.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]),[2,Promise.all([l,c])]}}))}))).apply(this,arguments)}})),n.register("5O19e",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.crypto=e.exports.TextEncoder=void 0,e.exports.setCrypto=function(t){var r;e.exports.crypto=f=t,e.exports.subtleCrypto=h=null!==(r=t.subtle)&&void 0!==r?r:t.webkitSubtle},e.exports.setTextEncoder=function(t){e.exports.TextEncoder=v=t},e.exports.subtleCrypto=void 0;var i,o,a,s,u,l,c,d=n("jtqeE"),f=null===(i=r.window)||void 0===i?void 0:i.crypto;e.exports.crypto=f;var h=null!==(o=null===(a=r.window)||void 0===a||null===(s=a.crypto)||void 0===s?void 0:s.subtle)&&void 0!==o?o:null===(u=r.window)||void 0===u||null===(l=u.crypto)||void 0===l?void 0:l.webkitSubtle;e.exports.subtleCrypto=h;var p,v=null===(c=r.window)||void 0===c?void 0:c.TextEncoder;if(e.exports.TextEncoder=v,!f)try{e.exports.crypto=f=n("4JxrC").webcrypto}catch(e){d.logger.error("Failed to load webcrypto",e)}h||(e.exports.subtleCrypto=h=null===(p=f)||void 0===p?void 0:p.subtle);if(!v)try{e.exports.TextEncoder=v=n("77bst").TextEncoder}catch(e){d.logger.error("Failed to load TextEncoder util",e)}})),n.register("4JxrC",(function(e,t){n("4p9KL"),n("bdvz5"),n("cBch0");var r=n("9dK71"),i=Object.keys(r),o=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(i);var a=n("lhFXq");a.pbkdf2,a.pbkdf2Sync;var s=n("9Hnaq");s.Cipher,s.createCipher,s.Cipheriv,s.createCipheriv,s.Decipher,s.createDecipher,s.Decipheriv,s.createDecipheriv,s.getCiphers,s.listCiphers;var u=n("foHTZ");u.DiffieHellmanGroup,u.createDiffieHellmanGroup,u.getDiffieHellman,u.createDiffieHellman,u.DiffieHellman;var l=n("dPOEk");l.createSign,l.Sign,l.createVerify,l.Verify,n("7mMbi");var c=n("8DLzP");c.publicEncrypt,c.privateEncrypt,c.publicDecrypt,c.privateDecrypt;var d=n("bg03w");d.randomFill,d.randomFillSync})),n.register("4p9KL",(function(e,t){var i=n("b758v"),o=65536;var a=n("j0zCv").Buffer,s=r.crypto||r.msCrypto;s&&s.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var r=a.allocUnsafe(e);if(e>0)if(e>o)for(var n=0;n<e;n+=o)s.getRandomValues(r.slice(n,n+o));else s.getRandomValues(r);return"function"==typeof t?i.nextTick((function(){t(null,r)})):r}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}})),n.register("j0zCv",(function(e,t){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=n("1irm0"),i=r.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,e.exports),e.exports.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}})),n.register("bdvz5",(function(e,t){"use strict";var r=n("fospZ"),i=n("eHlaL"),o=n("d4lwA"),a=n("4QdIC"),s=n("57oXA");function u(e){s.call(this,"digest"),this._hash=e}r(u,s),u.prototype._update=function(e){this._hash.update(e)},u.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return"md5"===(e=e.toLowerCase())?new i:"rmd160"===e||"ripemd160"===e?new o:new u(a(e))}})),n.register("fospZ",(function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}})),n.register("eHlaL",(function(e,t){"use strict";var r=n("fospZ"),i=n("9f6HI"),o=n("j0zCv").Buffer,a=new Array(16);function s(){i.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function u(e,t){return e<<t|e>>>32-t}function l(e,t,r,n,i,o,a){return u(e+(t&r|~t&n)+i+o|0,a)+t|0}function c(e,t,r,n,i,o,a){return u(e+(t&n|r&~n)+i+o|0,a)+t|0}function d(e,t,r,n,i,o,a){return u(e+(t^r^n)+i+o|0,a)+t|0}function f(e,t,r,n,i,o,a){return u(e+(r^(t|~n))+i+o|0,a)+t|0}r(s,i),s.prototype._update=function(){for(var e=a,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var r=this._a,n=this._b,i=this._c,o=this._d;r=l(r,n,i,o,e[0],3614090360,7),o=l(o,r,n,i,e[1],3905402710,12),i=l(i,o,r,n,e[2],606105819,17),n=l(n,i,o,r,e[3],3250441966,22),r=l(r,n,i,o,e[4],4118548399,7),o=l(o,r,n,i,e[5],1200080426,12),i=l(i,o,r,n,e[6],2821735955,17),n=l(n,i,o,r,e[7],4249261313,22),r=l(r,n,i,o,e[8],1770035416,7),o=l(o,r,n,i,e[9],2336552879,12),i=l(i,o,r,n,e[10],4294925233,17),n=l(n,i,o,r,e[11],2304563134,22),r=l(r,n,i,o,e[12],1804603682,7),o=l(o,r,n,i,e[13],4254626195,12),i=l(i,o,r,n,e[14],2792965006,17),r=c(r,n=l(n,i,o,r,e[15],1236535329,22),i,o,e[1],4129170786,5),o=c(o,r,n,i,e[6],3225465664,9),i=c(i,o,r,n,e[11],643717713,14),n=c(n,i,o,r,e[0],3921069994,20),r=c(r,n,i,o,e[5],3593408605,5),o=c(o,r,n,i,e[10],38016083,9),i=c(i,o,r,n,e[15],3634488961,14),n=c(n,i,o,r,e[4],3889429448,20),r=c(r,n,i,o,e[9],568446438,5),o=c(o,r,n,i,e[14],3275163606,9),i=c(i,o,r,n,e[3],4107603335,14),n=c(n,i,o,r,e[8],1163531501,20),r=c(r,n,i,o,e[13],2850285829,5),o=c(o,r,n,i,e[2],4243563512,9),i=c(i,o,r,n,e[7],1735328473,14),r=d(r,n=c(n,i,o,r,e[12],2368359562,20),i,o,e[5],4294588738,4),o=d(o,r,n,i,e[8],2272392833,11),i=d(i,o,r,n,e[11],1839030562,16),n=d(n,i,o,r,e[14],4259657740,23),r=d(r,n,i,o,e[1],2763975236,4),o=d(o,r,n,i,e[4],1272893353,11),i=d(i,o,r,n,e[7],4139469664,16),n=d(n,i,o,r,e[10],3200236656,23),r=d(r,n,i,o,e[13],681279174,4),o=d(o,r,n,i,e[0],3936430074,11),i=d(i,o,r,n,e[3],3572445317,16),n=d(n,i,o,r,e[6],76029189,23),r=d(r,n,i,o,e[9],3654602809,4),o=d(o,r,n,i,e[12],3873151461,11),i=d(i,o,r,n,e[15],530742520,16),r=f(r,n=d(n,i,o,r,e[2],3299628645,23),i,o,e[0],4096336452,6),o=f(o,r,n,i,e[7],1126891415,10),i=f(i,o,r,n,e[14],2878612391,15),n=f(n,i,o,r,e[5],4237533241,21),r=f(r,n,i,o,e[12],1700485571,6),o=f(o,r,n,i,e[3],2399980690,10),i=f(i,o,r,n,e[10],4293915773,15),n=f(n,i,o,r,e[1],2240044497,21),r=f(r,n,i,o,e[8],1873313359,6),o=f(o,r,n,i,e[15],4264355552,10),i=f(i,o,r,n,e[6],2734768916,15),n=f(n,i,o,r,e[13],1309151649,21),r=f(r,n,i,o,e[4],4149444226,6),o=f(o,r,n,i,e[11],3174756917,10),i=f(i,o,r,n,e[2],718787259,15),n=f(n,i,o,r,e[9],3951481745,21),this._a=this._a+r|0,this._b=this._b+n|0,this._c=this._c+i|0,this._d=this._d+o|0},s.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=o.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=s})),n.register("9f6HI",(function(e,t){"use strict";var r=n("j0zCv").Buffer,i=n("jfC1y").Transform;function o(e){i.call(this),this._block=r.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}n("fospZ")(o,i),o.prototype._transform=function(e,t,r){var n=null;try{this.update(e,t)}catch(e){n=e}r(n)},o.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},o.prototype.update=function(e,t){if(function(e,t){if(!r.isBuffer(e)&&"string"!=typeof e)throw new TypeError(t+" must be a string or a buffer")}(e,"Data"),this._finalized)throw new Error("Digest already called");r.isBuffer(e)||(e=r.from(e,t));for(var n=this._block,i=0;this._blockOffset+e.length-i>=this._blockSize;){for(var o=this._blockOffset;o<this._blockSize;)n[o++]=e[i++];this._update(),this._blockOffset=0}for(;i<e.length;)n[this._blockOffset++]=e[i++];for(var a=0,s=8*e.length;s>0;++a)this._length[a]+=s,(s=this._length[a]/4294967296|0)>0&&(this._length[a]-=4294967296*s);return this},o.prototype._update=function(){throw new Error("_update is not implemented")},o.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var r=0;r<4;++r)this._length[r]=0;return t},o.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=o})),n.register("jfC1y",(function(e,t){(t=e.exports=n("huot8")).Stream=t,t.Readable=t,t.Writable=n("4b9Lv"),t.Duplex=n("cqkxB"),t.Transform=n("cCVjH"),t.PassThrough=n("jqa5s"),t.finished=n("8zeLo"),t.pipeline=n("f2KBd")})),n.register("huot8",(function(e,t){var i,o=n("b758v");e.exports=C,C.ReadableState=M;n("guIx5").EventEmitter;var a=function(e,t){return e.listeners(t).length},s=n("hQqjZ"),u=n("1irm0").Buffer,l=r.Uint8Array||function(){};var c,d=n("7MpCL");c=d&&d.debuglog?d.debuglog("stream"):function(){};var f,h,p,v=n("7Rvqa"),g=n("9CpQL"),m=n("3ZGIb").getHighWaterMark,y=n("kGft5").codes,b=y.ERR_INVALID_ARG_TYPE,_=y.ERR_STREAM_PUSH_AFTER_EOF,w=y.ERR_METHOD_NOT_IMPLEMENTED,S=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n("fospZ")(C,s);var E=g.errorOrDestroy,k=["error","close","destroy","pause","resume"];function M(e,t,r){i=i||n("cqkxB"),e=e||{},"boolean"!=typeof r&&(r=t instanceof i),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=m(this,e,"readableHighWaterMark",r),this.buffer=new v,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=n("6ycqc").StringDecoder),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function C(e){if(i=i||n("cqkxB"),!(this instanceof C))return new C(e);var t=this instanceof i;this._readableState=new M(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),s.call(this)}function I(e,t,r,n,i){c("readableAddChunk",t);var o,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}(e,a);else if(i||(o=function(e,t){var r;n=t,u.isBuffer(n)||n instanceof l||"string"==typeof t||void 0===t||e.objectMode||(r=new b("chunk",["string","Buffer","Uint8Array"],t));var n;return r}(a,t)),o)E(e,o);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n)a.endEmitted?E(e,new S):T(e,a,t,!0);else if(a.ended)E(e,new _);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?T(e,a,t,!1):D(e,a)):T(e,a,t,!1)}else n||(a.reading=!1,D(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function T(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&O(e)),D(e,t)}Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),C.prototype.destroy=g.destroy,C.prototype._undestroy=g.undestroy,C.prototype._destroy=function(e,t){t(e)},C.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),I(this,e,t,!1,r)},C.prototype.unshift=function(e){return I(this,e,null,!0,!1)},C.prototype.isPaused=function(){return!1===this._readableState.flowing},C.prototype.setEncoding=function(e){f||(f=n("6ycqc").StringDecoder);var t=new f(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var R=1073741824;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=R?e=R:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function O(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,o.nextTick(A,e))}function A(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,N(e)}function D(e,t){t.readingMore||(t.readingMore=!0,o.nextTick(P,e,t))}function P(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(c("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function U(e){c("readable nexttick read 0"),e.read(0)}function j(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),N(e),t.flowing&&!t.reading&&e.read(0)}function N(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function F(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,o.nextTick(K,t,e))}function K(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function q(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}C.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):O(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&F(this),null;var n,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(r,t))),null===(n=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&F(this)),null!==n&&this.emit("data",n),n},C.prototype._read=function(e){E(this,new w("_read()"))},C.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,c("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||!1!==t.end)&&e!==o.stdout&&e!==o.stderr?u:g;function s(t,i){c("onunpipe"),t===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,c("cleanup"),e.removeListener("close",p),e.removeListener("finish",v),e.removeListener("drain",l),e.removeListener("error",h),e.removeListener("unpipe",s),r.removeListener("end",u),r.removeListener("end",g),r.removeListener("data",f),d=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function u(){c("onend"),e.end()}n.endEmitted?o.nextTick(i):r.once("end",i),e.on("unpipe",s);var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,N(e))}}(r);e.on("drain",l);var d=!1;function f(t){c("ondata");var i=e.write(t);c("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==q(n.pipes,e))&&!d&&(c("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function h(t){c("onerror",t),g(),e.removeListener("error",h),0===a(e,"error")&&E(e,t)}function p(){e.removeListener("finish",v),g()}function v(){c("onfinish"),e.removeListener("close",p),g()}function g(){c("unpipe"),r.unpipe(e)}return r.on("data",f),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",h),e.once("close",p),e.once("finish",v),e.emit("pipe",r),n.flowing||(c("pipe resume"),r.resume()),e},C.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=q(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},C.prototype.on=function(e,t){var r=s.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,c("on readable",n.length,n.reading),n.length?O(this):n.reading||o.nextTick(U,this))),r},C.prototype.addListener=C.prototype.on,C.prototype.removeListener=function(e,t){var r=s.prototype.removeListener.call(this,e,t);return"readable"===e&&o.nextTick(L,this),r},C.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||o.nextTick(L,this),t},C.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,o.nextTick(j,e,t))}(this,e)),e.paused=!1,this},C.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},C.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(c("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(c("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<k.length;o++)e.on(k[o],this.emit.bind(this,k[o]));return this._read=function(t){c("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(C.prototype[Symbol.asyncIterator]=function(){return void 0===h&&(h=n("24Qw0")),h(this)}),Object.defineProperty(C.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(C.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(C.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),C._fromList=B,Object.defineProperty(C.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(C.from=function(e,t){return void 0===p&&(p=n("3ihkp")),p(C,e,t)})})),n.register("hQqjZ",(function(e,t){e.exports=n("guIx5").EventEmitter})),n.register("7MpCL",(function(e,t){})),n.register("7Rvqa",(function(e,t){"use strict";function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=n("1irm0").Buffer,s=n("7MpCL").inspect,u=s&&s.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,l;return t=e,n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return a.alloc(0);for(var t,r,n,i=a.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,r=i,n=s,a.prototype.copy.call(t,r,n),s+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?n+=i:n+=i.slice(0,e),0==(e-=o)){o===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=a.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(o));break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],n&&o(t.prototype,n),l&&o(t,l),e}()})),n.register("9CpQL",(function(e,t){var r=n("b758v");function i(e,t){a(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function a(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return s||u?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(a,this,e)):r.nextTick(a,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(o,n):(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t?(r.nextTick(o,n),t(e)):r.nextTick(o,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}})),n.register("3ZGIb",(function(e,t){"use strict";var r=n("kGft5").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}})),n.register("kGft5",(function(t,r){e(t.exports,"codes",(function(){return i}),(function(e){return i=e}));var i,o=n("aojpe");var a={};function s(e,t,r){r||(r=Error);var n=function(e){var r,n;function i(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,i}(r);n.prototype.name=r.name,n.prototype.code=e,a[e]=n}function u(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}s("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),s("ERR_INVALID_ARG_TYPE",(function(e,t,r){var n,i,a,s;if("string"==typeof t&&(i="not ",t.substr(!a||a<0?0:+a,i.length)===i)?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))s="The ".concat(e," ").concat(n," ").concat(u(t,"type"));else{var l=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";s='The "'.concat(e,'" ').concat(l," ").concat(n," ").concat(u(t,"type"))}return s+=". Received type ".concat(void 0===r?"undefined":(0,o.default)(r))}),TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),i=a})),n.register("cqkxB",(function(e,t){var r=n("b758v"),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=c;var o=n("huot8"),a=n("4b9Lv");n("fospZ")(c,o);for(var s=i(a.prototype),u=0;u<s.length;u++){var l=s[u];c.prototype[l]||(c.prototype[l]=a.prototype[l])}function c(e){if(!(this instanceof c))return new c(e);o.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",d)))}function d(){this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})})),n.register("4b9Lv",(function(e,t){var i,o=n("b758v");function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=C,C.WritableState=M;var s={deprecate:n("fTl1C")},u=n("hQqjZ"),l=n("1irm0").Buffer,c=r.Uint8Array||function(){};var d,f=n("9CpQL"),h=n("3ZGIb").getHighWaterMark,p=n("kGft5").codes,v=p.ERR_INVALID_ARG_TYPE,g=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,y=p.ERR_STREAM_CANNOT_PIPE,b=p.ERR_STREAM_DESTROYED,_=p.ERR_STREAM_NULL_VALUES,w=p.ERR_STREAM_WRITE_AFTER_END,S=p.ERR_UNKNOWN_ENCODING,E=f.errorOrDestroy;function k(){}function M(e,t,r){i=i||n("cqkxB"),e=e||{},"boolean"!=typeof r&&(r=t instanceof i),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=h(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if("function"!=typeof i)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(o.nextTick(i,n),o.nextTick(A,e,t),e._writableState.errorEmitted=!0,E(e,n)):(i(n),e._writableState.errorEmitted=!0,E(e,n),A(e,t))}(e,r,n,t,i);else{var a=x(r)||e.destroyed;a||r.corked||r.bufferProcessing||!r.bufferedRequest||R(e,r),n?o.nextTick(T,e,r,a,i):T(e,r,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function C(e){var t=this instanceof(i=i||n("cqkxB"));if(!t&&!d.call(C,this))return new C(e);this._writableState=new M(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function I(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function T(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),A(e,t)}function R(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var s=0,u=!0;r;)i[s]=r,r.isBuf||(u=!1),r=r.next,s+=1;i.allBuffers=u,I(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,c=r.encoding,d=r.callback;if(I(e,t,!1,t.objectMode?1:l.length,l,c,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function x(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(r){t.pendingcb--,r&&E(e,r),t.prefinished=!0,e.emit("prefinish"),A(e,t)}))}function A(e,t){var r=x(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,o.nextTick(O,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}n("fospZ")(C,u),M.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(M.prototype,"buffer",{get:s.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(C,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===C&&(e&&e._writableState instanceof M)}})):d=function(e){return e instanceof this},C.prototype.pipe=function(){E(this,new y)},C.prototype.write=function(e,t,r){var n,i=this._writableState,a=!1,s=!i.objectMode&&(n=e,l.isBuffer(n)||n instanceof c);return s&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=k),i.ending?function(e,t){var r=new w;E(e,r),o.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i;return null===r?i=new _:"string"==typeof r||t.objectMode||(i=new v("chunk",["string","Buffer"],r)),!i||(E(e,i),o.nextTick(n,i),!1)}(this,i,e,r))&&(i.pendingcb++,a=function(e,t,r,n,i,o){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,s,n,i,o);return u}(this,i,s,e,t,r)),a},C.prototype.cork=function(){this._writableState.corked++},C.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||R(this,e))},C.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(C.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(C.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),C.prototype._write=function(e,t,r){r(new g("_write()"))},C.prototype._writev=null,C.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||function(e,t,r){t.ending=!0,A(e,t),r&&(t.finished?o.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r),this},Object.defineProperty(C.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),C.prototype.destroy=f.destroy,C.prototype._undestroy=f.undestroy,C.prototype._destroy=function(e,t){t(e)}})),n.register("fTl1C",(function(e,t){function n(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}})),n.register("6ycqc",(function(t,r){var i;e(t.exports,"StringDecoder",(function(){return i}),(function(e){return i=e}));var o=n("j0zCv").Buffer,a=o.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(o.isEncoding===a||!a(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=d,t=4;break;case"utf8":this.fillLast=l,t=4;break;case"base64":this.text=f,this.end=h,t=3;break;default:return this.write=p,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(t)}function u(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function l(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function d(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function f(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function v(e){return e&&e.length?this.write(e):""}i=s,s.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},s.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=u(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=u(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=u(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}})),n.register("24Qw0",(function(e,t){var r,i=n("b758v");function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a=n("8zeLo"),s=Symbol("lastResolve"),u=Symbol("lastReject"),l=Symbol("error"),c=Symbol("ended"),d=Symbol("lastPromise"),f=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function v(e){var t=e[s];if(null!==t){var r=e[h].read();null!==r&&(e[d]=null,e[s]=null,e[u]=null,t(p(r,!1)))}}function g(e){i.nextTick(v,e)}var m=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((o(r={get stream(){return this[h]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(void 0,!0));if(this[h].destroyed)return new Promise((function(t,r){i.nextTick((function(){e[l]?r(e[l]):t(p(void 0,!0))}))}));var r,n=this[d];if(n)r=new Promise(function(e,t){return function(r,n){e.then((function(){t[c]?r(p(void 0,!0)):t[f](r,n)}),n)}}(n,this));else{var o=this[h].read();if(null!==o)return Promise.resolve(p(o,!1));r=new Promise(this[f])}return this[d]=r,r}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,r){e[h].destroy(null,(function(e){e?r(e):t(p(void 0,!0))}))}))})),r),m);e.exports=function(e){var t,r=Object.create(y,(o(t={},h,{value:e,writable:!0}),o(t,s,{value:null,writable:!0}),o(t,u,{value:null,writable:!0}),o(t,l,{value:null,writable:!0}),o(t,c,{value:e._readableState.endEmitted,writable:!0}),o(t,f,{value:function(e,t){var n=r[h].read();n?(r[d]=null,r[s]=null,r[u]=null,e(p(n,!1))):(r[s]=e,r[u]=t)},writable:!0}),t));return r[d]=null,a(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[u];return null!==t&&(r[d]=null,r[s]=null,r[u]=null,t(e)),void(r[l]=e)}var n=r[s];null!==n&&(r[d]=null,r[s]=null,r[u]=null,n(p(void 0,!0))),r[c]=!0})),e.on("readable",g.bind(null,r)),r}})),n.register("8zeLo",(function(e,t){"use strict";var r=n("kGft5").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(o||i);var a=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,u=function(){t.writable||c()},l=t._writableState&&t._writableState.finished,c=function(){s=!1,l=!0,a||o.call(t)},d=t._readableState&&t._readableState.endEmitted,f=function(){a=!1,d=!0,s||o.call(t)},h=function(e){o.call(t,e)},p=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):s&&!l?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},v=function(){t.req.on("finish",c)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?s&&!t._writableState&&(t.on("end",u),t.on("close",u)):(t.on("complete",c),t.on("abort",p),t.req?v():t.on("request",v)),t.on("end",f),t.on("finish",c),!1!==n.error&&t.on("error",h),t.on("close",p),function(){t.removeListener("complete",c),t.removeListener("abort",p),t.removeListener("request",v),t.req&&t.req.removeListener("finish",c),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",c),t.removeListener("end",f),t.removeListener("error",h),t.removeListener("close",p)}}})),n.register("3ihkp",(function(e,t){e.exports=function(){throw new Error("Readable.from is not available in the browser")}})),n.register("cCVjH",(function(e,t){"use strict";e.exports=c;var r=n("kGft5").codes,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,a=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=r.ERR_TRANSFORM_WITH_LENGTH_0,u=n("cqkxB");function l(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new o);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);u.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?f(this,null,null):this._flush((function(t,r){f(e,t,r)}))}function f(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new s;if(e._transformState.transforming)throw new a;return e.push(null)}n("fospZ")(c,u),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,r){r(new i("_transform()"))},c.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}})),n.register("jqa5s",(function(e,t){"use strict";e.exports=i;var r=n("cCVjH");function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n("fospZ")(i,r),i.prototype._transform=function(e,t,r){r(null,e)}})),n.register("f2KBd",(function(e,t){"use strict";var r;var i=n("kGft5").codes,o=i.ERR_MISSING_ARGS,a=i.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function u(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var s=!1;e.on("close",(function(){s=!0})),void 0===r&&(r=n("8zeLo")),r(e,{readable:t,writable:i},(function(e){if(e)return o(e);s=!0,o()}));var u=!1;return function(t){if(!s&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new a("pipe"))}}function l(e){e()}function c(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var a=t.map((function(e,r){var o=r<t.length-1;return u(e,o,r>0,(function(e){n||(n=e),e&&a.forEach(l),o||(a.forEach(l),i(n))}))}));return t.reduce(c)}})),n.register("d4lwA",(function(e,t){"use strict";var r=n("1irm0").Buffer,i=n("fospZ"),o=n("9f6HI"),a=new Array(16),s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],u=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],l=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],c=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],d=[0,1518500249,1859775393,2400959708,2840853838],f=[1352829926,1548603684,1836072691,2053994217,0];function h(){o.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(e,t){return e<<t|e>>>32-t}function v(e,t,r,n,i,o,a,s){return p(e+(t^r^n)+o+a|0,s)+i|0}function g(e,t,r,n,i,o,a,s){return p(e+(t&r|~t&n)+o+a|0,s)+i|0}function m(e,t,r,n,i,o,a,s){return p(e+((t|~r)^n)+o+a|0,s)+i|0}function y(e,t,r,n,i,o,a,s){return p(e+(t&n|r&~n)+o+a|0,s)+i|0}function b(e,t,r,n,i,o,a,s){return p(e+(t^(r|~n))+o+a|0,s)+i|0}i(h,o),h.prototype._update=function(){for(var e=a,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var r=0|this._a,n=0|this._b,i=0|this._c,o=0|this._d,h=0|this._e,_=0|this._a,w=0|this._b,S=0|this._c,E=0|this._d,k=0|this._e,M=0;M<80;M+=1){var C,I;M<16?(C=v(r,n,i,o,h,e[s[M]],d[0],l[M]),I=b(_,w,S,E,k,e[u[M]],f[0],c[M])):M<32?(C=g(r,n,i,o,h,e[s[M]],d[1],l[M]),I=y(_,w,S,E,k,e[u[M]],f[1],c[M])):M<48?(C=m(r,n,i,o,h,e[s[M]],d[2],l[M]),I=m(_,w,S,E,k,e[u[M]],f[2],c[M])):M<64?(C=y(r,n,i,o,h,e[s[M]],d[3],l[M]),I=g(_,w,S,E,k,e[u[M]],f[3],c[M])):(C=b(r,n,i,o,h,e[s[M]],d[4],l[M]),I=v(_,w,S,E,k,e[u[M]],f[4],c[M])),r=h,h=o,o=p(i,10),i=n,n=C,_=k,k=E,E=p(S,10),S=w,w=I}var T=this._b+i+E|0;this._b=this._c+o+k|0,this._c=this._d+h+_|0,this._d=this._e+r+w|0,this._e=this._a+n+S|0,this._a=T},h.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=r.alloc?r.alloc(20):new r(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=h})),n.register("4QdIC",(function(e,t){var r=e.exports=function(e){e=e.toLowerCase();var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};r.sha=n("f73ME"),r.sha1=n("fEm02"),r.sha224=n("7HCzK"),r.sha256=n("lEoOe"),r.sha384=n("3tu2m"),r.sha512=n("3iFMv")})),n.register("f73ME",(function(e,t){var r=n("fospZ"),i=n("6UUKJ"),o=n("j0zCv").Buffer,a=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function l(e){return e<<30|e>>>2}function c(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,r=this._w,n=0|this._a,i=0|this._b,o=0|this._c,s=0|this._d,u=0|this._e,d=0;d<16;++d)r[d]=e.readInt32BE(4*d);for(;d<80;++d)r[d]=r[d-3]^r[d-8]^r[d-14]^r[d-16];for(var f=0;f<80;++f){var h=~~(f/20),p=0|((t=n)<<5|t>>>27)+c(h,i,o,s)+u+r[f]+a[h];u=s,s=o,o=l(i),i=n,n=p}this._a=n+this._a|0,this._b=i+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u})),n.register("6UUKJ",(function(e,t){var r=n("j0zCv").Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var n=this._block,i=this._blockSize,o=e.length,a=this._len,s=0;s<o;){for(var u=a%i,l=Math.min(o-s,i-u),c=0;c<l;c++)n[u+c]=e[s+c];s+=l,(a+=l)%i==0&&this._update(n)}return this._len+=o,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var r=8*this._len;if(r<=4294967295)this._block.writeUInt32BE(r,this._blockSize-4);else{var n=(4294967295&r)>>>0,i=(r-n)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)}this._update(this._block);var o=this._hash();return e?o.toString(e):o},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=i})),n.register("fEm02",(function(e,t){var r=n("fospZ"),i=n("6UUKJ"),o=n("j0zCv").Buffer,a=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function l(e){return e<<5|e>>>27}function c(e){return e<<30|e>>>2}function d(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,r=this._w,n=0|this._a,i=0|this._b,o=0|this._c,s=0|this._d,u=0|this._e,f=0;f<16;++f)r[f]=e.readInt32BE(4*f);for(;f<80;++f)r[f]=(t=r[f-3]^r[f-8]^r[f-14]^r[f-16])<<1|t>>>31;for(var h=0;h<80;++h){var p=~~(h/20),v=l(n)+d(p,i,o,s)+u+r[h]+a[p]|0;u=s,s=o,o=c(i),i=n,n=v}this._a=n+this._a|0,this._b=i+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u})),n.register("7HCzK",(function(e,t){var r=n("fospZ"),i=n("lEoOe"),o=n("6UUKJ"),a=n("j0zCv").Buffer,s=new Array(64);function u(){this.init(),this._w=s,o.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},u.prototype._hash=function(){var e=a.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=u})),n.register("lEoOe",(function(e,t){var r=n("fospZ"),i=n("6UUKJ"),o=n("j0zCv").Buffer,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function u(){this.init(),this._w=s,i.call(this,64,56)}function l(e,t,r){return r^e&(t^r)}function c(e,t,r){return e&t|r&(e|t)}function d(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function f(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function h(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(u,i),u.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},u.prototype._update=function(e){for(var t,r=this._w,n=0|this._a,i=0|this._b,o=0|this._c,s=0|this._d,u=0|this._e,p=0|this._f,v=0|this._g,g=0|this._h,m=0;m<16;++m)r[m]=e.readInt32BE(4*m);for(;m<64;++m)r[m]=0|(((t=r[m-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+r[m-7]+h(r[m-15])+r[m-16];for(var y=0;y<64;++y){var b=g+f(u)+l(u,p,v)+a[y]+r[y]|0,_=d(n)+c(n,i,o)|0;g=v,v=p,p=u,u=s+b|0,s=o,o=i,i=n,n=b+_|0}this._a=n+this._a|0,this._b=i+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0,this._f=p+this._f|0,this._g=v+this._g|0,this._h=g+this._h|0},u.prototype._hash=function(){var e=o.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=u})),n.register("3tu2m",(function(e,t){var r=n("fospZ"),i=n("3iFMv"),o=n("6UUKJ"),a=n("j0zCv").Buffer,s=new Array(160);function u(){this.init(),this._w=s,o.call(this,128,112)}r(u,i),u.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},u.prototype._hash=function(){var e=a.allocUnsafe(48);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=u})),n.register("3iFMv",(function(e,t){var r=n("fospZ"),i=n("6UUKJ"),o=n("j0zCv").Buffer,a=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function u(){this.init(),this._w=s,i.call(this,128,112)}function l(e,t,r){return r^e&(t^r)}function c(e,t,r){return e&t|r&(e|t)}function d(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function f(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function h(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function v(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function g(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function m(e,t){return e>>>0<t>>>0?1:0}r(u,i),u.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},u.prototype._update=function(e){for(var t=this._w,r=0|this._ah,n=0|this._bh,i=0|this._ch,o=0|this._dh,s=0|this._eh,u=0|this._fh,y=0|this._gh,b=0|this._hh,_=0|this._al,w=0|this._bl,S=0|this._cl,E=0|this._dl,k=0|this._el,M=0|this._fl,C=0|this._gl,I=0|this._hl,T=0;T<32;T+=2)t[T]=e.readInt32BE(4*T),t[T+1]=e.readInt32BE(4*T+4);for(;T<160;T+=2){var R=t[T-30],x=t[T-30+1],O=h(R,x),A=p(x,R),D=v(R=t[T-4],x=t[T-4+1]),P=g(x,R),L=t[T-14],U=t[T-14+1],j=t[T-32],N=t[T-32+1],B=A+U|0,F=O+L+m(B,A)|0;F=(F=F+D+m(B=B+P|0,P)|0)+j+m(B=B+N|0,N)|0,t[T]=F,t[T+1]=B}for(var K=0;K<160;K+=2){F=t[K],B=t[K+1];var q=c(r,n,i),W=c(_,w,S),V=d(r,_),H=d(_,r),G=f(s,k),z=f(k,s),Y=a[K],Z=a[K+1],$=l(s,u,y),J=l(k,M,C),Q=I+z|0,X=b+G+m(Q,I)|0;X=(X=(X=X+$+m(Q=Q+J|0,J)|0)+Y+m(Q=Q+Z|0,Z)|0)+F+m(Q=Q+B|0,B)|0;var ee=H+W|0,te=V+q+m(ee,H)|0;b=y,I=C,y=u,C=M,u=s,M=k,s=o+X+m(k=E+Q|0,E)|0,o=i,E=S,i=n,S=w,n=r,w=_,r=X+te+m(_=Q+ee|0,Q)|0}this._al=this._al+_|0,this._bl=this._bl+w|0,this._cl=this._cl+S|0,this._dl=this._dl+E|0,this._el=this._el+k|0,this._fl=this._fl+M|0,this._gl=this._gl+C|0,this._hl=this._hl+I|0,this._ah=this._ah+r+m(this._al,_)|0,this._bh=this._bh+n+m(this._bl,w)|0,this._ch=this._ch+i+m(this._cl,S)|0,this._dh=this._dh+o+m(this._dl,E)|0,this._eh=this._eh+s+m(this._el,k)|0,this._fh=this._fh+u+m(this._fl,M)|0,this._gh=this._gh+y+m(this._gl,C)|0,this._hh=this._hh+b+m(this._hl,I)|0},u.prototype._hash=function(){var e=o.allocUnsafe(64);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=u})),n.register("57oXA",(function(e,t){var r=n("j0zCv").Buffer,i=n("jw0U4").Transform,o=n("6ycqc").StringDecoder;function a(e){i.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}n("fospZ")(a,i),a.prototype.update=function(e,t,n){"string"==typeof e&&(e=r.from(e,t));var i=this._update(e);return this.hashMode?this:(n&&(i=this._toString(i,n)),i)},a.prototype.setAutoPadding=function(){},a.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},a.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},a.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},a.prototype._transform=function(e,t,r){var n;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){n=e}finally{r(n)}},a.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},a.prototype._finalOrDigest=function(e){var t=this.__final()||r.alloc(0);return e&&(t=this._toString(t,e,!0)),t},a.prototype._toString=function(e,t,r){if(this._decoder||(this._decoder=new o(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var n=this._decoder.write(e);return r&&(n+=this._decoder.end()),n},e.exports=a})),n.register("jw0U4",(function(e,t){e.exports=i;var r=n("guIx5").EventEmitter;function i(){r.call(this)}n("fospZ")(i,r),i.Readable=n("huot8"),i.Writable=n("4b9Lv"),i.Duplex=n("cqkxB"),i.Transform=n("cCVjH"),i.PassThrough=n("jqa5s"),i.finished=n("8zeLo"),i.pipeline=n("f2KBd"),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",u));var a=!1;function s(){a||(a=!0,e.end())}function u(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(c(),0===r.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",s),n.removeListener("close",u),n.removeListener("error",l),e.removeListener("error",l),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",l),e.on("error",l),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e}})),n.register("cBch0",(function(e,t){"use strict";var r=n("fospZ"),i=n("i2qVk"),o=n("57oXA"),a=n("j0zCv").Buffer,s=n("epcHr"),u=n("d4lwA"),l=n("4QdIC"),c=a.alloc(128);function d(e,t){o.call(this,"digest"),"string"==typeof t&&(t=a.from(t));var r="sha512"===e||"sha384"===e?128:64;(this._alg=e,this._key=t,t.length>r)?t=("rmd160"===e?new u:l(e)).update(t).digest():t.length<r&&(t=a.concat([t,c],r));for(var n=this._ipad=a.allocUnsafe(r),i=this._opad=a.allocUnsafe(r),s=0;s<r;s++)n[s]=54^t[s],i[s]=92^t[s];this._hash="rmd160"===e?new u:l(e),this._hash.update(n)}r(d,o),d.prototype._update=function(e){this._hash.update(e)},d.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new u:l(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return"rmd160"===(e=e.toLowerCase())||"ripemd160"===e?new d("rmd160",t):"md5"===e?new i(s,t):new d(e,t)}})),n.register("i2qVk",(function(e,t){"use strict";var r=n("fospZ"),i=n("j0zCv").Buffer,o=n("57oXA"),a=i.alloc(128),s=64;function u(e,t){o.call(this,"digest"),"string"==typeof t&&(t=i.from(t)),this._alg=e,this._key=t,t.length>s?t=e(t):t.length<s&&(t=i.concat([t,a],s));for(var r=this._ipad=i.allocUnsafe(s),n=this._opad=i.allocUnsafe(s),u=0;u<s;u++)r[u]=54^t[u],n[u]=92^t[u];this._hash=[r]}r(u,o),u.prototype._update=function(e){this._hash.push(e)},u.prototype._final=function(){var e=this._alg(i.concat(this._hash));return this._alg(i.concat([this._opad,e]))},e.exports=u})),n.register("epcHr",(function(e,t){var r=n("eHlaL");e.exports=function(e){return(new r).update(e).digest()}})),n.register("9dK71",(function(e,t){e.exports=n("5cuCM")})),n.register("5cuCM",(function(e,t){e.exports=JSON.parse('{"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}')})),n.register("lhFXq",(function(t,r){var i,o;e(t.exports,"pbkdf2",(function(){return i}),(function(e){return i=e})),e(t.exports,"pbkdf2Sync",(function(){return o}),(function(e){return o=e})),i=n("lUGox"),o=n("cBdnC")})),n.register("lUGox",(function(e,t){var i,o,a=n("j0zCv").Buffer,s=n("dIE5l"),u=n("8M588"),l=n("cBdnC"),c=n("7uxax"),d=r.crypto&&r.crypto.subtle,f={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},h=[];function p(){return o||(o=r.process&&r.process.nextTick?r.process.nextTick:r.queueMicrotask?r.queueMicrotask:r.setImmediate?r.setImmediate:r.setTimeout)}function v(e,t,r,n,i){return d.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then((function(e){return d.deriveBits({name:"PBKDF2",salt:t,iterations:r,hash:{name:i}},e,n<<3)})).then((function(e){return a.from(e)}))}e.exports=function(e,t,n,o,g,m){"function"==typeof g&&(m=g,g=void 0);var y=f[(g=g||"sha1").toLowerCase()];if(y&&"function"==typeof r.Promise){if(s(n,o),e=c(e,u,"Password"),t=c(t,u,"Salt"),"function"!=typeof m)throw new Error("No callback provided to pbkdf2");!function(e,t){e.then((function(e){p()((function(){t(null,e)}))}),(function(e){p()((function(){t(e)}))}))}(function(e){if(r.process&&!r.process.browser)return Promise.resolve(!1);if(!d||!d.importKey||!d.deriveBits)return Promise.resolve(!1);if(void 0!==h[e])return h[e];var t=v(i=i||a.alloc(8),i,10,128,e).then((function(){return!0})).catch((function(){return!1}));return h[e]=t,t}(y).then((function(r){return r?v(e,t,n,o,y):l(e,t,n,o,g)})),m)}else p()((function(){var r;try{r=l(e,t,n,o,g)}catch(e){return m(e)}m(null,r)}))}})),n.register("dIE5l",(function(e,t){var r=Math.pow(2,30)-1;e.exports=function(e,t){if("number"!=typeof e)throw new TypeError("Iterations not a number");if(e<0)throw new TypeError("Bad iterations");if("number"!=typeof t)throw new TypeError("Key length not a number");if(t<0||t>r||t!=t)throw new TypeError("Bad key length")}})),n.register("8M588",(function(e,t){var i,o=n("b758v");if(r.process&&r.process.browser)i="utf-8";else if(r.process&&r.process.version){i=parseInt(o.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary"}else i="utf-8";e.exports=i})),n.register("cBdnC",(function(e,t){var r=n("epcHr"),i=n("d4lwA"),o=n("4QdIC"),a=n("j0zCv").Buffer,s=n("dIE5l"),u=n("8M588"),l=n("7uxax"),c=a.alloc(128),d={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function f(e,t,n){var s=function(e){function t(t){return o(e).update(t).digest()}function n(e){return(new i).update(e).digest()}return"rmd160"===e||"ripemd160"===e?n:"md5"===e?r:t}(e),u="sha512"===e||"sha384"===e?128:64;t.length>u?t=s(t):t.length<u&&(t=a.concat([t,c],u));for(var l=a.allocUnsafe(u+d[e]),f=a.allocUnsafe(u+d[e]),h=0;h<u;h++)l[h]=54^t[h],f[h]=92^t[h];var p=a.allocUnsafe(u+n+4);l.copy(p,0,0,u),this.ipad1=p,this.ipad2=l,this.opad=f,this.alg=e,this.blocksize=u,this.hash=s,this.size=d[e]}f.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(e,t,r,n,i){s(r,n);var o=new f(i=i||"sha1",e=l(e,u,"Password"),(t=l(t,u,"Salt")).length),c=a.allocUnsafe(n),h=a.allocUnsafe(t.length+4);t.copy(h,0,0,t.length);for(var p=0,v=d[i],g=Math.ceil(n/v),m=1;m<=g;m++){h.writeUInt32BE(m,t.length);for(var y=o.run(h,o.ipad1),b=y,_=1;_<r;_++){b=o.run(b,o.ipad2);for(var w=0;w<v;w++)y[w]^=b[w]}y.copy(c,p),p+=v}return c}})),n.register("7uxax",(function(e,t){var r=n("j0zCv").Buffer;e.exports=function(e,t,n){if(r.isBuffer(e))return e;if("string"==typeof e)return r.from(e,t);if(ArrayBuffer.isView(e))return r.from(e.buffer);throw new TypeError(n+" must be a string, a Buffer, a typed array or a DataView")}})),n.register("9Hnaq",(function(t,r){var i,o,a,s,u,l,c,d,f,h;e(t.exports,"createCipher",(function(){return i}),(function(e){return i=e})),e(t.exports,"Cipher",(function(){return o}),(function(e){return o=e})),e(t.exports,"createCipheriv",(function(){return a}),(function(e){return a=e})),e(t.exports,"Cipheriv",(function(){return s}),(function(e){return s=e})),e(t.exports,"createDecipher",(function(){return u}),(function(e){return u=e})),e(t.exports,"Decipher",(function(){return l}),(function(e){return l=e})),e(t.exports,"createDecipheriv",(function(){return c}),(function(e){return c=e})),e(t.exports,"Decipheriv",(function(){return d}),(function(e){return d=e})),e(t.exports,"listCiphers",(function(){return f}),(function(e){return f=e})),e(t.exports,"getCiphers",(function(){return h}),(function(e){return h=e}));var p=n("3Va3I"),v=n("7wRVs"),g=n("7geAa"),m=n("6fWZW"),y=n("4ehgR");function b(e,t,r){if(e=e.toLowerCase(),g[e])return v.createCipheriv(e,t,r);if(m[e])return new p({key:t,iv:r,mode:e});throw new TypeError("invalid suite type")}function _(e,t,r){if(e=e.toLowerCase(),g[e])return v.createDecipheriv(e,t,r);if(m[e])return new p({key:t,iv:r,mode:e,decrypt:!0});throw new TypeError("invalid suite type")}i=o=function(e,t){var r,n;if(e=e.toLowerCase(),g[e])r=g[e].key,n=g[e].iv;else{if(!m[e])throw new TypeError("invalid suite type");r=8*m[e].key,n=m[e].iv}var i=y(t,!1,r,n);return b(e,i.key,i.iv)},a=s=b,u=l=function(e,t){var r,n;if(e=e.toLowerCase(),g[e])r=g[e].key,n=g[e].iv;else{if(!m[e])throw new TypeError("invalid suite type");r=8*m[e].key,n=m[e].iv}var i=y(t,!1,r,n);return _(e,i.key,i.iv)},c=d=_,f=h=function(){return Object.keys(m).concat(v.getCiphers())}})),n.register("3Va3I",(function(e,t){var r=n("57oXA"),i=n("kczAB"),o=n("fospZ"),a=n("j0zCv").Buffer,s={"des-ede3-cbc":i.CBC.instantiate(i.EDE),"des-ede3":i.EDE,"des-ede-cbc":i.CBC.instantiate(i.EDE),"des-ede":i.EDE,"des-cbc":i.CBC.instantiate(i.DES),"des-ecb":i.DES};function u(e){r.call(this);var t,n=e.mode.toLowerCase(),i=s[n];t=e.decrypt?"decrypt":"encrypt";var o=e.key;a.isBuffer(o)||(o=a.from(o)),"des-ede"!==n&&"des-ede-cbc"!==n||(o=a.concat([o,o.slice(0,8)]));var u=e.iv;a.isBuffer(u)||(u=a.from(u)),this._des=i.create({key:o,iv:u,type:t})}s.des=s["des-cbc"],s.des3=s["des-ede3-cbc"],e.exports=u,o(u,r),u.prototype._update=function(e){return a.from(this._des.update(e))},u.prototype._final=function(){return a.from(this._des.final())}})),n.register("kczAB",(function(t,r){var i,o,a;e(t.exports,"DES",(function(){return i}),(function(e){return i=e})),e(t.exports,"CBC",(function(){return o}),(function(e){return o=e})),e(t.exports,"EDE",(function(){return a}),(function(e){return a=e})),n("aK7Wg"),n("1WBdv"),i=n("5l9Rr"),o=n("20HFG"),a=n("4MLHw")})),n.register("aK7Wg",(function(t,r){var n,i,o,a,s,u,l,c,d,f,h;e(t.exports,"readUInt32BE",(function(){return n}),(function(e){return n=e})),e(t.exports,"writeUInt32BE",(function(){return i}),(function(e){return i=e})),e(t.exports,"ip",(function(){return o}),(function(e){return o=e})),e(t.exports,"rip",(function(){return a}),(function(e){return a=e})),e(t.exports,"pc1",(function(){return s}),(function(e){return s=e})),e(t.exports,"r28shl",(function(){return u}),(function(e){return u=e})),e(t.exports,"pc2",(function(){return l}),(function(e){return l=e})),e(t.exports,"expand",(function(){return c}),(function(e){return c=e})),e(t.exports,"substitute",(function(){return d}),(function(e){return d=e})),e(t.exports,"permute",(function(){return f}),(function(e){return f=e})),e(t.exports,"padSplit",(function(){return h}),(function(e){return h=e})),n=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},i=function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},o=function(e,t,r,n){for(var i=0,o=0,a=6;a>=0;a-=2){for(var s=0;s<=24;s+=8)i<<=1,i|=t>>>s+a&1;for(s=0;s<=24;s+=8)i<<=1,i|=e>>>s+a&1}for(a=6;a>=0;a-=2){for(s=1;s<=25;s+=8)o<<=1,o|=t>>>s+a&1;for(s=1;s<=25;s+=8)o<<=1,o|=e>>>s+a&1}r[n+0]=i>>>0,r[n+1]=o>>>0},a=function(e,t,r,n){for(var i=0,o=0,a=0;a<4;a++)for(var s=24;s>=0;s-=8)i<<=1,i|=t>>>s+a&1,i<<=1,i|=e>>>s+a&1;for(a=4;a<8;a++)for(s=24;s>=0;s-=8)o<<=1,o|=t>>>s+a&1,o<<=1,o|=e>>>s+a&1;r[n+0]=i>>>0,r[n+1]=o>>>0},s=function(e,t,r,n){for(var i=0,o=0,a=7;a>=5;a--){for(var s=0;s<=24;s+=8)i<<=1,i|=t>>s+a&1;for(s=0;s<=24;s+=8)i<<=1,i|=e>>s+a&1}for(s=0;s<=24;s+=8)i<<=1,i|=t>>s+a&1;for(a=1;a<=3;a++){for(s=0;s<=24;s+=8)o<<=1,o|=t>>s+a&1;for(s=0;s<=24;s+=8)o<<=1,o|=e>>s+a&1}for(s=0;s<=24;s+=8)o<<=1,o|=e>>s+a&1;r[n+0]=i>>>0,r[n+1]=o>>>0},u=function(e,t){return e<<t&268435455|e>>>28-t};var p=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];l=function(e,t,r,n){for(var i=0,o=0,a=p.length>>>1,s=0;s<a;s++)i<<=1,i|=e>>>p[s]&1;for(s=a;s<p.length;s++)o<<=1,o|=t>>>p[s]&1;r[n+0]=i>>>0,r[n+1]=o>>>0},c=function(e,t,r){var n=0,i=0;n=(1&e)<<5|e>>>27;for(var o=23;o>=15;o-=4)n<<=6,n|=e>>>o&63;for(o=11;o>=3;o-=4)i|=e>>>o&63,i<<=6;i|=(31&e)<<1|e>>>31,t[r+0]=n>>>0,t[r+1]=i>>>0};var v=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];d=function(e,t){for(var r=0,n=0;n<4;n++){r<<=4,r|=v[64*n+(e>>>18-6*n&63)]}for(n=0;n<4;n++){r<<=4,r|=v[256+64*n+(t>>>18-6*n&63)]}return r>>>0};var g=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];f=function(e){for(var t=0,r=0;r<g.length;r++)t<<=1,t|=e>>>g[r]&1;return t>>>0},h=function(e,t,r){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var i=[],o=0;o<t;o+=r)i.push(n.slice(o,o+r));return i.join(" ")}})),n.register("1WBdv",(function(e,t){"use strict";var r=n("3RkE5");function i(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}e.exports=i,i.prototype._init=function(){},i.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},i.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<r;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=r,r},i.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},i.prototype._updateEncrypt=function(e){var t=0,r=0,n=(this.bufferOff+e.length)/this.blockSize|0,i=new Array(n*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(i,r)));for(var o=e.length-(e.length-t)%this.blockSize;t<o;t+=this.blockSize)this._update(e,t,i,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return i},i.prototype._updateDecrypt=function(e){for(var t=0,r=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,i=new Array(n*this.blockSize);n>0;n--)t+=this._buffer(e,t),r+=this._flushBuffer(i,r);return t+=this._buffer(e,t),i},i.prototype.final=function(e){var t,r;return e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(r):r},i.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},i.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},i.prototype._unpad=function(e){return e},i.prototype._finalDecrypt=function(){r.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}})),n.register("3RkE5",(function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=r,r.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)}})),n.register("5l9Rr",(function(e,t){"use strict";var r=n("3RkE5"),i=n("fospZ"),o=n("aK7Wg"),a=n("1WBdv");function s(){this.tmp=new Array(2),this.keys=null}function u(e){a.call(this,e);var t=new s;this._desState=t,this.deriveKeys(t,e.key)}i(u,a),e.exports=u,u.create=function(e){return new u(e)};var l=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];u.prototype.deriveKeys=function(e,t){e.keys=new Array(32),r.equal(t.length,this.blockSize,"Invalid key length");var n=o.readUInt32BE(t,0),i=o.readUInt32BE(t,4);o.pc1(n,i,e.tmp,0),n=e.tmp[0],i=e.tmp[1];for(var a=0;a<e.keys.length;a+=2){var s=l[a>>>1];n=o.r28shl(n,s),i=o.r28shl(i,s),o.pc2(n,i,e.keys,a)}},u.prototype._update=function(e,t,r,n){var i=this._desState,a=o.readUInt32BE(e,t),s=o.readUInt32BE(e,t+4);o.ip(a,s,i.tmp,0),a=i.tmp[0],s=i.tmp[1],"encrypt"===this.type?this._encrypt(i,a,s,i.tmp,0):this._decrypt(i,a,s,i.tmp,0),a=i.tmp[0],s=i.tmp[1],o.writeUInt32BE(r,a,n),o.writeUInt32BE(r,s,n+4)},u.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},u.prototype._unpad=function(e){for(var t=e[e.length-1],n=e.length-t;n<e.length;n++)r.equal(e[n],t);return e.slice(0,e.length-t)},u.prototype._encrypt=function(e,t,r,n,i){for(var a=t,s=r,u=0;u<e.keys.length;u+=2){var l=e.keys[u],c=e.keys[u+1];o.expand(s,e.tmp,0),l^=e.tmp[0],c^=e.tmp[1];var d=o.substitute(l,c),f=s;s=(a^o.permute(d))>>>0,a=f}o.rip(s,a,n,i)},u.prototype._decrypt=function(e,t,r,n,i){for(var a=r,s=t,u=e.keys.length-2;u>=0;u-=2){var l=e.keys[u],c=e.keys[u+1];o.expand(a,e.tmp,0),l^=e.tmp[0],c^=e.tmp[1];var d=o.substitute(l,c),f=a;a=(s^o.permute(d))>>>0,s=f}o.rip(a,s,n,i)}})),n.register("20HFG",(function(t,r){var i;e(t.exports,"instantiate",(function(){return i}),(function(e){return i=e}));var o=n("3RkE5"),a=n("fospZ"),s={};function u(e){o.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}i=function(e){function t(t){e.call(this,t),this._cbcInit()}a(t,e);for(var r=Object.keys(s),n=0;n<r.length;n++){var i=r[n];t.prototype[i]=s[i]}return t.create=function(e){return new t(e)},t},s._cbcInit=function(){var e=new u(this.options.iv);this._cbcState=e},s._update=function(e,t,r,n){var i=this._cbcState,o=this.constructor.super_.prototype,a=i.iv;if("encrypt"===this.type){for(var s=0;s<this.blockSize;s++)a[s]^=e[t+s];o._update.call(this,a,0,r,n);for(s=0;s<this.blockSize;s++)a[s]=r[n+s]}else{o._update.call(this,e,t,r,n);for(s=0;s<this.blockSize;s++)r[n+s]^=a[s];for(s=0;s<this.blockSize;s++)a[s]=e[t+s]}}})),n.register("4MLHw",(function(e,t){"use strict";var r=n("3RkE5"),i=n("fospZ"),o=n("1WBdv"),a=n("5l9Rr");function s(e,t){r.equal(t.length,24,"Invalid key length");var n=t.slice(0,8),i=t.slice(8,16),o=t.slice(16,24);this.ciphers="encrypt"===e?[a.create({type:"encrypt",key:n}),a.create({type:"decrypt",key:i}),a.create({type:"encrypt",key:o})]:[a.create({type:"decrypt",key:o}),a.create({type:"encrypt",key:i}),a.create({type:"decrypt",key:n})]}function u(e){o.call(this,e);var t=new s(this.type,this.options.key);this._edeState=t}i(u,o),e.exports=u,u.create=function(e){return new u(e)},u.prototype._update=function(e,t,r,n){var i=this._edeState;i.ciphers[0]._update(e,t,r,n),i.ciphers[1]._update(r,n,r,n),i.ciphers[2]._update(r,n,r,n)},u.prototype._pad=a.prototype._pad,u.prototype._unpad=a.prototype._unpad})),n.register("7wRVs",(function(t,r){var i,o,a;e(t.exports,"createCipheriv",(function(){return i}),(function(e){return i=e})),e(t.exports,"createDecipheriv",(function(){return o}),(function(e){return o=e})),e(t.exports,"getCiphers",(function(){return a}),(function(e){return a=e}));var s=n("aigJd"),u=n("5hqjh"),l=n("7p1W7");s.createCipher,i=s.createCipheriv,u.createDecipher,o=u.createDecipheriv,a=function(){return Object.keys(l)}})),n.register("aigJd",(function(t,r){var i,o;e(t.exports,"createCipheriv",(function(){return i}),(function(e){return i=e})),e(t.exports,"createCipher",(function(){return o}),(function(e){return o=e}));var a=n("7geAa"),s=n("lRtlH"),u=n("j0zCv").Buffer,l=n("W5wSr"),c=n("57oXA"),d=n("jNrVA"),f=n("4ehgR");function h(e,t,r){c.call(this),this._cache=new v,this._cipher=new d.AES(t),this._prev=u.from(r),this._mode=e,this._autopadding=!0}n("fospZ")(h,c),h.prototype._update=function(e){var t,r;this._cache.add(e);for(var n=[];t=this._cache.get();)r=this._mode.encrypt(this,t),n.push(r);return u.concat(n)};var p=u.alloc(16,16);function v(){this.cache=u.allocUnsafe(0)}function g(e,t,r){var n=a[e.toLowerCase()];if(!n)throw new TypeError("invalid suite type");if("string"==typeof t&&(t=u.from(t)),t.length!==n.key/8)throw new TypeError("invalid key length "+t.length);if("string"==typeof r&&(r=u.from(r)),"GCM"!==n.mode&&r.length!==n.iv)throw new TypeError("invalid iv length "+r.length);return"stream"===n.type?new l(n.module,t,r):"auth"===n.type?new s(n.module,t,r):new h(n.module,t,r)}h.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(p))throw this._cipher.scrub(),new Error("data not multiple of block length")},h.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},v.prototype.add=function(e){this.cache=u.concat([this.cache,e])},v.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},v.prototype.flush=function(){for(var e=16-this.cache.length,t=u.allocUnsafe(e),r=-1;++r<e;)t.writeUInt8(e,r);return u.concat([this.cache,t])},i=g,o=function(e,t){var r=a[e.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var n=f(t,!1,r.key,r.iv);return g(e,n.key,n.iv)}})),n.register("7geAa",(function(e,t){var r={ECB:n("1k2tW"),CBC:n("k5638"),CFB:n("4Twfe"),CFB8:n("ixo7u"),CFB1:n("4kCq8"),OFB:n("boJwi"),CTR:n("fSdrf"),GCM:n("fSdrf")},i=n("7p1W7");for(var o in i)i[o].module=r[i[o].mode];e.exports=i})),n.register("1k2tW",(function(t,r){var n,i;e(t.exports,"encrypt",(function(){return n}),(function(e){return n=e})),e(t.exports,"decrypt",(function(){return i}),(function(e){return i=e})),n=function(e,t){return e._cipher.encryptBlock(t)},i=function(e,t){return e._cipher.decryptBlock(t)}})),n.register("k5638",(function(t,r){var i,o;e(t.exports,"encrypt",(function(){return i}),(function(e){return i=e})),e(t.exports,"decrypt",(function(){return o}),(function(e){return o=e}));var a=n("8gdeu");i=function(e,t){var r=a(t,e._prev);return e._prev=e._cipher.encryptBlock(r),e._prev},o=function(e,t){var r=e._prev;e._prev=t;var n=e._cipher.decryptBlock(t);return a(n,r)}})),n.register("8gdeu",(function(e,t){var r=n("1irm0").Buffer;e.exports=function(e,t){for(var n=Math.min(e.length,t.length),i=new r(n),o=0;o<n;++o)i[o]=e[o]^t[o];return i}})),n.register("4Twfe",(function(t,r){var i;e(t.exports,"encrypt",(function(){return i}),(function(e){return i=e}));var o=n("j0zCv").Buffer,a=n("8gdeu");function s(e,t,r){var n=t.length,i=a(t,e._cache);return e._cache=e._cache.slice(n),e._prev=o.concat([e._prev,r?t:i]),i}i=function(e,t,r){for(var n,i=o.allocUnsafe(0);t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=o.allocUnsafe(0)),!(e._cache.length<=t.length)){i=o.concat([i,s(e,t,r)]);break}n=e._cache.length,i=o.concat([i,s(e,t.slice(0,n),r)]),t=t.slice(n)}return i}})),n.register("ixo7u",(function(t,r){var i;e(t.exports,"encrypt",(function(){return i}),(function(e){return i=e}));var o=n("j0zCv").Buffer;function a(e,t,r){var n=e._cipher.encryptBlock(e._prev)[0]^t;return e._prev=o.concat([e._prev.slice(1),o.from([r?t:n])]),n}i=function(e,t,r){for(var n=t.length,i=o.allocUnsafe(n),s=-1;++s<n;)i[s]=a(e,t[s],r);return i}})),n.register("4kCq8",(function(t,r){var i;e(t.exports,"encrypt",(function(){return i}),(function(e){return i=e}));var o=n("j0zCv").Buffer;function a(e,t,r){for(var n,i,o=-1,a=0;++o<8;)n=t&1<<7-o?128:0,a+=(128&(i=e._cipher.encryptBlock(e._prev)[0]^n))>>o%8,e._prev=s(e._prev,r?n:i);return a}function s(e,t){var r=e.length,n=-1,i=o.allocUnsafe(e.length);for(e=o.concat([e,o.from([t])]);++n<r;)i[n]=e[n]<<1|e[n+1]>>7;return i}i=function(e,t,r){for(var n=t.length,i=o.allocUnsafe(n),s=-1;++s<n;)i[s]=a(e,t[s],r);return i}})),n.register("boJwi",(function(t,r){var i;e(t.exports,"encrypt",(function(){return i}),(function(e){return i=e}));var o=n("1irm0").Buffer,a=n("8gdeu");function s(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}i=function(e,t){for(;e._cache.length<t.length;)e._cache=o.concat([e._cache,s(e)]);var r=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),a(t,r)}})),n.register("fSdrf",(function(t,r){var i;e(t.exports,"encrypt",(function(){return i}),(function(e){return i=e}));var o=n("8gdeu"),a=n("j0zCv").Buffer,s=n("3uP6C");function u(e){var t=e._cipher.encryptBlockRaw(e._prev);return s(e._prev),t}i=function(e,t){var r=Math.ceil(t.length/16),n=e._cache.length;e._cache=a.concat([e._cache,a.allocUnsafe(16*r)]);for(var i=0;i<r;i++){var s=u(e),l=n+16*i;e._cache.writeUInt32BE(s[0],l+0),e._cache.writeUInt32BE(s[1],l+4),e._cache.writeUInt32BE(s[2],l+8),e._cache.writeUInt32BE(s[3],l+12)}var c=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),o(t,c)}})),n.register("3uP6C",(function(e,t){e.exports=function(e){for(var t,r=e.length;r--;){if(255!==(t=e.readUInt8(r))){t++,e.writeUInt8(t,r);break}e.writeUInt8(0,r)}}})),n.register("7p1W7",(function(e,t){e.exports=JSON.parse('{"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}')})),n.register("lRtlH",(function(e,t){var r=n("jNrVA"),i=n("j0zCv").Buffer,o=n("57oXA"),a=n("fospZ"),s=n("cDCoL"),u=n("8gdeu"),l=n("3uP6C");function c(e,t,n,a){o.call(this);var u=i.alloc(4,0);this._cipher=new r.AES(t);var c=this._cipher.encryptBlock(u);this._ghash=new s(c),n=function(e,t,r){if(12===t.length)return e._finID=i.concat([t,i.from([0,0,0,1])]),i.concat([t,i.from([0,0,0,2])]);var n=new s(r),o=t.length,a=o%16;n.update(t),a&&(a=16-a,n.update(i.alloc(a,0))),n.update(i.alloc(8,0));var u=8*o,c=i.alloc(8);c.writeUIntBE(u,0,8),n.update(c),e._finID=n.state;var d=i.from(e._finID);return l(d),d}(this,n,c),this._prev=i.from(n),this._cache=i.allocUnsafe(0),this._secCache=i.allocUnsafe(0),this._decrypt=a,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}a(c,o),c.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=i.alloc(t,0),this._ghash.update(t))}this._called=!0;var r=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(r),this._len+=e.length,r},c.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=u(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(e,t){var r=0;e.length!==t.length&&r++;for(var n=Math.min(e.length,t.length),i=0;i<n;++i)r+=e[i]^t[i];return r}(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},c.prototype.getAuthTag=function(){if(this._decrypt||!i.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},c.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},c.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=c})),n.register("jNrVA",(function(t,r){var i;e(t.exports,"AES",(function(){return i}),(function(e){return i=e}));var o=n("j0zCv").Buffer;function a(e){o.isBuffer(e)||(e=o.from(e));for(var t=e.length/4|0,r=new Array(t),n=0;n<t;n++)r[n]=e.readUInt32BE(4*n);return r}function s(e){for(;0<e.length;e++)e[0]=0}function u(e,t,r,n,i){for(var o,a,s,u,l=r[0],c=r[1],d=r[2],f=r[3],h=e[0]^t[0],p=e[1]^t[1],v=e[2]^t[2],g=e[3]^t[3],m=4,y=1;y<i;y++)o=l[h>>>24]^c[p>>>16&255]^d[v>>>8&255]^f[255&g]^t[m++],a=l[p>>>24]^c[v>>>16&255]^d[g>>>8&255]^f[255&h]^t[m++],s=l[v>>>24]^c[g>>>16&255]^d[h>>>8&255]^f[255&p]^t[m++],u=l[g>>>24]^c[h>>>16&255]^d[p>>>8&255]^f[255&v]^t[m++],h=o,p=a,v=s,g=u;return o=(n[h>>>24]<<24|n[p>>>16&255]<<16|n[v>>>8&255]<<8|n[255&g])^t[m++],a=(n[p>>>24]<<24|n[v>>>16&255]<<16|n[g>>>8&255]<<8|n[255&h])^t[m++],s=(n[v>>>24]<<24|n[g>>>16&255]<<16|n[h>>>8&255]<<8|n[255&p])^t[m++],u=(n[g>>>24]<<24|n[h>>>16&255]<<16|n[p>>>8&255]<<8|n[255&v])^t[m++],[o>>>=0,a>>>=0,s>>>=0,u>>>=0]}var l=[0,1,2,4,8,16,32,64,128,27,54],c=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var r=[],n=[],i=[[],[],[],[]],o=[[],[],[],[]],a=0,s=0,u=0;u<256;++u){var l=s^s<<1^s<<2^s<<3^s<<4;l=l>>>8^255&l^99,r[a]=l,n[l]=a;var c=e[a],d=e[c],f=e[d],h=257*e[l]^16843008*l;i[0][a]=h<<24|h>>>8,i[1][a]=h<<16|h>>>16,i[2][a]=h<<8|h>>>24,i[3][a]=h,h=16843009*f^65537*d^257*c^16843008*a,o[0][l]=h<<24|h>>>8,o[1][l]=h<<16|h>>>16,o[2][l]=h<<8|h>>>24,o[3][l]=h,0===a?a=s=1:(a=c^e[e[e[f^c]]],s^=e[e[s]])}return{SBOX:r,INV_SBOX:n,SUB_MIX:i,INV_SUB_MIX:o}}();function d(e){this._key=a(e),this._reset()}d.blockSize=16,d.keySize=32,d.prototype.blockSize=d.blockSize,d.prototype.keySize=d.keySize,d.prototype._reset=function(){for(var e=this._key,t=e.length,r=t+6,n=4*(r+1),i=[],o=0;o<t;o++)i[o]=e[o];for(o=t;o<n;o++){var a=i[o-1];o%t==0?(a=a<<8|a>>>24,a=c.SBOX[a>>>24]<<24|c.SBOX[a>>>16&255]<<16|c.SBOX[a>>>8&255]<<8|c.SBOX[255&a],a^=l[o/t|0]<<24):t>6&&o%t==4&&(a=c.SBOX[a>>>24]<<24|c.SBOX[a>>>16&255]<<16|c.SBOX[a>>>8&255]<<8|c.SBOX[255&a]),i[o]=i[o-t]^a}for(var s=[],u=0;u<n;u++){var d=n-u,f=i[d-(u%4?0:4)];s[u]=u<4||d<=4?f:c.INV_SUB_MIX[0][c.SBOX[f>>>24]]^c.INV_SUB_MIX[1][c.SBOX[f>>>16&255]]^c.INV_SUB_MIX[2][c.SBOX[f>>>8&255]]^c.INV_SUB_MIX[3][c.SBOX[255&f]]}this._nRounds=r,this._keySchedule=i,this._invKeySchedule=s},d.prototype.encryptBlockRaw=function(e){return u(e=a(e),this._keySchedule,c.SUB_MIX,c.SBOX,this._nRounds)},d.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),r=o.allocUnsafe(16);return r.writeUInt32BE(t[0],0),r.writeUInt32BE(t[1],4),r.writeUInt32BE(t[2],8),r.writeUInt32BE(t[3],12),r},d.prototype.decryptBlock=function(e){var t=(e=a(e))[1];e[1]=e[3],e[3]=t;var r=u(e,this._invKeySchedule,c.INV_SUB_MIX,c.INV_SBOX,this._nRounds),n=o.allocUnsafe(16);return n.writeUInt32BE(r[0],0),n.writeUInt32BE(r[3],4),n.writeUInt32BE(r[2],8),n.writeUInt32BE(r[1],12),n},d.prototype.scrub=function(){s(this._keySchedule),s(this._invKeySchedule),s(this._key)},i=d})),n.register("cDCoL",(function(e,t){var r=n("j0zCv").Buffer,i=r.alloc(16,0);function o(e){var t=r.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function a(e){this.h=e,this.state=r.alloc(16,0),this.cache=r.allocUnsafe(0)}a.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},a.prototype._multiply=function(){for(var e,t,r,n=[(e=this.h).readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)],i=[0,0,0,0],a=-1;++a<128;){for(0!=(this.state[~~(a/8)]&1<<7-a%8)&&(i[0]^=n[0],i[1]^=n[1],i[2]^=n[2],i[3]^=n[3]),r=0!=(1&n[3]),t=3;t>0;t--)n[t]=n[t]>>>1|(1&n[t-1])<<31;n[0]=n[0]>>>1,r&&(n[0]=-520093696^n[0])}this.state=o(i)},a.prototype.update=function(e){var t;for(this.cache=r.concat([this.cache,e]);this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},a.prototype.final=function(e,t){return this.cache.length&&this.ghash(r.concat([this.cache,i],16)),this.ghash(o([0,e,0,t])),this.state},e.exports=a})),n.register("W5wSr",(function(e,t){var r=n("jNrVA"),i=n("j0zCv").Buffer,o=n("57oXA");function a(e,t,n,a){o.call(this),this._cipher=new r.AES(t),this._prev=i.from(n),this._cache=i.allocUnsafe(0),this._secCache=i.allocUnsafe(0),this._decrypt=a,this._mode=e}n("fospZ")(a,o),a.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},a.prototype._final=function(){this._cipher.scrub()},e.exports=a})),n.register("4ehgR",(function(e,t){var r=n("j0zCv").Buffer,i=n("eHlaL");e.exports=function(e,t,n,o){if(r.isBuffer(e)||(e=r.from(e,"binary")),t&&(r.isBuffer(t)||(t=r.from(t,"binary")),8!==t.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var a=n/8,s=r.alloc(a),u=r.alloc(o||0),l=r.alloc(0);a>0||o>0;){var c=new i;c.update(l),c.update(e),t&&c.update(t),l=c.digest();var d=0;if(a>0){var f=s.length-a;d=Math.min(a,l.length),l.copy(s,f,0,d),a-=d}if(d<l.length&&o>0){var h=u.length-o,p=Math.min(o,l.length-d);l.copy(u,h,d,d+p),o-=p}}return l.fill(0),{key:s,iv:u}}})),n.register("5hqjh",(function(t,r){var i,o;e(t.exports,"createDecipher",(function(){return i}),(function(e){return i=e})),e(t.exports,"createDecipheriv",(function(){return o}),(function(e){return o=e}));var a=n("lRtlH"),s=n("j0zCv").Buffer,u=n("7geAa"),l=n("W5wSr"),c=n("57oXA"),d=n("jNrVA"),f=n("4ehgR");function h(e,t,r){c.call(this),this._cache=new p,this._last=void 0,this._cipher=new d.AES(t),this._prev=s.from(r),this._mode=e,this._autopadding=!0}function p(){this.cache=s.allocUnsafe(0)}function v(e,t,r){var n=u[e.toLowerCase()];if(!n)throw new TypeError("invalid suite type");if("string"==typeof r&&(r=s.from(r)),"GCM"!==n.mode&&r.length!==n.iv)throw new TypeError("invalid iv length "+r.length);if("string"==typeof t&&(t=s.from(t)),t.length!==n.key/8)throw new TypeError("invalid key length "+t.length);return"stream"===n.type?new l(n.module,t,r,!0):"auth"===n.type?new a(n.module,t,r,!0):new h(n.module,t,r)}n("fospZ")(h,c),h.prototype._update=function(e){var t,r;this._cache.add(e);for(var n=[];t=this._cache.get(this._autopadding);)r=this._mode.decrypt(this,t),n.push(r);return s.concat(n)},h.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return function(e){var t=e[15];if(t<1||t>16)throw new Error("unable to decrypt data");var r=-1;for(;++r<t;)if(e[r+(16-t)]!==t)throw new Error("unable to decrypt data");if(16===t)return;return e.slice(0,16-t)}(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},h.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},p.prototype.add=function(e){this.cache=s.concat([this.cache,e])},p.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},p.prototype.flush=function(){if(this.cache.length)return this.cache},i=function(e,t){var r=u[e.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var n=f(t,!1,r.key,r.iv);return v(e,n.key,n.iv)},o=v})),n.register("6fWZW",(function(t,r){var n,i,o,a,s,u,l,c;e(t.exports,"des-ecb",(function(){return n}),(function(e){return n=e})),e(t.exports,"des-cbc",(function(){return i}),(function(e){return i=e})),e(t.exports,"des",(function(){return o}),(function(e){return o=e})),e(t.exports,"des-ede3-cbc",(function(){return a}),(function(e){return a=e})),e(t.exports,"des3",(function(){return s}),(function(e){return s=e})),e(t.exports,"des-ede3",(function(){return u}),(function(e){return u=e})),e(t.exports,"des-ede-cbc",(function(){return l}),(function(e){return l=e})),e(t.exports,"des-ede",(function(){return c}),(function(e){return c=e})),n={key:8,iv:0},i=o={key:8,iv:8},a=s={key:24,iv:8},u={key:24,iv:0},l={key:16,iv:8},c={key:16,iv:0}})),n.register("foHTZ",(function(t,r){var i,o,a,s,u;e(t.exports,"DiffieHellmanGroup",(function(){return i}),(function(e){return i=e})),e(t.exports,"createDiffieHellmanGroup",(function(){return o}),(function(e){return o=e})),e(t.exports,"getDiffieHellman",(function(){return a}),(function(e){return a=e})),e(t.exports,"createDiffieHellman",(function(){return s}),(function(e){return s=e})),e(t.exports,"DiffieHellman",(function(){return u}),(function(e){return u=e}));var l=n("1irm0").Buffer,c=n("jruz1"),d=n("9iElS"),f=n("9JZoy");var h={binary:!0,hex:!0,base64:!0};i=o=a=function(e){var t=new l(d[e].prime,"hex"),r=new l(d[e].gen,"hex");return new f(t,r)},s=u=function e(t,r,n,i){return l.isBuffer(r)||void 0===h[r]?e(t,"binary",r,n):(r=r||"binary",i=i||"binary",n=n||new l([2]),l.isBuffer(n)||(n=new l(n,i)),"number"==typeof t?new f(c(t,n),n,!0):(l.isBuffer(t)||(t=new l(t,r)),new f(t,n,!0)))}})),n.register("jruz1",(function(e,t){var r=n("4p9KL");e.exports=m,m.simpleSieve=v,m.fermatTest=g;var i=n("jvf3e"),o=new i(24),a=new(n("6AT08")),s=new i(1),u=new i(2),l=new i(5),c=(new i(16),new i(8),new i(10)),d=new i(3),f=(new i(7),new i(11)),h=new i(4),p=(new i(12),null);function v(e){for(var t=function(){if(null!==p)return p;var e=[];e[0]=2;for(var t=1,r=3;r<1048576;r+=2){for(var n=Math.ceil(Math.sqrt(r)),i=0;i<t&&e[i]<=n&&r%e[i]!=0;i++);t!==i&&e[i]<=n||(e[t++]=r)}return p=e,e}(),r=0;r<t.length;r++)if(0===e.modn(t[r]))return 0===e.cmpn(t[r]);return!0}function g(e){var t=i.mont(e);return 0===u.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function m(e,t){if(e<16)return new i(2===t||5===t?[140,123]:[140,39]);var n,p;for(t=new i(t);;){for(n=new i(r(Math.ceil(e/8)));n.bitLength()>e;)n.ishrn(1);if(n.isEven()&&n.iadd(s),n.testn(1)||n.iadd(u),t.cmp(u)){if(!t.cmp(l))for(;n.mod(c).cmp(d);)n.iadd(h)}else for(;n.mod(o).cmp(f);)n.iadd(h);if(v(p=n.shrn(1))&&v(n)&&g(p)&&g(n)&&a.test(p)&&a.test(n))return n}}})),n.register("jvf3e",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,r,n){for(var i=0,o=Math.min(e.length,r),a=t;a<o;a++){var s=e.charCodeAt(a)-48;i*=n,i+=s>=49?s-49+10:s>=17?s-17+10:s}return i}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r.strip()}o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);n=0!==(o=s>>>24-i&16777215)||a!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,a--)}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],h=f[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var v=p.modn(h).toString(e);n=(p=p.idivn(h)).isZero()?v+n:c[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var a,s,u="le"===t,l=new e(o),c=this.clone();if(u){for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[s]=a;for(;s<o;s++)l[s]=0}else{for(s=0;s<o-i;s++)l[s]=0;for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[o-s-1]=a}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function v(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),o.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,e,t):v(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},g.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),v(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,o=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=o>>>26,this.words[n]=67108863&o}return 0!==t&&(this.words[n]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this.strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},i(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,y),i(w,y),i(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new _;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new k(e)},i(k,E),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("6AT08",(function(e,t){var r=n("j3Xmb"),i=n("5PiYS");function o(e){this.rand=e||new i.Rand}e.exports=o,o.create=function(e){return new o(e)},o.prototype._randbelow=function(e){var t=e.bitLength(),n=Math.ceil(t/8);do{var i=new r(this.rand.generate(n))}while(i.cmp(e)>=0);return i},o.prototype._randrange=function(e,t){var r=t.sub(e);return e.add(this._randbelow(r))},o.prototype.test=function(e,t,n){var i=e.bitLength(),o=r.mont(e),a=new r(1).toRed(o);t||(t=Math.max(1,i/48|0));for(var s=e.subn(1),u=0;!s.testn(u);u++);for(var l=e.shrn(u),c=s.toRed(o);t>0;t--){var d=this._randrange(new r(2),s);n&&n(d);var f=d.toRed(o).redPow(l);if(0!==f.cmp(a)&&0!==f.cmp(c)){for(var h=1;h<u;h++){if(0===(f=f.redSqr()).cmp(a))return!1;if(0===f.cmp(c))break}if(h===u)return!1}}return!0},o.prototype.getDivisor=function(e,t){var n=e.bitLength(),i=r.mont(e),o=new r(1).toRed(i);t||(t=Math.max(1,n/48|0));for(var a=e.subn(1),s=0;!a.testn(s);s++);for(var u=e.shrn(s),l=a.toRed(i);t>0;t--){var c=this._randrange(new r(2),a),d=e.gcd(c);if(0!==d.cmpn(1))return d;var f=c.toRed(i).redPow(u);if(0!==f.cmp(o)&&0!==f.cmp(l)){for(var h=1;h<s;h++){if(0===(f=f.redSqr()).cmp(o))return f.fromRed().subn(1).gcd(e);if(0===f.cmp(l))break}if(h===s)return(f=f.redSqr()).fromRed().subn(1).gcd(e)}}return!1}})),n.register("j3Xmb",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,r,n){for(var i=0,o=Math.min(e.length,r),a=t;a<o;a++){var s=e.charCodeAt(a)-48;i*=n,i+=s>=49?s-49+10:s>=17?s-17+10:s}return i}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r.strip()}o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);n=0!==(o=s>>>24-i&16777215)||a!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,a--)}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],h=f[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var v=p.modn(h).toString(e);n=(p=p.idivn(h)).isZero()?v+n:c[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var a,s,u="le"===t,l=new e(o),c=this.clone();if(u){for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[s]=a;for(;s<o;s++)l[s]=0}else{for(s=0;s<o-i;s++)l[s]=0;for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[o-s-1]=a}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function v(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),o.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,e,t):v(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},g.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),v(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,o=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=o>>>26,this.words[n]=67108863&o}return 0!==t&&(this.words[n]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this.strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},i(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,y),i(w,y),i(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new _;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new k(e)},i(k,E),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("5PiYS",(function(e,t){var r;function i(e){this.rand=e}if(e.exports=function(e){return r||(r=new i(null)),r.generate(e)},e.exports.Rand=i,i.prototype.generate=function(e){return this._rand(e)},i.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?i.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?i.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(i.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var o=n("7MpCL");if("function"!=typeof o.randomBytes)throw new Error("Not supported");i.prototype._rand=function(e){return o.randomBytes(e)}}catch(e){}})),n.register("9iElS",(function(e,t){e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')})),n.register("9JZoy",(function(e,t){var r=n("1irm0").Buffer,i=n("jvf3e"),o=new(n("6AT08")),a=new i(24),s=new i(11),u=new i(10),l=new i(3),c=new i(7),d=n("jruz1"),f=n("4p9KL");function h(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this._pub=new i(e),this}function p(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this._priv=new i(e),this}e.exports=g;var v={};function g(e,t,r){this.setGenerator(t),this.__prime=new i(e),this._prime=i.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,r?(this.setPublicKey=h,this.setPrivateKey=p):this._primeCode=8}function m(e,t){var n=new r(e.toArray());return t?n.toString(t):n}Object.defineProperty(g.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var r=t.toString("hex"),n=[r,e.toString(16)].join("_");if(n in v)return v[n];var i,f=0;if(e.isEven()||!d.simpleSieve||!d.fermatTest(e)||!o.test(e))return f+=1,f+="02"===r||"05"===r?8:4,v[n]=f,f;switch(o.test(e.shrn(1))||(f+=2),r){case"02":e.mod(a).cmp(s)&&(f+=8);break;case"05":(i=e.mod(u)).cmp(l)&&i.cmp(c)&&(f+=8);break;default:f+=4}return v[n]=f,f}(this.__prime,this.__gen)),this._primeCode}}),g.prototype.generateKeys=function(){return this._priv||(this._priv=new i(f(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},g.prototype.computeSecret=function(e){var t=(e=(e=new i(e)).toRed(this._prime)).redPow(this._priv).fromRed(),n=new r(t.toArray()),o=this.getPrime();if(n.length<o.length){var a=new r(o.length-n.length);a.fill(0),n=r.concat([a,n])}return n},g.prototype.getPublicKey=function(e){return m(this._pub,e)},g.prototype.getPrivateKey=function(e){return m(this._priv,e)},g.prototype.getPrime=function(e){return m(this.__prime,e)},g.prototype.getGenerator=function(e){return m(this._gen,e)},g.prototype.setGenerator=function(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this.__gen=e,this._gen=new i(e),this}})),n.register("dPOEk",(function(e,t){var r=n("j0zCv").Buffer,i=n("bdvz5"),o=n("jfC1y"),a=n("fospZ"),s=n("g88ee"),u=n("hm5Nb"),l=n("5cuCM");function c(e){o.Writable.call(this);var t=l[e];if(!t)throw new Error("Unknown message digest");this._hashType=t.hash,this._hash=i(t.hash),this._tag=t.id,this._signType=t.sign}function d(e){o.Writable.call(this);var t=l[e];if(!t)throw new Error("Unknown message digest");this._hash=i(t.hash),this._tag=t.id,this._signType=t.sign}function f(e){return new c(e)}function h(e){return new d(e)}Object.keys(l).forEach((function(e){l[e].id=r.from(l[e].id,"hex"),l[e.toLowerCase()]=l[e]})),a(c,o.Writable),c.prototype._write=function(e,t,r){this._hash.update(e),r()},c.prototype.update=function(e,t){return"string"==typeof e&&(e=r.from(e,t)),this._hash.update(e),this},c.prototype.sign=function(e,t){this.end();var r=this._hash.digest(),n=s(r,e,this._hashType,this._signType,this._tag);return t?n.toString(t):n},a(d,o.Writable),d.prototype._write=function(e,t,r){this._hash.update(e),r()},d.prototype.update=function(e,t){return"string"==typeof e&&(e=r.from(e,t)),this._hash.update(e),this},d.prototype.verify=function(e,t,n){"string"==typeof t&&(t=r.from(t,n)),this.end();var i=this._hash.digest();return u(t,i,e,this._signType,this._tag)},e.exports={Sign:f,Verify:h,createSign:f,createVerify:h}})),n.register("g88ee",(function(e,t){var r=n("j0zCv").Buffer,i=n("cBch0"),o=n("dRTKf"),a=n("6bdf7").ec,s=n("llUdM"),u=n("kukaq"),l=n("430pW");function c(e,t,n,o){if((e=r.from(e.toArray())).length<t.byteLength()){var a=r.alloc(t.byteLength()-e.length);e=r.concat([a,e])}var s=n.length,u=function(e,t){e=(e=d(e,t)).mod(t);var n=r.from(e.toArray());if(n.length<t.byteLength()){var i=r.alloc(t.byteLength()-n.length);n=r.concat([i,n])}return n}(n,t),l=r.alloc(s);l.fill(1);var c=r.alloc(s);return c=i(o,c).update(l).update(r.from([0])).update(e).update(u).digest(),l=i(o,c).update(l).digest(),{k:c=i(o,c).update(l).update(r.from([1])).update(e).update(u).digest(),v:l=i(o,c).update(l).digest()}}function d(e,t){var r=new s(e),n=(e.length<<3)-t.bitLength();return n>0&&r.ishrn(n),r}function f(e,t,n){var o,a;do{for(o=r.alloc(0);8*o.length<e.bitLength();)t.v=i(n,t.k).update(t.v).digest(),o=r.concat([o,t.v]);a=d(o,e),t.k=i(n,t.k).update(t.v).update(r.from([0])).digest(),t.v=i(n,t.k).update(t.v).digest()}while(-1!==a.cmp(e));return a}function h(e,t,r,n){return e.toRed(s.mont(r)).redPow(t).fromRed().mod(n)}e.exports=function(e,t,n,i,p){var v=u(t);if(v.curve){if("ecdsa"!==i&&"ecdsa/rsa"!==i)throw new Error("wrong private key type");return function(e,t){var n=l[t.curve.join(".")];if(!n)throw new Error("unknown curve "+t.curve.join("."));var i=new a(n).keyFromPrivate(t.privateKey).sign(e);return r.from(i.toDER())}(e,v)}if("dsa"===v.type){if("dsa"!==i)throw new Error("wrong private key type");return function(e,t,n){var i,o=t.params.priv_key,a=t.params.p,u=t.params.q,l=t.params.g,p=new s(0),v=d(e,u).mod(u),g=!1,m=c(o,u,e,n);for(;!1===g;)p=h(l,i=f(u,m,n),a,u),0===(g=i.invm(u).imul(v.add(o.mul(p))).mod(u)).cmpn(0)&&(g=!1,p=new s(0));return function(e,t){e=e.toArray(),t=t.toArray(),128&e[0]&&(e=[0].concat(e));128&t[0]&&(t=[0].concat(t));var n=[48,e.length+t.length+4,2,e.length];return n=n.concat(e,[2,t.length],t),r.from(n)}(p,g)}(e,v,n)}if("rsa"!==i&&"ecdsa/rsa"!==i)throw new Error("wrong private key type");e=r.concat([p,e]);for(var g=v.modulus.byteLength(),m=[0,1];e.length+m.length+1<g;)m.push(255);m.push(0);for(var y=-1;++y<e.length;)m.push(e[y]);return o(m,v)},e.exports.getKey=c,e.exports.makeKey=f})),n.register("dRTKf",(function(e,t){var r=n("1irm0").Buffer,i=n("llUdM"),o=n("4p9KL");function a(e){var t,r=e.modulus.byteLength();do{t=new i(o(r))}while(t.cmp(e.modulus)>=0||!t.umod(e.prime1)||!t.umod(e.prime2));return t}function s(e,t){var n=function(e){var t=a(e);return{blinder:t.toRed(i.mont(e.modulus)).redPow(new i(e.publicExponent)).fromRed(),unblinder:t.invm(e.modulus)}}(t),o=t.modulus.byteLength(),s=new i(e).mul(n.blinder).umod(t.modulus),u=s.toRed(i.mont(t.prime1)),l=s.toRed(i.mont(t.prime2)),c=t.coefficient,d=t.prime1,f=t.prime2,h=u.redPow(t.exponent1).fromRed(),p=l.redPow(t.exponent2).fromRed(),v=h.isub(p).imul(c).umod(d).imul(f);return p.iadd(v).imul(n.unblinder).umod(t.modulus).toArrayLike(r,"be",o)}s.getr=a,e.exports=s})),n.register("llUdM",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var n=e.charCodeAt(t);return n>=48&&n<=57?n-48:n>=65&&n<=70?n-55:n>=97&&n<=102?n-87:void r(!1,"Invalid character in "+e)}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,n,i){for(var o=0,a=0,s=Math.min(e.length,n),u=t;u<s;u++){var l=e.charCodeAt(u)-48;o*=i,a=l>=49?l-49+10:l>=17?l-17+10:l,r(l>=0&&a<i,"Invalid character"),o+=a}return o}function c(e,t){e.words=t.words,e.length=t.length,e.negative=t.negative,e.red=t.red}if(o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this._strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this._strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this._strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype._move=function(e){c(e,this)},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{o.prototype[Symbol.for("nodejs.util.inspect.custom")]=d}catch(e){o.prototype.inspect=d}else o.prototype.inspect=d;function d(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],p=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);o=s>>>24-i&16777215,(i+=2)>=26&&(i-=26,a--),n=0!==o||a!==this.length-1?f[6-u.length]+u+n:u+n}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],c=p[e];n="";var d=this.clone();for(d.negative=0;!d.isZero();){var v=d.modrn(c).toString(e);n=(d=d.idivn(c)).isZero()?v+n:f[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16,2)},a&&(o.prototype.toBuffer=function(e,t){return this.toArrayLike(a,e,t)}),o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)};function v(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r._strip()}o.prototype.toArrayLike=function(e,t,n){this._strip();var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0");var a=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)}(e,o);return this["_toArrayLike"+("le"===t?"LE":"BE")](a,i),a},o.prototype._toArrayLikeLE=function(e,t){for(var r=0,n=0,i=0,o=0;i<this.length;i++){var a=this.words[i]<<o|n;e[r++]=255&a,r<e.length&&(e[r++]=a>>8&255),r<e.length&&(e[r++]=a>>16&255),6===o?(r<e.length&&(e[r++]=a>>24&255),n=0,o=0):(n=a>>>24,o+=2)}if(r<e.length)for(e[r++]=n;r<e.length;)e[r++]=0},o.prototype._toArrayLikeBE=function(e,t){for(var r=e.length-1,n=0,i=0,o=0;i<this.length;i++){var a=this.words[i]<<o|n;e[r--]=255&a,r>=0&&(e[r--]=a>>8&255),r>=0&&(e[r--]=a>>16&255),6===o?(r>=0&&(e[r--]=a>>24&255),n=0,o=0):(n=a>>>24,o+=2)}if(r>=0)for(e[r--]=n;r>=0;)e[r--]=0},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this._strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this._strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this._strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this._strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this._strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var g=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function m(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r._strip()}function y(e,t,r){return m(e,t,r)}function b(e,t){this.x=e,this.y=t}Math.imul||(g=v),o.prototype.mulTo=function(e,t){var r=this.length+e.length;return 10===this.length&&10===e.length?g(this,e,t):r<63?v(this,e,t):r<1024?m(this,e,t):y(this,e,t)},b.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},b.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},b.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},b.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},b.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},b.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},b.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},b.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},b.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},b.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r._strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),y(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){var t=e<0;t&&(e=-e),r("number"==typeof e),r(e<67108864);for(var n=0,i=0;i<this.length;i++){var o=(0|this.words[i])*e,a=(67108863&o)+(67108863&n);n>>=26,n+=o/67108864|0,n+=a>>>26,this.words[i]=67108863&a}return 0!==n&&(this.words[i]=n,this.length++),t?this.ineg():this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=e.words[n]>>>i&1}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this._strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this._strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this._strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this._strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this._strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s._strip(),n._strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modrn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modrn=function(e){var t=e<0;t&&(e=-e),r(e<=67108863);for(var n=67108864%e,i=0,o=this.length-1;o>=0;o--)i=(n*i+(0|this.words[o]))%e;return t?-i:i},o.prototype.modn=function(e){return this.modrn(e)},o.prototype.idivn=function(e){var t=e<0;t&&(e=-e),r(e<=67108863);for(var n=0,i=this.length-1;i>=0;i--){var o=(0|this.words[i])+67108864*n;this.words[i]=o/e|0,n=o%e}return this._strip(),t?this.ineg():this},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this._strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new C(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var _={k256:null,p224:null,p192:null,p25519:null};function w(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function S(){w.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function E(){w.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function k(){w.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function M(){w.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function C(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function I(e){C.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}w.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},w.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},w.prototype.split=function(e,t){e.iushrn(this.n,0,t)},w.prototype.imulK=function(e){return e.imul(this.k)},i(S,w),S.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},S.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(E,w),i(k,w),i(M,w),M.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(_[e])return _[e];var t;if("k256"===e)t=new S;else if("p224"===e)t=new E;else if("p192"===e)t=new k;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new M}return _[e]=t,t},C.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},C.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},C.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(c(e,e.umod(this.m)._forceRed(this)),e)},C.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},C.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},C.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},C.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},C.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},C.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},C.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},C.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},C.prototype.isqr=function(e){return this.imul(e,e.clone())},C.prototype.sqr=function(e){return this.mul(e,e)},C.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},C.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},C.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},C.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},C.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new I(e)},i(I,C),I.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},I.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},I.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},I.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},I.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("6bdf7",(function(e,t){"use strict";var r=e.exports;r.version=n("4Fat1").version,r.utils=n("9mLpu"),r.rand=n("5PiYS"),r.curve=n("OMmkO"),r.curves=n("c3Bg0"),r.ec=n("9Timd"),r.eddsa=n("18h3F")})),n.register("4Fat1",(function(e,t){e.exports=JSON.parse('{"name":"elliptic","version":"6.5.4","description":"EC cryptography","main":"lib/elliptic.js","files":["lib"],"scripts":{"lint":"eslint lib test","lint:fix":"npm run lint -- --fix","unit":"istanbul test _mocha --reporter=spec test/index.js","test":"npm run lint && npm run unit","version":"grunt dist && git add dist/"},"repository":{"type":"git","url":"git@github.com:indutny/elliptic"},"keywords":["EC","Elliptic","curve","Cryptography"],"author":"Fedor Indutny <fedor@indutny.com>","license":"MIT","bugs":{"url":"https://github.com/indutny/elliptic/issues"},"homepage":"https://github.com/indutny/elliptic","devDependencies":{"brfs":"^2.0.2","coveralls":"^3.1.0","eslint":"^7.6.0","grunt":"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1","istanbul":"^0.4.5","mocha":"^8.0.1"},"dependencies":{"bn.js":"^4.11.9","brorand":"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1","inherits":"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"}}')})),n.register("9mLpu",(function(e,t){"use strict";var r=e.exports,i=n("6X3DX"),o=n("3RkE5"),a=n("6Ucbh");r.assert=o,r.toArray=a.toArray,r.zero2=a.zero2,r.toHex=a.toHex,r.encode=a.encode,r.getNAF=function(e,t,r){var n=new Array(Math.max(e.bitLength(),r)+1);n.fill(0);for(var i=1<<t+1,o=e.clone(),a=0;a<n.length;a++){var s,u=o.andln(i-1);o.isOdd()?(s=u>(i>>1)-1?(i>>1)-u:u,o.isubn(s)):s=0,n[a]=s,o.iushrn(1)}return n},r.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var n,i=0,o=0;e.cmpn(-i)>0||t.cmpn(-o)>0;){var a,s,u=e.andln(3)+i&3,l=t.andln(3)+o&3;3===u&&(u=-1),3===l&&(l=-1),a=0==(1&u)?0:3!==(n=e.andln(7)+i&7)&&5!==n||2!==l?u:-u,r[0].push(a),s=0==(1&l)?0:3!==(n=t.andln(7)+o&7)&&5!==n||2!==u?l:-l,r[1].push(s),2*i===a+1&&(i=1-i),2*o===s+1&&(o=1-o),e.iushrn(1),t.iushrn(1)}return r},r.cachedProperty=function(e,t,r){var n="_"+t;e.prototype[t]=function(){return void 0!==this[n]?this[n]:this[n]=r.call(this)}},r.parseBytes=function(e){return"string"==typeof e?r.toArray(e,"hex"):e},r.intFromLE=function(e){return new i(e,"hex","le")}})),n.register("6X3DX",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,r,n){for(var i=0,o=Math.min(e.length,r),a=t;a<o;a++){var s=e.charCodeAt(a)-48;i*=n,i+=s>=49?s-49+10:s>=17?s-17+10:s}return i}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r.strip()}o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);n=0!==(o=s>>>24-i&16777215)||a!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,a--)}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],h=f[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var v=p.modn(h).toString(e);n=(p=p.idivn(h)).isZero()?v+n:c[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var a,s,u="le"===t,l=new e(o),c=this.clone();if(u){for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[s]=a;for(;s<o;s++)l[s]=0}else{for(s=0;s<o-i;s++)l[s]=0;for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[o-s-1]=a}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function v(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),o.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,e,t):v(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},g.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),v(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,o=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=o>>>26,this.words[n]=67108863&o}return 0!==t&&(this.words[n]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this.strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},i(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,y),i(w,y),i(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new _;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new k(e)},i(k,E),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("6Ucbh",(function(e,t){"use strict";var r=e.exports;function n(e){return 1===e.length?"0"+e:e}function i(e){for(var t="",r=0;r<e.length;r++)t+=n(e[r].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var n=0;n<e.length;n++)r[n]=0|e[n];return r}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16))}else for(n=0;n<e.length;n++){var i=e.charCodeAt(n),o=i>>8,a=255&i;o?r.push(o,a):r.push(a)}return r},r.zero2=n,r.toHex=i,r.encode=function(e,t){return"hex"===t?i(e):e}})),n.register("OMmkO",(function(e,t){"use strict";var r=e.exports;r.base=n("2eOuP"),r.short=n("6wdp2"),r.mont=n("dJ6k0"),r.edwards=n("ksALc")})),n.register("2eOuP",(function(e,t){"use strict";var r=n("6X3DX"),i=n("9mLpu"),o=i.getNAF,a=i.getJSF,s=i.assert;function u(e,t){this.type=e,this.p=new r(t.p,16),this.red=t.prime?r.red(t.prime):r.mont(this.p),this.zero=new r(0).toRed(this.red),this.one=new r(1).toRed(this.red),this.two=new r(2).toRed(this.red),this.n=t.n&&new r(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var n=this.n&&this.p.div(this.n);!n||n.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function l(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=u,u.prototype.point=function(){throw new Error("Not implemented")},u.prototype.validate=function(){throw new Error("Not implemented")},u.prototype._fixedNafMul=function(e,t){s(e.precomputed);var r=e._getDoubles(),n=o(t,1,this._bitLength),i=(1<<r.step+1)-(r.step%2==0?2:1);i/=3;var a,u,l=[];for(a=0;a<n.length;a+=r.step){u=0;for(var c=a+r.step-1;c>=a;c--)u=(u<<1)+n[c];l.push(u)}for(var d=this.jpoint(null,null,null),f=this.jpoint(null,null,null),h=i;h>0;h--){for(a=0;a<l.length;a++)(u=l[a])===h?f=f.mixedAdd(r.points[a]):u===-h&&(f=f.mixedAdd(r.points[a].neg()));d=d.add(f)}return d.toP()},u.prototype._wnafMul=function(e,t){var r=4,n=e._getNAFPoints(r);r=n.wnd;for(var i=n.points,a=o(t,r,this._bitLength),u=this.jpoint(null,null,null),l=a.length-1;l>=0;l--){for(var c=0;l>=0&&0===a[l];l--)c++;if(l>=0&&c++,u=u.dblp(c),l<0)break;var d=a[l];s(0!==d),u="affine"===e.type?d>0?u.mixedAdd(i[d-1>>1]):u.mixedAdd(i[-d-1>>1].neg()):d>0?u.add(i[d-1>>1]):u.add(i[-d-1>>1].neg())}return"affine"===e.type?u.toP():u},u.prototype._wnafMulAdd=function(e,t,r,n,i){var s,u,l,c=this._wnafT1,d=this._wnafT2,f=this._wnafT3,h=0;for(s=0;s<n;s++){var p=(l=t[s])._getNAFPoints(e);c[s]=p.wnd,d[s]=p.points}for(s=n-1;s>=1;s-=2){var v=s-1,g=s;if(1===c[v]&&1===c[g]){var m=[t[v],null,null,t[g]];0===t[v].y.cmp(t[g].y)?(m[1]=t[v].add(t[g]),m[2]=t[v].toJ().mixedAdd(t[g].neg())):0===t[v].y.cmp(t[g].y.redNeg())?(m[1]=t[v].toJ().mixedAdd(t[g]),m[2]=t[v].add(t[g].neg())):(m[1]=t[v].toJ().mixedAdd(t[g]),m[2]=t[v].toJ().mixedAdd(t[g].neg()));var y=[-3,-1,-5,-7,0,7,5,1,3],b=a(r[v],r[g]);for(h=Math.max(b[0].length,h),f[v]=new Array(h),f[g]=new Array(h),u=0;u<h;u++){var _=0|b[0][u],w=0|b[1][u];f[v][u]=y[3*(_+1)+(w+1)],f[g][u]=0,d[v]=m}}else f[v]=o(r[v],c[v],this._bitLength),f[g]=o(r[g],c[g],this._bitLength),h=Math.max(f[v].length,h),h=Math.max(f[g].length,h)}var S=this.jpoint(null,null,null),E=this._wnafT4;for(s=h;s>=0;s--){for(var k=0;s>=0;){var M=!0;for(u=0;u<n;u++)E[u]=0|f[u][s],0!==E[u]&&(M=!1);if(!M)break;k++,s--}if(s>=0&&k++,S=S.dblp(k),s<0)break;for(u=0;u<n;u++){var C=E[u];0!==C&&(C>0?l=d[u][C-1>>1]:C<0&&(l=d[u][-C-1>>1].neg()),S="affine"===l.type?S.mixedAdd(l):S.add(l))}}for(s=0;s<n;s++)d[s]=null;return i?S:S.toP()},u.BasePoint=l,l.prototype.eq=function(){throw new Error("Not implemented")},l.prototype.validate=function(){return this.curve.validate(this)},u.prototype.decodePoint=function(e,t){e=i.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?s(e[e.length-1]%2==0):7===e[0]&&s(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},l.prototype.encodeCompressed=function(e){return this.encode(e,!0)},l.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},l.prototype.encode=function(e,t){return i.encode(this._encode(t),e)},l.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},l.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},l.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],n=this,i=0;i<t;i+=e){for(var o=0;o<e;o++)n=n.dbl();r.push(n)}return{step:e,points:r}},l.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,n=1===r?null:this.dbl(),i=1;i<r;i++)t[i]=t[i-1].add(n);return{wnd:e,points:t}},l.prototype._getBeta=function(){return null},l.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}})),n.register("6wdp2",(function(e,t){"use strict";var r=n("9mLpu"),i=n("6X3DX"),o=n("fospZ"),a=n("2eOuP"),s=r.assert;function u(e){a.call(this,"short",e),this.a=new i(e.a,16).toRed(this.red),this.b=new i(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function l(e,t,r,n){a.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new i(t,16),this.y=new i(r,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function c(e,t,r,n){a.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===n?(this.x=this.curve.one,this.y=this.curve.one,this.z=new i(0)):(this.x=new i(t,16),this.y=new i(r,16),this.z=new i(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}o(u,a),e.exports=u,u.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,r;if(e.beta)t=new i(e.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);t=(t=n[0].cmp(n[1])<0?n[0]:n[1]).toRed(this.red)}if(e.lambda)r=new i(e.lambda,16);else{var o=this._getEndoRoots(this.n);0===this.g.mul(o[0]).x.cmp(this.g.x.redMul(t))?r=o[0]:(r=o[1],s(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:r,basis:e.basis?e.basis.map((function(e){return{a:new i(e.a,16),b:new i(e.b,16)}})):this._getEndoBasis(r)}}},u.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:i.mont(e),r=new i(2).toRed(t).redInvm(),n=r.redNeg(),o=new i(3).toRed(t).redNeg().redSqrt().redMul(r);return[n.redAdd(o).fromRed(),n.redSub(o).fromRed()]},u.prototype._getEndoBasis=function(e){for(var t,r,n,o,a,s,u,l,c,d=this.n.ushrn(Math.floor(this.n.bitLength()/2)),f=e,h=this.n.clone(),p=new i(1),v=new i(0),g=new i(0),m=new i(1),y=0;0!==f.cmpn(0);){var b=h.div(f);l=h.sub(b.mul(f)),c=g.sub(b.mul(p));var _=m.sub(b.mul(v));if(!n&&l.cmp(d)<0)t=u.neg(),r=p,n=l.neg(),o=c;else if(n&&2==++y)break;u=l,h=f,f=l,g=p,p=c,m=v,v=_}a=l.neg(),s=c;var w=n.sqr().add(o.sqr());return a.sqr().add(s.sqr()).cmp(w)>=0&&(a=t,s=r),n.negative&&(n=n.neg(),o=o.neg()),a.negative&&(a=a.neg(),s=s.neg()),[{a:n,b:o},{a:a,b:s}]},u.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],n=t[1],i=n.b.mul(e).divRound(this.n),o=r.b.neg().mul(e).divRound(this.n),a=i.mul(r.a),s=o.mul(n.a),u=i.mul(r.b),l=o.mul(n.b);return{k1:e.sub(a).sub(s),k2:u.add(l).neg()}},u.prototype.pointFromX=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=r.redSqrt();if(0!==n.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var o=n.fromRed().isOdd();return(t&&!o||!t&&o)&&(n=n.redNeg()),this.point(e,n)},u.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,n=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(n).redIAdd(this.b);return 0===r.redSqr().redISub(i).cmpn(0)},u.prototype._endoWnafMulAdd=function(e,t,r){for(var n=this._endoWnafT1,i=this._endoWnafT2,o=0;o<e.length;o++){var a=this._endoSplit(t[o]),s=e[o],u=s._getBeta();a.k1.negative&&(a.k1.ineg(),s=s.neg(!0)),a.k2.negative&&(a.k2.ineg(),u=u.neg(!0)),n[2*o]=s,n[2*o+1]=u,i[2*o]=a.k1,i[2*o+1]=a.k2}for(var l=this._wnafMulAdd(1,n,i,2*o,r),c=0;c<2*o;c++)n[c]=null,i[c]=null;return l},o(l,a.BasePoint),u.prototype.point=function(e,t,r){return new l(this,e,t,r)},u.prototype.pointFromJSON=function(e,t){return l.fromJSON(this,e,t)},l.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,n=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return t}},l.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},l.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var n=e.point(t[0],t[1],r);if(!t[2])return n;function i(t){return e.point(t[0],t[1],r)}var o=t[2];return n.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[n].concat(o.doubles.points.map(i))},naf:o.naf&&{wnd:o.naf.wnd,points:[n].concat(o.naf.points.map(i))}},n},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return this.inf},l.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),n=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,n)},l.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),n=e.redInvm(),i=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(n),o=i.redSqr().redISub(this.x.redAdd(this.x)),a=i.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,a)},l.prototype.getX=function(){return this.x.fromRed()},l.prototype.getY=function(){return this.y.fromRed()},l.prototype.mul=function(e){return e=new i(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},l.prototype.mulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i):this.curve._wnafMulAdd(1,n,i,2)},l.prototype.jmulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i,!0):this.curve._wnafMulAdd(1,n,i,2,!0)},l.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},l.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,n=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(n)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(n)}}}return t},l.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},o(c,a.BasePoint),u.prototype.jpoint=function(e,t,r){return new c(this,e,t,r)},c.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),n=this.y.redMul(t).redMul(e);return this.curve.point(r,n)},c.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},c.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),n=this.x.redMul(t),i=e.x.redMul(r),o=this.y.redMul(t.redMul(e.z)),a=e.y.redMul(r.redMul(this.z)),s=n.redSub(i),u=o.redSub(a);if(0===s.cmpn(0))return 0!==u.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var l=s.redSqr(),c=l.redMul(s),d=n.redMul(l),f=u.redSqr().redIAdd(c).redISub(d).redISub(d),h=u.redMul(d.redISub(f)).redISub(o.redMul(c)),p=this.z.redMul(e.z).redMul(s);return this.curve.jpoint(f,h,p)},c.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,n=e.x.redMul(t),i=this.y,o=e.y.redMul(t).redMul(this.z),a=r.redSub(n),s=i.redSub(o);if(0===a.cmpn(0))return 0!==s.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var u=a.redSqr(),l=u.redMul(a),c=r.redMul(u),d=s.redSqr().redIAdd(l).redISub(c).redISub(c),f=s.redMul(c.redISub(d)).redISub(i.redMul(l)),h=this.z.redMul(a);return this.curve.jpoint(d,f,h)},c.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var n=this.curve.a,i=this.curve.tinv,o=this.x,a=this.y,s=this.z,u=s.redSqr().redSqr(),l=a.redAdd(a);for(t=0;t<e;t++){var c=o.redSqr(),d=l.redSqr(),f=d.redSqr(),h=c.redAdd(c).redIAdd(c).redIAdd(n.redMul(u)),p=o.redMul(d),v=h.redSqr().redISub(p.redAdd(p)),g=p.redISub(v),m=h.redMul(g);m=m.redIAdd(m).redISub(f);var y=l.redMul(s);t+1<e&&(u=u.redMul(f)),o=v,s=y,l=m}return this.curve.jpoint(o,l.redMul(i),s)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},c.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),o=i.redSqr(),a=this.x.redAdd(i).redSqr().redISub(n).redISub(o);a=a.redIAdd(a);var s=n.redAdd(n).redIAdd(n),u=s.redSqr().redISub(a).redISub(a),l=o.redIAdd(o);l=(l=l.redIAdd(l)).redIAdd(l),e=u,t=s.redMul(a.redISub(u)).redISub(l),r=this.y.redAdd(this.y)}else{var c=this.x.redSqr(),d=this.y.redSqr(),f=d.redSqr(),h=this.x.redAdd(d).redSqr().redISub(c).redISub(f);h=h.redIAdd(h);var p=c.redAdd(c).redIAdd(c),v=p.redSqr(),g=f.redIAdd(f);g=(g=g.redIAdd(g)).redIAdd(g),e=v.redISub(h).redISub(h),t=p.redMul(h.redISub(e)).redISub(g),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},c.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),o=i.redSqr(),a=this.x.redAdd(i).redSqr().redISub(n).redISub(o);a=a.redIAdd(a);var s=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),u=s.redSqr().redISub(a).redISub(a);e=u;var l=o.redIAdd(o);l=(l=l.redIAdd(l)).redIAdd(l),t=s.redMul(a.redISub(u)).redISub(l),r=this.y.redAdd(this.y)}else{var c=this.z.redSqr(),d=this.y.redSqr(),f=this.x.redMul(d),h=this.x.redSub(c).redMul(this.x.redAdd(c));h=h.redAdd(h).redIAdd(h);var p=f.redIAdd(f),v=(p=p.redIAdd(p)).redAdd(p);e=h.redSqr().redISub(v),r=this.y.redAdd(this.z).redSqr().redISub(d).redISub(c);var g=d.redSqr();g=(g=(g=g.redIAdd(g)).redIAdd(g)).redIAdd(g),t=h.redMul(p.redISub(e)).redISub(g)}return this.curve.jpoint(e,t,r)},c.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,n=this.z,i=n.redSqr().redSqr(),o=t.redSqr(),a=r.redSqr(),s=o.redAdd(o).redIAdd(o).redIAdd(e.redMul(i)),u=t.redAdd(t),l=(u=u.redIAdd(u)).redMul(a),c=s.redSqr().redISub(l.redAdd(l)),d=l.redISub(c),f=a.redSqr();f=(f=(f=f.redIAdd(f)).redIAdd(f)).redIAdd(f);var h=s.redMul(d).redISub(f),p=r.redAdd(r).redMul(n);return this.curve.jpoint(c,h,p)},c.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),n=t.redSqr(),i=e.redAdd(e).redIAdd(e),o=i.redSqr(),a=this.x.redAdd(t).redSqr().redISub(e).redISub(n),s=(a=(a=(a=a.redIAdd(a)).redAdd(a).redIAdd(a)).redISub(o)).redSqr(),u=n.redIAdd(n);u=(u=(u=u.redIAdd(u)).redIAdd(u)).redIAdd(u);var l=i.redIAdd(a).redSqr().redISub(o).redISub(s).redISub(u),c=t.redMul(l);c=(c=c.redIAdd(c)).redIAdd(c);var d=this.x.redMul(s).redISub(c);d=(d=d.redIAdd(d)).redIAdd(d);var f=this.y.redMul(l.redMul(u.redISub(l)).redISub(a.redMul(s)));f=(f=(f=f.redIAdd(f)).redIAdd(f)).redIAdd(f);var h=this.z.redAdd(a).redSqr().redISub(r).redISub(s);return this.curve.jpoint(d,f,h)},c.prototype.mul=function(e,t){return e=new i(e,t),this.curve._wnafMul(this,e)},c.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var n=t.redMul(this.z),i=r.redMul(e.z);return 0===this.y.redMul(i).redISub(e.y.redMul(n)).cmpn(0)},c.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var n=e.clone(),i=this.curve.redN.redMul(t);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(i),0===this.x.cmp(r))return!0}},c.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}})),n.register("dJ6k0",(function(e,t){"use strict";var r=n("6X3DX"),i=n("fospZ"),o=n("2eOuP"),a=n("9mLpu");function s(e){o.call(this,"mont",e),this.a=new r(e.a,16).toRed(this.red),this.b=new r(e.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function u(e,t,n){o.BasePoint.call(this,e,"projective"),null===t&&null===n?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(t,16),this.z=new r(n,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}i(s,o),e.exports=s,s.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),n=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===n.redSqrt().redSqr().cmp(n)},i(u,o.BasePoint),s.prototype.decodePoint=function(e,t){return this.point(a.toArray(e,t),1)},s.prototype.point=function(e,t){return new u(this,e,t)},s.prototype.pointFromJSON=function(e){return u.fromJSON(this,e)},u.prototype.precompute=function(){},u.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},u.fromJSON=function(e,t){return new u(e,t[0],t[1]||e.one)},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},u.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),n=e.redMul(t),i=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(n,i)},u.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},u.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),n=this.x.redSub(this.z),i=e.x.redAdd(e.z),o=e.x.redSub(e.z).redMul(r),a=i.redMul(n),s=t.z.redMul(o.redAdd(a).redSqr()),u=t.x.redMul(o.redISub(a).redSqr());return this.curve.point(s,u)},u.prototype.mul=function(e){for(var t=e.clone(),r=this,n=this.curve.point(null,null),i=[];0!==t.cmpn(0);t.iushrn(1))i.push(t.andln(1));for(var o=i.length-1;o>=0;o--)0===i[o]?(r=r.diffAdd(n,this),n=n.dbl()):(n=r.diffAdd(n,this),r=r.dbl());return n},u.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},u.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},u.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},u.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},u.prototype.getX=function(){return this.normalize(),this.x.fromRed()}})),n.register("ksALc",(function(e,t){"use strict";var r=n("9mLpu"),i=n("6X3DX"),o=n("fospZ"),a=n("2eOuP"),s=r.assert;function u(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,a.call(this,"edwards",e),this.a=new i(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new i(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new i(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),s(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function l(e,t,r,n,o){a.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===n?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new i(t,16),this.y=new i(r,16),this.z=n?new i(n,16):this.curve.one,this.t=o&&new i(o,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}o(u,a),e.exports=u,u.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},u.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},u.prototype.jpoint=function(e,t,r,n){return this.point(e,t,r,n)},u.prototype.pointFromX=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=this.c2.redSub(this.a.redMul(r)),o=this.one.redSub(this.c2.redMul(this.d).redMul(r)),a=n.redMul(o.redInvm()),s=a.redSqrt();if(0!==s.redSqr().redSub(a).cmp(this.zero))throw new Error("invalid point");var u=s.fromRed().isOdd();return(t&&!u||!t&&u)&&(s=s.redNeg()),this.point(e,s)},u.prototype.pointFromY=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=r.redSub(this.c2),o=r.redMul(this.d).redMul(this.c2).redSub(this.a),a=n.redMul(o.redInvm());if(0===a.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var s=a.redSqrt();if(0!==s.redSqr().redSub(a).cmp(this.zero))throw new Error("invalid point");return s.fromRed().isOdd()!==t&&(s=s.redNeg()),this.point(s,e)},u.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),n=t.redMul(this.a).redAdd(r),i=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===n.cmp(i)},o(l,a.BasePoint),u.prototype.pointFromJSON=function(e){return l.fromJSON(this,e)},u.prototype.point=function(e,t,r,n){return new l(this,e,t,r,n)},l.fromJSON=function(e,t){return new l(e,t[0],t[1],t[2])},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},l.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var n=this.curve._mulA(e),i=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),o=n.redAdd(t),a=o.redSub(r),s=n.redSub(t),u=i.redMul(a),l=o.redMul(s),c=i.redMul(s),d=a.redMul(o);return this.curve.point(u,l,d,c)},l.prototype._projDbl=function(){var e,t,r,n,i,o,a=this.x.redAdd(this.y).redSqr(),s=this.x.redSqr(),u=this.y.redSqr();if(this.curve.twisted){var l=(n=this.curve._mulA(s)).redAdd(u);this.zOne?(e=a.redSub(s).redSub(u).redMul(l.redSub(this.curve.two)),t=l.redMul(n.redSub(u)),r=l.redSqr().redSub(l).redSub(l)):(i=this.z.redSqr(),o=l.redSub(i).redISub(i),e=a.redSub(s).redISub(u).redMul(o),t=l.redMul(n.redSub(u)),r=l.redMul(o))}else n=s.redAdd(u),i=this.curve._mulC(this.z).redSqr(),o=n.redSub(i).redSub(i),e=this.curve._mulC(a.redISub(n)).redMul(o),t=this.curve._mulC(n).redMul(s.redISub(u)),r=n.redMul(o);return this.curve.point(e,t,r)},l.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},l.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),n=this.t.redMul(this.curve.dd).redMul(e.t),i=this.z.redMul(e.z.redAdd(e.z)),o=r.redSub(t),a=i.redSub(n),s=i.redAdd(n),u=r.redAdd(t),l=o.redMul(a),c=s.redMul(u),d=o.redMul(u),f=a.redMul(s);return this.curve.point(l,c,f,d)},l.prototype._projAdd=function(e){var t,r,n=this.z.redMul(e.z),i=n.redSqr(),o=this.x.redMul(e.x),a=this.y.redMul(e.y),s=this.curve.d.redMul(o).redMul(a),u=i.redSub(s),l=i.redAdd(s),c=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(o).redISub(a),d=n.redMul(u).redMul(c);return this.curve.twisted?(t=n.redMul(l).redMul(a.redSub(this.curve._mulA(o))),r=u.redMul(l)):(t=n.redMul(l).redMul(a.redSub(o)),r=this.curve._mulC(u).redMul(l)),this.curve.point(d,t,r)},l.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},l.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},l.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},l.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},l.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},l.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},l.prototype.getX=function(){return this.normalize(),this.x.fromRed()},l.prototype.getY=function(){return this.normalize(),this.y.fromRed()},l.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},l.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),n=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(n),0===this.x.cmp(t))return!0}},l.prototype.toP=l.prototype.normalize,l.prototype.mixedAdd=l.prototype.add})),n.register("c3Bg0",(function(e,t){"use strict";var r,i=e.exports,o=n("ju19f"),a=n("OMmkO"),s=n("9mLpu").assert;function u(e){"short"===e.type?this.curve=new a.short(e):"edwards"===e.type?this.curve=new a.edwards(e):this.curve=new a.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,s(this.g.validate(),"Invalid curve"),s(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function l(e,t){Object.defineProperty(i,e,{configurable:!0,enumerable:!0,get:function(){var r=new u(t);return Object.defineProperty(i,e,{configurable:!0,enumerable:!0,value:r}),r}})}i.PresetCurve=u,l("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:o.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),l("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:o.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),l("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:o.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),l("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:o.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),l("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:o.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),l("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:o.sha256,gRed:!1,g:["9"]}),l("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:o.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{r=n("6PP73")}catch(e){r=void 0}l("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:o.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",r]})})),n.register("ju19f",(function(e,t){var r=e.exports;r.utils=n("9vXwC"),r.common=n("9W8jH"),r.sha=n("jSPAM"),r.ripemd=n("4nzMx"),r.hmac=n("bWF0N"),r.sha1=r.sha.sha1,r.sha256=r.sha.sha256,r.sha224=r.sha.sha224,r.sha384=r.sha.sha384,r.sha512=r.sha.sha512,r.ripemd160=r.ripemd.ripemd160})),n.register("9vXwC",(function(t,r){var i,o,a,s,u,l,c,d,f,h,p,v,g,m,y,b,_,w,S,E,k,M,C,I,T,R;e(t.exports,"inherits",(function(){return i}),(function(e){return i=e})),e(t.exports,"toArray",(function(){return o}),(function(e){return o=e})),e(t.exports,"toHex",(function(){return a}),(function(e){return a=e})),e(t.exports,"htonl",(function(){return s}),(function(e){return s=e})),e(t.exports,"toHex32",(function(){return u}),(function(e){return u=e})),e(t.exports,"zero2",(function(){return l}),(function(e){return l=e})),e(t.exports,"zero8",(function(){return c}),(function(e){return c=e})),e(t.exports,"join32",(function(){return d}),(function(e){return d=e})),e(t.exports,"split32",(function(){return f}),(function(e){return f=e})),e(t.exports,"rotr32",(function(){return h}),(function(e){return h=e})),e(t.exports,"rotl32",(function(){return p}),(function(e){return p=e})),e(t.exports,"sum32",(function(){return v}),(function(e){return v=e})),e(t.exports,"sum32_3",(function(){return g}),(function(e){return g=e})),e(t.exports,"sum32_4",(function(){return m}),(function(e){return m=e})),e(t.exports,"sum32_5",(function(){return y}),(function(e){return y=e})),e(t.exports,"sum64",(function(){return b}),(function(e){return b=e})),e(t.exports,"sum64_hi",(function(){return _}),(function(e){return _=e})),e(t.exports,"sum64_lo",(function(){return w}),(function(e){return w=e})),e(t.exports,"sum64_4_hi",(function(){return S}),(function(e){return S=e})),e(t.exports,"sum64_4_lo",(function(){return E}),(function(e){return E=e})),e(t.exports,"sum64_5_hi",(function(){return k}),(function(e){return k=e})),e(t.exports,"sum64_5_lo",(function(){return M}),(function(e){return M=e})),e(t.exports,"rotr64_hi",(function(){return C}),(function(e){return C=e})),e(t.exports,"rotr64_lo",(function(){return I}),(function(e){return I=e})),e(t.exports,"shr64_hi",(function(){return T}),(function(e){return T=e})),e(t.exports,"shr64_lo",(function(){return R}),(function(e){return R=e}));var x=n("3RkE5"),O=n("fospZ");function A(e,t){return 55296==(64512&e.charCodeAt(t))&&(!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1)))}function D(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function P(e){return 1===e.length?"0"+e:e}function L(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}i=O,o=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(var n=0,i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?r[n++]=o:o<2048?(r[n++]=o>>6|192,r[n++]=63&o|128):A(e,i)?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++i)),r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128):(r[n++]=o>>12|224,r[n++]=o>>6&63|128,r[n++]=63&o|128)}else for(i=0;i<e.length;i++)r[i]=0|e[i];return r},a=function(e){for(var t="",r=0;r<e.length;r++)t+=P(e[r].toString(16));return t},s=D,u=function(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];"little"===t&&(i=D(i)),r+=L(i.toString(16))}return r},l=P,c=L,d=function(e,t,r,n){var i=r-t;x(i%4==0);for(var o=new Array(i/4),a=0,s=t;a<o.length;a++,s+=4){var u;u="big"===n?e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3]:e[s+3]<<24|e[s+2]<<16|e[s+1]<<8|e[s],o[a]=u>>>0}return o},f=function(e,t){for(var r=new Array(4*e.length),n=0,i=0;n<e.length;n++,i+=4){var o=e[n];"big"===t?(r[i]=o>>>24,r[i+1]=o>>>16&255,r[i+2]=o>>>8&255,r[i+3]=255&o):(r[i+3]=o>>>24,r[i+2]=o>>>16&255,r[i+1]=o>>>8&255,r[i]=255&o)}return r},h=function(e,t){return e>>>t|e<<32-t},p=function(e,t){return e<<t|e>>>32-t},v=function(e,t){return e+t>>>0},g=function(e,t,r){return e+t+r>>>0},m=function(e,t,r,n){return e+t+r+n>>>0},y=function(e,t,r,n,i){return e+t+r+n+i>>>0},b=function(e,t,r,n){var i=e[t],o=n+e[t+1]>>>0,a=(o<n?1:0)+r+i;e[t]=a>>>0,e[t+1]=o},_=function(e,t,r,n){return(t+n>>>0<t?1:0)+e+r>>>0},w=function(e,t,r,n){return t+n>>>0},S=function(e,t,r,n,i,o,a,s){var u=0,l=t;return u+=(l=l+n>>>0)<t?1:0,u+=(l=l+o>>>0)<o?1:0,e+r+i+a+(u+=(l=l+s>>>0)<s?1:0)>>>0},E=function(e,t,r,n,i,o,a,s){return t+n+o+s>>>0},k=function(e,t,r,n,i,o,a,s,u,l){var c=0,d=t;return c+=(d=d+n>>>0)<t?1:0,c+=(d=d+o>>>0)<o?1:0,c+=(d=d+s>>>0)<s?1:0,e+r+i+a+u+(c+=(d=d+l>>>0)<l?1:0)>>>0},M=function(e,t,r,n,i,o,a,s,u,l){return t+n+o+s+l>>>0},C=function(e,t,r){return(t<<32-r|e>>>r)>>>0},I=function(e,t,r){return(e<<32-r|t>>>r)>>>0},T=function(e,t,r){return e>>>r},R=function(e,t,r){return(e<<32-r|t>>>r)>>>0}})),n.register("9W8jH",(function(t,r){var i;e(t.exports,"BlockHash",(function(){return i}),(function(e){return i=e}));var o=n("9vXwC"),a=n("3RkE5");function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}i=s,s.prototype.update=function(e,t){if(e=o.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=o.join32(e,0,e.length-r,this.endian);for(var n=0;n<e.length;n+=this._delta32)this._update(e,n,n+this._delta32)}return this},s.prototype.digest=function(e){return this.update(this._pad()),a(null===this.pending),this._digest(e)},s.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=new Array(r+this.padLength);n[0]=128;for(var i=1;i<r;i++)n[i]=0;if(e<<=3,"big"===this.endian){for(var o=8;o<this.padLength;o++)n[i++]=0;n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=e>>>24&255,n[i++]=e>>>16&255,n[i++]=e>>>8&255,n[i++]=255&e}else for(n[i++]=255&e,n[i++]=e>>>8&255,n[i++]=e>>>16&255,n[i++]=e>>>24&255,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,o=8;o<this.padLength;o++)n[i++]=0;return n}})),n.register("jSPAM",(function(t,r){var i,o,a,s,u;e(t.exports,"sha1",(function(){return i}),(function(e){return i=e})),e(t.exports,"sha224",(function(){return o}),(function(e){return o=e})),e(t.exports,"sha256",(function(){return a}),(function(e){return a=e})),e(t.exports,"sha384",(function(){return s}),(function(e){return s=e})),e(t.exports,"sha512",(function(){return u}),(function(e){return u=e})),i=n("dpDzJ"),o=n("cZahY"),a=n("46hIm"),s=n("dNo1l"),u=n("79TuS")})),n.register("dpDzJ",(function(e,t){"use strict";var r=n("9vXwC"),i=n("9W8jH"),o=n("4Y2My"),a=r.rotl32,s=r.sum32,u=r.sum32_5,l=o.ft_1,c=i.BlockHash,d=[1518500249,1859775393,2400959708,3395469782];function f(){if(!(this instanceof f))return new f;c.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}r.inherits(f,c),e.exports=f,f.blockSize=512,f.outSize=160,f.hmacStrength=80,f.padLength=64,f.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=a(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var i=this.h[0],o=this.h[1],c=this.h[2],f=this.h[3],h=this.h[4];for(n=0;n<r.length;n++){var p=~~(n/20),v=u(a(i,5),l(p,o,c,f),h,r[n],d[p]);h=f,f=c,c=a(o,30),o=i,i=v}this.h[0]=s(this.h[0],i),this.h[1]=s(this.h[1],o),this.h[2]=s(this.h[2],c),this.h[3]=s(this.h[3],f),this.h[4]=s(this.h[4],h)},f.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}})),n.register("4Y2My",(function(t,r){var i,o,a,s,u,l,c;e(t.exports,"ft_1",(function(){return i}),(function(e){return i=e})),e(t.exports,"ch32",(function(){return o}),(function(e){return o=e})),e(t.exports,"maj32",(function(){return a}),(function(e){return a=e})),e(t.exports,"s0_256",(function(){return s}),(function(e){return s=e})),e(t.exports,"s1_256",(function(){return u}),(function(e){return u=e})),e(t.exports,"g0_256",(function(){return l}),(function(e){return l=e})),e(t.exports,"g1_256",(function(){return c}),(function(e){return c=e}));var d=n("9vXwC").rotr32;function f(e,t,r){return e&t^~e&r}function h(e,t,r){return e&t^e&r^t&r}function p(e,t,r){return e^t^r}i=function(e,t,r,n){return 0===e?f(t,r,n):1===e||3===e?p(t,r,n):2===e?h(t,r,n):void 0},o=f,a=h,s=function(e){return d(e,2)^d(e,13)^d(e,22)},u=function(e){return d(e,6)^d(e,11)^d(e,25)},l=function(e){return d(e,7)^d(e,18)^e>>>3},c=function(e){return d(e,17)^d(e,19)^e>>>10}})),n.register("cZahY",(function(e,t){"use strict";var r=n("9vXwC"),i=n("46hIm");function o(){if(!(this instanceof o))return new o;i.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}r.inherits(o,i),e.exports=o,o.blockSize=512,o.outSize=224,o.hmacStrength=192,o.padLength=64,o.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h.slice(0,7),"big"):r.split32(this.h.slice(0,7),"big")}})),n.register("46hIm",(function(e,t){"use strict";var r=n("9vXwC"),i=n("9W8jH"),o=n("4Y2My"),a=n("3RkE5"),s=r.sum32,u=r.sum32_4,l=r.sum32_5,c=o.ch32,d=o.maj32,f=o.s0_256,h=o.s1_256,p=o.g0_256,v=o.g1_256,g=i.BlockHash,m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function y(){if(!(this instanceof y))return new y;g.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=m,this.W=new Array(64)}r.inherits(y,g),e.exports=y,y.blockSize=512,y.outSize=256,y.hmacStrength=192,y.padLength=64,y.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=u(v(r[n-2]),r[n-7],p(r[n-15]),r[n-16]);var i=this.h[0],o=this.h[1],g=this.h[2],m=this.h[3],y=this.h[4],b=this.h[5],_=this.h[6],w=this.h[7];for(a(this.k.length===r.length),n=0;n<r.length;n++){var S=l(w,h(y),c(y,b,_),this.k[n],r[n]),E=s(f(i),d(i,o,g));w=_,_=b,b=y,y=s(m,S),m=g,g=o,o=i,i=s(S,E)}this.h[0]=s(this.h[0],i),this.h[1]=s(this.h[1],o),this.h[2]=s(this.h[2],g),this.h[3]=s(this.h[3],m),this.h[4]=s(this.h[4],y),this.h[5]=s(this.h[5],b),this.h[6]=s(this.h[6],_),this.h[7]=s(this.h[7],w)},y.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}})),n.register("dNo1l",(function(e,t){"use strict";var r=n("9vXwC"),i=n("79TuS");function o(){if(!(this instanceof o))return new o;i.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}r.inherits(o,i),e.exports=o,o.blockSize=1024,o.outSize=384,o.hmacStrength=192,o.padLength=128,o.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h.slice(0,12),"big"):r.split32(this.h.slice(0,12),"big")}})),n.register("79TuS",(function(e,t){"use strict";var r=n("9vXwC"),i=n("9W8jH"),o=n("3RkE5"),a=r.rotr64_hi,s=r.rotr64_lo,u=r.shr64_hi,l=r.shr64_lo,c=r.sum64,d=r.sum64_hi,f=r.sum64_lo,h=r.sum64_4_hi,p=r.sum64_4_lo,v=r.sum64_5_hi,g=r.sum64_5_lo,m=i.BlockHash,y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function b(){if(!(this instanceof b))return new b;m.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=y,this.W=new Array(160)}function _(e,t,r,n,i){var o=e&r^~e&i;return o<0&&(o+=4294967296),o}function w(e,t,r,n,i,o){var a=t&n^~t&o;return a<0&&(a+=4294967296),a}function S(e,t,r,n,i){var o=e&r^e&i^r&i;return o<0&&(o+=4294967296),o}function E(e,t,r,n,i,o){var a=t&n^t&o^n&o;return a<0&&(a+=4294967296),a}function k(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=4294967296),r}function M(e,t){var r=s(e,t,28)^s(t,e,2)^s(t,e,7);return r<0&&(r+=4294967296),r}function C(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=4294967296),r}function I(e,t){var r=s(e,t,14)^s(e,t,18)^s(t,e,9);return r<0&&(r+=4294967296),r}function T(e,t){var r=a(e,t,1)^a(e,t,8)^u(e,t,7);return r<0&&(r+=4294967296),r}function R(e,t){var r=s(e,t,1)^s(e,t,8)^l(e,t,7);return r<0&&(r+=4294967296),r}function x(e,t){var r=a(e,t,19)^a(t,e,29)^u(e,t,6);return r<0&&(r+=4294967296),r}function O(e,t){var r=s(e,t,19)^s(t,e,29)^l(e,t,6);return r<0&&(r+=4294967296),r}r.inherits(b,m),e.exports=b,b.blockSize=1024,b.outSize=512,b.hmacStrength=192,b.padLength=128,b.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var i=x(r[n-4],r[n-3]),o=O(r[n-4],r[n-3]),a=r[n-14],s=r[n-13],u=T(r[n-30],r[n-29]),l=R(r[n-30],r[n-29]),c=r[n-32],d=r[n-31];r[n]=h(i,o,a,s,u,l,c,d),r[n+1]=p(i,o,a,s,u,l,c,d)}},b.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],i=this.h[1],a=this.h[2],s=this.h[3],u=this.h[4],l=this.h[5],h=this.h[6],p=this.h[7],m=this.h[8],y=this.h[9],b=this.h[10],T=this.h[11],R=this.h[12],x=this.h[13],O=this.h[14],A=this.h[15];o(this.k.length===r.length);for(var D=0;D<r.length;D+=2){var P=O,L=A,U=C(m,y),j=I(m,y),N=_(m,y,b,T,R),B=w(m,y,b,T,R,x),F=this.k[D],K=this.k[D+1],q=r[D],W=r[D+1],V=v(P,L,U,j,N,B,F,K,q,W),H=g(P,L,U,j,N,B,F,K,q,W);P=k(n,i),L=M(n,i),U=S(n,i,a,s,u),j=E(n,i,a,s,u,l);var G=d(P,L,U,j),z=f(P,L,U,j);O=R,A=x,R=b,x=T,b=m,T=y,m=d(h,p,V,H),y=f(p,p,V,H),h=u,p=l,u=a,l=s,a=n,s=i,n=d(V,H,G,z),i=f(V,H,G,z)}c(this.h,0,n,i),c(this.h,2,a,s),c(this.h,4,u,l),c(this.h,6,h,p),c(this.h,8,m,y),c(this.h,10,b,T),c(this.h,12,R,x),c(this.h,14,O,A)},b.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}})),n.register("4nzMx",(function(t,r){var i;e(t.exports,"ripemd160",(function(){return i}),(function(e){return i=e}));var o=n("9vXwC"),a=n("9W8jH"),s=o.rotl32,u=o.sum32,l=o.sum32_3,c=o.sum32_4,d=a.BlockHash;function f(){if(!(this instanceof f))return new f;d.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function h(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}function p(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function v(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}o.inherits(f,d),i=f,f.blockSize=512,f.outSize=160,f.hmacStrength=192,f.padLength=64,f.prototype._update=function(e,t){for(var r=this.h[0],n=this.h[1],i=this.h[2],o=this.h[3],a=this.h[4],d=r,f=n,_=i,w=o,S=a,E=0;E<80;E++){var k=u(s(c(r,h(E,n,i,o),e[g[E]+t],p(E)),y[E]),a);r=a,a=o,o=s(i,10),i=n,n=k,k=u(s(c(d,h(79-E,f,_,w),e[m[E]+t],v(E)),b[E]),S),d=S,S=w,w=s(_,10),_=f,f=k}k=l(this.h[1],i,w),this.h[1]=l(this.h[2],o,S),this.h[2]=l(this.h[3],a,d),this.h[3]=l(this.h[4],r,f),this.h[4]=l(this.h[0],n,_),this.h[0]=k},f.prototype._digest=function(e){return"hex"===e?o.toHex32(this.h,"little"):o.split32(this.h,"little")};var g=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],m=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],y=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],b=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]})),n.register("bWF0N",(function(e,t){"use strict";var r=n("9vXwC"),i=n("3RkE5");function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(r.toArray(t,n))}e.exports=o,o.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),i(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},o.prototype.update=function(e,t){return this.inner.update(e,t),this},o.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}})),n.register("6PP73",(function(e,t){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}})),n.register("9Timd",(function(e,t){"use strict";var r=n("6X3DX"),i=n("8nywR"),o=n("9mLpu"),a=n("c3Bg0"),s=n("5PiYS"),u=o.assert,l=n("2v7Hm"),c=n("buZdZ");function d(e){if(!(this instanceof d))return new d(e);"string"==typeof e&&(u(Object.prototype.hasOwnProperty.call(a,e),"Unknown curve "+e),e=a[e]),e instanceof a.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=d,d.prototype.keyPair=function(e){return new l(this,e)},d.prototype.keyFromPrivate=function(e,t){return l.fromPrivate(this,e,t)},d.prototype.keyFromPublic=function(e,t){return l.fromPublic(this,e,t)},d.prototype.genKeyPair=function(e){e||(e={});for(var t=new i({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||s(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),n=this.n.byteLength(),o=this.n.sub(new r(2));;){var a=new r(t.generate(n));if(!(a.cmp(o)>0))return a.iaddn(1),this.keyFromPrivate(a)}},d.prototype._truncateToN=function(e,t){var r=8*e.byteLength()-this.n.bitLength();return r>0&&(e=e.ushrn(r)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},d.prototype.sign=function(e,t,n,o){"object"==typeof n&&(o=n,n=null),o||(o={}),t=this.keyFromPrivate(t,n),e=this._truncateToN(new r(e,16));for(var a=this.n.byteLength(),s=t.getPrivate().toArray("be",a),u=e.toArray("be",a),l=new i({hash:this.hash,entropy:s,nonce:u,pers:o.pers,persEnc:o.persEnc||"utf8"}),d=this.n.sub(new r(1)),f=0;;f++){var h=o.k?o.k(f):new r(l.generate(this.n.byteLength()));if(!((h=this._truncateToN(h,!0)).cmpn(1)<=0||h.cmp(d)>=0)){var p=this.g.mul(h);if(!p.isInfinity()){var v=p.getX(),g=v.umod(this.n);if(0!==g.cmpn(0)){var m=h.invm(this.n).mul(g.mul(t.getPrivate()).iadd(e));if(0!==(m=m.umod(this.n)).cmpn(0)){var y=(p.getY().isOdd()?1:0)|(0!==v.cmp(g)?2:0);return o.canonical&&m.cmp(this.nh)>0&&(m=this.n.sub(m),y^=1),new c({r:g,s:m,recoveryParam:y})}}}}}},d.prototype.verify=function(e,t,n,i){e=this._truncateToN(new r(e,16)),n=this.keyFromPublic(n,i);var o=(t=new c(t,"hex")).r,a=t.s;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;if(a.cmpn(1)<0||a.cmp(this.n)>=0)return!1;var s,u=a.invm(this.n),l=u.mul(e).umod(this.n),d=u.mul(o).umod(this.n);return this.curve._maxwellTrick?!(s=this.g.jmulAdd(l,n.getPublic(),d)).isInfinity()&&s.eqXToP(o):!(s=this.g.mulAdd(l,n.getPublic(),d)).isInfinity()&&0===s.getX().umod(this.n).cmp(o)},d.prototype.recoverPubKey=function(e,t,n,i){u((3&n)===n,"The recovery param is more than two bits"),t=new c(t,i);var o=this.n,a=new r(e),s=t.r,l=t.s,d=1&n,f=n>>1;if(s.cmp(this.curve.p.umod(this.curve.n))>=0&&f)throw new Error("Unable to find sencond key candinate");s=f?this.curve.pointFromX(s.add(this.curve.n),d):this.curve.pointFromX(s,d);var h=t.r.invm(o),p=o.sub(a).mul(h).umod(o),v=l.mul(h).umod(o);return this.g.mulAdd(p,s,v)},d.prototype.getKeyRecoveryParam=function(e,t,r,n){if(null!==(t=new c(t,n)).recoveryParam)return t.recoveryParam;for(var i=0;i<4;i++){var o;try{o=this.recoverPubKey(e,t,i)}catch(e){continue}if(o.eq(r))return i}throw new Error("Unable to find valid recovery factor")}})),n.register("8nywR",(function(e,t){"use strict";var r=n("ju19f"),i=n("6Ucbh"),o=n("3RkE5");function a(e){if(!(this instanceof a))return new a(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=i.toArray(e.entropy,e.entropyEnc||"hex"),r=i.toArray(e.nonce,e.nonceEnc||"hex"),n=i.toArray(e.pers,e.persEnc||"hex");o(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,n)}e.exports=a,a.prototype._init=function(e,t,r){var n=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++)this.K[i]=0,this.V[i]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},a.prototype._hmac=function(){return new r.hmac(this.hash,this.K)},a.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},a.prototype.reseed=function(e,t,r,n){"string"!=typeof t&&(n=r,r=t,t=null),e=i.toArray(e,t),r=i.toArray(r,n),o(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},a.prototype.generate=function(e,t,r,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(n=r,r=t,t=null),r&&(r=i.toArray(r,n||"hex"),this._update(r));for(var o=[];o.length<e;)this.V=this._hmac().update(this.V).digest(),o=o.concat(this.V);var a=o.slice(0,e);return this._update(r),this._reseed++,i.encode(a,t)}})),n.register("2v7Hm",(function(e,t){"use strict";var r=n("6X3DX"),i=n("9mLpu").assert;function o(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=o,o.fromPublic=function(e,t,r){return t instanceof o?t:new o(e,{pub:t,pubEnc:r})},o.fromPrivate=function(e,t,r){return t instanceof o?t:new o(e,{priv:t,privEnc:r})},o.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},o.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},o.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},o.prototype._importPrivate=function(e,t){this.priv=new r(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},o.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?i(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||i(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},o.prototype.derive=function(e){return e.validate()||i(e.validate(),"public point not validated"),e.mul(this.priv).getX()},o.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},o.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},o.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}})),n.register("buZdZ",(function(e,t){"use strict";var r=n("6X3DX"),i=n("9mLpu"),o=i.assert;function a(e,t){if(e instanceof a)return e;this._importDER(e,t)||(o(e.r&&e.s,"Signature without r or s"),this.r=new r(e.r,16),this.s=new r(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function s(){this.place=0}function u(e,t){var r=e[t.place++];if(!(128&r))return r;var n=15&r;if(0===n||n>4)return!1;for(var i=0,o=0,a=t.place;o<n;o++,a++)i<<=8,i|=e[a],i>>>=0;return!(i<=127)&&(t.place=a,i)}function l(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function c(e,t){if(t<128)e.push(t);else{var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}}e.exports=a,a.prototype._importDER=function(e,t){e=i.toArray(e,t);var n=new s;if(48!==e[n.place++])return!1;var o=u(e,n);if(!1===o)return!1;if(o+n.place!==e.length)return!1;if(2!==e[n.place++])return!1;var a=u(e,n);if(!1===a)return!1;var l=e.slice(n.place,a+n.place);if(n.place+=a,2!==e[n.place++])return!1;var c=u(e,n);if(!1===c)return!1;if(e.length!==c+n.place)return!1;var d=e.slice(n.place,c+n.place);if(0===l[0]){if(!(128&l[1]))return!1;l=l.slice(1)}if(0===d[0]){if(!(128&d[1]))return!1;d=d.slice(1)}return this.r=new r(l),this.s=new r(d),this.recoveryParam=null,!0},a.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=l(t),r=l(r);!(r[0]||128&r[1]);)r=r.slice(1);var n=[2];c(n,t.length),(n=n.concat(t)).push(2),c(n,r.length);var o=n.concat(r),a=[48];return c(a,o.length),a=a.concat(o),i.encode(a,e)}})),n.register("18h3F",(function(e,t){"use strict";var r=n("ju19f"),i=n("c3Bg0"),o=n("9mLpu"),a=o.assert,s=o.parseBytes,u=n("2123J"),l=n("lssLx");function c(e){if(a("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof c))return new c(e);e=i[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=r.sha512}e.exports=c,c.prototype.sign=function(e,t){e=s(e);var r=this.keyFromSecret(t),n=this.hashInt(r.messagePrefix(),e),i=this.g.mul(n),o=this.encodePoint(i),a=this.hashInt(o,r.pubBytes(),e).mul(r.priv()),u=n.add(a).umod(this.curve.n);return this.makeSignature({R:i,S:u,Rencoded:o})},c.prototype.verify=function(e,t,r){e=s(e),t=this.makeSignature(t);var n=this.keyFromPublic(r),i=this.hashInt(t.Rencoded(),n.pubBytes(),e),o=this.g.mul(t.S());return t.R().add(n.pub().mul(i)).eq(o)},c.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return o.intFromLE(e.digest()).umod(this.curve.n)},c.prototype.keyFromPublic=function(e){return u.fromPublic(this,e)},c.prototype.keyFromSecret=function(e){return u.fromSecret(this,e)},c.prototype.makeSignature=function(e){return e instanceof l?e:new l(this,e)},c.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},c.prototype.decodePoint=function(e){var t=(e=o.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),n=0!=(128&e[t]),i=o.intFromLE(r);return this.curve.pointFromY(i,n)},c.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},c.prototype.decodeInt=function(e){return o.intFromLE(e)},c.prototype.isPoint=function(e){return e instanceof this.pointClass}})),n.register("2123J",(function(e,t){"use strict";var r=n("9mLpu"),i=r.assert,o=r.parseBytes,a=r.cachedProperty;function s(e,t){this.eddsa=e,this._secret=o(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=o(t.pub)}s.fromPublic=function(e,t){return t instanceof s?t:new s(e,{pub:t})},s.fromSecret=function(e,t){return t instanceof s?t:new s(e,{secret:t})},s.prototype.secret=function(){return this._secret},a(s,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),a(s,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),a(s,"privBytes",(function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,n=t.slice(0,e.encodingLength);return n[0]&=248,n[r]&=127,n[r]|=64,n})),a(s,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),a(s,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),a(s,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),s.prototype.sign=function(e){return i(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},s.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},s.prototype.getSecret=function(e){return i(this._secret,"KeyPair is public only"),r.encode(this.secret(),e)},s.prototype.getPublic=function(e){return r.encode(this.pubBytes(),e)},e.exports=s})),n.register("lssLx",(function(e,t){"use strict";var r=n("6X3DX"),i=n("9mLpu"),o=i.assert,a=i.cachedProperty,s=i.parseBytes;function u(e,t){this.eddsa=e,"object"!=typeof t&&(t=s(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),o(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof r&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}a(u,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),a(u,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),a(u,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),a(u,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),u.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},u.prototype.toHex=function(){return i.encode(this.toBytes(),"hex").toUpperCase()},e.exports=u})),n.register("kukaq",(function(e,t){var r=n("grqyL"),i=n("6XKhD"),o=n("eawbi"),a=n("7wRVs"),s=n("lhFXq"),u=n("j0zCv").Buffer;function l(e){var t;"object"!=typeof e||u.isBuffer(e)||(t=e.passphrase,e=e.key),"string"==typeof e&&(e=u.from(e));var n,l,c=o(e,t),d=c.tag,f=c.data;switch(d){case"CERTIFICATE":l=r.certificate.decode(f,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(l||(l=r.PublicKey.decode(f,"der")),n=l.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return r.RSAPublicKey.decode(l.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return l.subjectPrivateKey=l.subjectPublicKey,{type:"ec",data:l};case"1.2.840.10040.4.1":return l.algorithm.params.pub_key=r.DSAparam.decode(l.subjectPublicKey.data,"der"),{type:"dsa",data:l.algorithm.params};default:throw new Error("unknown key id "+n)}case"ENCRYPTED PRIVATE KEY":f=function(e,t){var r=e.algorithm.decrypt.kde.kdeparams.salt,n=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),o=i[e.algorithm.decrypt.cipher.algo.join(".")],l=e.algorithm.decrypt.cipher.iv,c=e.subjectPrivateKey,d=parseInt(o.split("-")[1],10)/8,f=s.pbkdf2Sync(t,r,n,d,"sha1"),h=a.createDecipheriv(o,f,l),p=[];return p.push(h.update(c)),p.push(h.final()),u.concat(p)}(f=r.EncryptedPrivateKey.decode(f,"der"),t);case"PRIVATE KEY":switch(n=(l=r.PrivateKey.decode(f,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return r.RSAPrivateKey.decode(l.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:l.algorithm.curve,privateKey:r.ECPrivateKey.decode(l.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return l.algorithm.params.priv_key=r.DSAparam.decode(l.subjectPrivateKey,"der"),{type:"dsa",params:l.algorithm.params};default:throw new Error("unknown key id "+n)}case"RSA PUBLIC KEY":return r.RSAPublicKey.decode(f,"der");case"RSA PRIVATE KEY":return r.RSAPrivateKey.decode(f,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:r.DSAPrivateKey.decode(f,"der")};case"EC PRIVATE KEY":return{curve:(f=r.ECPrivateKey.decode(f,"der")).parameters.value,privateKey:f.privateKey};default:throw new Error("unknown key type "+d)}}e.exports=l,l.signature=r.signature})),n.register("grqyL",(function(t,r){var i,o,a,s,u,l,c,d,f,h;e(t.exports,"certificate",(function(){return i}),(function(e){return i=e})),e(t.exports,"RSAPrivateKey",(function(){return o}),(function(e){return o=e})),e(t.exports,"RSAPublicKey",(function(){return a}),(function(e){return a=e})),e(t.exports,"PublicKey",(function(){return s}),(function(e){return s=e})),e(t.exports,"PrivateKey",(function(){return u}),(function(e){return u=e})),e(t.exports,"EncryptedPrivateKey",(function(){return l}),(function(e){return l=e})),e(t.exports,"DSAPrivateKey",(function(){return c}),(function(e){return c=e})),e(t.exports,"DSAparam",(function(){return d}),(function(e){return d=e})),e(t.exports,"ECPrivateKey",(function(){return f}),(function(e){return f=e})),e(t.exports,"signature",(function(){return h}),(function(e){return h=e}));var p=n("9GslV");i=n("amQ4W");var v=p.define("RSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}));o=v;var g=p.define("RSAPublicKey",(function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}));a=g;var m=p.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(y),this.key("subjectPublicKey").bitstr())}));s=m;var y=p.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())})),b=p.define("PrivateKeyInfo",(function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(y),this.key("subjectPrivateKey").octstr())}));u=b;var _=p.define("EncryptedPrivateKeyInfo",(function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}));l=_;var w=p.define("DSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}));c=w,d=p.define("DSAparam",(function(){this.int()}));var S=p.define("ECPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(E),this.key("publicKey").optional().explicit(1).bitstr())}));f=S;var E=p.define("ECParameters",(function(){this.choice({namedCurve:this.objid()})}));h=p.define("signature",(function(){this.seq().obj(this.key("r").int(),this.key("s").int())}))})),n.register("9GslV",(function(e,t){"use strict";var r=e.exports;r.bignum=n("jULvV"),r.define=n("96qPi").define,r.base=n("abUU3"),r.constants=n("dRF8c"),r.decoders=n("8ZYxB"),r.encoders=n("86eTq")})),n.register("jULvV",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,r,n){for(var i=0,o=Math.min(e.length,r),a=t;a<o;a++){var s=e.charCodeAt(a)-48;i*=n,i+=s>=49?s-49+10:s>=17?s-17+10:s}return i}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r.strip()}o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);n=0!==(o=s>>>24-i&16777215)||a!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,a--)}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],h=f[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var v=p.modn(h).toString(e);n=(p=p.idivn(h)).isZero()?v+n:c[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var a,s,u="le"===t,l=new e(o),c=this.clone();if(u){for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[s]=a;for(;s<o;s++)l[s]=0}else{for(s=0;s<o-i;s++)l[s]=0;for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[o-s-1]=a}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function v(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),o.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,e,t):v(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},g.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),v(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,o=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=o>>>26,this.words[n]=67108863&o}return 0!==t&&(this.words[n]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this.strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},i(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,y),i(w,y),i(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new _;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new k(e)},i(k,E),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("96qPi",(function(e,t){"use strict";var r=n("86eTq"),i=n("8ZYxB"),o=n("fospZ");function a(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}e.exports.define=function(e,t){return new a(e,t)},a.prototype._createNamed=function(e){var t=this.name;function r(e){this._initNamed(e,t)}return o(r,e),r.prototype._initNamed=function(t,r){e.call(this,t,r)},new r(this)},a.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(i[e])),this.decoders[e]},a.prototype.decode=function(e,t,r){return this._getDecoder(t).decode(e,r)},a.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(r[e])),this.encoders[e]},a.prototype.encode=function(e,t,r){return this._getEncoder(t).encode(e,r)}})),n.register("86eTq",(function(e,t){"use strict";var r=e.exports;r.der=n("6kc0i"),r.pem=n("lNMks")})),n.register("6kc0i",(function(e,t){"use strict";var r=n("fospZ"),i=n("e3rMj").Buffer,o=n("bxMmK"),a=n("aC9PW");function s(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new u,this.tree._init(e.body)}function u(e){o.call(this,"der",e)}function l(e){return e<10?"0"+e:e}e.exports=s,s.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},r(u,o),u.prototype._encodeComposite=function(e,t,r,n){var o=function(e,t,r,n){var i;"seqof"===e?e="seq":"setof"===e&&(e="set");if(a.tagByName.hasOwnProperty(e))i=a.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return n.error("Unknown tag: "+e);i=e}if(i>=31)return n.error("Multi-octet tag encoding unsupported");t||(i|=32);return i|=a.tagClassByName[r||"universal"]<<6}(e,t,r,this.reporter);if(n.length<128){var s=i.alloc(2);return s[0]=o,s[1]=n.length,this._createEncoderBuffer([s,n])}for(var u=1,l=n.length;l>=256;l>>=8)u++;var c=i.alloc(2+u);c[0]=o,c[1]=128|u;for(var d=1+u,f=n.length;f>0;d--,f>>=8)c[d]=255&f;return this._createEncoderBuffer([c,n])},u.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){for(var r=i.alloc(2*e.length),n=0;n<e.length;n++)r.writeUInt16BE(e.charCodeAt(n),2*n);return this._createEncoderBuffer(r)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)||"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},u.prototype._encodeObjid=function(e,t,r){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s.]+/g);for(var n=0;n<e.length;n++)e[n]|=0}else if(Array.isArray(e)){e=e.slice();for(var o=0;o<e.length;o++)e[o]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!r){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}for(var a=0,s=0;s<e.length;s++){var u=e[s];for(a++;u>=128;u>>=7)a++}for(var l=i.alloc(a),c=l.length-1,d=e.length-1;d>=0;d--){var f=e[d];for(l[c--]=127&f;(f>>=7)>0;)l[c--]=128|127&f}return this._createEncoderBuffer(l)},u.prototype._encodeTime=function(e,t){var r,n=new Date(e);return"gentime"===t?r=[l(n.getUTCFullYear()),l(n.getUTCMonth()+1),l(n.getUTCDate()),l(n.getUTCHours()),l(n.getUTCMinutes()),l(n.getUTCSeconds()),"Z"].join(""):"utctime"===t?r=[l(n.getUTCFullYear()%100),l(n.getUTCMonth()+1),l(n.getUTCDate()),l(n.getUTCHours()),l(n.getUTCMinutes()),l(n.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(r,"octstr")},u.prototype._encodeNull=function(){return this._createEncoderBuffer("")},u.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!i.isBuffer(e)){var r=e.toArray();!e.sign&&128&r[0]&&r.unshift(0),e=i.from(r)}if(i.isBuffer(e)){var n=e.length;0===e.length&&n++;var o=i.alloc(n);return e.copy(o),0===e.length&&(o[0]=0),this._createEncoderBuffer(o)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);for(var a=1,s=e;s>=256;s>>=8)a++;for(var u=new Array(a),l=u.length-1;l>=0;l--)u[l]=255&e,e>>=8;return 128&u[0]&&u.unshift(0),this._createEncoderBuffer(i.from(u))},u.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},u.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},u.prototype._skipDefault=function(e,t,r){var n,i=this._baseState;if(null===i.default)return!1;var o=e.join();if(void 0===i.defaultBuffer&&(i.defaultBuffer=this._encodeValue(i.default,t,r).join()),o.length!==i.defaultBuffer.length)return!1;for(n=0;n<o.length;n++)if(o[n]!==i.defaultBuffer[n])return!1;return!0}})),n.register("e3rMj",(function(e,t){var r,i=n("aojpe"),o=n("b758v"),a=n("1irm0"),s=a.Buffer,u={};for(r in a)a.hasOwnProperty(r)&&"SlowBuffer"!==r&&"Buffer"!==r&&(u[r]=a[r]);var l=u.Buffer={};for(r in s)s.hasOwnProperty(r)&&"allocUnsafe"!==r&&"allocUnsafeSlow"!==r&&(l[r]=s[r]);if(u.Buffer.prototype=s.prototype,l.from&&l.from!==Uint8Array.from||(l.from=function(e,t,r){if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type '+(void 0===e?"undefined":(0,i.default)(e)));if(e&&void 0===e.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":(0,i.default)(e)));return s(e,t,r)}),l.alloc||(l.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError('The "size" argument must be of type number. Received type '+(void 0===e?"undefined":(0,i.default)(e)));if(e<0||e>=2147483648)throw new RangeError('The value "'+e+'" is invalid for option "size"');var n=s(e);return t&&0!==t.length?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n}),!u.kStringMaxLength)try{u.kStringMaxLength=o.binding("buffer").kStringMaxLength}catch(e){}u.constants||(u.constants={MAX_LENGTH:u.kMaxLength},u.kStringMaxLength&&(u.constants.MAX_STRING_LENGTH=u.kStringMaxLength)),e.exports=u})),n.register("bxMmK",(function(e,t){"use strict";var r=n("6wpNE").Reporter,i=n("bA2eO").EncoderBuffer,o=n("bA2eO").DecoderBuffer,a=n("3RkE5"),s=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],u=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(s);function l(e,t,r){var n={};this._baseState=n,n.name=r,n.enc=e,n.parent=t||null,n.children=null,n.tag=null,n.args=null,n.reverseArgs=null,n.choice=null,n.optional=!1,n.any=!1,n.obj=!1,n.use=null,n.useDecoder=null,n.key=null,n.default=null,n.explicit=null,n.implicit=null,n.contains=null,n.parent||(n.children=[],this._wrap())}e.exports=l;var c=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];l.prototype.clone=function(){var e=this._baseState,t={};c.forEach((function(r){t[r]=e[r]}));var r=new this.constructor(t.parent);return r._baseState=t,r},l.prototype._wrap=function(){var e=this._baseState;u.forEach((function(t){this[t]=function(){var r=new this.constructor(this);return e.children.push(r),r[t].apply(r,arguments)}}),this)},l.prototype._init=function(e){var t=this._baseState;a(null===t.parent),e.call(this),t.children=t.children.filter((function(e){return e._baseState.parent===this}),this),a.equal(t.children.length,1,"Root node can have only one child")},l.prototype._useArgs=function(e){var t=this._baseState,r=e.filter((function(e){return e instanceof this.constructor}),this);e=e.filter((function(e){return!(e instanceof this.constructor)}),this),0!==r.length&&(a(null===t.children),t.children=r,r.forEach((function(e){e._baseState.parent=this}),this)),0!==e.length&&(a(null===t.args),t.args=e,t.reverseArgs=e.map((function(e){if("object"!=typeof e||e.constructor!==Object)return e;var t={};return Object.keys(e).forEach((function(r){r==(0|r)&&(r|=0);var n=e[r];t[n]=r})),t})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(e){l.prototype[e]=function(){var t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}})),s.forEach((function(e){l.prototype[e]=function(){var t=this._baseState,r=Array.prototype.slice.call(arguments);return a(null===t.tag),t.tag=e,this._useArgs(r),this}})),l.prototype.use=function(e){a(e);var t=this._baseState;return a(null===t.use),t.use=e,this},l.prototype.optional=function(){return this._baseState.optional=!0,this},l.prototype.def=function(e){var t=this._baseState;return a(null===t.default),t.default=e,t.optional=!0,this},l.prototype.explicit=function(e){var t=this._baseState;return a(null===t.explicit&&null===t.implicit),t.explicit=e,this},l.prototype.implicit=function(e){var t=this._baseState;return a(null===t.explicit&&null===t.implicit),t.implicit=e,this},l.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},l.prototype.key=function(e){var t=this._baseState;return a(null===t.key),t.key=e,this},l.prototype.any=function(){return this._baseState.any=!0,this},l.prototype.choice=function(e){var t=this._baseState;return a(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map((function(t){return e[t]}))),this},l.prototype.contains=function(e){var t=this._baseState;return a(null===t.use),t.contains=e,this},l.prototype._decode=function(e,t){var r=this._baseState;if(null===r.parent)return e.wrapResult(r.children[0]._decode(e,t));var n,i=r.default,a=!0,s=null;if(null!==r.key&&(s=e.enterKey(r.key)),r.optional){var u=null;if(null!==r.explicit?u=r.explicit:null!==r.implicit?u=r.implicit:null!==r.tag&&(u=r.tag),null!==u||r.any){if(a=this._peekTag(e,u,r.any),e.isError(a))return a}else{var l=e.save();try{null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t),a=!0}catch(e){a=!1}e.restore(l)}}if(r.obj&&a&&(n=e.enterObject()),a){if(null!==r.explicit){var c=this._decodeTag(e,r.explicit);if(e.isError(c))return c;e=c}var d=e.offset;if(null===r.use&&null===r.choice){var f;r.any&&(f=e.save());var h=this._decodeTag(e,null!==r.implicit?r.implicit:r.tag,r.any);if(e.isError(h))return h;r.any?i=e.raw(f):e=h}if(t&&t.track&&null!==r.tag&&t.track(e.path(),d,e.length,"tagged"),t&&t.track&&null!==r.tag&&t.track(e.path(),e.offset,e.length,"content"),r.any||(i=null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t)),e.isError(i))return i;if(r.any||null!==r.choice||null===r.children||r.children.forEach((function(r){r._decode(e,t)})),r.contains&&("octstr"===r.tag||"bitstr"===r.tag)){var p=new o(i);i=this._getUse(r.contains,e._reporterState.obj)._decode(p,t)}}return r.obj&&a&&(i=e.leaveObject(n)),null===r.key||null===i&&!0!==a?null!==s&&e.exitKey(s):e.leaveKey(s,r.key,i),i},l.prototype._decodeGeneric=function(e,t,r){var n=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,n.args[0],r):/str$/.test(e)?this._decodeStr(t,e,r):"objid"===e&&n.args?this._decodeObjid(t,n.args[0],n.args[1],r):"objid"===e?this._decodeObjid(t,null,null,r):"gentime"===e||"utctime"===e?this._decodeTime(t,e,r):"null_"===e?this._decodeNull(t,r):"bool"===e?this._decodeBool(t,r):"objDesc"===e?this._decodeStr(t,e,r):"int"===e||"enum"===e?this._decodeInt(t,n.args&&n.args[0],r):null!==n.use?this._getUse(n.use,t._reporterState.obj)._decode(t,r):t.error("unknown tag: "+e)},l.prototype._getUse=function(e,t){var r=this._baseState;return r.useDecoder=this._use(e,t),a(null===r.useDecoder._baseState.parent),r.useDecoder=r.useDecoder._baseState.children[0],r.implicit!==r.useDecoder._baseState.implicit&&(r.useDecoder=r.useDecoder.clone(),r.useDecoder._baseState.implicit=r.implicit),r.useDecoder},l.prototype._decodeChoice=function(e,t){var r=this._baseState,n=null,i=!1;return Object.keys(r.choice).some((function(o){var a=e.save(),s=r.choice[o];try{var u=s._decode(e,t);if(e.isError(u))return!1;n={type:o,value:u},i=!0}catch(t){return e.restore(a),!1}return!0}),this),i?n:e.error("Choice not matched")},l.prototype._createEncoderBuffer=function(e){return new i(e,this.reporter)},l.prototype._encode=function(e,t,r){var n=this._baseState;if(null===n.default||n.default!==e){var i=this._encodeValue(e,t,r);if(void 0!==i&&!this._skipDefault(i,t,r))return i}},l.prototype._encodeValue=function(e,t,n){var i=this._baseState;if(null===i.parent)return i.children[0]._encode(e,t||new r);var o=null;if(this.reporter=t,i.optional&&void 0===e){if(null===i.default)return;e=i.default}var a=null,s=!1;if(i.any)o=this._createEncoderBuffer(e);else if(i.choice)o=this._encodeChoice(e,t);else if(i.contains)a=this._getUse(i.contains,n)._encode(e,t),s=!0;else if(i.children)a=i.children.map((function(r){if("null_"===r._baseState.tag)return r._encode(null,t,e);if(null===r._baseState.key)return t.error("Child should have a key");var n=t.enterKey(r._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");var i=r._encode(e[r._baseState.key],t,e);return t.leaveKey(n),i}),this).filter((function(e){return e})),a=this._createEncoderBuffer(a);else if("seqof"===i.tag||"setof"===i.tag){if(!i.args||1!==i.args.length)return t.error("Too many args for : "+i.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");var u=this.clone();u._baseState.implicit=null,a=this._createEncoderBuffer(e.map((function(r){var n=this._baseState;return this._getUse(n.args[0],e)._encode(r,t)}),u))}else null!==i.use?o=this._getUse(i.use,n)._encode(e,t):(a=this._encodePrimitive(i.tag,e),s=!0);if(!i.any&&null===i.choice){var l=null!==i.implicit?i.implicit:i.tag,c=null===i.implicit?"universal":"context";null===l?null===i.use&&t.error("Tag could be omitted only for .use()"):null===i.use&&(o=this._encodeComposite(l,s,c,a))}return null!==i.explicit&&(o=this._encodeComposite(i.explicit,!1,"context",o)),o},l.prototype._encodeChoice=function(e,t){var r=this._baseState,n=r.choice[e.type];return n||a(!1,e.type+" not found in "+JSON.stringify(Object.keys(r.choice))),n._encode(e.value,t)},l.prototype._encodePrimitive=function(e,t){var r=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&r.args)return this._encodeObjid(t,r.reverseArgs[0],r.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,r.args&&r.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},l.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},l.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(e)}})),n.register("6wpNE",(function(t,r){var i;e(t.exports,"Reporter",(function(){return i}),(function(e){return i=e}));var o=n("fospZ");function a(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function s(e,t){this.path=e,this.rethrow(t)}i=a,a.prototype.isError=function(e){return e instanceof s},a.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},a.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},a.prototype.enterKey=function(e){return this._reporterState.path.push(e)},a.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},a.prototype.leaveKey=function(e,t,r){var n=this._reporterState;this.exitKey(e),null!==n.obj&&(n.obj[t]=r)},a.prototype.path=function(){return this._reporterState.path.join("/")},a.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},a.prototype.leaveObject=function(e){var t=this._reporterState,r=t.obj;return t.obj=e,r},a.prototype.error=function(e){var t,r=this._reporterState,n=e instanceof s;if(t=n?e:new s(r.path.map((function(e){return"["+JSON.stringify(e)+"]"})).join(""),e.message||e,e.stack),!r.options.partial)throw t;return n||r.errors.push(t),t},a.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},o(s,Error),s.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,s),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}})),n.register("bA2eO",(function(t,r){e(t.exports,"DecoderBuffer",(function(){return i}),(function(e){return i=e})),e(t.exports,"EncoderBuffer",(function(){return o}),(function(e){return o=e}));var i,o,a=n("aojpe"),s=n("fospZ"),u=n("6wpNE").Reporter,l=n("e3rMj").Buffer;function c(e,t){u.call(this,t),l.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function d(e,t){if(Array.isArray(e))this.length=0,this.value=e.map((function(e){return d.isEncoderBuffer(e)||(e=new d(e,t)),this.length+=e.length,e}),this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=l.byteLength(e);else{if(!l.isBuffer(e))return t.error("Unsupported type: "+(void 0===e?"undefined":(0,a.default)(e)));this.value=e,this.length=e.length}}s(c,u),i=c,c.isDecoderBuffer=function(e){return e instanceof c||"object"==typeof e&&l.isBuffer(e.base)&&"DecoderBuffer"===e.constructor.name&&"number"==typeof e.offset&&"number"==typeof e.length&&"function"==typeof e.save&&"function"==typeof e.restore&&"function"==typeof e.isEmpty&&"function"==typeof e.readUInt8&&"function"==typeof e.skip&&"function"==typeof e.raw},c.prototype.save=function(){return{offset:this.offset,reporter:u.prototype.save.call(this)}},c.prototype.restore=function(e){var t=new c(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,u.prototype.restore.call(this,e.reporter),t},c.prototype.isEmpty=function(){return this.offset===this.length},c.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},c.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");var r=new c(this.base);return r._reporterState=this._reporterState,r.offset=this.offset,r.length=this.offset+e,this.offset+=e,r},c.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},o=d,d.isEncoderBuffer=function(e){return e instanceof d||"object"==typeof e&&"EncoderBuffer"===e.constructor.name&&"number"==typeof e.length&&"function"==typeof e.join},d.prototype.join=function(e,t){return e||(e=l.alloc(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach((function(r){r.join(e,t),t+=r.length})):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):l.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}})),n.register("aC9PW",(function(t,r){var n,i,o,a;function s(e){var t={};return Object.keys(e).forEach((function(r){(0|r)==r&&(r|=0);var n=e[r];t[n]=r})),t}e(t.exports,"tagClass",(function(){return n}),(function(e){return n=e})),e(t.exports,"tagClassByName",(function(){return i}),(function(e){return i=e})),e(t.exports,"tag",(function(){return o}),(function(e){return o=e})),e(t.exports,"tagByName",(function(){return a}),(function(e){return a=e})),i=s(n={0:"universal",1:"application",2:"context",3:"private"}),a=s(o={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"})})),n.register("lNMks",(function(e,t){"use strict";var r=n("fospZ"),i=n("6kc0i");function o(e){i.call(this,e),this.enc="pem"}r(o,i),e.exports=o,o.prototype.encode=function(e,t){for(var r=i.prototype.encode.call(this,e).toString("base64"),n=["-----BEGIN "+t.label+"-----"],o=0;o<r.length;o+=64)n.push(r.slice(o,o+64));return n.push("-----END "+t.label+"-----"),n.join("\n")}})),n.register("8ZYxB",(function(e,t){"use strict";var r=e.exports;r.der=n("dqzwA"),r.pem=n("8V1T9")})),n.register("dqzwA",(function(e,t){"use strict";var r=n("fospZ"),i=n("jULvV"),o=n("bA2eO").DecoderBuffer,a=n("bxMmK"),s=n("aC9PW");function u(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new l,this.tree._init(e.body)}function l(e){a.call(this,"der",e)}function c(e,t){var r=e.readUInt8(t);if(e.isError(r))return r;var n=s.tagClass[r>>6],i=0==(32&r);if(31==(31&r)){var o=r;for(r=0;128==(128&o);){if(o=e.readUInt8(t),e.isError(o))return o;r<<=7,r|=127&o}}else r&=31;return{cls:n,primitive:i,tag:r,tagStr:s.tag[r]}}function d(e,t,r){var n=e.readUInt8(r);if(e.isError(n))return n;if(!t&&128===n)return null;if(0==(128&n))return n;var i=127&n;if(i>4)return e.error("length octect is too long");n=0;for(var o=0;o<i;o++){n<<=8;var a=e.readUInt8(r);if(e.isError(a))return a;n|=a}return n}e.exports=u,u.prototype.decode=function(e,t){return o.isDecoderBuffer(e)||(e=new o(e,t)),this.tree._decode(e,t)},r(l,a),l.prototype._peekTag=function(e,t,r){if(e.isEmpty())return!1;var n=e.save(),i=c(e,'Failed to peek tag: "'+t+'"');return e.isError(i)?i:(e.restore(n),i.tag===t||i.tagStr===t||i.tagStr+"of"===t||r)},l.prototype._decodeTag=function(e,t,r){var n=c(e,'Failed to decode tag of "'+t+'"');if(e.isError(n))return n;var i=d(e,n.primitive,'Failed to get length of "'+t+'"');if(e.isError(i))return i;if(!r&&n.tag!==t&&n.tagStr!==t&&n.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(n.primitive||null!==i)return e.skip(i,'Failed to match body of: "'+t+'"');var o=e.save(),a=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(a)?a:(i=e.offset-o.offset,e.restore(o),e.skip(i,'Failed to match body of: "'+t+'"'))},l.prototype._skipUntilEnd=function(e,t){for(;;){var r=c(e,t);if(e.isError(r))return r;var n=d(e,r.primitive,t);if(e.isError(n))return n;var i=void 0;if(i=r.primitive||null!==n?e.skip(n):this._skipUntilEnd(e,t),e.isError(i))return i;if("end"===r.tagStr)break}},l.prototype._decodeList=function(e,t,r,n){for(var i=[];!e.isEmpty();){var o=this._peekTag(e,"end");if(e.isError(o))return o;var a=r.decode(e,"der",n);if(e.isError(a)&&o)break;i.push(a)}return i},l.prototype._decodeStr=function(e,t){if("bitstr"===t){var r=e.readUInt8();return e.isError(r)?r:{unused:r,data:e.raw()}}if("bmpstr"===t){var n=e.raw();if(n.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");for(var i="",o=0;o<n.length/2;o++)i+=String.fromCharCode(n.readUInt16BE(2*o));return i}if("numstr"===t){var a=e.raw().toString("ascii");return this._isNumstr(a)?a:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){var s=e.raw().toString("ascii");return this._isPrintstr(s)?s:e.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},l.prototype._decodeObjid=function(e,t,r){for(var n,i=[],o=0,a=0;!e.isEmpty();)o<<=7,o|=127&(a=e.readUInt8()),0==(128&a)&&(i.push(o),o=0);128&a&&i.push(o);var s=i[0]/40|0,u=i[0]%40;if(n=r?i:[s,u].concat(i.slice(1)),t){var l=t[n.join(" ")];void 0===l&&(l=t[n.join(".")]),void 0!==l&&(n=l)}return n},l.prototype._decodeTime=function(e,t){var r,n,i,o,a,s,u=e.raw().toString();if("gentime"===t)r=0|u.slice(0,4),n=0|u.slice(4,6),i=0|u.slice(6,8),o=0|u.slice(8,10),a=0|u.slice(10,12),s=0|u.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");r=0|u.slice(0,2),n=0|u.slice(2,4),i=0|u.slice(4,6),o=0|u.slice(6,8),a=0|u.slice(8,10),s=0|u.slice(10,12),r=r<70?2e3+r:1900+r}return Date.UTC(r,n-1,i,o,a,s,0)},l.prototype._decodeNull=function(){return null},l.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},l.prototype._decodeInt=function(e,t){var r=e.raw(),n=new i(r);return t&&(n=t[n.toString(10)]||n),n},l.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}})),n.register("8V1T9",(function(e,t){"use strict";var r=n("fospZ"),i=n("e3rMj").Buffer,o=n("dqzwA");function a(e){o.call(this,e),this.enc="pem"}r(a,o),e.exports=a,a.prototype.decode=function(e,t){for(var r=e.toString().split(/[\r\n]+/g),n=t.label.toUpperCase(),a=/^-----(BEGIN|END) ([^-]+)-----$/,s=-1,u=-1,l=0;l<r.length;l++){var c=r[l].match(a);if(null!==c&&c[2]===n){if(-1!==s){if("END"!==c[1])break;u=l;break}if("BEGIN"!==c[1])break;s=l}}if(-1===s||-1===u)throw new Error("PEM section not found for: "+n);var d=r.slice(s+1,u).join("");d.replace(/[^a-z0-9+/=]+/gi,"");var f=i.from(d,"base64");return o.prototype.decode.call(this,f,t)}})),n.register("abUU3",(function(e,t){"use strict";var r=e.exports;r.Reporter=n("6wpNE").Reporter,r.DecoderBuffer=n("bA2eO").DecoderBuffer,r.EncoderBuffer=n("bA2eO").EncoderBuffer,r.Node=n("bxMmK")})),n.register("dRF8c",(function(e,t){"use strict";var r=e.exports;r._reverse=function(e){var t={};return Object.keys(e).forEach((function(r){(0|r)==r&&(r|=0);var n=e[r];t[n]=r})),t},r.der=n("aC9PW")})),n.register("amQ4W",(function(e,t){"use strict";var r=n("9GslV"),i=r.define("Time",(function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})),o=r.define("AttributeTypeValue",(function(){this.seq().obj(this.key("type").objid(),this.key("value").any())})),a=r.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())})),s=r.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(a),this.key("subjectPublicKey").bitstr())})),u=r.define("RelativeDistinguishedName",(function(){this.setof(o)})),l=r.define("RDNSequence",(function(){this.seqof(u)})),c=r.define("Name",(function(){this.choice({rdnSequence:this.use(l)})})),d=r.define("Validity",(function(){this.seq().obj(this.key("notBefore").use(i),this.key("notAfter").use(i))})),f=r.define("Extension",(function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())})),h=r.define("TBSCertificate",(function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(a),this.key("issuer").use(c),this.key("validity").use(d),this.key("subject").use(c),this.key("subjectPublicKeyInfo").use(s),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(f).optional())})),p=r.define("X509Certificate",(function(){this.seq().obj(this.key("tbsCertificate").use(h),this.key("signatureAlgorithm").use(a),this.key("signatureValue").bitstr())}));e.exports=p})),n.register("6XKhD",(function(e,t){e.exports=JSON.parse('{"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}')})),n.register("eawbi",(function(e,t){var r=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,i=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,o=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,a=n("4ehgR"),s=n("7wRVs"),u=n("j0zCv").Buffer;e.exports=function(e,t){var n,l=e.toString(),c=l.match(r);if(c){var d="aes"+c[1],f=u.from(c[2],"hex"),h=u.from(c[3].replace(/[\r\n]/g,""),"base64"),p=a(t,f.slice(0,8),parseInt(c[1],10)).key,v=[],g=s.createDecipheriv(d,p,f);v.push(g.update(h)),v.push(g.final()),n=u.concat(v)}else{var m=l.match(o);n=u.from(m[2].replace(/[\r\n]/g,""),"base64")}return{tag:l.match(i)[1],data:n}}})),n.register("430pW",(function(e,t){e.exports=JSON.parse('{"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}')})),n.register("hm5Nb",(function(e,t){var r=n("j0zCv").Buffer,i=n("llUdM"),o=n("6bdf7").ec,a=n("kukaq"),s=n("430pW");function u(e,t){if(e.cmpn(0)<=0)throw new Error("invalid sig");if(e.cmp(t)>=t)throw new Error("invalid sig")}e.exports=function(e,t,n,l,c){var d=a(n);if("ec"===d.type){if("ecdsa"!==l&&"ecdsa/rsa"!==l)throw new Error("wrong public key type");return function(e,t,r){var n=s[r.data.algorithm.curve.join(".")];if(!n)throw new Error("unknown curve "+r.data.algorithm.curve.join("."));var i=new o(n),a=r.data.subjectPrivateKey.data;return i.verify(t,e,a)}(e,t,d)}if("dsa"===d.type){if("dsa"!==l)throw new Error("wrong public key type");return function(e,t,r){var n=r.data.p,o=r.data.q,s=r.data.g,l=r.data.pub_key,c=a.signature.decode(e,"der"),d=c.s,f=c.r;u(d,o),u(f,o);var h=i.mont(n),p=d.invm(o);return 0===s.toRed(h).redPow(new i(t).mul(p).mod(o)).fromRed().mul(l.toRed(h).redPow(f.mul(p).mod(o)).fromRed()).mod(n).mod(o).cmp(f)}(e,t,d)}if("rsa"!==l&&"ecdsa/rsa"!==l)throw new Error("wrong public key type");t=r.concat([c,t]);for(var f=d.modulus.byteLength(),h=[1],p=0;t.length+h.length+2<f;)h.push(255),p++;h.push(0);for(var v=-1;++v<t.length;)h.push(t[v]);h=r.from(h);var g=i.mont(d.modulus);e=(e=new i(e).toRed(g)).redPow(new i(d.publicExponent)),e=r.from(e.fromRed().toArray());var m=p<8?1:0;for(f=Math.min(e.length,h.length),e.length!==h.length&&(m=1),v=-1;++v<f;)m|=e[v]^h[v];return 0===m}})),n.register("7mMbi",(function(e,t){var r=n("1irm0").Buffer,i=n("6bdf7"),o=n("9yg97");e.exports=function(e){return new s(e)};var a={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function s(e){this.curveType=a[e],this.curveType||(this.curveType={name:e}),this.curve=new i.ec(this.curveType.name),this.keys=void 0}function u(e,t,n){Array.isArray(e)||(e=e.toArray());var i=new r(e);if(n&&i.length<n){var o=new r(n-i.length);o.fill(0),i=r.concat([o,i])}return t?i.toString(t):i}a.p224=a.secp224r1,a.p256=a.secp256r1=a.prime256v1,a.p192=a.secp192r1=a.prime192v1,a.p384=a.secp384r1,a.p521=a.secp521r1,s.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},s.prototype.computeSecret=function(e,t,n){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),u(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),n,this.curveType.byteLength)},s.prototype.getPublicKey=function(e,t){var r=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(r[r.length-1]%2?r[0]=7:r[0]=6),u(r,e)},s.prototype.getPrivateKey=function(e){return u(this.keys.getPrivate(),e)},s.prototype.setPublicKey=function(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this.keys._importPublic(e),this},s.prototype.setPrivateKey=function(e,t){t=t||"utf8",r.isBuffer(e)||(e=new r(e,t));var n=new o(e);return n=n.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(n),this}})),n.register("9yg97",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,r,n){for(var i=0,o=Math.min(e.length,r),a=t;a<o;a++){var s=e.charCodeAt(a)-48;i*=n,i+=s>=49?s-49+10:s>=17?s-17+10:s}return i}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r.strip()}o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);n=0!==(o=s>>>24-i&16777215)||a!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,a--)}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],h=f[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var v=p.modn(h).toString(e);n=(p=p.idivn(h)).isZero()?v+n:c[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var a,s,u="le"===t,l=new e(o),c=this.clone();if(u){for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[s]=a;for(;s<o;s++)l[s]=0}else{for(s=0;s<o-i;s++)l[s]=0;for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[o-s-1]=a}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function v(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),o.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,e,t):v(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},g.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),v(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,o=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=o>>>26,this.words[n]=67108863&o}return 0!==t&&(this.words[n]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this.strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},i(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,y),i(w,y),i(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new _;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new k(e)},i(k,E),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("8DLzP",(function(t,r){var i,o,a,s;e(t.exports,"publicEncrypt",(function(){return i}),(function(e){return i=e})),e(t.exports,"privateDecrypt",(function(){return o}),(function(e){return o=e})),e(t.exports,"privateEncrypt",(function(){return a}),(function(e){return a=e})),e(t.exports,"publicDecrypt",(function(){return s}),(function(e){return s=e})),i=n("kHAvB"),o=n("iUPUW"),a=function(e,t){return i(e,t,!0)},s=function(e,t){return o(e,t,!0)}})),n.register("kHAvB",(function(e,t){var r=n("kukaq"),i=n("4p9KL"),o=n("bdvz5"),a=n("1ZpJV"),s=n("9JS7g"),u=n("4V35i"),l=n("U5ZPV"),c=n("dRTKf"),d=n("j0zCv").Buffer;e.exports=function(e,t,n){var f;f=e.padding?e.padding:n?1:4;var h,p=r(e);if(4===f)h=function(e,t){var r=e.modulus.byteLength(),n=t.length,l=o("sha1").update(d.alloc(0)).digest(),c=l.length,f=2*c;if(n>r-f-2)throw new Error("message too long");var h=d.alloc(r-n-f-2),p=r-c-1,v=i(c),g=s(d.concat([l,h,d.alloc(1,1),t],p),a(v,p)),m=s(v,a(g,c));return new u(d.concat([d.alloc(1),m,g],r))}(p,t);else if(1===f)h=function(e,t,r){var n,o=t.length,a=e.modulus.byteLength();if(o>a-11)throw new Error("message too long");n=r?d.alloc(a-o-3,255):function(e){var t,r=d.allocUnsafe(e),n=0,o=i(2*e),a=0;for(;n<e;)a===o.length&&(o=i(2*e),a=0),(t=o[a++])&&(r[n++]=t);return r}(a-o-3);return new u(d.concat([d.from([0,r?1:2]),n,d.alloc(1),t],a))}(p,t,n);else{if(3!==f)throw new Error("unknown padding");if((h=new u(t)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return n?c(h,p):l(h,p)}})),n.register("1ZpJV",(function(e,t){var r=n("bdvz5"),i=n("j0zCv").Buffer;function o(e){var t=i.allocUnsafe(4);return t.writeUInt32BE(e,0),t}e.exports=function(e,t){for(var n,a=i.alloc(0),s=0;a.length<t;)n=o(s++),a=i.concat([a,r("sha1").update(e).update(n).digest()]);return a.slice(0,t)}})),n.register("9JS7g",(function(e,t){e.exports=function(e,t){for(var r=e.length,n=-1;++n<r;)e[n]^=t[n];return e}})),n.register("4V35i",(function(e,t){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var a;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{a="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n("7MpCL").Buffer}catch(e){}function s(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function u(e,t,r){var n=s(e,r);return r-1>=t&&(n|=s(e,r-1)<<4),n}function l(e,t,r,n){for(var i=0,o=Math.min(e.length,r),a=t;a<o;a++){var s=e.charCodeAt(a)-48;i*=n,i+=s>=49?s-49+10:s>=17?s-17+10:s}return i}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},o.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},o.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,a,s=0;if("be"===n)for(i=e.length-1,o=0;i>=0;i-=3)a=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);else if("le"===n)for(i=0,o=0;i<e.length;i+=3)a=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[o]|=a<<s&67108863,this.words[o+1]=a>>>26-s&67108863,(s+=24)>=26&&(s-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,o=0,a=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=u(e,t,n)<<o,this.words[a]|=67108863&i,o>=18?(o-=18,a+=1,this.words[a]|=i>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var o=e.length-r,a=o%n,s=Math.min(o,o-a)+r,u=0,c=r;c<s;c+=n)u=l(e,c,c+n,t),this.imuln(i),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=l(e,c,e.length,t),c=0;c<a;c++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],o=0|t.words[0],a=i*o,s=67108863&a,u=a/67108864|0;r.words[0]=s;for(var l=1;l<n;l++){for(var c=u>>>26,d=67108863&u,f=Math.min(l,t.length-1),h=Math.max(0,l-e.length+1);h<=f;h++){var p=l-h|0;c+=(a=(i=0|e.words[p])*(o=0|t.words[h])+d)/67108864|0,d=67108863&a}r.words[l]=0|d,u=0|c}return 0!==u?r.words[l]=0|u:r.length--,r.strip()}o.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,o=0,a=0;a<this.length;a++){var s=this.words[a],u=(16777215&(s<<i|o)).toString(16);n=0!==(o=s>>>24-i&16777215)||a!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,a--)}for(0!==o&&(n=o.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],h=f[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var v=p.modn(h).toString(e);n=(p=p.idivn(h)).isZero()?v+n:c[l-v.length]+v+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),o=n||Math.max(1,i);r(i<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var a,s,u="le"===t,l=new e(o),c=this.clone();if(u){for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[s]=a;for(;s<o;s++)l[s]=0}else{for(s=0;s<o-i;s++)l[s]=0;for(s=0;!c.isZero();s++)a=c.andln(255),c.iushrn(8),l[o-s-1]=a}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},o.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,o=0;o<n.length;o++)t=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&t,i=t>>>26;for(;0!==i&&o<r.length;o++)t=(0|r.words[o])+i,this.words[o]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,a=0;a<n.length;a++)o=(t=(0|r.words[a])-(0|n.words[a])+o)>>26,this.words[a]=67108863&t;for(;0!==o&&a<r.length;a++)o=(t=(0|r.words[a])+o)>>26,this.words[a]=67108863&t;if(0===o&&a<r.length&&r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this.length=Math.max(this.length,a),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,o,a=e.words,s=t.words,u=r.words,l=0,c=0|a[0],d=8191&c,f=c>>>13,h=0|a[1],p=8191&h,v=h>>>13,g=0|a[2],m=8191&g,y=g>>>13,b=0|a[3],_=8191&b,w=b>>>13,S=0|a[4],E=8191&S,k=S>>>13,M=0|a[5],C=8191&M,I=M>>>13,T=0|a[6],R=8191&T,x=T>>>13,O=0|a[7],A=8191&O,D=O>>>13,P=0|a[8],L=8191&P,U=P>>>13,j=0|a[9],N=8191&j,B=j>>>13,F=0|s[0],K=8191&F,q=F>>>13,W=0|s[1],V=8191&W,H=W>>>13,G=0|s[2],z=8191&G,Y=G>>>13,Z=0|s[3],$=8191&Z,J=Z>>>13,Q=0|s[4],X=8191&Q,ee=Q>>>13,te=0|s[5],re=8191&te,ne=te>>>13,ie=0|s[6],oe=8191&ie,ae=ie>>>13,se=0|s[7],ue=8191&se,le=se>>>13,ce=0|s[8],de=8191&ce,fe=ce>>>13,he=0|s[9],pe=8191&he,ve=he>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(n=Math.imul(d,K))|0)+((8191&(i=(i=Math.imul(d,q))+Math.imul(f,K)|0))<<13)|0;l=((o=Math.imul(f,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,K),i=(i=Math.imul(p,q))+Math.imul(v,K)|0,o=Math.imul(v,q);var me=(l+(n=n+Math.imul(d,V)|0)|0)+((8191&(i=(i=i+Math.imul(d,H)|0)+Math.imul(f,V)|0))<<13)|0;l=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(m,K),i=(i=Math.imul(m,q))+Math.imul(y,K)|0,o=Math.imul(y,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,H)|0;var ye=(l+(n=n+Math.imul(d,z)|0)|0)+((8191&(i=(i=i+Math.imul(d,Y)|0)+Math.imul(f,z)|0))<<13)|0;l=((o=o+Math.imul(f,Y)|0)+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(_,K),i=(i=Math.imul(_,q))+Math.imul(w,K)|0,o=Math.imul(w,q),n=n+Math.imul(m,V)|0,i=(i=i+Math.imul(m,H)|0)+Math.imul(y,V)|0,o=o+Math.imul(y,H)|0,n=n+Math.imul(p,z)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(v,z)|0,o=o+Math.imul(v,Y)|0;var be=(l+(n=n+Math.imul(d,$)|0)|0)+((8191&(i=(i=i+Math.imul(d,J)|0)+Math.imul(f,$)|0))<<13)|0;l=((o=o+Math.imul(f,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,K),i=(i=Math.imul(E,q))+Math.imul(k,K)|0,o=Math.imul(k,q),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,H)|0)+Math.imul(w,V)|0,o=o+Math.imul(w,H)|0,n=n+Math.imul(m,z)|0,i=(i=i+Math.imul(m,Y)|0)+Math.imul(y,z)|0,o=o+Math.imul(y,Y)|0,n=n+Math.imul(p,$)|0,i=(i=i+Math.imul(p,J)|0)+Math.imul(v,$)|0,o=o+Math.imul(v,J)|0;var _e=(l+(n=n+Math.imul(d,X)|0)|0)+((8191&(i=(i=i+Math.imul(d,ee)|0)+Math.imul(f,X)|0))<<13)|0;l=((o=o+Math.imul(f,ee)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(C,K),i=(i=Math.imul(C,q))+Math.imul(I,K)|0,o=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,H)|0,n=n+Math.imul(_,z)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(w,z)|0,o=o+Math.imul(w,Y)|0,n=n+Math.imul(m,$)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(y,$)|0,o=o+Math.imul(y,J)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(v,X)|0,o=o+Math.imul(v,ee)|0;var we=(l+(n=n+Math.imul(d,re)|0)|0)+((8191&(i=(i=i+Math.imul(d,ne)|0)+Math.imul(f,re)|0))<<13)|0;l=((o=o+Math.imul(f,ne)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(R,K),i=(i=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),n=n+Math.imul(C,V)|0,i=(i=i+Math.imul(C,H)|0)+Math.imul(I,V)|0,o=o+Math.imul(I,H)|0,n=n+Math.imul(E,z)|0,i=(i=i+Math.imul(E,Y)|0)+Math.imul(k,z)|0,o=o+Math.imul(k,Y)|0,n=n+Math.imul(_,$)|0,i=(i=i+Math.imul(_,J)|0)+Math.imul(w,$)|0,o=o+Math.imul(w,J)|0,n=n+Math.imul(m,X)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(v,re)|0,o=o+Math.imul(v,ne)|0;var Se=(l+(n=n+Math.imul(d,oe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ae)|0)+Math.imul(f,oe)|0))<<13)|0;l=((o=o+Math.imul(f,ae)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,K),i=(i=Math.imul(A,q))+Math.imul(D,K)|0,o=Math.imul(D,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(x,V)|0,o=o+Math.imul(x,H)|0,n=n+Math.imul(C,z)|0,i=(i=i+Math.imul(C,Y)|0)+Math.imul(I,z)|0,o=o+Math.imul(I,Y)|0,n=n+Math.imul(E,$)|0,i=(i=i+Math.imul(E,J)|0)+Math.imul(k,$)|0,o=o+Math.imul(k,J)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,ee)|0)+Math.imul(w,X)|0,o=o+Math.imul(w,ee)|0,n=n+Math.imul(m,re)|0,i=(i=i+Math.imul(m,ne)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ne)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(v,oe)|0,o=o+Math.imul(v,ae)|0;var Ee=(l+(n=n+Math.imul(d,ue)|0)|0)+((8191&(i=(i=i+Math.imul(d,le)|0)+Math.imul(f,ue)|0))<<13)|0;l=((o=o+Math.imul(f,le)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,K),i=(i=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(D,V)|0,o=o+Math.imul(D,H)|0,n=n+Math.imul(R,z)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(x,z)|0,o=o+Math.imul(x,Y)|0,n=n+Math.imul(C,$)|0,i=(i=i+Math.imul(C,J)|0)+Math.imul(I,$)|0,o=o+Math.imul(I,J)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(k,X)|0,o=o+Math.imul(k,ee)|0,n=n+Math.imul(_,re)|0,i=(i=i+Math.imul(_,ne)|0)+Math.imul(w,re)|0,o=o+Math.imul(w,ne)|0,n=n+Math.imul(m,oe)|0,i=(i=i+Math.imul(m,ae)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,ae)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,le)|0)+Math.imul(v,ue)|0,o=o+Math.imul(v,le)|0;var ke=(l+(n=n+Math.imul(d,de)|0)|0)+((8191&(i=(i=i+Math.imul(d,fe)|0)+Math.imul(f,de)|0))<<13)|0;l=((o=o+Math.imul(f,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(N,K),i=(i=Math.imul(N,q))+Math.imul(B,K)|0,o=Math.imul(B,q),n=n+Math.imul(L,V)|0,i=(i=i+Math.imul(L,H)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,H)|0,n=n+Math.imul(A,z)|0,i=(i=i+Math.imul(A,Y)|0)+Math.imul(D,z)|0,o=o+Math.imul(D,Y)|0,n=n+Math.imul(R,$)|0,i=(i=i+Math.imul(R,J)|0)+Math.imul(x,$)|0,o=o+Math.imul(x,J)|0,n=n+Math.imul(C,X)|0,i=(i=i+Math.imul(C,ee)|0)+Math.imul(I,X)|0,o=o+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(k,re)|0,o=o+Math.imul(k,ne)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(w,oe)|0,o=o+Math.imul(w,ae)|0,n=n+Math.imul(m,ue)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(y,ue)|0,o=o+Math.imul(y,le)|0,n=n+Math.imul(p,de)|0,i=(i=i+Math.imul(p,fe)|0)+Math.imul(v,de)|0,o=o+Math.imul(v,fe)|0;var Me=(l+(n=n+Math.imul(d,pe)|0)|0)+((8191&(i=(i=i+Math.imul(d,ve)|0)+Math.imul(f,pe)|0))<<13)|0;l=((o=o+Math.imul(f,ve)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,n=Math.imul(N,V),i=(i=Math.imul(N,H))+Math.imul(B,V)|0,o=Math.imul(B,H),n=n+Math.imul(L,z)|0,i=(i=i+Math.imul(L,Y)|0)+Math.imul(U,z)|0,o=o+Math.imul(U,Y)|0,n=n+Math.imul(A,$)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(D,$)|0,o=o+Math.imul(D,J)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,n=n+Math.imul(C,re)|0,i=(i=i+Math.imul(C,ne)|0)+Math.imul(I,re)|0,o=o+Math.imul(I,ne)|0,n=n+Math.imul(E,oe)|0,i=(i=i+Math.imul(E,ae)|0)+Math.imul(k,oe)|0,o=o+Math.imul(k,ae)|0,n=n+Math.imul(_,ue)|0,i=(i=i+Math.imul(_,le)|0)+Math.imul(w,ue)|0,o=o+Math.imul(w,le)|0,n=n+Math.imul(m,de)|0,i=(i=i+Math.imul(m,fe)|0)+Math.imul(y,de)|0,o=o+Math.imul(y,fe)|0;var Ce=(l+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ve)|0)+Math.imul(v,pe)|0))<<13)|0;l=((o=o+Math.imul(v,ve)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(N,z),i=(i=Math.imul(N,Y))+Math.imul(B,z)|0,o=Math.imul(B,Y),n=n+Math.imul(L,$)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(U,$)|0,o=o+Math.imul(U,J)|0,n=n+Math.imul(A,X)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(D,X)|0,o=o+Math.imul(D,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ne)|0,n=n+Math.imul(C,oe)|0,i=(i=i+Math.imul(C,ae)|0)+Math.imul(I,oe)|0,o=o+Math.imul(I,ae)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,le)|0)+Math.imul(k,ue)|0,o=o+Math.imul(k,le)|0,n=n+Math.imul(_,de)|0,i=(i=i+Math.imul(_,fe)|0)+Math.imul(w,de)|0,o=o+Math.imul(w,fe)|0;var Ie=(l+(n=n+Math.imul(m,pe)|0)|0)+((8191&(i=(i=i+Math.imul(m,ve)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,ve)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(N,$),i=(i=Math.imul(N,J))+Math.imul(B,$)|0,o=Math.imul(B,J),n=n+Math.imul(L,X)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,n=n+Math.imul(A,re)|0,i=(i=i+Math.imul(A,ne)|0)+Math.imul(D,re)|0,o=o+Math.imul(D,ne)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,ae)|0,n=n+Math.imul(C,ue)|0,i=(i=i+Math.imul(C,le)|0)+Math.imul(I,ue)|0,o=o+Math.imul(I,le)|0,n=n+Math.imul(E,de)|0,i=(i=i+Math.imul(E,fe)|0)+Math.imul(k,de)|0,o=o+Math.imul(k,fe)|0;var Te=(l+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,ve)|0)+Math.imul(w,pe)|0))<<13)|0;l=((o=o+Math.imul(w,ve)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(N,X),i=(i=Math.imul(N,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),n=n+Math.imul(L,re)|0,i=(i=i+Math.imul(L,ne)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ne)|0,n=n+Math.imul(A,oe)|0,i=(i=i+Math.imul(A,ae)|0)+Math.imul(D,oe)|0,o=o+Math.imul(D,ae)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,le)|0)+Math.imul(x,ue)|0,o=o+Math.imul(x,le)|0,n=n+Math.imul(C,de)|0,i=(i=i+Math.imul(C,fe)|0)+Math.imul(I,de)|0,o=o+Math.imul(I,fe)|0;var Re=(l+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ve)|0)+Math.imul(k,pe)|0))<<13)|0;l=((o=o+Math.imul(k,ve)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(N,re),i=(i=Math.imul(N,ne))+Math.imul(B,re)|0,o=Math.imul(B,ne),n=n+Math.imul(L,oe)|0,i=(i=i+Math.imul(L,ae)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,ae)|0,n=n+Math.imul(A,ue)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(D,ue)|0,o=o+Math.imul(D,le)|0,n=n+Math.imul(R,de)|0,i=(i=i+Math.imul(R,fe)|0)+Math.imul(x,de)|0,o=o+Math.imul(x,fe)|0;var xe=(l+(n=n+Math.imul(C,pe)|0)|0)+((8191&(i=(i=i+Math.imul(C,ve)|0)+Math.imul(I,pe)|0))<<13)|0;l=((o=o+Math.imul(I,ve)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(N,oe),i=(i=Math.imul(N,ae))+Math.imul(B,oe)|0,o=Math.imul(B,ae),n=n+Math.imul(L,ue)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(U,ue)|0,o=o+Math.imul(U,le)|0,n=n+Math.imul(A,de)|0,i=(i=i+Math.imul(A,fe)|0)+Math.imul(D,de)|0,o=o+Math.imul(D,fe)|0;var Oe=(l+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ve)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,ve)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(N,ue),i=(i=Math.imul(N,le))+Math.imul(B,ue)|0,o=Math.imul(B,le),n=n+Math.imul(L,de)|0,i=(i=i+Math.imul(L,fe)|0)+Math.imul(U,de)|0,o=o+Math.imul(U,fe)|0;var Ae=(l+(n=n+Math.imul(A,pe)|0)|0)+((8191&(i=(i=i+Math.imul(A,ve)|0)+Math.imul(D,pe)|0))<<13)|0;l=((o=o+Math.imul(D,ve)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(N,de),i=(i=Math.imul(N,fe))+Math.imul(B,de)|0,o=Math.imul(B,fe);var De=(l+(n=n+Math.imul(L,pe)|0)|0)+((8191&(i=(i=i+Math.imul(L,ve)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,ve)|0)+(i>>>13)|0)+(De>>>26)|0,De&=67108863;var Pe=(l+(n=Math.imul(N,pe))|0)+((8191&(i=(i=Math.imul(N,ve))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,ve))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,u[0]=ge,u[1]=me,u[2]=ye,u[3]=be,u[4]=_e,u[5]=we,u[6]=Se,u[7]=Ee,u[8]=ke,u[9]=Me,u[10]=Ce,u[11]=Ie,u[12]=Te,u[13]=Re,u[14]=xe,u[15]=Oe,u[16]=Ae,u[17]=De,u[18]=Pe,0!==l&&(u[19]=l,r.length++),r};function v(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),o.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):n<63?h(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var a=i;i=0;for(var s=67108863&n,u=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=u;l++){var c=o-l,d=(0|e.words[c])*(0|t.words[l]),f=67108863&d;s=67108863&(f=f+s|0),i+=(a=(a=a+(d/67108864|0)|0)+(f>>>26)|0)>>>26,a&=67108863}r.words[o]=s,n=a,a=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,e,t):v(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,o){for(var a=0;a<o;a++)n[a]=t[e[a]],i[a]=r[e[a]]},g.prototype.transform=function(e,t,r,n,i,o){this.permute(o,e,t,r,n,i);for(var a=1;a<i;a<<=1)for(var s=a<<1,u=Math.cos(2*Math.PI/s),l=Math.sin(2*Math.PI/s),c=0;c<i;c+=s)for(var d=u,f=l,h=0;h<a;h++){var p=r[c+h],v=n[c+h],g=r[c+h+a],m=n[c+h+a],y=d*g-f*m;m=d*m+f*g,g=y,r[c+h]=p+g,n[c+h]=v+m,r[c+h+a]=p-g,n[c+h+a]=v-m,h!==s&&(y=u*d-l*f,f=u*f+l*d,d=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},g.prototype.convert13b=function(e,t,n,i){for(var o=0,a=0;a<t;a++)o+=0|e[a],n[2*a]=8191&o,o>>>=13,n[2*a+1]=8191&o,o>>>=13;for(a=2*t;a<i;++a)n[a]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),o=this.stub(n),a=new Array(n),s=new Array(n),u=new Array(n),l=new Array(n),c=new Array(n),d=new Array(n),f=r.words;f.length=n,this.convert13b(e.words,e.length,a,n),this.convert13b(t.words,t.length,l,n),this.transform(a,o,s,u,n,i),this.transform(l,o,c,d,n,i);for(var h=0;h<n;h++){var p=s[h]*c[h]-u[h]*d[h];u[h]=s[h]*d[h]+u[h]*c[h],s[h]=p}return this.conjugate(s,u,n),this.transform(s,u,f,o,n,i),this.conjugate(f,o,n),this.normalize13b(f,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),v(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,o=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=o>>>26,this.words[n]=67108863&o}return 0!==t&&(this.words[n]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new o(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,o=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var s=this.words[t]&o,u=(0|this.words[t])-s<<n;this.words[t]=u|a,a=s>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var o=e%26,a=Math.min((e-o)/26,this.length),s=67108863^67108863>>>o<<o,u=n;if(i-=a,i=Math.max(0,i),u){for(var l=0;l<a;l++)u.words[l]=this.words[l];u.length=a}if(0===a);else if(this.length>a)for(this.length-=a,l=0;l<this.length;l++)this.words[l]=this.words[l+a];else this.words[0]=0,this.length=1;var c=0;for(l=this.length-1;l>=0&&(0!==c||l>=i);l--){var d=0|this.words[l];this.words[l]=c<<26-o|d>>>o,c=d&s}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,n){var i,o,a=e.length+n;this._expand(a);var s=0;for(i=0;i<e.length;i++){o=(0|this.words[i+n])+s;var u=(0|e.words[i])*t;s=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&o}for(;i<this.length-n;i++)s=(o=(0|this.words[i+n])+s)>>26,this.words[i+n]=67108863&o;if(0===s)return this.strip();for(r(-1===s),s=0,i=0;i<this.length;i++)s=(o=-(0|this.words[i])+s)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),i=e,a=0|i.words[i.length-1];0!==(r=26-this._countBits(a))&&(i=i.ushln(r),n.iushln(r),a=0|i.words[i.length-1]);var s,u=n.length-i.length;if("mod"!==t){(s=new o(null)).length=u+1,s.words=new Array(s.length);for(var l=0;l<s.length;l++)s.words[l]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,s&&(s.words[u]=1));for(var d=u-1;d>=0;d--){var f=67108864*(0|n.words[i.length+d])+(0|n.words[i.length+d-1]);for(f=Math.min(f/a|0,67108863),n._ishlnsubmul(i,f,d);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(i,1,d),n.isZero()||(n.negative^=1);s&&(s.words[d]=f)}return s&&s.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:s||null,mod:n}},o.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:i,mod:a}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):0!=(this.negative&e.negative)?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(a=s.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:s.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var i,a,s},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new o(1),a=new o(0),s=new o(0),u=new o(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var c=n.clone(),d=t.clone();!t.isZero();){for(var f=0,h=1;0==(t.words[0]&h)&&f<26;++f,h<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(d)),i.iushrn(1),a.iushrn(1);for(var p=0,v=1;0==(n.words[0]&v)&&p<26;++p,v<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(s.isOdd()||u.isOdd())&&(s.iadd(c),u.isub(d)),s.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(s),a.isub(u)):(n.isub(t),s.isub(i),u.isub(a))}return{a:s,b:u,gcd:n.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,a=new o(1),s=new o(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,c=1;0==(t.words[0]&c)&&l<26;++l,c<<=1);if(l>0)for(t.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);for(var d=0,f=1;0==(n.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(n.iushrn(d);d-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(s)):(n.isub(t),s.isub(a))}return(i=0===t.cmpn(1)?a:s).cmpn(0)<0&&i.iadd(e),i},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var o=t;t=r,r=o}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var o=i,a=n;0!==o&&a<this.length;a++){var s=0|this.words[a];o=(s+=o)>>>26,s&=67108863,this.words[a]=s}return 0!==o&&(this.words[a]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function k(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},i(b,y),b.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,i=10;i<e.length;i++){var a=0|e.words[i];e.words[i-10]=(a&r)<<4|o>>>22,o=a}o>>>=22,e.words[i-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,y),i(w,y),i(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new _;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new o(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),a=0;!i.isZero()&&0===i.andln(1);)a++,i.iushrn(1);r(!i.isZero());var s=new o(1).toRed(this),u=s.redNeg(),l=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,l).cmp(u);)c.redIAdd(u);for(var d=this.pow(c,i),f=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=a;0!==h.cmp(s);){for(var v=h,g=0;0!==v.cmp(s);g++)v=v.redSqr();r(g<p);var m=this.pow(d,new o(1).iushln(p-g-1));f=f.redMul(m),d=m.redSqr(),h=h.redMul(d),p=g}return f},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var i=r[0],a=0,s=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var l=t.words[n],c=u-1;c>=0;c--){var d=l>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==d||0!==a?(a<<=1,a|=d,(4===++s||0===n&&0===c)&&(i=this.mul(i,r[a]),s=0,a=0)):s=0}u=26}return i},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new k(e)},i(k,E),k.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},k.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},k.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},k.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},k.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),n.register("U5ZPV",(function(e,t){var r=n("4V35i"),i=n("j0zCv").Buffer;e.exports=function(e,t){return i.from(e.toRed(r.mont(t.modulus)).redPow(new r(t.publicExponent)).fromRed().toArray())}})),n.register("iUPUW",(function(e,t){var r=n("kukaq"),i=n("1ZpJV"),o=n("9JS7g"),a=n("4V35i"),s=n("dRTKf"),u=n("bdvz5"),l=n("U5ZPV"),c=n("j0zCv").Buffer;e.exports=function(e,t,n){var d;d=e.padding?e.padding:n?1:4;var f,h=r(e),p=h.modulus.byteLength();if(t.length>p||new a(t).cmp(h.modulus)>=0)throw new Error("decryption error");f=n?l(new a(t),h):s(t,h);var v=c.alloc(p-f.length);if(f=c.concat([v,f],p),4===d)return function(e,t){var r=e.modulus.byteLength(),n=u("sha1").update(c.alloc(0)).digest(),a=n.length;if(0!==t[0])throw new Error("decryption error");var s=t.slice(1,a+1),l=t.slice(a+1),d=o(s,i(l,a)),f=o(l,i(d,r-a-1));if(function(e,t){e=c.from(e),t=c.from(t);var r=0,n=e.length;e.length!==t.length&&(r++,n=Math.min(e.length,t.length));var i=-1;for(;++i<n;)r+=e[i]^t[i];return r}(n,f.slice(0,a)))throw new Error("decryption error");var h=a;for(;0===f[h];)h++;if(1!==f[h++])throw new Error("decryption error");return f.slice(h)}(h,f);if(1===d)return function(e,t,r){var n=t.slice(0,2),i=2,o=0;for(;0!==t[i++];)if(i>=t.length){o++;break}var a=t.slice(2,i-1);("0002"!==n.toString("hex")&&!r||"0001"!==n.toString("hex")&&r)&&o++;a.length<8&&o++;if(o)throw new Error("decryption error");return t.slice(i)}(0,f,n);if(3===d)return f;throw new Error("unknown padding")}})),n.register("bg03w",(function(t,i){var o,a;e(t.exports,"randomFill",(function(){return o}),(function(e){return o=e})),e(t.exports,"randomFillSync",(function(){return a}),(function(e){return a=e}));var s=n("b758v");function u(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var l=n("j0zCv"),c=(n("4p9KL"),l.Buffer),d=l.kMaxLength,f=r.crypto||r.msCrypto,h=Math.pow(2,32)-1;function p(e,t){if("number"!=typeof e||e!=e)throw new TypeError("offset must be a number");if(e>h||e<0)throw new TypeError("offset must be a uint32");if(e>d||e>t)throw new RangeError("offset out of range")}function v(e,t,r){if("number"!=typeof e||e!=e)throw new TypeError("size must be a number");if(e>h||e<0)throw new TypeError("size must be a uint32");if(e+t>r||e>d)throw new RangeError("buffer too small")}function g(e,t,r,n){var i=e.buffer,o=new Uint8Array(i,t,r);if(f.getRandomValues(o),!n)return e;s.nextTick((function(){n(null,e)}))}f&&f.getRandomValues?(o=function(e,t,n,i){if(!(c.isBuffer(e)||e instanceof r.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof t)i=t,t=0,n=e.length;else if("function"==typeof n)i=n,n=e.length-t;else if("function"!=typeof i)throw new TypeError('"cb" argument must be a function');return p(t,e.length),v(n,t,e.length),g(e,t,n,i)},a=function(e,t,n){void 0===t&&(t=0);if(!(c.isBuffer(e)||e instanceof r.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');p(t,e.length),void 0===n&&(n=e.length-t);return v(n,t,e.length),g(e,t,n)}):(o=u,a=u)})),n.register("77bst",(function(e,t){var r=n("aojpe"),i=n("b758v"),o=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},a=/%[sdj%]/g;e.exports.format=function(e){if(!b(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(l(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,o=String(e).replace(a,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),s=n[r];r<i;s=n[++r])m(s)||!S(s)?o+=" "+s:o+=" "+l(s);return o},e.exports.deprecate=function(t,r){if(void 0!==i&&!0===i.noDeprecation)return t;if(void 0===i)return function(){return e.exports.deprecate(t,r).apply(this,arguments)};var n=!1;return function(){if(!n){if(i.throwDeprecation)throw new Error(r);i.traceDeprecation?console.trace(r):console.error(r),n=!0}return t.apply(this,arguments)}};var s={},u=/^$/;function l(t,r){var n={seen:[],stylize:d};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),g(r)?n.showHidden=r:r&&e.exports._extend(n,r),_(n.showHidden)&&(n.showHidden=!1),_(n.depth)&&(n.depth=2),_(n.colors)&&(n.colors=!1),_(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),f(n,t,n.depth)}function c(e,t){var r=l.styles[t];return r?"["+l.colors[r][0]+"m"+e+"["+l.colors[r][1]+"m":e}function d(e,t){return e}function f(t,r,n){if(t.customInspect&&r&&M(r.inspect)&&r.inspect!==e.exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,t);return b(i)||(i=f(t,i,n)),i}var o=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(b(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(y(t))return e.stylize(""+t,"number");if(g(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(t,r);if(o)return o;var a=Object.keys(r),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),k(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return h(r);if(0===a.length){if(M(r)){var u=r.name?": "+r.name:"";return t.stylize("[Function"+u+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return t.stylize(Date.prototype.toString.call(r),"date");if(k(r))return h(r)}var l,c="",d=!1,S=["{","}"];(v(r)&&(d=!0,S=["[","]"]),M(r))&&(c=" [Function"+(r.name?": "+r.name:"")+"]");return w(r)&&(c=" "+RegExp.prototype.toString.call(r)),E(r)&&(c=" "+Date.prototype.toUTCString.call(r)),k(r)&&(c=" "+h(r)),0!==a.length||d&&0!=r.length?n<0?w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=d?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)x(t,String(a))?o.push(p(e,t,r,n,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,r,n,i,!0))})),o}(t,r,n,s,a):a.map((function(e){return p(t,r,n,s,e,d)})),t.seen.pop(),function(e,t,r){var n=0;return e.reduce((function(e,t){n++;if(t.indexOf("\n")>=0)n++;return e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(l,c,S)):S[0]+c+S[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),x(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=m(r)?f(e,u.value,null):f(e,u.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").slice(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),_(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.slice(1,-1),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function v(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function _(e){return void 0===e}function w(e){return S(e)&&"[object RegExp]"===C(e)}function S(e){return"object"==typeof e&&null!==e}function E(e){return S(e)&&"[object Date]"===C(e)}function k(e){return S(e)&&("[object Error]"===C(e)||e instanceof Error)}function M(e){return"function"==typeof e}function C(e){return Object.prototype.toString.call(e)}function I(e){return e<10?"0"+e.toString(10):e.toString(10)}e.exports.debuglog=function(t){if(t=t.toUpperCase(),!s[t])if(u.test(t)){var r=i.pid;s[t]=function(){var n=e.exports.format.apply(e.exports,arguments);console.error("%s %d: %s",t,r,n)}}else s[t]=function(){};return s[t]},e.exports.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.exports.types=n("1nV79"),e.exports.isArray=v,e.exports.isBoolean=g,e.exports.isNull=m,e.exports.isNullOrUndefined=function(e){return null==e},e.exports.isNumber=y,e.exports.isString=b,e.exports.isSymbol=function(e){return"symbol"===(void 0===e?"undefined":(0,r.default)(e))},e.exports.isUndefined=_,e.exports.isRegExp=w,e.exports.types.isRegExp=w,e.exports.isObject=S,e.exports.isDate=E,e.exports.types.isDate=E,e.exports.isError=k,e.exports.types.isNativeError=k,e.exports.isFunction=M,e.exports.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":(0,r.default)(e))||void 0===e},e.exports.isBuffer=n("f3tcu");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(){var e=new Date,t=[I(e.getHours()),I(e.getMinutes()),I(e.getSeconds())].join(":");return[e.getDate(),T[e.getMonth()],t].join(" ")}function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports.log=function(){console.log("%s - %s",R(),e.exports.format.apply(e.exports,arguments))},e.exports.inherits=n("fospZ"),e.exports._extend=function(e,t){if(!t||!S(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var O="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function A(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}e.exports.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(O&&e[O]){var t;if("function"!=typeof(t=e[O]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),O&&Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,o(e))},e.exports.promisify.custom=O,e.exports.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var n=t.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return n.apply(o,arguments)};e.apply(this,t).then((function(e){i.nextTick(a.bind(null,null,e))}),(function(e){i.nextTick(A.bind(null,e,a))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,o(e)),t}})),n.register("1nV79",(function(e,t){"use strict";var r=n("f5iby"),i=n("1D6LV"),o=n("fA6cf"),a=n("eusQM");function s(e){return e.call.bind(e)}var u="undefined"!=typeof BigInt,l="undefined"!=typeof Symbol,c=s(Object.prototype.toString),d=s(Number.prototype.valueOf),f=s(String.prototype.valueOf),h=s(Boolean.prototype.valueOf);if(u)var p=s(BigInt.prototype.valueOf);if(l)var v=s(Symbol.prototype.valueOf);function g(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function m(e){return"[object Map]"===c(e)}function y(e){return"[object Set]"===c(e)}function b(e){return"[object WeakMap]"===c(e)}function _(e){return"[object WeakSet]"===c(e)}function w(e){return"[object ArrayBuffer]"===c(e)}function S(e){return"undefined"!=typeof ArrayBuffer&&(w.working?w(e):e instanceof ArrayBuffer)}function E(e){return"[object DataView]"===c(e)}function k(e){return"undefined"!=typeof DataView&&(E.working?E(e):e instanceof DataView)}e.exports.isArgumentsObject=r,e.exports.isGeneratorFunction=i,e.exports.isTypedArray=a,e.exports.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},e.exports.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):a(e)||k(e)},e.exports.isUint8Array=function(e){return"Uint8Array"===o(e)},e.exports.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===o(e)},e.exports.isUint16Array=function(e){return"Uint16Array"===o(e)},e.exports.isUint32Array=function(e){return"Uint32Array"===o(e)},e.exports.isInt8Array=function(e){return"Int8Array"===o(e)},e.exports.isInt16Array=function(e){return"Int16Array"===o(e)},e.exports.isInt32Array=function(e){return"Int32Array"===o(e)},e.exports.isFloat32Array=function(e){return"Float32Array"===o(e)},e.exports.isFloat64Array=function(e){return"Float64Array"===o(e)},e.exports.isBigInt64Array=function(e){return"BigInt64Array"===o(e)},e.exports.isBigUint64Array=function(e){return"BigUint64Array"===o(e)},m.working="undefined"!=typeof Map&&m(new Map),e.exports.isMap=function(e){return"undefined"!=typeof Map&&(m.working?m(e):e instanceof Map)},y.working="undefined"!=typeof Set&&y(new Set),e.exports.isSet=function(e){return"undefined"!=typeof Set&&(y.working?y(e):e instanceof Set)},b.working="undefined"!=typeof WeakMap&&b(new WeakMap),e.exports.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(b.working?b(e):e instanceof WeakMap)},_.working="undefined"!=typeof WeakSet&&_(new WeakSet),e.exports.isWeakSet=function(e){return _(e)},w.working="undefined"!=typeof ArrayBuffer&&w(new ArrayBuffer),e.exports.isArrayBuffer=S,E.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&E(new DataView(new ArrayBuffer(1),0,1)),e.exports.isDataView=k;var M="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function C(e){return"[object SharedArrayBuffer]"===c(e)}function I(e){return void 0!==M&&(void 0===C.working&&(C.working=C(new M)),C.working?C(e):e instanceof M)}function T(e){return g(e,d)}function R(e){return g(e,f)}function x(e){return g(e,h)}function O(e){return u&&g(e,p)}function A(e){return l&&g(e,v)}e.exports.isSharedArrayBuffer=I,e.exports.isAsyncFunction=function(e){return"[object AsyncFunction]"===c(e)},e.exports.isMapIterator=function(e){return"[object Map Iterator]"===c(e)},e.exports.isSetIterator=function(e){return"[object Set Iterator]"===c(e)},e.exports.isGeneratorObject=function(e){return"[object Generator]"===c(e)},e.exports.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===c(e)},e.exports.isNumberObject=T,e.exports.isStringObject=R,e.exports.isBooleanObject=x,e.exports.isBigIntObject=O,e.exports.isSymbolObject=A,e.exports.isBoxedPrimitive=function(e){return T(e)||R(e)||x(e)||O(e)||A(e)},e.exports.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(S(e)||I(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(t){Object.defineProperty(e.exports,t,{enumerable:!1,value:function(){throw new Error(t+" is not supported in userland")}})}))})),n.register("f5iby",(function(e,t){"use strict";var r=n("3alTs")(),i=n("4mPVj")("Object.prototype.toString"),o=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===i(e)},a=function(e){return!!o(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"[object Function]"===i(e.callee)},s=function(){return o(arguments)}();o.isLegacyArguments=a,e.exports=s?o:a})),n.register("3alTs",(function(e,t){"use strict";var r=n("hlnoI");e.exports=function(){return r()&&!!Symbol.toStringTag}})),n.register("hlnoI",(function(e,t){var r=n("aojpe");e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"===(0,r.default)(Symbol.iterator))return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}})),n.register("4mPVj",(function(e,t){"use strict";var r=n("eJhu3"),i=n("eb7ZB"),o=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&o(e,".prototype.")>-1?i(n):n}})),n.register("eJhu3",(function(e,t){"use strict";var r,i=SyntaxError,o=Function,a=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(e){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(e){u=null}var l=function(){throw new a},c=u?function(){try{return l}catch(e){try{return u(arguments,"callee").get}catch(e){return l}}}():l,d=n("puU4M")(),f=Object.getPrototypeOf||function(e){return e.__proto__},h={},p="undefined"==typeof Uint8Array?r:f(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":d?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":h,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?f(""[Symbol.iterator]()):r,"%Symbol%":d?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":c,"%TypedArray%":p,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},g=function e(t){var r;if("%AsyncFunction%"===t)r=s("async function () {}");else if("%GeneratorFunction%"===t)r=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=s("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(r=f(i.prototype))}return v[t]=r,r},m={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=n("60Zt4"),b=n("eEZ8l"),_=y.call(Function.call,Array.prototype.concat),w=y.call(Function.apply,Array.prototype.splice),S=y.call(Function.call,String.prototype.replace),E=y.call(Function.call,String.prototype.slice),k=y.call(Function.call,RegExp.prototype.exec),M=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,C=/\\(\\)?/g,I=function(e){var t=E(e,0,1),r=E(e,-1);if("%"===t&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return S(e,M,(function(e,t,r,i){n[n.length]=r?S(i,C,"$1"):t||e})),n},T=function(e,t){var r,n=e;if(b(m,n)&&(n="%"+(r=m[n])[0]+"%"),b(v,n)){var o=v[n];if(o===h&&(o=g(n)),void 0===o&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');if(null===k(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=I(e),n=r.length>0?r[0]:"",o=T("%"+n+"%",t),s=o.name,l=o.value,c=!1,d=o.alias;d&&(n=d[0],w(r,_([0,1],d)));for(var f=1,h=!0;f<r.length;f+=1){var p=r[f],g=E(p,0,1),m=E(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===m||"'"===m||"`"===m)&&g!==m)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&h||(c=!0),b(v,s="%"+(n+="."+p)+"%"))l=v[s];else if(null!=l){if(!(p in l)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&f+1>=r.length){var y=u(l,p);l=(h=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[p]}else h=b(l,p),l=l[p];h&&!c&&(v[s]=l)}}return l}})),n.register("puU4M",(function(e,t){var r=n("aojpe"),i="undefined"!=typeof Symbol&&Symbol,o=n("hlnoI");e.exports=function(){return"function"==typeof i&&("function"==typeof Symbol&&("symbol"===(0,r.default)(i("foo"))&&("symbol"===(0,r.default)(Symbol("bar"))&&o())))}})),n.register("60Zt4",(function(e,t){"use strict";var r=n("l2miN");e.exports=Function.prototype.bind||r})),n.register("l2miN",(function(e,t){"use strict";var r="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,i=Object.prototype.toString,o="[object Function]";e.exports=function(e){var t=this;if("function"!=typeof t||i.call(t)!==o)throw new TypeError(r+t);for(var a,s=n.call(arguments,1),u=function(){if(this instanceof a){var r=t.apply(this,s.concat(n.call(arguments)));return Object(r)===r?r:this}return t.apply(e,s.concat(n.call(arguments)))},l=Math.max(0,t.length-s.length),c=[],d=0;d<l;d++)c.push("$"+d);if(a=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(u),t.prototype){var f=function(){};f.prototype=t.prototype,a.prototype=new f,f.prototype=null}return a}})),n.register("eEZ8l",(function(e,t){"use strict";var r=n("60Zt4");e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)})),n.register("eb7ZB",(function(e,t){"use strict";var r=n("60Zt4"),i=n("eJhu3"),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(a,o),u=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),c=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=s(r,a,arguments);if(u&&l){var n=u(t,"length");n.configurable&&l(t,"length",{value:1+c(0,e.length-(arguments.length-1))})}return t};var d=function(){return s(r,o,arguments)};l?l(e.exports,"apply",{value:d}):e.exports.apply=d})),n.register("1D6LV",(function(e,t){"use strict";var r,i=Object.prototype.toString,o=Function.prototype.toString,a=/^\s*(?:function)?\*/,s=n("3alTs")(),u=Object.getPrototypeOf;e.exports=function(e){if("function"!=typeof e)return!1;if(a.test(o.call(e)))return!0;if(!s)return"[object GeneratorFunction]"===i.call(e);if(!u)return!1;if(void 0===r){var t=function(){if(!s)return!1;try{return Function("return function*() {}")()}catch(e){}}();r=!!t&&u(t)}return u(e)===r}})),n.register("fA6cf",(function(e,t){"use strict";var i=n("c4F2f"),o=n("dVCCt"),a=n("4mPVj"),s=n("4U4yC"),u=a("Object.prototype.toString"),l=n("3alTs")(),c="undefined"==typeof globalThis?r:globalThis,d=o(),f=a("String.prototype.slice"),h={},p=Object.getPrototypeOf;l&&s&&p&&i(d,(function(e){if("function"==typeof c[e]){var t=new c[e];if(Symbol.toStringTag in t){var r=p(t),n=s(r,Symbol.toStringTag);if(!n){var i=p(r);n=s(i,Symbol.toStringTag)}h[e]=n.get}}}));var v=n("eusQM");e.exports=function(e){return!!v(e)&&(l&&Symbol.toStringTag in e?function(e){var t=!1;return i(h,(function(r,n){if(!t)try{var i=r.call(e);i===n&&(t=i)}catch(e){}})),t}(e):f(u(e),8,-1))}})),n.register("c4F2f",(function(e,t){"use strict";var r=n("7tAor"),i=Object.prototype.toString,o=Object.prototype.hasOwnProperty,a=function(e,t,r){for(var n=0,i=e.length;n<i;n++)o.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))},s=function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)},u=function(e,t,r){for(var n in e)o.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))};e.exports=function(e,t,n){if(!r(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=n),"[object Array]"===i.call(e)?a(e,t,o):"string"==typeof e?s(e,t,o):u(e,t,o)}})),n.register("7tAor",(function(e,t){"use strict";var r,n,i=Function.prototype.toString,o="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof o&&"function"==typeof Object.defineProperty)try{r=Object.defineProperty({},"length",{get:function(){throw n}}),n={},o((function(){throw 42}),null,r)}catch(e){e!==n&&(o=null)}else o=null;var a=/^\s*class\b/,s=function(e){try{var t=i.call(e);return a.test(t)}catch(e){return!1}},u=function(e){try{return!s(e)&&(i.call(e),!0)}catch(e){return!1}},l=Object.prototype.toString,c="function"==typeof Symbol&&!!Symbol.toStringTag,d=!(0 in[,]),f=function(){return!1};if("object"==typeof document){var h=document.all;l.call(h)===l.call(document.all)&&(f=function(e){if((d||!e)&&(void 0===e||"object"==typeof e))try{var t=l.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}e.exports=o?function(e){if(f(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{o(e,null,r)}catch(e){if(e!==n)return!1}return!s(e)&&u(e)}:function(e){if(f(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(c)return u(e);if(s(e))return!1;var t=l.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&u(e)}})),n.register("dVCCt",(function(e,t){"use strict";var n=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?r:globalThis;e.exports=function(){for(var e=[],t=0;t<n.length;t++)"function"==typeof i[n[t]]&&(e[e.length]=n[t]);return e}})),n.register("4U4yC",(function(e,t){"use strict";var r=n("eJhu3")("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r})),n.register("eusQM",(function(e,t){"use strict";var i=n("c4F2f"),o=n("dVCCt"),a=n("4mPVj"),s=a("Object.prototype.toString"),u=n("3alTs")(),l=n("4U4yC"),c="undefined"==typeof globalThis?r:globalThis,d=o(),f=a("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return-1},h=a("String.prototype.slice"),p={},v=Object.getPrototypeOf;u&&l&&v&&i(d,(function(e){var t=new c[e];if(Symbol.toStringTag in t){var r=v(t),n=l(r,Symbol.toStringTag);if(!n){var i=v(r);n=l(i,Symbol.toStringTag)}p[e]=n.get}}));e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!u||!(Symbol.toStringTag in e)){var t=h(s(e),8,-1);return f(d,t)>-1}return!!l&&function(e){var t=!1;return i(p,(function(r,n){if(!t)try{t=r.call(e)===n}catch(e){}})),t}(e)}})),n.register("f3tcu",(function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}})),n.register("kMusr",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("mBz5n"),l=n("giCK6"),c=n("eQNFO"),d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EncryptionSetupOperation=e.exports.EncryptionSetupBuilder=void 0;var f=d(n("3rHpI")),h=n("jtqeE"),p=n("jEuTn"),v=n("f1UAv"),g=n("8A6lK"),m=n("6BFg8"),y=n("4uAg3"),b=n("6MMVS"),_=function(){function e(t,r){(0,o.default)(this,e),(0,f.default)(this,"accountDataClientAdapter",void 0),(0,f.default)(this,"crossSigningCallbacks",void 0),(0,f.default)(this,"ssssCryptoCallbacks",void 0),(0,f.default)(this,"crossSigningKeys",void 0),(0,f.default)(this,"keySignatures",void 0),(0,f.default)(this,"keyBackupInfo",void 0),(0,f.default)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new S(t),this.crossSigningCallbacks=new E,this.ssssCryptoCallbacks=new k(r)}return(0,a.default)(e,[{key:"addCrossSigningKeys",value:function(e,t){this.crossSigningKeys={authUpload:e,keys:t}}},{key:"addSessionBackup",value:function(e){this.keyBackupInfo=e}},{key:"addSessionBackupPrivateKeyToCache",value:function(e){this.sessionBackupPrivateKey=e}},{key:"addKeySignature",value:function(e,t,r){this.keySignatures||(this.keySignatures={});var n=this.keySignatures[e]||{};this.keySignatures[e]=n,n[t]=r}},{key:"setAccountData",value:function(e,t){var r=this;return(0,i.default)((function(){return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.accountDataClientAdapter.setAccountData(e,t)];case 1:return n.sent(),[2]}}))}))()}},{key:"buildOperation",value:function(){var e=this.accountDataClientAdapter.values;return new w(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}},{key:"persist",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s;return(0,c.__generator)(this,(function(u){switch(u.label){case 0:if(!t.crossSigningKeys)return[3,6];r=(0,v.createCryptoStoreCacheCallbacks)(e.cryptoStore,e.olmDevice),n=0,i=["master","self_signing","user_signing"],u.label=1;case 1:return n<i.length?(o=i[n],h.logger.log("Cache ".concat(o," cross-signing private key locally")),s=t.crossSigningCallbacks.privateKeys.get(o),[4,null===(a=r.storeCrossSigningKeyCache)||void 0===a?void 0:a.call(r,o,s)]):[3,4];case 2:u.sent(),u.label=3;case 3:return n++,[3,1];case 4:return[4,e.cryptoStore.doTxn("readwrite",[g.IndexedDBCryptoStore.STORE_ACCOUNT],(function(r){e.cryptoStore.storeCrossSigningKeys(r,t.crossSigningKeys.keys)}))];case 5:u.sent(),u.label=6;case 6:return t.sessionBackupPrivateKey?[4,e.storeSessionBackupPrivateKey(t.sessionBackupPrivateKey)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[2]}}))}))()}}]),e}();e.exports.EncryptionSetupBuilder=_;var w=function(){function e(t,r,n,i){(0,o.default)(this,e),this.accountData=t,this.crossSigningKeys=r,this.keyBackupInfo=n,this.keySignatures=i}return(0,a.default)(e,[{key:"apply",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,l,d,f,h,p,v,g,y,b,_,w,S,E,k,M;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:if(r=e.baseApis,!t.crossSigningKeys)return[3,2];o={},a=!0,s=!1,l=void 0;try{for(d=Object.entries(t.crossSigningKeys.keys)[Symbol.iterator]();!(a=(f=d.next()).done);a=!0)h=(0,u.default)(f.value,2),p=h[0],v=h[1],o[p+"_key"]=v}catch(e){s=!0,l=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw l}}return[4,null===(n=(i=t.crossSigningKeys).authUpload)||void 0===n?void 0:n.call(i,(function(e){return r.uploadDeviceSigningKeys(e,o)}))];case 1:c.sent(),e.crossSigningInfo.setKeys(t.crossSigningKeys.keys),c.label=2;case 2:if(g=!0,y=!1,b=void 0,!t.accountData)return[3,10];c.label=3;case 3:c.trys.push([3,8,9,10]),_=t.accountData[Symbol.iterator](),c.label=4;case 4:return(g=(w=_.next()).done)?[3,7]:(S=(0,u.default)(w.value,2),E=S[0],k=S[1],[4,r.setAccountData(E,k)]);case 5:c.sent(),c.label=6;case 6:return g=!0,[3,4];case 7:return[3,10];case 8:return M=c.sent(),y=!0,b=M,[3,10];case 9:try{g||null==_.return||_.return()}finally{if(y)throw b}return[7];case 10:return t.keySignatures?[4,r.uploadKeySignatures(t.keySignatures)]:[3,12];case 11:c.sent(),c.label=12;case 12:return t.keyBackupInfo?t.keyBackupInfo.version?[4,r.http.authedRequest(m.Method.Put,"/room_keys/version/"+t.keyBackupInfo.version,void 0,{algorithm:t.keyBackupInfo.algorithm,auth_data:t.keyBackupInfo.auth_data},{prefix:m.ClientPrefix.V3})]:[3,14]:[3,16];case 13:return c.sent(),[3,16];case 14:return[4,r.http.authedRequest(m.Method.Post,"/room_keys/version",void 0,t.keyBackupInfo,{prefix:m.ClientPrefix.V3})];case 15:c.sent(),c.label=16;case 16:return[2]}}))}))()}}]),e}();e.exports.EncryptionSetupOperation=w;var S=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(e){var i;return(0,o.default)(this,n),(i=t.call(this)).existingValues=e,(0,f.default)((0,r.default)(i),"values",new Map),i}return(0,a.default)(n,[{key:"getAccountDataFromServer",value:function(e){return Promise.resolve(this.getAccountData(e))}},{key:"getAccountData",value:function(e){var t=this.values.get(e);if(t)return t;var r=this.existingValues[e];return r?r.getContent():null}},{key:"setAccountData",value:function(e,t){var r=this,n=this.values.get(e);return this.values.set(e,t),Promise.resolve().then((function(){var i=new p.MatrixEvent({type:e,content:t});return r.emit(y.ClientEvent.AccountData,i,n),{}}))}}]),n}(b.TypedEventEmitter),E=function(){function e(){(0,o.default)(this,e),(0,f.default)(this,"privateKeys",new Map)}return(0,a.default)(e,[{key:"getCrossSigningKeyCache",value:function(e,t){return this.getCrossSigningKey(e,t)}},{key:"storeCrossSigningKeyCache",value:function(e,t){return this.privateKeys.set(e,t),Promise.resolve()}},{key:"getCrossSigningKey",value:function(e,t){var r;return Promise.resolve(null!==(r=this.privateKeys.get(e))&&void 0!==r?r:null)}},{key:"saveCrossSigningKeys",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=Object.entries(e)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,u.default)(i.value,2),s=a[0],l=a[1];this.privateKeys.set(s,l)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}}]),e}(),k=function(){function e(t){(0,o.default)(this,e),this.delegateCryptoCallbacks=t,(0,f.default)(this,"privateKeys",new Map)}return(0,a.default)(e,[{key:"getSecretStorageKey",value:function(e,t){var r=e.keys,n=this;return(0,i.default)((function(){var e,i,o,a,s,l,d,f,h,p,v,g;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:i=!0,o=!1,a=void 0;try{for(s=Object.keys(r)[Symbol.iterator]();!(i=(l=s.next()).done);i=!0)if(d=l.value,f=n.privateKeys.get(d))return[2,[d,f]]}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return null!=n&&null!==(e=n.delegateCryptoCallbacks)&&void 0!==e&&e.getSecretStorageKey?[4,n.delegateCryptoCallbacks.getSecretStorageKey({keys:r},t)]:[3,2];case 1:return(h=c.sent())&&(p=(0,u.default)(h,2),v=p[0],g=p[1],n.privateKeys.set(v,g)),[2,h];case 2:return[2,null]}}))}))()}},{key:"addPrivateKey",value:function(e,t,r){var n,i;this.privateKeys.set(e,r),null===(n=this.delegateCryptoCallbacks)||void 0===n||null===(i=n.cacheSecretStorageKey)||void 0===i||i.call(n,e,t,r)}}]),e}()})),n.register("4zzqM",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("mBz5n"),u=n("eQNFO"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SecretStorage=e.exports.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var c=l(n("3rHpI")),d=n("329cj"),f=n("jtqeE"),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=b(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("dbGKv")),p=n("94a5L"),v=n("5zTlo"),g=n("4uAg3"),m=n("e8gas"),y=n("8bPbt");function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(b=function(e){return e?r:t})(e)}var _="m.secret_storage.v1.aes-hmac-sha2";e.exports.SECRET_STORAGE_ALGORITHM_V1_AES=_;var w=function(){function e(t,r,n){(0,i.default)(this,e),this.accountDataAdapter=t,this.cryptoCallbacks=r,this.baseApis=n,(0,c.default)(this,"requests",new Map)}return(0,o.default)(e,[{key:"getDefaultKeyId",value:function(){var e=this;return(0,r.default)((function(){var t;return(0,u.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key")];case 1:return(t=r.sent())?[2,t.key]:[2,null]}}))}))()}},{key:"setDefaultKeyId",value:function(e){var t=this;return new Promise((function(r,n){var i=function(n){"m.secret_storage.default_key"===n.getType()&&n.getContent().key===e&&(t.accountDataAdapter.removeListener(g.ClientEvent.AccountData,i),r())};t.accountDataAdapter.on(g.ClientEvent.AccountData,i),t.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch((function(e){t.accountDataAdapter.removeListener(g.ClientEvent.AccountData,i),n(e)}))}))}},{key:"addKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=this;return(0,r.default)((function(){var r,o,a,s;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return r={algorithm:e},t.name&&(r.name=t.name),e!==_?[3,3]:(t.passphrase&&(r.passphrase=t.passphrase),t.key?[4,(0,v.calculateKeyCheck)(t.key)]:[3,2]);case 1:o=u.sent(),a=o.iv,s=o.mac,r.iv=a,r.mac=s,u.label=2;case 2:return[3,4];case 3:throw new Error("Unknown key algorithm ".concat(e));case 4:if(n)return[3,8];u.label=5;case 5:n=(0,p.randomString)(32),u.label=6;case 6:return[4,i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(n))];case 7:if(u.sent())return[3,5];u.label=8;case 8:return[4,i.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(n),r)];case 9:return u.sent(),[2,{keyId:n,keyInfo:r}]}}))}))()}},{key:"getKey",value:function(e){var t=this;return(0,r.default)((function(){var r;return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return e?[3,2]:[4,t.getDefaultKeyId()];case 1:e=n.sent(),n.label=2;case 2:return e?[4,t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e)]:[2,null];case 3:return[2,(r=n.sent())?[e,r]:null]}}))}))()}},{key:"hasKey",value:function(e){var t=this;return(0,r.default)((function(){return(0,u.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getKey(e)];case 1:return[2,Boolean.apply(void 0,[r.sent()])]}}))}))()}},{key:"checkKey",value:function(e,t){return(0,r.default)((function(){var r;return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return t.algorithm!==_?[3,4]:t.mac?[4,(0,v.calculateKeyCheck)(e,t.iv)]:[3,2];case 1:return r=n.sent().mac,[2,t.mac.replace(/=+$/g,"")===r.replace(/=+$/g,"")];case 2:return[2,!0];case 3:return[3,5];case 4:throw new Error("Unknown algorithm");case 5:return[2]}}))}))()}},{key:"store",value:function(e,t,n){var i=this;return(0,r.default)((function(){var r,o,l,c,d,h,p,v,g,m,y,b;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return r={},n?[3,2]:[4,i.getDefaultKeyId()];case 1:if(!(o=u.sent()))throw new Error("No keys specified and no default key present");n=[o],u.label=2;case 2:if(0===n.length)throw new Error("Zero keys given to encrypt with!");l=!0,c=!1,d=void 0,u.label=3;case 3:u.trys.push([3,11,12,13]),h=n[Symbol.iterator](),u.label=4;case 4:return(l=(p=h.next()).done)?[3,10]:(v=p.value,[4,i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+v)]);case 5:if(!(g=u.sent()))throw new Error("Unknown key: "+v);return g.algorithm!==_?[3,8]:(m=(0,a.default)({},v,g),[4,i.getSecretStorageKey(m,e)]);case 6:return y=s.default.apply(void 0,[u.sent(),2]),[4,y[1].encrypt(t)];case 7:return r[v]=u.sent(),[3,9];case 8:f.logger.warn("unknown algorithm for secret storage key "+v+": "+g.algorithm),u.label=9;case 9:return l=!0,[3,4];case 10:return[3,13];case 11:return b=u.sent(),c=!0,d=b,[3,13];case 12:try{l||null==h.return||h.return()}finally{if(c)throw d}return[7];case 13:return[4,i.accountDataAdapter.setAccountData(e,{encrypted:r})];case 14:return u.sent(),[2]}}))}))()}},{key:"get",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,a,l,c,d,f,h,p,v,g,m,y;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return[4,t.accountDataAdapter.getAccountDataFromServer(e)];case 1:if(!(r=u.sent()))return[2];if(!r.encrypted)throw new Error("Content is not encrypted!");n={},i=!0,o=!1,a=void 0,u.label=2;case 2:u.trys.push([2,7,8,9]),l=Object.keys(r.encrypted)[Symbol.iterator](),u.label=3;case 3:return(i=(c=l.next()).done)?[3,6]:(d=c.value,[4,t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+d)]);case 4:f=u.sent(),h=r.encrypted[d],f.algorithm===_&&h.iv&&h.ciphertext&&h.mac&&(n[d]=f),u.label=5;case 5:return i=!0,[3,3];case 6:return[3,9];case 7:return p=u.sent(),o=!0,a=p,[3,9];case 8:try{i||null==l.return||l.return()}finally{if(o)throw a}return[7];case 9:if(0===Object.keys(n).length)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");return[4,t.getSecretStorageKey(n,e)];case 10:return v=s.default.apply(void 0,[u.sent(),2]),g=v[0],m=v[1],y=r.encrypted[g],[2,m.decrypt(y)]}}))}))()}},{key:"isStored",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,a,s,l,c,d,f,h;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return[4,t.accountDataAdapter.getAccountDataFromServer(e)];case 1:if(null==(r=u.sent())||!r.encrypted)return[2,null];n={},i=!0,o=!1,a=void 0,u.label=2;case 2:u.trys.push([2,7,8,9]),s=Object.keys(r.encrypted)[Symbol.iterator](),u.label=3;case 3:return(i=(l=s.next()).done)?[3,6]:(c=l.value,[4,t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+c)]);case 4:if(!(d=u.sent()))return[3,5];f=r.encrypted[c],d.algorithm===_&&f.iv&&f.ciphertext&&f.mac&&(n[c]=d),u.label=5;case 5:return i=!0,[3,3];case 6:return[3,9];case 7:return h=u.sent(),o=!0,a=h,[3,9];case 8:try{i||null==s.return||s.return()}finally{if(o)throw a}return[7];case 9:return[2,Object.keys(n).length?n:null]}}))}))()}},{key:"request",value:function(e,t){var r=this,n=this.baseApis.makeTxnId(),i=(0,m.defer)();this.requests.set(n,{name:e,devices:t,deferred:i});var o=(0,a.default)({name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:n},y.ToDeviceMessageId,(0,d.default)()),s={},u=!0,l=!1,c=void 0;try{for(var h,p=t[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){s[h.value]=o}}catch(e){l=!0,c=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}return f.logger.info("Request secret ".concat(e," from ").concat(t,", id ").concat(n)),this.baseApis.sendToDevice("m.secret.request",(0,a.default)({},this.baseApis.getUserId(),s)),{requestId:n,promise:i.promise,cancel:function(e){var o={action:"request_cancellation",requesting_device_id:r.baseApis.deviceId,request_id:n},s={},u=!0,l=!1,c=void 0;try{for(var d,f=t[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){s[d.value]=o}}catch(e){l=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}r.baseApis.sendToDevice("m.secret.request",(0,a.default)({},r.baseApis.getUserId(),s)),i.reject(new Error(e||"Cancelled"))}}}},{key:"onRequestReceived",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,l,c;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return r=e.getSender(),n=e.getContent(),r===t.baseApis.getUserId()&&n.name&&n.action&&n.requesting_device_id&&n.request_id?(i=n.requesting_device_id,"request_cancellation"!==n.action?[3,1]:[3,6]):[2];case 1:return"request"!==n.action?[3,6]:i===t.baseApis.deviceId?[2]:(f.logger.info("received request for secret ("+r+", "+i+", "+n.request_id+")"),t.cryptoCallbacks.onSecretRequested?[4,t.cryptoCallbacks.onSecretRequested(r,i,n.request_id,n.name,t.baseApis.checkDeviceTrust(r,i))]:[2]);case 2:return(o=u.sent())?(f.logger.info("Preparing ".concat(n.name," secret for ").concat(i)),s={type:"m.secret.send",content:{request_id:n.request_id,secret:o}},l=(0,a.default)({algorithm:h.OLM_ALGORITHM,sender_key:t.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{}},y.ToDeviceMessageId,(0,d.default)()),[4,h.ensureOlmSessionsForDevices(t.baseApis.crypto.olmDevice,t.baseApis,(0,a.default)({},r,[t.baseApis.getStoredDevice(r,i)]))]):[3,5];case 3:return u.sent(),[4,h.encryptMessageForDevice(l.ciphertext,t.baseApis.getUserId(),t.baseApis.deviceId,t.baseApis.crypto.olmDevice,r,t.baseApis.getStoredDevice(r,i),s)];case 4:return u.sent(),c=(0,a.default)({},r,(0,a.default)({},i,l)),f.logger.info("Sending ".concat(n.name," secret for ").concat(i)),t.baseApis.sendToDevice("m.room.encrypted",c),[3,6];case 5:f.logger.info("Request denied for ".concat(n.name," secret for ").concat(i)),u.label=6;case 6:return[2]}}))}))()}},{key:"onSecretReceived",value:function(e){if(e.getSender()===this.baseApis.getUserId())if(h.isOlmEncrypted(e)){var t=e.getContent();if(this.baseApis.crypto.deviceList.getUserByIdentityKey(h.OLM_ALGORITHM,e.getSenderKey()||"")===e.getSender()){f.logger.log("got secret share for request",t.request_id);var r=this.requests.get(t.request_id);if(r){var n=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(h.OLM_ALGORITHM,e.getSenderKey());if(!n)return void f.logger.log("secret share from unknown device with key",e.getSenderKey());if(!r.devices.includes(n.deviceId))return void f.logger.log("unsolicited secret share from device",n.deviceId);if(!this.baseApis.crypto.checkDeviceInfoTrust(e.getSender(),n).isVerified())return void f.logger.log("secret share from unverified device");f.logger.log("Successfully received secret ".concat(r.name," ")+"from ".concat(n.deviceId)),r.deferred.resolve(t.secret)}}else f.logger.error("sending device does not belong to the user it claims to be from")}else f.logger.error("secret event not properly encrypted")}},{key:"getSecretStorageKey",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i,o,a;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(!n.cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");return[4,n.cryptoCallbacks.getSecretStorageKey({keys:e},t)];case 1:if(!(r=u.sent()))throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");if(i=(0,s.default)(r,2),o=i[0],a=i[1],!e[o])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[o].algorithm===_)return[2,[o,{encrypt:function(e){return(0,v.encryptAES)(e,a,t)},decrypt:function(e){return(0,v.decryptAES)(e,a,t)}}]];throw new Error("Unknown key type: "+e[o].algorithm)}}))}))()}}]),e}();e.exports.SecretStorage=w})),n.register("dhSCK",(function(e,t){var i=n("Yawv5"),o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("cksMj"),l=n("9oGi2"),c=n("giCK6"),d=n("eQNFO"),f=n("1irm0").Buffer,h=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SHOW_QR_CODE_METHOD=e.exports.SCAN_QR_CODE_METHOD=e.exports.ReciprocateQRCode=e.exports.QrCodeEvent=e.exports.QRCodeData=void 0;var p=h(n("3rHpI")),v=n("7MMBX"),g=n("27k5n"),m=n("dbGKv"),y=n("jtqeE");e.exports.SHOW_QR_CODE_METHOD="m.qr_code.show.v1";var b;e.exports.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1",e.exports.QrCodeEvent=b,(b||(e.exports.QrCodeEvent=b={})).ShowReciprocateQr="show_reciprocate_qr";var _=function(e){"use strict";(0,u.default)(r,e);var t=(0,c.default)(r);function r(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];var u;(0,a.default)(this,r),u=t.call.apply(t,[this].concat((0,l.default)(n))),(0,p.default)((0,i.default)(u),"reciprocateQREvent",void 0);var c=(0,i.default)(u);return(0,p.default)((0,i.default)(u),"doVerification",(0,o.default)((function(){var e,t,r,n,i;return(0,d.__generator)(this,(function(o){switch(o.label){case 0:if(!c.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");if(e=c.request.qrCodeData,c.startEvent.getContent().secret!==(null==e?void 0:e.encodedSharedSecret))throw(0,g.newKeyMismatchError)();return[4,new Promise((function(e,t){c.reciprocateQREvent={confirm:e,cancel:function(){return t((0,g.newUserCancelledError)())}},c.emit(b.ShowReciprocateQr,c.reciprocateQREvent)}))];case 1:switch(o.sent(),t={},null==e?void 0:e.mode){case w.VerifyOtherUser:r=e.otherUserMasterKey,t["ed25519:".concat(r)]=r;break;case w.VerifySelfTrusted:n=c.request.targetDevice.deviceId,t["ed25519:".concat(n)]=e.otherDeviceKey;break;case w.VerifySelfUntrusted:i=e.myMasterKey,t["ed25519:".concat(i)]=i}return[4,c.verifyKeys(c.userId,t,(function(e,r,n){var i=t[e];if(!i)throw(0,g.newKeyMismatchError)();if(n!==i)throw y.logger.error("key ID from key info does not match"),(0,g.newKeyMismatchError)();for(var o in r.keys)if(o.startsWith("ed25519")){var a=t[o];if(!a)throw(0,g.newKeyMismatchError)();if(r.keys[o]!==a)throw y.logger.error("master key does not match"),(0,g.newKeyMismatchError)()}}))];case 2:return o.sent(),[2]}}))}))),u}return(0,s.default)(r,null,[{key:"factory",value:function(e,t,n,i,o,a){return new r(e,t,n,i,o,a)}},{key:"NAME",get:function(){return"m.reciprocate.v1"}}]),r}(v.VerificationBase);e.exports.ReciprocateQRCode=_;var w,S;(S=w||(w={}))[S.VerifyOtherUser=0]="VerifyOtherUser",S[S.VerifySelfTrusted=1]="VerifySelfTrusted",S[S.VerifySelfUntrusted=2]="VerifySelfUntrusted";var E=function(){"use strict";function e(t,r,n,i,o,s){(0,a.default)(this,e),this.mode=t,this.sharedSecret=r,this.otherUserMasterKey=n,this.otherDeviceKey=i,this.myMasterKey=o,this.buffer=s}return(0,s.default)(e,[{key:"encodedSharedSecret",get:function(){return this.sharedSecret}},{key:"getBuffer",value:function(){return this.buffer}}],[{key:"create",value:function(t,r){return(0,o.default)((function(){var n,i,o,a,s,u,l,c,f,h;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:return n=e.generateSharedSecret(),i=e.determineMode(t,r),o=null,a=null,s=null,i!==w.VerifyOtherUser?[3,1]:(u=r.getStoredCrossSigningForUser(t.otherUserId),o=u.getId("master"),[3,4]);case 1:return i!==w.VerifySelfTrusted?[3,3]:[4,e.getOtherDeviceKey(t,r)];case 2:return a=d.sent(),[3,4];case 3:i===w.VerifySelfUntrusted&&(l=r.getUserId(),c=r.getStoredCrossSigningForUser(l),s=c.getId("master")),d.label=4;case 4:return f=e.generateQrData(t,r,i,n,o,a,s),h=e.generateBuffer(f),[2,new e(i,n,o,a,s,h)]}}))}))()}},{key:"generateSharedSecret",value:function(){var e=new Uint8Array(11);return r.crypto.getRandomValues(e),(0,m.encodeUnpaddedBase64)(e)}},{key:"getOtherDeviceKey",value:function(e,t){return(0,o.default)((function(){var r,n,i;return(0,d.__generator)(this,(function(o){if(r=t.getUserId(),n=e.targetDevice,!(i=n.deviceId?t.getStoredDevice(r,n.deviceId):void 0))throw new Error("could not find device "+(null==n?void 0:n.deviceId));return[2,i.getFingerprint()]}))}))()}},{key:"determineMode",value:function(e,t){var r=t.getUserId(),n=e.otherUserId,i=w.VerifyOtherUser;r===n&&(i=t.checkUserTrust(r).isCrossSigningVerified()?w.VerifySelfTrusted:w.VerifySelfUntrusted);return i}},{key:"generateQrData",value:function(e,t,r,n,i,o,a){var s=t.getUserId(),u={prefix:"MATRIX",version:2,mode:r,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:n},l=t.getStoredCrossSigningForUser(s);return r===w.VerifyOtherUser?(u.firstKeyB64=l.getId("master"),u.secondKeyB64=i):r===w.VerifySelfTrusted?(u.firstKeyB64=l.getId("master"),u.secondKeyB64=o):r===w.VerifySelfUntrusted&&(u.firstKeyB64=t.getDeviceEd25519Key(),u.secondKeyB64=a),u}},{key:"generateBuffer",value:function(e){var t=f.alloc(0),r=function(e){var r=f.from([e]);t=f.concat([t,r])},n=function(e){var r=f.alloc(2);r.writeInt16BE(e,0),t=f.concat([t,r])},i=function(e,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=f.from(e,r);i&&n(o.byteLength),t=f.concat([t,o])},o=function(e){var r=(0,m.decodeBase64)(e),n=f.from(r);t=f.concat([t,n])};return i(e.prefix,"ascii",!1),r(e.version),r(e.mode),i(e.transactionId,"utf-8"),o(e.firstKeyB64),o(e.secondKeyB64),o(e.secretB64),t}}]),e}();e.exports.QRCodeData=E})),n.register("7MMBX",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("cksMj"),l=n("mBz5n"),c=n("9oGi2"),d=n("hcUaE"),f=n("giCK6"),h=n("eQNFO"),p=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VerificationEvent=e.exports.VerificationBase=e.exports.SwitchStartEventError=void 0;var v,g=p(n("3rHpI")),m=n("jEuTn"),y=n("8bPbt"),b=n("jtqeE"),_=n("1fjoF"),w=n("27k5n"),S=n("f1UAv"),E=n("6MMVS"),k=new Error("Verification timed out"),M=function(e){(0,u.default)(r,e);var t=(0,f.default)(r);function r(e){var n;return(0,o.default)(this,r),(n=t.call(this)).startEvent=e,n}return r}((0,d.default)(Error));e.exports.SwitchStartEventError=M,e.exports.VerificationEvent=v,(v||(e.exports.VerificationEvent=v={})).Cancel="cancel";var C=function(e){(0,u.default)(n,e);var t=(0,f.default)(n);function n(e,i,a,s,u,l){var c;return(0,o.default)(this,n),(c=t.call(this)).channel=e,c.baseApis=i,c.userId=a,c.deviceId=s,c.startEvent=u,c.request=l,(0,g.default)((0,r.default)(c),"cancelled",!1),(0,g.default)((0,r.default)(c),"_done",!1),(0,g.default)((0,r.default)(c),"promise",null),(0,g.default)((0,r.default)(c),"transactionTimeoutTimer",null),(0,g.default)((0,r.default)(c),"expectedEvent",void 0),(0,g.default)((0,r.default)(c),"resolve",void 0),(0,g.default)((0,r.default)(c),"reject",void 0),(0,g.default)((0,r.default)(c),"resolveEvent",void 0),(0,g.default)((0,r.default)(c),"rejectEvent",void 0),(0,g.default)((0,r.default)(c),"started",void 0),(0,g.default)((0,r.default)(c),"doVerification",void 0),c}return(0,a.default)(n,[{key:"initiatedByMe",get:function(){if(!this.startEvent)return!0;var e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this.baseApis.getUserId()&&t.from_device===this.baseApis.getDeviceId()}},{key:"hasBeenCancelled",get:function(){return this.cancelled}},{key:"resetTimer",value:function(){var e=this;b.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout((function(){e._done||e.cancelled||(b.logger.info("Triggering verification timeout"),e.cancel(k))}),6e5)}},{key:"endTimer",value:function(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}},{key:"send",value:function(e,t){return this.channel.send(e,t)}},{key:"waitForEvent",value:function(e){var t=this;if(this._done)return Promise.reject(new Error("Verification is already done"));var r=this.request.getEventFromOtherParty(e);return r?Promise.resolve(r):(this.expectedEvent=e,new Promise((function(e,r){t.resolveEvent=e,t.rejectEvent=r})))}},{key:"canSwitchStartEvent",value:function(e){return!1}},{key:"switchStartEvent",value:function(e){if(this.canSwitchStartEvent(e))if(b.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){var t=this.rejectEvent;this.rejectEvent=void 0,t(new M(e))}else this.startEvent=e}},{key:"handleEvent",value:function(e){var t;if(!this._done)if(e.getType()===this.expectedEvent)this.expectedEvent!==y.EventType.KeyVerificationDone&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),null===(t=this.resolveEvent)||void 0===t||t.call(this,e));else if(e.getType()===y.EventType.KeyVerificationCancel){var r=this.reject;if(this.reject=void 0,r){var n=e.getContent(),i=n.reason,o=n.code;r(new Error("Other side cancelled verification "+"because ".concat(i," (").concat(o,")")))}}else if(this.expectedEvent){var a=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){var s=this.rejectEvent;this.rejectEvent=void 0,s(a)}this.cancel(a)}}},{key:"done",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,h.__generator)(this,(function(r){return e.endTimer(),e._done?[2]:(e.request.onVerifierFinished(),null===(t=e.resolve)||void 0===t||t.call(e),[2,(0,S.requestKeysDuringVerification)(e.baseApis,e.userId,e.deviceId)])}))}))()}},{key:"cancel",value:function(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===k){var t=(0,w.newTimeoutError)();this.send(t.getType(),t.getContent())}else if(e instanceof m.MatrixEvent){if(e.getSender()!==this.userId){var r=e.getContent();e.getType()===y.EventType.KeyVerificationCancel?(r.code=r.code||"m.unknown",r.reason=r.reason||r.body||"Unknown reason",this.send(y.EventType.KeyVerificationCancel,r)):this.send(y.EventType.KeyVerificationCancel,{code:"m.unknown",reason:r.body||"Unknown reason"})}}else this.send(y.EventType.KeyVerificationCancel,{code:"m.unknown",reason:e.toString()});null!==this.promise?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit(v.Cancel,e)}}},{key:"verify",value:function(){var e=this;return this.promise||(this.promise=new Promise((function(t,r){e.resolve=function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e._done=!0,e.endTimer(),t.apply(void 0,(0,c.default)(n))},e.reject=function(t){e._done=!0,e.endTimer(),r(t)}})),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),new Promise((function(t,r){var n;(null===(n=e.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e.userId))||void 0===n?void 0:n.getId())===e.deviceId&&r(new Error("Device ID is the same as the cross-signing ID")),t()})).then((function(){return e.doVerification()})).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}},{key:"verifyKeys",value:function(e,t,r){var n=this;return(0,i.default)((function(){var i,o,a,u,c,d,f,p,v,g,m,y,w,S,E,k,M,C,I,T,R,x;return(0,h.__generator)(this,(function(h){switch(h.label){case 0:i=[],o=!0,a=!1,u=void 0;try{for(c=Object.entries(t)[Symbol.iterator]();!(o=(d=c.next()).done);o=!0)f=(0,l.default)(d.value,2),p=f[0],v=f[1],g=p.split(":",2)[1],(m=n.baseApis.getStoredDevice(e,g))?(r(p,m,v),i.push([g,p,m.keys[p]])):(y=n.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e))&&y.getId()===g?(r(p,_.DeviceInfo.fromStorage({keys:(0,s.default)({},p,g)},g),v),i.push([g,p,g])):b.logger.warn("verification: Could not find device ".concat(g," to verify"))}catch(e){a=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw u}}if(!i.length)throw new Error("No devices could be verified");b.logger.info("Verification completed! Marking devices verified: ",i),w=!0,S=!1,E=void 0,h.label=1;case 1:h.trys.push([1,6,7,8]),k=i[Symbol.iterator](),h.label=2;case 2:return(w=(M=k.next()).done)?[3,5]:(C=(0,l.default)(M.value,3),I=C[0],T=C[1],R=C[2],[4,n.baseApis.crypto.setDeviceVerification(e,I,!0,null,null,(0,s.default)({},T,R))]);case 3:h.sent(),h.label=4;case 4:return w=!0,[3,2];case 5:return[3,8];case 6:return x=h.sent(),S=!0,E=x,[3,8];case 7:try{w||null==k.return||k.return()}finally{if(S)throw E}return[7];case 8:return e!=n.baseApis.credentials.userId?[3,10]:[4,n.baseApis.checkKeyBackup()];case 9:h.sent(),h.label=10;case 10:return[2]}}))}))()}},{key:"events",get:function(){}}]),n}(E.TypedEventEmitter);e.exports.VerificationBase=C})),n.register("27k5n",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.errorFactory=a,e.exports.errorFromEvent=function(e){var t=e.getContent();if(t){var r=t.code,n=t.reason;return{code:r,reason:n}}return{code:"Unknown error",reason:"m.unknown"}},e.exports.newUserCancelledError=e.exports.newUnknownMethodError=e.exports.newUnexpectedMessageError=e.exports.newTimeoutError=e.exports.newKeyMismatchError=e.exports.newInvalidMessageError=void 0,e.exports.newVerificationError=o;var r=n("jEuTn"),i=n("8bPbt");function o(e,t,n){var o=Object.assign({},{code:e,reason:t},n);return new r.MatrixEvent({type:i.EventType.KeyVerificationCancel,content:o})}function a(e,t){return function(r){return o(e,t,r)}}var s=a("m.user","Cancelled by user");e.exports.newUserCancelledError=s;var u=a("m.timeout","Timed out");e.exports.newTimeoutError=u;var l=a("m.unknown_method","Unknown method");e.exports.newUnknownMethodError=l;var c=a("m.unexpected_message","Unexpected message");e.exports.newUnexpectedMessageError=c;var d=a("m.key_mismatch","Key mismatch");e.exports.newKeyMismatchError=d;var f=a("m.invalid_message","Invalid message");e.exports.newInvalidMessageError=f})),n.register("1zJ3N",(function(e,t){var i=n("Yawv5"),o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("cksMj"),l=n("mBz5n"),c=n("9oGi2"),d=n("giCK6"),f=n("eQNFO"),h=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SasEvent=e.exports.SAS=void 0;var p,v=h(n("3rHpI")),g=h(n("7ZwSr")),m=n("7MMBX"),y=n("27k5n"),b=n("jtqeE"),_=n("v6yyZ"),w=n("8bPbt"),S=w.EventType.KeyVerificationStart,E=[w.EventType.KeyVerificationAccept,w.EventType.KeyVerificationKey,w.EventType.KeyVerificationMac],k=(0,y.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),M=(0,y.errorFactory)("m.mismatched_commitment","Mismatched commitment"),C=[["🐶","dog"],["🐱","cat"],["🦁","lion"],["🐎","horse"],["🦄","unicorn"],["🐷","pig"],["🐘","elephant"],["🐰","rabbit"],["🐼","panda"],["🐓","rooster"],["🐧","penguin"],["🐢","turtle"],["🐟","fish"],["🐙","octopus"],["🦋","butterfly"],["🌷","flower"],["🌳","tree"],["🌵","cactus"],["🍄","mushroom"],["🌏","globe"],["🌙","moon"],["☁️","cloud"],["🔥","fire"],["🍌","banana"],["🍎","apple"],["🍓","strawberry"],["🌽","corn"],["🍕","pizza"],["🎂","cake"],["❤️","heart"],["🙂","smiley"],["🤖","robot"],["🎩","hat"],["👓","glasses"],["🔧","spanner"],["🎅","santa"],["👍","thumbs up"],["☂️","umbrella"],["⌛","hourglass"],["⏰","clock"],["🎁","gift"],["💡","light bulb"],["📕","book"],["✏️","pencil"],["📎","paperclip"],["✂️","scissors"],["🔒","lock"],["🔑","key"],["🔨","hammer"],["☎️","telephone"],["🏁","flag"],["🚂","train"],["🚲","bicycle"],["✈️","aeroplane"],["🚀","rocket"],["🏆","trophy"],["⚽","ball"],["🎸","guitar"],["🎺","trumpet"],["🔔","bell"],["⚓️","anchor"],["🎧","headphones"],["📁","folder"],["📌","pin"]];var I={decimal:_.generateDecimalSas,emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((function(e){return C[e]}))}};function T(e,t){var r={},n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;u in I&&(r[u]=I[u](Array.from(e)))}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}var R={"hkdf-hmac-sha256":"calculate_mac","org.matrix.msc3783.hkdf-hmac-sha256":"calculate_mac_fixed_base64","hmac-sha256":"calculate_mac_long_kdf"};function x(e,t){return function(r,n){var i=e[R[t]](r,n);return b.logger.log("SAS calculateMAC:",t,[r,n],i),i}}var O,A={"curve25519-hkdf-sha256":function(e,t,r){var n="".concat(e.baseApis.getUserId(),"|").concat(e.baseApis.deviceId,"|")+"".concat(e.ourSASPubKey,"|"),i="".concat(e.userId,"|").concat(e.deviceId,"|").concat(e.theirSASPubKey,"|"),o="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?n+i:i+n)+e.channel.transactionId;return t.generate_bytes(o,r)},curve25519:function(e,t,r){var n="".concat(e.baseApis.getUserId()).concat(e.baseApis.deviceId),i="".concat(e.userId).concat(e.deviceId),o="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?n+i:i+n)+e.channel.transactionId;return t.generate_bytes(o,r)}},D=["curve25519-hkdf-sha256","curve25519"],P=["sha256"],L=["org.matrix.msc3783.hkdf-hmac-sha256","hkdf-hmac-sha256","hmac-sha256"],U=Object.keys(I),j=new Set(D),N=new Set(P),B=new Set(L),F=new Set(U);function K(e,t){return Array.isArray(e)?e.filter((function(e){return t.has(e)})):[]}e.exports.SasEvent=O,(O||(e.exports.SasEvent=O={})).ShowSas="show_sas";var q=function(e){(0,u.default)(n,e);var t=(0,d.default)(n);function n(){for(var e=arguments.length,s=new Array(e),u=0;u<e;u++)s[u]=arguments[u];var l;(0,a.default)(this,n),l=t.call.apply(t,[this].concat((0,c.default)(s))),(0,v.default)((0,i.default)(l),"waitingForAccept",void 0),(0,v.default)((0,i.default)(l),"ourSASPubKey",void 0),(0,v.default)((0,i.default)(l),"theirSASPubKey",void 0),(0,v.default)((0,i.default)(l),"sasEvent",void 0);var d=(0,i.default)(l);return(0,v.default)((0,i.default)(l),"doVerification",(0,o.default)((function(){var e,t;return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.Olm.init()];case 1:return n.sent(),p=p||new r.Olm.Utility,[4,d.baseApis.downloadKeys([d.userId])];case 2:n.sent(),e=!1,n.label=3;case 3:return n.trys.push([3,8,,9]),d.initiatedByMe?[4,d.doSendVerification()]:[3,5];case 4:return[2,n.sent()];case 5:return[4,d.doRespondVerification()];case 6:return[2,n.sent()];case 7:return[3,9];case 8:if(!((t=n.sent())instanceof m.SwitchStartEventError))throw t;return d.startEvent=t.startEvent,e=!0,[3,9];case 9:if(e)return[3,3];n.label=10;case 10:return[2]}}))}))),l}return(0,s.default)(n,[{key:"events",get:function(){return E}},{key:"canSwitchStartEvent",value:function(e){if(e.getType()!==S)return!1;var t=e.getContent();return(null==t?void 0:t.method)===n.NAME&&!!this.waitingForAccept}},{key:"sendStart",value:function(){var e=this;return(0,o.default)((function(){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return t=e.channel.completeContent(S,{method:n.NAME,from_device:e.baseApis.deviceId,key_agreement_protocols:D,hashes:P,message_authentication_codes:L,short_authentication_string:U}),[4,e.channel.sendCompleted(S,t)];case 1:return r.sent(),[2,t]}}))}))()}},{key:"verifyAndCheckMAC",value:function(e,t,r,n){var i=this;return(0,o.default)((function(){var a,s,u,c,d;return(0,f.__generator)(this,(function(h){switch(h.label){case 0:return a=A[e](i,r,6),s=new Promise((function(e,s){i.sasEvent={sas:T(a,t),confirm:(0,o.default)((function(){var t;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,i.sendMAC(r,n)];case 1:return o.sent(),e(),[3,3];case 2:return t=o.sent(),s(t),[3,3];case 3:return[2]}}))})),cancel:function(){return s((0,y.newUserCancelledError)())},mismatch:function(){return s(k())}},i.emit(O.ShowSas,i.sasEvent)})),[4,Promise.all([i.waitForEvent(w.EventType.KeyVerificationMac).then((function(e){return i.expectedEvent=w.EventType.KeyVerificationDone,e})),s])];case 1:return u=l.default.apply(void 0,[h.sent(),1]),c=u[0],d=c.getContent(),[4,i.checkMAC(r,d,n)];case 2:return h.sent(),[2]}}))}))()}},{key:"doSendVerification",value:function(){var e=this;return(0,o.default)((function(){var t,n,i,o,a,s,u,l,c;return(0,f.__generator)(this,(function(d){switch(d.label){case 0:return e.waitingForAccept=!0,e.startEvent?(t=e.channel.completedContentFromEvent(e.startEvent),[3,3]):[3,1];case 1:return[4,e.sendStart()];case 2:t=d.sent(),d.label=3;case 3:if(!e.initiatedByMe)throw new m.SwitchStartEventError(e.startEvent);d.label=4;case 4:return d.trys.push([4,,6,7]),[4,e.waitForEvent(w.EventType.KeyVerificationAccept)];case 5:return n=d.sent(),[3,7];case 6:return e.waitingForAccept=!1,[7];case 7:if(i=n.getContent(),o=K(i.short_authentication_string,F),!(j.has(i.key_agreement_protocol)&&N.has(i.hash)&&B.has(i.message_authentication_code)&&o.length))throw(0,y.newUnknownMethodError)();if("string"!=typeof i.commitment)throw(0,y.newInvalidMessageError)();a=i.key_agreement_protocol,s=i.message_authentication_code,u=i.commitment,l=new r.Olm.SAS,d.label=8;case 8:return d.trys.push([8,,12,13]),e.ourSASPubKey=l.get_pubkey(),[4,e.send(w.EventType.KeyVerificationKey,{key:e.ourSASPubKey})];case 9:return d.sent(),[4,e.waitForEvent(w.EventType.KeyVerificationKey)];case 10:if(n=d.sent(),i=n.getContent(),c=i.key+g.default.stringify(t),p.sha256(c)!==u)throw M();return e.theirSASPubKey=i.key,l.set_their_key(i.key),[4,e.verifyAndCheckMAC(a,o,l,s)];case 11:return d.sent(),[3,13];case 12:return l.free(),[7];case 13:return[2]}}))}))()}},{key:"doRespondVerification",value:function(){var e=this;return(0,o.default)((function(){var t,n,i,o,a,s,u,l;return(0,f.__generator)(this,(function(c){switch(c.label){case 0:if(t=e.channel.completedContentFromEvent(e.startEvent),n=K(D,new Set(t.key_agreement_protocols))[0],i=K(P,new Set(t.hashes))[0],o=K(L,new Set(t.message_authentication_codes))[0],a=K(t.short_authentication_string,F),void 0===n||void 0===i||void 0===o||!a.length)throw(0,y.newUnknownMethodError)();s=new r.Olm.SAS,c.label=1;case 1:return c.trys.push([1,,6,7]),u=s.get_pubkey()+g.default.stringify(t),[4,e.send(w.EventType.KeyVerificationAccept,{key_agreement_protocol:n,hash:i,message_authentication_code:o,short_authentication_string:a,commitment:p.sha256(u)})];case 2:return c.sent(),[4,e.waitForEvent(w.EventType.KeyVerificationKey)];case 3:return l=c.sent(),t=l.getContent(),e.theirSASPubKey=t.key,s.set_their_key(t.key),e.ourSASPubKey=s.get_pubkey(),[4,e.send(w.EventType.KeyVerificationKey,{key:e.ourSASPubKey})];case 4:return c.sent(),[4,e.verifyAndCheckMAC(n,a,s,o)];case 5:return c.sent(),[3,7];case 6:return s.free(),[7];case 7:return[2]}}))}))()}},{key:"sendMAC",value:function(e,t){var r={},n=[],i="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,o="ed25519:".concat(this.baseApis.deviceId);r[o]=x(e,t)(this.baseApis.getDeviceEd25519Key(),i+o),n.push(o);var a=this.baseApis.getCrossSigningId();if(a){var s="ed25519:".concat(a);r[s]=x(e,t)(a,i+s),n.push(s)}var u=x(e,t)(n.sort().join(","),i+"KEY_IDS");return this.send(w.EventType.KeyVerificationMac,{mac:r,keys:u})}},{key:"checkMAC",value:function(e,t,r){var n=this;return(0,o.default)((function(){var i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:if(i="MATRIX_KEY_VERIFICATION_MAC"+n.userId+n.deviceId+n.baseApis.getUserId()+n.baseApis.deviceId+n.channel.transactionId,t.keys!==x(e,r)(Object.keys(t.mac).sort().join(","),i+"KEY_IDS"))throw(0,y.newKeyMismatchError)();return[4,n.verifyKeys(n.userId,t.mac,(function(t,n,o){if(o!==x(e,r)(n.keys[t],i+t))throw(0,y.newKeyMismatchError)()}))];case 1:return o.sent(),[2]}}))}))()}}],[{key:"NAME",get:function(){return"m.sas.v1"}}]),n}(m.VerificationBase);e.exports.SAS=q})),n.register("v6yyZ",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.generateDecimalSas=function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]}})),n.register("i92LU",(function(e,t){var i=n("2swew"),o=n("eQNFO");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.deriveKey=d,e.exports.keyFromAuthData=function(e,t){if(!r.Olm)throw new Error("Olm is not available");if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return d(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits||l)},e.exports.keyFromPassphrase=function(e){return c.apply(this,arguments)};var a=n("94a5L"),s=n("5O19e"),u=5e5,l=256;function c(){return(c=(0,i.default)((function(e){var t;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:if(!r.Olm)throw new Error("Olm is not available");return t=(0,a.randomString)(32),[4,d(e,t,u,l)];case 1:return[2,{key:n.sent(),salt:t,iterations:u}]}}))}))).apply(this,arguments)}function d(e,t,r){return f.apply(this,arguments)}function f(){return f=(0,i.default)((function(e,t,r){var n,i,a,u=arguments;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(n=u.length>3&&void 0!==u[3]?u[3]:l,!s.subtleCrypto||!s.TextEncoder)throw new Error("Password-based backup is not available on this platform");return[4,s.subtleCrypto.importKey("raw",(new s.TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits"])];case 1:return i=o.sent(),[4,s.subtleCrypto.deriveBits({name:"PBKDF2",salt:(new s.TextEncoder).encode(t),iterations:r,hash:"SHA-512"},i,n)];case 2:return a=o.sent(),[2,new Uint8Array(a)]}}))})),f.apply(this,arguments)}})),n.register("gKhTH",(function(e,t){var i=n("1irm0").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.decodeRecoveryKey=function(e){var t=o.decode(e.replace(/ /g,"")),n=0,i=!0,a=!1,u=void 0;try{for(var l,c=t[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var d=l.value;n^=d}}catch(e){a=!0,u=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw u}}if(0!==n)throw new Error("Incorrect parity");for(var f=0;f<s.length;++f)if(t[f]!==s[f])throw new Error("Incorrect prefix");if(t.length!==s.length+r.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(s.length,s.length+r.Olm.PRIVATE_KEY_LENGTH))},e.exports.encodeRecoveryKey=function(e){var t,r=i.alloc(s.length+e.length+1);r.set(s,0),r.set(e,s.length);for(var n=0,a=0;a<r.length-1;++a)n^=r[a];r[r.length-1]=n;var u=o.encode(r);return null===(t=u.match(/.{1,4}/g))||void 0===t?void 0:t.join(" ")};var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("4YFRB"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}var s=[139,1]})),n.register("4YFRB",(function(e,t){var r=n("dYudH");e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")})),n.register("dYudH",(function(e,t){"use strict";e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var i=e.charAt(n),o=i.charCodeAt(0);if(255!==t[o])throw new TypeError(i+" is ambiguous");t[o]=n}var a=e.length,s=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function c(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var r=0,n=0,i=0;e[r]===s;)n++,r++;for(var o=(e.length-r)*u+1>>>0,l=new Uint8Array(o);e[r];){var c=t[e.charCodeAt(r)];if(255===c)return;for(var d=0,f=o-1;(0!==c||d<i)&&-1!==f;f--,d++)c+=a*l[f]>>>0,l[f]=c%256>>>0,c=c/256>>>0;if(0!==c)throw new Error("Non-zero carry");i=d,r++}for(var h=o-i;h!==o&&0===l[h];)h++;for(var p=new Uint8Array(n+(o-h)),v=n;h!==o;)p[v++]=l[h++];return p}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,o=t.length;i!==o&&0===t[i];)i++,r++;for(var u=(o-i)*l+1>>>0,c=new Uint8Array(u);i!==o;){for(var d=t[i],f=0,h=u-1;(0!==d||f<n)&&-1!==h;h--,f++)d+=256*c[h]>>>0,c[h]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");n=f,i++}for(var p=u-n;p!==u&&0===c[p];)p++;for(var v=s.repeat(r);p<u;++p)v+=e.charAt(c[p]);return v},decodeUnsafe:c,decode:function(e){var t=c(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}})),n.register("cRTHW",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("mBz5n"),l=n("9oGi2"),c=n("giCK6"),d=n("eQNFO"),f=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VerificationRequestEvent=e.exports.VerificationRequest=e.exports.START_TYPE=e.exports.REQUEST_TYPE=e.exports.READY_TYPE=e.exports.Phase=e.exports.PHASE_UNSENT=e.exports.PHASE_STARTED=e.exports.PHASE_REQUESTED=e.exports.PHASE_READY=e.exports.PHASE_DONE=e.exports.PHASE_CANCELLED=e.exports.EVENT_PREFIX=e.exports.DONE_TYPE=e.exports.CANCEL_TYPE=void 0;var h=f(n("3rHpI")),p=n("jtqeE"),v=n("27k5n"),g=n("dhSCK"),m=n("8bPbt"),y=n("6MMVS"),b="m.key.verification.";e.exports.EVENT_PREFIX=b;var _="m.key.verification.request";e.exports.REQUEST_TYPE=_;var w="m.key.verification.start";e.exports.START_TYPE=w;var S="m.key.verification.cancel";e.exports.CANCEL_TYPE=S;var E="m.key.verification.done";e.exports.DONE_TYPE=E;var k,M,C="m.key.verification.ready";e.exports.READY_TYPE=C,e.exports.Phase=k,(M=k||(e.exports.Phase=k={}))[M.Unsent=1]="Unsent",M[M.Requested=2]="Requested",M[M.Ready=3]="Ready",M[M.Started=4]="Started",M[M.Cancelled=5]="Cancelled",M[M.Done=6]="Done";var I=k.Unsent;e.exports.PHASE_UNSENT=I;var T=k.Requested;e.exports.PHASE_REQUESTED=T;var R=k.Ready;e.exports.PHASE_READY=R;var x=k.Started;e.exports.PHASE_STARTED=x;var O=k.Cancelled;e.exports.PHASE_CANCELLED=O;var A,D=k.Done;e.exports.PHASE_DONE=D,e.exports.VerificationRequestEvent=A,(A||(e.exports.VerificationRequestEvent=A={})).Change="change";var P=function(e){(0,s.default)(n,e);var t=(0,c.default)(n);function n(e,a,s){var u;(0,o.default)(this,n),(u=t.call(this)).channel=e,u.verificationMethods=a,u.client=s,(0,h.default)((0,r.default)(u),"eventsByUs",new Map),(0,h.default)((0,r.default)(u),"eventsByThem",new Map),(0,h.default)((0,r.default)(u),"_observeOnly",!1),(0,h.default)((0,r.default)(u),"timeoutTimer",null),(0,h.default)((0,r.default)(u),"_accepting",!1),(0,h.default)((0,r.default)(u),"_declining",!1),(0,h.default)((0,r.default)(u),"verifierHasFinished",!1),(0,h.default)((0,r.default)(u),"_cancelled",!1),(0,h.default)((0,r.default)(u),"_chosenMethod",null),(0,h.default)((0,r.default)(u),"_qrCodeData",null),(0,h.default)((0,r.default)(u),"requestReceivedAt",null),(0,h.default)((0,r.default)(u),"commonMethods",[]),(0,h.default)((0,r.default)(u),"_phase",void 0),(0,h.default)((0,r.default)(u),"_cancellingUserId",void 0),(0,h.default)((0,r.default)(u),"_verifier",void 0);var l=(0,r.default)(u);return(0,h.default)((0,r.default)(u),"cancelOnTimeout",(0,i.default)((function(){var e;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),l.initiatedByMe?[4,l.cancel({reason:"Other party didn't accept in time",code:"m.timeout"})]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,l.cancel({reason:"User didn't accept in time",code:"m.timeout"})];case 3:t.sent(),t.label=4;case 4:return[3,6];case 5:return e=t.sent(),p.logger.error("Error while cancelling verification request",e),[3,6];case 6:return[2]}}))}))),u.channel.request=(0,r.default)(u),u.setPhase(I,!1),u}return(0,a.default)(n,[{key:"invalid",get:function(){return this.phase===I}},{key:"requested",get:function(){return this.phase===T}},{key:"cancelled",get:function(){return this.phase===O}},{key:"ready",get:function(){return this.phase===R}},{key:"started",get:function(){return this.phase===x}},{key:"done",get:function(){return this.phase===D}},{key:"methods",get:function(){return this.commonMethods}},{key:"chosenMethod",get:function(){return this._chosenMethod}},{key:"calculateEventTimeout",value:function(e){var t=this.channel.getTimestamp(e)+6e5;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=T){var r=this.requestReceivedAt+12e4;t=Math.min(t,r)}return Math.max(0,t-Date.now())}},{key:"timeout",get:function(){var e=this.getEventByEither(_);return e?this.calculateEventTimeout(e):0}},{key:"requestEvent",get:function(){return this.getEventByEither(_)}},{key:"phase",get:function(){return this._phase}},{key:"verifier",get:function(){return this._verifier}},{key:"canAccept",get:function(){return this.phase<R&&!this._accepting&&!this._declining}},{key:"accepting",get:function(){return this._accepting}},{key:"declining",get:function(){return this._declining}},{key:"pending",get:function(){return!this.observeOnly&&this._phase!==D&&this._phase!==O}},{key:"qrCodeData",get:function(){return this._qrCodeData}},{key:"otherPartySupportsMethod",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&!this.ready&&!this.started)return!1;var r=this.eventsByThem.get(_)||this.eventsByThem.get(C);if(!r){if(this.started&&this.initiatedByMe){var n=this.eventsByUs.get(w),i=n&&n.getContent(),o=i&&i.method;return e==o}return!1}var a=r.getContent();if(!a)return!1;var s=a.methods;return!!Array.isArray(s)&&s.includes(e)}},{key:"initiatedByMe",get:function(){var e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===I&&e)return!0;var t=this.eventsByUs.has(_),r=this.eventsByThem.has(_);if(t&&!r)return!0;if(!t&&r)return!1;var n=this.eventsByUs.has(w),i=this.eventsByThem.has(w);return!(!n||i)}},{key:"requestingUserId",get:function(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}},{key:"receivingUserId",get:function(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}},{key:"otherUserId",get:function(){return this.channel.userId}},{key:"isSelfVerification",get:function(){return this.client.getUserId()===this.otherUserId}},{key:"cancellingUserId",get:function(){var e=this.eventsByUs.get(S),t=this.eventsByThem.get(S);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}},{key:"cancellationCode",get:function(){var e=this.getEventByEither(S);return e?e.getContent().code:null}},{key:"observeOnly",get:function(){return this._observeOnly}},{key:"targetDevice",get:function(){var e=this.eventsByThem.get(_)||this.eventsByThem.get(C)||this.eventsByThem.get(w),t=null==e?void 0:e.getContent(),r=null==t?void 0:t.from_device;return{userId:this.otherUserId,deviceId:r}}},{key:"beginKeyVerification",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.observeOnly&&!this._verifier){var r=this.phase===T||this.phase===R||this.phase===I&&this.channel.canCreateRequest(w);if(r){if(this.commonMethods.length&&!this.commonMethods.includes(e))throw(0,v.newUnknownMethodError)();if(this._verifier=this.createVerifier(e,null,t),!this._verifier)throw(0,v.newUnknownMethodError)();this._chosenMethod=e}}return this._verifier}},{key:"sendRequest",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return e.observeOnly||e._phase!==I?[3,2]:(t=(0,l.default)(e.verificationMethods.keys()),[4,e.channel.send(_,{methods:t})]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))()}},{key:"cancel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reason,r=void 0===t?"User declined":t,n=e.code,o=void 0===n?"m.user":n,a=this;return(0,i.default)((function(){return(0,d.__generator)(this,(function(e){switch(e.label){case 0:return a.observeOnly||a._phase===O?[3,3]:(a._declining=!0,a.emit(A.Change),a._verifier?[2,a._verifier.cancel((0,v.errorFactory)(o,r)())]:[3,1]);case 1:return a._cancellingUserId=a.client.getUserId(),[4,a.channel.send(S,{code:o,reason:r})];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))()}},{key:"accept",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return e.observeOnly||e.phase!==T||e.initiatedByMe?[3,2]:(t=(0,l.default)(e.verificationMethods.keys()),e._accepting=!0,e.emit(A.Change),[4,e.channel.send(C,{methods:t})]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))()}},{key:"waitFor",value:function(e){var t=this;return new Promise((function(r,n){var i=function(){var o=!1;return e(t)?(r(t),o=!0):t.cancelled&&(n(new Error("cancelled")),o=!0),o&&t.off(A.Change,i),o};i()||t.on(A.Change,i)}))}},{key:"setPhase",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._phase=e,t&&this.emit(A.Change)}},{key:"getEventByEither",value:function(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}},{key:"getEventBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?this.eventsByThem.get(e):this.eventsByUs.get(e)}},{key:"calculatePhaseTransitions",value:function(){var e=[{phase:I}],t=function(){return e[e.length-1].phase},r=this.eventsByThem.has(_),n=this.getEventBy(_,r);n&&e.push({phase:T,event:n});var i,o=n&&this.getEventBy(C,!r);if(o&&t()===T&&e.push({phase:R,event:o}),o||!n){var a=this.eventsByThem.get(w),s=this.eventsByUs.get(w);i=a&&s?a.getSender()<s.getSender()?a:s:a||s}else i=this.getEventBy(w,!r);if(i){var u=t()===T&&(null==n?void 0:n.getSender())!==i.getSender(),l=t()===I&&this.channel.canCreateRequest(w);(u||t()===R||l)&&e.push({phase:x,event:i})}var c=this.eventsByUs.get(E);(this.verifierHasFinished||c&&t()===x)&&e.push({phase:D});var d=this.getEventByEither(S);return(this._cancelled||d)&&t()!==D?(e.push({phase:O,event:d}),e):e}},{key:"transitionToPhase",value:function(e){var t=this,r=e.phase,n=e.event;if((r===T||r===R)&&!this.wasSentByOwnDevice(n)){var i=n.getContent();this.commonMethods=i.methods.filter((function(e){return t.verificationMethods.has(e)}))}if(this.observeOnly||r!==T&&r!==x&&r!==R||this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(n)&&!this.wasSentByOwnDevice(n)&&(this._observeOnly=!0),r===x){var o=n.getContent().method;this._verifier||this.observeOnly||(this._verifier=this.createVerifier(o,n),this._verifier?this._chosenMethod=o:this.cancel({code:"m.unknown_method",reason:"Unknown method: ".concat(o)}))}}},{key:"applyPhaseTransitions",value:function(){var e=this,t=this.calculatePhaseTransitions(),r=t.findIndex((function(t){return t.phase===e.phase})),n=t.slice(r+1),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this.transitionToPhase(l)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return n}},{key:"isWinningStartRace",value:function(e){if(e.getType()!==w)return!1;var t,r,n=this._verifier.startEvent;if(this.isSelfVerification)if(n){var i=n.getContent();t=i&&i.from_device}else t=this.client.getDeviceId();else t=n?n.getSender():this.client.getUserId();if(this.isSelfVerification){var o=e.getContent();r=o&&o.from_device}else r=e.getSender();return r<t}},{key:"hasEventId",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.eventsByUs.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){if(i.value.getId()===e)return!0}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}var a=!0,s=!1,u=void 0;try{for(var l,c=this.eventsByThem.values()[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){if(l.value.getId()===e)return!0}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}return!1}},{key:"handleEvent",value:function(e,t,r,n,o){var a=this;return(0,i.default)((function(){var i,s,u,l,c,f,h;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:return a.done||a.cancelled?[2]:(i=a._observeOnly,a.adjustObserveOnly(t,r),a.observeOnly||n?[3,2]:[4,a.cancelOnError(e,t)]);case 1:if(d.sent())return[2];d.label=2;case 2:if(o?a.eventsByUs.has(e):a.eventsByThem.has(e))return[2];s=a.phase,a.addEvent(e,t,o),u=a.applyPhaseTransitions(),d.label=3;case 3:return d.trys.push([3,,8,9]),a._verifier&&!a.observeOnly&&(l=a.isWinningStartRace(t),a._verifier.canSwitchStartEvent(t)&&l?a._verifier.switchStartEvent(t):n||(e===S||null!==(c=a._verifier.events)&&void 0!==c&&c.includes(e))&&a._verifier.handleEvent(t)),u.length?r&&u.some((function(e){return e.phase===R}))&&a.otherPartySupportsMethod(g.SCAN_QR_CODE_METHOD,!0)?[4,g.QRCodeData.create(a,a.client)]:[3,5]:[3,6];case 4:a._qrCodeData=d.sent(),d.label=5;case 5:return f=u[u.length-1],h=f.phase,a.setupTimeout(h),a.setPhase(h),[3,7];case 6:a._observeOnly!==i&&a.emit(A.Change),d.label=7;case 7:return[3,9];case 8:return p.logger.log("Verification request ".concat(a.channel.transactionId,": ")+"".concat(e," event with id:").concat(t.getId(),", ")+"content:".concat(JSON.stringify(t.getContent())," ")+"deviceId:".concat(a.channel.deviceId,", ")+"sender:".concat(t.getSender(),", isSentByUs:").concat(o,", ")+"isLiveEvent:".concat(r,", isRemoteEcho:").concat(n,", ")+"phase:".concat(s,"=>").concat(a.phase,", ")+"observeOnly:".concat(i,"=>").concat(a._observeOnly)),[7];case 9:return[2]}}))}))()}},{key:"setupTimeout",value:function(e){(!this.timeoutTimer&&!this.observeOnly&&e===T&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer)&&((e===x||e===R||e===D||e===O)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null))}},{key:"cancelOnError",value:function(e,t){var r=this;return(0,i.default)((function(){var n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return e!==w?[3,2]:(n=t.getContent().method,r.verificationMethods.has(n)?[3,2]:[4,r.cancel((0,v.errorFromEvent)((0,v.newUnknownMethodError)()))]);case 1:case 3:return s.sent(),[2,!0];case 2:return i=e===_&&r.phase!==I,o=e===C&&r.phase!==T&&r.phase!==x,r.phase===I||!i&&!o?[3,4]:(p.logger.warn("Cancelling, unexpected ".concat(e," verification ")+"event from ".concat(t.getSender())),a="Unexpected ".concat(e," event in phase ").concat(r.phase),[4,r.cancel((0,v.errorFromEvent)((0,v.newUnexpectedMessageError)({reason:a})))]);case 4:return[2,!1]}}))}))()}},{key:"adjustObserveOnly",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}},{key:"addEvent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r?this.eventsByUs.set(e,t):this.eventsByThem.set(e,t),e===_){var n=!0,i=!1,o=void 0;try{for(var a,s=this.eventsByThem.entries()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=(0,u.default)(a.value,2),c=l[0],d=l[1];d.getSender()!==this.otherUserId&&this.eventsByThem.delete(c)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}this.requestReceivedAt=Date.now()}}},{key:"createVerifier",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r||(r=this.targetDevice);var n=r.userId,i=r.deviceId,o=this.verificationMethods.get(e);if(o)return new o(this.channel,this.client,n,i,t,this);p.logger.warn("could not find verifier constructor for method",e)}},{key:"wasSentByOwnUser",value:function(e){return(null==e?void 0:e.getSender())===this.client.getUserId()}},{key:"wasSentByOwnDevice",value:function(e){if(!this.wasSentByOwnUser(e))return!1;var t=e.getContent();return!(!t||t.from_device!==this.client.getDeviceId())}},{key:"onVerifierCancelled",value:function(){this._cancelled=!0;var e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}},{key:"onVerifierFinished",value:function(){this.channel.send(m.EventType.KeyVerificationDone,{}),this.verifierHasFinished=!0;var e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}},{key:"getEventFromOtherParty",value:function(e){return this.eventsByThem.get(e)}}],[{key:"validateEvent",value:function(e,t,r){var n=t.getContent();return!(!e||!e.startsWith(b))&&(n?e!==_&&e!==C||Array.isArray(n.methods)?e!==_&&e!==C&&e!==w||"string"==typeof n.from_device&&0!==n.from_device.length||(p.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(p.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(p.logger.log("VerificationRequest: validateEvent: no content"),!1))}}]),n}(y.TypedEventEmitter);e.exports.VerificationRequest=P})),n.register("g3CPh",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InRoomRequests=e.exports.InRoomChannel=void 0;var u=s(n("3rHpI")),l=n("cRTHW"),c=n("jtqeE"),d=n("8bPbt").EventType.RoomMessage,f="m.reference",h=function(){function e(t,r,n){(0,i.default)(this,e),this.client=t,this.roomId=r,this.userId=n,(0,u.default)(this,"requestEventId",void 0)}return(0,o.default)(e,[{key:"receiveStartFromOtherDevices",get:function(){return!0}},{key:"transactionId",get:function(){return this.requestEventId}},{key:"getTimestamp",value:function(e){return e.getTs()}},{key:"canCreateRequest",value:function(t){return e.canCreateRequest(t)}},{key:"handleEvent",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this;return(0,r.default)((function(){var r,s,u,l,d,f;return(0,a.__generator)(this,(function(a){return n.hasEventId(t.getId())?[2]:(r=e.getEventType(t),t.getRoomId()!==o.roomId?[2]:(o.userId||(s=e.getOtherPartyUserId(t,o.client))&&(o.userId=s),u=o.client.getUserId(),l=t.getSender(),o.userId&&l!==u&&l!==o.userId?(c.logger.log("InRoomChannel: ignoring verification event from non-participating sender ".concat(l)),[2]):(o.requestEventId||(o.requestEventId=e.getTransactionId(t)),d=!!t.getUnsigned().transaction_id,f=t.getSender()===o.client.getUserId(),[2,n.handleEvent(r,t,i,d,f)])))}))}))()}},{key:"completedContentFromEvent",value:function(e){var t=Object.assign({},e.getContent());return t["m.relates_to"]=e.getRelation(),t}},{key:"completeContent",value:function(e,t){return t=Object.assign({},t),e!==l.REQUEST_TYPE&&e!==l.READY_TYPE&&e!==l.START_TYPE||(t.from_device=this.client.getDeviceId()),e===l.REQUEST_TYPE?t={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:l.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t["m.relates_to"]={rel_type:f,event_id:this.transactionId},t}},{key:"send",value:function(e,t){var r=this.completeContent(e,t);return this.sendCompleted(e,r)}},{key:"sendCompleted",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return r=e,e===l.REQUEST_TYPE&&(r=d),[4,n.client.sendEvent(n.roomId,r,t)];case 1:return i=o.sent(),e===l.REQUEST_TYPE&&(n.requestEventId=i.event_id),[2]}}))}))()}}],[{key:"getOtherPartyUserId",value:function(t,r){if(e.getEventType(t)===l.REQUEST_TYPE){var n=r.getUserId(),i=t.getSender(),o=t.getContent().to;return i===n?o:o===n?i:void 0}}},{key:"canCreateRequest",value:function(e){return e===l.REQUEST_TYPE}},{key:"getTransactionId",value:function(t){if(e.getEventType(t)===l.REQUEST_TYPE)return t.getId();var r=t.getRelation();return(null==r?void 0:r.rel_type)===f?r.event_id:void 0}},{key:"validateEvent",value:function(t,r){var n=e.getTransactionId(t);if("string"!=typeof n||0===n.length)return!1;var i=e.getEventType(t),o=t.getContent();if(i===l.REQUEST_TYPE){if(!o||"string"!=typeof o.to||!o.to.length)return c.logger.log("InRoomChannel: validateEvent: no valid to "+(o&&o.to)),!1;if(!e.getOtherPartyUserId(t,r))return c.logger.log("InRoomChannel: validateEvent: "+"not directed to or sent by me: ".concat(t.getSender())+", ".concat(o&&o.to)),!1}return l.VerificationRequest.validateEvent(i,t,r)}},{key:"getEventType",value:function(e){var t=e.getType();if(t===d){var r=e.getContent();if(r)if(r.msgtype===l.REQUEST_TYPE)return l.REQUEST_TYPE}return t&&t!==l.REQUEST_TYPE?t:""}}]),e}();e.exports.InRoomChannel=h;var p=function(){function e(){(0,i.default)(this,e),(0,u.default)(this,"requestsByRoomId",new Map)}return(0,o.default)(e,[{key:"getRequest",value:function(e){var t=e.getRoomId(),r=h.getTransactionId(e);return this.getRequestByTxnId(t,r)}},{key:"getRequestByChannel",value:function(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}},{key:"getRequestByTxnId",value:function(e,t){var r=this.requestsByRoomId.get(e);if(r)return r.get(t)}},{key:"setRequest",value:function(e,t){this.doSetRequest(e.getRoomId(),h.getTransactionId(e),t)}},{key:"setRequestByChannel",value:function(e,t){this.doSetRequest(e.roomId,e.transactionId,t)}},{key:"doSetRequest",value:function(e,t,r){var n=this.requestsByRoomId.get(e);n||(n=new Map,this.requestsByRoomId.set(e,n)),n.set(t,r)}},{key:"removeRequest",value:function(e){var t=e.getRoomId(),r=this.requestsByRoomId.get(t);r&&(r.delete(h.getTransactionId(e)),0===r.size&&this.requestsByRoomId.delete(t))}},{key:"findRequestInProgress",value:function(e){var t=this.requestsByRoomId.get(e),r=!0,n=!1,i=void 0;if(t)try{for(var o,a=t.values()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(s.pending)return s}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}}]),e}();e.exports.InRoomRequests=p})),n.register("g0WMg",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("eQNFO"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ToDeviceRequests=e.exports.ToDeviceChannel=void 0;var l=u(n("3rHpI")),c=n("94a5L"),d=n("jtqeE"),f=n("cRTHW"),h=n("27k5n"),p=n("jEuTn"),v=function(){function e(t,r,n,o,a){(0,i.default)(this,e),this.client=t,this.userId=r,this.devices=n,this.transactionId=o,this.deviceId=a,(0,l.default)(this,"request",void 0)}return(0,o.default)(e,[{key:"isToDevices",value:function(e){if(e.length===this.devices.length){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(!this.devices.includes(a))return!1}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return!0}return!1}},{key:"canCreateRequest",value:function(t){return e.canCreateRequest(t)}},{key:"getTimestamp",value:function(e){var t=e.getContent();return t&&t.timestamp}},{key:"handleEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this;return(0,r.default)((function(){var r,o,a,u,l,c,d,p;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return r=e.getType(),o=e.getContent(),r!==f.REQUEST_TYPE&&r!==f.READY_TYPE&&r!==f.START_TYPE||(i.transactionId||(i.transactionId=o.transaction_id),a=o.from_device,!i.deviceId&&i.devices.includes(a)&&(i.deviceId=a),i.deviceId&&i.deviceId===a)?(l=t.phase===f.PHASE_STARTED||t.phase===f.PHASE_READY,[4,t.handleEvent(e.getType(),e,n,!1,!1)]):(u=i.completeContent(f.CANCEL_TYPE,(0,h.errorFromEvent)((0,h.newUnexpectedMessageError)())),[2,i.sendToDevices(f.CANCEL_TYPE,u,[a])]);case 1:return s.sent(),c=t.phase===f.PHASE_STARTED||t.phase===f.PHASE_READY,(r===f.START_TYPE||r===f.READY_TYPE)&&!l&&c&&i.deviceId?(d=i.devices.filter((function(e){return e!==i.deviceId&&e!==i.client.getDeviceId()}))).length?(p=i.completeContent(f.CANCEL_TYPE,{code:"m.accepted",reason:"Verification request accepted by another device"}),[4,i.sendToDevices(f.CANCEL_TYPE,p,d)]):[3,3]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))()}},{key:"completedContentFromEvent",value:function(e){return e.getContent()}},{key:"completeContent",value:function(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==f.REQUEST_TYPE&&e!==f.READY_TYPE&&e!==f.START_TYPE||(t.from_device=this.client.getDeviceId()),e===f.REQUEST_TYPE&&(t.timestamp=Date.now()),t}},{key:"send",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t!==f.REQUEST_TYPE&&t!==f.START_TYPE||this.transactionId||(this.transactionId=e.makeTransactionId());var n=this.completeContent(t,r);return this.sendCompleted(t,n)}},{key:"sendCompleted",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i;return(0,s.__generator)(this,(function(o){switch(o.label){case 0:return e===f.REQUEST_TYPE||e===f.CANCEL_TYPE&&!n.deviceId?[4,n.sendToDevices(e,t,n.devices)]:[3,2];case 1:return r=o.sent(),[3,4];case 2:return[4,n.sendToDevices(e,t,[n.deviceId])];case 3:r=o.sent(),o.label=4;case 4:return i=new p.MatrixEvent({sender:n.client.getUserId(),content:t,type:e}),[4,n.request.handleEvent(e,i,!0,!0,!0)];case 5:return o.sent(),[2,r]}}))}))()}},{key:"sendToDevices",value:function(e,t,n){var i=this;return(0,r.default)((function(){var r,o,u,l,c,d,f;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:if(!n.length)return[3,2];r={},o=!0,u=!1,l=void 0;try{for(c=n[Symbol.iterator]();!(o=(d=c.next()).done);o=!0)f=d.value,r[f]=t}catch(e){u=!0,l=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw l}}return[4,i.client.sendToDevice(e,(0,a.default)({},i.userId,r))];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))()}}],[{key:"getEventType",value:function(e){return e.getType()}},{key:"getTransactionId",value:function(e){var t=e.getContent();return t&&t.transaction_id}},{key:"canCreateRequest",value:function(e){return e===f.REQUEST_TYPE||e===f.START_TYPE}},{key:"validateEvent",value:function(e,t){if(e.isCancelled())return d.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;var r=e.getContent();if(!r)return d.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!r.transaction_id)return d.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;var n=e.getType();if(n===f.REQUEST_TYPE){if(!Number.isFinite(r.timestamp))return d.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&r.from_device==t.getDeviceId())return d.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return f.VerificationRequest.validateEvent(n,e,t)}},{key:"makeTransactionId",value:function(){return(0,c.randomString)(32)}}]),e}();e.exports.ToDeviceChannel=v;var g=function(){function e(){(0,i.default)(this,e),(0,l.default)(this,"requestsByUserId",new Map)}return(0,o.default)(e,[{key:"getRequest",value:function(e){return this.getRequestBySenderAndTxnId(e.getSender(),v.getTransactionId(e))}},{key:"getRequestByChannel",value:function(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}},{key:"getRequestBySenderAndTxnId",value:function(e,t){var r=this.requestsByUserId.get(e);if(r)return r.get(t)}},{key:"setRequest",value:function(e,t){this.setRequestBySenderAndTxnId(e.getSender(),v.getTransactionId(e),t)}},{key:"setRequestByChannel",value:function(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}},{key:"setRequestBySenderAndTxnId",value:function(e,t,r){var n=this.requestsByUserId.get(e);n||(n=new Map,this.requestsByUserId.set(e,n)),n.set(t,r)}},{key:"removeRequest",value:function(e){var t=e.getSender(),r=this.requestsByUserId.get(t);r&&(r.delete(v.getTransactionId(e)),0===r.size&&this.requestsByUserId.delete(t))}},{key:"findRequestInProgress",value:function(e,t){var r=this.requestsByUserId.get(e),n=!0,i=!1,o=void 0;if(r)try{for(var a,s=r.values()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(u.pending&&u.channel.isToDevices(t))return u}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}},{key:"getRequestsInProgress",value:function(e){var t=this.requestsByUserId.get(e);return t?Array.from(t.values()).filter((function(e){return e.pending})):[]}}]),e}();e.exports.ToDeviceRequests=g})),n.register("jOM7c",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("9oGi2"),l=n("giCK6"),c=n("eQNFO"),d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IllegalMethod=void 0;var f=d(n("3rHpI")),h=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];var l;return(0,o.default)(this,n),l=t.call.apply(t,[this].concat((0,u.default)(a))),(0,f.default)((0,r.default)(l),"doVerification",(0,i.default)((function(){return(0,c.__generator)(this,(function(e){throw new Error("Verification is not possible with this method")}))}))),l}return(0,a.default)(n,null,[{key:"factory",value:function(e,t,r,i,o,a){return new n(e,t,r,i,o,a)}},{key:"NAME",get:function(){return"org.matrix.illegal_method"}}]),n}(n("7MMBX").VerificationBase);e.exports.IllegalMethod=h})),n.register("8YZJm",(function(e,t){var i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("mBz5n"),l=n("eQNFO"),c=n("1irm0").Buffer,d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DehydrationManager=e.exports.DEHYDRATION_ALGORITHM=void 0;var f=d(n("3rHpI")),h=d(n("7ZwSr")),p=n("dbGKv"),v=n("8A6lK"),g=n("5zTlo"),m=n("jtqeE"),y=n("6BFg8"),b="org.matrix.msc2697.v1.olm.libolm_pickle";e.exports.DEHYDRATION_ALGORITHM=b;var _=6048e5,w=function(){"use strict";function e(t){(0,o.default)(this,e),this.crypto=t,(0,f.default)(this,"inProgress",!1),(0,f.default)(this,"timeoutId",void 0),(0,f.default)(this,"key",void 0),(0,f.default)(this,"keyInfo",void 0),(0,f.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}return(0,a.default)(e,[{key:"getDehydrationKeyFromCache",value:function(){var e=this;return this.crypto.cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){var n,o=e;e.crypto.cryptoStore.getSecretStorePrivateKey(t,(n=(0,i.default)((function(e){var t,n,i,a,s,u,d,f;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return e?(t=e.key,n=e.keyInfo,i=e.deviceDisplayName,a=e.time,s=c.from(o.crypto.olmDevice.pickleKey),[4,(0,g.decryptAES)(t,s,b)]):[3,2];case 1:u=l.sent(),o.key=(0,p.decodeBase64)(u),o.keyInfo=n,o.deviceDisplayName=i,d=Date.now(),f=Math.max(1,a+_-d),o.timeoutId=r.setTimeout(o.dehydrateDevice.bind(o),f),l.label=2;case 2:return[2]}}))})),function(e){return n.apply(this,arguments)}),"dehydration")}))}},{key:"setKeyAndQueueDehydration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,n.setKey(e,t,r)];case 1:return i.sent()||n.dehydrateDevice(),[2]}}))}))()}},{key:"setKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=this;return(0,i.default)((function(){var i,a;return(0,l.__generator)(this,(function(s){switch(s.label){case 0:return e?[3,2]:(o.timeoutId&&(r.clearTimeout(o.timeoutId),o.timeoutId=void 0),[4,o.crypto.cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(function(e){o.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)}))]);case 1:return s.sent(),o.key=void 0,o.keyInfo=void 0,[2];case 2:for(i=!!o.key&&e.length==o.key.length,a=0;i&&a<e.length;a++)e[a]!=o.key[a]&&(i=!1);return i||(o.key=e,o.keyInfo=t,o.deviceDisplayName=n),[2,i]}}))}))()}},{key:"dehydrateDevice",value:function(){var e=this;return(0,i.default)((function(){var t,n,i,o,a,d,f,w,S,E,k,M,C,I,T,R,x,O,A,D,P,L,U,j,N,B,F,K,q,W,V,H,G,z,Y,Z;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(e.inProgress)return m.logger.log("Dehydration already in progress -- not starting new dehydration"),[2];e.inProgress=!0,e.timeoutId&&(r.clearTimeout(e.timeoutId),e.timeoutId=void 0),l.label=1;case 1:return l.trys.push([1,,8,9]),t=c.from(e.crypto.olmDevice.pickleKey),[4,(0,g.encryptAES)((0,p.encodeBase64)(e.key),t,b)];case 2:return n=l.sent(),[4,e.crypto.cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(function(t){e.crypto.cryptoStore.storeSecretStorePrivateKey(t,"dehydration",{keyInfo:e.keyInfo,key:n,deviceDisplayName:e.deviceDisplayName,time:Date.now()})}))];case 3:return l.sent(),m.logger.log("Attempting to dehydrate device"),m.logger.log("Creating account"),(i=new r.Olm.Account).create(),o=JSON.parse(i.identity_keys()),a=i.max_number_of_one_time_keys(),i.generate_one_time_keys(a/2),i.generate_fallback_key(),d=JSON.parse(i.one_time_keys()),f=JSON.parse(i.fallback_key()),i.mark_keys_as_published(),w=i.pickle(new Uint8Array(e.key)),S={algorithm:b,account:w},e.keyInfo.passphrase&&(S.passphrase=e.keyInfo.passphrase),m.logger.log("Uploading account to server"),[4,e.crypto.baseApis.http.authedRequest(y.Method.Put,"/dehydrated_device",void 0,{device_data:S,initial_device_display_name:e.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})];case 4:return E=l.sent(),k=E.device_id,m.logger.log("Preparing device keys",k),C={algorithms:e.crypto.supportedAlgorithms,device_id:k,user_id:e.crypto.userId,keys:(M={},(0,s.default)(M,"ed25519:".concat(k),o.ed25519),(0,s.default)(M,"curve25519:".concat(k),o.curve25519),M)},I=i.sign(h.default.stringify(C)),C.signatures=(0,s.default)({},e.crypto.userId,(0,s.default)({},"ed25519:".concat(k),I)),e.crypto.crossSigningInfo.getId("self_signing")?[4,e.crypto.crossSigningInfo.signObject(C,"self_signing")]:[3,6];case 5:l.sent(),l.label=6;case 6:m.logger.log("Preparing one-time keys"),T={},R=!0,x=!1,O=void 0;try{for(A=Object.entries(d.curve25519)[Symbol.iterator]();!(R=(D=A.next()).done);R=!0)P=(0,u.default)(D.value,2),L=P[0],U=P[1],j={key:U},N=i.sign(h.default.stringify(j)),j.signatures=(0,s.default)({},e.crypto.userId,(0,s.default)({},"ed25519:".concat(k),N)),T["signed_curve25519:".concat(L)]=j}catch(e){x=!0,O=e}finally{try{R||null==A.return||A.return()}finally{if(x)throw O}}m.logger.log("Preparing fallback keys"),B={},F=!0,K=!1,q=void 0;try{for(W=Object.entries(f.curve25519)[Symbol.iterator]();!(F=(V=W.next()).done);F=!0)H=(0,u.default)(V.value,2),G=H[0],z=H[1],Y={key:z,fallback:!0},Z=i.sign(h.default.stringify(Y)),Y.signatures=(0,s.default)({},e.crypto.userId,(0,s.default)({},"ed25519:".concat(k),Z)),B["signed_curve25519:".concat(G)]=Y}catch(e){K=!0,q=e}finally{try{F||null==W.return||W.return()}finally{if(K)throw q}}return m.logger.log("Uploading keys to server"),[4,e.crypto.baseApis.http.authedRequest(y.Method.Post,"/keys/upload/"+encodeURI(k),void 0,{device_keys:C,one_time_keys:T,"org.matrix.msc2732.fallback_keys":B})];case 7:return l.sent(),m.logger.log("Done dehydrating"),e.timeoutId=r.setTimeout(e.dehydrateDevice.bind(e),_),[2,k];case 8:return e.inProgress=!1,[7];case 9:return[2]}}))}))()}},{key:"stop",value:function(){this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}]),e}();e.exports.DehydrationManager=w})),n.register("jioY8",(function(e,t){var i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("dLRop"),u=n("mBz5n"),l=n("eQNFO"),c=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.algorithmsByName=e.exports.DefaultAlgorithm=e.exports.Curve25519=e.exports.BackupManager=e.exports.Aes256=void 0;var d=c(n("3rHpI")),f=n("4uAg3"),h=n("jtqeE"),p=n("dbGKv"),v=n("i92LU"),g=n("e8gas"),m=n("8A6lK"),y=n("gKhTH"),b=n("5zTlo"),_=n("kLCn9"),w=n("9sA0w"),S=n("5O19e"),E=n("6BFg8"),k=function(){function e(t,r){(0,o.default)(this,e),this.baseApis=t,this.getKey=r,(0,d.default)(this,"algorithm",void 0),(0,d.default)(this,"backupInfo",void 0),(0,d.default)(this,"checkedForBackup",void 0),(0,d.default)(this,"sendingBackups",void 0),(0,d.default)(this,"sessionLastCheckAttemptedTime",{}),this.checkedForBackup=!1,this.sendingBackups=!1}return(0,a.default)(e,[{key:"version",get:function(){return this.backupInfo&&this.backupInfo.version}},{key:"enableKeyBackup",value:function(t){var r=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return r.backupInfo=t,r.algorithm&&r.algorithm.free(),[4,e.makeAlgorithm(t,r.getKey)];case 1:return r.algorithm=n.sent(),r.baseApis.emit(w.CryptoEvent.KeyBackupStatus,!0),r.scheduleKeyBackupSend(),[2]}}))}))()}},{key:"disableKeyBackup",value:function(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit(w.CryptoEvent.KeyBackupStatus,!1)}},{key:"getKeyBackupEnabled",value:function(){return this.checkedForBackup?Boolean(this.algorithm):null}},{key:"prepareKeyBackupVersion",value:function(e,t){return(0,i.default)((function(){var r,n,i,o,a;return(0,l.__generator)(this,(function(s){switch(s.label){case 0:if(!(r=t?R[t]:x))throw new Error("Unknown backup algorithm");return[4,r.prepare(e)];case 1:return n=u.default.apply(void 0,[s.sent(),2]),i=n[0],o=n[1],a=(0,y.encodeRecoveryKey)(i),[2,{algorithm:r.algorithmName,auth_data:o,recovery_key:a,privateKey:i}]}}))}))()}},{key:"createKeyBackupVersion",value:function(t){var r=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,e.makeAlgorithm(t,r.getKey)];case 1:return r.algorithm=n.sent(),[2]}}))}))()}},{key:"checkAndStart",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:if(h.logger.log("Checking key backup status..."),e.baseApis.isGuest())return h.logger.log("Skipping key backup check since user is guest"),e.checkedForBackup=!0,[2,null];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.baseApis.getKeyBackupVersion()];case 2:return t=null!==(r=o.sent())&&void 0!==r?r:void 0,[3,4];case 3:return n=o.sent(),h.logger.log("Error checking for active key backup",n),404===n.httpStatus&&(e.checkedForBackup=!0),[2,null];case 4:return e.checkedForBackup=!0,[4,e.isKeyBackupTrusted(t)];case 5:return!(i=o.sent()).usable||e.backupInfo?[3,7]:(h.logger.log("Found usable key backup v".concat(t.version,": enabling key backups")),[4,e.enableKeyBackup(t)]);case 6:return o.sent(),[3,13];case 7:return i.usable||!e.backupInfo?[3,8]:(h.logger.log("No usable key backup: disabling key backup"),e.disableKeyBackup(),[3,13]);case 8:return i.usable||e.backupInfo?[3,9]:(h.logger.log("No usable key backup: not enabling key backup"),[3,13]);case 9:return i.usable&&e.backupInfo?t.version===e.backupInfo.version?[3,12]:(h.logger.log("On backup version ".concat(e.backupInfo.version," but ")+"found version ".concat(t.version,": switching.")),e.disableKeyBackup(),[4,e.enableKeyBackup(t)]):[3,13];case 10:return o.sent(),[4,e.scheduleAllGroupSessionsForBackup()];case 11:return o.sent(),[3,13];case 12:h.logger.log("Backup version ".concat(t.version," still current")),o.label=13;case 13:return[2,{backupInfo:t,trustInfo:i}]}}))}))()}},{key:"checkKeyBackup",value:function(){var e=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(t){return e.checkedForBackup=!1,[2,e.checkAndStart()]}))}))()}},{key:"queryKeyBackupRateLimited",value:function(e,t){var r=this;return(0,i.default)((function(){var n;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return r.backupInfo?(n=(new Date).getTime(),!r.sessionLastCheckAttemptedTime[t]||n-r.sessionLastCheckAttemptedTime[t]>5e3?(r.sessionLastCheckAttemptedTime[t]=n,[4,r.baseApis.restoreKeyBackupWithCache(e,t,r.backupInfo,{})]):[3,2]):[2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))()}},{key:"isKeyBackupTrusted",value:function(t){var r=this;return(0,i.default)((function(){var n,o,a,s,u,c,d,f,v,g,m,y,b,_,w,S,E,k,M;return(0,l.__generator)(this,(function(C){switch(C.label){case 0:return n={usable:!1,trusted_locally:!1,sigs:[]},t&&t.algorithm&&t.auth_data&&t.auth_data.signatures?(o=r.baseApis.getUserId(),[4,r.baseApis.crypto.getSessionBackupPrivateKey()]):(h.logger.info("Key backup is absent or missing required data"),[2,n]);case 1:if(!(a=C.sent()))return[3,7];s=null,C.label=2;case 2:return C.trys.push([2,5,6,7]),[4,e.makeAlgorithm(t,(0,i.default)((function(){return(0,l.__generator)(this,(function(e){return[2,a]}))})))];case 3:return[4,(s=C.sent()).keyMatches(a)];case 4:return C.sent()&&(h.logger.info("Backup is trusted locally"),n.trusted_locally=!0),[3,7];case 5:return C.sent(),[3,7];case 6:return null===(u=s)||void 0===u||u.free(),[7];case 7:c=t.auth_data.signatures[o]||{},d=!0,f=!1,v=void 0,C.label=8;case 8:C.trys.push([8,23,24,25]),g=Object.keys(c)[Symbol.iterator](),C.label=9;case 9:if(d=(m=g.next()).done)return[3,22];if(y=m.value,"ed25519"!==(b=y.split(":"))[0])return h.logger.log("Ignoring unknown signature type: "+b[0]),[3,21];if(_={deviceId:b[1]},(w=r.baseApis.crypto.crossSigningInfo.getId())!==_.deviceId)return[3,14];_.crossSigningId=!0,C.label=10;case 10:return C.trys.push([10,12,,13]),[4,(0,p.verifySignature)(r.baseApis.crypto.olmDevice,t.auth_data,o,_.deviceId,w)];case 11:return C.sent(),_.valid=!0,[3,13];case 12:return S=C.sent(),h.logger.warn("Bad signature from cross signing key "+w,S),_.valid=!1,[3,13];case 13:return n.sigs.push(_),[3,21];case 14:if(!(E=r.baseApis.crypto.deviceList.getStoredDevice(o,_.deviceId)))return[3,19];_.device=E,_.deviceTrust=r.baseApis.checkDeviceTrust(o,_.deviceId),C.label=15;case 15:return C.trys.push([15,17,,18]),[4,(0,p.verifySignature)(r.baseApis.crypto.olmDevice,t.auth_data,o,E.deviceId,E.getFingerprint())];case 16:return C.sent(),_.valid=!0,[3,18];case 17:return k=C.sent(),h.logger.info("Bad signature from key ID "+y+" userID "+r.baseApis.getUserId()+" device ID "+E.deviceId+" fingerprint: "+E.getFingerprint(),t.auth_data,k),_.valid=!1,[3,18];case 18:return[3,20];case 19:_.valid=null,h.logger.info("Ignoring signature from unknown key "+y),C.label=20;case 20:n.sigs.push(_),C.label=21;case 21:return d=!0,[3,9];case 22:return[3,25];case 23:return M=C.sent(),f=!0,v=M,[3,25];case 24:try{d||null==g.return||g.return()}finally{if(f)throw v}return[7];case 25:return n.usable=n.sigs.some((function(e){var t;return e.valid&&(e.device&&(null===(t=e.deviceTrust)||void 0===t?void 0:t.isVerified())||e.crossSigningId)})),[2,n]}}))}))()}},{key:"scheduleKeyBackupSend",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=this;return(0,i.default)((function(){var r,n,i;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:if(t.sendingBackups)return[2];t.sendingBackups=!0,o.label=1;case 1:return o.trys.push([1,,13,14]),r=Math.random()*e,[4,(0,g.sleep)(r)];case 2:o.sent(),n=0,o.label=3;case 3:if(!t.algorithm)return[2];o.label=4;case 4:return o.trys.push([4,6,,9]),[4,t.backupPendingKeys(200)];case 5:return 0===o.sent()?[2]:(n=0,[3,9]);case 6:return i=o.sent(),n++,h.logger.log("Key backup request failed",i),i.data?"M_NOT_FOUND"!=i.data.errcode&&"M_WRONG_ROOM_KEYS_VERSION"!=i.data.errcode?[3,8]:[4,t.checkKeyBackup()]:[3,8];case 7:throw o.sent(),t.baseApis.crypto.emit(w.CryptoEvent.KeyBackupFailed,i.data.errcode),i;case 8:return[3,9];case 9:return n?[4,(0,g.sleep)(1e3*Math.pow(2,Math.min(n-1,4)))]:[3,11];case 10:o.sent(),o.label=11;case 11:return[3,3];case 12:return[3,14];case 13:return t.sendingBackups=!1,[7];case 14:return[2]}}))}))()}},{key:"backupPendingKeys",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,u,c,d,f,h,v,g,m,y,b,_,S,E,k;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return[4,t.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e)];case 1:return(r=l.sent()).length?[4,t.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()]:[2,0];case 2:n=l.sent(),t.baseApis.crypto.emit(w.CryptoEvent.KeyBackupSessionsRemaining,n),i={},o=!0,a=!1,s=void 0,l.label=3;case 3:l.trys.push([3,8,9,10]),u=r[Symbol.iterator](),l.label=4;case 4:return(o=(c=u.next()).done)?[3,7]:(d=c.value,h=d.sessionData.room_id,void 0===i[h]&&(i[h]={sessions:{}}),(v=t.baseApis.crypto.olmDevice.exportInboundGroupSession(d.senderKey,d.sessionId,d.sessionData)).algorithm=p.MEGOLM_ALGORITHM,g=(v.forwarding_curve25519_key_chain||[]).length,m=t.baseApis.crypto.deviceList.getUserByIdentityKey(p.MEGOLM_ALGORITHM,d.senderKey),y=null!==(f=t.baseApis.crypto.deviceList.getDeviceByIdentityKey(p.MEGOLM_ALGORITHM,d.senderKey))&&void 0!==f?f:void 0,b=t.baseApis.crypto.checkDeviceInfoTrust(m,y).isVerified(),_=i[h].sessions,S=d.sessionId,E={first_message_index:v.first_known_index,forwarded_count:g,is_verified:b},[4,t.algorithm.encryptSession(v)]);case 5:_[S]=(E.session_data=l.sent(),E),l.label=6;case 6:return o=!0,[3,4];case 7:return[3,10];case 8:return k=l.sent(),a=!0,s=k,[3,10];case 9:try{o||null==u.return||u.return()}finally{if(a)throw s}return[7];case 10:return[4,t.baseApis.sendKeyBackup(void 0,void 0,t.backupInfo.version,{rooms:i})];case 11:return l.sent(),[4,t.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(r)];case 12:return l.sent(),[4,t.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()];case 13:return n=l.sent(),t.baseApis.crypto.emit(w.CryptoEvent.KeyBackupSessionsRemaining,n),[2,r.length]}}))}))()}},{key:"backupGroupSession",value:function(e,t){var r=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}])];case 1:return n.sent(),r.backupInfo&&r.scheduleKeyBackupSend(),[2]}}))}))()}},{key:"scheduleAllGroupSessionsForBackup",value:function(){var e=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.flagAllGroupSessionsForBackup()];case 1:return t.sent(),e.scheduleKeyBackupSend(0),[2]}}))}))()}},{key:"flagAllGroupSessionsForBackup",value:function(){var e=this;return(0,i.default)((function(){var t;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.baseApis.crypto.cryptoStore.doTxn("readwrite",[m.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,m.IndexedDBCryptoStore.STORE_BACKUP],(function(t){e.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(t,(function(r){null!==r&&e.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([r],t)}))}))];case 1:return r.sent(),[4,e.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()];case 2:return t=r.sent(),e.baseApis.emit(w.CryptoEvent.KeyBackupSessionsRemaining,t),[2,t]}}))}))()}},{key:"countSessionsNeedingBackup",value:function(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}],[{key:"checkBackupVersion",value:function(e){var t=R[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!=typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}},{key:"makeAlgorithm",value:function(e,t){var r=R[e.algorithm];if(!r)throw new Error("Unknown backup algorithm");return r.init(e.auth_data,t)}}]),e}();e.exports.BackupManager=k;var M=function(){function e(t,r,n){(0,o.default)(this,e),this.authData=t,this.publicKey=r,this.getKey=n}return(0,a.default)(e,[{key:"untrusted",get:function(){return!0}},{key:"encryptSession",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,l.__generator)(this,(function(n){return delete(r=Object.assign({},e)).session_id,delete r.room_id,delete r.first_known_index,[2,t.publicKey.encrypt(JSON.stringify(r))]}))}))()}},{key:"decryptSessions",value:function(e){var t=this;return(0,i.default)((function(){var n,i,o,a,s,c,d,p,v,g,m,y;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return[4,t.getKey()];case 1:n=l.sent(),i=new r.Olm.PkDecryption;try{if(i.init_with_private_key(n)!==t.authData.public_key)throw new E.MatrixError({errcode:f.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY});o=[],a=!0,s=!1,c=void 0;try{for(d=Object.entries(e)[Symbol.iterator]();!(a=(p=d.next()).done);a=!0){v=(0,u.default)(p.value,2),g=v[0],m=v[1];try{(y=JSON.parse(i.decrypt(m.session_data.ephemeral,m.session_data.mac,m.session_data.ciphertext))).session_id=g,o.push(y)}catch(e){h.logger.log("Failed to decrypt megolm session from backup",e,m)}}}catch(e){s=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw c}}return[2,o]}finally{i.free()}return[2]}}))}))()}},{key:"keyMatches",value:function(e){var t=this;return(0,i.default)((function(){var n,i;return(0,l.__generator)(this,(function(o){n=new r.Olm.PkDecryption;try{i=n.init_with_private_key(e)}finally{n.free()}return[2,i===t.authData.public_key]}))}))()}},{key:"free",value:function(){this.publicKey.free()}}],[{key:"init",value:function(t,n){return(0,i.default)((function(){var i;return(0,l.__generator)(this,(function(o){if(!t||!("public_key"in t))throw new Error("auth_data missing required information");return(i=new r.Olm.PkEncryption).set_recipient_key(t.public_key),[2,new e(t,i,n)]}))}))()}},{key:"prepare",value:function(e){return(0,i.default)((function(){var t,n,i;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:t=new r.Olm.PkDecryption,o.label=1;case 1:return o.trys.push([1,,6,7]),n={},e?[3,2]:(n.public_key=t.generate_key(),[3,5]);case 2:return e instanceof Uint8Array?(n.public_key=t.init_with_private_key(e),[3,5]):[3,3];case 3:return[4,(0,v.keyFromPassphrase)(e)];case 4:i=o.sent(),n.private_key_salt=i.salt,n.private_key_iterations=i.iterations,n.public_key=t.init_with_private_key(i.key),o.label=5;case 5:return(new r.Olm.PkEncryption).set_recipient_key(n.public_key),[2,[t.get_private_key(),n]];case 6:return t.free(),[7];case 7:return[2]}}))}))()}},{key:"checkBackupVersion",value:function(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}}]),e}();e.exports.Curve25519=M,(0,d.default)(M,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");var C,I=new _.UnstableValue("m.megolm_backup.v1.aes-hmac-sha2","org.matrix.msc3270.v1.aes-hmac-sha2"),T=function(){function e(t,r){(0,o.default)(this,e),this.authData=t,this.key=r}return(0,a.default)(e,[{key:"untrusted",get:function(){return!1}},{key:"encryptSession",value:function(e){var t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,(0,b.encryptAES)(JSON.stringify(t),this.key,e.session_id)}},{key:"decryptSessions",value:function(e){var t=this;return(0,i.default)((function(){var r,n,i,o,a,s,c,d,f,p,v,g,m;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:r=[],n=!0,i=!1,o=void 0,l.label=1;case 1:l.trys.push([1,8,9,10]),a=Object.entries(e)[Symbol.iterator](),l.label=2;case 2:if(n=(s=a.next()).done)return[3,7];c=(0,u.default)(s.value,2),d=c[0],f=c[1],l.label=3;case 3:return l.trys.push([3,5,,6]),v=JSON.parse,[4,(0,b.decryptAES)(f.session_data,t.key,d)];case 4:return(p=v.apply(JSON,[l.sent()])).session_id=d,r.push(p),[3,6];case 5:return g=l.sent(),h.logger.log("Failed to decrypt megolm session from backup",g,f),[3,6];case 6:return n=!0,[3,2];case 7:return[3,10];case 8:return m=l.sent(),i=!0,o=m,[3,10];case 9:try{n||null==a.return||a.return()}finally{if(i)throw o}return[7];case 10:return[2,r]}}))}))()}},{key:"keyMatches",value:function(e){var t=this;return(0,i.default)((function(){var r;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return t.authData.mac?[4,(0,b.calculateKeyCheck)(e,t.authData.iv)]:[3,2];case 1:return r=n.sent().mac,[2,t.authData.mac.replace(/=+$/g,"")===r.replace(/=+/g,"")];case 2:return[2,!0];case 3:return[2]}}))}))()}},{key:"free",value:function(){this.key.fill(0)}}],[{key:"init",value:function(t,r){return(0,i.default)((function(){var n,i;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:if(!t)throw new Error("auth_data missing");return[4,r()];case 1:return n=o.sent(),t.mac?[4,(0,b.calculateKeyCheck)(n,t.iv)]:[3,3];case 2:if(i=o.sent().mac,t.mac.replace(/=+$/g,"")!==i.replace(/=+/g,""))throw new Error("Key does not match");o.label=3;case 3:return[2,new e(t,n)]}}))}))()}},{key:"prepare",value:function(e){return(0,i.default)((function(){var t,r,n,i,o,a;return(0,l.__generator)(this,(function(s){switch(s.label){case 0:return r={},e?[3,1]:(u=new Uint8Array(32),S.crypto.getRandomValues(u),t=u,[3,4]);case 1:return e instanceof Uint8Array?(t=new Uint8Array(e),[3,4]):[3,2];case 2:return[4,(0,v.keyFromPassphrase)(e)];case 3:n=s.sent(),r.private_key_salt=n.salt,r.private_key_iterations=n.iterations,t=n.key,s.label=4;case 4:return[4,(0,b.calculateKeyCheck)(t)];case 5:return i=s.sent(),o=i.iv,a=i.mac,r.iv=o,r.mac=a,[2,[t,r]]}var u}))}))()}},{key:"checkBackupVersion",value:function(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}}]),e}();e.exports.Aes256=T,(0,d.default)(T,"algorithmName",I.name);var R=(C={},(0,s.default)(C,M.algorithmName,M),(0,s.default)(C,T.algorithmName,T),C);e.exports.algorithmsByName=R;var x=M;e.exports.DefaultAlgorithm=x})),n.register("gXzzd",(function(e,t){var r=n("kxanC"),i=n("hWDD9");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SearchResult=void 0;var o=n("91RpG"),a=function(){function e(t,n){(0,r.default)(this,e),this.rank=t,this.context=n}return(0,i.default)(e,null,[{key:"fromJson",value:function(t,r){var n=t.context||{},i=(n.events_before||[]).map(r),a=(n.events_after||[]).map(r),s=new o.EventContext(r(t.result)),u=s.ourEvent.threadRootId;return i=i.filter((function(e){return e.threadRootId===u})),a=a.filter((function(e){return e.threadRootId===u})),s.setPaginateToken(n.start,!0),s.addEvents(i,!0),s.addEvents(a,!1),s.setPaginateToken(n.end,!1),new e(t.rank,s)}}]),e}();e.exports.SearchResult=a})),n.register("91RpG",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("dLRop"),a=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventContext=void 0;var s=a(n("3rHpI")),u=n("aBvOl"),l=function(){function e(t){var n;(0,r.default)(this,e),this.ourEvent=t,(0,s.default)(this,"timeline",void 0),(0,s.default)(this,"ourEventIndex",0),(0,s.default)(this,"paginateTokens",(n={},(0,o.default)(n,u.Direction.Backward,null),(0,o.default)(n,u.Direction.Forward,null),n)),this.timeline=[t]}return(0,i.default)(e,[{key:"getEvent",value:function(){return this.timeline[this.ourEventIndex]}},{key:"getTimeline",value:function(){return this.timeline}},{key:"getOurEventIndex",value:function(){return this.ourEventIndex}},{key:"getPaginateToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.paginateTokens[e?u.Direction.Backward:u.Direction.Forward]}},{key:"setPaginateToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.paginateTokens[t?u.Direction.Backward:u.Direction.Forward]=null!=e?e:null}},{key:"addEvents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}]),e}();e.exports.EventContext=l})),n.register("9qbZC",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.CrossSigningKey=void 0,e.exports.CrossSigningKey=r,(n=r||(e.exports.CrossSigningKey=r={})).Master="master",n.SelfSigning="self_signing",n.UserSigning="user_signing"})),n.register("7pEi8",(function(e,t){"use strict";var r,n,i,o,a,s,u,l,c,d,f;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Visibility=e.exports.RestrictedAllowType=e.exports.Preset=e.exports.JoinRule=e.exports.HistoryVisibility=e.exports.GuestAccess=void 0,e.exports.Visibility=r,(n=r||(e.exports.Visibility=r={})).Public="public",n.Private="private",e.exports.Preset=i,(o=i||(e.exports.Preset=i={})).PrivateChat="private_chat",o.TrustedPrivateChat="trusted_private_chat",o.PublicChat="public_chat",e.exports.JoinRule=a,(s=a||(e.exports.JoinRule=a={})).Public="public",s.Invite="invite",s.Private="private",s.Knock="knock",s.Restricted="restricted",e.exports.RestrictedAllowType=u,(u||(e.exports.RestrictedAllowType=u={})).RoomMembership="m.room_membership",e.exports.GuestAccess=l,(c=l||(e.exports.GuestAccess=l={})).CanJoin="can_join",c.Forbidden="forbidden",e.exports.HistoryVisibility=d,(f=d||(e.exports.HistoryVisibility=d={})).Invited="invited",f.Joined="joined",f.Shared="shared",f.WorldReadable="world_readable"})),n.register("fdAIX",(function(e,t){"use strict";var r=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.eventMapperFor=function(e,t){var r=Boolean(t.preventReEmit),n=!1!==t.decrypt;return function(i){t.toDevice&&delete i.room_id;var a,u=e.getRoom(i.room_id);u&&void 0===i.state_key&&(a=u.findEventById(i.event_id)),!a||a.status?a=new o.MatrixEvent(i):(a.setUnsigned(s(s({},a.getUnsigned()),i.unsigned)),r=!0);var l=null==u?void 0:u.findThreadForEvent(a);return l&&a.setThread(l),a.isEncrypted()&&(r||e.reEmitter.reEmit(a,[o.MatrixEventEvent.Decrypted]),n&&e.decryptEventIfNeeded(a)),r||(e.reEmitter.reEmit(a,[o.MatrixEventEvent.Replaced,o.MatrixEventEvent.VisibilityChange]),null==u||u.reEmitter.reEmit(a,[o.MatrixEventEvent.BeforeRedaction])),a}};var i=r(n("3rHpI")),o=n("jEuTn");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}})),n.register("4lFhK",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("dLRop"),s=n("9oGi2"),u=n("eQNFO"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TreePermissions=e.exports.MSC3089TreeSpace=e.exports.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;var c,d=l(n("3rHpI")),f=l(n("bziKh")),h=n("8bPbt"),p=n("jtqeE"),v=n("e8gas"),g=n("88hXH"),m=n("kKi5e");function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,d.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _,w,S={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:(c={},(0,a.default)(c,h.EventType.RoomPowerLevels,100),(0,a.default)(c,h.EventType.RoomHistoryVisibility,100),(0,a.default)(c,h.EventType.RoomTombstone,100),(0,a.default)(c,h.EventType.RoomEncryption,100),(0,a.default)(c,h.EventType.RoomName,50),(0,a.default)(c,h.EventType.RoomMessage,50),(0,a.default)(c,h.EventType.RoomMessageEncrypted,50),(0,a.default)(c,h.EventType.Sticker,50),c),users:{}};e.exports.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=S,e.exports.TreePermissions=_,(w=_||(e.exports.TreePermissions=_={})).Viewer="viewer",w.Editor="editor",w.Owner="owner";var E=function(){function e(t,r){if((0,i.default)(this,e),this.client=t,this.roomId=r,(0,d.default)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}return(0,o.default)(e,[{key:"id",get:function(){return this.roomId}},{key:"isTopLevel",get:function(){var e=this.room.currentState.getStateEvents(h.EventType.SpaceParent);return null==e||!e.length||e.every((function(e){var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}},{key:"setName",value:function(e){var t=this;return(0,r.default)((function(){return(0,u.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.client.sendStateEvent(t.roomId,h.EventType.RoomName,{name:e},"")];case 1:return r.sent(),[2]}}))}))()}},{key:"invite",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this;return(0,r.default)((function(){var r,o;return(0,u.__generator)(this,(function(a){return o=[i.retryInvite(e)],t&&(r=o).push.apply(r,(0,s.default)(i.getDirectories().map((function(r){return r.invite(e,t,n)})))),[2,Promise.all(o).then((function(){n&&(0,m.isRoomSharedHistory)(i.room)&&i.client.sendSharedHistoryKeys(i.roomId,[e])}))]}))}))()}},{key:"retryInvite",value:function(e){var t=this;return(0,v.simpleRetryOperation)((0,r.default)((function(){return(0,u.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.client.invite(t.roomId,e).catch((function(e){if("M_FORBIDDEN"===(null==e?void 0:e.errcode))throw new f.default.AbortError(e);throw e}))];case 1:return r.sent(),[2]}}))})))}},{key:"setPermissions",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i,o,a,s,l,c;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(i=n.room.currentState.getStateEvents(h.EventType.RoomPowerLevels,""),Array.isArray(i))throw new Error("Unexpected return type for power levels");switch(o=(null==i?void 0:i.getContent())||{},a=o.users_default||0,s=o.events_default||50,l=(null===(r=o.events)||void 0===r?void 0:r[h.EventType.RoomPowerLevels])||100,c=o.users||{},t){case _.Viewer:c[e]=a;break;case _.Editor:c[e]=s;break;case _.Owner:c[e]=l;break;default:throw new Error("Invalid role: "+t)}return o.users=c,[4,n.client.sendStateEvent(n.roomId,h.EventType.RoomPowerLevels,o,"")];case 1:return u.sent(),[2]}}))}))()}},{key:"getPermissions",value:function(e){var t,r,n=this.room.currentState.getStateEvents(h.EventType.RoomPowerLevels,"");if(Array.isArray(n))throw new Error("Unexpected return type for power levels");var i=(null==n?void 0:n.getContent())||{},o=i.users_default||0,a=i.events_default||50,s=(null===(t=i.events)||void 0===t?void 0:t[h.EventType.RoomPowerLevels])||100,u=(null===(r=i.users)||void 0===r?void 0:r[e])||o;return u>=s?_.Owner:u>=a?_.Editor:_.Viewer}},{key:"createDirectory",value:function(e){var t=this;return(0,r.default)((function(){var r;return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.client.unstableCreateFileTree(e)];case 1:return r=n.sent(),[4,t.client.sendStateEvent(t.roomId,h.EventType.SpaceChild,{via:[t.client.getDomain()]},r.roomId)];case 2:return n.sent(),[4,t.client.sendStateEvent(r.roomId,h.EventType.SpaceParent,{via:[t.client.getDomain()]},t.roomId)];case 3:return n.sent(),[2,r]}}))}))()}},{key:"getDirectories",value:function(){var e=[],t=this.room.currentState.getStateEvents(h.EventType.SpaceChild),r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;try{var u=s.getStateKey();if(u){var l=this.client.unstableGetFileTreeSpace(u);l&&e.push(l)}}catch(e){p.logger.warn("Unable to create tree space instance for listing. Are we joined?",e)}}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return e}},{key:"getDirectory",value:function(e){return this.getDirectories().find((function(t){return t.roomId===e}))}},{key:"delete",value:function(){var e=this;return(0,r.default)((function(){var t,r,n,i,o,a,s,l,c,d,f,p,v,g,m,y;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:t=e.getDirectories(),r=!0,n=!1,i=void 0,u.label=1;case 1:u.trys.push([1,6,7,8]),o=t[Symbol.iterator](),u.label=2;case 2:return(r=(a=o.next()).done)?[3,5]:[4,a.value.delete()];case 3:u.sent(),u.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return y=u.sent(),n=!0,i=y,[3,8];case 7:try{r||null==o.return||o.return()}finally{if(n)throw i}return[7];case 8:s=["invite","knock","join"],l=e.room.currentState.getStateEvents(h.EventType.RoomMember),c=!0,d=!1,f=void 0,u.label=9;case 9:u.trys.push([9,14,15,16]),p=l[Symbol.iterator](),u.label=10;case 10:if(c=(v=p.next()).done)return[3,13];if(g=v.value,!(g.getStateKey()!==e.client.getUserId())||!s.includes(g.getContent().membership))return[3,12];if(!(m=g.getStateKey()))throw new Error("State key not found for branch");return[4,e.client.kick(e.roomId,m,"Room deleted")];case 11:u.sent(),u.label=12;case 12:return c=!0,[3,10];case 13:return[3,16];case 14:return y=u.sent(),d=!0,f=y,[3,16];case 15:try{c||null==p.return||p.return()}finally{if(d)throw f}return[7];case 16:return[4,e.client.leave(e.roomId)];case 17:return u.sent(),[2]}}))}))()}},{key:"getOrderedChildren",value:function(e){var t=this,r=e.map((function(e){return{roomId:e.getStateKey(),order:e.getContent().order}})).filter((function(e){return e.roomId}));return r.sort((function(e,r){if(e.order&&!r.order)return-1;if(!e.order&&r.order)return 1;if(e.order||r.order)return(0,v.lexicographicCompare)(e.order,r.order);var n,i,o,a,s=t.client.getRoom(e.roomId),u=t.client.getRoom(r.roomId);if(!s||!u)return(0,v.lexicographicCompare)(e.roomId,r.roomId);var l=null!==(n=null===(i=s.currentState.getStateEvents(h.EventType.RoomCreate,""))||void 0===i?void 0:i.getTs())&&void 0!==n?n:0,c=null!==(o=null===(a=u.currentState.getStateEvents(h.EventType.RoomCreate,""))||void 0===a?void 0:a.getTs())&&void 0!==o?o:0;return l===c?(0,v.lexicographicCompare)(e.roomId,r.roomId):l-c})),r}},{key:"getParentRoom",value:function(){var e=this.room.currentState.getStateEvents(h.EventType.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");var t=e.getStateKey();if(!t)throw new Error("No state key found for parent");var r=this.client.getRoom(t);if(!r)throw new Error("Unable to locate room for parent");return r}},{key:"getOrder",value:function(){var e=this;if(this.isTopLevel)return-1;var t=this.getParentRoom().currentState.getStateEvents(h.EventType.SpaceChild);return this.getOrderedChildren(t).findIndex((function(t){return t.roomId===e.roomId}))}},{key:"setOrder",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,a,s,l,c,d,f,p,g,m,y,_,w,S,E,k,M;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(t.isTopLevel)throw new Error("Cannot set order of top level spaces currently");if(n=t.getParentRoom(),i=n.currentState.getStateEvents(h.EventType.SpaceChild),o=t.getOrderedChildren(i),e=Math.max(Math.min(e,o.length-1),0),a=t.getOrder(),(s=a<e)&&e===o.length-1?e--:s||0!==e||e++,l=o[s?e:e-1],c=o[s?e+1:e],d=v.DEFAULT_ALPHABET[0],f=!1,l?e===o.length-1?null!=c&&c.order&&(d=(0,v.nextString)(c.order)):(p=null==l?void 0:l.order,g=null==c?void 0:c.order,p&&g?d=p===g?(0,v.nextString)(p):(0,v.averageBetweenStrings)(p,g):p?d=(0,v.nextString)(p):g?d=(0,v.prevString)(g):f=!0):null!=c&&c.order&&(d=(0,v.prevString)(c.order)),!f)return[3,6];y=0,u.label=1;case 1:return y<=e?(_=o[y],0===y&&(m=_.order),_.order?[3,3]:(m=m?(0,v.nextString)(m):v.DEFAULT_ALPHABET[0],S=n.currentState.getStateEvents(h.EventType.SpaceChild,_.roomId),E=null!==(w=null==S?void 0:S.getContent())&&void 0!==w?w:{via:[t.client.getDomain()]},[4,t.client.sendStateEvent(n.roomId,h.EventType.SpaceChild,b(b({},E),{},{order:m}),_.roomId)])):[3,5];case 2:return u.sent(),[3,4];case 3:m=_.order,u.label=4;case 4:return y++,[3,1];case 5:m&&(d=(0,v.nextString)(m)),u.label=6;case 6:return k=n.currentState.getStateEvents(h.EventType.SpaceChild,t.roomId),M=null!==(r=null==k?void 0:k.getContent())&&void 0!==r?r:{via:[t.client.getDomain()]},[4,t.client.sendStateEvent(n.roomId,h.EventType.SpaceChild,b(b({},M),{},{order:d}),t.roomId)];case 7:return u.sent(),[2]}}))}))()}},{key:"createFile",value:function(e,t,n,i){var o=this;return(0,r.default)((function(){var r,s,l,c,d;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return[4,o.client.uploadContent(t,{includeFilename:!1})];case 1:return s=u.sent(),l=s.content_uri,n.url=l,c={msgtype:h.MsgType.File,body:e,url:l,file:n},(i=null!==(r=i)&&void 0!==r?r:{})["m.new_content"]&&(i["m.new_content"]=c),[4,o.client.sendMessage(o.roomId,b(b(b({},i),c),{},(0,a.default)({},h.UNSTABLE_MSC3089_LEAF.name,{})))];case 2:return d=u.sent(),[4,o.client.sendStateEvent(o.roomId,h.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e},d.event_id)];case 3:return u.sent(),[2,d]}}))}))()}},{key:"getFile",value:function(e){var t=this.room.currentState.getStateEvents(h.UNSTABLE_MSC3089_BRANCH.name,e);return t?new g.MSC3089Branch(this.client,t,this):null}},{key:"listFiles",value:function(){return this.listAllFiles().filter((function(e){return e.isActive}))}},{key:"listAllFiles",value:function(){var e,t=this;return(null!==(e=this.room.currentState.getStateEvents(h.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==e?e:[]).map((function(e){return new g.MSC3089Branch(t.client,e,t)}))}}]),e}();e.exports.MSC3089TreeSpace=E})),n.register("88hXH",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("9oGi2"),s=n("eQNFO"),u=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MSC3089Branch=void 0;var l=u(n("3rHpI")),c=n("8bPbt"),d=n("aBvOl");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=function(){function e(t,r,n){(0,i.default)(this,e),this.client=t,this.indexEvent=r,this.directory=n}return(0,o.default)(e,[{key:"id",get:function(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}},{key:"isActive",get:function(){return!0===this.indexEvent.getContent().active}},{key:"version",get:function(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}},{key:"roomId",get:function(){return this.indexEvent.getRoomId()}},{key:"delete",value:function(){var e=this;return(0,r.default)((function(){var t;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.client.sendStateEvent(e.roomId,c.UNSTABLE_MSC3089_BRANCH.name,{},e.id)];case 1:return r.sent(),[4,e.client.redactEvent(e.roomId,e.id)];case 2:return r.sent(),[4,e.getVersionHistory()];case 3:return(t=r.sent()[1])?[4,t.delete()]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))()}},{key:"getName",value:function(){return this.indexEvent.getContent().name||"Unnamed File"}},{key:"setName",value:function(e){var t=this;return(0,r.default)((function(){return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.client.sendStateEvent(t.roomId,c.UNSTABLE_MSC3089_BRANCH.name,h(h({},t.indexEvent.getContent()),{},{name:e}),t.id)];case 1:return r.sent(),[2]}}))}))()}},{key:"isLocked",value:function(){return this.indexEvent.getContent().locked||!1}},{key:"setLocked",value:function(e){var t=this;return(0,r.default)((function(){return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.client.sendStateEvent(t.roomId,c.UNSTABLE_MSC3089_BRANCH.name,h(h({},t.indexEvent.getContent()),{},{locked:e}),t.id)];case 1:return r.sent(),[2]}}))}))()}},{key:"getFileInfo",value:function(){var e=this;return(0,r.default)((function(){var t,r,n;return(0,s.__generator)(this,(function(i){switch(i.label){case 0:return[4,e.getFileEvent()];case 1:if(t=i.sent(),r=t.getOriginalContent().file,!(n=e.client.mxcUrlToHttp(r.url)))throw new Error("No HTTP URL available for ".concat(r.url));return[2,{info:r,httpUrl:n}]}}))}))()}},{key:"getFileEvent",value:function(){var e=this;return(0,r.default)((function(){var t,r;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:if(!(t=e.client.getRoom(e.roomId)))throw new Error("Unknown room");r=t.getUnfilteredTimelineSet().findEventById(e.id),n.label=1;case 1:return r||!t.getLiveTimeline().getState(d.EventTimeline.BACKWARDS).paginationToken?[3,3]:[4,e.client.scrollback(t,100)];case 2:return n.sent(),r=t.getUnfilteredTimelineSet().findEventById(e.id),[3,1];case 3:if(!r)throw new Error("Failed to find event");return[4,e.client.decryptEventIfNeeded(r,{emit:!0,isRetry:!0})];case 4:return n.sent(),[2,r]}}))}))()}},{key:"createNewVersion",value:function(e,t,n,i){var o=this;return(0,r.default)((function(){var r;return(0,s.__generator)(this,(function(a){switch(a.label){case 0:return[4,o.directory.createFile(e,t,n,h(h({},null!=i?i:{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:c.RelationType.Replace,event_id:o.id}}))];case 1:return r=a.sent(),[4,o.client.sendStateEvent(o.roomId,c.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e,version:o.version+1},r.event_id)];case 2:return a.sent(),[4,o.client.sendStateEvent(o.roomId,c.UNSTABLE_MSC3089_BRANCH.name,h(h({},o.indexEvent.getContent()),{},{active:!1}),o.id)];case 3:return a.sent(),[2,r]}}))}))()}},{key:"getVersionHistory",value:function(){var e=this;return(0,r.default)((function(){var t,r,n,i,o,u;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:if((t=[]).push(e),!(r=e.client.getRoom(e.roomId)))throw new Error("Invalid or unknown room");return n=(0,a.default)(r.getLiveTimeline().getEvents()).reverse(),[4,e.getFileEvent()];case 1:o=s.sent();do{if(i=n.find((function(e){return e.replacingEventId()===o.getId()}))){if(!(u=e.directory.getFile(i.getId())))break;t.push(u),o=i}}while(i);return[2,t]}}))}))()}}]),e}();e.exports.MSC3089Branch=p})),n.register("kilBp",(function(e,t){"use strict";var r,n,i,o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SearchOrderBy=void 0,(n=r||(r={})).RoomId="room_id",n.Sender="sender",e.exports.SearchOrderBy=i,(o=i||(e.exports.SearchOrderBy=i={})).Recent="recent",o.Rank="rank"})),n.register("hEqf2",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("giCK6"),l=n("eQNFO"),c=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MediaHandlerEvent=e.exports.MediaHandler=void 0;var d,f=c(n("3rHpI")),h=n("6MMVS"),p=n("fu2Ru"),v=n("jtqeE");e.exports.MediaHandlerEvent=d,(d||(e.exports.MediaHandlerEvent=d={})).LocalStreamsChanged="local_streams_changed";var g=function(e){(0,s.default)(n,e);var t=(0,u.default)(n);function n(e){var i;return(0,o.default)(this,n),(i=t.call(this)).client=e,(0,f.default)((0,r.default)(i),"audioInput",void 0),(0,f.default)((0,r.default)(i),"audioSettings",void 0),(0,f.default)((0,r.default)(i),"videoInput",void 0),(0,f.default)((0,r.default)(i),"localUserMediaStream",void 0),(0,f.default)((0,r.default)(i),"userMediaStreams",[]),(0,f.default)((0,r.default)(i),"screensharingStreams",[]),i}return(0,a.default)(n,[{key:"restoreMediaSettings",value:function(e,t){this.audioInput=e,this.videoInput=t}},{key:"setAudioInput",value:function(e){var t=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return v.logger.info("Setting audio input to",e),t.audioInput===e?[2]:(t.audioInput=e,[4,t.updateLocalUsermediaStreams()]);case 1:return r.sent(),[2]}}))}))()}},{key:"setAudioSettings",value:function(e){var t=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return v.logger.info("Setting audio settings to",e),t.audioSettings=Object.assign({},e),[4,t.updateLocalUsermediaStreams()];case 1:return r.sent(),[2]}}))}))()}},{key:"setVideoInput",value:function(e){var t=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return v.logger.info("Setting video input to",e),t.videoInput===e?[2]:(t.videoInput=e,[4,t.updateLocalUsermediaStreams()]);case 1:return r.sent(),[2]}}))}))()}},{key:"setMediaInputs",value:function(e,t){var r=this;return(0,i.default)((function(){return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return v.logger.log("mediaHandler setMediaInputs audioInput: ".concat(e," videoInput: ").concat(t)),r.audioInput=e,r.videoInput=t,[4,r.updateLocalUsermediaStreams()];case 1:return n.sent(),[2]}}))}))()}},{key:"updateLocalUsermediaStreams",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s,u,c,f,h,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x,O,A,D,P,L,U,j,N,B,F;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if(0===e.userMediaStreams.length)return[2];t=new Map,r=!0,n=!1,i=void 0;try{for(o=e.client.callEventHandler.calls.values()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)s=a.value,t.set(s.callId,{audio:s.hasLocalUserMediaAudioTrack,video:s.hasLocalUserMediaVideoTrack})}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}u=!0,c=!1,f=void 0;try{for(h=e.userMediaStreams[Symbol.iterator]();!(u=(g=h.next()).done);u=!0){m=g.value,v.logger.log("mediaHandler stopping all tracks for stream ".concat(m.id)),y=!0,b=!1,_=void 0;try{for(w=m.getTracks()[Symbol.iterator]();!(y=(S=w.next()).done);y=!0)S.value.stop()}catch(e){b=!0,_=e}finally{try{y||null==w.return||w.return()}finally{if(b)throw _}}}}catch(e){c=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw f}}e.userMediaStreams=[],e.localUserMediaStream=void 0,E=!0,k=!1,M=void 0,l.label=1;case 1:l.trys.push([1,7,8,9]),C=e.client.callEventHandler.calls.values()[Symbol.iterator](),l.label=2;case 2:return(E=(I=C.next()).done)?[3,6]:(T=I.value).callHasEnded()||!t.has(T.callId)?[3,5]:(R=t.get(T.callId),x=R.audio,O=R.video,v.logger.log("mediaHandler updateLocalUsermediaStreams getUserMediaStream call ".concat(T.callId)),[4,e.getUserMediaStream(x,O)]);case 3:return A=l.sent(),T.callHasEnded()?[3,5]:[4,T.updateLocalUsermediaStream(A)];case 4:l.sent(),l.label=5;case 5:return E=!0,[3,2];case 6:return[3,9];case 7:return F=l.sent(),k=!0,M=F,[3,9];case 8:try{E||null==C.return||C.return()}finally{if(k)throw M}return[7];case 9:D=!0,P=!1,L=void 0,l.label=10;case 10:l.trys.push([10,16,17,18]),U=e.client.groupCallEventHandler.groupCalls.values()[Symbol.iterator](),l.label=11;case 11:return(D=(j=U.next()).done)?[3,15]:(N=j.value).localCallFeed?(v.logger.log("mediaHandler updateLocalUsermediaStreams getUserMediaStream groupCall ".concat(N.groupCallId)),[4,e.getUserMediaStream(!0,N.type===p.GroupCallType.Video)]):[3,14];case 12:return B=l.sent(),N.state===p.GroupCallState.Ended?[3,14]:[4,N.updateLocalUsermediaStream(B)];case 13:l.sent(),l.label=14;case 14:return D=!0,[3,11];case 15:return[3,18];case 16:return F=l.sent(),P=!0,L=F,[3,18];case 17:try{D||null==U.return||U.return()}finally{if(P)throw L}return[7];case 18:return e.emit(d.LocalStreamsChanged),[2]}}))}))()}},{key:"hasAudioDevice",value:function(){return(0,i.default)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:return[2,e.sent().filter((function(e){return"audioinput"===e.kind})).length>0]}}))}))()}},{key:"hasVideoDevice",value:function(){return(0,i.default)((function(){return(0,l.__generator)(this,(function(e){switch(e.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:return[2,e.sent().filter((function(e){return"videoinput"===e.kind})).length>0]}}))}))()}},{key:"getUserMediaStream",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this;return(0,i.default)((function(){var i,o,a,s,u,c,f,h,p,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x,O,A,D,P,L,U,j;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return(o=e)?[4,n.hasAudioDevice()]:[3,2];case 1:o=l.sent(),l.label=2;case 2:return i=o,(s=t)?[4,n.hasVideoDevice()]:[3,4];case 3:s=l.sent(),l.label=4;case 4:return a=s,c=!0,n.localUserMediaStream?(i!==n.localUserMediaStream.getAudioTracks().length>0&&(c=!1),a!==n.localUserMediaStream.getVideoTracks().length>0&&(c=!1),i&&(null===(f=n.localUserMediaStream.getAudioTracks()[0])||void 0===f||null===(h=f.getSettings())||void 0===h?void 0:h.deviceId)!==n.audioInput&&(c=!1),a&&(null===(p=n.localUserMediaStream.getVideoTracks()[0])||void 0===p||null===(g=p.getSettings())||void 0===g?void 0:g.deviceId)!==n.videoInput&&(c=!1)):c=!1,c?[3,6]:(m=n.getUserMediaContraints(i,a),[4,navigator.mediaDevices.getUserMedia(m)]);case 5:u=l.sent(),v.logger.log("mediaHandler getUserMediaStream streamId ".concat(u.id," shouldRequestAudio ").concat(i," shouldRequestVideo ").concat(a),m),y=!0,b=!1,_=void 0;try{for(w=u.getTracks()[Symbol.iterator]();!(y=(S=w.next()).done);y=!0)E=S.value,k=E.getSettings(),"audio"===E.kind?n.audioInput=k.deviceId:"video"===E.kind&&(n.videoInput=k.deviceId)}catch(e){b=!0,_=e}finally{try{y||null==w.return||w.return()}finally{if(b)throw _}}return r&&(n.localUserMediaStream=u),[3,7];case 6:if(u=n.localUserMediaStream.clone(),v.logger.log("mediaHandler clone userMediaStream ".concat(null===(M=n.localUserMediaStream)||void 0===M?void 0:M.id," new stream ").concat(u.id," shouldRequestAudio ").concat(i," shouldRequestVideo ").concat(a)),C=!0,I=!1,T=void 0,!i)try{for(R=u.getAudioTracks()[Symbol.iterator]();!(C=(x=R.next()).done);C=!0)O=x.value,u.removeTrack(O)}catch(e){I=!0,T=e}finally{try{C||null==R.return||R.return()}finally{if(I)throw T}}if(A=!0,D=!1,P=void 0,!a)try{for(L=u.getVideoTracks()[Symbol.iterator]();!(A=(U=L.next()).done);A=!0)j=U.value,u.removeTrack(j)}catch(e){D=!0,P=e}finally{try{A||null==L.return||L.return()}finally{if(D)throw P}}l.label=7;case 7:return r&&n.userMediaStreams.push(u),n.emit(d.LocalStreamsChanged),[2,u]}}))}))()}},{key:"stopUserMediaStream",value:function(e){v.logger.log("mediaHandler stopUserMediaStream stopping stream ".concat(e.id));var t=!0,r=!1,n=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.stop()}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}var a=this.userMediaStreams.indexOf(e);-1!==a&&(v.logger.debug("Splicing usermedia stream out stream array",e.id),this.userMediaStreams.splice(a,1)),this.emit(d.LocalStreamsChanged),this.localUserMediaStream===e&&(this.localUserMediaStream=void 0)}},{key:"getScreensharingStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return(0,i.default)((function(){var n,i,o;return(0,l.__generator)(this,(function(a){switch(a.label){case 0:return 0!==r.screensharingStreams.length?[3,5]:(i=r.getScreenshareContraints(e),e.desktopCapturerSourceId?(v.logger.debug("Getting screensharing stream using getUserMedia()",e),[4,navigator.mediaDevices.getUserMedia(i)]):[3,2]);case 1:return n=a.sent(),[3,4];case 2:return v.logger.debug("Getting screensharing stream using getDisplayMedia()",e),[4,navigator.mediaDevices.getDisplayMedia(i)];case 3:n=a.sent(),a.label=4;case 4:return[3,6];case 5:o=r.screensharingStreams[r.screensharingStreams.length-1],v.logger.log("Cloning screensharing stream",o.id),n=o.clone(),a.label=6;case 6:return t&&r.screensharingStreams.push(n),r.emit(d.LocalStreamsChanged),[2,n]}}))}))()}},{key:"stopScreensharingStream",value:function(e){v.logger.debug("Stopping screensharing stream",e.id);var t=!0,r=!1,n=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.stop()}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}var a=this.screensharingStreams.indexOf(e);-1!==a&&(v.logger.debug("Splicing screensharing stream out stream array",e.id),this.screensharingStreams.splice(a,1)),this.emit(d.LocalStreamsChanged)}},{key:"stopAllStreams",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.userMediaStreams[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;v.logger.log("mediaHandler stopAllStreams stopping stream ".concat(o.id));var a=!0,s=!1,u=void 0;try{for(var l,c=o.getTracks()[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){l.value.stop()}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}var f=!0,h=!1,p=void 0,g=!0,m=!1,y=void 0;try{for(var b,_=this.screensharingStreams[Symbol.iterator]();!(g=(b=_.next()).done);g=!0){var w=b.value;try{for(var S,E=w.getTracks()[Symbol.iterator]();!(f=(S=E.next()).done);f=!0){S.value.stop()}}catch(e){h=!0,p=e}finally{try{f||null==E.return||E.return()}finally{if(h)throw p}}}}catch(e){m=!0,y=e}finally{try{g||null==_.return||_.return()}finally{if(m)throw y}}this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(d.LocalStreamsChanged)}},{key:"getUserMediaContraints",value:function(e,t){var r=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}}}},{key:"getScreenshareContraints",value:function(e){var t=e.desktopCapturerSourceId,r=e.audio;return t?(v.logger.debug("Using desktop capturer source",t),{audio:null!=r&&r,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t}}}):(v.logger.debug("Not using desktop capturer source"),{audio:null!=r&&r,video:!0})}}]),n}(h.TypedEventEmitter);e.exports.MediaHandler=g})),n.register("9XadD",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SlidingSyncSdk=void 0;var u=s(n("3rHpI")),l=n("5xqDi"),c=n("jtqeE"),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=w(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),f=n("aBvOl"),h=n("4uAg3"),p=n("kk8uI"),v=n("6BFg8"),g=n("aboCS"),m=n("8bPbt"),y=n("gzOOt"),b=n("bcGqc"),_=n("9SRK1");function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(w=function(e){return e?r:t})(e)}var S=function(){function e(t){(0,i.default)(this,e),this.crypto=t}return(0,o.default)(e,[{key:"name",value:function(){return"e2ee"}},{key:"when",value:function(){return g.ExtensionState.PreProcess}},{key:"onRequest",value:function(e){if(e)return{enabled:!0}}},{key:"onResponse",value:function(e){var t=this;return(0,r.default)((function(){var r,n;return(0,a.__generator)(this,(function(i){switch(i.label){case 0:return e.device_lists?[4,t.crypto.handleDeviceListChanges({oldSyncToken:"yep"},e.device_lists)]:[3,2];case 1:i.sent(),i.label=2;case 2:return e.device_one_time_keys_count&&(r=e.device_one_time_keys_count.signed_curve25519||0,t.crypto.updateOneTimeKeyCount(r)),(e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"])&&(n=e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"],t.crypto.setNeedsNewFallback(Array.isArray(n)&&!n.includes("signed_curve25519"))),t.crypto.onSyncCompleted({}),[2]}}))}))()}}]),e}(),E=function(){function e(t,r){(0,i.default)(this,e),this.client=t,this.cryptoCallbacks=r,(0,u.default)(this,"nextBatch",null)}return(0,o.default)(e,[{key:"name",value:function(){return"to_device"}},{key:"when",value:function(){return g.ExtensionState.PreProcess}},{key:"onRequest",value:function(e){var t={since:null!==this.nextBatch?this.nextBatch:void 0};return e&&(t.limit=100,t.enabled=!0),t}},{key:"onResponse",value:function(e){var t=this;return(0,r.default)((function(){var r,n;return(0,a.__generator)(this,(function(i){switch(i.label){case 0:return r=[],(n=e.events||[]).length>0&&t.cryptoCallbacks?[4,t.cryptoCallbacks.preprocessToDeviceMessages(n)]:[3,2];case 1:n=i.sent(),i.label=2;case 2:return n.map(t.client.getEventMapper()).map((function(e){if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&r.push(t)}return e})).forEach((function(e){var n=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=n.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var i=n.transaction_id;r.includes(i)&&e.flagCancelled()}t.client.emit(h.ClientEvent.ToDeviceEvent,e)}else c.logger.log("Ignoring undecryptable to-device event from "+e.getSender())})),t.nextBatch=e.next_batch,[2]}}))}))()}}]),e}(),k=function(){function e(t){(0,i.default)(this,e),this.client=t}return(0,o.default)(e,[{key:"name",value:function(){return"account_data"}},{key:"when",value:function(){return g.ExtensionState.PostProcess}},{key:"onRequest",value:function(e){if(e)return{enabled:!0}}},{key:"onResponse",value:function(e){var t=this;for(var r in e.global&&e.global.length>0&&this.processGlobalAccountData(e.global),e.rooms){var n=T(this.client,r,e.rooms[r]),i=this.client.getRoom(r);i?(i.addAccountData(n),n.forEach((function(e){t.client.emit(h.ClientEvent.Event,e)}))):c.logger.warn("got account data for room but room doesn't exist on client:",r)}}},{key:"processGlobalAccountData",value:function(e){var t=this,r=T(this.client,void 0,e),n=r.reduce((function(e,r){return e[r.getType()]=t.client.store.getAccountData(r.getType()),e}),{});this.client.store.storeAccountDataEvents(r),r.forEach((function(e){if(e.getType()===m.EventType.PushRules){var r=e.getContent();t.client.pushRules=y.PushProcessor.rewriteDefaultRules(r)}var i=n[e.getType()];return t.client.emit(h.ClientEvent.AccountData,e,i),e}))}}]),e}(),M=function(){function e(t){(0,i.default)(this,e),this.client=t}return(0,o.default)(e,[{key:"name",value:function(){return"typing"}},{key:"when",value:function(){return g.ExtensionState.PostProcess}},{key:"onRequest",value:function(e){if(e)return{enabled:!0}}},{key:"onResponse",value:function(e){if(null!=e&&e.rooms)for(var t in e.rooms)R(this.client,t,[e.rooms[t]])}}]),e}(),C=function(){function e(t){(0,i.default)(this,e),this.client=t}return(0,o.default)(e,[{key:"name",value:function(){return"receipts"}},{key:"when",value:function(){return g.ExtensionState.PostProcess}},{key:"onRequest",value:function(e){if(e)return{enabled:!0}}},{key:"onResponse",value:function(e){if(null!=e&&e.rooms)for(var t in e.rooms)R(this.client,t,[e.rooms[t]])}}]),e}(),I=function(){function e(t,r,n,o){var a=this;(0,i.default)(this,e),this.slidingSync=t,this.client=r,(0,u.default)(this,"opts",void 0),(0,u.default)(this,"syncOpts",void 0),(0,u.default)(this,"syncState",null),(0,u.default)(this,"syncStateData",void 0),(0,u.default)(this,"lastPos",null),(0,u.default)(this,"failCount",0),(0,u.default)(this,"notifEvents",[]),this.opts=(0,p.defaultClientOpts)(n),this.syncOpts=(0,p.defaultSyncApiOpts)(o),r.getNotifTimelineSet()&&r.reEmitter.reEmit(r.getNotifTimelineSet(),[l.RoomEvent.Timeline,l.RoomEvent.TimelineReset]),this.slidingSync.on(g.SlidingSyncEvent.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(g.SlidingSyncEvent.RoomData,this.onRoomData.bind(this));var s=[new E(this.client,this.syncOpts.cryptoCallbacks),new k(this.client),new M(this.client),new C(this.client)];this.syncOpts.crypto&&s.push(new S(this.syncOpts.crypto)),s.forEach((function(e){a.slidingSync.registerExtension(e)}))}return(0,o.default)(e,[{key:"onRoomData",value:function(e,t){var r=this.client.store.getRoom(e);if(!r){if(!t.initial)return void c.logger.debug("initial flag not set but no stored room exists for room ",e,t);r=(0,p._createAndReEmitRoom)(this.client,e,this.opts)}this.processRoomData(this.client,r,t)}},{key:"onLifecycle",value:function(e,t,r){switch(r&&c.logger.debug("onLifecycle",e,r),e){case g.SlidingSyncState.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(p.SyncState.Prepared,{oldSyncToken:void 0,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(p.SyncState.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case g.SlidingSyncState.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>3?p.SyncState.Error:p.SyncState.Reconnecting,{error:new v.MatrixError(r)}),this.shouldAbortSync(new v.MatrixError(r)))return}else this.failCount=0}}},{key:"syncLeftRooms",value:function(){return(0,r.default)((function(){return(0,a.__generator)(this,(function(e){return[2,[]]}))}))()}},{key:"peek",value:function(e){return(0,r.default)((function(){return(0,a.__generator)(this,(function(e){return[2,null]}))}))()}},{key:"stopPeeking",value:function(){}},{key:"getSyncState",value:function(){return this.syncState}},{key:"getSyncStateData",value:function(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}},{key:"createRoom",value:function(e){var t=this.client.timelineSupport,r=new l.Room(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:t});return this.client.reEmitter.reEmit(r,[l.RoomEvent.Name,l.RoomEvent.Redaction,l.RoomEvent.RedactionCancelled,l.RoomEvent.Receipt,l.RoomEvent.Tags,l.RoomEvent.LocalEchoUpdated,l.RoomEvent.AccountData,l.RoomEvent.MyMembership,l.RoomEvent.Timeline,l.RoomEvent.TimelineReset]),this.registerStateListeners(r),r}},{key:"registerStateListeners",value:function(e){var t=this;this.client.reEmitter.reEmit(e.currentState,[b.RoomStateEvent.Events,b.RoomStateEvent.Members,b.RoomStateEvent.NewMember,b.RoomStateEvent.Update]),e.currentState.on(b.RoomStateEvent.NewMember,(function(e,r,n){var i;n.user=null!==(i=t.client.getUser(n.userId))&&void 0!==i?i:void 0,t.client.reEmitter.reEmit(n,[_.RoomMemberEvent.Name,_.RoomMemberEvent.Typing,_.RoomMemberEvent.PowerLevel,_.RoomMemberEvent.Membership])}))}},{key:"shouldAbortSync",value:function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(c.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(p.SyncState.Error,{error:e}),!0)}},{key:"processRoomData",value:function(e,t,n){var i=this;return(0,r.default)((function(){var o,s,u,c,p,v,g,y,b,_,w,S,E;return(0,a.__generator)(this,(function(k){switch(k.label){case 0:if(n=function(e,t,r){if(!r.name)return r;var n=!0,i=!1,o=void 0;try{for(var a,s=r.required_state[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(u.type===m.EventType.RoomName&&""===u.state_key)return u.content={name:r.name},r}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r.required_state.push({event_id:"$fake-sliding-sync-name-event-"+t,state_key:"",type:m.EventType.RoomName,content:{name:r.name},sender:e.getUserId(),origin_server_ts:(new Date).getTime()}),r}(e,t.roomId,n),o=T(i.client,t.roomId,n.required_state),s=T(i.client,t.roomId,n.timeline,!1),u=[],n.initial){for(c=new Set,t.getLiveTimeline().getEvents().forEach((function(e){c.add(e.getId())})),p=[],v=[],g=!1,y=s.length-1;y>=0;y--)b=s[y],c.has(b.getId())?g=!0:g?p.push(b):v.unshift(b);s=v,p.length>0&&t.addEventsToTimeline(p,!0,t.getLiveTimeline(),n.prev_batch)}return _=i.client.isRoomEncrypted(t.roomId),null!=n.notification_count&&t.setUnreadNotificationCount(l.NotificationCountType.Total,n.notification_count),null!=n.highlight_count&&(!_||_&&t.getUnreadNotificationCount(l.NotificationCountType.Highlight)<=0)&&t.setUnreadNotificationCount(l.NotificationCountType.Highlight,n.highlight_count),Number.isInteger(n.invited_count)&&t.currentState.setInvitedMemberCount(n.invited_count),Number.isInteger(n.joined_count)&&t.currentState.setJoinedMemberCount(n.joined_count),n.invite_state?(w=T(i.client,t.roomId,n.invite_state),i.injectRoomEvents(t,w),n.initial&&(t.recalculate(),i.client.store.storeRoom(t),i.client.emit(h.ClientEvent.Room,t)),w.forEach((function(e){i.client.emit(h.ClientEvent.Event,e)})),t.updateMyMembership("invite"),[2]):(n.initial&&t.getLiveTimeline().setPaginationToken(null!==(S=n.prev_batch)&&void 0!==S?S:null,f.EventTimeline.BACKWARDS),i.injectRoomEvents(t,o,s,n.num_live),t.addEphemeralEvents(u),t.updateMyMembership("join"),t.recalculate(),n.initial&&(e.store.storeRoom(t),e.emit(h.ClientEvent.Room,t)),i.addNotifications(s),M=(0,r.default)((function(r){return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return e.emit(h.ClientEvent.Event,r),r.isState()&&r.getType()==m.EventType.RoomEncryption&&i.syncOpts.crypto?[4,i.syncOpts.crypto.onCryptoEvent(t,r)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))})),E=function(e){return M.apply(this,arguments)},[4,d.promiseMapSeries(o,E)]);case 1:return k.sent(),[4,d.promiseMapSeries(s,E)];case 2:return k.sent(),u.forEach((function(t){e.emit(h.ClientEvent.Event,t)})),t.decryptCriticalEvents(),[2]}var M}))}))()}},{key:"injectRoomEvents",value:function(e,t,r,n){r=r||[],t=t||[],n=n||0;var i=e.getLiveTimeline(),o=0==i.getEvents().length;if(o){var a=!0,s=!1,u=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;this.client.getPushActionsForEvent(d)}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}i.initialiseState(t)}o||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t));var f=[];n>0&&(f=r.slice(-1*n),r=r.slice(0,-1*f.length)),e.addLiveEvents(r,{fromCache:!0}),f.length>0&&e.addLiveEvents(f,{fromCache:!1}),e.recalculate(),this.resolveInvites(e)}},{key:"resolveInvites",value:function(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership("invite").forEach((function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var n=t.getUser(r.userId);(n?Promise.resolve({avatar_url:n.avatarUrl,displayname:n.displayName}):t.getProfileInfo(r.userId)).then((function(t){var n=r.events.member;"invite"===n.getContent().membership&&(n.getContent().avatar_url=t.avatar_url,n.getContent().displayname=t.displayname,r.setMembershipEvent(n,e.currentState))}),(function(e){}))}}))}}},{key:"retryImmediately",value:function(){return!0}},{key:"sync",value:function(){var e=this;return(0,r.default)((function(){var t,r;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:c.logger.debug("Sliding sync init loop"),n.label=1;case 1:if(e.client.isGuest())return[3,6];n.label=2;case 2:return n.trys.push([2,4,,5]),c.logger.debug("Getting push rules..."),[4,e.client.getPushRules()];case 3:return t=n.sent(),c.logger.debug("Got push rules"),e.client.pushRules=t,[3,6];case 4:return r=n.sent(),c.logger.error("Getting push rules failed",r),e.shouldAbortSync(r)?[2]:[3,5];case 5:return[3,1];case 6:return[4,e.slidingSync.start()];case 7:return n.sent(),[2]}}))}))()}},{key:"stop",value:function(){c.logger.debug("SyncApi.stop"),this.slidingSync.stop()}},{key:"updateSyncState",value:function(e,t){var r=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(h.ClientEvent.Sync,this.syncState,r,t)}},{key:"addNotifications",value:function(e){if(this.client.getNotifTimelineSet()){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=this.client.getPushActionsForEvent(a);s&&s.notify&&s.tweaks&&s.tweaks.highlight&&this.notifEvents.push(a)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}}},{key:"purgeNotifications",value:function(){var e=this;this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((function(t){var r;null===(r=e.client.getNotifTimelineSet())||void 0===r||r.addLiveEvent(t)})),this.notifEvents=[]}}]),e}();function T(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.getEventMapper({decrypt:n});return r.map((function(e){return e.room_id=t,i(e)}))}function R(e,t,r){var n=T(e,t,r),i=e.getRoom(t);i?(i.addEphemeralEvents(n),n.forEach((function(t){e.emit(h.ClientEvent.Event,t)}))):c.logger.warn("got ephemeral events for room but room doesn't exist on client:",t)}e.exports.SlidingSyncSdk=I})),n.register("aboCS",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("giCK6"),l=n("eQNFO"),c=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SlidingSyncState=e.exports.SlidingSyncEvent=e.exports.SlidingSync=e.exports.MSC3575_WILDCARD=e.exports.MSC3575_STATE_KEY_ME=e.exports.MSC3575_STATE_KEY_LAZY=e.exports.ExtensionState=void 0;var d=c(n("3rHpI")),f=n("jtqeE"),h=n("6MMVS"),p=n("e8gas");function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,d.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.MSC3575_WILDCARD="*";e.exports.MSC3575_STATE_KEY_ME="$ME";var m,y;e.exports.MSC3575_STATE_KEY_LAZY="$LAZY",e.exports.SlidingSyncState=m,(y=m||(e.exports.SlidingSyncState=m={})).RequestFinished="FINISHED",y.Complete="COMPLETE";var b,_,w,S,E=function(){function e(t){(0,o.default)(this,e),(0,d.default)(this,"list",void 0),(0,d.default)(this,"isModified",void 0),(0,d.default)(this,"roomIndexToRoomId",{}),(0,d.default)(this,"joinedCount",0),this.replaceList(t)}return(0,a.default)(e,[{key:"setModified",value:function(e){this.isModified=e}},{key:"updateListRange",value:function(e){this.list.ranges=JSON.parse(JSON.stringify(e))}},{key:"replaceList",value:function(e){e.filters=e.filters||{},e.ranges=e.ranges||[],this.list=JSON.parse(JSON.stringify(e)),this.isModified=!0,this.roomIndexToRoomId={},this.joinedCount=0}},{key:"getList",value:function(e){var t={ranges:JSON.parse(JSON.stringify(this.list.ranges))};return(this.isModified||e)&&(t=JSON.parse(JSON.stringify(this.list))),t}},{key:"isIndexInRange",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.list.ranges[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a[0]<=e&&e<=a[1])return!0}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return!1}}]),e}();e.exports.ExtensionState=b,(_=b||(e.exports.ExtensionState=b={})).PreProcess="ExtState.PreProcess",_.PostProcess="ExtState.PostProcess",e.exports.SlidingSyncEvent=w,(S=w||(e.exports.SlidingSyncEvent=w={})).RoomData="SlidingSync.RoomData",S.Lifecycle="SlidingSync.Lifecycle",S.List="SlidingSync.List";var k=function(e){(0,s.default)(n,e);var t=(0,u.default)(n);function n(e,i,a,s,u){var l;return(0,o.default)(this,n),(l=t.call(this)).proxyBaseUrl=e,l.roomSubscriptionInfo=a,l.client=s,l.timeoutMS=u,(0,d.default)((0,r.default)(l),"lists",void 0),(0,d.default)((0,r.default)(l),"listModifiedCount",0),(0,d.default)((0,r.default)(l),"terminated",!1),(0,d.default)((0,r.default)(l),"needsResend",!1),(0,d.default)((0,r.default)(l),"txnId",null),(0,d.default)((0,r.default)(l),"txnIdDefers",[]),(0,d.default)((0,r.default)(l),"extensions",{}),(0,d.default)((0,r.default)(l),"desiredRoomSubscriptions",new Set),(0,d.default)((0,r.default)(l),"confirmedRoomSubscriptions",new Set),(0,d.default)((0,r.default)(l),"customSubscriptions",new Map),(0,d.default)((0,r.default)(l),"roomIdToCustomSubscription",new Map),(0,d.default)((0,r.default)(l),"pendingReq",void 0),(0,d.default)((0,r.default)(l),"abortController",void 0),l.lists=i.map((function(e){return new E(e)})),l}return(0,a.default)(n,[{key:"addCustomSubscription",value:function(e,t){this.customSubscriptions.has(e)?f.logger.warn("addCustomSubscription: ".concat(e," already exists as a custom subscription, ignoring.")):this.customSubscriptions.set(e,t)}},{key:"useCustomSubscription",value:function(e,t){this.roomIdToCustomSubscription.get(e)!==t&&(this.roomIdToCustomSubscription.set(e,t),this.confirmedRoomSubscriptions.delete(e))}},{key:"listLength",value:function(){return this.lists.length}},{key:"getListData",value:function(e){return this.lists[e]?{joinedCount:this.lists[e].joinedCount,roomIndexToRoomId:Object.assign({},this.lists[e].roomIndexToRoomId)}:null}},{key:"getList",value:function(e){return this.lists[e]?this.lists[e].getList(!0):null}},{key:"setListRanges",value:function(e,t){return this.lists[e].updateListRange(t),this.resend()}},{key:"setList",value:function(e,t){return this.lists[e]?this.lists[e].replaceList(t):this.lists[e]=new E(t),this.listModifiedCount+=1,this.resend()}},{key:"getRoomSubscriptions",value:function(){return new Set(Array.from(this.desiredRoomSubscriptions))}},{key:"modifyRoomSubscriptions",value:function(e){return this.desiredRoomSubscriptions=e,this.resend()}},{key:"modifyRoomSubscriptionInfo",value:function(e){return this.roomSubscriptionInfo=e,this.confirmedRoomSubscriptions=new Set,this.resend()}},{key:"registerExtension",value:function(e){if(this.extensions[e.name()])throw new Error("registerExtension: ".concat(e.name()," already exists as an extension"));this.extensions[e.name()]=e}},{key:"getExtensionRequest",value:function(e){var t=this,r={};return Object.keys(this.extensions).forEach((function(n){r[n]=t.extensions[n].onRequest(e)})),r}},{key:"onPreExtensionsResponse",value:function(e){var t=this;Object.keys(e).forEach((function(r){t.extensions[r].when()==b.PreProcess&&t.extensions[r].onResponse(e[r])}))}},{key:"onPostExtensionsResponse",value:function(e){var t=this;Object.keys(e).forEach((function(r){t.extensions[r].when()==b.PostProcess&&t.extensions[r].onResponse(e[r])}))}},{key:"invokeRoomDataListeners",value:function(e,t){t.required_state||(t.required_state=[]),t.timeline||(t.timeline=[]),this.emit(w.RoomData,e,t)}},{key:"invokeLifecycleListeners",value:function(e,t,r){this.emit(w.Lifecycle,e,t,r)}},{key:"shiftRight",value:function(e,t,r){for(var n=t;n>r;n--)this.lists[e].isIndexInRange(n)&&(this.lists[e].roomIndexToRoomId[n]=this.lists[e].roomIndexToRoomId[n-1])}},{key:"shiftLeft",value:function(e,t,r){for(var n=r;n<t;n++)this.lists[e].isIndexInRange(n)&&(this.lists[e].roomIndexToRoomId[n]=this.lists[e].roomIndexToRoomId[n+1])}},{key:"removeEntry",value:function(e,t){var r=-1;for(var n in this.lists[e].roomIndexToRoomId)Number(n)>r&&(r=Number(n));r<0||t>r||(this.shiftLeft(e,r,t),delete this.lists[e].roomIndexToRoomId[r])}},{key:"addEntry",value:function(e,t){var r=-1;for(var n in this.lists[e].roomIndexToRoomId)Number(n)>r&&(r=Number(n));r<0||t>r||this.shiftRight(e,r+1,t)}},{key:"processListOps",value:function(e,t){var r=this,n=-1;e.ops.forEach((function(e){switch(e.op){case"DELETE":f.logger.debug("DELETE",t,e.index,";"),delete r.lists[t].roomIndexToRoomId[e.index],-1!==n&&r.removeEntry(t,n),n=e.index;break;case"INSERT":f.logger.debug("INSERT",t,e.index,e.room_id,";"),r.lists[t].roomIndexToRoomId[e.index]&&(n<0?r.addEntry(t,e.index):n>e.index?r.shiftRight(t,n,e.index):n<e.index&&r.shiftLeft(t,e.index,n)),n=-1,r.lists[t].roomIndexToRoomId[e.index]=e.room_id;break;case"INVALIDATE":for(var i=e.range[0];i<=e.range[1];i++)delete r.lists[t].roomIndexToRoomId[i];f.logger.debug("INVALIDATE",t,e.range[0],e.range[1],";");break;case"SYNC":for(var o=e.range[0],a=o;a<=e.range[1];a++){var s=e.room_ids[a-o];if(!s)break;r.lists[t].roomIndexToRoomId[a]=s}f.logger.debug("SYNC",t,e.range[0],e.range[1],(e.room_ids||[]).join(" "),";")}})),-1!==n&&this.removeEntry(t,n)}},{key:"resend",value:function(){var e;if(this.needsResend&&this.txnIdDefers.length>0)return this.txnIdDefers[this.txnIdDefers.length-1].promise;this.needsResend=!0,this.txnId=this.client.makeTxnId();var t=(0,p.defer)();return this.txnIdDefers.push(g(g({},t),{},{txnId:this.txnId})),null===(e=this.abortController)||void 0===e||e.abort(),this.abortController=new AbortController,t.promise}},{key:"resolveTransactionDefers",value:function(e){if(e){for(var t=-1,r=0;r<this.txnIdDefers.length;r++)if(this.txnIdDefers[r].txnId===e){t=r;break}if(-1!==t){for(var n=0;n<t;n++)this.txnIdDefers[n].reject(this.txnIdDefers[n].txnId);this.txnIdDefers[t].resolve(e),this.txnIdDefers=this.txnIdDefers.slice(t+1)}else f.logger.warn("resolveTransactionDefers: seen ".concat(e," but it isn't a pending txn, ignoring."))}}},{key:"stop",value:function(){var e;this.terminated=!0,null===(e=this.abortController)||void 0===e||e.abort(),this.removeAllListeners(w.Lifecycle),this.removeAllListeners(w.List),this.removeAllListeners(w.RoomData)}},{key:"resetup",value:function(){var e;f.logger.warn("SlidingSync: resetting connection info"),this.txnIdDefers.forEach((function(e){e.reject(e.txnId)})),this.txnIdDefers=[],this.lists.forEach((function(e){e.setModified(!0)})),this.confirmedRoomSubscriptions=new Set,this.needsResend=!0,null===(e=this.abortController)||void 0===e||e.abort(),this.abortController=new AbortController}},{key:"start",value:function(){var e=this;return(0,i.default)((function(){var t,r,n,i,o,a,s,u,c,d,h,v,g,y,b,_,S,E,k,C,I,T,R,x,O,A,D,P,L;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:e.abortController=new AbortController,l.label=1;case 1:if(e.terminated)return[3,11];e.needsResend=!1,r=!1,l.label=2;case 2:if(l.trys.push([2,4,,10]),i=e.listModifiedCount,o={lists:e.lists.map((function(e){return e.getList(!1)})),pos:t,timeout:e.timeoutMS,clientTimeout:e.timeoutMS+1e4,extensions:e.getExtensionRequest(void 0===t)},a=M(e.desiredRoomSubscriptions,e.confirmedRoomSubscriptions),(s=M(e.confirmedRoomSubscriptions,e.desiredRoomSubscriptions)).size>0&&(o.unsubscribe_rooms=Array.from(s)),a.size>0){o.room_subscriptions={},u=!0,c=!1,d=void 0;try{for(h=a[Symbol.iterator]();!(u=(v=h.next()).done);u=!0)g=v.value,y=e.roomIdToCustomSubscription.get(g),b=e.roomSubscriptionInfo,y&&e.customSubscriptions.has(y)&&(b=e.customSubscriptions.get(y)),o.room_subscriptions[g]=b}catch(e){c=!0,d=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw d}}}return e.txnId&&(o.txn_id=e.txnId,e.txnId=null),e.pendingReq=e.client.slidingSync(o,e.proxyBaseUrl,e.abortController.signal),[4,e.pendingReq];case 3:n=l.sent(),t=n.pos,_=!0,S=!1,E=void 0;try{for(k=a[Symbol.iterator]();!(_=(C=k.next()).done);_=!0)I=C.value,e.confirmedRoomSubscriptions.add(I)}catch(e){S=!0,E=e}finally{try{_||null==k.return||k.return()}finally{if(S)throw E}}T=!0,R=!1,x=void 0;try{for(O=s[Symbol.iterator]();!(T=(A=O.next()).done);T=!0)D=A.value,e.confirmedRoomSubscriptions.delete(D)}catch(e){R=!0,x=e}finally{try{T||null==O.return||O.return()}finally{if(R)throw x}}return i!==e.listModifiedCount&&(f.logger.debug("list modified during await call, not updating list"),r=!0),e.lists.forEach((function(e){e.setModified(!1)})),n.lists=n.lists||[],n.rooms=n.rooms||{},n.extensions=n.extensions||{},n.lists.forEach((function(t,r){e.lists[r].joinedCount=t.count})),e.invokeLifecycleListeners(m.RequestFinished,n),[3,10];case 4:return(P=l.sent()).httpStatus?(e.invokeLifecycleListeners(m.RequestFinished,null,P),400!==P.httpStatus?[3,6]:(e.resetup(),t=void 0,[4,(0,p.sleep)(50)])):[3,7];case 5:return l.sent(),[3,1];case 6:return[3,8];case 7:if(e.needsResend||"AbortError"===P.name)return[3,1];l.label=8;case 8:return f.logger.error(P),[4,(0,p.sleep)(5e3)];case 9:return l.sent(),[3,10];case 10:return n?(e.onPreExtensionsResponse(n.extensions),Object.keys(n.rooms).forEach((function(t){e.invokeRoomDataListeners(t,n.rooms[t])})),L=new Set,r||n.lists.forEach((function(t,r){t.ops=t.ops||[],t.ops.length>0&&L.add(r),e.processListOps(t,r)})),e.invokeLifecycleListeners(m.Complete,n),e.onPostExtensionsResponse(n.extensions),L.forEach((function(t){e.emit(w.List,t,e.lists[t].joinedCount,Object.assign({},e.lists[t].roomIndexToRoomId))})),e.resolveTransactionDefers(n.txn_id),[3,1]):[3,1];case 11:return[2]}}))}))()}}]),n}(h.TypedEventEmitter);e.exports.SlidingSync=k;var M=function(e,t){var r=new Set(e),n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r.delete(u)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}})),n.register("lB6qO",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_BEACON_INFO=e.exports.M_BEACON=void 0;var r=n("kLCn9"),i=new r.UnstableValue("m.beacon_info","org.matrix.msc3672.beacon_info");e.exports.M_BEACON_INFO=i;var o=new r.UnstableValue("m.beacon","org.matrix.msc3672.beacon");e.exports.M_BEACON=o})),n.register("8mfsd",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ToDeviceMessageQueue=void 0;var u=s(n("3rHpI")),l=n("8bPbt"),c=n("jtqeE"),d=n("4uAg3"),f=n("2Xhao"),h=n("kk8uI"),p=function(){function e(t){var n=this;(0,i.default)(this,e),this.client=t,(0,u.default)(this,"sending",!1),(0,u.default)(this,"running",!0),(0,u.default)(this,"retryTimeout",null),(0,u.default)(this,"retryAttempts",0);var o=this;(0,u.default)(this,"sendQueue",(0,r.default)((function(){var e,t,r;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:if(null!==o.retryTimeout&&clearTimeout(o.retryTimeout),o.retryTimeout=null,o.sending||!o.running)return[2];c.logger.debug("Attempting to send queued to-device messages"),o.sending=!0,n.label=1;case 1:return n.trys.push([1,6,11,12]),o.running?[4,o.client.store.getOldestToDeviceBatch()]:[3,5];case 2:return null===(e=n.sent())?[3,5]:[4,o.sendBatch(e)];case 3:return n.sent(),[4,o.client.store.removeToDeviceBatch(e.id)];case 4:return n.sent(),o.retryAttempts=0,[3,1];case 5:return o.running?(c.logger.debug("All queued to-device messages sent"),[3,12]):[2];case 6:return t=n.sent(),++o.retryAttempts,-1!==(r=f.MatrixScheduler.RETRY_BACKOFF_RATELIMIT(null,o.retryAttempts,t))?[3,10]:4!==Math.floor(t.httpStatus/100)?[3,8]:(c.logger.error("Fatal error when sending to-device message - dropping to-device batch!",t),[4,o.client.store.removeToDeviceBatch(e.id)]);case 7:return n.sent(),[3,9];case 8:c.logger.info("Automatic retry limit reached for to-device messages."),n.label=9;case 9:return[2];case 10:return c.logger.info("Failed to send batch of to-device messages. Will retry in ".concat(r,"ms"),t),o.retryTimeout=setTimeout(o.sendQueue,r),[3,12];case 11:return o.sending=!1,[7];case 12:return[2]}}))}))),(0,u.default)(this,"onResumedSync",(function(e,t){e===h.SyncState.Syncing&&t!==h.SyncState.Syncing&&(c.logger.info("Resuming queue after resumed sync"),n.sendQueue())}))}return(0,o.default)(e,[{key:"start",value:function(){this.running=!0,this.sendQueue(),this.client.on(d.ClientEvent.Sync,this.onResumedSync)}},{key:"stop",value:function(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(d.ClientEvent.Sync,this.onResumedSync)}},{key:"queueBatch",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:for(r=[],n=0;n<e.batch.length;n+=20)i={eventType:e.eventType,batch:e.batch.slice(n,n+20),txnId:t.client.makeTxnId()},r.push(i),o=i.batch.map((function(e){return"".concat(e.userId,"/").concat(e.deviceId," (msgid ").concat(e.payload[l.ToDeviceMessageId],")")})),c.logger.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(i.txnId),o);return[4,t.client.store.saveToDeviceBatches(r)];case 1:return a.sent(),t.sendQueue(),[2]}}))}))()}},{key:"sendBatch",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,u,l;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:r={},n=!0,i=!1,o=void 0;try{for(s=e.batch[Symbol.iterator]();!(n=(u=s.next()).done);n=!0)l=u.value,r[l.userId]||(r[l.userId]={}),r[l.userId][l.deviceId]=l.payload}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return c.logger.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),[4,t.client.sendToDevice(e.eventType,r,e.txnId)];case 1:return a.sent(),[2]}}))}))()}}]),e}();e.exports.ToDeviceMessageQueue=p})),n.register("2Xhao",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=(n("9oGi2"),n("fyjrC"));Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixScheduler=void 0;var a=o(n("3rHpI")),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(n("e8gas")),u=(n("jtqeE"),n("8bPbt")),l=n("6BFg8");function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.RETRY_BACKOFF_RATELIMIT,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.QUEUE_MESSAGES,i=this;(0,r.default)(this,e),this.retryAlgorithm=t,this.queueAlgorithm=n,(0,a.default)(this,"queues",{}),(0,a.default)(this,"activeQueues",[]),(0,a.default)(this,"procFn",null),(0,a.default)(this,"processQueue",(function(e){var t=i.peekNextEvent(e);if(!t){var r=i.activeQueues.indexOf(e);return r>=0&&i.activeQueues.splice(r,1),void f("Stopping queue '%s' as it is now empty",e)}f("Queue '%s' has %s pending events",e,i.queues[e].length),Promise.resolve().then((function(){return i.procFn(t.event)})).then((function(r){i.removeNextEvent(e),f("Queue '%s' sent event %s",e,t.event.getId()),t.defer.resolve(r),i.processQueue(e)}),(function(r){t.attempts+=1;var n=i.retryAlgorithm(t.event,t.attempts,r);f("retry(%s) err=%s event_id=%s waitTime=%s",t.attempts,r,t.event.getId(),n),-1===n?(f("Queue '%s' giving up on event %s",e,t.event.getId()),i.removeNextEvent(e),t.defer.reject(r),i.processQueue(e)):setTimeout(i.processQueue,n,e)}))}))}return(0,i.default)(e,[{key:"getQueueForEvent",value:function(e){var t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}},{key:"removeEventFromQueue",value:function(e){var t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;var r=!1;return s.removeElement(this.queues[t],(function(t){return t.event.getId()===e.getId()&&(r=!0,!0)})),r}},{key:"setProcessFunction",value:function(e){this.procFn=e,this.startProcessingQueues()}},{key:"queueEvent",value:function(e){var t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);var r=s.defer();return this.queues[t].push({event:e,defer:r,attempts:0}),f("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),this.startProcessingQueues(),r.promise}},{key:"startProcessingQueues",value:function(){var e=this;this.procFn&&Object.keys(this.queues).filter((function(t){return-1===e.activeQueues.indexOf(t)&&e.queues[t].length>0})).forEach((function(t){e.activeQueues.push(t),f("Spinning up queue: '%s'",t),e.processQueue(t)}))}},{key:"peekNextEvent",value:function(e){var t=this.queues[e];if(Array.isArray(t))return t[0]}},{key:"removeNextEvent",value:function(e){var t=this.queues[e];if(Array.isArray(t))return t.shift()}}],[{key:"RETRY_BACKOFF_RATELIMIT",value:function(e,t,r){if(400===r.httpStatus||403===r.httpStatus||401===r.httpStatus)return-1;if(r instanceof l.ConnectionError)return-1;if("M_TOO_LARGE"===r.name)return-1;if("M_LIMIT_EXCEEDED"===r.name){var n=r.data.retry_after_ms;if(n>0)return n}return t>4?-1:1e3*Math.pow(2,t)}},{key:"QUEUE_MESSAGES",value:function(e){return e.getType()===u.EventType.RoomMessage||e.hasAssociation()?"message":null}}]),e}();function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]}e.exports.MatrixScheduler=d})),n.register("c1Ywa",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PolicyScope=e.exports.POLICIES_ACCOUNT_EVENT_TYPE=e.exports.IgnoredInvites=e.exports.IGNORE_INVITES_ACCOUNT_EVENT_KEY=void 0;var s=n("ghTXl"),u=n("aBvOl"),l=n("7pEi8"),c=n("e8gas"),d=new s.UnstableValue("m.policies","org.matrix.msc3847.policies");e.exports.POLICIES_ACCOUNT_EVENT_TYPE=d;var f,h,p,v=new s.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites");e.exports.IGNORE_INVITES_ACCOUNT_EVENT_KEY=v,(f||(f={})).Ban="m.ban",e.exports.PolicyScope=h,(p=h||(e.exports.PolicyScope=h={})).User="m.policy.user",p.Room="m.policy.room",p.Server="m.policy.server";var g=function(){function e(t){(0,i.default)(this,e),this.client=t}return(0,o.default)(e,[{key:"addRule",value:function(e,t,n){var i=this;return(0,r.default)((function(){var r;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return[4,i.getOrCreateTargetRoom()];case 1:return r=o.sent(),[4,i.client.sendStateEvent(r.roomId,e,{entity:t,reason:n,recommendation:f.Ban})];case 2:return[2,o.sent().event_id]}}))}))()}},{key:"removeRule",value:function(e){var t=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.client.redactEvent(e.getRoomId(),e.getId())];case 1:return r.sent(),[2]}}))}))()}},{key:"addSource",value:function(e){var t=this;return(0,r.default)((function(){var r;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.client.joinRoom(e)];case 1:return n.sent(),[4,t.getOrCreateSourceRooms()];case 2:return(r=n.sent().map((function(e){return e.roomId}))).includes(e)?[2,!1]:(r.push(e),[4,t.withIgnoreInvitesPolicies((function(e){e.sources=r}))]);case 3:return n.sent(),[2,!0]}}))}))()}},{key:"getRuleForInvite",value:function(e){var t=e.sender,n=e.roomId,i=this;return(0,r.default)((function(){var e,r,o,s,l,d,p,v,g,m,y,b,_,w,S,E,k,M,C,I,T,R,x,O,A,D,P,L,U,j,N;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return[4,i.getOrCreateSourceRooms()];case 1:e=a.sent(),r=t.split(":")[1],o=n.split(":")[1],s=!0,l=!1,d=void 0;try{for(p=e[Symbol.iterator]();!(s=(v=p.next()).done);s=!0)for(g=v.value,m=g.getUnfilteredTimelineSet().getLiveTimeline().getState(u.EventTimeline.FORWARDS),y=0,b=[{scope:h.Room,entities:[n]},{scope:h.User,entities:[t]},{scope:h.Server,entities:[r,o]}];y<b.length;y++){w=(_=b[y]).scope,S=_.entities,E=m.getStateEvents(w),k=!0,M=!1,C=void 0;try{for(I=E[Symbol.iterator]();!(k=(T=I.next()).done);k=!0)if(R=T.value,(null==(x=R.getContent())?void 0:x.recommendation)==f.Ban&&(O=null==x?void 0:x.entity)){try{A=new RegExp((0,c.globToRegexp)(O,!1))}catch(e){continue}D=!0,P=!1,L=void 0;try{for(U=S[Symbol.iterator]();!(D=(j=U.next()).done);D=!0)if((N=j.value)&&A.test(N))return[2,R]}catch(e){P=!0,L=e}finally{try{D||null==U.return||U.return()}finally{if(P)throw L}}}}catch(e){M=!0,C=e}finally{try{k||null==I.return||I.return()}finally{if(M)throw C}}}}catch(e){l=!0,d=e}finally{try{s||null==p.return||p.return()}finally{if(l)throw d}}return[2,null]}}))}))()}},{key:"getOrCreateTargetRoom",value:function(){var e=this;return(0,r.default)((function(){var t,r,n;return(0,a.__generator)(this,(function(i){switch(i.label){case 0:if(t=e.getIgnoreInvitesPolicies(),"string"!=typeof(r=t.target)&&(r=null),r){if(n=e.client.getRoom(r))return[2,n];r=null}return[4,e.client.createRoom({name:"Individual Policy Room",preset:l.Preset.PrivateChat})];case 1:return r=i.sent().room_id,[4,e.withIgnoreInvitesPolicies((function(e){e.target=r}))];case 2:return i.sent(),[2,e.client.getRoom(r)]}}))}))()}},{key:"getOrCreateSourceRooms",value:function(){var e=this;return(0,r.default)((function(){var t,r,n,i,o;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return t=e.getIgnoreInvitesPolicies(),r=t.sources,n=!1,Array.isArray(r)||(n=!0,r=[]),(i=r.filter((function(e){return"string"==typeof e})).map((function(t){return e.client.getRoom(t)})).filter((function(e){return!!e}))).length!=r.length&&(n=!0),0!=i.length?[3,2]:[4,e.getOrCreateTargetRoom()];case 1:o=a.sent(),n=!0,i=[o],a.label=2;case 2:return n?[4,e.withIgnoreInvitesPolicies((function(e){e.sources=r}))]:[3,4];case 3:a.sent(),a.label=4;case 4:return[2,i]}}))}))()}},{key:"getIgnoreInvitesPolicies",value:function(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}},{key:"withIgnoreInvitesPolicies",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return r=t.getPoliciesAndIgnoreInvitesPolicies(),n=r.policies,i=r.ignoreInvitesPolicies,e(i),n[v.name]=i,[4,t.client.setAccountData(d.name,n)];case 1:return o.sent(),[2]}}))}))()}},{key:"getPoliciesAndIgnoreInvitesPolicies",value:function(){for(var e={},t=0,r=[d.name,d.altName];t<r.length;t++){var n,i=r[t];if(i){var o=null===(n=this.client.getAccountData(i))||void 0===n?void 0:n.getContent();if(o){e=o;break}}}for(var a={},s=!1,u=0,l=[v.name,v.altName];u<l.length;u++){var c=l[u];if(c){var f=e[c];if(f&&"object"==typeof f){a=f,s=!0;break}}}return s||(e[v.name]=a),{policies:e,ignoreInvitesPolicies:a}}}]),e}();e.exports.IgnoredInvites=g})),n.register("g5Lla",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RUST_SDK_STORE_PREFIX=void 0;e.exports.RUST_SDK_STORE_PREFIX="matrix-js-sdk"})),n.register("kej0e",(function(e,t){e.exports=n("jQ8ld")(n("cw0Ud").getBundleURL("b4xIe")+n("cHPVy").resolve("4SJWe")).then((function(){return n("7ShH8")}))})),n.register("ljahd",(function(e,t){var r=n("Yawv5"),i=n("2aGg7"),o=n("2swew"),a=n("kxanC"),s=n("hWDD9"),u=n("61A8y"),l=n("5gj45"),c=n("cksMj"),d=n("giCK6"),f=n("eQNFO"),h=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomWidgetClient=void 0;var p=h(n("3rHpI")),v=n("fPrcb"),g=n("jEuTn"),m=n("8bPbt"),y=n("jtqeE"),b=n("4uAg3"),_=n("kk8uI"),w=n("9XadD"),S=n("c9Npn"),E=function(e){(0,c.default)(n,e);var t=(0,d.default)(n);function n(e,i,s,u){var l,c,d,h,w,S,E,k,M,C,I;(0,a.default)(this,n),(l=t.call(this,u)).widgetApi=e,l.capabilities=i,l.roomId=s,(0,p.default)((0,r.default)(l),"room",void 0),(0,p.default)((0,r.default)(l),"widgetApiReady",new Promise((function(e){return l.widgetApi.once("ready",e)}))),(0,p.default)((0,r.default)(l),"lifecycle",void 0),(0,p.default)((0,r.default)(l),"syncState",null);var T,R=(0,r.default)(l);(0,p.default)((0,r.default)(l),"onEvent",(T=(0,o.default)((function(e){var t,r,n,i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return e.preventDefault(),e.detail.data.room_id!==R.roomId?[3,2]:(t=new g.MatrixEvent(e.detail.data),[4,R.syncApi.injectRoomEvents(R.room,[],[t])]);case 1:return o.sent(),R.emit(b.ClientEvent.Event,t),R.setSyncState(_.SyncState.Syncing),y.logger.info("Received event ".concat(t.getId()," ").concat(t.getType()," ").concat(t.getStateKey())),[3,3];case 2:r=e.detail.data,n=r.event_id,i=r.room_id,y.logger.info("Received event ".concat(n," for a different room ").concat(i,"; discarding")),o.label=3;case 3:return[4,R.ack(e)];case 4:return o.sent(),[2]}}))})),function(e){return T.apply(this,arguments)}));var x=(0,r.default)(l);return(0,p.default)((0,r.default)(l),"onToDevice",function(){var e=(0,o.default)((function(e){var t;return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return e.preventDefault(),t=new g.MatrixEvent({type:e.detail.data.type,sender:e.detail.data.sender,content:e.detail.data.content}),e.detail.data.encrypted&&t.makeEncrypted(m.EventType.RoomMessageEncrypted,{},"",""),x.emit(b.ClientEvent.ToDeviceEvent,t),x.setSyncState(_.SyncState.Syncing),[4,x.ack(e)];case 1:return r.sent(),[2]}}))}));return function(t){return e.apply(this,arguments)}}()),(null!==(c=i.sendEvent)&&void 0!==c&&c.length||null!==(d=i.receiveEvent)&&void 0!==d&&d.length||!0===i.sendMessage||Array.isArray(i.sendMessage)&&i.sendMessage.length||!0===i.receiveMessage||Array.isArray(i.receiveMessage)&&i.receiveMessage.length||null!==(h=i.sendState)&&void 0!==h&&h.length||null!==(w=i.receiveState)&&void 0!==w&&w.length)&&e.requestCapabilityForRoomTimeline(s),null===(S=i.sendEvent)||void 0===S||S.forEach((function(t){return e.requestCapabilityToSendEvent(t)})),null===(E=i.receiveEvent)||void 0===E||E.forEach((function(t){return e.requestCapabilityToReceiveEvent(t)})),!0===i.sendMessage?e.requestCapabilityToSendMessage():Array.isArray(i.sendMessage)&&i.sendMessage.forEach((function(t){return e.requestCapabilityToSendMessage(t)})),!0===i.receiveMessage?e.requestCapabilityToReceiveMessage():Array.isArray(i.receiveMessage)&&i.receiveMessage.forEach((function(t){return e.requestCapabilityToReceiveMessage(t)})),null===(k=i.sendState)||void 0===k||k.forEach((function(t){var r=t.eventType,n=t.stateKey;return e.requestCapabilityToSendState(r,n)})),null===(M=i.receiveState)||void 0===M||M.forEach((function(t){var r=t.eventType,n=t.stateKey;return e.requestCapabilityToReceiveState(r,n)})),null===(C=i.sendToDevice)||void 0===C||C.forEach((function(t){return e.requestCapabilityToSendToDevice(t)})),null===(I=i.receiveToDevice)||void 0===I||I.forEach((function(t){return e.requestCapabilityToReceiveToDevice(t)})),i.turnServers&&e.requestCapability(v.MatrixCapabilities.MSC3846TurnServers),e.on("action:".concat(v.WidgetApiToWidgetAction.SendEvent),l.onEvent),e.on("action:".concat(v.WidgetApiToWidgetAction.SendToDevice),l.onToDevice),e.start(),l}return(0,s.default)(n,[{key:"startClient",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;return(0,o.default)((function(){var r,n,i;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return t.lifecycle=new AbortController,(i=t.getUserId())&&t.store.storeUser(new S.User(i)),e.slidingSync?t.syncApi=new w.SlidingSyncSdk(e.slidingSync,t,e,t.buildSyncApiOptions()):t.syncApi=new _.SyncApi(t,e,t.buildSyncApiOptions()),t.room=t.syncApi.createRoom(t.roomId),t.store.storeRoom(t.room),[4,t.widgetApiReady];case 1:return a.sent(),[4,Promise.all(null!==(r=null===(n=t.capabilities.receiveState)||void 0===n?void 0:n.map((s=(0,o.default)((function(e){var r,n,i,o;return(0,f.__generator)(this,(function(a){switch(a.label){case 0:return r=e.eventType,n=e.stateKey,[4,t.widgetApi.readStateEvents(r,void 0,n,[t.roomId])];case 1:return i=a.sent(),o=i.map((function(e){return new g.MatrixEvent(e)})),[4,t.syncApi.injectRoomEvents(t.room,[],o)];case 2:return a.sent(),o.forEach((function(e){t.emit(b.ClientEvent.Event,e),y.logger.info("Backfilled event ".concat(e.getId()," ").concat(e.getType()," ").concat(e.getStateKey()))})),[2]}}))})),function(e){return s.apply(this,arguments)})))&&void 0!==r?r:[])];case 2:return a.sent(),t.setSyncState(_.SyncState.Syncing),y.logger.info("Finished backfilling events"),t.capabilities.turnServers&&t.watchTurnServers(),[2]}var s}))}))()}},{key:"stopClient",value:function(){this.widgetApi.off("action:".concat(v.WidgetApiToWidgetAction.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(v.WidgetApiToWidgetAction.SendToDevice),this.onToDevice),(0,u.default)((0,l.default)(n.prototype),"stopClient",this).call(this),this.lifecycle.abort()}},{key:"joinRoom",value:function(e){var t=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(r){if(e===t.roomId)return[2,t.room];throw new Error("Unknown room: ".concat(e))}))}))()}},{key:"encryptAndSendEvent",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i;return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,r.widgetApi.sendRoomEvent(t.getType(),t.getContent(),e.roomId)];case 1:return n=o.sent(),[3,3];case 2:throw i=o.sent(),r.updatePendingEventStatus(e,t,g.EventStatus.NOT_SENT),i;case 3:return e.updatePendingEvent(t,g.EventStatus.SENT,n.event_id),[2,{event_id:n.event_id}]}}))}))()}},{key:"sendStateEvent",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(o){switch(o.label){case 0:return[4,i.widgetApi.sendStateEvent(t,n,r,e)];case 1:return[2,o.sent()]}}))}))()}},{key:"sendToDevice",value:function(e,t){var r=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(n){switch(n.label){case 0:return[4,r.widgetApi.sendToDevice(e,!1,t)];case 1:return n.sent(),[2,{}]}}))}))()}},{key:"queueToDevice",value:function(e){var t=e.eventType,r=e.batch,n=this;return(0,o.default)((function(){var e,i,o,a,s,u,l,c,d,h;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:e={},i=!0,o=!1,a=void 0;try{for(s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)l=u.value,c=l.userId,d=l.deviceId,h=l.payload,e[c]||(e[c]={}),e[c][d]=h}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return[4,n.widgetApi.sendToDevice(t,!1,e)];case 1:return f.sent(),[2]}}))}))()}},{key:"encryptAndSendToDevices",value:function(e,t){var r=this;return(0,o.default)((function(){var n,i,o,a,s,u,l,c,d;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:n={},i=!0,o=!1,a=void 0;try{for(s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)l=u.value,c=l.userId,d=l.deviceInfo.deviceId,n[c]||(n[c]={}),n[c][d]=t}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return[4,r.widgetApi.sendToDevice(t.type,!0,n)];case 1:return f.sent(),[2]}}))}))()}},{key:"checkTurnServers",value:function(){var e=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(t){return[2,e.turnServers.length>0]}))}))()}},{key:"getSyncState",value:function(){return this.syncState}},{key:"setSyncState",value:function(e){var t=this.syncState;this.syncState=e,this.emit(b.ClientEvent.Sync,e,t)}},{key:"ack",value:function(e){var t=this;return(0,o.default)((function(){return(0,f.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.widgetApi.transport.reply(e.detail,{})];case 1:return r.sent(),[2]}}))}))()}},{key:"watchTurnServers",value:function(){var e=this;return(0,o.default)((function(){var t,r,n,o,a,s,u,l,c,d,h;return(0,f.__generator)(this,(function(f){switch(f.label){case 0:t=e.widgetApi.getTurnServers(),r=function(){t.return(void 0)},e.lifecycle.signal.addEventListener("abort",r),f.label=1;case 1:f.trys.push([1,14,15,16]),n=!1,o=!1,f.label=2;case 2:f.trys.push([2,7,8,13]),s=(0,i.default)(t),f.label=3;case 3:return[4,s.next()];case 4:if(!(n=!(u=f.sent()).done))return[3,6];l=u.value,c=l,e.turnServers=[{urls:c.uris,username:c.username,credential:c.password}],e.emit(b.ClientEvent.TurnServers,e.turnServers),y.logger.log("Received TURN server: ".concat(c.uris)),f.label=5;case 5:return n=!1,[3,3];case 6:return[3,13];case 7:return d=f.sent(),o=!0,a=d,[3,13];case 8:return f.trys.push([8,,11,12]),n&&null!=s.return?[4,s.return()]:[3,10];case 9:f.sent(),f.label=10;case 10:return[3,12];case 11:if(o)throw a;return[7];case 12:return[7];case 13:return[3,16];case 14:return h=f.sent(),y.logger.warn("Error watching TURN servers",h),[3,16];case 15:return e.lifecycle.signal.removeEventListener("abort",r),[7];case 16:return[2]}}))}))()}}]),n}(b.MatrixClient);e.exports.RoomWidgetClient=E})),n.register("2aGg7",(function(t,r){function n(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new i(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function i(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return i=function(e){this.s=e,this.n=e.next},i.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new i(e)}e(t.exports,"default",(function(){return n}))})),n.register("fPrcb",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0});var r=n("3aLxy");Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===r[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return r[t]}}))}));var i=n("jnHoT");Object.keys(i).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===i[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return i[t]}}))}));var o=n("5lKz1");Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))}));var a=n("f5jVw");Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))}));var s=n("gys9S");Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===s[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return s[t]}}))}));var u=n("k99ZZ");Object.keys(u).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===u[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return u[t]}}))}));var l=n("b4oUV");Object.keys(l).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===l[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return l[t]}}))}));var c=n("jv5rZ");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var d=n("hALAI");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=n("5qn0G");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var h=n("76aL8");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var p=n("adU44");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var v=n("lDPgo");Object.keys(v).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===v[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return v[t]}}))}));var g=n("kKOGf");Object.keys(g).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===g[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return g[t]}}))}));var m=n("3ql3J");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var y=n("fETbp");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=n("29dqY");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var _=n("hz9cm");Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var w=n("c6dT6");Object.keys(w).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===w[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return w[t]}}))}));var S=n("kC51z");Object.keys(S).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===S[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return S[t]}}))}));var E=n("3x0Mf");Object.keys(E).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===E[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return E[t]}}))}));var k=n("1Whqj");Object.keys(k).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===k[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return k[t]}}))}));var M=n("eKwhr");Object.keys(M).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===M[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return M[t]}}))}));var C=n("7ON16");Object.keys(C).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===C[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return C[t]}}))}));var I=n("kt6yq");Object.keys(I).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===I[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return I[t]}}))}));var T=n("inbos");Object.keys(T).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===T[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return T[t]}}))}));var R=n("lO3yL");Object.keys(R).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===R[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return R[t]}}))}));var x=n("8PUDU");Object.keys(x).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===x[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return x[t]}}))}));var O=n("kNy5v");Object.keys(O).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===O[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return O[t]}}))}));var A=n("gODZk");Object.keys(A).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===A[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return A[t]}}))}));var D=n("joHSD");Object.keys(D).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===D[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return D[t]}}))}));var P=n("kW9OL");Object.keys(P).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===P[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return P[t]}}))}));var L=n("bmoDv");Object.keys(L).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===L[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return L[t]}}))}));var U=n("hAczz");Object.keys(U).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===U[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return U[t]}}))}));var j=n("kqv20");Object.keys(j).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===j[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return j[t]}}))}));var N=n("fqIhL");Object.keys(N).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===N[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return N[t]}}))}));var B=n("k28QS");Object.keys(B).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===B[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return B[t]}}))}));var F=n("5iozb");Object.keys(F).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===F[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return F[t]}}))}));var K=n("cRgOy");Object.keys(K).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===K[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return K[t]}}))}));var q=n("l6Leu");Object.keys(q).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===q[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return q[t]}}))}));var W=n("8E77W");Object.keys(W).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===W[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return W[t]}}))}));var V=n("jwHr5");Object.keys(V).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===V[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return V[t]}}))}));var H=n("3nrGw");Object.keys(H).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===H[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return H[t]}}))}));var G=n("kvGdc");Object.keys(G).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===G[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return G[t]}}))}));var z=n("lChfR");Object.keys(z).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===z[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return z[t]}}))}));var Y=n("fNzhX");Object.keys(Y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===Y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return Y[t]}}))}))})),n.register("3aLxy",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetApi=void 0;var i=n("guIx5"),o=n("3ql3J"),a=n("fETbp"),s=n("gys9S"),u=n("kKOGf"),l=n("kt6yq"),c=n("5qn0G"),d=n("kNy5v"),f=n("cRgOy"),h=n("5lKz1");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
p=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new M(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return I()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function f(){}function h(){}function v(){}var g={};u(g,o,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==t&&n.call(y,o)&&(g=y);var b=v.prototype=f.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function i(o,a,s,u){var l=c(e[o],e,a);if("throw"!==l.type){var d=l.arg,f=d.value;return f&&"object"==r(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){i("next",e,s,u)}),(function(e){i("throw",e,s,u)})):t.resolve(f).then((function(e){d.value=e,s(d)}),(function(e){return i("throw",e,s,u)}))}u(l.arg)}var o;this._invoke=function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return o=o?o.then(n,n):n()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=v,u(b,"constructor",v),u(v,"constructor",h),h.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},_(w.prototype),u(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new w(l(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(b),u(b,s,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function v(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){v(o,n,i,a,s,"next",e)}function s(e){v(o,n,i,a,s,"throw",e)}a(void 0)}))}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=E(e);if(t){var i=E(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return w(this,r)}}function w(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M(e){return new I(e)}function C(e){var t,r;function n(t,r){try{var o=e[t](r),a=o.value,s=a instanceof I;Promise.resolve(s?a.wrapped:a).then((function(e){s?n("return"===t?"return":"next",e):i(o.done?"return":"normal",e)}),(function(e){n("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,i){return new Promise((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};r?r=r.next=s:(t=r=s,n(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function I(e){this.wrapped=e}C.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},C.prototype.next=function(e){return this._invoke("next",e)},C.prototype.throw=function(e){return this._invoke("throw",e)},C.prototype.return=function(e){return this._invoke("return",e)};var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(w,e);var t,r,n,i,v=_(w);function w(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(m(this,w),(e=v.call(this)).clientOrigin=r,k(S(e),"transport",void 0),k(S(e),"capabilitiesFinished",!1),k(S(e),"supportsMSC2974Renegotiate",!1),k(S(e),"requestedCapabilities",[]),k(S(e),"approvedCapabilities",void 0),k(S(e),"cachedClientVersions",void 0),k(S(e),"turnServerWatchers",0),!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");return e.transport=new s.PostmessageTransport(o.WidgetApiDirection.FromWidget,t,window.parent,window),e.transport.targetOrigin=r,e.transport.on("message",e.handleMessage.bind(S(e))),e}return t=w,r=[{key:"hasCapability",value:function(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}},{key:"requestCapability",value:function(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}},{key:"requestCapabilities",value:function(e){var t=this;e.forEach((function(e){return t.requestCapability(e)}))}},{key:"requestCapabilityForRoomTimeline",value:function(e){this.requestCapability("org.matrix.msc2762.timeline:".concat(e))}},{key:"requestCapabilityToSendState",value:function(e,t){this.requestCapability(f.WidgetEventCapability.forStateEvent(f.EventDirection.Send,e,t).raw)}},{key:"requestCapabilityToReceiveState",value:function(e,t){this.requestCapability(f.WidgetEventCapability.forStateEvent(f.EventDirection.Receive,e,t).raw)}},{key:"requestCapabilityToSendToDevice",value:function(e){this.requestCapability(f.WidgetEventCapability.forToDeviceEvent(f.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveToDevice",value:function(e){this.requestCapability(f.WidgetEventCapability.forToDeviceEvent(f.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToSendEvent",value:function(e){this.requestCapability(f.WidgetEventCapability.forRoomEvent(f.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveEvent",value:function(e){this.requestCapability(f.WidgetEventCapability.forRoomEvent(f.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToSendMessage",value:function(e){this.requestCapability(f.WidgetEventCapability.forRoomMessageEvent(f.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveMessage",value:function(e){this.requestCapability(f.WidgetEventCapability.forRoomMessageEvent(f.EventDirection.Receive,e).raw)}},{key:"requestOpenIDConnectToken",value:function(){var e=this;return new Promise((function(t,r){e.transport.sendComplete(u.WidgetApiFromWidgetAction.GetOpenIDCredentials,{}).then((function(n){var i=n.response;i.state===l.OpenIDRequestState.Allowed?t(i):i.state===l.OpenIDRequestState.Blocked?r(new Error("User declined to verify their identity")):i.state===l.OpenIDRequestState.PendingUserConfirmation?e.on("action:".concat(u.WidgetApiToWidgetAction.OpenIDCredentials),(function o(a){a.preventDefault();var s=a.detail;s.data.original_request_id===n.requestId&&(s.data.state===l.OpenIDRequestState.Allowed?(t(s.data),e.transport.reply(s,{})):s.data.state===l.OpenIDRequestState.Blocked?(r(new Error("User declined to verify their identity")),e.transport.reply(s,{})):(r(new Error("Invalid state on reply: "+i.state)),e.transport.reply(s,{error:{message:"Invalid state"}})),e.off("action:".concat(u.WidgetApiToWidgetAction.OpenIDCredentials),o))})):r(new Error("Invalid state: "+i.state))})).catch(r)}))}},{key:"updateRequestedCapabilities",value:function(){return this.transport.send(u.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}},{key:"sendContentLoaded",value:function(){return this.transport.send(u.WidgetApiFromWidgetAction.ContentLoaded,{}).then()}},{key:"sendSticker",value:function(e){return this.transport.send(u.WidgetApiFromWidgetAction.SendSticker,e).then()}},{key:"setAlwaysOnScreen",value:function(e){return this.transport.send(u.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen,{value:e}).then((function(e){return e.success}))}},{key:"openModalWidget",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c.MatrixWidgetType.Custom;return this.transport.send(u.WidgetApiFromWidgetAction.OpenModalWidget,{type:i,url:e,name:t,buttons:r,data:n}).then()}},{key:"closeModalWidget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.transport.send(u.WidgetApiFromWidgetAction.CloseModalWidget,e).then()}},{key:"sendRoomEvent",value:function(e,t,r){return this.transport.send(u.WidgetApiFromWidgetAction.SendEvent,{type:e,content:t,room_id:r})}},{key:"sendStateEvent",value:function(e,t,r,n){return this.transport.send(u.WidgetApiFromWidgetAction.SendEvent,{type:e,content:r,state_key:t,room_id:n})}},{key:"sendToDevice",value:function(e,t,r){return this.transport.send(u.WidgetApiFromWidgetAction.SendToDevice,{type:e,encrypted:t,messages:r})}},{key:"readRoomEvents",value:function(e,t,r,n){var i={type:e,msgtype:r};return void 0!==t&&(i.limit=t),n&&(n.includes(h.Symbols.AnyRoom)?i.room_ids=h.Symbols.AnyRoom:i.room_ids=n),this.transport.send(u.WidgetApiFromWidgetAction.MSC2876ReadEvents,i).then((function(e){return e.events}))}},{key:"readEventRelations",value:(i=g(p().mark((function e(t,r,n,i,o,s,l,c){var d;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(a.UnstableApiVersion.MSC3869)){e.next=5;break}throw new Error("The read_relations action is not supported by the client.");case 5:return d={event_id:t,rel_type:n,event_type:i,room_id:r,to:l,from:s,limit:o,direction:c},e.abrupt("return",this.transport.send(u.WidgetApiFromWidgetAction.MSC3869ReadRelations,d));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,o,a,s,u){return i.apply(this,arguments)})},{key:"readStateEvents",value:function(e,t,r,n){var i={type:e,state_key:void 0===r||r};return void 0!==t&&(i.limit=t),n&&(n.includes(h.Symbols.AnyRoom)?i.room_ids=h.Symbols.AnyRoom:i.room_ids=n),this.transport.send(u.WidgetApiFromWidgetAction.MSC2876ReadEvents,i).then((function(e){return e.events}))}},{key:"setModalButtonEnabled",value:function(e,t){if(e===d.BuiltInModalButtonID.Close)throw new Error("The close button cannot be disabled");return this.transport.send(u.WidgetApiFromWidgetAction.SetModalButtonEnabled,{button:e,enabled:t}).then()}},{key:"navigateTo",value:function(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(u.WidgetApiFromWidgetAction.MSC2931Navigate,{uri:e}).then()}},{key:"getTurnServers",value:function(){var e,t=this;return(e=p().mark((function e(){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(){var e=g(p().mark((function e(n){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r(n.detail.data),e.next=4,t.transport.reply(n.detail,{});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.on("action:".concat(u.WidgetApiToWidgetAction.UpdateTurnServers),n),0!==t.turnServerWatchers){e.next=12;break}return e.prev=3,e.next=6,M(t.transport.send(u.WidgetApiFromWidgetAction.WatchTurnServers,{}));case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),t.off("action:".concat(u.WidgetApiToWidgetAction.UpdateTurnServers),n),e.t0;case 12:t.turnServerWatchers++,e.prev=13;case 14:return e.next=17,M(new Promise((function(e){return r=e})));case 17:return e.next=19,e.sent;case 19:e.next=14;break;case 21:if(e.prev=21,t.off("action:".concat(u.WidgetApiToWidgetAction.UpdateTurnServers),n),t.turnServerWatchers--,0!==t.turnServerWatchers){e.next=27;break}return e.next=27,M(t.transport.send(u.WidgetApiFromWidgetAction.UnwatchTurnServers,{}));case 27:return e.finish(21);case 28:case"end":return e.stop()}}),e,null,[[3,8],[13,,21,28]])})),function(){return new C(e.apply(this,arguments))})()}},{key:"start",value:function(){var e=this;this.transport.start(),this.getClientVersions().then((function(t){t.includes(a.UnstableApiVersion.MSC2974)&&(e.supportsMSC2974Renegotiate=!0)}))}},{key:"handleMessage",value:function(e){var t=new CustomEvent("action:".concat(e.detail.action),{detail:e.detail,cancelable:!0});if(this.emit("action:".concat(e.detail.action),t),!t.defaultPrevented)switch(e.detail.action){case u.WidgetApiToWidgetAction.SupportedApiVersions:return this.replyVersions(e.detail);case u.WidgetApiToWidgetAction.Capabilities:return this.handleCapabilities(e.detail);case u.WidgetApiToWidgetAction.UpdateVisibility:case u.WidgetApiToWidgetAction.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}},{key:"replyVersions",value:function(e){this.transport.reply(e,{supported_versions:a.CurrentApiVersions})}},{key:"getClientVersions",value:function(){var e=this;return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(u.WidgetApiFromWidgetAction.SupportedApiVersions,{}).then((function(t){return e.cachedClientVersions=t.supported_versions,t.supported_versions})).catch((function(e){return console.warn("non-fatal error getting supported client versions: ",e),[]}))}},{key:"handleCapabilities",value:function(e){var t=this;return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then((function(r){return r.includes(a.UnstableApiVersion.MSC2871)?t.once("action:".concat(u.WidgetApiToWidgetAction.NotifyCapabilities),(function(e){t.approvedCapabilities=e.detail.data.approved,t.emit("ready")})):t.emit("ready"),t.capabilitiesFinished=!0,t.transport.reply(e,{capabilities:t.requestedCapabilities})}))}}],r&&y(t.prototype,r),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),w}(i.EventEmitter);e.exports.WidgetApi=T})),n.register("3ql3J",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetApiDirection=void 0,e.exports.invertedDirection=function(e){if(e===r.ToWidget)return r.FromWidget;if(e===r.FromWidget)return r.ToWidget;throw new Error("Invalid direction")},e.exports.WidgetApiDirection=r,(n=r||(e.exports.WidgetApiDirection=r={})).ToWidget="toWidget",n.FromWidget="fromWidget"})),n.register("fETbp",(function(e,t){"use strict";var r,n,i,o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnstableApiVersion=e.exports.MatrixApiVersion=e.exports.CurrentApiVersions=void 0,e.exports.MatrixApiVersion=r,(n=r||(e.exports.MatrixApiVersion=r={})).Prerelease1="0.0.1",n.Prerelease2="0.0.2",e.exports.UnstableApiVersion=i,(o=i||(e.exports.UnstableApiVersion=i={})).MSC2762="org.matrix.msc2762",o.MSC2871="org.matrix.msc2871",o.MSC2931="org.matrix.msc2931",o.MSC2974="org.matrix.msc2974",o.MSC2876="org.matrix.msc2876",o.MSC3819="org.matrix.msc3819",o.MSC3846="town.robin.msc3846",o.MSC3869="org.matrix.msc3869";var a=[r.Prerelease1,r.Prerelease2,i.MSC2762,i.MSC2871,i.MSC2931,i.MSC2974,i.MSC2876,i.MSC3819,i.MSC3846,i.MSC3869];e.exports.CurrentApiVersions=a})),n.register("gys9S",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PostmessageTransport=void 0;var i=n("guIx5"),o=n("fPrcb");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=h(e);if(t){var i=h(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d(this,r)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(a,e);var t,r,n,i=c(a);function a(e,t,r,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this)).sendDirection=e,o.initialWidgetId=t,o.transportWindow=r,o.inboundWindow=n,p(f(o),"strictOriginCheck",void 0),p(f(o),"targetOrigin",void 0),p(f(o),"timeoutSeconds",10),p(f(o),"_ready",!1),p(f(o),"_widgetId",null),p(f(o),"outboundRequests",new Map),p(f(o),"stopController",new AbortController),o._widgetId=t,o}return t=a,(r=[{key:"ready",get:function(){return this._ready}},{key:"widgetId",get:function(){return this._widgetId||null}},{key:"nextRequestId",get:function(){for(var e="widgetapi-".concat(Date.now()),t=0,r=e;this.outboundRequests.has(r);)r="".concat(e,"-").concat(t++);return this.outboundRequests.set(r,null),r}},{key:"sendInternal",value:function(e){var t=this.targetOrigin||"*";console.log("[PostmessageTransport] Sending object to ".concat(t,": "),e),this.transportWindow.postMessage(e,t)}},{key:"reply",value:function(e,t){return this.sendInternal(s(s({},e),{},{response:t}))}},{key:"send",value:function(e,t){return this.sendComplete(e,t).then((function(e){return e.response}))}},{key:"sendComplete",value:function(e,t){var r=this;if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));var n={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:t};return e===o.WidgetApiToWidgetAction.UpdateVisibility&&(n.visible=t.visible),new Promise((function(e,t){var i=function(e){s(),t(e)},o=setTimeout((function(){return i(new Error("Request timed out"))}),1e3*(r.timeoutSeconds||1)),a=function(){return i(new Error("Transport stopped"))};r.stopController.signal.addEventListener("abort",a);var s=function(){r.outboundRequests.delete(n.requestId),clearTimeout(o),r.stopController.signal.removeEventListener("abort",a)};r.outboundRequests.set(n.requestId,{request:n,resolve:function(t){s(),e(t)},reject:i}),r.sendInternal(n)}))}},{key:"start",value:function(){var e=this;this.inboundWindow.addEventListener("message",(function(t){e.handleMessage(t)})),this._ready=!0}},{key:"stop",value:function(){this._ready=!1,this.stopController.abort()}},{key:"handleMessage",value:function(e){if(!this.stopController.signal.aborted&&e.data&&(!this.strictOriginCheck||e.origin===window.origin)){var t=e.data;if(t.action&&t.requestId&&t.widgetId)if(t.response){if(t.api!==this.sendDirection)return;this.handleResponse(t)}else{var r=t;if(r.api!==(0,o.invertedDirection)(this.sendDirection))return;this.handleRequest(r)}}}},{key:"handleRequest",value:function(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}},{key:"handleResponse",value:function(e){if(e.widgetId===this.widgetId){var t=this.outboundRequests.get(e.requestId);if(t)if((0,o.isErrorResponse)(e.response)){var r=e.response;t.reject(new Error(r.error.message))}else t.resolve(e)}}}])&&u(t.prototype,r),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(i.EventEmitter);e.exports.PostmessageTransport=v})),n.register("kKOGf",(function(e,t){"use strict";var r,n,i,o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetApiToWidgetAction=e.exports.WidgetApiFromWidgetAction=void 0,e.exports.WidgetApiToWidgetAction=r,(n=r||(e.exports.WidgetApiToWidgetAction=r={})).SupportedApiVersions="supported_api_versions",n.Capabilities="capabilities",n.NotifyCapabilities="notify_capabilities",n.TakeScreenshot="screenshot",n.UpdateVisibility="visibility",n.OpenIDCredentials="openid_credentials",n.WidgetConfig="widget_config",n.CloseModalWidget="close_modal",n.ButtonClicked="button_clicked",n.SendEvent="send_event",n.SendToDevice="send_to_device",n.UpdateTurnServers="update_turn_servers",e.exports.WidgetApiFromWidgetAction=i,(o=i||(e.exports.WidgetApiFromWidgetAction=i={})).SupportedApiVersions="supported_api_versions",o.ContentLoaded="content_loaded",o.SendSticker="m.sticker",o.UpdateAlwaysOnScreen="set_always_on_screen",o.GetOpenIDCredentials="get_openid",o.CloseModalWidget="close_modal",o.OpenModalWidget="open_modal",o.SetModalButtonEnabled="set_button_enabled",o.SendEvent="send_event",o.SendToDevice="send_to_device",o.WatchTurnServers="watch_turn_servers",o.UnwatchTurnServers="unwatch_turn_servers",o.MSC2876ReadEvents="org.matrix.msc2876.read_events",o.MSC2931Navigate="org.matrix.msc2931.navigate",o.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",o.MSC3869ReadRelations="org.matrix.msc3869.read_relations"})),n.register("kt6yq",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.OpenIDRequestState=void 0,e.exports.OpenIDRequestState=r,(n=r||(e.exports.OpenIDRequestState=r={})).Allowed="allowed",n.Blocked="blocked",n.PendingUserConfirmation="request"})),n.register("5qn0G",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixWidgetType=void 0,e.exports.MatrixWidgetType=r,(n=r||(e.exports.MatrixWidgetType=r={})).Custom="m.custom",n.JitsiMeet="m.jitsi",n.Stickerpicker="m.stickerpicker"})),n.register("kNy5v",(function(e,t){"use strict";var r;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.BuiltInModalButtonID=void 0,e.exports.BuiltInModalButtonID=r,(r||(e.exports.BuiltInModalButtonID=r={})).Close="m.close"})),n.register("cRgOy",(function(e,t){"use strict";function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a,s,u;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetEventCapability=e.exports.EventKind=e.exports.EventDirection=void 0,e.exports.EventKind=o,(a=o||(e.exports.EventKind=o={})).Event="event",a.State="state_event",a.ToDevice="to_device",e.exports.EventDirection=s,(u=s||(e.exports.EventDirection=s={})).Send="send",u.Receive="receive";var l=function(){function e(t,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.direction=t,this.eventType=r,this.kind=n,this.keyStr=i,this.raw=o}var t,n,a;return t=e,n=[{key:"matchesAsStateEvent",value:function(e,t,r){return this.kind===o.State&&this.direction===e&&this.eventType===t&&(null===this.keyStr||this.keyStr===r)}},{key:"matchesAsToDeviceEvent",value:function(e,t){return this.kind===o.ToDevice&&this.direction===e&&this.eventType===t}},{key:"matchesAsRoomEvent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.kind===o.Event&&this.direction===e&&this.eventType===t&&("m.room.message"!==this.eventType||null===this.keyStr||this.keyStr===r)}}],a=[{key:"forStateEvent",value:function(t,r,n){r=r.replace(/#/g,"\\#"),n=null!=n?"#".concat(n):"";var i="org.matrix.msc2762.".concat(t,".state_event:").concat(r).concat(n);return e.findEventCapabilities([i])[0]}},{key:"forToDeviceEvent",value:function(t,r){var n="org.matrix.msc3819.".concat(t,".to_device:").concat(r);return e.findEventCapabilities([n])[0]}},{key:"forRoomEvent",value:function(t,r){var n="org.matrix.msc2762.".concat(t,".event:").concat(r);return e.findEventCapabilities([n])[0]}},{key:"forRoomMessageEvent",value:function(t,r){r=null==r?"":r;var n="org.matrix.msc2762.".concat(t,".event:m.room.message#").concat(r);return e.findEventCapabilities([n])[0]}},{key:"findEventCapabilities",value:function(t){var n,i=[],a=r(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,l=null,c=void 0,d=null;if(u.startsWith("org.matrix.msc2762.send.event:")?(l=s.Send,d=o.Event,c=u.substring(30)):u.startsWith("org.matrix.msc2762.send.state_event:")?(l=s.Send,d=o.State,c=u.substring(36)):u.startsWith("org.matrix.msc3819.send.to_device:")?(l=s.Send,d=o.ToDevice,c=u.substring(34)):u.startsWith("org.matrix.msc2762.receive.event:")?(l=s.Receive,d=o.Event,c=u.substring(33)):u.startsWith("org.matrix.msc2762.receive.state_event:")?(l=s.Receive,d=o.State,c=u.substring(39)):u.startsWith("org.matrix.msc3819.receive.to_device:")&&(l=s.Receive,d=o.ToDevice,c=u.substring(37)),null!==l&&null!==d){var f=c.startsWith("m.room.message#")||d===o.State,h=null;if(c.includes("#")&&f){var p=c.split("#"),v=p.findIndex((function(e){return!e.endsWith("\\")}));c=p.slice(0,v+1).map((function(e){return e.endsWith("\\")?e.substring(0,e.length-1):e})).join("#"),h=p.slice(v+1).join("#")}i.push(new e(l,c,d,h,u))}}}catch(e){a.e(e)}finally{a.f()}return i}}],n&&i(t.prototype,n),a&&i(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.WidgetEventCapability=l})),n.register("5lKz1",(function(e,t){"use strict";var r;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Symbols=void 0,e.exports.Symbols=r,(r||(e.exports.Symbols=r={})).AnyRoom="*"})),n.register("jnHoT",(function(e,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ClientWidgetApi=void 0;var i=n("guIx5"),o=n("gys9S"),a=n("3ql3J"),s=n("kKOGf"),u=n("29dqY"),l=n("fETbp"),c=n("cRgOy"),d=n("kt6yq"),f=n("lChfR"),h=n("5lKz1");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
p=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new M(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return I()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function f(){}function h(){}function v(){}var g={};u(g,o,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==t&&n.call(y,o)&&(g=y);var b=v.prototype=f.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function i(o,a,s,u){var l=c(e[o],e,a);if("throw"!==l.type){var d=l.arg,f=d.value;return f&&"object"==r(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){i("next",e,s,u)}),(function(e){i("throw",e,s,u)})):t.resolve(f).then((function(e){d.value=e,s(d)}),(function(e){return i("throw",e,s,u)}))}u(l.arg)}var o;this._invoke=function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return o=o?o.then(n,n):n()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=v,u(b,"constructor",v),u(v,"constructor",h),h.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},_(w.prototype),u(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new w(l(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(b),u(b,s,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function v(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){v(o,n,i,a,s,"next",e)}function s(e){v(o,n,i,a,s,"throw",e)}a(void 0)}))}}function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=C(e);if(t){var i=C(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return k(this,r)}}function k(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return M(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new R(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function R(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return R=function(e){this.s=e,this.n=e.next},R.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new R(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(O,e);var t,r,n,i,v,y,b,k,C,R,x=E(O);function O(e,t,r){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,O),(n=x.call(this)).widget=e,n.iframe=t,n.driver=r,I(M(n),"transport",void 0),I(M(n),"contentLoadedActionSent",!1),I(M(n),"allowedCapabilities",new Set),I(M(n),"allowedEvents",[]),I(M(n),"isStopped",!1),I(M(n),"turnServers",null),null==t||!t.contentWindow)throw new Error("No iframe supplied");if(!e)throw new Error("Invalid widget");if(!r)throw new Error("Invalid driver");return n.transport=new o.PostmessageTransport(a.WidgetApiDirection.ToWidget,e.id,t.contentWindow,window),n.transport.targetOrigin=e.origin,n.transport.on("message",n.handleMessage.bind(M(n))),t.addEventListener("load",n.onIframeLoad.bind(M(n))),n.transport.start(),n}return t=O,r=[{key:"hasCapability",value:function(e){return this.allowedCapabilities.has(e)}},{key:"canUseRoomTimeline",value:function(e){return this.hasCapability("org.matrix.msc2762.timeline:".concat(h.Symbols.AnyRoom))||this.hasCapability("org.matrix.msc2762.timeline:".concat(e))}},{key:"canSendRoomEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some((function(r){return r.matchesAsRoomEvent(c.EventDirection.Send,e,t)}))}},{key:"canSendStateEvent",value:function(e,t){return this.allowedEvents.some((function(r){return r.matchesAsStateEvent(c.EventDirection.Send,e,t)}))}},{key:"canSendToDeviceEvent",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsToDeviceEvent(c.EventDirection.Send,e)}))}},{key:"canReceiveRoomEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some((function(r){return r.matchesAsRoomEvent(c.EventDirection.Receive,e,t)}))}},{key:"canReceiveStateEvent",value:function(e,t){return this.allowedEvents.some((function(r){return r.matchesAsStateEvent(c.EventDirection.Receive,e,t)}))}},{key:"canReceiveToDeviceEvent",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsToDeviceEvent(c.EventDirection.Receive,e)}))}},{key:"stop",value:function(){this.isStopped=!0,this.transport.stop()}},{key:"beginCapabilities",value:function(){var e,t=this;this.emit("preparing"),this.transport.send(s.WidgetApiToWidgetAction.Capabilities,{}).then((function(r){return e=r.capabilities,t.driver.validateCapabilities(new Set(r.capabilities))})).then((function(r){console.log("Widget ".concat(t.widget.id," is allowed capabilities:"),Array.from(r)),t.allowedCapabilities=r,t.allowedEvents=c.WidgetEventCapability.findEventCapabilities(r),t.notifyCapabilities(e),t.emit("ready")}))}},{key:"notifyCapabilities",value:function(e){var t=this;this.transport.send(s.WidgetApiToWidgetAction.NotifyCapabilities,{requested:e,approved:Array.from(this.allowedCapabilities)}).catch((function(e){console.warn("non-fatal error notifying widget of approved capabilities:",e)})).then((function(){t.emit("capabilitiesNotified")}))}},{key:"onIframeLoad",value:function(e){this.widget.waitForIframeLoad?this.beginCapabilities():this.contentLoadedActionSent=!1}},{key:"handleContentLoadedAction",value:function(e){if(this.contentLoadedActionSent)throw new Error("Improper sequence: ContentLoaded Action can only be send once after the widget loaded and should only be used if waitForIframeLoad is false (default=true)");this.widget.waitForIframeLoad?this.transport.reply(e,{error:{message:"Improper sequence: not expecting ContentLoaded event if waitForIframLoad is true (default=true)"}}):(this.transport.reply(e,{}),this.beginCapabilities()),this.contentLoadedActionSent=!0}},{key:"replyVersions",value:function(e){this.transport.reply(e,{supported_versions:l.CurrentApiVersions})}},{key:"handleCapabilitiesRenegotiate",value:function(e){var t,r=this;this.transport.reply(e,{});var n=(null===(t=e.data)||void 0===t?void 0:t.capabilities)||[],i=new Set(n.filter((function(e){return!r.hasCapability(e)})));if(0===i.size)return this.notifyCapabilities([]);this.driver.validateCapabilities(i).then((function(e){return e.forEach((function(e){return r.allowedCapabilities.add(e)})),c.WidgetEventCapability.findEventCapabilities(e).forEach((function(e){return r.allowedEvents.push(e)})),r.notifyCapabilities(Array.from(i))}))}},{key:"handleNavigate",value:function(e){var t,r,n=this;if(!this.hasCapability(u.MatrixCapabilities.MSC2931Navigate))return this.transport.reply(e,{error:{message:"Missing capability"}});if(null===(t=e.data)||void 0===t||!t.uri||null===(r=e.data)||void 0===r||!r.uri.toString().startsWith("https://matrix.to/#"))return this.transport.reply(e,{error:{message:"Invalid matrix.to URI"}});var i=function(t){return console.error("[ClientWidgetApi] Failed to handle navigation: ",t),n.transport.reply(e,{error:{message:"Error handling navigation"}})};try{this.driver.navigate(e.data.uri.toString()).catch((function(e){return i(e)})).then((function(){return n.transport.reply(e,{})}))}catch(e){return i(e)}}},{key:"handleOIDC",value:function(e){var t=this,r=1,n=function(n,i){return i=i||{},r>1?t.transport.send(s.WidgetApiToWidgetAction.OpenIDCredentials,_({state:n,original_request_id:e.requestId},i)):t.transport.reply(e,_({state:n},i))},i=function(i){return console.error("[ClientWidgetApi] Failed to handle OIDC: ",i),r>1?n(d.OpenIDRequestState.Blocked):t.transport.reply(e,{error:{message:i}})},o=new f.SimpleObservable((function(e){return e.state===d.OpenIDRequestState.PendingUserConfirmation&&r>1?(o.close(),i("client provided out-of-phase response to OIDC flow")):e.state===d.OpenIDRequestState.PendingUserConfirmation?(n(e.state),void r++):e.state!==d.OpenIDRequestState.Allowed||e.token?(e.state===d.OpenIDRequestState.Blocked&&(e.token=null),o.close(),n(e.state,e.token)):i("client provided invalid OIDC token for an allowed request")}));this.driver.askOpenID(o)}},{key:"handleReadEvents",value:function(e){var t=this;if(!e.data.type)return this.transport.reply(e,{error:{message:"Invalid request - missing event type"}});if(void 0!==e.data.limit&&(!e.data.limit||e.data.limit<0))return this.transport.reply(e,{error:{message:"Invalid request - limit out of range"}});var r=null;if(e.data.room_ids){r=e.data.room_ids,Array.isArray(r)||(r=[r]);var n,i=m(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(!this.canUseRoomTimeline(o))return this.transport.reply(e,{error:{message:"Unable to access room timeline: ".concat(o)}})}}catch(e){i.e(e)}finally{i.f()}}var a=e.data.limit||0,s=Promise.resolve([]);if(void 0!==e.data.state_key){var u=!0===e.data.state_key?void 0:e.data.state_key.toString();if(!this.canReceiveStateEvent(e.data.type,u))return this.transport.reply(e,{error:{message:"Cannot read state events of this type"}});s=this.driver.readStateEvents(e.data.type,u,a,r)}else{if(!this.canReceiveRoomEvent(e.data.type,e.data.msgtype))return this.transport.reply(e,{error:{message:"Cannot read room events of this type"}});s=this.driver.readRoomEvents(e.data.type,e.data.msgtype,a,r)}return s.then((function(r){return t.transport.reply(e,{events:r})}))}},{key:"handleSendEvent",value:function(e){var t,r=this;if(!e.data.type)return this.transport.reply(e,{error:{message:"Invalid request - missing event type"}});if(e.data.room_id&&!this.canUseRoomTimeline(e.data.room_id))return this.transport.reply(e,{error:{message:"Unable to access room timeline: ".concat(e.data.room_id)}});if(null!==e.data.state_key&&void 0!==e.data.state_key){if(!this.canSendStateEvent(e.data.type,e.data.state_key))return this.transport.reply(e,{error:{message:"Cannot send state events of this type"}});t=this.driver.sendEvent(e.data.type,e.data.content||{},e.data.state_key,e.data.room_id)}else{var n=e.data.content||{},i=n.msgtype;if(!this.canSendRoomEvent(e.data.type,i))return this.transport.reply(e,{error:{message:"Cannot send room events of this type"}});t=this.driver.sendEvent(e.data.type,n,null,e.data.room_id)}t.then((function(t){return r.transport.reply(e,{room_id:t.roomId,event_id:t.eventId})})).catch((function(t){return console.error("error sending event: ",t),r.transport.reply(e,{error:{message:"Error sending event"}})}))}},{key:"handleSendToDevice",value:(R=g(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.type){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Invalid request - missing event type"}});case 3:case 8:case 13:case 18:case 25:e.next=32;break;case 5:if(t.data.messages){e.next=10;break}return e.next=8,this.transport.reply(t,{error:{message:"Invalid request - missing event contents"}});case 10:if("boolean"==typeof t.data.encrypted){e.next=15;break}return e.next=13,this.transport.reply(t,{error:{message:"Invalid request - missing encryption flag"}});case 15:if(this.canSendToDeviceEvent(t.data.type)){e.next=20;break}return e.next=18,this.transport.reply(t,{error:{message:"Cannot send to-device events of this type"}});case 20:return e.prev=20,e.next=23,this.driver.sendToDevice(t.data.type,t.data.encrypted,t.data.messages);case 23:return e.next=25,this.transport.reply(t,{});case 27:return e.prev=27,e.t0=e.catch(20),console.error("error sending to-device event",e.t0),e.next=32,this.transport.reply(t,{error:{message:"Error sending event"}});case 32:case"end":return e.stop()}}),e,this,[[20,27]])}))),function(e){return R.apply(this,arguments)})},{key:"pollTurnServers",value:(C=g(p().mark((function e(t,r){var n,i,o,a,u,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.transport.send(s.WidgetApiToWidgetAction.UpdateTurnServers,r);case 3:n=!1,i=!1,e.prev=5,a=T(t);case 7:return e.next=9,a.next();case 9:if(!(n=!(u=e.sent).done)){e.next=16;break}return l=u.value,e.next=13,this.transport.send(s.WidgetApiToWidgetAction.UpdateTurnServers,l);case 13:n=!1,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),i=!0,o=e.t0;case 22:if(e.prev=22,e.prev=23,!n||null==a.return){e.next=27;break}return e.next=27,a.return();case 27:if(e.prev=27,!i){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(22);case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),console.error("error polling for TURN servers",e.t1);case 37:case"end":return e.stop()}}),e,this,[[0,34],[5,18,22,32],[23,,27,31]])}))),function(e,t){return C.apply(this,arguments)})},{key:"handleWatchTurnServers",value:(k=g(p().mark((function e(t){var r,n,i,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(u.MatrixCapabilities.MSC3846TurnServers)){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Missing capability"}});case 3:case 8:e.next=30;break;case 5:if(!this.turnServers){e.next=10;break}return e.next=8,this.transport.reply(t,{});case 10:return e.prev=10,r=this.driver.getTurnServers(),e.next=14,r.next();case 14:if(n=e.sent,i=n.done,o=n.value,!i){e.next=19;break}throw new Error("Client refuses to provide any TURN servers");case 19:return e.next=21,this.transport.reply(t,{});case 21:this.pollTurnServers(r,o),this.turnServers=r,e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(10),console.error("error getting first TURN server results",e.t0),e.next=30,this.transport.reply(t,{error:{message:"TURN servers not available"}});case 30:case"end":return e.stop()}}),e,this,[[10,25]])}))),function(e){return k.apply(this,arguments)})},{key:"handleUnwatchTurnServers",value:(b=g(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(u.MatrixCapabilities.MSC3846TurnServers)){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Missing capability"}});case 3:case 8:e.next=15;break;case 5:if(this.turnServers){e.next=10;break}return e.next=8,this.transport.reply(t,{});case 10:return e.next=12,this.turnServers.return(void 0);case 12:return this.turnServers=null,e.next=15,this.transport.reply(t,{});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"handleReadRelations",value:(y=g(p().mark((function e(t){var r,n,i=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.event_id){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - missing event ID"}}));case 2:if(!(void 0!==t.data.limit&&t.data.limit<0)){e.next=4;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - limit out of range"}}));case 4:if(void 0===t.data.room_id||this.canUseRoomTimeline(t.data.room_id)){e.next=6;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Unable to access room timeline: ".concat(t.data.room_id)}}));case 6:return e.prev=6,e.next=9,this.driver.readEventRelations(t.data.event_id,t.data.room_id,t.data.rel_type,t.data.event_type,t.data.from,t.data.to,t.data.limit,t.data.direction);case 9:if(!(r=e.sent).originalEvent){e.next=18;break}if(void 0===r.originalEvent.state_key){e.next=16;break}if(this.canReceiveStateEvent(r.originalEvent.type,r.originalEvent.state_key)){e.next=14;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Cannot read state events of this type"}}));case 14:e.next=18;break;case 16:if(this.canReceiveRoomEvent(r.originalEvent.type,r.originalEvent.content.msgtype)){e.next=18;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Cannot read room events of this type"}}));case 18:return n=r.chunk.filter((function(e){return void 0!==e.state_key?i.canReceiveStateEvent(e.type,e.state_key):i.canReceiveRoomEvent(e.type,e.content.msgtype)})),e.abrupt("return",this.transport.reply(t,{original_event:r.originalEvent,chunk:n,prev_batch:r.prevBatch,next_batch:r.nextBatch}));case 22:return e.prev=22,e.t0=e.catch(6),console.error("error getting the relations",e.t0),e.next=27,this.transport.reply(t,{error:{message:"Unexpected error while reading relations"}});case 27:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(e){return y.apply(this,arguments)})},{key:"handleMessage",value:function(e){if(!this.isStopped){var t=new CustomEvent("action:".concat(e.detail.action),{detail:e.detail,cancelable:!0});if(this.emit("action:".concat(e.detail.action),t),!t.defaultPrevented)switch(e.detail.action){case s.WidgetApiFromWidgetAction.ContentLoaded:return this.handleContentLoadedAction(e.detail);case s.WidgetApiFromWidgetAction.SupportedApiVersions:return this.replyVersions(e.detail);case s.WidgetApiFromWidgetAction.SendEvent:return this.handleSendEvent(e.detail);case s.WidgetApiFromWidgetAction.SendToDevice:return this.handleSendToDevice(e.detail);case s.WidgetApiFromWidgetAction.GetOpenIDCredentials:return this.handleOIDC(e.detail);case s.WidgetApiFromWidgetAction.MSC2931Navigate:return this.handleNavigate(e.detail);case s.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities:return this.handleCapabilitiesRenegotiate(e.detail);case s.WidgetApiFromWidgetAction.MSC2876ReadEvents:return this.handleReadEvents(e.detail);case s.WidgetApiFromWidgetAction.WatchTurnServers:return this.handleWatchTurnServers(e.detail);case s.WidgetApiFromWidgetAction.UnwatchTurnServers:return this.handleUnwatchTurnServers(e.detail);case s.WidgetApiFromWidgetAction.MSC3869ReadRelations:return this.handleReadRelations(e.detail);default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}}},{key:"takeScreenshot",value:function(){return this.transport.send(s.WidgetApiToWidgetAction.TakeScreenshot,{})}},{key:"updateVisibility",value:function(e){return this.transport.send(s.WidgetApiToWidgetAction.UpdateVisibility,{visible:e})}},{key:"sendWidgetConfig",value:function(e){return this.transport.send(s.WidgetApiToWidgetAction.WidgetConfig,e).then()}},{key:"notifyModalWidgetButtonClicked",value:function(e){return this.transport.send(s.WidgetApiToWidgetAction.ButtonClicked,{id:e}).then()}},{key:"notifyModalWidgetClose",value:function(e){return this.transport.send(s.WidgetApiToWidgetAction.CloseModalWidget,e).then()}},{key:"feedEvent",value:(v=g(p().mark((function e(t,r){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.room_id===r||this.canUseRoomTimeline(t.room_id)){e.next=2;break}return e.abrupt("return");case 2:if(void 0===t.state_key||null===t.state_key){e.next=7;break}if(this.canReceiveStateEvent(t.type,t.state_key)){e.next=5;break}return e.abrupt("return");case 5:e.next=9;break;case 7:if(this.canReceiveRoomEvent(t.type,null===(n=t.content)||void 0===n?void 0:n.msgtype)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.transport.send(s.WidgetApiToWidgetAction.SendEvent,t);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"feedToDevice",value:(i=g(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.canReceiveToDeviceEvent(t.type)){e.next=3;break}return e.next=3,this.transport.send(s.WidgetApiToWidgetAction.SendToDevice,_(_({},t),{},{encrypted:r}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})}],r&&w(t.prototype,r),n&&w(t,n),Object.defineProperty(t,"prototype",{writable:!1}),O}(i.EventEmitter);e.exports.ClientWidgetApi=x})),n.register("29dqY",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VideoConferenceCapabilities=e.exports.StickerpickerCapabilities=e.exports.MatrixCapabilities=void 0,e.exports.getTimelineRoomIDFromCapability=function(e){return e.substring(e.indexOf(":")+1)},e.exports.isTimelineCapability=function(e){return null==e?void 0:e.startsWith("org.matrix.msc2762.timeline:")},e.exports.isTimelineCapabilityFor=function(e,t){return e==="org.matrix.msc2762.timeline:".concat(t)},e.exports.MatrixCapabilities=r,(n=r||(e.exports.MatrixCapabilities=r={})).Screenshots="m.capability.screenshot",n.StickerSending="m.sticker",n.AlwaysOnScreen="m.always_on_screen",n.RequiresClient="io.element.requires_client",n.MSC2931Navigate="org.matrix.msc2931.navigate",n.MSC3846TurnServers="town.robin.msc3846.turn_servers";var i=[r.StickerSending];e.exports.StickerpickerCapabilities=i;var o=[r.AlwaysOnScreen];e.exports.VideoConferenceCapabilities=o})),n.register("lChfR",(function(e,t){"use strict";function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SimpleObservable=void 0;var o=function(){function e(t){var r,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=[],(n="listeners")in(r=this)?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,t&&this.listeners.push(t)}var t,n,o;return t=e,(n=[{key:"onUpdate",value:function(e){this.listeners.push(e)}},{key:"update",value:function(e){var t,n=r(this.listeners);try{for(n.s();!(t=n.n()).done;)(0,t.value)(e)}catch(e){n.e(e)}finally{n.f()}}},{key:"close",value:function(){this.listeners=[]}}])&&i(t.prototype,n),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.SimpleObservable=o})),n.register("f5jVw",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("k99ZZ",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("b4oUV",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("jv5rZ",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("hALAI",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("76aL8",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isErrorResponse=function(e){if("error"in e){return!!e.error.message}return!1}})),n.register("adU44",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("lDPgo",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("hz9cm",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("c6dT6",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("kC51z",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("3x0Mf",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("1Whqj",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("eKwhr",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("7ON16",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("inbos",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("lO3yL",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetKind=void 0,e.exports.WidgetKind=r,(n=r||(e.exports.WidgetKind=r={})).Room="room",n.Account="account",n.Modal="modal"})),n.register("8PUDU",(function(e,t){"use strict";var r,n;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ModalButtonKind=void 0,e.exports.ModalButtonKind=r,(n=r||(e.exports.ModalButtonKind=r={})).Primary="m.primary",n.Secondary="m.secondary",n.Warning="m.warning",n.Danger="m.danger",n.Link="m.link"})),n.register("gODZk",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("joHSD",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("kW9OL",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("bmoDv",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("hAczz",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("kqv20",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("fqIhL",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("k28QS",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("5iozb",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("l6Leu",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isValidUrl=function(e){if(!e)return!1;try{var t=new URL(e);return"http"===t.protocol||"https"===t.protocol}catch(e){if(e instanceof TypeError)return!1;throw e}}})),n.register("8E77W",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.assertPresent=function(e,t){if(!e[t])throw new Error("".concat(t," is required"))}})),n.register("jwHr5",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Widget=void 0;var r=n("8E77W"),i=n("fPrcb");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.definition=t,!this.definition)throw new Error("Definition is required");(0,r.assertPresent)(t,"id"),(0,r.assertPresent)(t,"creatorUserId"),(0,r.assertPresent)(t,"type"),(0,r.assertPresent)(t,"url")}var t,n,a;return t=e,(n=[{key:"creatorUserId",get:function(){return this.definition.creatorUserId}},{key:"type",get:function(){return this.definition.type}},{key:"id",get:function(){return this.definition.id}},{key:"name",get:function(){return this.definition.name||null}},{key:"title",get:function(){return this.rawData.title||null}},{key:"templateUrl",get:function(){return this.definition.url}},{key:"origin",get:function(){return new URL(this.templateUrl).origin}},{key:"waitForIframeLoad",get:function(){return!1!==this.definition.waitForIframeLoad&&(this.definition.waitForIframeLoad,!0)}},{key:"rawData",get:function(){return this.definition.data||{}}},{key:"getCompleteUrl",value:function(e){return(0,i.runTemplate)(this.templateUrl,this.definition,e)}}])&&o(t.prototype,n),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.Widget=a})),n.register("3nrGw",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetParser=void 0;var r=n("jwHr5"),i=n("l6Leu");function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"parseAccountData",value:function(t){if(!t)return[];for(var r=[],n=0,i=Object.keys(t);n<i.length;n++){var o=i[n],a=t[o];if(a&&("m.widget"===a.type||"im.vector.modular.widgets"===a.type)&&a.sender&&(a.state_key||a.id)===o){var s={content:a.content,sender:a.sender,type:"m.widget",state_key:o,event_id:"$example",room_id:"!example",origin_server_ts:1},u=e.parseRoomWidget(s);u&&r.push(u)}}return r}},{key:"parseWidgetsFromRoomState",value:function(t){if(!t)return[];var r,n=[],i=o(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=e.parseRoomWidget(a);s&&n.push(s)}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"parseRoomWidget",value:function(t){if(!t)return null;if("m.widget"!==t.type&&"im.vector.modular.widgets"!==t.type)return null;var r=t.content||{},n={id:t.state_key,creatorUserId:r.creatorUserId||t.sender,name:r.name,type:r.type,url:r.url,waitForIframeLoad:r.waitForIframeLoad,data:r.data};return e.processEstimatedWidget(n)}},{key:"processEstimatedWidget",value:function(e){return e.id&&e.creatorUserId&&e.type&&(0,i.isValidUrl)(e.url)?new r.Widget(e):null}}],(n=null)&&s(t.prototype,n),a&&s(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.WidgetParser=u})),n.register("kvGdc",(function(e,t){"use strict";function r(e){return null==e?"".concat(e):e.toString()}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.runTemplate=function(e,t,n){for(var i=Object.assign({},t.data,{matrix_room_id:n.widgetRoomId||"",matrix_user_id:n.currentUserId,matrix_display_name:n.userDisplayName||n.currentUserId,matrix_avatar_url:n.userHttpAvatarUrl||"",matrix_widget_id:t.id,"org.matrix.msc2873.client_id":n.clientId||"","org.matrix.msc2873.client_theme":n.clientTheme||"","org.matrix.msc2873.client_language":n.clientLanguage||""}),o=e,a=0,s=Object.keys(i);a<s.length;a++){var u=s[a],l="$".concat(u).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=new RegExp(l,"g");o=o.replace(c,encodeURIComponent(r(i[u])))}return o},e.exports.toString=r})),n.register("fNzhX",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetDriver=void 0;var r=n("fPrcb");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"validateCapabilities",value:function(e){return Promise.resolve(new Set)}},{key:"sendEvent",value:function(e,t){return Promise.reject(new Error("Failed to override function"))}},{key:"sendToDevice",value:function(e,t,r){return Promise.reject(new Error("Failed to override function"))}},{key:"readRoomEvents",value:function(e,t,r){return Promise.resolve([])}},{key:"readStateEvents",value:function(e,t,r){return Promise.resolve([])}},{key:"readEventRelations",value:function(e,t,r,n,i,o,a,s){return Promise.resolve({chunk:[]})}},{key:"askOpenID",value:function(e){e.update({state:r.OpenIDRequestState.Blocked})}},{key:"navigate",value:function(e){throw new Error("Navigation is not implemented")}},{key:"getTurnServers",value:function(){throw new Error("TURN server support is not implemented")}}])&&i(t.prototype,n),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.WidgetDriver=o})),n.register("6fQci",(function(e,t){var r=n("kxanC"),i=n("hWDD9"),o=n("dLRop"),a=n("mBz5n"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SyncAccumulator=e.exports.Category=void 0;var u,l,c=s(n("3rHpI")),d=n("jtqeE"),f=n("e8gas"),h=n("8bPbt"),p=n("7Ud45"),v=n("fFuZ6");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){return"_localTs"in e&&void 0!==e._localTs}e.exports.Category=u,(l=u||(e.exports.Category=u={})).Invite="invite",l.Leave="leave",l.Join="join";var b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,e),this.opts=t,(0,c.default)(this,"accountData",{}),(0,c.default)(this,"inviteRooms",{}),(0,c.default)(this,"joinRooms",{}),(0,c.default)(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}return(0,i.default)(e,[{key:"accumulate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}},{key:"accumulateAccountData",value:function(e){var t=this;e.account_data&&e.account_data.events&&e.account_data.events.forEach((function(e){t.accountData[e.type]=e}))}},{key:"accumulateRooms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((function(n){r.accumulateRoom(n,u.Invite,e.rooms.invite[n],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((function(n){r.accumulateRoom(n,u.Join,e.rooms.join[n],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((function(n){r.accumulateRoom(n,u.Leave,e.rooms.leave[n],t)})))}},{key:"accumulateRoom",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(t){case u.Invite:this.accumulateInviteState(e,r);break;case u.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,n);break;case u.Leave:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:d.logger.error("Unknown cateogory: ",t)}}},{key:"accumulateInviteState",value:function(e,t){if(t.invite_state&&t.invite_state.events)if(this.inviteRooms[e]){var r=this.inviteRooms[e];t.invite_state.events.forEach((function(e){for(var t=!1,n=0;n<r.invite_state.events.length;n++){var i=r.invite_state.events[n];i.type===e.type&&i.state_key==e.state_key&&(r.invite_state.events[n]=e,t=!0)}t||r.invite_state.events.push(e)}))}else this.inviteRooms[e]={invite_state:t.invite_state}}},{key:"accumulateJoinState",value:function(e,t){var r,n,i,s,u,l,c,d,g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_readReceipts:{},_threadReadReceipts:{}});var y=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((function(e){y._accountData[e.type]=e})),t.unread_notifications&&(y._unreadNotifications=t.unread_notifications),y._unreadThreadNotifications=null!==(r=null!==(n=t[v.UNREAD_THREAD_NOTIFICATIONS.stable])&&void 0!==n?n:t[v.UNREAD_THREAD_NOTIFICATIONS.unstable])&&void 0!==r?r:void 0,t.summary){var b="m.heroes",w="m.invited_member_count",S="m.joined_member_count",E=y._summary,k=t.summary;E[b]=k[b]||E[b],E[S]=k[S]||E[S],E[w]=k[w]||E[w]}if(null===(i=t.ephemeral)||void 0===i||null===(s=i.events)||void 0===s||s.forEach((function(e){e.type===h.EventType.Receipt&&e.content&&Object.keys(e.content).forEach((function(t){Object.entries(e.content[t]).forEach((function(r){var n=(0,a.default)(r,2),i=n[0],s=n[1];if((0,f.isSupportedReceiptType)(i)){var u=!0,l=!1,c=void 0;try{for(var d,h=Object.keys(s)[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var v,g=d.value,b=e.content[t][i][g],_={data:e.content[t][i][g],type:i,eventId:t};if(b.thread_id&&b.thread_id!==p.MAIN_ROOM_TIMELINE)y._threadReadReceipts=m(m({},y._threadReadReceipts),{},(0,o.default)({},b.thread_id,m(m({},null!==(v=y._threadReadReceipts[b.thread_id])&&void 0!==v?v:{}),{},(0,o.default)({},g,_))));else y._readReceipts[g]=_}}catch(e){l=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw c}}}}))}))})),t.timeline&&t.timeline.limited&&(y._timeline=[]),null===(u=t.state)||void 0===u||null===(l=u.events)||void 0===l||l.forEach((function(e){_(y._currentState,e)})),null===(c=t.timeline)||void 0===c||null===(d=c.events)||void 0===d||d.forEach((function(e,r){var n,i;if(_(y._currentState,e),g)i=e;else{void 0!==(i=Object.assign({},e)).unsigned&&(i.unsigned=Object.assign({},i.unsigned));var o=e.unsigned?e.unsigned.age:e.age;void 0!==o&&(i._localTs=Date.now()-o)}y._timeline.push({event:i,token:0===r&&null!==(n=t.timeline.prev_batch)&&void 0!==n?n:null})})),y._timeline.length>this.opts.maxTimelineEntries)for(var M=y._timeline.length-this.opts.maxTimelineEntries,C=M;C<y._timeline.length;C++)if(y._timeline[C].token){y._timeline=y._timeline.slice(C,y._timeline.length);break}}},{key:"getJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,r={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((function(e){r.invite[e]=t.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((function(n){var i=t.joinRooms[n],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:i._unreadNotifications,unread_thread_notifications:i._unreadThreadNotifications,summary:i._summary};Object.keys(i._accountData).forEach((function(e){o.account_data.events.push(i._accountData[e])}));var s={type:h.EventType.Receipt,room_id:n,content:{}},u=!0,l=!1,c=void 0;try{for(var d,p=Object.entries(i._readReceipts)[Symbol.iterator]();!(u=(d=p.next()).done);u=!0){var v=(0,a.default)(d.value,2),g=v[0],m=v[1];s.content[m.eventId]||(s.content[m.eventId]={}),s.content[m.eventId][m.type]||(s.content[m.eventId][m.type]={}),s.content[m.eventId][m.type][g]=m.data}}catch(e){l=!0,c=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}var b=!0,w=!1,S=void 0,E=!0,k=!1,M=void 0;try{for(var C,I=Object.values(i._threadReadReceipts)[Symbol.iterator]();!(E=(C=I.next()).done);E=!0){var T=C.value;try{for(var R,x=Object.entries(T)[Symbol.iterator]();!(b=(R=x.next()).done);b=!0){var O=(0,a.default)(R.value,2),A=O[0],D=O[1];s.content[D.eventId]||(s.content[D.eventId]={}),s.content[D.eventId][D.type]||(s.content[D.eventId][D.type]={}),s.content[D.eventId][D.type][A]=D.data}}catch(e){w=!0,S=e}finally{try{b||null==x.return||x.return()}finally{if(w)throw S}}}}catch(e){k=!0,M=e}finally{try{E||null==I.return||I.return()}finally{if(k)throw M}}Object.keys(s.content).length>0&&o.ephemeral.events.push(s),i._timeline.forEach((function(t){if(!o.timeline.prev_batch){if(!t.token)return;o.timeline.prev_batch=t.token}var r;!e&&y(t.event)?(void 0!==(r=Object.assign({},t.event)).unsigned&&(r.unsigned=Object.assign({},r.unsigned)),delete r._localTs,r.unsigned=r.unsigned||{},r.unsigned.age=Date.now()-t.event._localTs):r=t.event,o.timeline.events.push(r)}));for(var P=Object.create(null),L=o.timeline.events.length-1;L>=0;L--){var U=o.timeline.events[L];if(null!==U.state_key&&void 0!==U.state_key){var j=(0,f.deepCopy)(U);j.unsigned&&(j.unsigned.prev_content&&(j.content=j.unsigned.prev_content),j.unsigned.prev_sender&&(j.sender=j.unsigned.prev_sender)),_(P,j)}}Object.keys(i._currentState).forEach((function(e){Object.keys(i._currentState[e]).forEach((function(t){var r=i._currentState[e][t];P[e]&&P[e][t]&&(r=P[e][t]),o.state.events.push(r)}))})),r.join[n]=o}));var n=[];return Object.keys(this.accountData).forEach((function(e){n.push(t.accountData[e])})),{nextBatch:this.nextBatch,roomsData:r,accountData:n}}},{key:"getNextBatchToken",value:function(){return this.nextBatch}}]),e}();function _(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}e.exports.SyncAccumulator=b})),n.register("j1l3u",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TimelineWindow=e.exports.TimelineIndex=void 0;var u=s(n("3rHpI")),l=n("aBvOl"),c=(n("jtqeE"),function(){}),d=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.default)(this,e),this.client=t,this.timelineSet=r,(0,u.default)(this,"windowLimit",void 0),(0,u.default)(this,"start",void 0),(0,u.default)(this,"end",void 0),(0,u.default)(this,"eventCount",0),this.windowLimit=n.windowLimit||1e3}return(0,o.default)(e,[{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r=this,n=function(n){if(!n)throw new Error("No timeline given to initFields");var i,o=n.getEvents();if(e){if((i=o.findIndex((function(t){return t.getId()===e})))<0)throw new Error("getEventTimeline result didn't include requested event")}else i=o.length;var a=Math.min(o.length,i+Math.ceil(t/2)),s=Math.max(0,a-t);r.start=new f(n,s-n.getBaseIndex()),r.end=new f(n,a-n.getBaseIndex()),r.eventCount=a-s};return this.timelineSet.getTimelineForEvent(e)?(n(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(n):(n(this.timelineSet.getLiveTimeline()),Promise.resolve())}},{key:"getTimelineIndex",value:function(e){var t,r;if(e==l.EventTimeline.BACKWARDS)return null!==(t=this.start)&&void 0!==t?t:null;if(e==l.EventTimeline.FORWARDS)return null!==(r=this.end)&&void 0!==r?r:null;throw new Error("Invalid direction '"+e+"'")}},{key:"extend",value:function(e,t){var r=this.getTimelineIndex(e);if(!r)return c("TimelineWindow: no timeline yet"),!1;var n=e==l.EventTimeline.BACKWARDS?r.retreat(t):r.advance(t);if(n){this.eventCount+=n,c("TimelineWindow: increased cap by "+n+" (now "+this.eventCount+")");var i=this.eventCount-this.windowLimit;return i>0&&this.unpaginate(i,e!=l.EventTimeline.BACKWARDS),!0}return!1}},{key:"canPaginate",value:function(e){var t=this.getTimelineIndex(e);if(!t)return c("TimelineWindow: no timeline yet"),!1;if(e==l.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;var r=t.timeline.getNeighbouringTimeline(e),n=t.timeline.getPaginationToken(e);return Boolean(r)||Boolean(n)}},{key:"paginate",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=this;return(0,r.default)((function(){var r,s;return(0,a.__generator)(this,(function(a){return(r=o.getTimelineIndex(e))?r.pendingPaginate?[2,r.pendingPaginate]:o.extend(e,t)?[2,!0]:n&&0!==i?r.timeline.getPaginationToken(e)?(c("TimelineWindow: starting request"),s=o.client.paginateEventTimeline(r.timeline,{backwards:e==l.EventTimeline.BACKWARDS,limit:t}).finally((function(){r.pendingPaginate=void 0})).then((function(r){return c("TimelineWindow: request completed with result "+r),r?o.paginate(e,t,!0,i-1):o.paginate(e,t,!1,0)})),r.pendingPaginate=s,[2,s]):(c("TimelineWindow: no token"),[2,!1]):[2,!1]:(c("TimelineWindow: no timeline yet"),[2,!1])}))}))()}},{key:"unpaginate",value:function(e,t){var r=t?this.start:this.end;if(!r)throw new Error("Attempting to unpaginate startOfTimeline=".concat(t," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var n=t?r.advance(e):r.retreat(e);if(n<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=n,this.eventCount-=n,c("TimelineWindow.unpaginate: dropped "+n+" (now "+this.eventCount+")")}}},{key:"getEvents",value:function(){if(!this.start)return[];for(var e=[],t=this.start.timeline;;){var r,n,i=t.getEvents(),o=0,a=i.length;t===this.start.timeline&&(o=this.start.index+t.getBaseIndex()),t===(null===(r=this.end)||void 0===r?void 0:r.timeline)&&(a=this.end.index+t.getBaseIndex());for(var s=o;s<a;s++)e.push(i[s]);if(t===(null===(n=this.end)||void 0===n?void 0:n.timeline))break;t=t.getNeighbouringTimeline(l.EventTimeline.FORWARDS)}return e}}]),e}();e.exports.TimelineWindow=d;var f=function(){function e(t,r){(0,i.default)(this,e),this.timeline=t,this.index=r,(0,u.default)(this,"pendingPaginate",void 0)}return(0,o.default)(e,[{key:"minIndex",value:function(){return-1*this.timeline.getBaseIndex()}},{key:"maxIndex",value:function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}},{key:"advance",value:function(e){if(!e)return 0;var t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;var r=this.timeline.getNeighbouringTimeline(e<0?l.EventTimeline.BACKWARDS:l.EventTimeline.FORWARDS);return r?(this.timeline=r,this.index=e<0?this.maxIndex():this.minIndex(),c("paginate: switched to new neighbour"),this.advance(e)):0}},{key:"retreat",value:function(e){return-1*this.advance(-1*e)}}]),e}();e.exports.TimelineIndex=f})),n.register("azQ2p",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("cksMj"),u=n("hcUaE"),l=n("giCK6"),c=n("eQNFO"),d=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InteractiveAuth=e.exports.AuthType=void 0;var f,h,p=d(n("3rHpI")),v=n("jtqeE"),g=n("e8gas"),m="m.login.email.identity",y="m.login.msisdn";e.exports.AuthType=f,(h=f||(e.exports.AuthType=f={})).Password="m.login.password",h.Recaptcha="m.login.recaptcha",h.Terms="m.login.terms",h.Email="m.login.email.identity",h.Msisdn="m.login.msisdn",h.Sso="m.login.sso",h.SsoUnstable="org.matrix.login.sso",h.Dummy="m.login.dummy",h.RegistrationToken="m.login.registration_token",h.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token";var b=function(e){(0,s.default)(n,e);var t=(0,l.default)(n);function n(e,i,a){var s;return(0,o.default)(this,n),(s=t.call(this,e)).required_stages=i,s.flows=a,(0,p.default)((0,r.default)(s),"name","NoAuthFlowFoundError"),s}return n}((0,u.default)(Error)),_=function(){function e(t){(0,o.default)(this,e),(0,p.default)(this,"matrixClient",void 0),(0,p.default)(this,"inputs",void 0),(0,p.default)(this,"clientSecret",void 0),(0,p.default)(this,"requestCallback",void 0),(0,p.default)(this,"busyChangedCallback",void 0),(0,p.default)(this,"stateUpdatedCallback",void 0),(0,p.default)(this,"requestEmailTokenCallback",void 0),(0,p.default)(this,"data",void 0),(0,p.default)(this,"emailSid",void 0),(0,p.default)(this,"requestingEmailToken",!1),(0,p.default)(this,"attemptAuthDeferred",null),(0,p.default)(this,"chosenFlow",null),(0,p.default)(this,"currentStage",null),(0,p.default)(this,"emailAttempt",1),(0,p.default)(this,"submitPromise",null);var r=this;(0,p.default)(this,"requestEmailToken",(0,i.default)((function(){var e;return(0,c.__generator)(this,(function(t){switch(t.label){case 0:if(r.requestingEmailToken)return[3,5];v.logger.trace("Requesting email token. Attempt: "+r.emailAttempt),r.requestingEmailToken=!0,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,r.requestEmailTokenCallback(r.inputs.emailAddress,r.clientSecret,r.emailAttempt++,r.data.session)];case 2:return e=t.sent(),r.emailSid=e.sid,v.logger.trace("Email token request succeeded"),[3,4];case 3:return r.requestingEmailToken=!1,[7];case 4:return[3,6];case 5:v.logger.warn("Could not request email token: Already requesting"),t.label=6;case 6:return[2]}}))}))),this.matrixClient=t.matrixClient,this.data=t.authData||{},this.requestCallback=t.doRequest,this.busyChangedCallback=t.busyChanged,this.stateUpdatedCallback=t.stateUpdated||t.startAuthStage,this.requestEmailTokenCallback=t.requestEmailToken,this.inputs=t.inputs||{},t.sessionId&&(this.data.session=t.sessionId),this.clientSecret=t.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=t.emailSid}return(0,a.default)(e,[{key:"attemptAuth",value:function(){var e,t=this;this.attemptAuthDeferred=(0,g.defer)();var r=this.attemptAuthDeferred.promise;if(null!==(e=this.data)&&void 0!==e&&e.flows)this.startNextAuthStage();else{var n;null===(n=this.busyChangedCallback)||void 0===n||n.call(this,!0);var i=this.data.session?{session:this.data.session}:null;this.doRequest(i).finally((function(){var e;null===(e=t.busyChangedCallback)||void 0===e||e.call(t,!1)}))}return r}},{key:"poll",value:function(){var e=this;return(0,i.default)((function(){var t,r,n;return(0,c.__generator)(this,(function(i){switch(i.label){case 0:return e.data.session&&e.attemptAuthDeferred?e.submitPromise?[2]:(t={},e.currentStage!=m?[3,2]:e.emailSid?(r={sid:e.emailSid,client_secret:e.clientSecret},[4,e.matrixClient.doesServerRequireIdServerParam()]):[3,2]):[2];case 1:i.sent()&&(n=new URL(e.matrixClient.getIdentityServerUrl()),r.id_server=n.host),t={type:m,threepid_creds:r,threepidCreds:r},i.label=2;case 2:return e.submitAuthDict(t,!0),[2]}}))}))()}},{key:"getSessionId",value:function(){var e;return null===(e=this.data)||void 0===e?void 0:e.session}},{key:"getClientSecret",value:function(){return this.clientSecret}},{key:"getStageParams",value:function(e){var t;return null===(t=this.data.params)||void 0===t?void 0:t[e]}},{key:"getChosenFlow",value:function(){return this.chosenFlow}},{key:"submitAuthDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,i.default)((function(){var n,i,o;return(0,c.__generator)(this,(function(a){switch(a.label){case 0:if(!r.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");t||null===(n=r.busyChangedCallback)||void 0===n||n.call(r,!0),a.label=1;case 1:if(!r.submitPromise)return[3,6];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,r.submitPromise];case 3:return a.sent(),[3,5];case 4:return a.sent(),[3,5];case 5:return[3,1];case 6:r.data.session?(i={session:r.data.session},Object.assign(i,e)):i=e,a.label=7;case 7:return a.trys.push([7,,9,10]),r.submitPromise=r.doRequest(i,t),[4,r.submitPromise];case 8:return a.sent(),[3,10];case 9:return r.submitPromise=null,t||null===(o=r.busyChangedCallback)||void 0===o||o.call(r,!1),[7];case 10:return[2]}}))}))()}},{key:"getEmailSid",value:function(){return this.emailSid}},{key:"setEmailSid",value:function(e){this.emailSid=e}},{key:"doRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,i.default)((function(){var n,i,o,a,s,u,l,d,h;return(0,c.__generator)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,7]),[4,r.requestCallback(e,t)];case 1:return n=c.sent(),r.attemptAuthDeferred.resolve(n),r.attemptAuthDeferred=null,[3,7];case 2:i=c.sent(),u=null!==(o=null===(a=i.data)||void 0===a?void 0:a.flows)&&void 0!==o?o:null,l=r.data.flows||Boolean(u),401===i.httpStatus&&i.data&&l||(t?v.logger.log("Background poll request failed doing UI auth: ignoring",i):null===(d=r.attemptAuthDeferred)||void 0===d||d.reject(i)),i.data||(i.data={}),i.data.flows||i.data.completed||i.data.session||(i.data.flows=r.data.flows,i.data.completed=r.data.completed,i.data.session=r.data.session),r.data=i.data;try{r.startNextAuthStage()}catch(e){return r.attemptAuthDeferred.reject(e),r.attemptAuthDeferred=null,[2]}if(r.emailSid||null===(s=r.chosenFlow)||void 0===s||!s.stages.includes(f.Email))return[3,6];c.label=3;case 3:return c.trys.push([3,5,,6]),[4,r.requestEmailToken()];case 4:return c.sent(),[3,6];case 5:return h=c.sent(),r.attemptAuthDeferred.reject(h),r.attemptAuthDeferred=null,[3,6];case 6:return[3,7];case 7:return[2]}}))}))()}},{key:"startNextAuthStage",value:function(){var e,t,r,n,i=this.chooseStage();if(!i)throw new Error("No incomplete flows from the server");(this.currentStage=i,i!==f.Dummy)?null!==(e=this.data)&&void 0!==e&&e.errcode||null!==(t=this.data)&&void 0!==t&&t.error?this.stateUpdatedCallback(i,{errcode:(null===(r=this.data)||void 0===r?void 0:r.errcode)||"",error:(null===(n=this.data)||void 0===n?void 0:n.error)||""}):this.stateUpdatedCallback(i,i===m?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}},{key:"chooseStage",value:function(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),v.logger.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return v.logger.log("Next stage: %s",e),e}},{key:"chooseFlow",value:function(){var e=this.data.flows||[],t=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),r=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber),n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value,l=!1,c=!1,d=!0,f=!1,h=void 0;try{for(var p,v=u.stages[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var g=p.value;g===m?l=!0:g==y&&(c=!0)}}catch(e){f=!0,h=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw h}}if(l==t&&c==r)return u}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}var _=[];throw t&&_.push(m),r&&_.push(y),new b("No appropriate authentication flow found",_,e)}},{key:"firstUncompletedStage",value:function(e){var t=this.data.completed||[];return e.stages.find((function(e){return!t.includes(e)}))}}]),e}();e.exports.InteractiveAuth=_})),n.register("ee1Wz",(function(e,t){var r=n("Yawv5"),i=n("2swew"),o=n("kxanC"),a=n("hWDD9"),s=n("61A8y"),u=n("5gj45"),l=n("cksMj"),c=n("mBz5n"),d=n("9oGi2"),f=n("giCK6"),h=n("eQNFO"),p=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IndexedDBStore=void 0;var v=p(n("3rHpI")),g=n("QJIyW"),m=n("cIyLK"),y=n("LsAjK"),b=n("c9Npn"),_=n("jEuTn"),w=n("jtqeE"),S=n("6MMVS"),E=function(e){(0,l.default)(n,e);var t=(0,f.default)(n);function n(e){var i;if((0,o.default)(this,n),i=t.call(this,e),(0,v.default)((0,r.default)(i),"backend",void 0),(0,v.default)((0,r.default)(i),"startedUp",!1),(0,v.default)((0,r.default)(i),"syncTs",0),(0,v.default)((0,r.default)(i),"userModifiedMap",{}),(0,v.default)((0,r.default)(i),"emitter",new S.TypedEventEmitter),(0,v.default)((0,r.default)(i),"on",i.emitter.on.bind(i.emitter)),(0,v.default)((0,r.default)(i),"getSavedSync",i.degradable((function(){return i.backend.getSavedSync()}),"getSavedSync")),(0,v.default)((0,r.default)(i),"isNewlyCreated",i.degradable((function(){return i.backend.isNewlyCreated()}),"isNewlyCreated")),(0,v.default)((0,r.default)(i),"getSavedSyncToken",i.degradable((function(){return i.backend.getNextBatchToken()}),"getSavedSyncToken")),(0,v.default)((0,r.default)(i),"deleteAllData",i.degradable((function(){return(0,s.default)(((0,r.default)(i),(0,u.default)(n.prototype)),"deleteAllData",i).call(i),i.backend.clearDatabase().then((function(){w.logger.log("Deleted indexeddb data.")}),(function(e){throw w.logger.error("Failed to delete indexeddb data: ".concat(e)),e}))}))),(0,v.default)((0,r.default)(i),"reallySave",i.degradable((function(){i.syncTs=Date.now();var e=[],t=!0,r=!1,n=void 0;try{for(var o,a=i.getUsers()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;i.userModifiedMap[s.userId]!==s.getLastModifiedTime()&&(s.events.presence&&(e.push([s.userId,s.events.presence.event]),i.userModifiedMap[s.userId]=s.getLastModifiedTime()))}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return i.backend.syncToDatabase(e)}))),(0,v.default)((0,r.default)(i),"setSyncData",i.degradable((function(e){return i.backend.setSyncData(e)}),"setSyncData")),(0,v.default)((0,r.default)(i),"getOutOfBandMembers",i.degradable((function(e){return i.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers")),(0,v.default)((0,r.default)(i),"setOutOfBandMembers",i.degradable((function(e,t){return(0,s.default)(((0,r.default)(i),(0,u.default)(n.prototype)),"setOutOfBandMembers",i).call(i,e,t),i.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers")),(0,v.default)((0,r.default)(i),"clearOutOfBandMembers",i.degradable((function(e){return(0,s.default)(((0,r.default)(i),(0,u.default)(n.prototype)),"clearOutOfBandMembers",i).call(i,e),i.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers")),(0,v.default)((0,r.default)(i),"getClientOptions",i.degradable((function(){return i.backend.getClientOptions()}),"getClientOptions")),(0,v.default)((0,r.default)(i),"storeClientOptions",i.degradable((function(e){return(0,s.default)(((0,r.default)(i),(0,u.default)(n.prototype)),"storeClientOptions",i).call(i,e),i.backend.storeClientOptions(e)}),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");return e.workerFactory?i.backend=new y.RemoteIndexedDBStoreBackend(e.workerFactory,e.dbName):i.backend=new m.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName),i}return(0,a.default)(n,[{key:"startup",value:function(){var e=this;return this.startedUp?(w.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(w.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((function(){return w.logger.log("IndexedDBStore.startup: loading presence events"),e.backend.getUserPresenceEvents()})).then((function(t){w.logger.log("IndexedDBStore.startup: processing presence events"),t.forEach((function(t){var r=(0,c.default)(t,2),n=r[0],i=r[1],o=new b.User(n);i&&o.setPresenceEvent(new _.MatrixEvent(i)),e.userModifiedMap[o.userId]=o.getLastModifiedTime(),e.storeUser(o)}))})))}},{key:"wantsSave",value:function(){return Date.now()-this.syncTs>3e5}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e||this.wantsSave()?this.reallySave():Promise.resolve()}},{key:"degradable",value:function(e,t){var r=t?(0,s.default)((0,u.default)(n.prototype),t,this):null,o=this;return(0,i.default)((function(){var t,n,i,a,s,u,l,c=arguments;return(0,h.__generator)(this,(function(f){switch(f.label){case 0:for(t=c.length,n=new Array(t),i=0;i<t;i++)n[i]=c[i];f.label=1;case 1:return f.trys.push([1,3,,8]),[4,(a=e).call.apply(a,[o].concat((0,d.default)(n)))];case 2:return[2,f.sent()];case 3:s=f.sent(),w.logger.error("IndexedDBStore failure, degrading to MemoryStore",s),o.emitter.emit("degraded",s),f.label=4;case 4:return f.trys.push([4,6,,7]),w.logger.log("IndexedDBStore trying to delete degraded data"),[4,o.backend.clearDatabase()];case 5:return f.sent(),w.logger.log("IndexedDBStore delete after degrading succeeded"),[3,7];case 6:return l=f.sent(),w.logger.warn("IndexedDBStore delete after degrading failed",l),[3,7];case 7:return r?[2,(u=r).call.apply(u,[o].concat((0,d.default)(n)))]:[3,8];case 8:return[2]}}))}))}},{key:"getPendingEvents",value:function(e){var t=this,r=this;return(0,i.default)((function(){var i;return(0,h.__generator)(this,(function(o){if(!r.localStorage)return[2,(0,s.default)((0,u.default)(n.prototype),"getPendingEvents",t).call(r,e)];if(i=r.localStorage.getItem(k(e)))try{return[2,JSON.parse(i)]}catch(e){w.logger.error("Could not parse persisted pending events",e)}return[2,[]]}))}))()}},{key:"setPendingEvents",value:function(e,t){var r=this,o=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(i){return o.localStorage?(t.length>0?o.localStorage.setItem(k(e),JSON.stringify(t)):o.localStorage.removeItem(k(e)),[2]):[2,(0,s.default)((0,u.default)(n.prototype),"setPendingEvents",r).call(o,e,t)]}))}))()}},{key:"saveToDeviceBatches",value:function(e){return this.backend.saveToDeviceBatches(e)}},{key:"getOldestToDeviceBatch",value:function(){return this.backend.getOldestToDeviceBatch()}},{key:"removeToDeviceBatch",value:function(e){return this.backend.removeToDeviceBatch(e)}}],[{key:"exists",value:function(e,t){return m.LocalIndexedDBStoreBackend.exists(e,t)}}]),n}(g.MemoryStore);function k(e){return"mx_pending_events_".concat(e)}e.exports.IndexedDBStore=E})),n.register("cIyLK",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("mBz5n"),s=n("9oGi2"),u=n("eQNFO"),l=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LocalIndexedDBStoreBackend=void 0;var c=l(n("3rHpI")),d=n("6fQci"),f=g(n("e8gas")),h=g(n("7YPaw")),p=n("jtqeE");function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}var m=[function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})},function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})},function(e){e.createObjectStore("to_device_queue",{autoIncrement:!0})}],y=m.length;function b(e,t,r){var n=e.openCursor(t);return new Promise((function(e,t){var i=[];n.onerror=function(){t(new Error("Query failed: "+n.error))},n.onsuccess=function(){var t=n.result;t?(i.push(r(t)),t.continue()):e(i)}}))}function _(e){return new Promise((function(t,r){e.oncomplete=function(e){t(e)},e.onerror=function(){r(e.error)}}))}function w(e){return new Promise((function(t,r){e.onsuccess=function(e){t(e)},e.onerror=function(){r(e.error)}}))}function S(e){return w(e).then((function(t){return e.result}))}var E=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";(0,i.default)(this,e),this.indexedDB=t,(0,c.default)(this,"dbName",void 0),(0,c.default)(this,"syncAccumulator",void 0),(0,c.default)(this,"db",void 0),(0,c.default)(this,"disconnected",!0),(0,c.default)(this,"_isNewlyCreated",!1),(0,c.default)(this,"isPersisting",!1),(0,c.default)(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+r,this.syncAccumulator=new d.SyncAccumulator}return(0,o.default)(e,[{key:"connect",value:function(){var e=this;if(!this.disconnected)return p.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,p.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");var t=this.indexedDB.open(this.dbName,y);t.onupgradeneeded=function(r){var n=t.result,i=r.oldVersion;p.logger.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(i)),i<1&&(e._isNewlyCreated=!0),m.forEach((function(e,t){i<=t&&e(n)}))},t.onblocked=function(){p.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},p.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection...");var n=this;return w(t).then((0,r.default)((function(){return(0,u.__generator)(this,(function(e){switch(e.label){case 0:return p.logger.log("LocalIndexedDBStoreBackend.connect: connected"),n.db=t.result,n.db.onversionchange=function(){var e;null===(e=n.db)||void 0===e||e.close()},[4,n.init()];case 1:return e.sent(),[2]}}))})))}},{key:"isNewlyCreated",value:function(){return Promise.resolve(this._isNewlyCreated)}},{key:"init",value:function(){var e=this;return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((function(t){var r=(0,a.default)(t,2),n=r[0],i=r[1];p.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),e.syncAccumulator.accumulate({next_batch:i.nextBatch,rooms:i.roomsData,account_data:{events:n}},!0)}))}},{key:"getOutOfBandMembers",value:function(e){var t=this;return new Promise((function(r,n){var i=t.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),o=IDBKeyRange.only(e),a=i.openCursor(o),s=[],u=!1;a.onsuccess=function(){var e=a.result;if(!e)return s.length||u?r(s):r(null);var t=e.value;t.oob_written?u=!0:s.push(t),e.continue()},a.onerror=function(e){n(e)}})).then((function(t){return p.logger.log("LL: got ".concat(null==t?void 0:t.length," membershipEvents from storage for room ").concat(e," ...")),t}))}},{key:"setOutOfBandMembers",value:function(e,t){var n=this;return(0,r.default)((function(){var r,i,o;return(0,u.__generator)(this,(function(a){switch(a.label){case 0:return p.logger.log("LL: backend about to store ".concat(t.length)+" members for ".concat(e)),r=n.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events"),t.forEach((function(e){i.put(e)})),o={room_id:e,oob_written:!0,state_key:0},i.put(o),[4,_(r)];case 1:return a.sent(),p.logger.log("LL: backend done storing for ".concat(e,"!")),[2]}}))}))()}},{key:"clearOutOfBandMembers",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,s,l,c,d,f,h,v,g;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:return r=t.db.transaction(["oob_membership_events"],"readonly"),n=r.objectStore("oob_membership_events"),i=n.index("room"),o=IDBKeyRange.only(e),s=S(i.openKeyCursor(o,"next")).then((function(e){return(null==e?void 0:e.primaryKey)[1]})),l=S(i.openKeyCursor(o,"prev")).then((function(e){return(null==e?void 0:e.primaryKey)[1]})),[4,Promise.all([s,l])];case 1:return c=a.default.apply(void 0,[u.sent(),2]),d=c[0],f=c[1],h=t.db.transaction(["oob_membership_events"],"readwrite"),v=h.objectStore("oob_membership_events"),g=IDBKeyRange.bound([e,d],[e,f]),p.logger.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,d],[e,f]),[4,(m=v.delete(g),new Promise((function(e,t){m.onsuccess=function(){return e(m)},m.onerror=function(e){return t(e)}})))];case 2:return u.sent(),[2]}var m}))}))()}},{key:"clearDatabase",value:function(){var e=this;return new Promise((function(t){p.logger.log("Removing indexeddb instance: ".concat(e.dbName));var r=e.indexedDB.deleteDatabase(e.dbName);r.onblocked=function(){p.logger.log("can't yet delete indexeddb ".concat(e.dbName," because it is open elsewhere"))},r.onerror=function(){p.logger.warn("unable to delete js-sdk store indexeddb: ".concat(r.error)),t()},r.onsuccess=function(){p.logger.log("Removed indexeddb instance: ".concat(e.dbName)),t()}}))}},{key:"getSavedSync",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(f.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)}},{key:"getNextBatchToken",value:function(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}},{key:"setSyncData",value:function(e){var t=this;return Promise.resolve().then((function(){t.syncAccumulator.accumulate(e)}))}},{key:"syncToDatabase",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i;return(0,u.__generator)(this,(function(o){switch(o.label){case 0:if(t.isPersisting)return p.logger.warn("Skipping syncToDatabase() as persist already in flight"),(r=t.pendingUserPresenceData).push.apply(r,(0,s.default)(e)),[2];(n=e).unshift.apply(n,(0,s.default)(t.pendingUserPresenceData)),t.isPersisting=!0,o.label=1;case 1:return o.trys.push([1,,3,4]),i=t.syncAccumulator.getJSON(!0),[4,Promise.all([t.persistUserPresenceEvents(e),t.persistAccountData(i.accountData),t.persistSyncData(i.nextBatch,i.roomsData)])];case 2:return o.sent(),[3,4];case 3:return t.isPersisting=!1,[7];case 4:return[2]}}))}))()}},{key:"persistSyncData",value:function(e,t){var r=this;return p.logger.log("Persisting sync data up to",e),f.promiseTry((function(){var n=r.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),_(n).then((function(){p.logger.log("Persisted sync data up to",e)}))}))}},{key:"persistAccountData",value:function(e){var t=this;return f.promiseTry((function(){var r=t.db.transaction(["accountData"],"readwrite"),n=r.objectStore("accountData"),i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;n.put(l)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return _(r).then()}))}},{key:"persistUserPresenceEvents",value:function(e){var t=this;return f.promiseTry((function(){var r=t.db.transaction(["users"],"readwrite"),n=r.objectStore("users"),i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;n.put({userId:l[0],event:l[1]})}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return _(r).then()}))}},{key:"getUserPresenceEvents",value:function(){var e=this;return f.promiseTry((function(){return b(e.db.transaction(["users"],"readonly").objectStore("users"),void 0,(function(e){return[e.value.userId,e.value.event]}))}))}},{key:"loadAccountData",value:function(){var e=this;return p.logger.log("LocalIndexedDBStoreBackend: loading account data..."),f.promiseTry((function(){return b(e.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(function(e){return e.value})).then((function(e){return p.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e}))}))}},{key:"loadSyncData",value:function(){var e=this;return p.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),f.promiseTry((function(){return b(e.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(function(e){return e.value})).then((function(e){return p.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&p.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{}}))}))}},{key:"getClientOptions",value:function(){var e=this;return Promise.resolve().then((function(){return b(e.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(function(e){var t;return null===(t=e.value)||void 0===t?void 0:t.options})).then((function(e){return e[0]}))}))}},{key:"storeClientOptions",value:function(e){var t=this;return(0,r.default)((function(){var r;return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return r=t.db.transaction(["client_options"],"readwrite"),r.objectStore("client_options").put({clobber:"-",options:e}),[4,_(r)];case 1:return n.sent(),[2]}}))}))()}},{key:"saveToDeviceBatches",value:function(e){var t=this;return(0,r.default)((function(){var r,n,i,o,a,s,l,c;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:r=t.db.transaction(["to_device_queue"],"readwrite"),n=r.objectStore("to_device_queue"),i=!0,o=!1,a=void 0;try{for(s=e[Symbol.iterator]();!(i=(l=s.next()).done);i=!0)c=l.value,n.add(c)}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return[4,_(r)];case 1:return u.sent(),[2]}}))}))()}},{key:"getOldestToDeviceBatch",value:function(){var e=this;return(0,r.default)((function(){var t,r,n;return(0,u.__generator)(this,(function(i){switch(i.label){case 0:return t=e.db.transaction(["to_device_queue"],"readonly"),[4,S(t.objectStore("to_device_queue").openCursor())];case 1:return(r=i.sent())?(n=r.value,[2,{id:r.key,txnId:n.txnId,eventType:n.eventType,batch:n.batch}]):[2,null]}}))}))()}},{key:"removeToDeviceBatch",value:function(e){var t=this;return(0,r.default)((function(){var r;return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return r=t.db.transaction(["to_device_queue"],"readwrite"),r.objectStore("to_device_queue").delete(e),[4,_(r)];case 1:return n.sent(),[2]}}))}))()}}],[{key:"exists",value:function(e,t){return t="matrix-js-sdk:"+(t||"default"),h.exists(e,t)}}]),e}();e.exports.LocalIndexedDBStoreBackend=E})),n.register("LsAjK",(function(e,t){var r=n("2swew"),i=n("kxanC"),o=n("hWDD9"),a=n("eQNFO"),s=n("fyjrC");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RemoteIndexedDBStoreBackend=void 0;var u=s(n("3rHpI")),l=n("jtqeE"),c=n("e8gas"),d=function(){function e(t,r){var n=this;(0,i.default)(this,e),this.workerFactory=t,this.dbName=r,(0,u.default)(this,"worker",void 0),(0,u.default)(this,"nextSeq",0),(0,u.default)(this,"inFlight",{}),(0,u.default)(this,"startPromise",void 0),(0,u.default)(this,"onWorkerMessage",(function(e){var t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void l.logger.error("Got reply from worker with no seq");var r=n.inFlight[t.seq];if(void 0===r)return void l.logger.error("Got reply for unknown seq "+t.seq);if(delete n.inFlight[t.seq],"cmd_success"==t.command)r.resolve(t.result);else{var i=new Error(t.error.message);i.name=t.error.name,r.reject(i)}}else l.logger.warn("Unrecognised message from worker: ",t)}))}return(0,o.default)(e,[{key:"connect",value:function(){var e=this;return this.ensureStarted().then((function(){return e.doCmd("connect")}))}},{key:"clearDatabase",value:function(){var e=this;return this.ensureStarted().then((function(){return e.doCmd("clearDatabase")}))}},{key:"isNewlyCreated",value:function(){return this.doCmd("isNewlyCreated")}},{key:"getSavedSync",value:function(){return this.doCmd("getSavedSync")}},{key:"getNextBatchToken",value:function(){return this.doCmd("getNextBatchToken")}},{key:"setSyncData",value:function(e){return this.doCmd("setSyncData",[e])}},{key:"syncToDatabase",value:function(e){return this.doCmd("syncToDatabase",[e])}},{key:"getOutOfBandMembers",value:function(e){return this.doCmd("getOutOfBandMembers",[e])}},{key:"setOutOfBandMembers",value:function(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}},{key:"clearOutOfBandMembers",value:function(e){return this.doCmd("clearOutOfBandMembers",[e])}},{key:"getClientOptions",value:function(){return this.doCmd("getClientOptions")}},{key:"storeClientOptions",value:function(e){return this.doCmd("storeClientOptions",[e])}},{key:"getUserPresenceEvents",value:function(){return this.doCmd("getUserPresenceEvents")}},{key:"saveToDeviceBatches",value:function(e){var t=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(r){return[2,t.doCmd("saveToDeviceBatches",[e])]}))}))()}},{key:"getOldestToDeviceBatch",value:function(){var e=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(t){return[2,e.doCmd("getOldestToDeviceBatch")]}))}))()}},{key:"removeToDeviceBatch",value:function(e){var t=this;return(0,r.default)((function(){return(0,a.__generator)(this,(function(r){return[2,t.doCmd("removeToDeviceBatch",[e])]}))}))()}},{key:"ensureStarted",value:function(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then((function(){l.logger.log("IndexedDB worker is ready")}))),this.startPromise}},{key:"doCmd",value:function(e,t){var r=this;return Promise.resolve().then((function(){var n,i=r.nextSeq++,o=(0,c.defer)();return r.inFlight[i]=o,null===(n=r.worker)||void 0===n||n.postMessage({command:e,seq:i,args:t}),o.promise}))}}]),e}();e.exports.RemoteIndexedDBStoreBackend=d})),n.register("cP9JN",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0})})),n.register("9Yl8F",(function(e,t){
/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=n("kxanC"),i=n("hWDD9"),o=n("cksMj"),a=n("fIDX1"),s=n("giCK6"),u=n("chD3S")("simple-peer"),l=n("1jIor"),c=n("4p9KL"),d=n("jfC1y"),f=n("kP63c"),h=n("4rife"),p=n("1irm0").Buffer,v=65536;function g(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var m=function(e){"use strict";(0,o.default)(n,e);var t=(0,s.default)(n);function n(e){var i;if((0,r.default)(this,n),e=Object.assign({allowHalfOpen:!1},e),(i=t.call(this,e))._id=c(4).toString("hex").slice(0,7),i._debug("new peer %o",e),i.channelName=e.initiator?e.channelName||c(20).toString("hex"):null,i.initiator=e.initiator||!1,i.channelConfig=e.channelConfig||n.channelConfig,i.channelNegotiated=i.channelConfig.negotiated,i.config=Object.assign({},n.config,e.config),i.offerOptions=e.offerOptions||{},i.answerOptions=e.answerOptions||{},i.sdpTransform=e.sdpTransform||function(e){return e},i.streams=e.streams||(e.stream?[e.stream]:[]),i.trickle=void 0===e.trickle||e.trickle,i.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,i.iceCompleteTimeout=e.iceCompleteTimeout||5e3,i.destroyed=!1,i.destroying=!1,i._connected=!1,i.remoteAddress=void 0,i.remoteFamily=void 0,i.remotePort=void 0,i.localAddress=void 0,i.localFamily=void 0,i.localPort=void 0,i._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:l(),!i._wrtc)throw"undefined"==typeof window?h(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):h(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");i._pcReady=!1,i._channelReady=!1,i._iceComplete=!1,i._iceCompleteTimer=null,i._channel=null,i._pendingCandidates=[],i._isNegotiating=!1,i._firstNegotiation=!0,i._batchedNegotiation=!1,i._queuedNegotiation=!1,i._sendersAwaitingStable=[],i._senderMap=new Map,i._closingInterval=null,i._remoteTracks=[],i._remoteStreams=[],i._chunk=null,i._cb=null,i._interval=null;try{i._pc=new i._wrtc.RTCPeerConnection(i.config)}catch(e){return i.destroy(h(e,"ERR_PC_CONSTRUCTOR")),(0,a.default)(i)}return i._isReactNativeWebrtc="number"==typeof i._pc._peerConnectionId,i._pc.oniceconnectionstatechange=function(){i._onIceStateChange()},i._pc.onicegatheringstatechange=function(){i._onIceStateChange()},i._pc.onconnectionstatechange=function(){i._onConnectionStateChange()},i._pc.onsignalingstatechange=function(){i._onSignalingStateChange()},i._pc.onicecandidate=function(e){i._onIceCandidate(e)},"object"==typeof i._pc.peerIdentity&&i._pc.peerIdentity.catch((function(e){i.destroy(h(e,"ERR_PC_PEER_IDENTITY"))})),i.initiator||i.channelNegotiated?i._setupData({channel:i._pc.createDataChannel(i.channelName,i.channelConfig)}):i._pc.ondatachannel=function(e){i._setupData(e)},i.streams&&i.streams.forEach((function(e){i.addStream(e)})),i._pc.ontrack=function(e){i._onTrack(e)},i._debug("initial negotiation"),i._needsNegotiation(),i._onFinishBound=function(){i._onFinish()},i.once("finish",i._onFinishBound),i}return(0,i.default)(n,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw h(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.destroy(h(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(h(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,r=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(r).catch((function(e){var n;!r.address||r.address.endsWith(".local")?(n="Ignoring unsupported ICE candidate.",console.warn(n)):t.destroy(h(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"addTransceiver",value:function(e,t){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(h(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw h(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(r){t.addTrack(r,e)}))}}},{key:"addTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,n=r.get(t);if(n)throw n.removed?h(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):h(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,r){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw h(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(h(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw h(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(n):this.destroy(h(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw h(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(r){t.removeTrack(r,e)}))}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,f((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this.destroying){if(this.destroyed)throw h(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"destroy",value:function(e){this._destroy(e,(function(){}))}},{key:"_destroy",value:function(e,t){var r=this;this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),f((function(){if(r.destroyed=!0,r.destroying=!1,r._debug("destroy (error: %s)",e&&(e.message||e)),r.readable=r.writable=!1,r._readableState.ended||r.push(null),r._writableState.finished||r.end(),r._connected=!1,r._pcReady=!1,r._channelReady=!1,r._remoteTracks=null,r._remoteStreams=null,r._senderMap=null,clearInterval(r._closingInterval),r._closingInterval=null,clearInterval(r._interval),r._interval=null,r._chunk=null,r._cb=null,r._onFinishBound&&r.removeListener("finish",r._onFinishBound),r._onFinishBound=null,r._channel){try{r._channel.close()}catch(e){}r._channel.onmessage=null,r._channel.onopen=null,r._channel.onclose=null,r._channel.onerror=null}if(r._pc){try{r._pc.close()}catch(e){}r._pc.oniceconnectionstatechange=null,r._pc.onicegatheringstatechange=null,r._pc.onsignalingstatechange=null,r._pc.onicecandidate=null,r._pc.ontrack=null,r._pc.ondatachannel=null}r._pc=null,r._channel=null,e&&r.emit("error",e),r.emit("close"),t()})))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.destroy(h(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=v),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){var r=e.error instanceof Error?e.error:new Error("Datachannel error: ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));t.destroy(h(r,"ERR_DATA_CHANNEL"))};var r=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(r&&t._onChannelClose(),r=!0):r=!1}),5e3)}},{key:"_read",value:function(){}},{key:"_write",value:function(e,t,r){if(this.destroyed)return r(h(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.destroy(h(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>v?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}},{key:"_onFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.destroy()}),1e3)};this._connected?t():this.once("connect",t)}}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=g(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var r=function(){if(!e.destroyed){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?r():e.once("_iceComplete",r))})).catch((function(t){e.destroy(h(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(h(t,"ERR_CREATE_OFFER"))}))}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=g(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var r=function(){if(!e.destroyed){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?r():e.once("_iceComplete",r))})).catch((function(t){e.destroy(h(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(h(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(h(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(h(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(h(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,r=function(e){return"[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var n=[];t.forEach((function(e){n.push(r(e))})),e(null,n)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(n){if(!t.destroyed){var i=[];n.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(r(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e.getStats((function(r,n){if(!e.destroyed){r&&(n=[]);var i={},o={},a={},s=!1;n.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(a[e.id]=e)}));var u=function(t){s=!0;var r=o[t.localCandidateId];r&&(r.ip||r.address)?(e.localAddress=r.ip||r.address,e.localPort=Number(r.port)):r&&r.ipAddress?(e.localAddress=r.ipAddress,e.localPort=Number(r.portNumber)):"string"==typeof t.googLocalAddress&&(r=t.googLocalAddress.split(":"),e.localAddress=r[0],e.localPort=Number(r[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var n=i[t.remoteCandidateId];n&&(n.ip||n.address)?(e.remoteAddress=n.ip||n.address,e.remotePort=Number(n.port)):n&&n.ipAddress?(e.remoteAddress=n.ipAddress,e.remotePort=Number(n.portNumber)):"string"==typeof t.googRemoteAddress&&(n=t.googRemoteAddress.split(":"),e.remoteAddress=n[0],e.remotePort=Number(n[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(n.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(a[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)})),s||Object.keys(a).length&&!Object.keys(o).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(r){return e.destroy(h(r,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var l=e._cb;e._cb=null,l(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))};t()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>v||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=p.from(t)),this.push(t)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.destroy())}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(r){t._debug("on track"),t.emit("track",e.track,r),t._remoteTracks.push({track:e.track,stream:r}),t._remoteStreams.some((function(e){return e.id===r.id}))||(t._remoteStreams.push(r),f((function(){t._debug("on stream"),t.emit("stream",r)})))}))}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],u.apply(null,e)}}]),n}(d.Duplex);m.WEBRTC_SUPPORT=!!l(),m.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},m.channelConfig={},e.exports=m})),n.register("chD3S",(function(e,t){var r,i=n("b758v");e.exports.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},e.exports.save=function(t){try{t?e.exports.storage.setItem("debug",t):e.exports.storage.removeItem("debug")}catch(e){}},e.exports.load=function(){var t;try{t=e.exports.storage.getItem("debug")}catch(e){}!t&&void 0!==i&&"env"in i&&(t=void 0);return t},e.exports.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.exports.storage=function(){try{return localStorage}catch(e){}}(),e.exports.destroy=(r=!1,function(){r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),e.exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports.log=console.debug||console.log||function(){},e.exports=n("k4nqX")(e.exports),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),n.register("k4nqX",(function(e,t){var r=n("9oGi2");e.exports=function(e){function t(e){var r,n,o,a=null;function s(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(s.enabled){var o=s,a=Number(new Date),u=a-(r||a);o.diff=u,o.prev=r,o.curr=a,r=a,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var l=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";l++;var i=t.formatters[r];if("function"==typeof i){var a=n[l];e=i.call(o,a),n.splice(l,1),l--}return e})),t.formatArgs.call(o,n);var c=o.log||t.log;c.apply(o,n)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=i,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(n!==t.namespaces&&(n=t.namespaces,o=t.enabled(e)),o)},set:function(e){a=e}}),"function"==typeof t.init&&t.init(s),s}function i(e,r){var n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=(0,r.default)(t.names.map(o)).concat((0,r.default)(t.skips.map(o).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=n("3IYOm"),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(r){t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}})),n.register("3IYOm",(function(e,t){var r=n("aojpe"),i=1e3,o=6e4,a=36e5,s=864e5,u=6048e5,l=315576e5;function c(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var n,d,f=void 0===e?"undefined":(0,r.default)(e);if("string"===f&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*l;case"weeks":case"week":case"w":return r*u;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===f&&isFinite(e))return t.long?(n=e,(d=Math.abs(n))>=s?c(n,d,s,"day"):d>=a?c(n,d,a,"hour"):d>=o?c(n,d,o,"minute"):d>=i?c(n,d,i,"second"):n+" ms"):function(e){var t=Math.abs(e);return t>=s?Math.round(e/s)+"d":t>=a?Math.round(e/a)+"h":t>=o?Math.round(e/o)+"m":t>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}})),n.register("1jIor",(function(e,t){e.exports=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}})),n.register("kP63c",(function(e,t){
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r):function(e){return(n||(n=Promise.resolve())).then(e).catch((function(e){return setTimeout((function(){throw e}),0)}))}})),n.register("4rife",(function(e,t){"use strict";function r(e,t){for(var r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,t,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return r(e,n)}catch(t){n.message=e.message,n.stack=e.stack;var i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(e)),r(new i,n)}}})),n.register("5nAU4",(function(e,t){var i=n("aojpe");(function(){var n,o="Expected a function",a="__lodash_hash_undefined__",s="__lodash_placeholder__",u=16,l=32,c=64,d=128,f=256,h=1/0,p=9007199254740991,v=NaN,g=4294967295,m=[["ary",d],["bind",1],["bindKey",2],["curry",8],["curryRight",u],["flip",512],["partial",l],["partialRight",c],["rearg",f]],y="[object Arguments]",b="[object Array]",_="[object Boolean]",w="[object Date]",S="[object Error]",E="[object Function]",k="[object GeneratorFunction]",M="[object Map]",C="[object Number]",I="[object Object]",T="[object Promise]",R="[object RegExp]",x="[object Set]",O="[object String]",A="[object Symbol]",D="[object WeakMap]",P="[object ArrayBuffer]",L="[object DataView]",U="[object Float32Array]",j="[object Float64Array]",N="[object Int8Array]",B="[object Int16Array]",F="[object Int32Array]",K="[object Uint8Array]",q="[object Uint8ClampedArray]",W="[object Uint16Array]",V="[object Uint32Array]",H=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Y=/&(?:amp|lt|gt|quot|#39);/g,Z=/[&<>"']/g,$=RegExp(Y.source),J=RegExp(Z.source),Q=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,ee=/<%=([\s\S]+?)%>/g,te=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,re=/^\w*$/,ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ie=/[\\^$.*+?()[\]{}|]/g,oe=RegExp(ie.source),ae=/^\s+/,se=/\s/,ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,le=/\{\n\/\* \[wrapped with (.+)\] \*/,ce=/,? & /,de=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,fe=/[()=,{}\[\]\/\s]/,he=/\\(\\)?/g,pe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ve=/\w*$/,ge=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ye=/^\[object .+?Constructor\]$/,be=/^0o[0-7]+$/i,_e=/^(?:0|[1-9]\d*)$/,we=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Se=/($^)/,Ee=/['\n\r\u2028\u2029\\]/g,ke="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Me="\\u2700-\\u27bf",Ce="a-z\\xdf-\\xf6\\xf8-\\xff",Ie="A-Z\\xc0-\\xd6\\xd8-\\xde",Te="\\ufe0e\\ufe0f",Re="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xe="['’]",Oe="[\ud800-\udfff]",Ae="["+Re+"]",De="["+ke+"]",Pe="\\d+",Le="[\\u2700-\\u27bf]",Ue="["+Ce+"]",je="[^\ud800-\udfff"+Re+Pe+Me+Ce+Ie+"]",Ne="[^\ud800-\udfff]",Be="(?:\ud83c[\udde6-\uddff]){2}",Fe="[\ud800-\udbff][\udc00-\udfff]",Ke="["+Ie+"]",qe="(?:"+Ue+"|"+je+")",We="(?:"+Ke+"|"+je+")",Ve="(?:['’](?:d|ll|m|re|s|t|ve))?",He="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ge="(?:"+De+"|"+"\ud83c[\udffb-\udfff])"+"?",ze="[\\ufe0e\\ufe0f]?",Ye=ze+Ge+("(?:\\u200d(?:"+[Ne,Be,Fe].join("|")+")"+ze+Ge+")*"),Ze="(?:"+[Le,Be,Fe].join("|")+")"+Ye,$e="(?:"+[Ne+De+"?",De,Be,Fe,Oe].join("|")+")",Je=RegExp(xe,"g"),Qe=RegExp(De,"g"),Xe=RegExp("\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|"+$e+Ye,"g"),et=RegExp([Ke+"?"+Ue+"+"+Ve+"(?="+[Ae,Ke,"$"].join("|")+")",We+"+"+He+"(?="+[Ae,Ke+qe,"$"].join("|")+")",Ke+"?"+qe+"+"+Ve,Ke+"+"+He,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Pe,Ze].join("|"),"g"),tt=RegExp("[\\u200d\ud800-\udfff"+ke+Te+"]"),rt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],it=-1,ot={};ot[U]=ot[j]=ot[N]=ot[B]=ot[F]=ot[K]=ot[q]=ot[W]=ot[V]=!0,ot[y]=ot[b]=ot[P]=ot[_]=ot[L]=ot[w]=ot[S]=ot[E]=ot[M]=ot[C]=ot[I]=ot[R]=ot[x]=ot[O]=ot[D]=!1;var at={};at[y]=at[b]=at[P]=at[L]=at[_]=at[w]=at[U]=at[j]=at[N]=at[B]=at[F]=at[M]=at[C]=at[I]=at[R]=at[x]=at[O]=at[A]=at[K]=at[q]=at[W]=at[V]=!0,at[S]=at[E]=at[D]=!1;var st={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ut=parseFloat,lt=parseInt,ct="object"==typeof r&&r&&r.Object===Object&&r,dt="object"==typeof self&&self&&self.Object===Object&&self,ft=ct||dt||Function("return this")(),ht=t&&!t.nodeType&&t,pt=ht&&e&&!e.nodeType&&e,vt=pt&&pt.exports===ht,gt=vt&&ct.process,mt=function(){try{var e=pt&&pt.require&&pt.require("util").types;return e||gt&&gt.binding&&gt.binding("util")}catch(e){}}(),yt=mt&&mt.isArrayBuffer,bt=mt&&mt.isDate,_t=mt&&mt.isMap,wt=mt&&mt.isRegExp,St=mt&&mt.isSet,Et=mt&&mt.isTypedArray;function kt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Mt(e,t,r,n){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(n,a,r(a),e)}return n}function Ct(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function It(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function Tt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function Rt(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}function xt(e,t){return!!(null==e?0:e.length)&&Ft(e,t,0)>-1}function Ot(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function At(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function Dt(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Pt(e,t,r,n){var i=-1,o=null==e?0:e.length;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function Lt(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function Ut(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var jt=Vt("length");function Nt(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}function Bt(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function Ft(e,t,r){return t==t?function(e,t,r){var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):Bt(e,qt,r)}function Kt(e,t,r,n){for(var i=r-1,o=e.length;++i<o;)if(n(e[i],t))return i;return-1}function qt(e){return e!=e}function Wt(e,t){var r=null==e?0:e.length;return r?zt(e,t)/r:v}function Vt(e){return function(t){return null==t?n:t[e]}}function Ht(e){return function(t){return null==e?n:e[t]}}function Gt(e,t,r,n,i){return i(e,(function(e,i,o){r=n?(n=!1,e):t(r,e,i,o)})),r}function zt(e,t){for(var r,i=-1,o=e.length;++i<o;){var a=t(e[i]);a!==n&&(r=r===n?a:r+a)}return r}function Yt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Zt(e){return e?e.slice(0,fr(e)+1).replace(ae,""):e}function $t(e){return function(t){return e(t)}}function Jt(e,t){return At(t,(function(t){return e[t]}))}function Qt(e,t){return e.has(t)}function Xt(e,t){for(var r=-1,n=e.length;++r<n&&Ft(t,e[r],0)>-1;);return r}function er(e,t){for(var r=e.length;r--&&Ft(t,e[r],0)>-1;);return r}function tr(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}var rr=Ht({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),nr=Ht({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ir(e){return"\\"+st[e]}function or(e){return tt.test(e)}function ar(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function sr(e,t){return function(r){return e(t(r))}}function ur(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var a=e[r];a!==t&&a!==s||(e[r]=s,o[i++]=r)}return o}function lr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function cr(e){return or(e)?function(e){var t=Xe.lastIndex=0;for(;Xe.test(e);)++t;return t}(e):jt(e)}function dr(e){return or(e)?function(e){return e.match(Xe)||[]}(e):function(e){return e.split("")}(e)}function fr(e){for(var t=e.length;t--&&se.test(e.charAt(t)););return t}var hr=Ht({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var pr=function e(t){var r,se=(t=null==t?ft:pr.defaults(ft.Object(),t,pr.pick(ft,nt))).Array,ke=t.Date,Me=t.Error,Ce=t.Function,Ie=t.Math,Te=t.Object,Re=t.RegExp,xe=t.String,Oe=t.TypeError,Ae=se.prototype,De=Ce.prototype,Pe=Te.prototype,Le=t["__core-js_shared__"],Ue=De.toString,je=Pe.hasOwnProperty,Ne=0,Be=(r=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",Fe=Pe.toString,Ke=Ue.call(Te),qe=ft._,We=Re("^"+Ue.call(je).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ve=vt?t.Buffer:n,He=t.Symbol,Ge=t.Uint8Array,ze=Ve?Ve.allocUnsafe:n,Ye=sr(Te.getPrototypeOf,Te),Ze=Te.create,$e=Pe.propertyIsEnumerable,Xe=Ae.splice,tt=He?He.isConcatSpreadable:n,st=He?He.iterator:n,ct=He?He.toStringTag:n,dt=function(){try{var e=po(Te,"defineProperty");return e({},"",{}),e}catch(e){}}(),ht=t.clearTimeout!==ft.clearTimeout&&t.clearTimeout,pt=ke&&ke.now!==ft.Date.now&&ke.now,gt=t.setTimeout!==ft.setTimeout&&t.setTimeout,mt=Ie.ceil,jt=Ie.floor,Ht=Te.getOwnPropertySymbols,vr=Ve?Ve.isBuffer:n,gr=t.isFinite,mr=Ae.join,yr=sr(Te.keys,Te),br=Ie.max,_r=Ie.min,wr=ke.now,Sr=t.parseInt,Er=Ie.random,kr=Ae.reverse,Mr=po(t,"DataView"),Cr=po(t,"Map"),Ir=po(t,"Promise"),Tr=po(t,"Set"),Rr=po(t,"WeakMap"),xr=po(Te,"create"),Or=Rr&&new Rr,Ar={},Dr=Vo(Mr),Pr=Vo(Cr),Lr=Vo(Ir),Ur=Vo(Tr),jr=Vo(Rr),Nr=He?He.prototype:n,Br=Nr?Nr.valueOf:n,Fr=Nr?Nr.toString:n;function Kr(e){if(ss(e)&&!$a(e)&&!(e instanceof Hr)){if(e instanceof Vr)return e;if(je.call(e,"__wrapped__"))return Ho(e)}return new Vr(e)}var qr=function(){function e(){}return function(t){if(!as(t))return{};if(Ze)return Ze(t);e.prototype=t;var r=new e;return e.prototype=n,r}}();function Wr(){}function Vr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=n}function Hr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=g,this.__views__=[]}function Gr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function zr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Yr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Zr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Yr;++t<r;)this.add(e[t])}function $r(e){var t=this.__data__=new zr(e);this.size=t.size}function Jr(e,t){var r=$a(e),n=!r&&Za(e),i=!r&&!n&&es(e),o=!r&&!n&&!i&&vs(e),a=r||n||i||o,s=a?Yt(e.length,xe):[],u=s.length;for(var l in e)!t&&!je.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||wo(l,u))||s.push(l);return s}function Qr(e){var t=e.length;return t?e[$n(0,t-1)]:n}function Xr(e,t){return No(Oi(e),ln(t,0,e.length))}function en(e){return No(Oi(e))}function tn(e,t,r){(r!==n&&!Ga(e[t],r)||r===n&&!(t in e))&&sn(e,t,r)}function rn(e,t,r){var i=e[t];je.call(e,t)&&Ga(i,r)&&(r!==n||t in e)||sn(e,t,r)}function nn(e,t){for(var r=e.length;r--;)if(Ga(e[r][0],t))return r;return-1}function on(e,t,r,n){return pn(e,(function(e,i,o){t(n,e,r(e),o)})),n}function an(e,t){return e&&Ai(t,js(t),e)}function sn(e,t,r){"__proto__"==t&&dt?dt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function un(e,t){for(var r=-1,i=t.length,o=se(i),a=null==e;++r<i;)o[r]=a?n:As(e,t[r]);return o}function ln(e,t,r){return e==e&&(r!==n&&(e=e<=r?e:r),t!==n&&(e=e>=t?e:t)),e}function cn(e,t,r,i,o,a){var s,u=1&t,l=2&t,c=4&t;if(r&&(s=o?r(e,i,o,a):r(e)),s!==n)return s;if(!as(e))return e;var d=$a(e);if(d){if(s=function(e){var t=e.length,r=new e.constructor(t);t&&"string"==typeof e[0]&&je.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!u)return Oi(e,s)}else{var f=mo(e),h=f==E||f==k;if(es(e))return Mi(e,u);if(f==I||f==y||h&&!o){if(s=l||h?{}:bo(e),!u)return l?function(e,t){return Ai(e,go(e),t)}(e,function(e,t){return e&&Ai(t,Ns(t),e)}(s,e)):function(e,t){return Ai(e,vo(e),t)}(e,an(s,e))}else{if(!at[f])return o?e:{};s=function(e,t,r){var n=e.constructor;switch(t){case P:return Ci(e);case _:case w:return new n(+e);case L:return function(e,t){var r=t?Ci(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case U:case j:case N:case B:case F:case K:case q:case W:case V:return Ii(e,r);case M:return new n;case C:case O:return new n(e);case R:return function(e){var t=new e.constructor(e.source,ve.exec(e));return t.lastIndex=e.lastIndex,t}(e);case x:return new n;case A:return i=e,Br?Te(Br.call(i)):{}}var i}(e,f,u)}}a||(a=new $r);var p=a.get(e);if(p)return p;a.set(e,s),fs(e)?e.forEach((function(n){s.add(cn(n,t,r,n,e,a))})):us(e)&&e.forEach((function(n,i){s.set(i,cn(n,t,r,i,e,a))}));var v=d?n:(c?l?ao:oo:l?Ns:js)(e);return Ct(v||e,(function(n,i){v&&(n=e[i=n]),rn(s,i,cn(n,t,r,i,e,a))})),s}function dn(e,t,r){var i=r.length;if(null==e)return!i;for(e=Te(e);i--;){var o=r[i],a=t[o],s=e[o];if(s===n&&!(o in e)||!a(s))return!1}return!0}function fn(e,t,r){if("function"!=typeof e)throw new Oe(o);return Po((function(){e.apply(n,r)}),t)}function hn(e,t,r,n){var i=-1,o=xt,a=!0,s=e.length,u=[],l=t.length;if(!s)return u;r&&(t=At(t,$t(r))),n?(o=Ot,a=!1):t.length>=200&&(o=Qt,a=!1,t=new Zr(t));e:for(;++i<s;){var c=e[i],d=null==r?c:r(c);if(c=n||0!==c?c:0,a&&d==d){for(var f=l;f--;)if(t[f]===d)continue e;u.push(c)}else o(t,d,n)||u.push(c)}return u}Kr.templateSettings={escape:Q,evaluate:X,interpolate:ee,variable:"",imports:{_:Kr}},Kr.prototype=Wr.prototype,Kr.prototype.constructor=Kr,Vr.prototype=qr(Wr.prototype),Vr.prototype.constructor=Vr,Hr.prototype=qr(Wr.prototype),Hr.prototype.constructor=Hr,Gr.prototype.clear=function(){this.__data__=xr?xr(null):{},this.size=0},Gr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gr.prototype.get=function(e){var t=this.__data__;if(xr){var r=t[e];return r===a?n:r}return je.call(t,e)?t[e]:n},Gr.prototype.has=function(e){var t=this.__data__;return xr?t[e]!==n:je.call(t,e)},Gr.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=xr&&t===n?a:t,this},zr.prototype.clear=function(){this.__data__=[],this.size=0},zr.prototype.delete=function(e){var t=this.__data__,r=nn(t,e);return!(r<0)&&(r==t.length-1?t.pop():Xe.call(t,r,1),--this.size,!0)},zr.prototype.get=function(e){var t=this.__data__,r=nn(t,e);return r<0?n:t[r][1]},zr.prototype.has=function(e){return nn(this.__data__,e)>-1},zr.prototype.set=function(e,t){var r=this.__data__,n=nn(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Yr.prototype.clear=function(){this.size=0,this.__data__={hash:new Gr,map:new(Cr||zr),string:new Gr}},Yr.prototype.delete=function(e){var t=fo(this,e).delete(e);return this.size-=t?1:0,t},Yr.prototype.get=function(e){return fo(this,e).get(e)},Yr.prototype.has=function(e){return fo(this,e).has(e)},Yr.prototype.set=function(e,t){var r=fo(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Zr.prototype.add=Zr.prototype.push=function(e){return this.__data__.set(e,a),this},Zr.prototype.has=function(e){return this.__data__.has(e)},$r.prototype.clear=function(){this.__data__=new zr,this.size=0},$r.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},$r.prototype.get=function(e){return this.__data__.get(e)},$r.prototype.has=function(e){return this.__data__.has(e)},$r.prototype.set=function(e,t){var r=this.__data__;if(r instanceof zr){var n=r.__data__;if(!Cr||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Yr(n)}return r.set(e,t),this.size=r.size,this};var pn=Li(Sn),vn=Li(En,!0);function gn(e,t){var r=!0;return pn(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function mn(e,t,r){for(var i=-1,o=e.length;++i<o;){var a=e[i],s=t(a);if(null!=s&&(u===n?s==s&&!ps(s):r(s,u)))var u=s,l=a}return l}function yn(e,t){var r=[];return pn(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function bn(e,t,r,n,i){var o=-1,a=e.length;for(r||(r=_o),i||(i=[]);++o<a;){var s=e[o];t>0&&r(s)?t>1?bn(s,t-1,r,n,i):Dt(i,s):n||(i[i.length]=s)}return i}var _n=Ui(),wn=Ui(!0);function Sn(e,t){return e&&_n(e,t,js)}function En(e,t){return e&&wn(e,t,js)}function kn(e,t){return Rt(t,(function(t){return ns(e[t])}))}function Mn(e,t){for(var r=0,i=(t=wi(t,e)).length;null!=e&&r<i;)e=e[Wo(t[r++])];return r&&r==i?e:n}function Cn(e,t,r){var n=t(e);return $a(e)?n:Dt(n,r(e))}function In(e){return null==e?e===n?"[object Undefined]":"[object Null]":ct&&ct in Te(e)?function(e){var t=je.call(e,ct),r=e[ct];try{e[ct]=n;var i=!0}catch(e){}var o=Fe.call(e);i&&(t?e[ct]=r:delete e[ct]);return o}(e):function(e){return Fe.call(e)}(e)}function Tn(e,t){return e>t}function Rn(e,t){return null!=e&&je.call(e,t)}function xn(e,t){return null!=e&&t in Te(e)}function On(e,t,r){for(var i=r?Ot:xt,o=e[0].length,a=e.length,s=a,u=se(a),l=1/0,c=[];s--;){var d=e[s];s&&t&&(d=At(d,$t(t))),l=_r(d.length,l),u[s]=!r&&(t||o>=120&&d.length>=120)?new Zr(s&&d):n}d=e[0];var f=-1,h=u[0];e:for(;++f<o&&c.length<l;){var p=d[f],v=t?t(p):p;if(p=r||0!==p?p:0,!(h?Qt(h,v):i(c,v,r))){for(s=a;--s;){var g=u[s];if(!(g?Qt(g,v):i(e[s],v,r)))continue e}h&&h.push(v),c.push(p)}}return c}function An(e,t,r){var i=null==(e=xo(e,t=wi(t,e)))?e:e[Wo(ra(t))];return null==i?n:kt(i,e,r)}function Dn(e){return ss(e)&&In(e)==y}function Pn(e,t,r,i,o){return e===t||(null==e||null==t||!ss(e)&&!ss(t)?e!=e&&t!=t:function(e,t,r,i,o,a){var s=$a(e),u=$a(t),l=s?b:mo(e),c=u?b:mo(t),d=(l=l==y?I:l)==I,f=(c=c==y?I:c)==I,h=l==c;if(h&&es(e)){if(!es(t))return!1;s=!0,d=!1}if(h&&!d)return a||(a=new $r),s||vs(e)?no(e,t,r,i,o,a):function(e,t,r,n,i,o,a){switch(r){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case P:return!(e.byteLength!=t.byteLength||!o(new Ge(e),new Ge(t)));case _:case w:case C:return Ga(+e,+t);case S:return e.name==t.name&&e.message==t.message;case R:case O:return e==t+"";case M:var s=ar;case x:var u=1&n;if(s||(s=lr),e.size!=t.size&&!u)return!1;var l=a.get(e);if(l)return l==t;n|=2,a.set(e,t);var c=no(s(e),s(t),n,i,o,a);return a.delete(e),c;case A:if(Br)return Br.call(e)==Br.call(t)}return!1}(e,t,l,r,i,o,a);if(!(1&r)){var p=d&&je.call(e,"__wrapped__"),v=f&&je.call(t,"__wrapped__");if(p||v){var g=p?e.value():e,m=v?t.value():t;return a||(a=new $r),o(g,m,r,i,a)}}return!!h&&(a||(a=new $r),function(e,t,r,i,o,a){var s=1&r,u=oo(e),l=u.length,c=oo(t).length;if(l!=c&&!s)return!1;var d=l;for(;d--;){var f=u[d];if(!(s?f in t:je.call(t,f)))return!1}var h=a.get(e),p=a.get(t);if(h&&p)return h==t&&p==e;var v=!0;a.set(e,t),a.set(t,e);var g=s;for(;++d<l;){var m=e[f=u[d]],y=t[f];if(i)var b=s?i(y,m,f,t,e,a):i(m,y,f,e,t,a);if(!(b===n?m===y||o(m,y,r,i,a):b)){v=!1;break}g||(g="constructor"==f)}if(v&&!g){var _=e.constructor,w=t.constructor;_==w||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof w&&w instanceof w||(v=!1)}return a.delete(e),a.delete(t),v}(e,t,r,i,o,a))}(e,t,r,i,Pn,o))}function Ln(e,t,r,i){var o=r.length,a=o,s=!i;if(null==e)return!a;for(e=Te(e);o--;){var u=r[o];if(s&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<a;){var l=(u=r[o])[0],c=e[l],d=u[1];if(s&&u[2]){if(c===n&&!(l in e))return!1}else{var f=new $r;if(i)var h=i(c,d,l,e,t,f);if(!(h===n?Pn(d,c,3,i,f):h))return!1}}return!0}function Un(e){return!(!as(e)||(t=e,Be&&Be in t))&&(ns(e)?We:ye).test(Vo(e));var t}function jn(e){return"function"==typeof e?e:null==e?lu:"object"==typeof e?$a(e)?Wn(e[0],e[1]):qn(e):yu(e)}function Nn(e){if(!Co(e))return yr(e);var t=[];for(var r in Te(e))je.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Bn(e){if(!as(e))return function(e){var t=[];if(null!=e)for(var r in Te(e))t.push(r);return t}(e);var t=Co(e),r=[];for(var n in e)("constructor"!=n||!t&&je.call(e,n))&&r.push(n);return r}function Fn(e,t){return e<t}function Kn(e,t){var r=-1,n=Qa(e)?se(e.length):[];return pn(e,(function(e,i,o){n[++r]=t(e,i,o)})),n}function qn(e){var t=ho(e);return 1==t.length&&t[0][2]?To(t[0][0],t[0][1]):function(r){return r===e||Ln(r,e,t)}}function Wn(e,t){return Eo(e)&&Io(t)?To(Wo(e),t):function(r){var i=As(r,e);return i===n&&i===t?Ds(r,e):Pn(t,i,3)}}function Vn(e,t,r,i,o){e!==t&&_n(t,(function(a,s){if(o||(o=new $r),as(a))!function(e,t,r,i,o,a,s){var u=Ao(e,r),l=Ao(t,r),c=s.get(l);if(c)return void tn(e,r,c);var d=a?a(u,l,r+"",e,t,s):n,f=d===n;if(f){var h=$a(l),p=!h&&es(l),v=!h&&!p&&vs(l);d=l,h||p||v?$a(u)?d=u:Xa(u)?d=Oi(u):p?(f=!1,d=Mi(l,!0)):v?(f=!1,d=Ii(l,!0)):d=[]:cs(l)||Za(l)?(d=u,Za(u)?d=Es(u):as(u)&&!ns(u)||(d=bo(l))):f=!1}f&&(s.set(l,d),o(d,l,i,a,s),s.delete(l));tn(e,r,d)}(e,t,s,r,Vn,i,o);else{var u=i?i(Ao(e,s),a,s+"",e,t,o):n;u===n&&(u=a),tn(e,s,u)}}),Ns)}function Hn(e,t){var r=e.length;if(r)return wo(t+=t<0?r:0,r)?e[t]:n}function Gn(e,t,r){t=t.length?At(t,(function(e){return $a(e)?function(t){return Mn(t,1===e.length?e[0]:e)}:e})):[lu];var n=-1;t=At(t,$t(co()));var i=Kn(e,(function(e,r,i){var o=At(t,(function(t){return t(e)}));return{criteria:o,index:++n,value:e}}));return function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(i,(function(e,t){return function(e,t,r){var n=-1,i=e.criteria,o=t.criteria,a=i.length,s=r.length;for(;++n<a;){var u=Ti(i[n],o[n]);if(u)return n>=s?u:u*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function zn(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],s=Mn(e,a);r(s,a)&&ti(o,wi(a,e),s)}return o}function Yn(e,t,r,n){var i=n?Kt:Ft,o=-1,a=t.length,s=e;for(e===t&&(t=Oi(t)),r&&(s=At(e,$t(r)));++o<a;)for(var u=0,l=t[o],c=r?r(l):l;(u=i(s,c,u,n))>-1;)s!==e&&Xe.call(s,u,1),Xe.call(e,u,1);return e}function Zn(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==o){var o=i;wo(i)?Xe.call(e,i,1):hi(e,i)}}return e}function $n(e,t){return e+jt(Er()*(t-e+1))}function Jn(e,t){var r="";if(!e||t<1||t>p)return r;do{t%2&&(r+=e),(t=jt(t/2))&&(e+=e)}while(t);return r}function Qn(e,t){return Lo(Ro(e,t,lu),e+"")}function Xn(e){return Qr(Gs(e))}function ei(e,t){var r=Gs(e);return No(r,ln(t,0,r.length))}function ti(e,t,r,i){if(!as(e))return e;for(var o=-1,a=(t=wi(t,e)).length,s=a-1,u=e;null!=u&&++o<a;){var l=Wo(t[o]),c=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(o!=s){var d=u[l];(c=i?i(d,l,u):n)===n&&(c=as(d)?d:wo(t[o+1])?[]:{})}rn(u,l,c),u=u[l]}return e}var ri=Or?function(e,t){return Or.set(e,t),e}:lu,ni=dt?function(e,t){return dt(e,"toString",{configurable:!0,enumerable:!1,value:au(t),writable:!0})}:lu;function ii(e){return No(Gs(e))}function oi(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=se(i);++n<i;)o[n]=e[n+t];return o}function ai(e,t){var r;return pn(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}function si(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var o=n+i>>>1,a=e[o];null!==a&&!ps(a)&&(r?a<=t:a<t)?n=o+1:i=o}return i}return ui(e,t,lu,r)}function ui(e,t,r,i){var o=0,a=null==e?0:e.length;if(0===a)return 0;for(var s=(t=r(t))!=t,u=null===t,l=ps(t),c=t===n;o<a;){var d=jt((o+a)/2),f=r(e[d]),h=f!==n,p=null===f,v=f==f,g=ps(f);if(s)var m=i||v;else m=c?v&&(i||h):u?v&&h&&(i||!p):l?v&&h&&!p&&(i||!g):!p&&!g&&(i?f<=t:f<t);m?o=d+1:a=d}return _r(a,4294967294)}function li(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var a=e[r],s=t?t(a):a;if(!r||!Ga(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function ci(e){return"number"==typeof e?e:ps(e)?v:+e}function di(e){if("string"==typeof e)return e;if($a(e))return At(e,di)+"";if(ps(e))return Fr?Fr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function fi(e,t,r){var n=-1,i=xt,o=e.length,a=!0,s=[],u=s;if(r)a=!1,i=Ot;else if(o>=200){var l=t?null:Ji(e);if(l)return lr(l);a=!1,i=Qt,u=new Zr}else u=t?[]:s;e:for(;++n<o;){var c=e[n],d=t?t(c):c;if(c=r||0!==c?c:0,a&&d==d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),s.push(c)}else i(u,d,r)||(u!==s&&u.push(d),s.push(c))}return s}function hi(e,t){return null==(e=xo(e,t=wi(t,e)))||delete e[Wo(ra(t))]}function pi(e,t,r,n){return ti(e,t,r(Mn(e,t)),n)}function vi(e,t,r,n){for(var i=e.length,o=n?i:-1;(n?o--:++o<i)&&t(e[o],o,e););return r?oi(e,n?0:o,n?o+1:i):oi(e,n?o+1:0,n?i:o)}function gi(e,t){var r=e;return r instanceof Hr&&(r=r.value()),Pt(t,(function(e,t){return t.func.apply(t.thisArg,Dt([e],t.args))}),r)}function mi(e,t,r){var n=e.length;if(n<2)return n?fi(e[0]):[];for(var i=-1,o=se(n);++i<n;)for(var a=e[i],s=-1;++s<n;)s!=i&&(o[i]=hn(o[i]||a,e[s],t,r));return fi(bn(o,1),t,r)}function yi(e,t,r){for(var i=-1,o=e.length,a=t.length,s={};++i<o;){var u=i<a?t[i]:n;r(s,e[i],u)}return s}function bi(e){return Xa(e)?e:[]}function _i(e){return"function"==typeof e?e:lu}function wi(e,t){return $a(e)?e:Eo(e,t)?[e]:qo(ks(e))}var Si=Qn;function Ei(e,t,r){var i=e.length;return r=r===n?i:r,!t&&r>=i?e:oi(e,t,r)}var ki=ht||function(e){return ft.clearTimeout(e)};function Mi(e,t){if(t)return e.slice();var r=e.length,n=ze?ze(r):new e.constructor(r);return e.copy(n),n}function Ci(e){var t=new e.constructor(e.byteLength);return new Ge(t).set(new Ge(e)),t}function Ii(e,t){var r=t?Ci(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function Ti(e,t){if(e!==t){var r=e!==n,i=null===e,o=e==e,a=ps(e),s=t!==n,u=null===t,l=t==t,c=ps(t);if(!u&&!c&&!a&&e>t||a&&s&&l&&!u&&!c||i&&s&&l||!r&&l||!o)return 1;if(!i&&!a&&!c&&e<t||c&&r&&o&&!i&&!a||u&&r&&o||!s&&o||!l)return-1}return 0}function Ri(e,t,r,n){for(var i=-1,o=e.length,a=r.length,s=-1,u=t.length,l=br(o-a,0),c=se(u+l),d=!n;++s<u;)c[s]=t[s];for(;++i<a;)(d||i<o)&&(c[r[i]]=e[i]);for(;l--;)c[s++]=e[i++];return c}function xi(e,t,r,n){for(var i=-1,o=e.length,a=-1,s=r.length,u=-1,l=t.length,c=br(o-s,0),d=se(c+l),f=!n;++i<c;)d[i]=e[i];for(var h=i;++u<l;)d[h+u]=t[u];for(;++a<s;)(f||i<o)&&(d[h+r[a]]=e[i++]);return d}function Oi(e,t){var r=-1,n=e.length;for(t||(t=se(n));++r<n;)t[r]=e[r];return t}function Ai(e,t,r,i){var o=!r;r||(r={});for(var a=-1,s=t.length;++a<s;){var u=t[a],l=i?i(r[u],e[u],u,r,e):n;l===n&&(l=e[u]),o?sn(r,u,l):rn(r,u,l)}return r}function Di(e,t){return function(r,n){var i=$a(r)?Mt:on,o=t?t():{};return i(r,e,co(n,2),o)}}function Pi(e){return Qn((function(t,r){var i=-1,o=r.length,a=o>1?r[o-1]:n,s=o>2?r[2]:n;for(a=e.length>3&&"function"==typeof a?(o--,a):n,s&&So(r[0],r[1],s)&&(a=o<3?n:a,o=1),t=Te(t);++i<o;){var u=r[i];u&&e(t,u,i,a)}return t}))}function Li(e,t){return function(r,n){if(null==r)return r;if(!Qa(r))return e(r,n);for(var i=r.length,o=t?i:-1,a=Te(r);(t?o--:++o<i)&&!1!==n(a[o],o,a););return r}}function Ui(e){return function(t,r,n){for(var i=-1,o=Te(t),a=n(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===r(o[u],u,o))break}return t}}function ji(e){return function(t){var r=or(t=ks(t))?dr(t):n,i=r?r[0]:t.charAt(0),o=r?Ei(r,1).join(""):t.slice(1);return i[e]()+o}}function Ni(e){return function(t){return Pt(nu(Zs(t).replace(Je,"")),e,"")}}function Bi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=qr(e.prototype),n=e.apply(r,t);return as(n)?n:r}}function Fi(e){return function(t,r,i){var o=Te(t);if(!Qa(t)){var a=co(r,3);t=js(t),r=function(e){return a(o[e],e,o)}}var s=e(t,r,i);return s>-1?o[a?t[s]:s]:n}}function Ki(e){return io((function(t){var r=t.length,i=r,a=Vr.prototype.thru;for(e&&t.reverse();i--;){var s=t[i];if("function"!=typeof s)throw new Oe(o);if(a&&!u&&"wrapper"==uo(s))var u=new Vr([],!0)}for(i=u?i:r;++i<r;){var l=uo(s=t[i]),c="wrapper"==l?so(s):n;u=c&&ko(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?u[uo(c[0])].apply(u,c[3]):1==s.length&&ko(s)?u[l]():u.thru(s)}return function(){var e=arguments,n=e[0];if(u&&1==e.length&&$a(n))return u.plant(n).value();for(var i=0,o=r?t[i].apply(this,e):n;++i<r;)o=t[i].call(this,o);return o}}))}function qi(e,t,r,i,o,a,s,u,l,c){var f=t&d,h=1&t,p=2&t,v=24&t,g=512&t,m=p?n:Bi(e);return function n(){for(var d=arguments.length,y=se(d),b=d;b--;)y[b]=arguments[b];if(v)var _=lo(n),w=tr(y,_);if(i&&(y=Ri(y,i,o,v)),a&&(y=xi(y,a,s,v)),d-=w,v&&d<c){var S=ur(y,_);return Zi(e,t,qi,n.placeholder,r,y,S,u,l,c-d)}var E=h?r:this,k=p?E[e]:e;return d=y.length,u?y=Oo(y,u):g&&d>1&&y.reverse(),f&&l<d&&(y.length=l),this&&this!==ft&&this instanceof n&&(k=m||Bi(k)),k.apply(E,y)}}function Wi(e,t){return function(r,n){return function(e,t,r,n){return Sn(e,(function(e,i,o){t(n,r(e),i,o)})),n}(r,e,t(n),{})}}function Vi(e,t){return function(r,i){var o;if(r===n&&i===n)return t;if(r!==n&&(o=r),i!==n){if(o===n)return i;"string"==typeof r||"string"==typeof i?(r=di(r),i=di(i)):(r=ci(r),i=ci(i)),o=e(r,i)}return o}}function Hi(e){return io((function(t){return t=At(t,$t(co())),Qn((function(r){var n=this;return e(t,(function(e){return kt(e,n,r)}))}))}))}function Gi(e,t){var r=(t=t===n?" ":di(t)).length;if(r<2)return r?Jn(t,e):t;var i=Jn(t,mt(e/cr(t)));return or(t)?Ei(dr(i),0,e).join(""):i.slice(0,e)}function zi(e){return function(t,r,i){return i&&"number"!=typeof i&&So(t,r,i)&&(r=i=n),t=bs(t),r===n?(r=t,t=0):r=bs(r),function(e,t,r,n){for(var i=-1,o=br(mt((t-e)/(r||1)),0),a=se(o);o--;)a[n?o:++i]=e,e+=r;return a}(t,r,i=i===n?t<r?1:-1:bs(i),e)}}function Yi(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=Ss(t),r=Ss(r)),e(t,r)}}function Zi(e,t,r,i,o,a,s,u,d,f){var h=8&t;t|=h?l:c,4&(t&=~(h?c:l))||(t&=-4);var p=[e,t,o,h?a:n,h?s:n,h?n:a,h?n:s,u,d,f],v=r.apply(n,p);return ko(e)&&Do(v,p),v.placeholder=i,Uo(v,e,t)}function $i(e){var t=Ie[e];return function(e,r){if(e=Ss(e),(r=null==r?0:_r(_s(r),292))&&gr(e)){var n=(ks(e)+"e").split("e");return+((n=(ks(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var Ji=Tr&&1/lr(new Tr([,-0]))[1]==h?function(e){return new Tr(e)}:pu;function Qi(e){return function(t){var r=mo(t);return r==M?ar(t):r==x?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return At(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Xi(e,t,r,i,a,h,p,v){var g=2&t;if(!g&&"function"!=typeof e)throw new Oe(o);var m=i?i.length:0;if(m||(t&=-97,i=a=n),p=p===n?p:br(_s(p),0),v=v===n?v:_s(v),m-=a?a.length:0,t&c){var y=i,b=a;i=a=n}var _=g?n:so(e),w=[e,t,r,i,a,y,b,h,p,v];if(_&&function(e,t){var r=e[1],n=t[1],i=r|n,o=i<131,a=n==d&&8==r||n==d&&r==f&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==r;if(!o&&!a)return e;1&n&&(e[2]=t[2],i|=1&r?0:4);var u=t[3];if(u){var l=e[3];e[3]=l?Ri(l,u,t[4]):u,e[4]=l?ur(e[3],s):t[4]}(u=t[5])&&(l=e[5],e[5]=l?xi(l,u,t[6]):u,e[6]=l?ur(e[5],s):t[6]);(u=t[7])&&(e[7]=u);n&d&&(e[8]=null==e[8]?t[8]:_r(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=i}(w,_),e=w[0],t=w[1],r=w[2],i=w[3],a=w[4],!(v=w[9]=w[9]===n?g?0:e.length:br(w[9]-m,0))&&24&t&&(t&=-25),t&&1!=t)S=8==t||t==u?function(e,t,r){var i=Bi(e);return function o(){for(var a=arguments.length,s=se(a),u=a,l=lo(o);u--;)s[u]=arguments[u];var c=a<3&&s[0]!==l&&s[a-1]!==l?[]:ur(s,l);return(a-=c.length)<r?Zi(e,t,qi,o.placeholder,n,s,c,n,n,r-a):kt(this&&this!==ft&&this instanceof o?i:e,this,s)}}(e,t,v):t!=l&&33!=t||a.length?qi.apply(n,w):function(e,t,r,n){var i=1&t,o=Bi(e);return function t(){for(var a=-1,s=arguments.length,u=-1,l=n.length,c=se(l+s),d=this&&this!==ft&&this instanceof t?o:e;++u<l;)c[u]=n[u];for(;s--;)c[u++]=arguments[++a];return kt(d,i?r:this,c)}}(e,t,r,i);else var S=function(e,t,r){var n=1&t,i=Bi(e);return function t(){return(this&&this!==ft&&this instanceof t?i:e).apply(n?r:this,arguments)}}(e,t,r);return Uo((_?ri:Do)(S,w),e,t)}function eo(e,t,r,i){return e===n||Ga(e,Pe[r])&&!je.call(i,r)?t:e}function to(e,t,r,i,o,a){return as(e)&&as(t)&&(a.set(t,e),Vn(e,t,n,to,a),a.delete(t)),e}function ro(e){return cs(e)?n:e}function no(e,t,r,i,o,a){var s=1&r,u=e.length,l=t.length;if(u!=l&&!(s&&l>u))return!1;var c=a.get(e),d=a.get(t);if(c&&d)return c==t&&d==e;var f=-1,h=!0,p=2&r?new Zr:n;for(a.set(e,t),a.set(t,e);++f<u;){var v=e[f],g=t[f];if(i)var m=s?i(g,v,f,t,e,a):i(v,g,f,e,t,a);if(m!==n){if(m)continue;h=!1;break}if(p){if(!Ut(t,(function(e,t){if(!Qt(p,t)&&(v===e||o(v,e,r,i,a)))return p.push(t)}))){h=!1;break}}else if(v!==g&&!o(v,g,r,i,a)){h=!1;break}}return a.delete(e),a.delete(t),h}function io(e){return Lo(Ro(e,n,Jo),e+"")}function oo(e){return Cn(e,js,vo)}function ao(e){return Cn(e,Ns,go)}var so=Or?function(e){return Or.get(e)}:pu;function uo(e){for(var t=e.name+"",r=Ar[t],n=je.call(Ar,t)?r.length:0;n--;){var i=r[n],o=i.func;if(null==o||o==e)return i.name}return t}function lo(e){return(je.call(Kr,"placeholder")?Kr:e).placeholder}function co(){var e=Kr.iteratee||cu;return e=e===cu?jn:e,arguments.length?e(arguments[0],arguments[1]):e}function fo(e,t){var r,n,o=e.__data__;return("string"==(n=void 0===(r=t)?"undefined":(0,i.default)(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function ho(e){for(var t=js(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Io(i)]}return t}function po(e,t){var r=function(e,t){return null==e?n:e[t]}(e,t);return Un(r)?r:n}var vo=Ht?function(e){return null==e?[]:(e=Te(e),Rt(Ht(e),(function(t){return $e.call(e,t)})))}:wu,go=Ht?function(e){for(var t=[];e;)Dt(t,vo(e)),e=Ye(e);return t}:wu,mo=In;function yo(e,t,r){for(var n=-1,i=(t=wi(t,e)).length,o=!1;++n<i;){var a=Wo(t[n]);if(!(o=null!=e&&r(e,a)))break;e=e[a]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&os(i)&&wo(a,i)&&($a(e)||Za(e))}function bo(e){return"function"!=typeof e.constructor||Co(e)?{}:qr(Ye(e))}function _o(e){return $a(e)||Za(e)||!!(tt&&e&&e[tt])}function wo(e,t){var r=void 0===e?"undefined":(0,i.default)(e);return!!(t=null==t?p:t)&&("number"==r||"symbol"!=r&&_e.test(e))&&e>-1&&e%1==0&&e<t}function So(e,t,r){if(!as(r))return!1;var n=void 0===t?"undefined":(0,i.default)(t);return!!("number"==n?Qa(r)&&wo(t,r.length):"string"==n&&t in r)&&Ga(r[t],e)}function Eo(e,t){if($a(e))return!1;var r=void 0===e?"undefined":(0,i.default)(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ps(e))||(re.test(e)||!te.test(e)||null!=t&&e in Te(t))}function ko(e){var t=uo(e),r=Kr[t];if("function"!=typeof r||!(t in Hr.prototype))return!1;if(e===r)return!0;var n=so(r);return!!n&&e===n[0]}(Mr&&mo(new Mr(new ArrayBuffer(1)))!=L||Cr&&mo(new Cr)!=M||Ir&&mo(Ir.resolve())!=T||Tr&&mo(new Tr)!=x||Rr&&mo(new Rr)!=D)&&(mo=function(e){var t=In(e),r=t==I?e.constructor:n,i=r?Vo(r):"";if(i)switch(i){case Dr:return L;case Pr:return M;case Lr:return T;case Ur:return x;case jr:return D}return t});var Mo=Le?ns:Su;function Co(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Pe)}function Io(e){return e==e&&!as(e)}function To(e,t){return function(r){return null!=r&&(r[e]===t&&(t!==n||e in Te(r)))}}function Ro(e,t,r){return t=br(t===n?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=br(n.length-t,0),a=se(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=se(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),kt(e,this,s)}}function xo(e,t){return t.length<2?e:Mn(e,oi(t,0,-1))}function Oo(e,t){for(var r=e.length,i=_r(t.length,r),o=Oi(e);i--;){var a=t[i];e[i]=wo(a,r)?o[a]:n}return e}function Ao(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Do=jo(ri),Po=gt||function(e,t){return ft.setTimeout(e,t)},Lo=jo(ni);function Uo(e,t,r){var n=t+"";return Lo(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(ue,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return Ct(m,(function(r){var n="_."+r[0];t&r[1]&&!xt(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(le);return t?t[1].split(ce):[]}(n),r)))}function jo(e){var t=0,r=0;return function(){var i=wr(),o=16-(i-r);if(r=i,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(n,arguments)}}function No(e,t){var r=-1,i=e.length,o=i-1;for(t=t===n?i:t;++r<t;){var a=$n(r,o),s=e[a];e[a]=e[r],e[r]=s}return e.length=t,e}var Bo,Fo,Ko,qo=(Bo=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ne,(function(e,r,n,i){t.push(n?i.replace(he,"$1"):r||e)})),t},Fo=Fa(Bo,(function(e){return 500===Ko.size&&Ko.clear(),e})),Ko=Fo.cache,Fo);function Wo(e){if("string"==typeof e||ps(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Vo(e){if(null!=e){try{return Ue.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ho(e){if(e instanceof Hr)return e.clone();var t=new Vr(e.__wrapped__,e.__chain__);return t.__actions__=Oi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Go=Qn((function(e,t){return Xa(e)?hn(e,bn(t,1,Xa,!0)):[]})),zo=Qn((function(e,t){var r=ra(t);return Xa(r)&&(r=n),Xa(e)?hn(e,bn(t,1,Xa,!0),co(r,2)):[]})),Yo=Qn((function(e,t){var r=ra(t);return Xa(r)&&(r=n),Xa(e)?hn(e,bn(t,1,Xa,!0),n,r):[]}));function Zo(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:_s(r);return i<0&&(i=br(n+i,0)),Bt(e,co(t,3),i)}function $o(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var o=i-1;return r!==n&&(o=_s(r),o=r<0?br(i+o,0):_r(o,i-1)),Bt(e,co(t,3),o,!0)}function Jo(e){return(null==e?0:e.length)?bn(e,1):[]}function Qo(e){return e&&e.length?e[0]:n}var Xo=Qn((function(e){var t=At(e,bi);return t.length&&t[0]===e[0]?On(t):[]})),ea=Qn((function(e){var t=ra(e),r=At(e,bi);return t===ra(r)?t=n:r.pop(),r.length&&r[0]===e[0]?On(r,co(t,2)):[]})),ta=Qn((function(e){var t=ra(e),r=At(e,bi);return(t="function"==typeof t?t:n)&&r.pop(),r.length&&r[0]===e[0]?On(r,n,t):[]}));function ra(e){var t=null==e?0:e.length;return t?e[t-1]:n}var na=Qn(ia);function ia(e,t){return e&&e.length&&t&&t.length?Yn(e,t):e}var oa=io((function(e,t){var r=null==e?0:e.length,n=un(e,t);return Zn(e,At(t,(function(e){return wo(e,r)?+e:e})).sort(Ti)),n}));function aa(e){return null==e?e:kr.call(e)}var sa=Qn((function(e){return fi(bn(e,1,Xa,!0))})),ua=Qn((function(e){var t=ra(e);return Xa(t)&&(t=n),fi(bn(e,1,Xa,!0),co(t,2))})),la=Qn((function(e){var t=ra(e);return t="function"==typeof t?t:n,fi(bn(e,1,Xa,!0),n,t)}));function ca(e){if(!e||!e.length)return[];var t=0;return e=Rt(e,(function(e){if(Xa(e))return t=br(e.length,t),!0})),Yt(t,(function(t){return At(e,Vt(t))}))}function da(e,t){if(!e||!e.length)return[];var r=ca(e);return null==t?r:At(r,(function(e){return kt(t,n,e)}))}var fa=Qn((function(e,t){return Xa(e)?hn(e,t):[]})),ha=Qn((function(e){return mi(Rt(e,Xa))})),pa=Qn((function(e){var t=ra(e);return Xa(t)&&(t=n),mi(Rt(e,Xa),co(t,2))})),va=Qn((function(e){var t=ra(e);return t="function"==typeof t?t:n,mi(Rt(e,Xa),n,t)})),ga=Qn(ca);var ma=Qn((function(e){var t=e.length,r=t>1?e[t-1]:n;return r="function"==typeof r?(e.pop(),r):n,da(e,r)}));function ya(e){var t=Kr(e);return t.__chain__=!0,t}function ba(e,t){return t(e)}var _a=io((function(e){var t=e.length,r=t?e[0]:0,i=this.__wrapped__,o=function(t){return un(t,e)};return!(t>1||this.__actions__.length)&&i instanceof Hr&&wo(r)?((i=i.slice(r,+r+(t?1:0))).__actions__.push({func:ba,args:[o],thisArg:n}),new Vr(i,this.__chain__).thru((function(e){return t&&!e.length&&e.push(n),e}))):this.thru(o)}));var wa=Di((function(e,t,r){je.call(e,r)?++e[r]:sn(e,r,1)}));var Sa=Fi(Zo),Ea=Fi($o);function ka(e,t){return($a(e)?Ct:pn)(e,co(t,3))}function Ma(e,t){return($a(e)?It:vn)(e,co(t,3))}var Ca=Di((function(e,t,r){je.call(e,r)?e[r].push(t):sn(e,r,[t])}));var Ia=Qn((function(e,t,r){var n=-1,i="function"==typeof t,o=Qa(e)?se(e.length):[];return pn(e,(function(e){o[++n]=i?kt(t,e,r):An(e,t,r)})),o})),Ta=Di((function(e,t,r){sn(e,r,t)}));function Ra(e,t){return($a(e)?At:Kn)(e,co(t,3))}var xa=Di((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]}));var Oa=Qn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&So(e,t[0],t[1])?t=[]:r>2&&So(t[0],t[1],t[2])&&(t=[t[0]]),Gn(e,bn(t,1),[])})),Aa=pt||function(){return ft.Date.now()};function Da(e,t,r){return t=r?n:t,t=e&&null==t?e.length:t,Xi(e,d,n,n,n,n,t)}function Pa(e,t){var r;if("function"!=typeof t)throw new Oe(o);return e=_s(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=n),r}}var La=Qn((function(e,t,r){var n=1;if(r.length){var i=ur(r,lo(La));n|=l}return Xi(e,n,t,r,i)})),Ua=Qn((function(e,t,r){var n=3;if(r.length){var i=ur(r,lo(Ua));n|=l}return Xi(t,n,e,r,i)}));function ja(e,t,r){var i,a,s,u,l,c,d=0,f=!1,h=!1,p=!0;if("function"!=typeof e)throw new Oe(o);function v(t){var r=i,o=a;return i=a=n,d=t,u=e.apply(o,r)}function g(e){return d=e,l=Po(y,t),f?v(e):u}function m(e){var r=e-c;return c===n||r>=t||r<0||h&&e-d>=s}function y(){var e=Aa();if(m(e))return b(e);l=Po(y,function(e){var r=t-(e-c);return h?_r(r,s-(e-d)):r}(e))}function b(e){return l=n,p&&i?v(e):(i=a=n,u)}function _(){var e=Aa(),r=m(e);if(i=arguments,a=this,c=e,r){if(l===n)return g(c);if(h)return ki(l),l=Po(y,t),v(c)}return l===n&&(l=Po(y,t)),u}return t=Ss(t)||0,as(r)&&(f=!!r.leading,s=(h="maxWait"in r)?br(Ss(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p),_.cancel=function(){l!==n&&ki(l),d=0,i=c=a=l=n},_.flush=function(){return l===n?u:b(Aa())},_}var Na=Qn((function(e,t){return fn(e,1,t)})),Ba=Qn((function(e,t,r){return fn(e,Ss(t)||0,r)}));function Fa(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Oe(o);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(Fa.Cache||Yr),r}function Ka(e){if("function"!=typeof e)throw new Oe(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Fa.Cache=Yr;var qa=Si((function(e,t){var r=(t=1==t.length&&$a(t[0])?At(t[0],$t(co())):At(bn(t,1),$t(co()))).length;return Qn((function(n){for(var i=-1,o=_r(n.length,r);++i<o;)n[i]=t[i].call(this,n[i]);return kt(e,this,n)}))})),Wa=Qn((function(e,t){var r=ur(t,lo(Wa));return Xi(e,l,n,t,r)})),Va=Qn((function(e,t){var r=ur(t,lo(Va));return Xi(e,c,n,t,r)})),Ha=io((function(e,t){return Xi(e,f,n,n,n,t)}));function Ga(e,t){return e===t||e!=e&&t!=t}var za=Yi(Tn),Ya=Yi((function(e,t){return e>=t})),Za=Dn(function(){return arguments}())?Dn:function(e){return ss(e)&&je.call(e,"callee")&&!$e.call(e,"callee")},$a=se.isArray,Ja=yt?$t(yt):function(e){return ss(e)&&In(e)==P};function Qa(e){return null!=e&&os(e.length)&&!ns(e)}function Xa(e){return ss(e)&&Qa(e)}var es=vr||Su,ts=bt?$t(bt):function(e){return ss(e)&&In(e)==w};function rs(e){if(!ss(e))return!1;var t=In(e);return t==S||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!cs(e)}function ns(e){if(!as(e))return!1;var t=In(e);return t==E||t==k||"[object AsyncFunction]"==t||"[object Proxy]"==t}function is(e){return"number"==typeof e&&e==_s(e)}function os(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=p}function as(e){var t=void 0===e?"undefined":(0,i.default)(e);return null!=e&&("object"==t||"function"==t)}function ss(e){return null!=e&&"object"==typeof e}var us=_t?$t(_t):function(e){return ss(e)&&mo(e)==M};function ls(e){return"number"==typeof e||ss(e)&&In(e)==C}function cs(e){if(!ss(e)||In(e)!=I)return!1;var t=Ye(e);if(null===t)return!0;var r=je.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Ue.call(r)==Ke}var ds=wt?$t(wt):function(e){return ss(e)&&In(e)==R};var fs=St?$t(St):function(e){return ss(e)&&mo(e)==x};function hs(e){return"string"==typeof e||!$a(e)&&ss(e)&&In(e)==O}function ps(e){return"symbol"==(void 0===e?"undefined":(0,i.default)(e))||ss(e)&&In(e)==A}var vs=Et?$t(Et):function(e){return ss(e)&&os(e.length)&&!!ot[In(e)]};var gs=Yi(Fn),ms=Yi((function(e,t){return e<=t}));function ys(e){if(!e)return[];if(Qa(e))return hs(e)?dr(e):Oi(e);if(st&&e[st])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[st]());var t=mo(e);return(t==M?ar:t==x?lr:Gs)(e)}function bs(e){return e?(e=Ss(e))===h||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function _s(e){var t=bs(e),r=t%1;return t==t?r?t-r:t:0}function ws(e){return e?ln(_s(e),0,g):0}function Ss(e){if("number"==typeof e)return e;if(ps(e))return v;if(as(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=as(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Zt(e);var r=me.test(e);return r||be.test(e)?lt(e.slice(2),r?2:8):ge.test(e)?v:+e}function Es(e){return Ai(e,Ns(e))}function ks(e){return null==e?"":di(e)}var Ms=Pi((function(e,t){if(Co(t)||Qa(t))Ai(t,js(t),e);else for(var r in t)je.call(t,r)&&rn(e,r,t[r])})),Cs=Pi((function(e,t){Ai(t,Ns(t),e)})),Is=Pi((function(e,t,r,n){Ai(t,Ns(t),e,n)})),Ts=Pi((function(e,t,r,n){Ai(t,js(t),e,n)})),Rs=io(un);var xs=Qn((function(e,t){e=Te(e);var r=-1,i=t.length,o=i>2?t[2]:n;for(o&&So(t[0],t[1],o)&&(i=1);++r<i;)for(var a=t[r],s=Ns(a),u=-1,l=s.length;++u<l;){var c=s[u],d=e[c];(d===n||Ga(d,Pe[c])&&!je.call(e,c))&&(e[c]=a[c])}return e})),Os=Qn((function(e){return e.push(n,to),kt(Fs,n,e)}));function As(e,t,r){var i=null==e?n:Mn(e,t);return i===n?r:i}function Ds(e,t){return null!=e&&yo(e,t,xn)}var Ps=Wi((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Fe.call(t)),e[t]=r}),au(lu)),Ls=Wi((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Fe.call(t)),je.call(e,t)?e[t].push(r):e[t]=[r]}),co),Us=Qn(An);function js(e){return Qa(e)?Jr(e):Nn(e)}function Ns(e){return Qa(e)?Jr(e,!0):Bn(e)}var Bs=Pi((function(e,t,r){Vn(e,t,r)})),Fs=Pi((function(e,t,r,n){Vn(e,t,r,n)})),Ks=io((function(e,t){var r={};if(null==e)return r;var n=!1;t=At(t,(function(t){return t=wi(t,e),n||(n=t.length>1),t})),Ai(e,ao(e),r),n&&(r=cn(r,7,ro));for(var i=t.length;i--;)hi(r,t[i]);return r}));var qs=io((function(e,t){return null==e?{}:function(e,t){return zn(e,t,(function(t,r){return Ds(e,r)}))}(e,t)}));function Ws(e,t){if(null==e)return{};var r=At(ao(e),(function(e){return[e]}));return t=co(t),zn(e,r,(function(e,r){return t(e,r[0])}))}var Vs=Qi(js),Hs=Qi(Ns);function Gs(e){return null==e?[]:Jt(e,js(e))}var zs=Ni((function(e,t,r){return t=t.toLowerCase(),e+(r?Ys(t):t)}));function Ys(e){return ru(ks(e).toLowerCase())}function Zs(e){return(e=ks(e))&&e.replace(we,rr).replace(Qe,"")}var $s=Ni((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),Js=Ni((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Qs=ji("toLowerCase");var Xs=Ni((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}));var eu=Ni((function(e,t,r){return e+(r?" ":"")+ru(t)}));var tu=Ni((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),ru=ji("toUpperCase");function nu(e,t,r){return e=ks(e),(t=r?n:t)===n?function(e){return rt.test(e)}(e)?function(e){return e.match(et)||[]}(e):function(e){return e.match(de)||[]}(e):e.match(t)||[]}var iu=Qn((function(e,t){try{return kt(e,n,t)}catch(e){return rs(e)?e:new Me(e)}})),ou=io((function(e,t){return Ct(t,(function(t){t=Wo(t),sn(e,t,La(e[t],e))})),e}));function au(e){return function(){return e}}var su=Ki(),uu=Ki(!0);function lu(e){return e}function cu(e){return jn("function"==typeof e?e:cn(e,1))}var du=Qn((function(e,t){return function(r){return An(r,e,t)}})),fu=Qn((function(e,t){return function(r){return An(e,r,t)}}));function hu(e,t,r){var n=js(t),i=kn(t,n);null!=r||as(t)&&(i.length||!n.length)||(r=t,t=e,e=this,i=kn(t,js(t)));var o=!(as(r)&&"chain"in r&&!r.chain),a=ns(e);return Ct(i,(function(r){var n=t[r];e[r]=n,a&&(e.prototype[r]=function(){var t=this.__chain__;if(o||t){var r=e(this.__wrapped__),i=r.__actions__=Oi(this.__actions__);return i.push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,Dt([this.value()],arguments))})})),e}function pu(){}var vu=Hi(At),gu=Hi(Tt),mu=Hi(Ut);function yu(e){return Eo(e)?Vt(Wo(e)):function(e){return function(t){return Mn(t,e)}}(e)}var bu=zi(),_u=zi(!0);function wu(){return[]}function Su(){return!1}var Eu=Vi((function(e,t){return e+t}),0),ku=$i("ceil"),Mu=Vi((function(e,t){return e/t}),1),Cu=$i("floor");var Iu,Tu=Vi((function(e,t){return e*t}),1),Ru=$i("round"),xu=Vi((function(e,t){return e-t}),0);return Kr.after=function(e,t){if("function"!=typeof t)throw new Oe(o);return e=_s(e),function(){if(--e<1)return t.apply(this,arguments)}},Kr.ary=Da,Kr.assign=Ms,Kr.assignIn=Cs,Kr.assignInWith=Is,Kr.assignWith=Ts,Kr.at=Rs,Kr.before=Pa,Kr.bind=La,Kr.bindAll=ou,Kr.bindKey=Ua,Kr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return $a(e)?e:[e]},Kr.chain=ya,Kr.chunk=function(e,t,r){t=(r?So(e,t,r):t===n)?1:br(_s(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var o=0,a=0,s=se(mt(i/t));o<i;)s[a++]=oi(e,o,o+=t);return s},Kr.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var o=e[t];o&&(i[n++]=o)}return i},Kr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=se(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return Dt($a(r)?Oi(r):[r],bn(t,1))},Kr.cond=function(e){var t=null==e?0:e.length,r=co();return e=t?At(e,(function(e){if("function"!=typeof e[1])throw new Oe(o);return[r(e[0]),e[1]]})):[],Qn((function(r){for(var n=-1;++n<t;){var i=e[n];if(kt(i[0],this,r))return kt(i[1],this,r)}}))},Kr.conforms=function(e){return function(e){var t=js(e);return function(r){return dn(r,e,t)}}(cn(e,1))},Kr.constant=au,Kr.countBy=wa,Kr.create=function(e,t){var r=qr(e);return null==t?r:an(r,t)},Kr.curry=function e(t,r,i){var o=Xi(t,8,n,n,n,n,n,r=i?n:r);return o.placeholder=e.placeholder,o},Kr.curryRight=function e(t,r,i){var o=Xi(t,u,n,n,n,n,n,r=i?n:r);return o.placeholder=e.placeholder,o},Kr.debounce=ja,Kr.defaults=xs,Kr.defaultsDeep=Os,Kr.defer=Na,Kr.delay=Ba,Kr.difference=Go,Kr.differenceBy=zo,Kr.differenceWith=Yo,Kr.drop=function(e,t,r){var i=null==e?0:e.length;return i?oi(e,(t=r||t===n?1:_s(t))<0?0:t,i):[]},Kr.dropRight=function(e,t,r){var i=null==e?0:e.length;return i?oi(e,0,(t=i-(t=r||t===n?1:_s(t)))<0?0:t):[]},Kr.dropRightWhile=function(e,t){return e&&e.length?vi(e,co(t,3),!0,!0):[]},Kr.dropWhile=function(e,t){return e&&e.length?vi(e,co(t,3),!0):[]},Kr.fill=function(e,t,r,i){var o=null==e?0:e.length;return o?(r&&"number"!=typeof r&&So(e,t,r)&&(r=0,i=o),function(e,t,r,i){var o=e.length;for((r=_s(r))<0&&(r=-r>o?0:o+r),(i=i===n||i>o?o:_s(i))<0&&(i+=o),i=r>i?0:ws(i);r<i;)e[r++]=t;return e}(e,t,r,i)):[]},Kr.filter=function(e,t){return($a(e)?Rt:yn)(e,co(t,3))},Kr.flatMap=function(e,t){return bn(Ra(e,t),1)},Kr.flatMapDeep=function(e,t){return bn(Ra(e,t),h)},Kr.flatMapDepth=function(e,t,r){return r=r===n?1:_s(r),bn(Ra(e,t),r)},Kr.flatten=Jo,Kr.flattenDeep=function(e){return(null==e?0:e.length)?bn(e,h):[]},Kr.flattenDepth=function(e,t){return(null==e?0:e.length)?bn(e,t=t===n?1:_s(t)):[]},Kr.flip=function(e){return Xi(e,512)},Kr.flow=su,Kr.flowRight=uu,Kr.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},Kr.functions=function(e){return null==e?[]:kn(e,js(e))},Kr.functionsIn=function(e){return null==e?[]:kn(e,Ns(e))},Kr.groupBy=Ca,Kr.initial=function(e){return(null==e?0:e.length)?oi(e,0,-1):[]},Kr.intersection=Xo,Kr.intersectionBy=ea,Kr.intersectionWith=ta,Kr.invert=Ps,Kr.invertBy=Ls,Kr.invokeMap=Ia,Kr.iteratee=cu,Kr.keyBy=Ta,Kr.keys=js,Kr.keysIn=Ns,Kr.map=Ra,Kr.mapKeys=function(e,t){var r={};return t=co(t,3),Sn(e,(function(e,n,i){sn(r,t(e,n,i),e)})),r},Kr.mapValues=function(e,t){var r={};return t=co(t,3),Sn(e,(function(e,n,i){sn(r,n,t(e,n,i))})),r},Kr.matches=function(e){return qn(cn(e,1))},Kr.matchesProperty=function(e,t){return Wn(e,cn(t,1))},Kr.memoize=Fa,Kr.merge=Bs,Kr.mergeWith=Fs,Kr.method=du,Kr.methodOf=fu,Kr.mixin=hu,Kr.negate=Ka,Kr.nthArg=function(e){return e=_s(e),Qn((function(t){return Hn(t,e)}))},Kr.omit=Ks,Kr.omitBy=function(e,t){return Ws(e,Ka(co(t)))},Kr.once=function(e){return Pa(2,e)},Kr.orderBy=function(e,t,r,i){return null==e?[]:($a(t)||(t=null==t?[]:[t]),$a(r=i?n:r)||(r=null==r?[]:[r]),Gn(e,t,r))},Kr.over=vu,Kr.overArgs=qa,Kr.overEvery=gu,Kr.overSome=mu,Kr.partial=Wa,Kr.partialRight=Va,Kr.partition=xa,Kr.pick=qs,Kr.pickBy=Ws,Kr.property=yu,Kr.propertyOf=function(e){return function(t){return null==e?n:Mn(e,t)}},Kr.pull=na,Kr.pullAll=ia,Kr.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Yn(e,t,co(r,2)):e},Kr.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?Yn(e,t,n,r):e},Kr.pullAt=oa,Kr.range=bu,Kr.rangeRight=_u,Kr.rearg=Ha,Kr.reject=function(e,t){return($a(e)?Rt:yn)(e,Ka(co(t,3)))},Kr.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],o=e.length;for(t=co(t,3);++n<o;){var a=e[n];t(a,n,e)&&(r.push(a),i.push(n))}return Zn(e,i),r},Kr.rest=function(e,t){if("function"!=typeof e)throw new Oe(o);return Qn(e,t=t===n?t:_s(t))},Kr.reverse=aa,Kr.sampleSize=function(e,t,r){return t=(r?So(e,t,r):t===n)?1:_s(t),($a(e)?Xr:ei)(e,t)},Kr.set=function(e,t,r){return null==e?e:ti(e,t,r)},Kr.setWith=function(e,t,r,i){return i="function"==typeof i?i:n,null==e?e:ti(e,t,r,i)},Kr.shuffle=function(e){return($a(e)?en:ii)(e)},Kr.slice=function(e,t,r){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&So(e,t,r)?(t=0,r=i):(t=null==t?0:_s(t),r=r===n?i:_s(r)),oi(e,t,r)):[]},Kr.sortBy=Oa,Kr.sortedUniq=function(e){return e&&e.length?li(e):[]},Kr.sortedUniqBy=function(e,t){return e&&e.length?li(e,co(t,2)):[]},Kr.split=function(e,t,r){return r&&"number"!=typeof r&&So(e,t,r)&&(t=r=n),(r=r===n?g:r>>>0)?(e=ks(e))&&("string"==typeof t||null!=t&&!ds(t))&&!(t=di(t))&&or(e)?Ei(dr(e),0,r):e.split(t,r):[]},Kr.spread=function(e,t){if("function"!=typeof e)throw new Oe(o);return t=null==t?0:br(_s(t),0),Qn((function(r){var n=r[t],i=Ei(r,0,t);return n&&Dt(i,n),kt(e,this,i)}))},Kr.tail=function(e){var t=null==e?0:e.length;return t?oi(e,1,t):[]},Kr.take=function(e,t,r){return e&&e.length?oi(e,0,(t=r||t===n?1:_s(t))<0?0:t):[]},Kr.takeRight=function(e,t,r){var i=null==e?0:e.length;return i?oi(e,(t=i-(t=r||t===n?1:_s(t)))<0?0:t,i):[]},Kr.takeRightWhile=function(e,t){return e&&e.length?vi(e,co(t,3),!1,!0):[]},Kr.takeWhile=function(e,t){return e&&e.length?vi(e,co(t,3)):[]},Kr.tap=function(e,t){return t(e),e},Kr.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new Oe(o);return as(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),ja(e,t,{leading:n,maxWait:t,trailing:i})},Kr.thru=ba,Kr.toArray=ys,Kr.toPairs=Vs,Kr.toPairsIn=Hs,Kr.toPath=function(e){return $a(e)?At(e,Wo):ps(e)?[e]:Oi(qo(ks(e)))},Kr.toPlainObject=Es,Kr.transform=function(e,t,r){var n=$a(e),i=n||es(e)||vs(e);if(t=co(t,4),null==r){var o=e&&e.constructor;r=i?n?new o:[]:as(e)&&ns(o)?qr(Ye(e)):{}}return(i?Ct:Sn)(e,(function(e,n,i){return t(r,e,n,i)})),r},Kr.unary=function(e){return Da(e,1)},Kr.union=sa,Kr.unionBy=ua,Kr.unionWith=la,Kr.uniq=function(e){return e&&e.length?fi(e):[]},Kr.uniqBy=function(e,t){return e&&e.length?fi(e,co(t,2)):[]},Kr.uniqWith=function(e,t){return t="function"==typeof t?t:n,e&&e.length?fi(e,n,t):[]},Kr.unset=function(e,t){return null==e||hi(e,t)},Kr.unzip=ca,Kr.unzipWith=da,Kr.update=function(e,t,r){return null==e?e:pi(e,t,_i(r))},Kr.updateWith=function(e,t,r,i){return i="function"==typeof i?i:n,null==e?e:pi(e,t,_i(r),i)},Kr.values=Gs,Kr.valuesIn=function(e){return null==e?[]:Jt(e,Ns(e))},Kr.without=fa,Kr.words=nu,Kr.wrap=function(e,t){return Wa(_i(t),e)},Kr.xor=ha,Kr.xorBy=pa,Kr.xorWith=va,Kr.zip=ga,Kr.zipObject=function(e,t){return yi(e||[],t||[],rn)},Kr.zipObjectDeep=function(e,t){return yi(e||[],t||[],ti)},Kr.zipWith=ma,Kr.entries=Vs,Kr.entriesIn=Hs,Kr.extend=Cs,Kr.extendWith=Is,hu(Kr,Kr),Kr.add=Eu,Kr.attempt=iu,Kr.camelCase=zs,Kr.capitalize=Ys,Kr.ceil=ku,Kr.clamp=function(e,t,r){return r===n&&(r=t,t=n),r!==n&&(r=(r=Ss(r))==r?r:0),t!==n&&(t=(t=Ss(t))==t?t:0),ln(Ss(e),t,r)},Kr.clone=function(e){return cn(e,4)},Kr.cloneDeep=function(e){return cn(e,5)},Kr.cloneDeepWith=function(e,t){return cn(e,5,t="function"==typeof t?t:n)},Kr.cloneWith=function(e,t){return cn(e,4,t="function"==typeof t?t:n)},Kr.conformsTo=function(e,t){return null==t||dn(e,t,js(t))},Kr.deburr=Zs,Kr.defaultTo=function(e,t){return null==e||e!=e?t:e},Kr.divide=Mu,Kr.endsWith=function(e,t,r){e=ks(e),t=di(t);var i=e.length,o=r=r===n?i:ln(_s(r),0,i);return(r-=t.length)>=0&&e.slice(r,o)==t},Kr.eq=Ga,Kr.escape=function(e){return(e=ks(e))&&J.test(e)?e.replace(Z,nr):e},Kr.escapeRegExp=function(e){return(e=ks(e))&&oe.test(e)?e.replace(ie,"\\$&"):e},Kr.every=function(e,t,r){var i=$a(e)?Tt:gn;return r&&So(e,t,r)&&(t=n),i(e,co(t,3))},Kr.find=Sa,Kr.findIndex=Zo,Kr.findKey=function(e,t){return Nt(e,co(t,3),Sn)},Kr.findLast=Ea,Kr.findLastIndex=$o,Kr.findLastKey=function(e,t){return Nt(e,co(t,3),En)},Kr.floor=Cu,Kr.forEach=ka,Kr.forEachRight=Ma,Kr.forIn=function(e,t){return null==e?e:_n(e,co(t,3),Ns)},Kr.forInRight=function(e,t){return null==e?e:wn(e,co(t,3),Ns)},Kr.forOwn=function(e,t){return e&&Sn(e,co(t,3))},Kr.forOwnRight=function(e,t){return e&&En(e,co(t,3))},Kr.get=As,Kr.gt=za,Kr.gte=Ya,Kr.has=function(e,t){return null!=e&&yo(e,t,Rn)},Kr.hasIn=Ds,Kr.head=Qo,Kr.identity=lu,Kr.includes=function(e,t,r,n){e=Qa(e)?e:Gs(e),r=r&&!n?_s(r):0;var i=e.length;return r<0&&(r=br(i+r,0)),hs(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Ft(e,t,r)>-1},Kr.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:_s(r);return i<0&&(i=br(n+i,0)),Ft(e,t,i)},Kr.inRange=function(e,t,r){return t=bs(t),r===n?(r=t,t=0):r=bs(r),function(e,t,r){return e>=_r(t,r)&&e<br(t,r)}(e=Ss(e),t,r)},Kr.invoke=Us,Kr.isArguments=Za,Kr.isArray=$a,Kr.isArrayBuffer=Ja,Kr.isArrayLike=Qa,Kr.isArrayLikeObject=Xa,Kr.isBoolean=function(e){return!0===e||!1===e||ss(e)&&In(e)==_},Kr.isBuffer=es,Kr.isDate=ts,Kr.isElement=function(e){return ss(e)&&1===e.nodeType&&!cs(e)},Kr.isEmpty=function(e){if(null==e)return!0;if(Qa(e)&&($a(e)||"string"==typeof e||"function"==typeof e.splice||es(e)||vs(e)||Za(e)))return!e.length;var t=mo(e);if(t==M||t==x)return!e.size;if(Co(e))return!Nn(e).length;for(var r in e)if(je.call(e,r))return!1;return!0},Kr.isEqual=function(e,t){return Pn(e,t)},Kr.isEqualWith=function(e,t,r){var i=(r="function"==typeof r?r:n)?r(e,t):n;return i===n?Pn(e,t,n,r):!!i},Kr.isError=rs,Kr.isFinite=function(e){return"number"==typeof e&&gr(e)},Kr.isFunction=ns,Kr.isInteger=is,Kr.isLength=os,Kr.isMap=us,Kr.isMatch=function(e,t){return e===t||Ln(e,t,ho(t))},Kr.isMatchWith=function(e,t,r){return r="function"==typeof r?r:n,Ln(e,t,ho(t),r)},Kr.isNaN=function(e){return ls(e)&&e!=+e},Kr.isNative=function(e){if(Mo(e))throw new Me("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Un(e)},Kr.isNil=function(e){return null==e},Kr.isNull=function(e){return null===e},Kr.isNumber=ls,Kr.isObject=as,Kr.isObjectLike=ss,Kr.isPlainObject=cs,Kr.isRegExp=ds,Kr.isSafeInteger=function(e){return is(e)&&e>=-9007199254740991&&e<=p},Kr.isSet=fs,Kr.isString=hs,Kr.isSymbol=ps,Kr.isTypedArray=vs,Kr.isUndefined=function(e){return e===n},Kr.isWeakMap=function(e){return ss(e)&&mo(e)==D},Kr.isWeakSet=function(e){return ss(e)&&"[object WeakSet]"==In(e)},Kr.join=function(e,t){return null==e?"":mr.call(e,t)},Kr.kebabCase=$s,Kr.last=ra,Kr.lastIndexOf=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var o=i;return r!==n&&(o=(o=_s(r))<0?br(i+o,0):_r(o,i-1)),t==t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,o):Bt(e,qt,o,!0)},Kr.lowerCase=Js,Kr.lowerFirst=Qs,Kr.lt=gs,Kr.lte=ms,Kr.max=function(e){return e&&e.length?mn(e,lu,Tn):n},Kr.maxBy=function(e,t){return e&&e.length?mn(e,co(t,2),Tn):n},Kr.mean=function(e){return Wt(e,lu)},Kr.meanBy=function(e,t){return Wt(e,co(t,2))},Kr.min=function(e){return e&&e.length?mn(e,lu,Fn):n},Kr.minBy=function(e,t){return e&&e.length?mn(e,co(t,2),Fn):n},Kr.stubArray=wu,Kr.stubFalse=Su,Kr.stubObject=function(){return{}},Kr.stubString=function(){return""},Kr.stubTrue=function(){return!0},Kr.multiply=Tu,Kr.nth=function(e,t){return e&&e.length?Hn(e,_s(t)):n},Kr.noConflict=function(){return ft._===this&&(ft._=qe),this},Kr.noop=pu,Kr.now=Aa,Kr.pad=function(e,t,r){e=ks(e);var n=(t=_s(t))?cr(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return Gi(jt(i),r)+e+Gi(mt(i),r)},Kr.padEnd=function(e,t,r){e=ks(e);var n=(t=_s(t))?cr(e):0;return t&&n<t?e+Gi(t-n,r):e},Kr.padStart=function(e,t,r){e=ks(e);var n=(t=_s(t))?cr(e):0;return t&&n<t?Gi(t-n,r)+e:e},Kr.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),Sr(ks(e).replace(ae,""),t||0)},Kr.random=function(e,t,r){if(r&&"boolean"!=typeof r&&So(e,t,r)&&(t=r=n),r===n&&("boolean"==typeof t?(r=t,t=n):"boolean"==typeof e&&(r=e,e=n)),e===n&&t===n?(e=0,t=1):(e=bs(e),t===n?(t=e,e=0):t=bs(t)),e>t){var i=e;e=t,t=i}if(r||e%1||t%1){var o=Er();return _r(e+o*(t-e+ut("1e-"+((o+"").length-1))),t)}return $n(e,t)},Kr.reduce=function(e,t,r){var n=$a(e)?Pt:Gt,i=arguments.length<3;return n(e,co(t,4),r,i,pn)},Kr.reduceRight=function(e,t,r){var n=$a(e)?Lt:Gt,i=arguments.length<3;return n(e,co(t,4),r,i,vn)},Kr.repeat=function(e,t,r){return t=(r?So(e,t,r):t===n)?1:_s(t),Jn(ks(e),t)},Kr.replace=function(){var e=arguments,t=ks(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Kr.result=function(e,t,r){var i=-1,o=(t=wi(t,e)).length;for(o||(o=1,e=n);++i<o;){var a=null==e?n:e[Wo(t[i])];a===n&&(i=o,a=r),e=ns(a)?a.call(e):a}return e},Kr.round=Ru,Kr.runInContext=e,Kr.sample=function(e){return($a(e)?Qr:Xn)(e)},Kr.size=function(e){if(null==e)return 0;if(Qa(e))return hs(e)?cr(e):e.length;var t=mo(e);return t==M||t==x?e.size:Nn(e).length},Kr.snakeCase=Xs,Kr.some=function(e,t,r){var i=$a(e)?Ut:ai;return r&&So(e,t,r)&&(t=n),i(e,co(t,3))},Kr.sortedIndex=function(e,t){return si(e,t)},Kr.sortedIndexBy=function(e,t,r){return ui(e,t,co(r,2))},Kr.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=si(e,t);if(n<r&&Ga(e[n],t))return n}return-1},Kr.sortedLastIndex=function(e,t){return si(e,t,!0)},Kr.sortedLastIndexBy=function(e,t,r){return ui(e,t,co(r,2),!0)},Kr.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=si(e,t,!0)-1;if(Ga(e[r],t))return r}return-1},Kr.startCase=eu,Kr.startsWith=function(e,t,r){return e=ks(e),r=null==r?0:ln(_s(r),0,e.length),t=di(t),e.slice(r,r+t.length)==t},Kr.subtract=xu,Kr.sum=function(e){return e&&e.length?zt(e,lu):0},Kr.sumBy=function(e,t){return e&&e.length?zt(e,co(t,2)):0},Kr.template=function(e,t,r){var i=Kr.templateSettings;r&&So(e,t,r)&&(t=n),e=ks(e),t=Is({},t,i,eo);var o,a,s=Is({},t.imports,i.imports,eo),u=js(s),l=Jt(s,u),c=0,d=t.interpolate||Se,f="__p += '",h=Re((t.escape||Se).source+"|"+d.source+"|"+(d===ee?pe:Se).source+"|"+(t.evaluate||Se).source+"|$","g"),p="//# sourceURL="+(je.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++it+"]")+"\n";e.replace(h,(function(t,r,n,i,s,u){return n||(n=i),f+=e.slice(c,u).replace(Ee,ir),r&&(o=!0,f+="' +\n__e("+r+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),c=u+t.length,t})),f+="';\n";var v=je.call(t,"variable")&&t.variable;if(v){if(fe.test(v))throw new Me("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(a?f.replace(H,""):f).replace(G,"$1").replace(z,"$1;"),f="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var g=iu((function(){return Ce(u,p+"return "+f).apply(n,l)}));if(g.source=f,rs(g))throw g;return g},Kr.times=function(e,t){if((e=_s(e))<1||e>p)return[];var r=g,n=_r(e,g);t=co(t),e-=g;for(var i=Yt(n,t);++r<e;)t(r);return i},Kr.toFinite=bs,Kr.toInteger=_s,Kr.toLength=ws,Kr.toLower=function(e){return ks(e).toLowerCase()},Kr.toNumber=Ss,Kr.toSafeInteger=function(e){return e?ln(_s(e),-9007199254740991,p):0===e?e:0},Kr.toString=ks,Kr.toUpper=function(e){return ks(e).toUpperCase()},Kr.trim=function(e,t,r){if((e=ks(e))&&(r||t===n))return Zt(e);if(!e||!(t=di(t)))return e;var i=dr(e),o=dr(t);return Ei(i,Xt(i,o),er(i,o)+1).join("")},Kr.trimEnd=function(e,t,r){if((e=ks(e))&&(r||t===n))return e.slice(0,fr(e)+1);if(!e||!(t=di(t)))return e;var i=dr(e);return Ei(i,0,er(i,dr(t))+1).join("")},Kr.trimStart=function(e,t,r){if((e=ks(e))&&(r||t===n))return e.replace(ae,"");if(!e||!(t=di(t)))return e;var i=dr(e);return Ei(i,Xt(i,dr(t))).join("")},Kr.truncate=function(e,t){var r=30,i="...";if(as(t)){var o="separator"in t?t.separator:o;r="length"in t?_s(t.length):r,i="omission"in t?di(t.omission):i}var a=(e=ks(e)).length;if(or(e)){var s=dr(e);a=s.length}if(r>=a)return e;var u=r-cr(i);if(u<1)return i;var l=s?Ei(s,0,u).join(""):e.slice(0,u);if(o===n)return l+i;if(s&&(u+=l.length-u),ds(o)){if(e.slice(u).search(o)){var c,d=l;for(o.global||(o=Re(o.source,ks(ve.exec(o))+"g")),o.lastIndex=0;c=o.exec(d);)var f=c.index;l=l.slice(0,f===n?u:f)}}else if(e.indexOf(di(o),u)!=u){var h=l.lastIndexOf(o);h>-1&&(l=l.slice(0,h))}return l+i},Kr.unescape=function(e){return(e=ks(e))&&$.test(e)?e.replace(Y,hr):e},Kr.uniqueId=function(e){var t=++Ne;return ks(e)+t},Kr.upperCase=tu,Kr.upperFirst=ru,Kr.each=ka,Kr.eachRight=Ma,Kr.first=Qo,hu(Kr,(Iu={},Sn(Kr,(function(e,t){je.call(Kr.prototype,t)||(Iu[t]=e)})),Iu),{chain:!1}),Kr.VERSION="4.17.21",Ct(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Kr[e].placeholder=Kr})),Ct(["drop","take"],(function(e,t){Hr.prototype[e]=function(r){r=r===n?1:br(_s(r),0);var i=this.__filtered__&&!t?new Hr(this):this.clone();return i.__filtered__?i.__takeCount__=_r(r,i.__takeCount__):i.__views__.push({size:_r(r,g),type:e+(i.__dir__<0?"Right":"")}),i},Hr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Ct(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;Hr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:co(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),Ct(["head","last"],(function(e,t){var r="take"+(t?"Right":"");Hr.prototype[e]=function(){return this[r](1).value()[0]}})),Ct(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");Hr.prototype[e]=function(){return this.__filtered__?new Hr(this):this[r](1)}})),Hr.prototype.compact=function(){return this.filter(lu)},Hr.prototype.find=function(e){return this.filter(e).head()},Hr.prototype.findLast=function(e){return this.reverse().find(e)},Hr.prototype.invokeMap=Qn((function(e,t){return"function"==typeof e?new Hr(this):this.map((function(r){return An(r,e,t)}))})),Hr.prototype.reject=function(e){return this.filter(Ka(co(e)))},Hr.prototype.slice=function(e,t){e=_s(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Hr(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==n&&(r=(t=_s(t))<0?r.dropRight(-t):r.take(t-e)),r)},Hr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Hr.prototype.toArray=function(){return this.take(g)},Sn(Hr.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),o=Kr[i?"take"+("last"==t?"Right":""):t],a=i||/^find/.test(t);o&&(Kr.prototype[t]=function(){var t=this.__wrapped__,s=i?[1]:arguments,u=t instanceof Hr,l=s[0],c=u||$a(t),d=function(e){var t=o.apply(Kr,Dt([e],s));return i&&f?t[0]:t};c&&r&&"function"==typeof l&&1!=l.length&&(u=c=!1);var f=this.__chain__,h=!!this.__actions__.length,p=a&&!f,v=u&&!h;if(!a&&c){t=v?t:new Hr(this);var g=e.apply(t,s);return g.__actions__.push({func:ba,args:[d],thisArg:n}),new Vr(g,f)}return p&&v?e.apply(this,s):(g=this.thru(d),p?i?g.value()[0]:g.value():g)})})),Ct(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ae[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Kr.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply($a(i)?i:[],e)}return this[r]((function(r){return t.apply($a(r)?r:[],e)}))}})),Sn(Hr.prototype,(function(e,t){var r=Kr[t];if(r){var n=r.name+"";je.call(Ar,n)||(Ar[n]=[]),Ar[n].push({name:t,func:r})}})),Ar[qi(n,2).name]=[{name:"wrapper",func:n}],Hr.prototype.clone=function(){var e=new Hr(this.__wrapped__);return e.__actions__=Oi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Oi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Oi(this.__views__),e},Hr.prototype.reverse=function(){if(this.__filtered__){var e=new Hr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Hr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=$a(e),n=t<0,i=r?e.length:0,o=function(e,t,r){var n=-1,i=r.length;for(;++n<i;){var o=r[n],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=_r(t,e+a);break;case"takeRight":e=br(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=n?s:a-1,c=this.__iteratees__,d=c.length,f=0,h=_r(u,this.__takeCount__);if(!r||!n&&i==u&&h==u)return gi(e,this.__actions__);var p=[];e:for(;u--&&f<h;){for(var v=-1,g=e[l+=t];++v<d;){var m=c[v],y=m.iteratee,b=m.type,_=y(g);if(2==b)g=_;else if(!_){if(1==b)continue e;break e}}p[f++]=g}return p},Kr.prototype.at=_a,Kr.prototype.chain=function(){return ya(this)},Kr.prototype.commit=function(){return new Vr(this.value(),this.__chain__)},Kr.prototype.next=function(){this.__values__===n&&(this.__values__=ys(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?n:this.__values__[this.__index__++]}},Kr.prototype.plant=function(e){for(var t,r=this;r instanceof Wr;){var i=Ho(r);i.__index__=0,i.__values__=n,t?o.__wrapped__=i:t=i;var o=i;r=r.__wrapped__}return o.__wrapped__=e,t},Kr.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Hr){var t=e;return this.__actions__.length&&(t=new Hr(this)),(t=t.reverse()).__actions__.push({func:ba,args:[aa],thisArg:n}),new Vr(t,this.__chain__)}return this.thru(aa)},Kr.prototype.toJSON=Kr.prototype.valueOf=Kr.prototype.value=function(){return gi(this.__wrapped__,this.__actions__)},Kr.prototype.first=Kr.prototype.head,st&&(Kr.prototype[st]=function(){return this}),Kr}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(ft._=pr,define((function(){return pr}))):pt?((pt.exports=pr)._=pr,ht._=pr):ft._=pr}).call(void 0)}))}();