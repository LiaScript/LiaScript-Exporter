var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("hsMrW",(function(r,n){var t,a,o,s;t=r.exports,a="joinRoom",o=function(){return Se},Object.defineProperty(t,a,{get:o,set:s,enumerable:!0,configurable:!0});var i,l,c,d,u,f,y,p,m,w,v,g,h,b,k,P,T,A,S,L,D=e("dM3DM"),I=e("aQXMn");const{floor:$,random:E}=Math,C="Trystero",U=(e,r)=>Array(e).fill().map(r),_=e=>U(e,(()=>"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[$(62*E())])).join(""),j=_(20),O=Promise.all.bind(Promise),M="undefined"!=typeof window,{entries:R,fromEntries:H,keys:J}=Object,x=()=>{},q=e=>Error(`${C}: ${e}`),B=new TextEncoder,G=new TextDecoder,N=e=>B.encode(e),W=e=>G.decode(e),z=(...e)=>e.join("@"),K=JSON.stringify,Q=JSON.parse,V={};let X=null,F=null;const Y=()=>{X||(X=new Promise((e=>{F=e})).finally((()=>{F=null,X=null})))},Z=()=>null==F?void 0:F(),ee="AES-GCM",re={},ne=async e=>(i=re)[l=e]||(i[l]=Array.from(await(async(e,r)=>new Uint8Array(await crypto.subtle.digest("SHA-1",N(r))))(0,e)).map((e=>e.toString(36))).join("")),te=async(e,r)=>{const n=crypto.getRandomValues(new Uint8Array(16));var t;return n.join(",")+"$"+(t=await crypto.subtle.encrypt({name:ee,iv:n},await e,N(r)),btoa(String.fromCharCode.apply(null,new Uint8Array(t))))},ae=async(e,r)=>{const[n,t]=r.split("$");return W(await crypto.subtle.decrypt({name:ee,iv:new Uint8Array(n.split(","))},await e,(e=>{const r=atob(e);return new Uint8Array(r.length).map(((e,n)=>r.charCodeAt(n))).buffer})(t)))},oe="icegatheringstatechange",se="offer";var ie=(e,{rtcConfig:r,rtcPolyfill:n,turnConfig:t})=>{const a=new(n||RTCPeerConnection)((0,D.default)({iceServers:le.concat(t||[])},r)),o={};let s=!1,i=!1,l=null;const c=e=>{e.binaryType="arraybuffer",e.bufferedAmountLowThreshold=65535,e.onmessage=e=>{var r;return null===(r=o.data)||void 0===r?void 0:r.call(o,e.data)},e.onopen=()=>{var e;return null===(e=o.connect)||void 0===e?void 0:e.call(o)},e.onclose=()=>{var e;return null===(e=o.close)||void 0===e?void 0:e.call(o)},e.onerror=e=>{var r;return null===(r=o.error)||void 0===r?void 0:r.call(o,e)}},d=e=>Promise.race([new Promise((r=>{const n=()=>{"complete"===e.iceGatheringState&&(e.removeEventListener(oe,n),r())};e.addEventListener(oe,n),n()})),new Promise((e=>setTimeout(e,5e3)))]).then((()=>({type:e.localDescription.type,sdp:e.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")})));return e?(l=a.createDataChannel("data"),c(l)):a.ondatachannel=({channel:e})=>{l=e,c(e)},a.onnegotiationneeded=async()=>{try{var e;s=!0,await a.setLocalDescription();const r=await d(a);null===(e=o.signal)||void 0===e||e.call(o,r)}catch(e){var r;null===(r=o.error)||void 0===r||r.call(o,e)}finally{s=!1}},a.onconnectionstatechange=()=>{var e;["disconnected","failed","closed"].includes(a.connectionState)&&(null===(e=o.close)||void 0===e||e.call(o))},a.ontrack=e=>{var r,n;null===(r=o.track)||void 0===r||r.call(o,e.track,e.streams[0]),null===(n=o.stream)||void 0===n||n.call(o,e.streams[0])},a.onremovestream=e=>{var r;return null===(r=o.stream)||void 0===r?void 0:r.call(o,e.stream)},e&&(a.canTrickleIceCandidates||a.onnegotiationneeded()),{created:Date.now(),connection:a,get channel(){return l},get isDead(){return"closed"===a.connectionState},async signal(r){var n;if("open"!==(null==l?void 0:l.readyState)||(null===(n=r.sdp)||void 0===n?void 0:n.includes("a=rtpmap")))try{if(r.type===se){var t;if(s||"stable"!==a.signalingState&&!i){if(e)return;await O([a.setLocalDescription({type:"rollback"}),a.setRemoteDescription(r)])}else await a.setRemoteDescription(r);await a.setLocalDescription();const n=await d(a);return null===(t=o.signal)||void 0===t||t.call(o,n),n}if("answer"===r.type){i=!0;try{await a.setRemoteDescription(r)}finally{i=!1}}}catch(e){var c;null===(c=o.error)||void 0===c||c.call(o,e)}},sendData:e=>l.send(e),destroy(){null==l||l.close(),a.close(),s=!1,i=!1},setHandlers:e=>Object.assign(o,e),offerPromise:e?new Promise((e=>o.signal=r=>{r.type===se&&e(r)})):Promise.resolve(),addStream:e=>e.getTracks().forEach((r=>a.addTrack(r,e))),removeStream:e=>a.getSenders().filter((r=>e.getTracks().includes(r.track))).forEach((e=>a.removeTrack(e))),addTrack:(e,r)=>a.addTrack(e,r),removeTrack(e){const r=a.getSenders().find((r=>r.track===e));r&&a.removeTrack(r)},replaceTrack(e,r){const n=a.getSenders().find((r=>r.track===e));if(n)return n.replaceTrack(r)}}};const le=[...U(3,((e,r)=>`stun:stun${r||""}.l.google.com:19302`)),"stun:stun.cloudflare.com:3478"].map((e=>({urls:e}))),ce=Object.getPrototypeOf(Uint8Array),de=16369,ue=255,fe="bufferedamountlow",ye=e=>"@_"+e;const pe={},me={},we={},ve={},ge={},he={},be={},ke={},Pe=async e=>{if(me[e])return me[e];const r=(await ne(e)).slice(0,20);return me[e]=r,we[r]=e,r},Te=async(e,r,n)=>e.send(K((0,D.default)({action:"announce",info_hash:await Pe(r),peer_id:j},n))),Ae=(e,r,n)=>console.warn(`${C}: torrent tracker ${n?"failure":"warning"} from ${e} - ${r}`),Se=(({init:e,subscribe:r,announce:n})=>{const t={};let a,o,s,i,l=!1;return(k,P,T)=>{var A;const{appId:S}=k;if(null===(A=t[S])||void 0===A?void 0:A[P])return t[S][P];const L={},$={},E=z(C,S,P),_=ne(E),B=ne(z(E,j)),G=(async(e,r,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},N(`${e}:${r}:${n}`)),{name:ee},!1,["encrypt","decrypt"]))(k.password||"",S,P),V=e=>async r=>({type:r.type,sdp:await e(G,r.sdp)}),X=V(ae),F=V(te),re=()=>ie(!0,k),oe=(e,r,n)=>{var t;$[r]?$[r]!==e&&e.destroy():($[r]=e,ge(e,r),null===(t=L[r])||void 0===t||t.forEach(((e,r)=>{r!==n&&e.destroy()})),delete L[r])},se=(e,r)=>{$[r]===e&&delete $[r]},le=e=>(o.push(...U(e,re)),O(o.splice(0,e).map((e=>e.offerPromise.then(F).then((r=>({peer:e,offer:r}))))))),pe=(e,r)=>null==T?void 0:T({error:`incorrect password (${k.password}) when decrypting ${r}`,appId:S,peerId:e,roomId:P});if(!k)throw q("requires a config map as the first argument");if(!S&&!k.firebaseApp)throw q("config map is missing appId field");if(!P)throw q("roomId argument required");if(!l){const r=e(k);o=U(20,re),a=Array.isArray(r)?r:[r],l=!0,s=setInterval((()=>o=o.filter((e=>{const r=Date.now()-e.created<57333;return r||e.destroy(),r}))),59052.99),i=k.manualRelayReconnection?x:(()=>{if(M){const e=new AbortController;return addEventListener("online",Z,{signal:e.signal}),addEventListener("offline",Y,{signal:e.signal}),()=>e.abort()}return x})()}const me=a.map((()=>5333)),we=[],ve=a.map((async(e,n)=>r(await e,await _,await B,(e=>async(r,n,t)=>{const[a,o]=await O([_,B]);if(r!==a&&r!==o)return;const{peerId:s,offer:i,answer:l,peer:c}="string"==typeof n?Q(n):n;if(s!==j&&!$[s])if(!s||i||l){if(i){var d;if((null===(d=L[s])||void 0===d?void 0:d[e])&&j>s)return;const r=ie(!1,k);let n;r.setHandlers({connect:()=>oe(r,s,e),close:()=>se(r,s)});try{n=await X(i)}catch(e){return void pe(s,"offer")}if(r.isDead)return;const[a,o]=await O([ne(z(E,s)),r.signal(n)]);t(a,K({peerId:j,answer:await F(o)}))}else if(l){let r;try{r=await X(l)}catch(e){return void pe(s,"answer")}if(c)c.setHandlers({connect:()=>oe(c,s,e),close:()=>se(c,s)}),c.signal(r);else{var u;const n=null===(u=L[s])||void 0===u?void 0:u[e];n&&!n.isDead&&n.signal(r)}}}else{var f;if(null===(f=L[s])||void 0===f?void 0:f[e])return;const[[{peer:r,offer:n}],a]=await O([le(1),ne(z(E,s))]);(v=L)[g=s]||(v[g]=[]),L[s][e]=r,setTimeout((()=>((e,r)=>{var n;if($[e])return;const t=null===(n=L[e])||void 0===n?void 0:n[r];t&&(delete L[e][r],t.destroy())})(s,e)),.9*me[e]),r.setHandlers({connect:()=>oe(r,s,e),close:()=>se(r,s)}),t(a,K({peerId:j,offer:n}))}})(n),le)));O([_,B]).then((([e,r])=>{const t=async(a,o)=>{const s=await n(a,e,r);"number"==typeof s&&(me[o]=s),we[o]=setTimeout((()=>t(a,o)),me[o])};ve.forEach((async(e,r)=>{await e,t(await a[r],r)}))}));let ge=x;return(h=t)[b=S]||(h[b]={}),t[S][P]=((e,r,n)=>{const t={},a={},o={},s={},i={},l={},v={},g={onPeerJoin:x,onPeerLeave:x,onPeerStream:x,onPeerTrack:x},h=(e,r)=>(e?Array.isArray(e)?e:[e]:J(t)).flatMap((e=>{const n=t[e];return n?r(e,n):(console.warn(`${C}: no peer with id ${e} found`),[])})),b=e=>{t[e]&&(t[e].destroy(),delete t[e],delete s[e],delete i[e],g.onPeerLeave(e),r(e))},k=e=>{if(a[e])return o[e];if(!e)throw q("action type argument is required");const r=N(e);if(r.byteLength>12)throw q(`action type string "${e}" (${r.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const n=new Uint8Array(12);n.set(r);let s=0;return a[e]={onComplete:x,onProgress:x,setOnComplete:r=>a[e]=(0,I.default)((0,D.default)({},a[e]),{onComplete:r}),setOnProgress:r=>a[e]=(0,I.default)((0,D.default)({},a[e]),{onProgress:r}),async send(e,r,a,o){if(a&&"object"!=typeof a)throw q("action meta argument must be an object");const i=typeof e;if("undefined"===i)throw q("action data cannot be undefined");const l="string"!==i,c=e instanceof Blob,d=c||e instanceof ArrayBuffer||e instanceof ce;if(a&&!d)throw q("action meta argument can only be used with binary data");const u=d?new Uint8Array(c?await e.arrayBuffer():e):N(l?K(e):e),f=a?N(K(a)):null,y=Math.ceil(u.byteLength/de)+(a?1:0)||1,p=U(y,((e,r)=>{const t=r===y-1,o=a&&0===r,i=new Uint8Array(15+(o?f.byteLength:t?u.byteLength-de*(y-(a?2:1)):de));return i.set(n),i.set([s],12),i.set([t|o<<1|d<<2|l<<3],13),i.set([Math.round((r+1)/y*ue)],14),i.set(a?o?f:u.subarray((r-1)*de,r*de):u.subarray(r*de,(r+1)*de),15),i}));return s=s+1&ue,O(h(r,(async(e,r)=>{const{channel:n}=r;let s=0;for(;s<y;){const i=p[s];if(n.bufferedAmount>n.bufferedAmountLowThreshold&&await new Promise((e=>{const r=()=>{n.removeEventListener(fe,r),e()};n.addEventListener(fe,r)})),!t[e])break;r.sendData(i),s++,null==o||o(i[14]/ue,e,a)}})))}},(c=o)[d=e]||(c[d]=[a[e].send,a[e].setOnComplete,a[e].setOnProgress])},P=async()=>{await z(""),await new Promise((e=>setTimeout(e,99))),R(t).forEach((([e,r])=>{r.destroy(),delete t[e]})),n()},[T,A]=k(ye("ping")),[S,L]=k(ye("pong")),[$,E]=k(ye("signal")),[_,j]=k(ye("stream")),[B,G]=k(ye("track")),[z,V]=k(ye("leave"));return e(((e,r)=>{t[r]||(t[r]=e,e.setHandlers({data:e=>((e,r)=>{const n=new Uint8Array(r),t=W(n.subarray(0,12)).replaceAll("\0",""),[o]=n.subarray(12,13),[i]=n.subarray(13,14),[l]=n.subarray(14,15),c=n.subarray(15),d=!!(1&i),v=!!(2&i),g=!!(4&i),h=!!(8&i);if(!a[t])return void console.warn(`${C}: received message with unregistered type (${t})`);(u=s)[f=e]||(u[f]={}),(y=s[e])[p=t]||(y[p]={});const b=(m=s[e][t])[w=o]||(m[w]={chunks:[]});if(v?b.meta=Q(W(c)):b.chunks.push(c),a[t].onProgress(l/ue,e,b.meta),!d)return;const k=new Uint8Array(b.chunks.reduce(((e,r)=>e+r.byteLength),0));if(b.chunks.reduce(((e,r)=>(k.set(r,e),e+r.byteLength)),0),delete s[e][t][o],g)a[t].onComplete(k,e,b.meta);else{const r=W(k);a[t].onComplete(h?Q(r):r,e)}})(r,e),stream(e){g.onPeerStream(e,r,l[r]),delete l[r]},track(e,n){g.onPeerTrack(e,n,r,v[r]),delete v[r]},signal:e=>$(e,r),close:()=>b(r),error(e){console.error(e),b(r)}}),g.onPeerJoin(r))})),A(((e,r)=>S("",r))),L(((e,r)=>{var n;null===(n=i[r])||void 0===n||n.call(i),delete i[r]})),E(((e,r)=>{var n;return null===(n=t[r])||void 0===n?void 0:n.signal(e)})),j(((e,r)=>l[r]=e)),G(((e,r)=>v[r]=e)),V(((e,r)=>b(r))),M&&addEventListener("beforeunload",P),{makeAction:k,leave:P,async ping(e){if(!e)throw q("ping() must be called with target peer ID");const r=Date.now();return T("",e),await new Promise((r=>i[e]=r)),Date.now()-r},getPeers:()=>H(R(t).map((([e,r])=>[e,r.connection]))),addStream:(e,r,n)=>h(r,(async(r,t)=>{n&&await _(n,r),t.addStream(e)})),removeStream:(e,r)=>h(r,((r,n)=>n.removeStream(e))),addTrack:(e,r,n,t)=>h(n,(async(n,a)=>{t&&await B(t,n),a.addTrack(e,r)})),removeTrack:(e,r)=>h(r,((r,n)=>n.removeTrack(e))),replaceTrack:(e,r,n,t)=>h(n,(async(n,a)=>{t&&await B(t,n),a.replaceTrack(e,r)})),onPeerJoin:e=>g.onPeerJoin=e,onPeerLeave:e=>g.onPeerLeave=e,onPeerStream:e=>g.onPeerStream=e,onPeerTrack:e=>g.onPeerTrack=e}})((e=>ge=e),(e=>delete $[e]),(()=>{delete t[S][P],we.forEach(clearTimeout),ve.forEach((async e=>(await e)())),clearInterval(s),i(),l=!1}))}})({init:e=>((e,r,n)=>(e.relayUrls||r).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||3))(e,De).map((e=>{const r=((e,r)=>{const n={},t=()=>{const a=new WebSocket(e);a.onclose=()=>{var r;X?X.then(t):(null!==(r=(k=V)[P=e])&&void 0!==r||(k[P]=3333),setTimeout(t,V[e]),V[e]*=2)},a.onmessage=e=>r(e.data),n.socket=a,n.url=a.url,n.ready=new Promise((r=>a.onopen=()=>{r(n),V[e]=3333})),n.send=e=>{1===a.readyState&&a.send(e)}};return t(),n})(e,(e=>{const r=Q(e),t=r["failure reason"],a=r["warning message"],{interval:o}=r,s=we[r.info_hash];if(t)Ae(n,t,!0);else{var i,l;if(a&&Ae(n,a),o&&1e3*o>he[n]&&ge[n][s]){const e=Math.min(1e3*o,120333);clearInterval(ve[n][s]),he[n]=e,ve[n][s]=setInterval(ge[n][s],e)}be[r.offer_id]||(r.offer||r.answer)&&(be[r.offer_id]=!0,null===(l=(i=ke[n])[s])||void 0===l||l.call(i,r))}})),{url:n}=r;return pe[n]=r,ke[n]={},r.ready})),subscribe(e,r,n,t,a){const{url:o}=e,s=async()=>{const n=H((await a(10)).map((e=>[_(20),e])));ke[e.url][r]=a=>{if(a.offer)t(r,{offer:a.offer,peerId:a.peer_id},((n,t)=>Te(e,r,{answer:Q(t).answer,offer_id:a.offer_id,to_peer_id:a.peer_id})));else if(a.answer){const e=n[a.offer_id];e&&t(r,{answer:a.answer,peerId:a.peer_id,peer:e.peer})}},Te(e,r,{numwant:10,offers:R(n).map((([e,{offer:r}])=>({offer_id:e,offer:r})))})};return he[o]=33333,(T=ge)[A=o]||(T[A]={}),ge[o][r]=s,(S=ve)[L=o]||(S[L]={}),ve[o][r]=setInterval(s,he[o]),s(),()=>{clearInterval(ve[o][r]),delete ke[o][r],delete ge[o][r]}},announce:e=>he[e.url]});Le=pe;var Le;const De=["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.btorrent.xyz","tracker.files.fm:7073/announce"].map((e=>"wss://"+e))}));