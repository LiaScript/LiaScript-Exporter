!function(){function t(t,e,n,o){Object.defineProperty(t,e,{get:n,set:o,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("2V9sH",(function(n,o){t(n.exports,"Sync",(function(){return k}));var r=e("f1evb"),i=e("hnmIs"),s=e("9Klpk"),c=e("3bWnf"),u=e("eT7f3"),a=e("9WzNc"),l=e("div3d"),d=e("kb0qF"),p=e("5ENmm"),f=e("bWNdT"),h=e("32Euv"),y=e("auvHb"),v=e("i4ll7"),k=function(t){"use strict";(0,d.default)(n,t);var e=(0,f.default)(n);function n(){var t;return(0,s.default)(this,n),t=e.apply(this,arguments),(0,u.default)((0,r.default)(t),"trackersAnnounceURLs",[]),(0,u.default)((0,r.default)(t),"peers",{}),(0,u.default)((0,r.default)(t),"tokens",{}),t}return(0,c.default)(n,[{key:"destroy",value:function(){var t;this.trackersAnnounceURLs=[],null===(t=this.p2pt)||void 0===t||t.destroy(),(0,a.default)((0,l.default)(n.prototype),"destroy",this).call(this)}},{key:"connect",value:function(t){var e=this,o=this;return(0,i.default)((function(){return(0,h.__generator)(this,(function(r){return(0,a.default)((0,l.default)(n.prototype),"connect",e).call(o,t),o.trackersAnnounceURLs=t.config||[],window.P2PT?o.init(!0):o.load(["https://cdn.jsdelivr.net/gh/subins2000/p2pt/dist/p2pt.umd.min.js",v.Crypto.url],o),[2]}))}))()}},{key:"init",value:function(t,e){if(0==this.trackersAnnounceURLs.length)return this.sendDisconnectError("You have to provide at least one WebTorrent tracker.");var n=this.uniqueID();if(t&&window.P2PT&&n){this.p2pt=new window.P2PT(this.trackersAnnounceURLs,n),v.Crypto.init(this.password);var o=this;this.p2pt.on("trackerconnect",(function(t,e){console.log("Connected to tracker : "+t.announceUrl),console.log("Tracker stats : "+JSON.stringify(e)),o.sendConnect()})),this.p2pt.on("peerconnect",(function(t){console.warn("Peer connected : "+t.id,t),o.peers[t.id]=t})),this.p2pt.on("peerclose",(function(t){console.warn("Peer disconnected : "+t);var e=o.tokens[t.id];e&&(o.db.removePeer(e),delete o.tokens[t.id]),delete o.peers[t.id]})),this.p2pt.on("msg",(function(t,e){if(console.warn("Got message from ".concat(t.id," : ").concat(e)),e)try{var n=(0,p.default)(v.Crypto.decode(e),2),r=n[0],i=n[1];r!=o.token&&null!=i&&(o.applyUpdate(y.base64_to_unit8(i)),o.tokens[t.id]||(o.tokens[t.id]=r))}catch(t){console.warn("P2PT",t.message)}})),this.p2pt.start()}else{var r="P2PT unknown error";e?r="Could not load resource: "+e:window.P2PT||(r="Could not load P2PT interface"),this.sendDisconnectError(r)}}},{key:"broadcast",value:function(t){if(this.p2pt){var e=null==t?null:y.uint8_to_base64(t),n=v.Crypto.encode([this.token,e]);for(var o in this.peers)this.p2pt.send(this.peers[o],n)}}}]),n}(y.Sync)})),e.register("i4ll7",(function(e,n){t(e.exports,"Crypto",(function(){return o}));var o={url:"https://cdn.jsdelivr.net/npm/simple-crypto-js@2.5.0/dist/SimpleCrypto.min.js",crypt:null,check:function(){return!!window.SimpleCrypto},init:function(t){try{"string"==typeof t&&t.length>0?this.crypt=new SimpleCrypto(t):this.crypt=null}catch(t){console.warn("Crypto: ",t),this.crypt=null}},encode:function(t){return this.crypt?this.crypt.encrypt(btoa(encodeURIComponent(JSON.stringify(t)))):JSON.stringify(t)},decode:function(t){return this.crypt?JSON.parse(decodeURIComponent(atob(this.crypt.decrypt(t)))):JSON.parse(t)}}}))}();