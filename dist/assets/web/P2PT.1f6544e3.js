!function(){function e(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;t.register("2V9sH",(function(n,o){e(n.exports,"Sync",(function(){return v}));var r=t("f1evb"),i=t("hnmIs"),s=t("9Klpk"),c=t("3bWnf"),a=t("eT7f3"),u=t("9WzNc"),l=t("div3d"),d=t("kb0qF"),p=t("5ENmm"),f=t("bWNdT"),h=t("32Euv"),y=t("auvHb"),b=t("i4ll7"),v=function(e){"use strict";(0,d.default)(o,e);var n=(0,f.default)(o);function o(){var e;return(0,s.default)(this,o),e=n.apply(this,arguments),(0,a.default)((0,r.default)(e),"trackersAnnounceURLs",[]),(0,a.default)((0,r.default)(e),"peers",{}),(0,a.default)((0,r.default)(e),"tokens",{}),(0,a.default)((0,r.default)(e),"is_connected",!1),e}return(0,c.default)(o,[{key:"destroy",value:function(){var e;this.trackersAnnounceURLs=[],null===(e=this.p2pt)||void 0===e||e.destroy(),(0,u.default)((0,l.default)(o.prototype),"destroy",this).call(this)}},{key:"connect",value:function(e){var n=this,r=this;return(0,i.default)((function(){var i;return(0,h.__generator)(this,(function(s){switch(s.label){case 0:return(0,u.default)((0,l.default)(o.prototype),"connect",n).call(r,e),r.trackersAnnounceURLs=e.config||[],window.P2PT?(r.init(!0),[3,3]):[3,1];case 1:return i="P2PT",[4,t("4x2an")];case 2:window[i]=s.sent(),r.load([b.Crypto.url],r),s.label=3;case 3:return[2]}}))}))()}},{key:"init",value:function(e,t){if(0==this.trackersAnnounceURLs.length)return this.sendDisconnectError("You have to provide at least one WebTorrent tracker.");var n=this.uniqueID();if(e&&window.P2PT&&n){this.p2pt=new window.P2PT(this.trackersAnnounceURLs,n),b.Crypto.init(this.password);var o=this;this.p2pt.on("trackerconnect",(function(e,t){console.log("Connected to tracker : "+e.announceUrl),console.log("Tracker stats : "+JSON.stringify(t)),o.is_connected||(o.is_connected=!0,o.sendConnect())})),this.p2pt.on("trackerwarning",(function(e,t){console.log("Connected to tracker : ",e),console.log("Tracker stats : "+JSON.stringify(t))})),this.p2pt.on("peerconnect",(function(e){console.warn("Peer connected : "+e.id,e),o.peers[e.id]=e})),this.p2pt.on("peerclose",(function(e){console.warn("Peer disconnected : "+e);var t=o.tokens[e.id];t&&(o.db.removePeer(t),delete o.tokens[e.id]),delete o.peers[e.id]})),this.p2pt.on("msg",(function(e,t){if(t)try{var n=(0,p.default)(b.Crypto.decode(t),4),r=n[0],i=n[1],s=n[2],c=n[3];r!=o.token&&(i?c==o.db.timestamp?o.applyUpdate(y.base64_to_unit8(s)):c>o.db.timestamp?o.broadcast(!0,o.db.encode()):(o.db.timestamp=c,o.applyUpdate(y.base64_to_unit8(s),!0)):o.pubsubReceive(y.base64_to_unit8(s)),o.tokens[e.id]||(o.tokens[e.id]=r))}catch(e){console.warn("P2PT",e.message)}})),this.p2pt.start()}else{var r="P2PT unknown error";t?r="Could not load resource: "+t:window.P2PT||(r="Could not load P2PT interface"),this.sendDisconnectError(r)}}},{key:"broadcast",value:function(e,t){if(this.p2pt){var n=null==t?null:y.uint8_to_base64(t),o=b.Crypto.encode([this.token,e,n,this.db.timestamp]);for(var r in this.peers)this.p2pt.send(this.peers[r],o)}}}]),o}(y.Sync)})),t.register("i4ll7",(function(t,n){e(t.exports,"Crypto",(function(){return o}));var o={url:"https://cdn.jsdelivr.net/npm/simple-crypto-js@2.5.0/dist/SimpleCrypto.min.js",crypt:null,check:function(){return!!window.SimpleCrypto},init:function(e){try{"string"==typeof e&&e.length>0?this.crypt=new SimpleCrypto(e):this.crypt=null}catch(e){console.warn("Crypto: ",e),this.crypt=null}},encode:function(e){return this.crypt?this.crypt.encrypt(btoa(encodeURIComponent(JSON.stringify(e)))):JSON.stringify(e)},decode:function(e){return this.crypt?JSON.parse(decodeURIComponent(atob(this.crypt.decrypt(e)))):JSON.parse(e)}}})),t.register("4x2an",(function(e,n){e.exports=t("3OMJO")(t("5B9gS").getBundleURL("5e9O4")+t("b9xd4").resolve("2xrMD")).then((function(){return t("9U0AO")}))}))}();