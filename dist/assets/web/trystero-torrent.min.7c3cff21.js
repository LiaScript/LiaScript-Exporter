!function(){var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("E0fFs",(function(t,n){var r,i;r=t.exports,i=function(){return kn},Object.defineProperty(r,"joinRoom",{get:i,set:undefined,enumerable:!0,configurable:!0});var a,o,s,u,c,l,d,f,h,p,_,v,y,m,g,b,w,C=e("f1evb"),S=e("hnmIs"),k=e("9Klpk"),E=e("3bWnf"),x=e("eT7f3"),T=e("kb0qF"),R=e("bgoEC"),A=e("7j4mF"),N=e("1Qswt"),L=e("5ENmm"),F=e("6Wo7Q"),O=e("rJmE6"),P=e("bWNdT"),I=e("32Euv"),D=e("84cK9"),M="Trystero",j=function(e,t){return Array(e).fill().map(t)},U=function(e){return j(e,(function(){return"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Math.floor(62*Math.random())]})).join("")},q=U(20),W=Promise.all.bind(Promise),H=Object.entries,B=Object.fromEntries,Y=Object.keys,J=function(){},z=function(e){return Error("".concat(M,": ").concat(e))},K=new TextEncoder,V=new TextDecoder,$=function(e){return K.encode(e)},G=function(e){return V.decode(e)},Q=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("@")},Z=JSON.stringify,X=JSON.parse,ee={},te="AES-GCM",ne={},re=(w=(0,S.default)((function(e){var t,n,r;return(0,I.__generator)(this,(function(i){switch(i.label){case 0:return ne[e]?[2,ne[e]]:(n=Array.from,r=Uint8Array.bind,[4,crypto.subtle.digest("SHA-1",$(e))]);case 1:return t=n.apply(Array,[new(r.apply(Uint8Array,[void 0,i.sent()]))]).map((function(e){return e.toString(36)})).join(""),[2,(ne[e]=t,t)]}}))})),function(e){return w.apply(this,arguments)}),ie=function(){var e=(0,S.default)((function(e,t){var n,r,i,a,o,s;return(0,I.__generator)(this,(function(u){switch(u.label){case 0:return n=crypto.getRandomValues(new Uint8Array(16)),i=n.join(",")+"$",o=(a=crypto.subtle).encrypt,s=[{name:te,iv:n}],[4,e];case 1:return[4,o.apply(a,s.concat([u.sent(),$(t)]))];case 2:return[2,i+(r=u.sent(),btoa(String.fromCharCode.apply(null,new Uint8Array(r))))]}}))}));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=(0,S.default)((function(e,t){var n,r,i,a,o,s;return(0,I.__generator)(this,(function(u){switch(u.label){case 0:return n=(0,L.default)(t.split("$"),2),r=n[0],i=n[1],o=(a=crypto.subtle).decrypt,s=[{name:te,iv:new Uint8Array(r.split(","))}],[4,e];case 1:return[4,o.apply(a,s.concat([u.sent(),function(e){var t=atob(e);return new Uint8Array(t.length).map((function(e,n){return t.charCodeAt(n)})).buffer}(i)]))];case 2:return[2,G.apply(void 0,[u.sent()])]}}))}));return function(t,n){return e.apply(this,arguments)}}();function oe(e){return e&&e.__esModule&&{}.hasOwnProperty.call(e,"default")?e.default:e}var se,ue,ce={exports:{}};!function(e,t){var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==D&&"env"in D&&(e=void 0),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=function(e){var t=function(e,t){var n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n},n=function(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")};function r(e){var n,i,a,o=null;function s(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(s.enabled){var a=s,o=Number(new Date),u=o-(n||o);a.diff=u,a.prev=n,a.curr=o,n=o,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return"%";c++;var i=r.formatters[n];if("function"==typeof i){var o=t[c];e=i.call(a,o),t.splice(c,1),c--}return e})),r.formatArgs.call(a,t),(a.log||r.log).apply(a,t)}}return s.namespace=e,s.useColors=r.useColors(),s.color=r.selectColor(e),s.extend=t,s.destroy=r.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==o?o:(i!==r.namespaces&&(i=r.namespaces,a=r.enabled(e)),a)},set:function(e){o=e}}),"function"==typeof r.init&&r.init(s),s}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){var e=(0,F.default)(r.names.map(n)).concat((0,F.default)(r.skips.map(n).map((function(e){return"-"+e})))).join(",");return r.enable(""),e},r.enable=function(e){var t;r.save(e),r.namespaces=e,r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(RegExp("^"+e.slice(1)+"$")):r.names.push(RegExp("^"+e+"$")))},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=function(){var e=function(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")};if(ue)return se;ue=1;var t=1e3,n=60*t,r=60*n,i=24*r;return se=function(a,o){o=o||{};var s=void 0===a?"undefined":(0,O.default)(a);if("string"===s&&a.length>0)return function(e){if(!((e+="").length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(a);if("number"===s&&isFinite(a))return o.long?function(a){var o=Math.abs(a);return o>=i?e(a,o,i,"day"):o>=r?e(a,o,r,"hour"):o>=n?e(a,o,n,"minute"):o>=t?e(a,o,t,"second"):a+" ms"}(a):function(e){var a=Math.abs(e);return a>=i?Math.round(e/i)+"d":a>=r?Math.round(e/r)+"h":a>=n?Math.round(e/n)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(a);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}(),r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(t){r[t]=e[t]})),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]},r.enable(r.load()),r}(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(ce,ce.exports);var le,de=oe(ce.exports),fe="undefined"!=typeof window?window:self,he=fe.RTCPeerConnection||fe.mozRTCPeerConnection||fe.webkitRTCPeerConnection,pe=fe.RTCSessionDescription||fe.mozRTCSessionDescription||fe.webkitRTCSessionDescription,_e=fe.RTCIceCandidate||fe.mozRTCIceCandidate||fe.webkitRTCIceCandidate,ve={exports:{}},ye="object"==typeof Reflect?Reflect:null,me=ye&&"function"==typeof ye.apply?ye.apply:function(e,t,n){return function(){}.apply.call(e,t,n)};le=ye&&"function"==typeof ye.ownKeys?ye.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var ge=Number.isNaN||function(e){return e!=e};function be(){be.init.call(this)}ve.exports=be,ve.exports.once=function(e,t){return new Promise((function(n,r){var i=function(n){e.removeListener(t,a),r(n)},a=function(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))};Ne(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&Ne(e,"error",t,{once:!0})}(e,i)}))},be.EventEmitter=be,be.prototype._events=void 0,be.prototype._eventsCount=0,be.prototype._maxListeners=void 0;var we=10;function Ce(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===e?"undefined":(0,O.default)(e)))}function Se(e){return void 0===e._maxListeners?be.defaultMaxListeners:e._maxListeners}function ke(e,t,n,r){var i,a,o,s;if(Ce(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=Se(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,console&&console.warn&&console.warn(s)}return e}function Ee(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xe(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=Ee.bind(r);return i.listener=n,r.wrapFn=i,i}function Te(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):Ae(i,i.length)}function Re(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function Ae(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function Ne(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+(void 0===e?"undefined":(0,O.default)(e)));e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}Object.defineProperty(be,"defaultMaxListeners",{enumerable:!0,get:function(){return we},set:function(e){if("number"!=typeof e||e<0||ge(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");we=e}}),be.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},be.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||ge(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},be.prototype.getMaxListeners=function(){return Se(this)},be.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)me(s,this,t);else{var u=s.length,c=Ae(s,u);for(n=0;n<u;++n)me(c[n],this,t)}return!0},be.prototype.addListener=function(e,t){return ke(this,e,t,!1)},be.prototype.on=be.prototype.addListener,be.prototype.prependListener=function(e,t){return ke(this,e,t,!0)},be.prototype.once=function(e,t){return Ce(t),this.on(e,xe(this,e,t)),this},be.prototype.prependOnceListener=function(e,t){return Ce(t),this.prependListener(e,xe(this,e,t)),this},be.prototype.removeListener=function(e,t){var n,r,i,a,o;if(Ce(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},be.prototype.off=be.prototype.removeListener,be.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},be.prototype.listeners=function(e){return Te(this,e,!0)},be.prototype.rawListeners=function(e){return Te(this,e,!1)},be.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Re.call(e,t)},be.prototype.listenerCount=Re,be.prototype.eventNames=function(){return this._eventsCount>0?le(this._events):[]};var Le=ve.exports,Fe="function"==typeof queueMicrotask?queueMicrotask:function(e){return Promise.resolve().then(e)},Oe=function(){"use strict";function e(t){if((0,k.default)(this,e),!(t>0)||t-1&t)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}return(0,E.default)(e,[{key:"clear",value:function(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}},{key:"push",value:function(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}},{key:"shift",value:function(){var e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}},{key:"peek",value:function(){return this.buffer[this.btm]}},{key:"isEmpty",value:function(){return void 0===this.buffer[this.btm]}}]),e}(),Pe=function(){"use strict";function e(t){(0,k.default)(this,e),this.decoder=new TextDecoder("utf16le"===t?"utf16-le":t)}return(0,E.default)(e,[{key:"decode",value:function(e){return this.decoder.decode(e,{stream:!0})}},{key:"flush",value:function(){return this.decoder.decode(new Uint8Array(0))}}]),e}(),Ie=Pe,De=Pe,Me=Le.EventEmitter,je=Error("Stream was destroyed"),Ue=Fe,qe=function(){"use strict";function e(t){(0,k.default)(this,e),this.hwm=t||16,this.head=new Oe(this.hwm),this.tail=this.head,this.length=0}return(0,E.default)(e,[{key:"clear",value:function(){this.head=this.tail,this.head.clear(),this.length=0}},{key:"push",value:function(e){if(this.length++,!this.head.push(e)){var t=this.head;this.head=t.next=new Oe(2*this.head.buffer.length),this.head.push(e)}}},{key:"shift",value:function(){0!==this.length&&this.length--;var e=this.tail.shift();if(void 0===e&&this.tail.next){var t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}},{key:"peek",value:function(){var e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}},{key:"isEmpty",value:function(){return 0===this.length}}]),e}(),We=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";switch((0,k.default)(this,e),this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:throw Error("Unknown encoding: "+e)}}(t),this.encoding){case"utf8":this.decoder=new De;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Ie(this.encoding)}}return(0,E.default)(e,[{key:"push",value:function(e){return"string"==typeof e?e:this.decoder.decode(e)}},{key:"write",value:function(e){return this.push(e)}},{key:"end",value:function(e){var t="";return e&&(t=this.push(e)),t+this.decoder.flush()}}]),e}(),He=536870910,Be=16384,Ye=32768,Je=131072,ze=536870143,Ke=536838143,Ve=536739839,$e=524288,Ge=1048576,Qe=2097152,Ze=8388608,Xe=16777216,et=33554432,tt=469499903,nt=503316479,rt=262160,it=8404992,at=8405006,ot=33587200,st=33587215,ut=270794767,ct=Symbol.asyncIterator||Symbol(),lt=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,a=n.map,o=void 0===a?null:a,s=n.mapWritable,u=n.byteLength,c=n.byteLengthWritable;(0,k.default)(this,e),this.stream=t,this.queue=new qe,this.highWaterMark=i,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=c||u||Tt,this.map=s||o,this.afterWrite=vt.bind(this),this.afterUpdateNextTick=gt.bind(this)}return(0,E.default)(e,[{key:"ended",get:function(){return!!(this.stream._duplexState&Ze)}},{key:"push",value:function(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=Qe,!0):(this.stream._duplexState|=6291456,!1)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=534773759),e}},{key:"end",value:function(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=535822335&this.stream._duplexState|134217728}},{key:"autoBatch",value:function(e,t){var n=[],r=this.stream;for(n.push(e);2359296==(r._duplexState&ut);)n.push(r._writableState.shift());if(15&r._duplexState)return t(null);r._writev(n,t)}},{key:"update",value:function(){var e=this.stream;e._duplexState|=$e;do{for(;(e._duplexState&ut)===Qe;){var t=this.shift();e._duplexState|=67371008,e._write(t,this.afterWrite)}1310720&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536346623}},{key:"updateNonPrimary",value:function(){var e=this.stream;if(134217728==(144965647&e._duplexState))return e._duplexState=402653183&e._duplexState|262144,void e._final(pt.bind(this));4!=(14&e._duplexState)?1==(e._duplexState&st)&&(e._duplexState=(e._duplexState|rt)&He,e._open(bt.bind(this))):e._duplexState&ot||(e._duplexState|=rt,e._destroy(_t.bind(this)))}},{key:"continueUpdate",value:function(){return!!(this.stream._duplexState&et)&&(this.stream._duplexState&=nt,!0)}},{key:"updateCallback",value:function(){(35127311&this.stream._duplexState)===Ge?this.update():this.updateNextTick()}},{key:"updateNextTick",value:function(){this.stream._duplexState&et||(this.stream._duplexState|=et,this.stream._duplexState&$e||Ue(this.afterUpdateNextTick))}}]),e}(),dt=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,a=n.map,o=void 0===a?null:a,s=n.mapReadable,u=n.byteLength,c=n.byteLengthReadable;(0,k.default)(this,e),this.stream=t,this.queue=new qe,this.highWaterMark=0===i?1:i,this.buffered=0,this.readAhead=i>0,this.error=null,this.pipeline=null,this.byteLength=c||u||Tt,this.map=s||o,this.pipeTo=null,this.afterRead=yt.bind(this),this.afterUpdateNextTick=mt.bind(this)}return(0,E.default)(e,[{key:"ended",get:function(){return!!(this.stream._duplexState&Be)}},{key:"pipe",value:function(e,t){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new ft(this.stream,e,t),t&&this.stream.on("error",Rt),xt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Rt),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{var n=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",n),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",ht.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}},{key:"push",value:function(e){var t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=536805311&t._duplexState|1024,!1):(null!==this.map&&null===(e=this.map(e))||(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=536805375&t._duplexState|128),this.buffered<this.highWaterMark)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=536862591),e}},{key:"unshift",value:function(e){for(var t=[null!==this.map?this.map(e):e];this.buffered>0;)t.push(this.shift());for(var n=0;n<t.length-1;n++){var r=t[n];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}},{key:"read",value:function(){var e=this.stream;if(128==(16527&e._duplexState)){var t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=ze),2048&e._duplexState&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=Je,this.updateNextTick()),null}},{key:"drain",value:function(){for(var e=this.stream;128==(16527&e._duplexState)&&768&e._duplexState;){var t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=ze),2048&e._duplexState&&e.emit("data",t)}}},{key:"update",value:function(){var e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)===Je;)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=8192,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536870879}},{key:"updateNonPrimary",value:function(){var e=this.stream;1024==(1167&e._duplexState)&&(e._duplexState=536869887&e._duplexState|16384,e.emit("end"),(e._duplexState&at)===it&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(14&e._duplexState)?1==(e._duplexState&st)&&(e._duplexState=(e._duplexState|rt)&He,e._open(bt.bind(this))):e._duplexState&ot||(e._duplexState|=rt,e._destroy(_t.bind(this)))}},{key:"continueUpdate",value:function(){return!!(this.stream._duplexState&Ye)&&(this.stream._duplexState&=Ke,!0)}},{key:"updateCallback",value:function(){64==(32879&this.stream._duplexState)?this.update():this.updateNextTick()}},{key:"updateNextTick",value:function(){this.stream._duplexState&Ye||(this.stream._duplexState|=Ye,32&this.stream._duplexState||Ue(this.afterUpdateNextTick))}}]),e}(),ft=function(){"use strict";function e(t,n,r){(0,k.default)(this,e),this.from=t,this.to=n,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}return(0,E.default)(e,[{key:"finished",value:function(){this.pipeToFinished=!0}},{key:"done",value:function(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&Be||this.to.destroy(this.error||Error("Readable stream closed before ending")):this.from._duplexState&Be&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"))}}]),e}();function ht(){this.stream._duplexState|=512,this.updateCallback()}function pt(e){var t=this.stream;e&&t.destroy(e),14&t._duplexState||(t._duplexState|=Ze,t.emit("finish")),(t._duplexState&at)===it&&(t._duplexState|=4),t._duplexState&=tt,t._duplexState&$e?this.updateNextTick():this.update()}function _t(e){var t=this.stream;e||this.error===je||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");var n=t._readableState,r=t._writableState;if(null!==n&&null!==n.pipeline&&n.pipeline.done(t,e),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(t,e)}}function vt(e){var t=this.stream;e&&t.destroy(e),t._duplexState&=tt,null!==this.drains&&function(e){for(var t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),4194304==(6553615&t._duplexState)&&(t._duplexState&=532676607,(t._duplexState&Xe)===Xe&&t.emit("drain")),this.updateCallback()}function yt(e){e&&this.stream.destroy(e),this.stream._duplexState&=536870895,!1!==this.readAhead||256&this.stream._duplexState||(this.stream._duplexState&=Ve),this.updateCallback()}function mt(){32&this.stream._duplexState||(this.stream._duplexState&=Ke,this.update())}function gt(){this.stream._duplexState&$e||(this.stream._duplexState&=nt,this.update())}function bt(e){var t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=64),142606351&t._duplexState||(t._duplexState|=Ge),t.emit("open")),t._duplexState&=536608751,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function wt(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=Xe,this._writableState.updateNextTick())}var Ct=function(e){"use strict";(0,T.default)(n,e);var t=(0,P.default)(n);function n(e){var r;return(0,k.default)(this,n),(r=t.call(this))._duplexState=0,r._readableState=null,r._writableState=null,e&&(e.open&&(r._open=e.open),e.destroy&&(r._destroy=e.destroy),e.predestroy&&(r._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",At.bind((0,C.default)(r)))),r.on("newListener",wt),(0,N.default)(r)}return(0,E.default)(n,[{key:"_open",value:function(e){e(null)}},{key:"_destroy",value:function(e){e(null)}},{key:"_predestroy",value:function(){}},{key:"readable",get:function(){return null!==this._readableState||void 0}},{key:"writable",get:function(){return null!==this._writableState||void 0}},{key:"destroyed",get:function(){return!!(8&this._duplexState)}},{key:"destroying",get:function(){return!!(14&this._duplexState)}},{key:"destroy",value:function(e){14&this._duplexState||(e||(e=je),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}]),n}(Me),St=function(e){"use strict";(0,T.default)(n,e);var t=(0,P.default)(n);function n(e){var r;return(0,k.default)(this,n),(r=t.call(this,e))._duplexState|=8519681,r._readableState=new dt((0,C.default)(r),e),e&&(!1===r._readableState.readAhead&&(r._duplexState&=Ve),e.read&&(r._read=e.read),e.eagerOpen&&r._readableState.updateNextTick(),e.encoding&&r.setEncoding(e.encoding)),(0,N.default)(r)}return(0,E.default)(n,[{key:"setEncoding",value:function(e){var t=new We(e),n=this._readableState.map||Et;return this._readableState.map=function(e){var r=t.push(e);return""===r?null:n(r)},this}},{key:"_read",value:function(e){e(null)}},{key:"pipe",value:function(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}},{key:"read",value:function(){return this._readableState.updateNextTick(),this._readableState.read()}},{key:"push",value:function(e){return this._readableState.updateNextTick(),this._readableState.push(e)}},{key:"unshift",value:function(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}},{key:"resume",value:function(){return this._duplexState|=131328,this._readableState.updateNextTick(),this}},{key:"pause",value:function(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}},{key:ct,value:function(){var e,t=function(e){null!==o&&(i?o(i):null!==e||r._duplexState&Be?a({value:e,done:null===e}):o(je),o=a=null)},n=function(e){return r.destroy(e),new Promise((function(t,n){if(8&r._duplexState)return t({value:void 0,done:!0});r.once("close",(function(){e?n(e):t({value:void 0,done:!0})}))}))},r=this,i=null,a=null,o=null;return this.on("error",(function(e){i=e})),this.on("readable",(function(){null!==a&&t(r.read())})),this.on("close",(function(){null!==a&&t(null)})),e={},(0,x.default)(e,ct,(function(){return this})),(0,x.default)(e,"next",(function(){return new Promise((function(e,n){a=e,o=n;var i=r.read();null!==i?t(i):8&r._duplexState&&t(null)}))})),(0,x.default)(e,"return",(function(){return n(null)})),(0,x.default)(e,"throw",(function(e){return n(e)})),e}}],[{key:"_fromAsyncIterator",value:function(e,t){var r,i=function(e){e.done?a.push(null):a.push(e.value)},a=new n((0,A.default)((0,R.default)({},t),{read:function(t){e.next().then(i).then(t.bind(null,null)).catch(t)},predestroy:function(){r=e.return()},destroy:function(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}}));return a}},{key:"from",value:function(e,t){if(xt(r=e)&&r.readable)return e;var r;if(e[ct])return this._fromAsyncIterator(e[ct](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);var i=0;return new n((0,A.default)((0,R.default)({},t),{read:function(t){this.push(i===e.length?null:e[i++]),t(null)}}))}},{key:"isBackpressured",value:function(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}},{key:"isPaused",value:function(e){return!(256&e._duplexState)}}]),n}(Ct),kt=function(e){"use strict";(0,T.default)(n,e);var t=(0,P.default)(n);function n(e){var r;return(0,k.default)(this,n),(r=t.call(this,e))._duplexState=1|r._duplexState&Je,r._writableState=new lt((0,C.default)(r),e),e&&(e.writev&&(r._writev=e.writev),e.write&&(r._write=e.write),e.final&&(r._final=e.final)),(0,N.default)(r)}return(0,E.default)(n,[{key:"cork",value:function(){this._duplexState|=268435456}},{key:"uncork",value:function(){this._duplexState&=268435455,this._writableState.updateNextTick()}},{key:"_writev",value:function(e,t){t(null)}},{key:"_write",value:function(e,t){this._writableState.autoBatch(e,t)}},{key:"_final",value:function(e){e(null)}},{key:"write",value:function(e){return this._writableState.updateNextTick(),this._writableState.push(e)}},{key:"end",value:function(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}]),n}(St);function Et(e){return e}function xt(e){return"number"==typeof e._duplexState&&function(e){return!!e._readableState||!!e._writableState}(e)}function Tt(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function Rt(){}function At(){this.destroy(Error("Stream aborted."))}var Nt=kt;function Lt(e,t){for(var n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}for(var Ft=oe((function(e,t,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return Lt(e,n)}catch(t){n.message=e.message,n.stack=e.stack;var r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(e)),Lt(new r,n)}})),Ot="0123456789abcdef",Pt=[],It=0;It<256;It++)Pt[It]=Ot[It>>4&15]+Ot[15&It];for(var Dt=function(e){for(var t=e.length,n="",r=0;r<t;)n+=Pt[e[r++]];return n},Mt="undefined"==typeof Uint8Array?[]:new Uint8Array(256),jt=0;jt<64;jt++)Mt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(jt)]=jt;new TextDecoder;var Ut=new TextEncoder,qt="undefined"!=typeof window?window:self,Wt=qt.crypto||qt.msCrypto||{};Wt.subtle||Wt.webkitSubtle;var Ht=function(e){var t=new Uint8Array(e);return Wt.getRandomValues(t)},Bt=de("simple-peer"),Yt=65536;function Jt(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var zt=function(e){"use strict";(0,T.default)(n,e);var t=(0,P.default)(n);function n(e){var r;if((0,k.default)(this,n),r=t.call(this,e=Object.assign({allowHalfOpen:!1},e)),(0,x.default)((0,C.default)(r),"_pc",void 0),r.__objectMode=!!e.objectMode,r._id=Dt(Ht(4)).slice(0,7),r._debug("new peer %o",e),r.channelName=e.initiator?e.channelName||Dt(Ht(20)):null,r.initiator=e.initiator||!1,r.channelConfig=e.channelConfig||n.channelConfig,r.channelNegotiated=r.channelConfig.negotiated,r.config=Object.assign({},n.config,e.config),r.offerOptions=e.offerOptions||{},r.answerOptions=e.answerOptions||{},r.sdpTransform=e.sdpTransform||function(e){return e},r.trickle=void 0===e.trickle||e.trickle,r.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,r.iceCompleteTimeout=e.iceCompleteTimeout||5e3,r._destroying=!1,r._connected=!1,r.remoteAddress=void 0,r.remoteFamily=void 0,r.remotePort=void 0,r.localAddress=void 0,r.localFamily=void 0,r.localPort=void 0,!he)throw"undefined"==typeof window?Ft(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):Ft(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");r._pcReady=!1,r._channelReady=!1,r._iceComplete=!1,r._iceCompleteTimer=null,r._channel=null,r._pendingCandidates=[],r._isNegotiating=!1,r._firstNegotiation=!0,r._batchedNegotiation=!1,r._queuedNegotiation=!1,r._sendersAwaitingStable=[],r._closingInterval=null,r._remoteTracks=[],r._remoteStreams=[],r._chunk=null,r._cb=null,r._interval=null;try{r._pc=new he(r.config)}catch(e){return(0,N.default)(r,void r.__destroy(Ft(e,"ERR_PC_CONSTRUCTOR")))}return r._isReactNativeWebrtc="number"==typeof r._pc._peerConnectionId,r._pc.oniceconnectionstatechange=function(){r._onIceStateChange()},r._pc.onicegatheringstatechange=function(){r._onIceStateChange()},r._pc.onconnectionstatechange=function(){r._onConnectionStateChange()},r._pc.onsignalingstatechange=function(){r._onSignalingStateChange()},r._pc.onicecandidate=function(e){r._onIceCandidate(e)},"object"==typeof r._pc.peerIdentity&&r._pc.peerIdentity.catch((function(e){r.__destroy(Ft(e,"ERR_PC_PEER_IDENTITY"))})),r.initiator||r.channelNegotiated?r._setupData({channel:r._pc.createDataChannel(r.channelName,r.channelConfig)}):r._pc.ondatachannel=function(e){r._setupData(e)},r._debug("initial negotiation"),r._needsNegotiation(),r._onFinishBound=function(){r._onFinish()},r.once("finish",r._onFinishBound),(0,N.default)(r)}return(0,E.default)(n,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new pe(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.__destroy(Ft(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.__destroy(Ft(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,n=new _e(e);this._pc.addIceCandidate(n).catch((function(e){!n.address||n.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):t.__destroy(Ft(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"_final",value:function(e){this._readableState.ended||this.push(null),e(null)}},{key:"__destroy",value:function(e){this.end(),this._destroy((function(){}),e)}},{key:"_destroy",value:function(e,t){var n=this;this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),setTimeout((function(){if(n._connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._closingInterval),n._closingInterval=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,n._pc.ontrack=null,n._pc.ondatachannel=null}n._pc=null,n._channel=null,t&&n.emit("error",t),e()}),0))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.__destroy(Ft(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=Yt),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){var n=e.error instanceof Error?e.error:Error("Datachannel error: ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));t.__destroy(Ft(n,"ERR_DATA_CHANNEL"))};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_write",value:function(e,t){if(this.destroyed)return t(Ft(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.__destroy(Ft(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Yt?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=t):t(null)}else this._debug("write before connect"),this._chunk=e,this._cb=t}},{key:"_onFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.__destroy()}),1e3)};this._connected?t():this.once("connect",t)}}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=Jt(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.__destroy(Ft(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.__destroy(Ft(t,"ERR_CREATE_OFFER"))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=Jt(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){var n,r;if(!e.destroyed){var i=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:i.type,sdp:i.sdp}),e.initiator||null===(r=(n=e)._requestMissingTransceivers)||void 0===r||r.call(n)}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.__destroy(Ft(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.__destroy(Ft(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||this._destroying||"failed"===this._pc.connectionState&&this.__destroy(Ft(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.__destroy(Ft(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.__destroy(Ft(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"==={}.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e._destroying||e.getStats((function(n,r){if(!e.destroyed&&!e._destroying){n&&(r=[]);var i={},a={},o={},s=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));var u=function(t){s=!0;var n=a[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)})),s||Object.keys(o).length&&!Object.keys(a).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.__destroy(Ft(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))};t()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>Yt||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t,n=e.data;n instanceof ArrayBuffer?n=new Uint8Array(n):!1===this.__objectMode&&(t=n,n=Ut.encode(t)),this.push(n)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.__destroy())}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Bt.apply(null,e)}}]),n}(Nt);zt.WEBRTC_SUPPORT=!!he,zt.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},zt.channelConfig={};var Kt,Vt,$t,Gt,Qt,Zt,Xt,en,tn,nn=function(e){"use strict";(0,T.default)(n,e);var t=(0,P.default)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,k.default)(this,n),(e=t.call(this,r))._pc&&(e.streams=r.streams||(r.stream?[r.stream]:[]),e._senderMap=new Map,e.streams&&e.streams.forEach((function(t){e.addStream(t)})),e._pc.ontrack=function(t){e._onTrack(t)}),(0,N.default)(e)}return(0,E.default)(n,[{key:"addTransceiver",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.__destroy(Ft(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(n){t.addTrack(n,e)}))}}},{key:"addTrack",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var n=this._senderMap.get(e)||new Map,r=n.get(t);if(r)throw r.removed?Ft(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Ft(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,n){if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw Ft(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.__destroy(Ft(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw Ft(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.__destroy(Ft(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Ft(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(n){t.removeTrack(n,e)}))}}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some((function(e){return e.id===n.id}))||(t._remoteStreams.push(n),queueMicrotask((function(){t._debug("on stream"),t.emit("stream",n)})))}))}}]),n}(zt),rn="data",an="signal",on=function(e,t){var n=new nn((0,A.default)((0,R.default)({iceServers:[{urls:sn}]},t),{initiator:e,trickle:!1})),r=function(e){return i.push(e)},i=[];return n.on(rn,r),{id:n._id,created:Date.now(),connection:n._pc,get channel(){return n._channel},get isDead(){return n.destroyed},signal:function(t){return new Promise((function(r){e||n.on(an,r),n.signal(t)}))},sendData:function(e){return n.send(e)},destroy:function(){return n.destroy()},setHandlers:function(e){return Object.entries(e).forEach((function(e){var t=(0,L.default)(e,2),r=t[0],i=t[1];return n.on(r,i)}))},offerPromise:e?new Promise((function(e){return n.on(an,e)})):Promise.resolve(),addStream:function(e){return n.addStream(e)},removeStream:function(e){return n.removeStream(e)},addTrack:function(e,t){return n.addTrack(e,t)},removeTrack:function(e,t){return n.removeTrack(e,t)},replaceTrack:function(e,t,r){return n.replaceTrack(e,t,r)},drainEarlyData:function(e){n.off(rn,r),i.forEach(e),i=null}}},sn=(0,F.default)(j(5,(function(e,t){return"stun:stun".concat(t||"",".l.google.com:19302")}))).concat(["stun:global.stun.twilio.com:3478"]),un=Object.getPrototypeOf(Uint8Array),cn=16369,ln=255,dn="bufferedamountlow",fn=function(e){return"@_"+e},hn={},pn={},_n={},vn={},yn={},mn={},gn={},bn={},wn=function(){var e=(0,S.default)((function(e){var t;return(0,I.__generator)(this,(function(n){switch(n.label){case 0:return pn[e]?[2,pn[e]]:[4,re(e)];case 1:return t=n.sent().slice(0,20),[2,(pn[e]=t,_n[t]=e,t)]}}))}));return function(t){return e.apply(this,arguments)}}(),Cn=function(){var e=(0,S.default)((function(e,t,n){var r,i;return(0,I.__generator)(this,(function(a){switch(a.label){case 0:return r=e.send,i={action:"announce"},[4,wn(t)];case 1:return[2,r.apply(e,[Z.apply(void 0,[R.default.apply(void 0,[(i.info_hash=a.sent(),i.peer_id=q,i),n])])])]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),Sn=function(e,t,n){return console.warn("".concat(M,": torrent tracker ").concat(n?"failure":"warning"," from ").concat(e," - ").concat(t))},kn=(Kt={init:function(e){return function(e,t,n){return(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||3)}(e,En).map((function(e){var t=function(e,t){var n={},r=function(){var i=new WebSocket(e);i.onclose=function(){var t;null!==(t=(_=ee)[v=e])&&void 0!==t||(_[v]=3333),setTimeout(r,ee[e]),ee[e]*=2},i.onmessage=function(e){return t(e.data)},n.socket=i,n.url=i.url,n.ready=new Promise((function(t){return i.onopen=function(){t(n),ee[e]=3333}})),n.send=function(e){1===i.readyState&&i.send(e)}};return r(),n}(e,(function(e){var t=X(e),r=t["failure reason"],i=t["warning message"],a=t.interval,o=_n[t.info_hash];if(r)Sn(n,r,!0);else{var s,u;if(i&&Sn(n,i),a&&1e3*a>mn[n]&&yn[n][o]){var c=Math.min(1e3*a,120333);clearInterval(vn[n][o]),mn[n]=c,vn[n][o]=setInterval(yn[n][o],c)}gn[t.offer_id]||(t.offer||t.answer)&&(gn[t.offer_id]=!0,null===(u=(s=bn[n])[o])||void 0===u||u.call(s,t))}})),n=t.url;return hn[n]=t,bn[n]={},t.ready}))},subscribe:function(e,t,n,r,i){var a=e.url,o=function(){var n=(0,S.default)((function(){var n;return(0,I.__generator)(this,(function(a){switch(a.label){case 0:return[4,i(10)];case 1:return n=B.apply(void 0,[a.sent().map((function(e){return[U(20),e]}))]),bn[e.url][t]=function(i){if(i.offer)r(t,{offer:i.offer,peerId:i.peer_id},(function(n,r){return Cn(e,t,{answer:X(r).answer,offer_id:i.offer_id,to_peer_id:i.peer_id})}));else if(i.answer){var a=n[i.offer_id];a&&r(t,{answer:i.answer,peerId:i.peer_id,peer:a.peer})}},Cn(e,t,{numwant:10,offers:H(n).map((function(e){var t=(0,L.default)(e,2);return{offer_id:t[0],offer:t[1].offer}}))}),[2]}}))}));return function(){return n.apply(this,arguments)}}();return mn[a]=33333,(y=yn)[m=a]||(y[m]={}),yn[a][t]=o,(g=vn)[b=a]||(g[b]={}),vn[a][t]=setInterval(o,mn[a]),o(),function(){clearInterval(vn[a][t]),delete bn[a][t],delete yn[a][t]}},announce:function(e){return mn[e.url]}},Qt=Kt.init,Zt=Kt.subscribe,Xt=Kt.announce,en={},tn=!1,function(e,t,n){var r,i,_=e.appId;if(null===(i=en[_])||void 0===i?void 0:i[t])return en[_][t];var v={},y={},m=Q(M,_,t),g=re(m),b=re(Q(m,q)),w=e.password&&function(){var e=(0,S.default)((function(e,t,n){var r,i,a;return(0,I.__generator)(this,(function(o){switch(o.label){case 0:return i=(r=crypto.subtle).importKey,a=["raw"],[4,crypto.subtle.digest({name:"SHA-256"},$("".concat(e,":").concat(t,":").concat(n)))];case 1:return[2,i.apply(r,a.concat([o.sent(),{name:te},!1,["encrypt","decrypt"]]))]}}))}));return function(t,n,r){return e.apply(this,arguments)}}()(e.password,_,t),C=function(e){return function(){var t=(0,S.default)((function(t){var n,r;return(0,I.__generator)(this,(function(i){switch(i.label){case 0:return w?(r={type:t.type},[4,e(w,t.sdp)]):[3,2];case 1:return r.sdp=i.sent(),n=r,[3,3];case 2:n=t,i.label=3;case 3:return[2,n]}}))}));return function(e){return t.apply(this,arguments)}}()},k=C(ae),E=C(ie),x=function(){return on(!0,e.rtcConfig)},T=function(e,t,n){var r;y[t]?y[t]!==e&&e.destroy():(y[t]=e,oe(e,t),null===(r=v[t])||void 0===r||r.forEach((function(e,t){t!==n&&e.destroy()})),delete v[t])},N=function(e,t){y[t]===e&&delete y[t]},P=function(e){return(r=$t).push.apply(r,(0,F.default)(j(e,x))),W($t.splice(0,e).map((function(e){return e.offerPromise.then(E).then((function(t){return{peer:e,offer:t}}))})))},D=function(r,i){return null==n?void 0:n({error:"incorrect password (".concat(e.password,") when decrypting ").concat(i),appId:_,peerId:r,roomId:t})},U=function(t){return function(){var n=(0,S.default)((function(n,r,i){var s,u,c,l,d,f,h,p,_,w,C,S,x,R,A,F,O,M,j,U,H,B,Y,J,z,K;return(0,I.__generator)(this,(function(I){switch(I.label){case 0:return[4,W([g,b])];case 1:if(s=L.default.apply(void 0,[I.sent(),2]),u=s[0],c=s[1],n!==u&&n!==c)return[2];if(l="string"==typeof r?X(r):r,d=l.peerId,f=l.offer,h=l.answer,p=l.peer,d===q||y[d])return[3,16];if(d&&!f&&!h)return[3,14];if(!f)return[3,8];if((null===(_=v[d])||void 0===_?void 0:_[t])&&q>d)return[2];(w=on(!1,e.rtcConfig)).setHandlers({connect:function(){return T(w,d,t)},close:function(){return N(w,d)}}),I.label=2;case 2:return I.trys.push([2,4,,5]),[4,k(f)];case 3:return C=I.sent(),[3,5];case 4:return I.sent(),[2,void D(d,"offer")];case 5:return w.isDead?[2]:[4,W([re(Q(m,d)),w.signal(C)])];case 6:return S=L.default.apply(void 0,[I.sent(),2]),x=S[0],R=S[1],A=[x],F={peerId:q},[4,E(R)];case 7:return i.apply(void 0,A.concat([Z.apply(void 0,[(F.answer=I.sent(),F)])])),[3,13];case 8:if(!h)return[3,13];I.label=9;case 9:return I.trys.push([9,11,,12]),[4,k(h)];case 10:return O=I.sent(),[3,12];case 11:return I.sent(),[2,void D(d,"answer")];case 12:p?(p.setHandlers({connect:function(){return T(p,d,t)},close:function(){return N(p,d)}}),p.signal(O)):(j=null===(M=v[d])||void 0===M?void 0:M[t])&&!j.isDead&&j.signal(O),I.label=13;case 13:return[3,16];case 14:return(null===(U=v[d])||void 0===U?void 0:U[t])?[2]:[4,W([P(1),re(Q(m,d))])];case 15:H=L.default.apply(void 0,[I.sent(),2]),B=(0,L.default)(H[0],1),Y=B[0],J=Y.peer,z=Y.offer,K=H[1],(a=v)[o=d]||(a[o]=[]),v[d][t]=J,setTimeout((function(){return function(e,t){var n;if(!y[e]){var r=null===(n=v[e])||void 0===n?void 0:n[t];r&&(delete v[e][t],r.destroy())}}(d,t)}),.9*V[t]),J.setHandlers({connect:function(){return T(J,d,t)},close:function(){return N(J,d)}}),i(K,Z({peerId:q,offer:z})),I.label=16;case 16:return[2]}}))}));return function(e,t,r){return n.apply(this,arguments)}}()};if(!e)throw z("requires a config map as the first argument");if(!_&&!e.firebaseApp)throw z("config map is missing appId field");if(!t)throw z("roomId argument required");if(!tn){var K=Qt(e);$t=j(20,x),Vt=Array.isArray(K)?K:[K],tn=!0,Gt=setInterval((function(){return $t=$t.filter((function(e){var t=Date.now()-e.created<57333;return t||e.destroy(),t}))}),59052.99)}var V=Vt.map((function(){return 5333})),ee=[],ne=Vt.map(function(){var e=(0,S.default)((function(e,t){var n;return(0,I.__generator)(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return n=[r.sent()],[4,g];case 2:return n=n.concat(r.sent()),[4,b];case 3:return[2,Zt.apply(void 0,n.concat([r.sent(),U(t),P]))]}}))}));return function(t,n){return e.apply(this,arguments)}}());W([g,b]).then((function(e){var t=(0,L.default)(e,2),n=t[0],r=t[1],i=function(){var e=(0,S.default)((function(e,t){var a;return(0,I.__generator)(this,(function(o){switch(o.label){case 0:return[4,Xt(e,n,r)];case 1:return"number"==typeof(a=o.sent())&&(V[t]=a),ee[t]=setTimeout((function(){return i(e,t)}),V[t]),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}();ne.forEach(function(){var e=(0,S.default)((function(e,t){return(0,I.__generator)(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,Vt[t]];case 2:return i.apply(void 0,[n.sent(),t]),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}())}));var oe=J;return(s=en)[u=_]||(s[u]={}),en[_][t]=function(e,t,n){var r={},i={},a={},o={},s={},u={},_={onPeerJoin:J,onPeerLeave:J,onPeerStream:J,onPeerTrack:J},v=function(e,t){return(e?Array.isArray(e)?e:[e]:Y(r)).flatMap((function(e){var n=r[e];return n?t(e,n):(console.warn("".concat(M,": no peer with id ").concat(e," found")),[])}))},y=function(e){r[e]&&(delete r[e],delete a[e],delete o[e],_.onPeerLeave(e),t(e))},m=function(e){if(i[e])return[i[e].send,i[e].setOnComplete,i[e].setOnProgress];if(!e)throw z("action type argument is required");var t=$(e);if(t.byteLength>12)throw z('action type string "'.concat(e,'" (').concat(t.byteLength,"b) exceeds byte limit (12). Hint: choose a shorter name."));var n=new Uint8Array(12);n.set(t);var a=0;return i[e]={onComplete:J,onProgress:J,setOnComplete:function(t){return i[e]=(0,A.default)((0,R.default)({},i[e]),{onComplete:t})},setOnProgress:function(t){return i[e]=(0,A.default)((0,R.default)({},i[e]),{onProgress:t})},send:function(e,t,i,o){return(0,S.default)((function(){var s,u,c,l,d,f,h,p,_,y,m;return(0,I.__generator)(this,(function(g){switch(g.label){case 0:if(i&&"object"!=typeof i)throw z("action meta argument must be an object");if("undefined"===(s=void 0===e?"undefined":(0,O.default)(e)))throw z("action data cannot be undefined");if(u="string"!==s,c=e instanceof Blob,l=c||e instanceof ArrayBuffer||e instanceof un,i&&!l)throw z("action meta argument can only be used with binary data");return l?(y=Uint8Array.bind,c?[4,e.arrayBuffer()]:[3,2]):[3,4];case 1:return m=g.sent(),[3,3];case 2:m=e,g.label=3;case 3:return _=new(y.apply(Uint8Array,[void 0,m])),[3,5];case 4:_=$(u?Z(e):e),g.label=5;case 5:return d=_,f=i?$(Z(i)):null,h=Math.ceil(d.byteLength/cn)+(i?1:0)||1,p=j(h,(function(e,t){var r=t===h-1,o=i&&0===t,s=new Uint8Array(15+(o?f.byteLength:r?d.byteLength-cn*(h-(i?2:1)):cn));return s.set(n),s.set([a],12),s.set([r|o<<1|l<<2|u<<3],13),s.set([Math.round((t+1)/h*ln)],14),s.set(i?o?f:d.subarray((t-1)*cn,t*cn):d.subarray(t*cn,(t+1)*cn),15),s})),[2,(a=a+1&ln,W(v(t,function(){var e=(0,S.default)((function(e,t){var n,a,s;return(0,I.__generator)(this,(function(u){switch(u.label){case 0:n=t.channel,a=0,u.label=1;case 1:return a<h?(s=p[a],n.bufferedAmount>n.bufferedAmountLowThreshold?[4,new Promise((function(e){var t=function(){n.removeEventListener(dn,t),e()};n.addEventListener(dn,t)}))]:[3,3]):[3,5];case 2:u.sent(),u.label=3;case 3:if(!r[e])return[3,5];t.sendData(s),a++,null==o||o(s[14]/ln,e,i),u.label=4;case 4:return[3,1];case 5:return[2]}}))}));return function(t,n){return e.apply(this,arguments)}}())))]}}))}))()}},[i[e].send,i[e].setOnComplete,i[e].setOnProgress]},g=function(e,t){var n=new Uint8Array(t),r=G(n.subarray(0,12)).replaceAll("\0",""),o=(0,L.default)(n.subarray(12,13),1)[0],s=(0,L.default)(n.subarray(13,14),1)[0],u=(0,L.default)(n.subarray(14,15),1)[0],_=n.subarray(15),v=!!(1&s),y=!!(2&s),m=!!(4&s),g=!!(8&s);if(i[r]){(c=a)[l=e]||(c[l]={}),(d=a[e])[f=r]||(d[f]={});var b=(h=a[e][r])[p=o]||(h[p]={chunks:[]});if(y?b.meta=X(G(_)):b.chunks.push(_),i[r].onProgress(u/ln,e,b.meta),v){var w=new Uint8Array(b.chunks.reduce((function(e,t){return e+t.byteLength}),0));if(b.chunks.reduce((function(e,t){return w.set(t,e),e+t.byteLength}),0),delete a[e][r][o],m)i[r].onComplete(w,e,b.meta);else{var C=G(w);i[r].onComplete(g?X(C):C,e)}}}else console.warn("".concat(M,": received message with unregistered type (").concat(r,")"))},b=(0,L.default)(m(fn("ping")),2),w=b[0],C=b[1],k=(0,L.default)(m(fn("pong")),2),E=k[0],x=k[1],T=(0,L.default)(m(fn("signal")),2),N=T[0],F=T[1],P=(0,L.default)(m(fn("stream")),2),D=P[0],U=P[1],q=(0,L.default)(m(fn("track")),2),K=q[0],V=q[1],Q=(0,L.default)(m(fn("leave")),2),ee=Q[0],te=Q[1];return oe=function(e,t){var n;r[t]||(r[t]=e,e.setHandlers({data:function(e){return g(t,e)},stream:function(e){_.onPeerStream(e,t,s[t]),delete s[t]},track:function(e,n){_.onPeerTrack(e,n,t,u[t]),delete u[t]},signal:function(e){return N(e,t)},close:function(){return y(t)},error:function(){return y(t)}}),_.onPeerJoin(t),null===(n=e.drainEarlyData)||void 0===n||n.call(e,(function(e){return g(t,e)})))},C((function(e,t){return E("",t)})),x((function(e,t){var n;null===(n=o[t])||void 0===n||n.call(o),delete o[t]})),F((function(e,t){var n;return null===(n=r[t])||void 0===n?void 0:n.signal(e)})),U((function(e,t){return s[t]=e})),V((function(e,t){return u[t]=e})),te((function(e,t){return y(t)})),{makeAction:m,ping:function(e){return(0,S.default)((function(){var t;return(0,I.__generator)(this,(function(n){switch(n.label){case 0:if(!e)throw z("ping() must be called with target peer ID");return t=Date.now(),w("",e),[4,new Promise((function(t){return o[e]=t}))];case 1:return[2,(n.sent(),Date.now()-t)]}}))}))()},leave:function(){return(0,S.default)((function(){return(0,I.__generator)(this,(function(e){switch(e.label){case 0:return[4,ee("")];case 1:return e.sent(),[4,new Promise((function(e){return setTimeout(e,99)}))];case 2:return e.sent(),H(r).forEach((function(e){var t=(0,L.default)(e,2),n=t[0];t[1].destroy(),delete r[n]})),n(),[2]}}))}))()},getPeers:function(){return B(H(r).map((function(e){var t=(0,L.default)(e,2);return[t[0],t[1].connection]})))},addStream:function(e,t,n){return v(t,function(){var t=(0,S.default)((function(t,r){return(0,I.__generator)(this,(function(i){switch(i.label){case 0:return n?[4,D(n,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r.addStream(e),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}())},removeStream:function(e,t){return v(t,(function(t,n){return n.removeStream(e)}))},addTrack:function(e,t,n,r){return v(n,function(){var n=(0,S.default)((function(n,i){return(0,I.__generator)(this,(function(a){switch(a.label){case 0:return r?[4,K(r,n)]:[3,2];case 1:a.sent(),a.label=2;case 2:return i.addTrack(e,t),[2]}}))}));return function(e,t){return n.apply(this,arguments)}}())},removeTrack:function(e,t,n){return v(n,(function(n,r){return r.removeTrack(e,t)}))},replaceTrack:function(e,t,n,r,i){return v(r,function(){var r=(0,S.default)((function(r,a){return(0,I.__generator)(this,(function(o){switch(o.label){case 0:return i?[4,K(i,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return a.replaceTrack(e,t,n),[2]}}))}));return function(e,t){return r.apply(this,arguments)}}())},onPeerJoin:function(e){return _.onPeerJoin=e},onPeerLeave:function(e){return _.onPeerLeave=e},onPeerStream:function(e){return _.onPeerStream=e},onPeerTrack:function(e){return _.onPeerTrack=e}}}(0,(function(e){return delete y[e]}),(function(){delete en[_][t],ee.forEach(clearTimeout),ne.forEach(function(){var e=(0,S.default)((function(e){return(0,I.__generator)(this,(function(t){switch(t.label){case 0:return[4,e];case 1:return[2,t.sent()()]}}))}));return function(t){return e.apply(this,arguments)}}()),clearInterval(Gt)}))}),En=(hn,["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.files.fm:7073/announce","tracker.btorrent.xyz"].map((function(e){return"wss://"+e})))}))}();
