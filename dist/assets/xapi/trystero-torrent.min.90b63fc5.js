var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("hsMrW",(function(t,i){var n,s,r,a;n=t.exports,s="joinRoom",r=function(){return si},Object.defineProperty(n,s,{get:r,set:a,enumerable:!0,configurable:!0});var o,d,h,l,c,u,p,f,_,m,g,y,b,v,w,C,S=e("2Xs1f"),E=e("dM3DM"),x=e("aQXMn"),T=e("jhEmn");const k="Trystero",R=(e,t)=>Array(e).fill().map(t),A=e=>R(e,(()=>"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Math.floor(62*Math.random())])).join(""),N=A(20),L=Promise.all.bind(Promise),{entries:F,fromEntries:P,keys:O}=Object,I=()=>{},D=e=>Error(`${k}: ${e}`),M=new TextEncoder,j=new TextDecoder,U=e=>M.encode(e),q=e=>j.decode(e),W=(...e)=>e.join("@"),$=JSON.stringify,H=JSON.parse,B={},Y="AES-GCM",z={},J=async e=>{if(z[e])return z[e];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",U(e)))).map((e=>e.toString(36))).join("");return z[e]=t,t},K=async(e,t)=>{const i=crypto.getRandomValues(new Uint8Array(16));var n;return i.join(",")+"$"+(n=await crypto.subtle.encrypt({name:Y,iv:i},await e,U(t)),btoa(String.fromCharCode.apply(null,new Uint8Array(n))))},V=async(e,t)=>{const[i,n]=t.split("$");return q(await crypto.subtle.decrypt({name:Y,iv:new Uint8Array(i.split(","))},await e,(e=>{const t=atob(e);return new Uint8Array(t.length).map(((e,i)=>t.charCodeAt(i))).buffer})(n)))};function G(e){return e&&e.__esModule&&{}.hasOwnProperty.call(e,"default")?e.default:e}var X,Z,Q={exports:{}};var ee=function(e){function t(e){let n,s,r,a=null;function o(...e){if(!o.enabled)return;const i=o,s=Number(new Date),r=s-(n||s);i.diff=r,i.prev=n,i.curr=s,n=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";a++;const r=t.formatters[s];if("function"==typeof r){const t=e[a];n=r.call(i,t),e.splice(a,1),a--}return n})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==t.namespaces&&(s=t.namespaces,r=t.enabled(e)),r),set(e){a=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,i){const n=t(this.namespace+(void 0===i?":":i)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let i;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(i=0;i<s;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.slice(1)+"$")):t.names.push(RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let i,n;for(i=0,n=t.skips.length;i<n;i++)if(t.skips[i].test(e))return!1;for(i=0,n=t.names.length;i<n;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=function(){if(Z)return X;Z=1;var e=1e3,t=60*e,i=60*t,n=24*i,s=7*n;function r(e,t,i,n){var s=t>=1.5*i;return Math.round(e/i)+" "+n+(s?"s":"")}return X=(a,o)=>{o=o||{};var d=typeof a;if("string"===d&&a.length>0)return function(r){if(!((r+="").length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return o*s;case"days":case"day":case"d":return o*n;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*t;case"seconds":case"second":case"secs":case"sec":case"s":return o*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(a);if("number"===d&&isFinite(a))return o.long?function(s){var a=Math.abs(s);return a>=n?r(s,a,n,"day"):a>=i?r(s,a,i,"hour"):a>=t?r(s,a,t,"minute"):a>=e?r(s,a,e,"second"):s+" ms"}(a):function(s){var r=Math.abs(s);return r>=n?Math.round(s/n)+"d":r>=i?Math.round(s/i)+"h":r>=t?Math.round(s/t)+"m":r>=e?Math.round(s/e)+"s":s+"ms"}(a);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((i=>{t[i]=e[i]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))})),t.splice(s,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==T&&"env"in T&&(e=void 0),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=ee(t);const{formatters:i}=e.exports;i.j=e=>{try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Q,Q.exports);var te=G(Q.exports);const ie="undefined"!=typeof window?window:self,ne=ie.RTCPeerConnection||ie.mozRTCPeerConnection||ie.webkitRTCPeerConnection,se=ie.RTCSessionDescription||ie.mozRTCSessionDescription||ie.webkitRTCSessionDescription,re=ie.RTCIceCandidate||ie.mozRTCIceCandidate||ie.webkitRTCIceCandidate;var ae,oe={exports:{}},de="object"==typeof Reflect?Reflect:null,he=de&&"function"==typeof de.apply?de.apply:function(e,t,i){return function(){}.apply.call(e,t,i)};ae=de&&"function"==typeof de.ownKeys?de.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var le=Number.isNaN||function(e){return e!=e};function ce(){ce.init.call(this)}oe.exports=ce,oe.exports.once=function(e,t){return new Promise(((i,n)=>{function s(i){e.removeListener(t,r),n(i)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",s),i([].slice.call(arguments))}we(e,t,r,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&we(e,"error",t,{once:!0})}(e,s)}))},ce.EventEmitter=ce,ce.prototype._events=void 0,ce.prototype._eventsCount=0,ce.prototype._maxListeners=void 0;var ue=10;function pe(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function fe(e){return void 0===e._maxListeners?ce.defaultMaxListeners:e._maxListeners}function _e(e,t,i,n){var s,r,a,o;if(pe(i),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),r=e._events),a=r[t]),void 0===a)a=r[t]=i,++e._eventsCount;else if("function"==typeof a?a=r[t]=n?[i,a]:[a,i]:n?a.unshift(i):a.push(i),(s=fe(e))>0&&a.length>s&&!a.warned){a.warned=!0;var d=Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,o=d,console&&console.warn&&console.warn(o)}return e}function me(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ge(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},s=me.bind(n);return s.listener=i,n.wrapFn=s,s}function ye(e,t,i){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(e){for(var t=Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(s):ve(s,s.length)}function be(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function ve(e,t){for(var i=Array(t),n=0;n<t;++n)i[n]=e[n];return i}function we(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(r){n.once&&e.removeEventListener(t,s),i(r)}))}}Object.defineProperty(ce,"defaultMaxListeners",{enumerable:!0,get:()=>ue,set(e){if("number"!=typeof e||e<0||le(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ue=e}}),ce.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ce.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||le(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ce.prototype.getMaxListeners=function(){return fe(this)},ce.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var a=Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var o=s[e];if(void 0===o)return!1;if("function"==typeof o)he(o,this,t);else{var d=o.length,h=ve(o,d);for(i=0;i<d;++i)he(h[i],this,t)}return!0},ce.prototype.addListener=function(e,t){return _e(this,e,t,!1)},ce.prototype.on=ce.prototype.addListener,ce.prototype.prependListener=function(e,t){return _e(this,e,t,!0)},ce.prototype.once=function(e,t){return pe(t),this.on(e,ge(this,e,t)),this},ce.prototype.prependOnceListener=function(e,t){return pe(t),this.prependListener(e,ge(this,e,t)),this},ce.prototype.removeListener=function(e,t){var i,n,s,r,a;if(pe(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,s=r;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},ce.prototype.off=ce.prototype.removeListener,ce.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var s,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},ce.prototype.listeners=function(e){return ye(this,e,!0)},ce.prototype.rawListeners=function(e){return ye(this,e,!1)},ce.listenerCount=(e,t)=>"function"==typeof e.listenerCount?e.listenerCount(t):be.call(e,t),ce.prototype.listenerCount=be,ce.prototype.eventNames=function(){return this._eventsCount>0?ae(this._events):[]};var Ce=oe.exports,Se="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);const Ee=class{clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}constructor(e){if(!(e>0)||e-1&e)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}};var xe=class{decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}constructor(e){this.decoder=new TextDecoder("utf16le"===e?"utf16-le":e)}};const Te=xe,ke=xe,{EventEmitter:Re}=Ce,Ae=Error("Stream was destroyed"),Ne=Se,Le=class{clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new Ee(2*this.head.buffer.length),this.head.push(e)}}shift(){0!==this.length&&this.length--;const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){const e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}isEmpty(){return 0===this.length}constructor(e){this.hwm=e||16,this.head=new Ee(this.hwm),this.tail=this.head,this.length=0}},Fe=class{push(e){return"string"==typeof e?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}constructor(e="utf8"){switch(this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:throw Error("Unknown encoding: "+e)}}(e),this.encoding){case"utf8":this.decoder=new ke;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Te(this.encoding)}}},Pe=536870910,Oe=16384,Ie=32768,De=131072,Me=536870143,je=536838143,Ue=536739839,qe=524288,We=1048576,$e=2097152,He=8388608,Be=16777216,Ye=33554432,ze=134217728,Je=469499903,Ke=503316479,Ve=262160,Ge=8404992,Xe=8405006,Ze=33587200,Qe=33587215,et=270794767,tt=Symbol.asyncIterator||Symbol();class it{get ended(){return!!(this.stream._duplexState&He)}push(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=$e,!0):(this.stream._duplexState|=6291456,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=534773759),e}end(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=535822335&this.stream._duplexState|134217728}autoBatch(e,t){const i=[],n=this.stream;for(i.push(e);2359296==(n._duplexState&et);)i.push(n._writableState.shift());if(15&n._duplexState)return t(null);n._writev(i,t)}update(){const e=this.stream;e._duplexState|=qe;do{for(;(e._duplexState&et)===$e;){const t=this.shift();e._duplexState|=67371008,e._write(t,this.afterWrite)}1310720&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536346623}updateNonPrimary(){const e=this.stream;if((144965647&e._duplexState)===ze)return e._duplexState=402653183&e._duplexState|262144,void e._final(at.bind(this));4!=(14&e._duplexState)?1==(e._duplexState&Qe)&&(e._duplexState=(e._duplexState|Ve)&Pe,e._open(ut.bind(this))):e._duplexState&Ze||(e._duplexState|=Ve,e._destroy(ot.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&Ye)&&(this.stream._duplexState&=Ke,!0)}updateCallback(){(35127311&this.stream._duplexState)===We?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Ye||(this.stream._duplexState|=Ye,this.stream._duplexState&qe||Ne(this.afterUpdateNextTick))}constructor(e,{highWaterMark:t=16384,map:i=null,mapWritable:n,byteLength:s,byteLengthWritable:r}={}){this.stream=e,this.queue=new Le,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=r||s||yt,this.map=n||i,this.afterWrite=dt.bind(this),this.afterUpdateNextTick=ct.bind(this)}}class nt{get ended(){return!!(this.stream._duplexState&Oe)}pipe(e,t){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new st(this.stream,e,t),t&&this.stream.on("error",bt),gt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",bt),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const t=this.pipeline.done.bind(this.pipeline,e),i=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",t),e.on("close",i),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",rt.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=536805311&t._duplexState|1024,!1):(null!==this.map&&null===(e=this.map(e))||(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=536805375&t._duplexState|128),this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=536862591),e}unshift(e){const t=[null!==this.map?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let e=0;e<t.length-1;e++){const i=t[e];this.buffered+=this.byteLength(i),this.queue.push(i)}this.push(t[t.length-1])}read(){const e=this.stream;if(128==(16527&e._duplexState)){const t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Me),2048&e._duplexState&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=De,this.updateNextTick()),null}drain(){const e=this.stream;for(;128==(16527&e._duplexState)&&768&e._duplexState;){const t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Me),2048&e._duplexState&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)===De;)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=8192,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536870879}updateNonPrimary(){const e=this.stream;1024==(1167&e._duplexState)&&(e._duplexState=536869887&e._duplexState|16384,e.emit("end"),(e._duplexState&Xe)===Ge&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(14&e._duplexState)?1==(e._duplexState&Qe)&&(e._duplexState=(e._duplexState|Ve)&Pe,e._open(ut.bind(this))):e._duplexState&Ze||(e._duplexState|=Ve,e._destroy(ot.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&Ie)&&(this.stream._duplexState&=je,!0)}updateCallback(){64==(32879&this.stream._duplexState)?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Ie||(this.stream._duplexState|=Ie,32&this.stream._duplexState||Ne(this.afterUpdateNextTick))}constructor(e,{highWaterMark:t=16384,map:i=null,mapReadable:n,byteLength:s,byteLengthReadable:r}={}){this.stream=e,this.queue=new Le,this.highWaterMark=0===t?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=r||s||yt,this.map=n||i,this.pipeTo=null,this.afterRead=ht.bind(this),this.afterUpdateNextTick=lt.bind(this)}}class st{finished(){this.pipeToFinished=!0}done(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&Oe||this.to.destroy(this.error||Error("Readable stream closed before ending")):this.from._duplexState&Oe&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"))}constructor(e,t,i){this.from=e,this.to=t,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}}function rt(){this.stream._duplexState|=512,this.updateCallback()}function at(e){const t=this.stream;e&&t.destroy(e),14&t._duplexState||(t._duplexState|=He,t.emit("finish")),(t._duplexState&Xe)===Ge&&(t._duplexState|=4),t._duplexState&=Je,t._duplexState&qe?this.updateNextTick():this.update()}function ot(e){const t=this.stream;e||this.error===Ae||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");const i=t._readableState,n=t._writableState;if(null!==i&&null!==i.pipeline&&i.pipeline.done(t,e),null!==n){for(;null!==n.drains&&n.drains.length>0;)n.drains.shift().resolve(!1);null!==n.pipeline&&n.pipeline.done(t,e)}}function dt(e){const t=this.stream;e&&t.destroy(e),t._duplexState&=Je,null!==this.drains&&function(e){for(let t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),4194304==(6553615&t._duplexState)&&(t._duplexState&=532676607,(t._duplexState&Be)===Be&&t.emit("drain")),this.updateCallback()}function ht(e){e&&this.stream.destroy(e),this.stream._duplexState&=536870895,!1!==this.readAhead||256&this.stream._duplexState||(this.stream._duplexState&=Ue),this.updateCallback()}function lt(){32&this.stream._duplexState||(this.stream._duplexState&=je,this.update())}function ct(){this.stream._duplexState&qe||(this.stream._duplexState&=Ke,this.update())}function ut(e){const t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=64),142606351&t._duplexState||(t._duplexState|=We),t.emit("open")),t._duplexState&=536608751,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function pt(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=Be,this._writableState.updateNextTick())}class ft extends Re{_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(14&this._duplexState)}destroy(e){14&this._duplexState||(e||(e=Ae),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",vt.bind(this))),this.on("newListener",pt)}}class _t extends ft{setEncoding(e){const t=new Fe(e),i=this._readableState.map||mt;return this._readableState.map=function(e){const n=t.push(e);return""===n?null:i(n)},this}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=131328,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(e,t){let i;const n=new _t((0,x.default)((0,E.default)({},t),{read(t){e.next().then(s).then(t.bind(null,null)).catch(t)},predestroy(){i=e.return()},destroy(e){if(!i)return e(null);i.then(e.bind(null,null)).catch(e)}}));return n;function s(e){e.done?n.push(null):n.push(e.value)}}static from(e,t){if(gt(i=e)&&i.readable)return e;var i;if(e[tt])return this._fromAsyncIterator(e[tt](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);let n=0;return new _t((0,x.default)((0,E.default)({},t),{read(t){this.push(n===e.length?null:e[n++]),t(null)}}))}static isBackpressured(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return!(256&e._duplexState)}[tt](){const e=this;let t=null,i=null,n=null;return this.on("error",(e=>{t=e})),this.on("readable",(function(){null!==i&&s(e.read())})),this.on("close",(function(){null!==i&&s(null)})),{[tt](){return this},next:()=>new Promise(((t,r)=>{i=t,n=r;const a=e.read();null!==a?s(a):8&e._duplexState&&s(null)})),return:()=>r(null),throw:e=>r(e)};function s(s){null!==n&&(t?n(t):null!==s||e._duplexState&Oe?i({value:s,done:null===s}):n(Ae),n=i=null)}function r(t){return e.destroy(t),new Promise(((i,n)=>{if(8&e._duplexState)return i({value:void 0,done:!0});e.once("close",(()=>{t?n(t):i({value:void 0,done:!0})}))}))}}constructor(e){super(e),this._duplexState|=8519681,this._readableState=new nt(this,e),e&&(!1===this._readableState.readAhead&&(this._duplexState&=Ue),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}}function mt(e){return e}function gt(e){return"number"==typeof e._duplexState&&function(e){return!!e._readableState||!!e._writableState}(e)}function yt(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function bt(){}function vt(){this.destroy(Error("Stream aborted."))}var wt=class extends _t{cork(){this._duplexState|=268435456}uncork(){this._duplexState&=268435455,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}constructor(e){super(e),this._duplexState=1|this._duplexState&De,this._writableState=new it(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}};function Ct(e,t){for(const i in t)Object.defineProperty(e,i,{value:t[i],enumerable:!0,configurable:!0});return e}var St=G((function(e,t,i){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");i||(i={}),"object"==typeof t&&(i=t,t=""),t&&(i.code=t);try{return Ct(e,i)}catch(t){i.message=e.message,i.stack=e.stack;const n=()=>{};return n.prototype=Object.create(Object.getPrototypeOf(e)),Ct(new n,i)}}));const Et="0123456789abcdef",xt=[];for(let e=0;e<256;e++)xt[e]=Et[e>>4&15]+Et[15&e];const Tt=e=>{const t=e.length;let i="",n=0;for(;n<t;)i+=xt[e[n++]];return i};for(var kt="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Rt=0;Rt<64;Rt++)kt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(Rt)]=Rt;new TextDecoder;const At=new TextEncoder,Nt="undefined"!=typeof window?window:self,Lt=Nt.crypto||Nt.msCrypto||{};Lt.subtle||Lt.webkitSubtle;const Ft=e=>{const t=new Uint8Array(e);return Lt.getRandomValues(t)},Pt=te("simple-peer"),Ot=65536;function It(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}let Dt=class e extends wt{get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw St(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new se(e)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((e=>{this._addIceCandidate(e)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((e=>{this.__destroy(St(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.__destroy(St(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new re(e);this._pc.addIceCandidate(t).catch((e=>{!t.address||t.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):this.__destroy(St(e,"ERR_ADD_ICE_CANDIDATE"))}))}send(e){if(!this._destroying){if(this.destroyed)throw St(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1})))}negotiate(){if(!this._destroying){if(this.destroyed)throw St(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy((()=>{}),e)}_destroy(e,t){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),setTimeout((()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t&&this.emit("error",t),e()}),0))}_setupData(e){if(!e.channel)return this.__destroy(St(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=Ot),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{const t=e.error instanceof Error?e.error:Error(`Datachannel error: ${e.message} ${e.filename}:${e.lineno}:${e.colno}`);this.__destroy(St(t,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1}),5e3)}_write(e,t){if(this.destroyed)return t(St(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.__destroy(St(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Ot?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=t):t(null)}else this._debug("write before connect"),this._chunk=e,this._cb=t}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout((()=>this.__destroy()),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=It(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})};this._pc.setLocalDescription(e).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.__destroy(St(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.__destroy(St(e,"ERR_CREATE_OFFER"))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=It(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{var t;if(this.destroyed)return;const i=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:i.type,sdp:i.sdp}),this.initiator||null===(t=this._requestMissingTransceivers)||void 0===t||t.call(this)};this._pc.setLocalDescription(e).then((()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.__destroy(St(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.__destroy(St(e,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||this._destroying||"failed"===this._pc.connectionState&&this.__destroy(St(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.__destroy(St(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.__destroy(St(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=e=>("[object Array]"==={}.toString.call(e.values)&&e.values.forEach((t=>{Object.assign(e,t)})),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((i=>{const n=[];i.forEach((e=>{n.push(t(e))})),e(null,n)}),(t=>e(t))):this._pc.getStats.length>0?this._pc.getStats((i=>{if(this.destroyed)return;const n=[];i.result().forEach((e=>{const i={};e.names().forEach((t=>{i[t]=e.stat(t)})),i.id=e.id,i.type=e.type,i.timestamp=e.timestamp,n.push(t(i))})),e(null,n)}),(t=>e(t))):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats(((t,i)=>{if(this.destroyed||this._destroying)return;t&&(i=[]);const n={},s={},r={};let a=!1;i.forEach((e=>{"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(n[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(s[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(r[e.id]=e)}));const o=e=>{a=!0;let t=s[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let i=n[e.remoteCandidateId];i&&(i.ip||i.address)?(this.remoteAddress=i.ip||i.address,this.remotePort=Number(i.port)):i&&i.ipAddress?(this.remoteAddress=i.ipAddress,this.remotePort=Number(i.portNumber)):"string"==typeof e.googRemoteAddress&&(i=e.googRemoteAddress.split(":"),this.remoteAddress=i[0],this.remotePort=Number(i[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(i.forEach((e=>{"transport"===e.type&&e.selectedCandidatePairId&&o(r[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&o(e)})),a||Object.keys(r).length&&!Object.keys(s).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.__destroy(St(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(e,100)}))};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Ot||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;var i;t instanceof ArrayBuffer?t=new Uint8Array(t):!1===this.__objectMode&&(i=t,t=At.encode(i)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Pt.apply(null,e)}constructor(t){if(super(t=Object.assign({allowHalfOpen:!1},t)),(0,S.default)(this,"_pc",void 0),this.__objectMode=!!t.objectMode,this._id=Tt(Ft(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Tt(Ft(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||e.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},e.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(e=>e),this.trickle=void 0===t.trickle||t.trickle,this.allowHalfTrickle=void 0!==t.allowHalfTrickle&&t.allowHalfTrickle,this.iceCompleteTimeout=t.iceCompleteTimeout||5e3,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!ne)throw"undefined"==typeof window?St(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):St(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new ne(this.config)}catch(e){return void this.__destroy(St(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((e=>{this.__destroy(St(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}};Dt.WEBRTC_SUPPORT=!!ne,Dt.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Dt.channelConfig={};class Mt extends Dt{addTransceiver(e,t){if(!this._destroying){if(this.destroyed)throw St(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.__destroy(St(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this._destroying){if(this.destroyed)throw St(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((t=>{this.addTrack(t,e)}))}}addTrack(e,t){if(this._destroying)return;if(this.destroyed)throw St(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(e)||new Map;let n=i.get(t);if(n)throw n.removed?St(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):St(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");n=this._pc.addTrack(e,t),i.set(t,n),this._senderMap.set(e,i),this._needsNegotiation()}replaceTrack(e,t,i){if(this._destroying)return;if(this.destroyed)throw St(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const n=this._senderMap.get(e),s=n?n.get(i):null;if(!s)throw St(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),null!=s.replaceTrack?s.replaceTrack(t):this.__destroy(St(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this._destroying)return;if(this.destroyed)throw St(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(e),n=i?i.get(t):null;if(!n)throw St(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(n):this.__destroy(St(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this._destroying){if(this.destroyed)throw St(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((t=>{this.removeTrack(t,e)}))}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))}))}_onTrack(e){this.destroyed||e.streams.forEach((t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some((e=>e.id===t.id))||(this._remoteStreams.push(t),queueMicrotask((()=>{this._debug("on stream"),this.emit("stream",t)})))}))}constructor(e={}){super(e),this._pc&&(this.streams=e.streams||(e.stream?[e.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach((e=>{this.addStream(e)})),this._pc.ontrack=e=>{this._onTrack(e)})}}const jt="data",Ut="signal";var qt=(e,t)=>{const i=new Mt((0,x.default)((0,E.default)({iceServers:[{urls:Wt}]},t),{initiator:e,trickle:!1})),n=e=>s.push(e);let s=[];return i.on(jt,n),{id:i._id,created:Date.now(),connection:i._pc,get channel(){return i._channel},get isDead(){return i.destroyed},signal:t=>new Promise((n=>{e||i.on(Ut,n),i.signal(t)})),sendData:e=>i.send(e),destroy:()=>i.destroy(),setHandlers:e=>Object.entries(e).forEach((([e,t])=>i.on(e,t))),offerPromise:e?new Promise((e=>i.on(Ut,e))):Promise.resolve(),addStream:e=>i.addStream(e),removeStream:e=>i.removeStream(e),addTrack:(e,t)=>i.addTrack(e,t),removeTrack:(e,t)=>i.removeTrack(e,t),replaceTrack:(e,t,n)=>i.replaceTrack(e,t,n),drainEarlyData(e){i.off(jt,n),s.forEach(e),s=null}}};const Wt=[...R(5,((e,t)=>`stun:stun${t||""}.l.google.com:19302`)),"stun:global.stun.twilio.com:3478"],$t=Object.getPrototypeOf(Uint8Array),Ht=16369,Bt=255,Yt="bufferedamountlow",zt=e=>"@_"+e,Jt={},Kt={},Vt={},Gt={},Xt={},Zt={},Qt={},ei={},ti=async e=>{if(Kt[e])return Kt[e];const t=(await J(e)).slice(0,20);return Kt[e]=t,Vt[t]=e,t},ii=async(e,t,i)=>e.send($((0,E.default)({action:"announce",info_hash:await ti(t),peer_id:N},i))),ni=(e,t,i)=>console.warn(`${k}: torrent tracker ${i?"failure":"warning"} from ${e} - ${t}`),si=(({init:e,subscribe:t,announce:i})=>{const n={};let s,r,a,g=!1;return(y,b,v)=>{var w;const{appId:C}=y;if(null===(w=n[C])||void 0===w?void 0:w[b])return n[C][b];const S={},T={},A=W(k,C,b),M=J(A),j=J(W(A,N)),B=y.password&&(async(e,t,i)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},U(`${e}:${t}:${i}`)),{name:Y},!1,["encrypt","decrypt"]))(y.password,C,b),z=e=>async t=>B?{type:t.type,sdp:await e(B,t.sdp)}:t,G=z(V),X=z(K),Z=()=>qt(!0,y.rtcConfig),Q=(e,t,i)=>{var n;T[t]?T[t]!==e&&e.destroy():(T[t]=e,ae(e,t),null===(n=S[t])||void 0===n||n.forEach(((e,t)=>{t!==i&&e.destroy()})),delete S[t])},ee=(e,t)=>{T[t]===e&&delete T[t]},te=e=>(r.push(...R(e,Z)),L(r.splice(0,e).map((e=>e.offerPromise.then(X).then((t=>({peer:e,offer:t}))))))),ie=(e,t)=>null==v?void 0:v({error:`incorrect password (${y.password}) when decrypting ${t}`,appId:C,peerId:e,roomId:b});if(!y)throw D("requires a config map as the first argument");if(!C&&!y.firebaseApp)throw D("config map is missing appId field");if(!b)throw D("roomId argument required");if(!g){const t=e(y);r=R(20,Z),s=Array.isArray(t)?t:[t],g=!0,a=setInterval((()=>r=r.filter((e=>{const t=Date.now()-e.created<57333;return t||e.destroy(),t}))),59052.99)}const ne=s.map((()=>5333)),se=[],re=s.map((async(e,i)=>t(await e,await M,await j,(e=>async(t,i,n)=>{const[s,r]=await L([M,j]);if(t!==s&&t!==r)return;const{peerId:a,offer:h,answer:l,peer:c}="string"==typeof i?H(i):i;if(a!==N&&!T[a])if(!a||h||l){if(h){var u;if((null===(u=S[a])||void 0===u?void 0:u[e])&&N>a)return;const t=qt(!1,y.rtcConfig);let i;t.setHandlers({connect:()=>Q(t,a,e),close:()=>ee(t,a)});try{i=await G(h)}catch(e){return void ie(a,"offer")}if(t.isDead)return;const[s,r]=await L([J(W(A,a)),t.signal(i)]);n(s,$({peerId:N,answer:await X(r)}))}else if(l){let t;try{t=await G(l)}catch(e){return void ie(a,"answer")}if(c)c.setHandlers({connect:()=>Q(c,a,e),close:()=>ee(c,a)}),c.signal(t);else{var p;const i=null===(p=S[a])||void 0===p?void 0:p[e];i&&!i.isDead&&i.signal(t)}}}else{var f;if(null===(f=S[a])||void 0===f?void 0:f[e])return;const[[{peer:t,offer:i}],s]=await L([te(1),J(W(A,a))]);(o=S)[d=a]||(o[d]=[]),S[a][e]=t,setTimeout((()=>((e,t)=>{var i;if(T[e])return;const n=null===(i=S[e])||void 0===i?void 0:i[t];n&&(delete S[e][t],n.destroy())})(a,e)),.9*ne[e]),t.setHandlers({connect:()=>Q(t,a,e),close:()=>ee(t,a)}),n(s,$({peerId:N,offer:i}))}})(i),te)));L([M,j]).then((([e,t])=>{const n=async(s,r)=>{const a=await i(s,e,t);"number"==typeof a&&(ne[r]=a),se[r]=setTimeout((()=>n(s,r)),ne[r])};re.forEach((async(e,t)=>{await e,n(await s[t],t)}))}));let ae=I;return(h=n)[l=C]||(h[l]={}),n[C][b]=((e,t,i)=>{const n={},s={},r={},a={},o={},d={},h={onPeerJoin:I,onPeerLeave:I,onPeerStream:I,onPeerTrack:I},l=(e,t)=>(e?Array.isArray(e)?e:[e]:O(n)).flatMap((e=>{const i=n[e];return i?t(e,i):(console.warn(`${k}: no peer with id ${e} found`),[])})),g=e=>{n[e]&&(delete n[e],delete r[e],delete a[e],h.onPeerLeave(e),t(e))},y=e=>{if(s[e])return[s[e].send,s[e].setOnComplete,s[e].setOnProgress];if(!e)throw D("action type argument is required");const t=U(e);if(t.byteLength>12)throw D(`action type string "${e}" (${t.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const i=new Uint8Array(12);i.set(t);let r=0;return s[e]={onComplete:I,onProgress:I,setOnComplete:t=>s[e]=(0,x.default)((0,E.default)({},s[e]),{onComplete:t}),setOnProgress:t=>s[e]=(0,x.default)((0,E.default)({},s[e]),{onProgress:t}),async send(e,t,s,a){if(s&&"object"!=typeof s)throw D("action meta argument must be an object");const o=typeof e;if("undefined"===o)throw D("action data cannot be undefined");const d="string"!==o,h=e instanceof Blob,c=h||e instanceof ArrayBuffer||e instanceof $t;if(s&&!c)throw D("action meta argument can only be used with binary data");const u=c?new Uint8Array(h?await e.arrayBuffer():e):U(d?$(e):e),p=s?U($(s)):null,f=Math.ceil(u.byteLength/Ht)+(s?1:0)||1,_=R(f,((e,t)=>{const n=t===f-1,a=s&&0===t,o=new Uint8Array(15+(a?p.byteLength:n?u.byteLength-Ht*(f-(s?2:1)):Ht));return o.set(i),o.set([r],12),o.set([n|a<<1|c<<2|d<<3],13),o.set([Math.round((t+1)/f*Bt)],14),o.set(s?a?p:u.subarray((t-1)*Ht,t*Ht):u.subarray(t*Ht,(t+1)*Ht),15),o}));return r=r+1&Bt,L(l(t,(async(e,t)=>{const{channel:i}=t;let r=0;for(;r<f;){const o=_[r];if(i.bufferedAmount>i.bufferedAmountLowThreshold&&await new Promise((e=>{const t=()=>{i.removeEventListener(Yt,t),e()};i.addEventListener(Yt,t)})),!n[e])break;t.sendData(o),r++,null==a||a(o[14]/Bt,e,s)}})))}},[s[e].send,s[e].setOnComplete,s[e].setOnProgress]},b=(e,t)=>{const i=new Uint8Array(t),n=q(i.subarray(0,12)).replaceAll("\0",""),[a]=i.subarray(12,13),[o]=i.subarray(13,14),[d]=i.subarray(14,15),h=i.subarray(15),l=!!(1&o),g=!!(2&o),y=!!(4&o),b=!!(8&o);if(!s[n])return void console.warn(`${k}: received message with unregistered type (${n})`);(c=r)[u=e]||(c[u]={}),(p=r[e])[f=n]||(p[f]={});const v=(_=r[e][n])[m=a]||(_[m]={chunks:[]});if(g?v.meta=H(q(h)):v.chunks.push(h),s[n].onProgress(d/Bt,e,v.meta),!l)return;const w=new Uint8Array(v.chunks.reduce(((e,t)=>e+t.byteLength),0));if(v.chunks.reduce(((e,t)=>(w.set(t,e),e+t.byteLength)),0),delete r[e][n][a],y)s[n].onComplete(w,e,v.meta);else{const t=q(w);s[n].onComplete(b?H(t):t,e)}},[v,w]=y(zt("ping")),[C,S]=y(zt("pong")),[T,A]=y(zt("signal")),[N,M]=y(zt("stream")),[j,W]=y(zt("track")),[B,Y]=y(zt("leave"));return(e=>{ae=e})(((e,t)=>{var i;n[t]||(n[t]=e,e.setHandlers({data:e=>b(t,e),stream(e){h.onPeerStream(e,t,o[t]),delete o[t]},track(e,i){h.onPeerTrack(e,i,t,d[t]),delete d[t]},signal:e=>T(e,t),close:()=>g(t),error:()=>g(t)}),h.onPeerJoin(t),null===(i=e.drainEarlyData)||void 0===i||i.call(e,(e=>b(t,e))))})),w(((e,t)=>C("",t))),S(((e,t)=>{var i;null===(i=a[t])||void 0===i||i.call(a),delete a[t]})),A(((e,t)=>{var i;return null===(i=n[t])||void 0===i?void 0:i.signal(e)})),M(((e,t)=>o[t]=e)),W(((e,t)=>d[t]=e)),Y(((e,t)=>g(t))),{makeAction:y,async ping(e){if(!e)throw D("ping() must be called with target peer ID");const t=Date.now();return v("",e),await new Promise((t=>a[e]=t)),Date.now()-t},async leave(){await B(""),await new Promise((e=>setTimeout(e,99))),F(n).forEach((([e,t])=>{t.destroy(),delete n[e]})),i()},getPeers:()=>P(F(n).map((([e,t])=>[e,t.connection]))),addStream:(e,t,i)=>l(t,(async(t,n)=>{i&&await N(i,t),n.addStream(e)})),removeStream:(e,t)=>l(t,((t,i)=>i.removeStream(e))),addTrack:(e,t,i,n)=>l(i,(async(i,s)=>{n&&await j(n,i),s.addTrack(e,t)})),removeTrack:(e,t,i)=>l(i,((i,n)=>n.removeTrack(e,t))),replaceTrack:(e,t,i,n,s)=>l(n,(async(n,r)=>{s&&await j(s,n),r.replaceTrack(e,t,i)})),onPeerJoin:e=>h.onPeerJoin=e,onPeerLeave:e=>h.onPeerLeave=e,onPeerStream:e=>h.onPeerStream=e,onPeerTrack:e=>h.onPeerTrack=e}})(0,(e=>delete T[e]),(()=>{delete n[C][b],se.forEach(clearTimeout),re.forEach((async e=>(await e)())),clearInterval(a)}))}})({init:e=>((e,t,i)=>(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||3))(e,ai).map((e=>{const t=((e,t)=>{const i={},n=()=>{const s=new WebSocket(e);s.onclose=()=>{var t;null!==(t=(g=B)[y=e])&&void 0!==t||(g[y]=3333),setTimeout(n,B[e]),B[e]*=2},s.onmessage=e=>t(e.data),i.socket=s,i.url=s.url,i.ready=new Promise((t=>s.onopen=()=>{t(i),B[e]=3333})),i.send=e=>{1===s.readyState&&s.send(e)}};return n(),i})(e,(e=>{const t=H(e),n=t["failure reason"],s=t["warning message"],{interval:r}=t,a=Vt[t.info_hash];if(n)ni(i,n,!0);else{var o,d;if(s&&ni(i,s),r&&1e3*r>Zt[i]&&Xt[i][a]){const e=Math.min(1e3*r,120333);clearInterval(Gt[i][a]),Zt[i]=e,Gt[i][a]=setInterval(Xt[i][a],e)}Qt[t.offer_id]||(t.offer||t.answer)&&(Qt[t.offer_id]=!0,null===(d=(o=ei[i])[a])||void 0===d||d.call(o,t))}})),{url:i}=t;return Jt[i]=t,ei[i]={},t.ready})),subscribe(e,t,i,n,s){const{url:r}=e,a=async()=>{const i=P((await s(10)).map((e=>[A(20),e])));ei[e.url][t]=s=>{if(s.offer)n(t,{offer:s.offer,peerId:s.peer_id},((i,n)=>ii(e,t,{answer:H(n).answer,offer_id:s.offer_id,to_peer_id:s.peer_id})));else if(s.answer){const e=i[s.offer_id];e&&n(t,{answer:s.answer,peerId:s.peer_id,peer:e.peer})}},ii(e,t,{numwant:10,offers:F(i).map((([e,{offer:t}])=>({offer_id:e,offer:t})))})};return Zt[r]=33333,(b=Xt)[v=r]||(b[v]={}),Xt[r][t]=a,(w=Gt)[C=r]||(w[C]={}),Gt[r][t]=setInterval(a,Zt[r]),a(),()=>{clearInterval(Gt[r][t]),delete ei[r][t],delete Xt[r][t]}},announce:e=>Zt[e.url]});ri=Jt;var ri;const ai=["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.files.fm:7073/announce","tracker.btorrent.xyz"].map((e=>"wss://"+e))}));