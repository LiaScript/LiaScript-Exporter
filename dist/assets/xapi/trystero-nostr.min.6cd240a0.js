!function(){var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("1UDrq",(function(t,n){var r,i,a,o;r=t.exports,i="joinRoom",a=function(){return ii},Object.defineProperty(r,i,{get:a,set:o,enumerable:!0,configurable:!0});var u,s,c,l,f,d,h,p,v,y,g,m,_=e("f1evb"),b=e("hnmIs"),w=e("9Klpk"),E=e("3bWnf"),S=e("eT7f3"),k=e("kb0qF"),C=e("bgoEC"),x=e("7j4mF"),A=e("1Qswt"),T=e("5ENmm"),R=e("6Wo7Q"),I=e("rJmE6"),N=e("fSF4h"),B=e("bWNdT"),O=e("32Euv"),L=e("84cK9");function P(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, not "+e)}function F(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!((i=e)instanceof Uint8Array||null!=i&&"object"==typeof i&&"Uint8Array"===i.constructor.name))throw Error("Uint8Array expected");var i;if(n.length>0&&!n.includes(e.length))throw Error("Uint8Array expected of length ".concat(n,", not of length=").concat(e.length))}function D(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}var U="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,q=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},M=function(e,t){return e<<32-t|e>>>t};function j(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+(void 0===e?"undefined":(0,I.default)(e)));return new Uint8Array((new TextEncoder).encode(e))}(e)),F(e),e}new Uint8Array(new Uint32Array([287454020]).buffer)[0];var H=function(){"use strict";function e(){(0,w.default)(this,e)}return(0,E.default)(e,[{key:"clone",value:function(){return this._cloneInto()}}]),e}();function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(U&&"function"==typeof U.getRandomValues)return U.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}var W=function(e,t,n){return e&t^e&n^t&n},K=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(e,r,i,a){var o;return(0,w.default)(this,n),(o=t.call(this)).blockLen=e,o.outputLen=r,o.padOffset=i,o.isLE=a,o.finished=!1,o.length=0,o.pos=0,o.destroyed=!1,o.buffer=new Uint8Array(e),o.view=q(o.buffer),(0,A.default)(o)}return(0,E.default)(n,[{key:"update",value:function(e){D(this);for(var t=this,n=t.view,r=t.buffer,i=t.blockLen,a=(e=j(e)).length,o=0;o<a;){var u=Math.min(i-this.pos,a-o);if(u!==i)r.set(e.subarray(o,o+u),this.pos),this.pos+=u,o+=u,this.pos===i&&(this.process(n,0),this.pos=0);else for(var s=q(e);i<=a-o;o+=i)this.process(s,o)}return this.length+=e.length,this.roundClean(),this}},{key:"digestInto",value:function(e){D(this),function(e,t){F(e);var n=t.outputLen;if(e.length<n)throw Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;var t=this,n=t.buffer,r=t.view,i=t.blockLen,a=t.isLE,o=this.pos;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(var u=o;u<i;u++)n[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);var i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),u=Number(n&a),s=r?4:0,c=r?0:4;e.setUint32(t+s,o,r),e.setUint32(t+c,u,r)}(r,i-8,BigInt(8*this.length),a),this.process(r,0);var s=q(e),c=this.outputLen;if(c%4)throw Error("_sha2: outputLen should be aligned to 32bit");var l=c/4,f=this.get();if(l>f.length)throw Error("_sha2: outputLen bigger than state");for(var d=0;d<l;d++)s.setUint32(4*d,f[d],a)}},{key:"digest",value:function(){var e=this.buffer,t=this.outputLen;this.digestInto(e);var n=e.slice(0,t);return this.destroy(),n}},{key:"_cloneInto",value:function(e){var t;e||(e=new this.constructor),(t=e).set.apply(t,(0,R.default)(this.get()));var n=this,r=n.blockLen,i=n.buffer,a=n.length,o=n.finished,u=n.destroyed,s=n.pos;return e.length=a,e.pos=s,e.finished=o,e.destroyed=u,a%r&&e.buffer.set(i),e}}]),n}(H),V=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Z=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Y=new Uint32Array(64),G=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(){var e;return(0,w.default)(this,n),(e=t.call(this,64,32,8,!1)).A=0|Z[0],e.B=0|Z[1],e.C=0|Z[2],e.D=0|Z[3],e.E=0|Z[4],e.F=0|Z[5],e.G=0|Z[6],e.H=0|Z[7],(0,A.default)(e)}return(0,E.default)(n,[{key:"get",value:function(){var e=this;return[e.A,e.B,e.C,e.D,e.E,e.F,e.G,e.H]}},{key:"set",value:function(e,t,n,r,i,a,o,u){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|a,this.G=0|o,this.H=0|u}},{key:"process",value:function(e,t){for(var n=0;n<16;n++,t+=4)Y[n]=e.getUint32(t,!1);for(var r=16;r<64;r++){var i=Y[r-15],a=Y[r-2],o=M(i,7)^M(i,18)^i>>>3,u=M(a,17)^M(a,19)^a>>>10;Y[r]=u+Y[r-7]+o+Y[r-16]|0}for(var s,c=this,l=c.A,f=c.B,d=c.C,h=c.D,p=c.E,v=c.F,y=c.G,g=c.H,m=0;m<64;m++){var _=g+(M(p,6)^M(p,11)^M(p,25))+((s=p)&v^~s&y)+V[m]+Y[m]|0,b=(M(l,2)^M(l,13)^M(l,22))+W(l,f,d)|0;g=y,y=v,v=p,p=h+_|0,h=d,d=f,f=l,l=_+b|0}l=l+this.A|0,f=f+this.B|0,d=d+this.C|0,h=h+this.D|0,p=p+this.E|0,v=v+this.F|0,y=y+this.G|0,g=g+this.H|0,this.set(l,f,d,h,p,v,y,g)}},{key:"roundClean",value:function(){Y.fill(0)}},{key:"destroy",value:function(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}]),n}(K),J=function(e){var t=function(t){return e().update(j(t)).digest()},n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=function(){return e()},t}((function(){return new G})),$=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(e,r){var i;(0,w.default)(this,n),(i=t.call(this)).finished=!1,i.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");P(e.outputLen),P(e.blockLen)}(e);var a=j(r);if(i.iHash=e.create(),"function"!=typeof i.iHash.update)throw Error("Expected instance of class which extends utils.Hash");i.blockLen=i.iHash.blockLen,i.outputLen=i.iHash.outputLen;var o=i.blockLen,u=new Uint8Array(o);u.set(a.length>o?e.create().update(a).digest():a);for(var s=0;s<u.length;s++)u[s]^=54;i.iHash.update(u),i.oHash=e.create();for(var c=0;c<u.length;c++)u[c]^=106;return i.oHash.update(u),u.fill(0),(0,A.default)(i)}return(0,E.default)(n,[{key:"update",value:function(e){return D(this),this.iHash.update(e),this}},{key:"digestInto",value:function(e){D(this),F(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}},{key:"digest",value:function(){var e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}},{key:"_cloneInto",value:function(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));var t=this,n=t.oHash,r=t.iHash,i=t.finished,a=t.destroyed,o=t.blockLen,u=t.outputLen;return e.finished=i,e.destroyed=a,e.blockLen=o,e.outputLen=u,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}},{key:"destroy",value:function(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}]),n}(H),Q=function(e,t,n){return new $(e,t).update(n).digest()};Q.create=function(e,t){return new $(e,t)};var X=BigInt(0),ee=BigInt(1),te=BigInt(2);function ne(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function re(e){if(!ne(e))throw Error("Uint8Array expected")}var ie=Array.from({length:256},(function(e,t){return t.toString(16).padStart(2,"0")}));function ae(e){re(e);for(var t="",n=0;n<e.length;n++)t+=ie[e[n]];return t}function oe(e){var t=e.toString(16);return 1&t.length?"0"+t:t}function ue(e){if("string"!=typeof e)throw Error("hex string expected, got "+(void 0===e?"undefined":(0,I.default)(e)));return BigInt(""===e?"0":"0x"+e)}var se={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ce(e){return e>=se._0&&e<=se._9?e-se._0:e>=se._A&&e<=se._F?e-(se._A-10):e>=se._a&&e<=se._f?e-(se._a-10):void 0}function le(e){if("string"!=typeof e)throw Error("hex string expected, got "+(void 0===e?"undefined":(0,I.default)(e)));var t=e.length,n=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);for(var r=new Uint8Array(n),i=0,a=0;i<n;i++,a+=2){var o=ce(e.charCodeAt(a)),u=ce(e.charCodeAt(a+1));if(void 0===o||void 0===u){var s=e[a]+e[a+1];throw Error('hex string expected, got non-hex character "'+s+'" at index '+a)}r[i]=16*o+u}return r}function fe(e){return ue(ae(e))}function de(e){return re(e),ue(ae(Uint8Array.from(e).reverse()))}function he(e,t){return le(e.toString(16).padStart(2*t,"0"))}function pe(e,t){return he(e,t).reverse()}function ve(e,t,n){var r;if("string"==typeof t)try{r=le(t)}catch(n){throw Error("".concat(e,' must be valid hex string, got "').concat(t,'". Cause: ').concat(n))}else{if(!ne(t))throw Error(e+" must be hex string or Uint8Array");r=Uint8Array.from(t)}var i=r.length;if("number"==typeof n&&i!==n)throw Error("".concat(e," expected ").concat(n," bytes, got ").concat(i));return r}function ye(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=0;i<t.length;i++){var a=t[i];re(a),r+=a.length}for(var o=new Uint8Array(r),u=0,s=0;u<t.length;u++){var c=t[u];o.set(c,s),s+=c.length}return o}var ge=function(e){return(te<<BigInt(e-1))-ee},me=function(e){return new Uint8Array(e)},_e=function(e){return Uint8Array.from(e)};function be(e,t,n){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof n)throw Error("hmacFn must be a function");var r=me(e),i=me(e),a=0,o=function(){r.fill(1),i.fill(0),a=0},u=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return n.apply(void 0,[i,r].concat((0,R.default)(t)))},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me();i=u(_e([0]),e),r=u(),0!==e.length&&(i=u(_e([1]),e),r=u())},c=function(){if(a++>=1e3)throw Error("drbg: tried 1000 values");for(var e=0,n=[];e<t;){var i=(r=u()).slice();n.push(i),e+=r.length}return ye.apply(void 0,(0,R.default)(n))};return function(e,t){var n;for(o(),s(e);!(n=t(c()));)s();return o(),n}}var we={bigint:function(e){return"bigint"==(void 0===e?"undefined":(0,I.default)(e))},function:function(e){return"function"==typeof e},boolean:function(e){return"boolean"==typeof e},string:function(e){return"string"==typeof e},stringOrUint8Array:function(e){return"string"==typeof e||ne(e)},isSafeInteger:function(e){return Number.isSafeInteger(e)},array:function(e){return Array.isArray(e)},field:function(e,t){return t.Fp.isValid(e)},hash:function(e){return"function"==typeof e&&Number.isSafeInteger(e.outputLen)}};function Ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=function(t,n,r){var i=we[n];if("function"!=typeof i)throw Error('Invalid validator "'.concat(n,'", expected function'));var a=e[t];if(!(r&&void 0===a||i(a,e)))throw Error("Invalid param ".concat(t+"","=").concat(a," (").concat(void 0===a?"undefined":(0,I.default)(a),"), expected ").concat(n))},i=!0,a=!1,o=void 0;try{for(var u,s=Object.entries(t)[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=(0,T.default)(u.value,2);r(c[0],c[1],!1)}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}var l=!0,f=!1,d=void 0;try{for(var h,p=Object.entries(n)[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var v=(0,T.default)(h.value,2);r(v[0],v[1],!0)}}catch(e){f=!0,d=e}finally{try{l||null==p.return||p.return()}finally{if(f)throw d}}return e}var Se=Object.freeze({__proto__:null,abytes:re,bitGet:function(e,t){return e>>BigInt(t)&ee},bitLen:function(e){var t;for(t=0;e>X;e>>=ee,t+=1);return t},bitMask:ge,bitSet:function(e,t,n){return e|(n?ee:X)<<BigInt(t)},bytesToHex:ae,bytesToNumberBE:fe,bytesToNumberLE:de,concatBytes:ye,createHmacDrbg:be,ensureBytes:ve,equalBytes:function(e,t){if(e.length!==t.length)return!1;for(var n=0,r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},hexToBytes:le,hexToNumber:ue,isBytes:ne,numberToBytesBE:he,numberToBytesLE:pe,numberToHexUnpadded:oe,numberToVarBytesBE:function(e){return le(oe(e))},utf8ToBytes:function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+(void 0===e?"undefined":(0,I.default)(e)));return new Uint8Array((new TextEncoder).encode(e))},validateObject:Ee}),ke=BigInt(0),Ce=BigInt(1),xe=BigInt(2),Ae=BigInt(3),Te=BigInt(4),Re=BigInt(5),Ie=BigInt(8);function Ne(e,t){var n=e%t;return n>=ke?n:t+n}function Be(e,t,n){if(n<=ke||t<ke)throw Error("Expected power/modulo > 0");if(n===Ce)return ke;for(var r=Ce;t>ke;)t&Ce&&(r=r*e%n),e=e*e%n,t>>=Ce;return r}function Oe(e,t,n){for(var r=e;t-- >ke;)r*=r,r%=n;return r}function Le(e,t){if(e===ke||t<=ke)throw Error("invert: expected positive integers, got n=".concat(e," mod=").concat(t));for(var n=Ne(e,t),r=t,i=ke,a=Ce;n!==ke;){var o=r%n,u=i-a*(r/n);r=n,n=o,i=a,a=u}if(r!==Ce)throw Error("invert: does not exist");return Ne(i,t)}BigInt(9),BigInt(16);var Pe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Fe(e,t){var n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function De(e){if("bigint"!=(void 0===e?"undefined":(0,I.default)(e)))throw Error("field order must be bigint");var t=e.toString(2).length;return Math.ceil(t/8)}function Ue(e){var t=De(e);return t+Math.ceil(t/2)}var qe,Me=BigInt(0),je=BigInt(1);function He(e){return Ee(e.Fp,Pe.reduce((function(e,t){return e[t]="function",e}),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Ee(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze((0,x.default)((0,C.default)({},Fe(e.n,e.nBitLength),e),{p:e.Fp.ORDER}))}var ze=Se.bytesToNumberBE,We=Se.hexToBytes,Ke=(qe={Err:function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,w.default)(this,n),t.call(this,e)}return n}((0,N.default)(Error))},(0,S.default)(qe,"_parseInt",(function(e){var t=Ke.Err;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");var n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:ze(r),l:e.subarray(n+2)}})),(0,S.default)(qe,"toSig",(function(e){var t=Ke.Err,n="string"==typeof e?We(e):e;re(n);var r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");var i=Ke._parseInt(n.subarray(2)),a=i.d,o=i.l,u=Ke._parseInt(o),s=u.d;if(u.l.length)throw new t("Invalid signature: left bytes after parsing");return{r:a,s:s}})),(0,S.default)(qe,"hexFromSig",(function(e){var t=function(e){return 8&Number.parseInt(e[0],16)?"00"+e:e},n=function(e){var t=e.toString(16);return 1&t.length?"0"+t:t},r=t(n(e.s)),i=t(n(e.r)),a=r.length/2,o=i.length/2,u=n(a),s=n(o);return"30".concat(n(o+a+4),"02").concat(s).concat(i,"02").concat(u).concat(r)})),qe),Ve=BigInt(0),Ze=BigInt(1);BigInt(2);var Ye=BigInt(3);function Ge(e){var t=function(e){var t=He(e);return Ee(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze((0,C.default)({lowS:!0},t))}(e),n=t.Fp,r=t.n,i=n.BYTES+1,a=2*n.BYTES+1;function o(e){return Ne(e,r)}function u(e){return Le(e,r)}var s=function(e){var t=function(e){var t=He(e);Ee(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});var n=t.endo,r=t.Fp,i=t.a;if(n){if(!r.eql(i,r.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=(0,I.default)(n.beta)||"function"!=typeof n.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze((0,C.default)({},t))}(e),n=t.Fp,r=t.toBytes||function(e,t){var r=t.toAffine();return ye(Uint8Array.from([4]),n.toBytes(r.x),n.toBytes(r.y))},i=t.fromBytes||function(e){var t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}};function a(e){var r=t.a,i=t.b,a=n.sqr(e),o=n.mul(a,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),a(t.Gx)))throw Error("bad generator point: equation left != right");function o(e){return"bigint"==(void 0===e?"undefined":(0,I.default)(e))&&Ve<e&&e<t.n}function u(e){if(!o(e))throw Error("Expected valid bigint: 0 < bigint < curve.n")}function s(e){var n,r=t.allowedPrivateKeyLengths,i=t.nByteLength,a=t.wrapPrivateKey,o=t.n;if(r&&"bigint"!=(void 0===e?"undefined":(0,I.default)(e))){if(ne(e)&&(e=ae(e)),"string"!=typeof e||!r.includes(e.length))throw Error("Invalid key");e=e.padStart(2*i,"0")}try{n="bigint"==(void 0===e?"undefined":(0,I.default)(e))?e:fe(ve("private key",e,i))}catch(t){throw Error("private key must be ".concat(i," bytes, hex or bigint, not ").concat(void 0===e?"undefined":(0,I.default)(e)))}return a&&(n=Ne(n,o)),u(n),n}var c=new Map;function l(e){if(!(e instanceof f))throw Error("ProjectivePoint expected")}var f=function(){"use strict";function e(t,r,i){if((0,w.default)(this,e),this.px=t,this.py=r,this.pz=i,null==t||!n.isValid(t))throw Error("x required");if(null==r||!n.isValid(r))throw Error("y required");if(null==i||!n.isValid(i))throw Error("z required")}return(0,E.default)(e,[{key:"x",get:function(){return this.toAffine().x}},{key:"y",get:function(){return this.toAffine().y}},{key:"_setWindowSize",value:function(e){this._WINDOW_SIZE=e,c.delete(this)}},{key:"assertValidity",value:function(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw Error("bad point: ZERO")}var e=this.toAffine(),r=e.x,i=e.y;if(!n.isValid(r)||!n.isValid(i))throw Error("bad point: x or y not FE");var o=n.sqr(i),u=a(r);if(!n.eql(o,u))throw Error("bad point: equation left != right");if(!this.isTorsionFree())throw Error("bad point: not in prime-order subgroup")}},{key:"hasEvenY",value:function(){var e=this.toAffine().y;if(n.isOdd)return!n.isOdd(e);throw Error("Field doesn't support isOdd")}},{key:"equals",value:function(e){l(e);var t=this,r=t.px,i=t.py,a=t.pz,o=e.px,u=e.py,s=e.pz,c=n.eql(n.mul(r,s),n.mul(o,a)),f=n.eql(n.mul(i,s),n.mul(u,a));return c&&f}},{key:"negate",value:function(){return new e(this.px,n.neg(this.py),this.pz)}},{key:"double",value:function(){var r=t.a,i=t.b,a=n.mul(i,Ye),o=this,u=o.px,s=o.py,c=o.pz,l=n.ZERO,f=n.ZERO,d=n.ZERO,h=n.mul(u,u),p=n.mul(s,s),v=n.mul(c,c),y=n.mul(u,s);return y=n.add(y,y),d=n.mul(u,c),d=n.add(d,d),l=n.mul(r,d),f=n.mul(a,v),f=n.add(l,f),l=n.sub(p,f),f=n.add(p,f),f=n.mul(l,f),l=n.mul(y,l),d=n.mul(a,d),v=n.mul(r,v),y=n.sub(h,v),y=n.mul(r,y),y=n.add(y,d),d=n.add(h,h),h=n.add(d,h),h=n.add(h,v),h=n.mul(h,y),f=n.add(f,h),v=n.mul(s,c),v=n.add(v,v),h=n.mul(v,y),l=n.sub(l,h),d=n.mul(v,p),d=n.add(d,d),new e(l,f,d=n.add(d,d))}},{key:"add",value:function(r){l(r);var i=this,a=i.px,o=i.py,u=i.pz,s=r.px,c=r.py,f=r.pz,d=n.ZERO,h=n.ZERO,p=n.ZERO,v=t.a,y=n.mul(t.b,Ye),g=n.mul(a,s),m=n.mul(o,c),_=n.mul(u,f),b=n.add(a,o),w=n.add(s,c);b=n.mul(b,w),w=n.add(g,m),b=n.sub(b,w),w=n.add(a,u);var E=n.add(s,f);return w=n.mul(w,E),E=n.add(g,_),w=n.sub(w,E),E=n.add(o,u),d=n.add(c,f),E=n.mul(E,d),d=n.add(m,_),E=n.sub(E,d),p=n.mul(v,w),d=n.mul(y,_),p=n.add(d,p),d=n.sub(m,p),p=n.add(m,p),h=n.mul(d,p),m=n.add(g,g),m=n.add(m,g),_=n.mul(v,_),w=n.mul(y,w),m=n.add(m,_),_=n.sub(g,_),_=n.mul(v,_),w=n.add(w,_),g=n.mul(m,w),h=n.add(h,g),g=n.mul(E,w),d=n.mul(b,d),d=n.sub(d,g),g=n.mul(b,m),p=n.mul(E,p),new e(d,h,p=n.add(p,g))}},{key:"subtract",value:function(e){return this.add(e.negate())}},{key:"is0",value:function(){return this.equals(e.ZERO)}},{key:"wNAF",value:function(t){return h.wNAFCached(this,c,t,(function(t){var r=n.invertBatch(t.map((function(e){return e.pz})));return t.map((function(e,t){return e.toAffine(r[t])})).map(e.fromAffine)}))}},{key:"multiplyUnsafe",value:function(r){var i=e.ZERO;if(r===Ve)return i;if(u(r),r===Ze)return this;var a=t.endo;if(!a)return h.unsafeLadder(this,r);for(var o=a.splitScalar(r),s=o.k1neg,c=o.k1,l=o.k2neg,f=o.k2,d=i,p=i,v=this;c>Ve||f>Ve;)c&Ze&&(d=d.add(v)),f&Ze&&(p=p.add(v)),v=v.double(),c>>=Ze,f>>=Ze;return s&&(d=d.negate()),l&&(p=p.negate()),p=new e(n.mul(p.px,a.beta),p.py,p.pz),d.add(p)}},{key:"multiply",value:function(r){u(r);var i,a,o=r,s=t.endo;if(s){var c=s.splitScalar(o),l=c.k1neg,f=c.k1,d=c.k2neg,p=c.k2,v=this.wNAF(f),y=v.p,g=v.f,m=this.wNAF(p),_=m.p,b=m.f;y=h.constTimeNegate(l,y),_=h.constTimeNegate(d,_),_=new e(n.mul(_.px,s.beta),_.py,_.pz),i=y.add(_),a=g.add(b)}else{var w=this.wNAF(o);i=w.p,a=w.f}return e.normalizeZ([i,a])[0]}},{key:"multiplyAndAddUnsafe",value:function(t,n,r){var i=e.BASE,a=function(e,t){return t!==Ve&&t!==Ze&&e.equals(i)?e.multiply(t):e.multiplyUnsafe(t)},o=a(this,n).add(a(t,r));return o.is0()?void 0:o}},{key:"toAffine",value:function(e){var t=this,r=t.px,i=t.py,a=t.pz,o=this.is0();null==e&&(e=o?n.ONE:n.inv(a));var u=n.mul(r,e),s=n.mul(i,e),c=n.mul(a,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw Error("invZ was invalid");return{x:u,y:s}}},{key:"isTorsionFree",value:function(){var n=t.h,r=t.isTorsionFree;if(n===Ze)return!0;if(r)return r(e,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}},{key:"clearCofactor",value:function(){var n=t.h,r=t.clearCofactor;return n===Ze?this:r?r(e,this):this.multiplyUnsafe(t.h)}},{key:"toRawBytes",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.assertValidity(),r(e,this,t)}},{key:"toHex",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return ae(this.toRawBytes(e))}}],[{key:"fromAffine",value:function(t){var r=t||{},i=r.x,a=r.y;if(!t||!n.isValid(i)||!n.isValid(a))throw Error("invalid affine point");if(t instanceof e)throw Error("projective point not allowed");var o=function(e){return n.eql(e,n.ZERO)};return o(i)&&o(a)?e.ZERO:new e(i,a,n.ONE)}},{key:"normalizeZ",value:function(t){var r=n.invertBatch(t.map((function(e){return e.pz})));return t.map((function(e,t){return e.toAffine(r[t])})).map(e.fromAffine)}},{key:"fromHex",value:function(t){var n=e.fromAffine(i(ve("pointHex",t)));return n.assertValidity(),n}},{key:"fromPrivateKey",value:function(t){return e.BASE.multiply(s(t))}}]),e}();f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);var d=t.nBitLength,h=function(e,t){var n,r=function(e,t){var n=t.negate();return e?n:t},i=function(e){return{windows:Math.ceil(t/e)+1,windowSize:Math.pow(2,e-1)}};return n={constTimeNegate:r,unsafeLadder:function(t,n){for(var r=e.ZERO,i=t;n>Me;)n&je&&(r=r.add(i)),i=i.double(),n>>=je;return r},precomputeWindow:function(e,t){for(var n=i(t),r=n.windows,a=n.windowSize,o=[],u=e,s=u,c=0;c<r;c++){s=u,o.push(s);for(var l=1;l<a;l++)s=s.add(u),o.push(s);u=s.double()}return o}},(0,S.default)(n,"wNAF",(function(t,n,a){for(var o=i(t),u=o.windows,s=o.windowSize,c=e.ZERO,l=e.BASE,f=BigInt(Math.pow(2,t)-1),d=Math.pow(2,t),h=BigInt(t),p=0;p<u;p++){var v=p*s,y=Number(a&f);a>>=h,y>s&&(y-=d,a+=je);var g=v,m=v+Math.abs(y)-1,_=p%2!=0,b=y<0;0===y?l=l.add(r(_,n[g])):c=c.add(r(b,n[m]))}return{p:c,f:l}})),(0,S.default)(n,"wNAFCached",(function(e,t,n,r){var i=e._WINDOW_SIZE||1,a=t.get(e);return a||(a=this.precomputeWindow(e,i),1!==i&&t.set(e,r(a))),this.wNAF(i,a,n)})),n}(f,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:s,weierstrassEquation:a,isWithinCurveOrder:o}}((0,x.default)((0,C.default)({},t),{toBytes:function(e,t,r){var i=t.toAffine(),a=n.toBytes(i.x),o=ye;return r?o(Uint8Array.from([t.hasEvenY()?2:3]),a):o(Uint8Array.from([4]),a,n.toBytes(i.y))},fromBytes:function(e){var t=e.length,r=e[0],o=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===a&&4===r)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};throw Error("Point of length ".concat(t," was invalid. Expected ").concat(i," compressed bytes or ").concat(a," uncompressed bytes"))}var u=fe(o);if(!(Ve<(c=u)&&c<n.ORDER))throw Error("Point is not on curve");var s,c,l=f(u);try{s=n.sqrt(l)}catch(e){var d=e instanceof Error?": "+e.message:"";throw Error("Point is not on curve"+d)}return!(1&~r)!=((s&Ze)===Ze)&&(s=n.neg(s)),{x:u,y:s}}})),c=s.ProjectivePoint,l=s.normPrivateKeyToScalar,f=s.weierstrassEquation,d=s.isWithinCurveOrder,h=function(e){return ae(he(e,t.nByteLength))};function p(e){return e>r>>Ze}var v=function(e,t,n){return fe(e.slice(t,n))},y=function(){"use strict";function e(t,n,r){(0,w.default)(this,e),this.r=t,this.s=n,this.recovery=r,this.assertValidity()}return(0,E.default)(e,[{key:"assertValidity",value:function(){if(!d(this.r))throw Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw Error("s must be 0 < s < CURVE.n")}},{key:"addRecoveryBit",value:function(t){return new e(this.r,this.s,t)}},{key:"recoverPublicKey",value:function(e){var r=this,i=r.r,a=r.s,s=r.recovery,l=b(ve("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw Error("recovery id invalid");var f=2===s||3===s?i+t.n:i;if(f>=n.ORDER)throw Error("recovery id 2 or 3 invalid");var d=1&s?"03":"02",p=c.fromHex(d+h(f)),v=u(f),y=o(-l*v),g=o(a*v),m=c.BASE.multiplyAndAddUnsafe(p,y,g);if(!m)throw Error("point at infinify");return m.assertValidity(),m}},{key:"hasHighS",value:function(){return p(this.s)}},{key:"normalizeS",value:function(){return this.hasHighS()?new e(this.r,o(-this.s),this.recovery):this}},{key:"toDERRawBytes",value:function(){return le(this.toDERHex())}},{key:"toDERHex",value:function(){return Ke.hexFromSig({r:this.r,s:this.s})}},{key:"toCompactRawBytes",value:function(){return le(this.toCompactHex())}},{key:"toCompactHex",value:function(){return h(this.r)+h(this.s)}}],[{key:"fromCompact",value:function(n){var r=t.nByteLength;return n=ve("compactSignature",n,2*r),new e(v(n,0,r),v(n,r,2*r))}},{key:"fromDER",value:function(t){var n=Ke.toSig(ve("DER",t));return new e(n.r,n.s)}}]),e}(),g={isValidPrivateKey:function(e){try{return l(e),!0}catch(e){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:function(){var e=Ue(t.n);return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.length,i=De(t),a=Ue(t);if(r<16||r<a||r>1024)throw Error("expected ".concat(a,"-1024 bytes of input, got ").concat(r));var o=Ne(n?fe(e):de(e),t-Ce)+Ce;return n?pe(o,i):he(o,i)}(t.randomBytes(e),t.n)},precompute:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function m(e){var t=ne(e),n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===a:n?r===2*i||r===2*a:e instanceof c}var _=t.bits2int||function(e){var n=fe(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return o(_(e))},k=ge(t.nBitLength);function A(e){if("bigint"!=(void 0===e?"undefined":(0,I.default)(e)))throw Error("bigint expected");if(!(Ve<=e&&e<k))throw Error("bigint expected < 2^"+t.nBitLength);return he(e,t.nByteLength)}function T(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B;if(["recovered","canonical"].some((function(e){return e in i})))throw Error("sign() legacy options not supported");var a=t.hash,s=t.randomBytes,f=i.lowS,h=i.prehash,v=i.extraEntropy;null==f&&(f=!0),e=ve("msgHash",e),h&&(e=ve("prehashed msgHash",a(e)));var g=b(e),m=l(r),w=[A(m),A(g)];if(null!=v&&!1!==v){var E=!0===v?s(n.BYTES):v;w.push(ve("extraEntropy",E))}var S=ye.apply(void 0,(0,R.default)(w)),k=g;return{seed:S,k2sig:function(e){var t=_(e);if(d(t)){var n=u(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i!==Ve){var a=o(n*o(k+i*m));if(a!==Ve){var s=(r.x===i?0:2)|Number(r.y&Ze),l=a;return f&&p(a)&&(l=function(e){return p(e)?o(-e):e}(a),s^=1),new y(i,l,s)}}}}}}var N,B={lowS:t.lowS,prehash:!1},O={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),N={CURVE:t,getPublicKey:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(m(e))throw Error("first arg must be private key");if(!m(t))throw Error("second arg must be public key");return c.fromHex(t).multiply(l(e)).toRawBytes(n)},sign:function(e,n){var r=T(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:B),i=r.seed,a=r.k2sig,o=t;return be(o.hash.outputLen,o.nByteLength,o.hmac)(i,a)}},(0,S.default)(N,"verify",(function(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O,s=e;if(n=ve("msgHash",n),r=ve("publicKey",r),"strict"in a)throw Error("options.strict was renamed to lowS");var l,f,d=a.lowS,h=a.prehash;try{if("string"==typeof s||ne(s))try{l=y.fromDER(s)}catch(e){if(!(e instanceof Ke.Err))throw e;l=y.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=(0,I.default)(s.r)||"bigint"!=(0,I.default)(s.s))throw Error("PARSE");var p=s.r,v=s.s;l=new y(p,v)}f=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(d&&l.hasHighS())return!1;h&&(n=t.hash(n));var g=l.r,m=l.s,_=b(n),w=u(m),E=o(_*w),S=o(g*w),k=null===(i=c.BASE.multiplyAndAddUnsafe(f,E,S))||void 0===i?void 0:i.toAffine();return!!k&&o(k.x)===g})),(0,S.default)(N,"ProjectivePoint",c),(0,S.default)(N,"Signature",y),(0,S.default)(N,"utils",g),N}BigInt(4);var Je=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),$e=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qe=BigInt(1),Xe=BigInt(2),et=function(e,t){return(e+t/Xe)/t};function tt(e){var t=Je,n=BigInt(3),r=BigInt(6),i=BigInt(11),a=BigInt(22),o=BigInt(23),u=BigInt(44),s=BigInt(88),c=e*e*e%t,l=c*c*e%t,f=Oe(l,n,t)*l%t,d=Oe(f,n,t)*l%t,h=Oe(d,Xe,t)*c%t,p=Oe(h,i,t)*h%t,v=Oe(p,a,t)*p%t,y=Oe(v,u,t)*v%t,g=Oe(y,s,t)*y%t,m=Oe(g,u,t)*v%t,_=Oe(m,n,t)*l%t,b=Oe(_,o,t)*p%t,w=Oe(b,r,t)*c%t,E=Oe(w,Xe,t);if(!nt.eql(nt.sqr(E),e))throw Error("Cannot find square root");return E}var nt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e<=ke)throw Error("Expected Field ORDER > 0, got "+e);var i=Fe(e,t),a=i.nBitLength,o=i.nByteLength;if(o>2048)throw Error("Field lengths over 2048 bytes are not supported");var u=function(e){if(e%Te===Ae){var t=(e+Ce)/Te;return function(e,n){var r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error("Cannot find square root");return r}}if(e%Ie===Re){var n=(e-Re)/Ie;return function(e,t){var r=e.mul(t,xe),i=e.pow(r,n),a=e.mul(t,i),o=e.mul(e.mul(a,xe),i),u=e.mul(a,e.sub(o,e.ONE));if(!e.eql(e.sqr(u),t))throw Error("Cannot find square root");return u}}return function(e){var t,n,r,i=(e-Ce)/xe;for(t=e-Ce,n=0;t%xe===ke;t/=xe,n++);for(r=xe;r<e&&Be(r,i,e)!==e-Ce;r++);if(1===n){var a=(e+Ce)/Te;return function(e,t){var n=e.pow(t,a);if(!e.eql(e.sqr(n),t))throw Error("Cannot find square root");return n}}var o=(t+Ce)/xe;return function(e,a){if(e.pow(a,i)===e.neg(e.ONE))throw Error("Cannot find square root");for(var u=n,s=e.pow(e.mul(e.ONE,r),t),c=e.pow(a,o),l=e.pow(a,t);!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;for(var f=1,d=e.sqr(l);f<u&&!e.eql(d,e.ONE);f++)d=e.sqr(d);var h=e.pow(s,Ce<<BigInt(u-f-1));s=e.sqr(h),c=e.mul(c,h),l=e.mul(l,s),u=f}return c}}(e)}(e),s=Object.freeze({ORDER:e,BITS:a,BYTES:o,MASK:ge(a),ZERO:ke,ONE:Ce,create:function(t){return Ne(t,e)},isValid:function(t){if("bigint"!=(void 0===t?"undefined":(0,I.default)(t)))throw Error("Invalid field element: expected bigint, got "+(void 0===t?"undefined":(0,I.default)(t)));return ke<=t&&t<e},is0:function(e){return e===ke},isOdd:function(e){return(e&Ce)===Ce},neg:function(t){return Ne(-t,e)},eql:function(e,t){return e===t},sqr:function(t){return Ne(t*t,e)},add:function(t,n){return Ne(t+n,e)},sub:function(t,n){return Ne(t-n,e)},mul:function(t,n){return Ne(t*n,e)},pow:function(e,t){return function(e,t,n){if(n<ke)throw Error("Expected power > 0");if(n===ke)return e.ONE;if(n===Ce)return t;for(var r=e.ONE,i=t;n>ke;)n&Ce&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Ce;return r}(s,e,t)},div:function(t,n){return Ne(t*Le(n,e),e)},sqrN:function(e){return e*e},addN:function(e,t){return e+t},subN:function(e,t){return e-t},mulN:function(e,t){return e*t},inv:function(t){return Le(t,e)},sqrt:r.sqrt||function(e){return u(s,e)},invertBatch:function(e){return function(e,t){var n=Array(t.length),r=t.reduce((function(t,r,i){return e.is0(r)?t:(n[i]=t,e.mul(t,r))}),e.ONE),i=e.inv(r);return t.reduceRight((function(t,r,i){return e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))}),i),n}(s,e)},cmov:function(e,t,n){return n?t:e},toBytes:function(e){return n?pe(e,o):he(e,o)},fromBytes:function(e){if(e.length!==o)throw Error("Fp.fromBytes: expected ".concat(o,", got ").concat(e.length));return n?de(e):fe(e)}});return Object.freeze(s)}(Je,void 0,void 0,{sqrt:tt}),rt=function(e,t){var n=function(t){return Ge((0,C.default)({},e,function(e){return{hash:e,hmac:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Q(e,t,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=0;i<t.length;i++){var a=t[i];F(a),r+=a.length}for(var o=new Uint8Array(r),u=0,s=0;u<t.length;u++){var c=t[u];o.set(c,s),s+=c.length}return o}.apply(this,(0,R.default)(r)))},randomBytes:z}}(t)))};return Object.freeze((0,x.default)((0,C.default)({},n(t)),{create:n}))}({a:BigInt(0),b:BigInt(7),Fp:nt,n:$e,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:function(e){var t=$e,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Qe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=n,o=BigInt("0x100000000000000000000000000000000"),u=et(a*e,t),s=et(-r*e,t),c=Ne(e-u*n-s*i,t),l=Ne(-u*r-s*a,t),f=c>o,d=l>o;if(f&&(c=t-c),d&&(l=t-l),c>o||l>o)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:c,k2neg:d,k2:l}}}},J),it=BigInt(0),at=function(e){return"bigint"==(void 0===e?"undefined":(0,I.default)(e))&&it<e&&e<Je},ot=function(e){return"bigint"==(void 0===e?"undefined":(0,I.default)(e))&&it<e&&e<$e},ut={};function st(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=ut[e];if(void 0===i){var a=J(Uint8Array.from(e,(function(e){return e.charCodeAt(0)})));i=ye(a,a),ut[e]=i}return J(ye.apply(void 0,[i].concat((0,R.default)(n))))}var ct=function(e){return e.toRawBytes(!0).slice(1)},lt=function(e){return he(e,32)},ft=function(e){return Ne(e,Je)},dt=function(e){return Ne(e,$e)},ht=rt.ProjectivePoint,pt=function(e,t,n){return ht.BASE.multiplyAndAddUnsafe(e,t,n)};function vt(e){var t=rt.utils.normPrivateKeyToScalar(e),n=ht.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:dt(-t),bytes:ct(n)}}function yt(e){if(!at(e))throw Error("bad x: need 0 < x < p");var t=ft(e*e),n=tt(ft(t*e+BigInt(7)));n%Xe!==it&&(n=ft(-n));var r=new ht(e,n,Qe);return r.assertValidity(),r}function gt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return dt(fe(st.apply(void 0,["BIP0340/challenge"].concat((0,R.default)(t)))))}function mt(e){return vt(e).bytes}function _t(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z(32),r=ve("message",e),i=vt(t),a=i.bytes,o=i.scalar,u=ve("auxRand",n,32),s=lt(o^fe(st("BIP0340/aux",u))),c=st("BIP0340/nonce",s,a,r),l=dt(fe(c));if(l===it)throw Error("sign failed: k is zero");var f=vt(l),d=f.bytes,h=f.scalar,p=gt(d,a,r),v=new Uint8Array(64);if(v.set(d,0),v.set(lt(dt(h+p*o)),32),!bt(v,r,a))throw Error("sign: Invalid signature produced");return v}function bt(e,t,n){var r=ve("signature",e,64),i=ve("message",t),a=ve("publicKey",n,32);try{var o=yt(fe(a)),u=fe(r.subarray(0,32));if(!at(u))return!1;var s=fe(r.subarray(32,64));if(!ot(s))return!1;var c=gt(lt(u),ct(o),i),l=pt(o,s,dt(-c));return!(!l||!l.hasEvenY()||l.toAffine().x!==u)}catch(e){return!1}}var wt,Et={getPublicKey:mt,sign:_t,verify:bt,utils:{randomPrivateKey:rt.utils.randomPrivateKey,lift_x:yt,pointToBytes:ct,numberToBytesBE:he,bytesToNumberBE:fe,taggedHash:st,mod:Ne}},St="Trystero",kt=function(e,t){return Array(e).fill().map(t)},Ct=function(e){return kt(e,(function(){return"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Math.floor(62*Math.random())]})).join("")},xt=Ct(20),At=Promise.all.bind(Promise),Tt="undefined"!=typeof window,Rt=Object.entries,It=Object.fromEntries,Nt=Object.keys,Bt=function(){},Ot=function(e){return Error("".concat(St,": ").concat(e))},Lt=new TextEncoder,Pt=new TextDecoder,Ft=function(e){return Lt.encode(e)},Dt=function(e){return Pt.decode(e)},Ut=function(e){return e.reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"")},qt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("@")},Mt=JSON.stringify,jt=JSON.parse,Ht={},zt="AES-GCM",Wt={},Kt=(wt=(0,b.default)((function(e){var t,n,r;return(0,O.__generator)(this,(function(i){switch(i.label){case 0:return Wt[e]?[2,Wt[e]]:(n=Array.from,r=Uint8Array.bind,[4,crypto.subtle.digest("SHA-1",Ft(e))]);case 1:return t=n.apply(Array,[new(r.apply(Uint8Array,[void 0,i.sent()]))]).map((function(e){return e.toString(36)})).join(""),[2,(Wt[e]=t,t)]}}))})),function(e){return wt.apply(this,arguments)}),Vt=function(){var e=(0,b.default)((function(e,t){var n,r,i,a,o,u;return(0,O.__generator)(this,(function(s){switch(s.label){case 0:return n=crypto.getRandomValues(new Uint8Array(16)),i=n.join(",")+"$",o=(a=crypto.subtle).encrypt,u=[{name:zt,iv:n}],[4,e];case 1:return[4,o.apply(a,u.concat([s.sent(),Ft(t)]))];case 2:return[2,i+(r=s.sent(),btoa(String.fromCharCode.apply(null,new Uint8Array(r))))]}}))}));return function(t,n){return e.apply(this,arguments)}}(),Zt=function(){var e=(0,b.default)((function(e,t){var n,r,i,a,o,u;return(0,O.__generator)(this,(function(s){switch(s.label){case 0:return n=(0,T.default)(t.split("$"),2),r=n[0],i=n[1],o=(a=crypto.subtle).decrypt,u=[{name:zt,iv:new Uint8Array(r.split(","))}],[4,e];case 1:return[4,o.apply(a,u.concat([s.sent(),function(e){var t=atob(e);return new Uint8Array(t.length).map((function(e,n){return t.charCodeAt(n)})).buffer}(i)]))];case 2:return[2,Dt.apply(void 0,[s.sent()])]}}))}));return function(t,n){return e.apply(this,arguments)}}();function Yt(e){return e&&e.__esModule&&{}.hasOwnProperty.call(e,"default")?e.default:e}var Gt,Jt,$t={exports:{}};var Qt=function(e){function t(e){var r,i,a,o=null;function u(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(u.enabled){var a=u,o=Number(new Date),s=o-(r||o);a.diff=s,a.prev=r,a.curr=o,r=o,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";c++;var i=t.formatters[r];if("function"==typeof i){var o=n[c];e=i.call(a,o),n.splice(c,1),c--}return e})),t.formatArgs.call(a,n),(a.log||t.log).apply(a,n)}}return u.namespace=e,u.useColors=t.useColors(),u.color=t.selectColor(e),u.extend=n,u.destroy=t.destroy,Object.defineProperty(u,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==o?o:(i!==t.namespaces&&(i=t.namespaces,a=t.enabled(e)),a)},set:function(e){o=e}}),"function"==typeof t.init&&t.init(u),u}function n(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=(0,R.default)(t.names.map(r)).concat((0,R.default)(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.slice(1)+"$")):t.names.push(RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=function(){if(Jt)return Gt;Jt=1;var e=1e3,t=60*e,n=60*t,r=24*n,i=7*r;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}return Gt=function(o,u){u=u||{};var s=void 0===o?"undefined":(0,I.default)(o);if("string"===s&&o.length>0)return function(a){if(!((a+="").length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(o){var u=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*u;case"weeks":case"week":case"w":return u*i;case"days":case"day":case"d":return u*r;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*t;case"seconds":case"second":case"secs":case"sec":case"s":return u*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}(o);if("number"===s&&isFinite(o))return u.long?function(i){var o=Math.abs(i);return o>=r?a(i,o,r,"day"):o>=n?a(i,o,n,"hour"):o>=t?a(i,o,t,"minute"):o>=e?a(i,o,e,"second"):i+" ms"}(o):function(i){var a=Math.abs(i);return a>=r?Math.round(i/r)+"d":a>=n?Math.round(i/n)+"h":a>=t?Math.round(i/t)+"m":a>=e?Math.round(i/e)+"s":i+"ms"}(o);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))}}(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==L&&"env"in L&&(e=void 0),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=Qt(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}($t,$t.exports);var Xt,en=Yt($t.exports),tn="undefined"!=typeof window?window:self,nn=tn.RTCPeerConnection||tn.mozRTCPeerConnection||tn.webkitRTCPeerConnection,rn=tn.RTCSessionDescription||tn.mozRTCSessionDescription||tn.webkitRTCSessionDescription,an=tn.RTCIceCandidate||tn.mozRTCIceCandidate||tn.webkitRTCIceCandidate,on={exports:{}},un="object"==typeof Reflect?Reflect:null,sn=un&&"function"==typeof un.apply?un.apply:function(e,t,n){return function(){}.apply.call(e,t,n)};Xt=un&&"function"==typeof un.ownKeys?un.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var cn=Number.isNaN||function(e){return e!=e};function ln(){ln.init.call(this)}on.exports=ln,on.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}bn(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&bn(e,"error",t,{once:!0})}(e,i)}))},ln.EventEmitter=ln,ln.prototype._events=void 0,ln.prototype._eventsCount=0,ln.prototype._maxListeners=void 0;var fn=10;function dn(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===e?"undefined":(0,I.default)(e)))}function hn(e){return void 0===e._maxListeners?ln.defaultMaxListeners:e._maxListeners}function pn(e,t,n,r){var i,a,o,u;if(dn(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=hn(e))>0&&o.length>i&&!o.warned){o.warned=!0;var s=Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=o.length,u=s,console&&console.warn&&console.warn(u)}return e}function vn(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yn(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=vn.bind(r);return i.listener=n,r.wrapFn=i,i}function gn(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):_n(i,i.length)}function mn(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function _n(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function bn(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+(void 0===e?"undefined":(0,I.default)(e)));e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}Object.defineProperty(ln,"defaultMaxListeners",{enumerable:!0,get:function(){return fn},set:function(e){if("number"!=typeof e||e<0||cn(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");fn=e}}),ln.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ln.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||cn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ln.prototype.getMaxListeners=function(){return hn(this)},ln.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)sn(u,this,t);else{var s=u.length,c=_n(u,s);for(n=0;n<s;++n)sn(c[n],this,t)}return!0},ln.prototype.addListener=function(e,t){return pn(this,e,t,!1)},ln.prototype.on=ln.prototype.addListener,ln.prototype.prependListener=function(e,t){return pn(this,e,t,!0)},ln.prototype.once=function(e,t){return dn(t),this.on(e,yn(this,e,t)),this},ln.prototype.prependOnceListener=function(e,t){return dn(t),this.prependListener(e,yn(this,e,t)),this},ln.prototype.removeListener=function(e,t){var n,r,i,a,o;if(dn(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},ln.prototype.off=ln.prototype.removeListener,ln.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},ln.prototype.listeners=function(e){return gn(this,e,!0)},ln.prototype.rawListeners=function(e){return gn(this,e,!1)},ln.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):mn.call(e,t)},ln.prototype.listenerCount=mn,ln.prototype.eventNames=function(){return this._eventsCount>0?Xt(this._events):[]};var wn=on.exports,En="function"==typeof queueMicrotask?queueMicrotask:function(e){return Promise.resolve().then(e)},Sn=function(){"use strict";function e(t){if((0,w.default)(this,e),!(t>0)||t-1&t)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}return(0,E.default)(e,[{key:"clear",value:function(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}},{key:"push",value:function(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}},{key:"shift",value:function(){var e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}},{key:"peek",value:function(){return this.buffer[this.btm]}},{key:"isEmpty",value:function(){return void 0===this.buffer[this.btm]}}]),e}(),kn=function(){"use strict";function e(t){(0,w.default)(this,e),this.decoder=new TextDecoder("utf16le"===t?"utf16-le":t)}return(0,E.default)(e,[{key:"decode",value:function(e){return this.decoder.decode(e,{stream:!0})}},{key:"flush",value:function(){return this.decoder.decode(new Uint8Array(0))}}]),e}(),Cn=kn,xn=kn,An=wn.EventEmitter,Tn=Error("Stream was destroyed"),Rn=En,In=function(){"use strict";function e(t){(0,w.default)(this,e),this.hwm=t||16,this.head=new Sn(this.hwm),this.tail=this.head,this.length=0}return(0,E.default)(e,[{key:"clear",value:function(){this.head=this.tail,this.head.clear(),this.length=0}},{key:"push",value:function(e){if(this.length++,!this.head.push(e)){var t=this.head;this.head=t.next=new Sn(2*this.head.buffer.length),this.head.push(e)}}},{key:"shift",value:function(){0!==this.length&&this.length--;var e=this.tail.shift();if(void 0===e&&this.tail.next){var t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}},{key:"peek",value:function(){var e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}},{key:"isEmpty",value:function(){return 0===this.length}}]),e}(),Nn=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";switch((0,w.default)(this,e),this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:throw Error("Unknown encoding: "+e)}}(t),this.encoding){case"utf8":this.decoder=new xn;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new Cn(this.encoding)}}return(0,E.default)(e,[{key:"push",value:function(e){return"string"==typeof e?e:this.decoder.decode(e)}},{key:"write",value:function(e){return this.push(e)}},{key:"end",value:function(e){var t="";return e&&(t=this.push(e)),t+=this.decoder.flush()}}]),e}(),Bn=536870910,On=16384,Ln=32768,Pn=131072,Fn=536870143,Dn=536838143,Un=536739839,qn=524288,Mn=1048576,jn=2097152,Hn=8388608,zn=16777216,Wn=33554432,Kn=134217728,Vn=469499903,Zn=503316479,Yn=262160,Gn=8404992,Jn=8405006,$n=33587200,Qn=33587215,Xn=270794767,er=Symbol.asyncIterator||Symbol(),tr=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,a=n.map,o=void 0===a?null:a,u=n.mapWritable,s=n.byteLength,c=n.byteLengthWritable;(0,w.default)(this,e),this.stream=t,this.queue=new In,this.highWaterMark=i,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=c||s||gr,this.map=u||o,this.afterWrite=ur.bind(this),this.afterUpdateNextTick=lr.bind(this)}return(0,E.default)(e,[{key:"ended",get:function(){return!!(this.stream._duplexState&Hn)}},{key:"push",value:function(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=jn,!0):(this.stream._duplexState|=6291456,!1)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=534773759),e}},{key:"end",value:function(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=535822335&this.stream._duplexState|134217728}},{key:"autoBatch",value:function(e,t){var n=[],r=this.stream;for(n.push(e);2359296==(r._duplexState&Xn);)n.push(r._writableState.shift());if(15&r._duplexState)return t(null);r._writev(n,t)}},{key:"update",value:function(){var e=this.stream;e._duplexState|=qn;do{for(;(e._duplexState&Xn)===jn;){var t=this.shift();e._duplexState|=67371008,e._write(t,this.afterWrite)}1310720&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536346623}},{key:"updateNonPrimary",value:function(){var e=this.stream;if((144965647&e._duplexState)===Kn)return e._duplexState=402653183&e._duplexState|262144,void e._final(ar.bind(this));4!=(14&e._duplexState)?1==(e._duplexState&Qn)&&(e._duplexState=(e._duplexState|Yn)&Bn,e._open(fr.bind(this))):e._duplexState&$n||(e._duplexState|=Yn,e._destroy(or.bind(this)))}},{key:"continueUpdate",value:function(){return!!(this.stream._duplexState&Wn)&&(this.stream._duplexState&=Zn,!0)}},{key:"updateCallback",value:function(){(35127311&this.stream._duplexState)===Mn?this.update():this.updateNextTick()}},{key:"updateNextTick",value:function(){this.stream._duplexState&Wn||(this.stream._duplexState|=Wn,this.stream._duplexState&qn||Rn(this.afterUpdateNextTick))}}]),e}(),nr=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,a=n.map,o=void 0===a?null:a,u=n.mapReadable,s=n.byteLength,c=n.byteLengthReadable;(0,w.default)(this,e),this.stream=t,this.queue=new In,this.highWaterMark=0===i?1:i,this.buffered=0,this.readAhead=i>0,this.error=null,this.pipeline=null,this.byteLength=c||s||gr,this.map=u||o,this.pipeTo=null,this.afterRead=sr.bind(this),this.afterUpdateNextTick=cr.bind(this)}return(0,E.default)(e,[{key:"ended",get:function(){return!!(this.stream._duplexState&On)}},{key:"pipe",value:function(e,t){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new rr(this.stream,e,t),t&&this.stream.on("error",mr),yr(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",mr),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{var n=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",n),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",ir.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}},{key:"push",value:function(e){var t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=536805311&t._duplexState|1024,!1):(null!==this.map&&null===(e=this.map(e))||(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=536805375&t._duplexState|128),this.buffered<this.highWaterMark)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=536862591),e}},{key:"unshift",value:function(e){for(var t=[null!==this.map?this.map(e):e];this.buffered>0;)t.push(this.shift());for(var n=0;n<t.length-1;n++){var r=t[n];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}},{key:"read",value:function(){var e=this.stream;if(128==(16527&e._duplexState)){var t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Fn),2048&e._duplexState&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=Pn,this.updateNextTick()),null}},{key:"drain",value:function(){for(var e=this.stream;128==(16527&e._duplexState)&&768&e._duplexState;){var t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Fn),2048&e._duplexState&&e.emit("data",t)}}},{key:"update",value:function(){var e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)===Pn;)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=8192,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536870879}},{key:"updateNonPrimary",value:function(){var e=this.stream;1024==(1167&e._duplexState)&&(e._duplexState=536869887&e._duplexState|16384,e.emit("end"),(e._duplexState&Jn)===Gn&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(14&e._duplexState)?1==(e._duplexState&Qn)&&(e._duplexState=(e._duplexState|Yn)&Bn,e._open(fr.bind(this))):e._duplexState&$n||(e._duplexState|=Yn,e._destroy(or.bind(this)))}},{key:"continueUpdate",value:function(){return!!(this.stream._duplexState&Ln)&&(this.stream._duplexState&=Dn,!0)}},{key:"updateCallback",value:function(){64==(32879&this.stream._duplexState)?this.update():this.updateNextTick()}},{key:"updateNextTick",value:function(){this.stream._duplexState&Ln||(this.stream._duplexState|=Ln,32&this.stream._duplexState||Rn(this.afterUpdateNextTick))}}]),e}(),rr=function(){"use strict";function e(t,n,r){(0,w.default)(this,e),this.from=t,this.to=n,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}return(0,E.default)(e,[{key:"finished",value:function(){this.pipeToFinished=!0}},{key:"done",value:function(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&On||this.to.destroy(this.error||Error("Readable stream closed before ending")):this.from._duplexState&On&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"))}}]),e}();function ir(){this.stream._duplexState|=512,this.updateCallback()}function ar(e){var t=this.stream;e&&t.destroy(e),14&t._duplexState||(t._duplexState|=Hn,t.emit("finish")),(t._duplexState&Jn)===Gn&&(t._duplexState|=4),t._duplexState&=Vn,t._duplexState&qn?this.updateNextTick():this.update()}function or(e){var t=this.stream;e||this.error===Tn||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");var n=t._readableState,r=t._writableState;if(null!==n&&null!==n.pipeline&&n.pipeline.done(t,e),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(t,e)}}function ur(e){var t=this.stream;e&&t.destroy(e),t._duplexState&=Vn,null!==this.drains&&function(e){for(var t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),4194304==(6553615&t._duplexState)&&(t._duplexState&=532676607,(t._duplexState&zn)===zn&&t.emit("drain")),this.updateCallback()}function sr(e){e&&this.stream.destroy(e),this.stream._duplexState&=536870895,!1!==this.readAhead||256&this.stream._duplexState||(this.stream._duplexState&=Un),this.updateCallback()}function cr(){32&this.stream._duplexState||(this.stream._duplexState&=Dn,this.update())}function lr(){this.stream._duplexState&qn||(this.stream._duplexState&=Zn,this.update())}function fr(e){var t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=64),142606351&t._duplexState||(t._duplexState|=Mn),t.emit("open")),t._duplexState&=536608751,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function dr(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=zn,this._writableState.updateNextTick())}var hr=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(e){var r;return(0,w.default)(this,n),(r=t.call(this,e))._duplexState|=8519681,r._readableState=new nr((0,_.default)(r),e),e&&(!1===r._readableState.readAhead&&(r._duplexState&=Un),e.read&&(r._read=e.read),e.eagerOpen&&r._readableState.updateNextTick(),e.encoding&&r.setEncoding(e.encoding)),(0,A.default)(r)}return(0,E.default)(n,[{key:"setEncoding",value:function(e){var t=new Nn(e),n=this._readableState.map||vr;return this._readableState.map=function(e){var r=t.push(e);return""===r?null:n(r)},this}},{key:"_read",value:function(e){e(null)}},{key:"pipe",value:function(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}},{key:"read",value:function(){return this._readableState.updateNextTick(),this._readableState.read()}},{key:"push",value:function(e){return this._readableState.updateNextTick(),this._readableState.push(e)}},{key:"unshift",value:function(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}},{key:"resume",value:function(){return this._duplexState|=131328,this._readableState.updateNextTick(),this}},{key:"pause",value:function(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}},{key:er,value:function(){var e,t=this,n=null,r=null,i=null;return this.on("error",(function(e){n=e})),this.on("readable",(function(){null!==r&&a(t.read())})),this.on("close",(function(){null!==r&&a(null)})),e={},(0,S.default)(e,er,(function(){return this})),(0,S.default)(e,"next",(function(){return new Promise((function(e,n){r=e,i=n;var o=t.read();null!==o?a(o):8&t._duplexState&&a(null)}))})),(0,S.default)(e,"return",(function(){return o(null)})),(0,S.default)(e,"throw",(function(e){return o(e)})),e;function a(e){null!==i&&(n?i(n):null!==e||t._duplexState&On?r({value:e,done:null===e}):i(Tn),i=r=null)}function o(e){return t.destroy(e),new Promise((function(n,r){if(8&t._duplexState)return n({value:void 0,done:!0});t.once("close",(function(){e?r(e):n({value:void 0,done:!0})}))}))}}}],[{key:"_fromAsyncIterator",value:function(e,t){var r,i=new n((0,x.default)((0,C.default)({},t),{read:function(t){e.next().then(a).then(t.bind(null,null)).catch(t)},predestroy:function(){r=e.return()},destroy:function(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}}));return i;function a(e){e.done?i.push(null):i.push(e.value)}}},{key:"from",value:function(e,t){if(yr(r=e)&&r.readable)return e;var r;if(e[er])return this._fromAsyncIterator(e[er](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);var i=0;return new n((0,x.default)((0,C.default)({},t),{read:function(t){this.push(i===e.length?null:e[i++]),t(null)}}))}},{key:"isBackpressured",value:function(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}},{key:"isPaused",value:function(e){return!(256&e._duplexState)}}]),n}(function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(e){var r;return(0,w.default)(this,n),(r=t.call(this))._duplexState=0,r._readableState=null,r._writableState=null,e&&(e.open&&(r._open=e.open),e.destroy&&(r._destroy=e.destroy),e.predestroy&&(r._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",_r.bind((0,_.default)(r)))),r.on("newListener",dr),(0,A.default)(r)}return(0,E.default)(n,[{key:"_open",value:function(e){e(null)}},{key:"_destroy",value:function(e){e(null)}},{key:"_predestroy",value:function(){}},{key:"readable",get:function(){return null!==this._readableState||void 0}},{key:"writable",get:function(){return null!==this._writableState||void 0}},{key:"destroyed",get:function(){return!!(8&this._duplexState)}},{key:"destroying",get:function(){return!!(14&this._duplexState)}},{key:"destroy",value:function(e){14&this._duplexState||(e||(e=Tn),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}]),n}(An)),pr=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(e){var r;return(0,w.default)(this,n),(r=t.call(this,e))._duplexState=1|r._duplexState&Pn,r._writableState=new tr((0,_.default)(r),e),e&&(e.writev&&(r._writev=e.writev),e.write&&(r._write=e.write),e.final&&(r._final=e.final)),(0,A.default)(r)}return(0,E.default)(n,[{key:"cork",value:function(){this._duplexState|=268435456}},{key:"uncork",value:function(){this._duplexState&=268435455,this._writableState.updateNextTick()}},{key:"_writev",value:function(e,t){t(null)}},{key:"_write",value:function(e,t){this._writableState.autoBatch(e,t)}},{key:"_final",value:function(e){e(null)}},{key:"write",value:function(e){return this._writableState.updateNextTick(),this._writableState.push(e)}},{key:"end",value:function(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}]),n}(hr);function vr(e){return e}function yr(e){return"number"==typeof e._duplexState&&function(e){return!!e._readableState||!!e._writableState}(e)}function gr(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function mr(){}function _r(){this.destroy(Error("Stream aborted."))}var br=pr;function wr(e,t){for(var n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}for(var Er=Yt((function(e,t,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return wr(e,n)}catch(t){n.message=e.message,n.stack=e.stack;var r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(e)),wr(new r,n)}})),Sr="0123456789abcdef",kr=[],Cr=0;Cr<256;Cr++)kr[Cr]=Sr[Cr>>4&15]+Sr[15&Cr];for(var xr=function(e){for(var t=e.length,n="",r=0;r<t;)n+=kr[e[r++]];return n},Ar="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Tr=0;Tr<64;Tr++)Ar["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(Tr)]=Tr;new TextDecoder;var Rr=new TextEncoder,Ir="undefined"!=typeof window?window:self,Nr=Ir.crypto||Ir.msCrypto||{};Nr.subtle||Nr.webkitSubtle;var Br=function(e){var t=new Uint8Array(e);return Nr.getRandomValues(t)},Or=en("simple-peer"),Lr=65536;function Pr(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var Fr=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(e){var r;if((0,w.default)(this,n),r=t.call(this,e=Object.assign({allowHalfOpen:!1},e)),(0,S.default)((0,_.default)(r),"_pc",void 0),r.__objectMode=!!e.objectMode,r._id=xr(Br(4)).slice(0,7),r._debug("new peer %o",e),r.channelName=e.initiator?e.channelName||xr(Br(20)):null,r.initiator=e.initiator||!1,r.channelConfig=e.channelConfig||n.channelConfig,r.channelNegotiated=r.channelConfig.negotiated,r.config=Object.assign({},n.config,e.config),r.offerOptions=e.offerOptions||{},r.answerOptions=e.answerOptions||{},r.sdpTransform=e.sdpTransform||function(e){return e},r.trickle=void 0===e.trickle||e.trickle,r.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,r.iceCompleteTimeout=e.iceCompleteTimeout||5e3,r._destroying=!1,r._connected=!1,r.remoteAddress=void 0,r.remoteFamily=void 0,r.remotePort=void 0,r.localAddress=void 0,r.localFamily=void 0,r.localPort=void 0,!nn)throw"undefined"==typeof window?Er(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):Er(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");r._pcReady=!1,r._channelReady=!1,r._iceComplete=!1,r._iceCompleteTimer=null,r._channel=null,r._pendingCandidates=[],r._isNegotiating=!1,r._firstNegotiation=!0,r._batchedNegotiation=!1,r._queuedNegotiation=!1,r._sendersAwaitingStable=[],r._closingInterval=null,r._remoteTracks=[],r._remoteStreams=[],r._chunk=null,r._cb=null,r._interval=null;try{r._pc=new nn(r.config)}catch(e){return(0,A.default)(r,void r.__destroy(Er(e,"ERR_PC_CONSTRUCTOR")))}return r._isReactNativeWebrtc="number"==typeof r._pc._peerConnectionId,r._pc.oniceconnectionstatechange=function(){r._onIceStateChange()},r._pc.onicegatheringstatechange=function(){r._onIceStateChange()},r._pc.onconnectionstatechange=function(){r._onConnectionStateChange()},r._pc.onsignalingstatechange=function(){r._onSignalingStateChange()},r._pc.onicecandidate=function(e){r._onIceCandidate(e)},"object"==typeof r._pc.peerIdentity&&r._pc.peerIdentity.catch((function(e){r.__destroy(Er(e,"ERR_PC_PEER_IDENTITY"))})),r.initiator||r.channelNegotiated?r._setupData({channel:r._pc.createDataChannel(r.channelName,r.channelConfig)}):r._pc.ondatachannel=function(e){r._setupData(e)},r._debug("initial negotiation"),r._needsNegotiation(),r._onFinishBound=function(){r._onFinish()},r.once("finish",r._onFinishBound),(0,A.default)(r)}return(0,E.default)(n,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Er(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new rn(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.__destroy(Er(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.__destroy(Er(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,n=new an(e);this._pc.addIceCandidate(n).catch((function(e){!n.address||n.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):t.__destroy(Er(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this._destroying){if(this.destroyed)throw Er(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this._destroying){if(this.destroyed)throw Er(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"_final",value:function(e){this._readableState.ended||this.push(null),e(null)}},{key:"__destroy",value:function(e){this.end(),this._destroy((function(){}),e)}},{key:"_destroy",value:function(e,t){var n=this;this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),setTimeout((function(){if(n._connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._closingInterval),n._closingInterval=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,n._pc.ontrack=null,n._pc.ondatachannel=null}n._pc=null,n._channel=null,t&&n.emit("error",t),e()}),0))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.__destroy(Er(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=Lr),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){var n=e.error instanceof Error?e.error:Error("Datachannel error: ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));t.__destroy(Er(n,"ERR_DATA_CHANNEL"))};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_write",value:function(e,t){if(this.destroyed)return t(Er(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.__destroy(Er(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Lr?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=t):t(null)}else this._debug("write before connect"),this._chunk=e,this._cb=t}},{key:"_onFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.__destroy()}),1e3)};this._connected?t():this.once("connect",t)}}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=Pr(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.__destroy(Er(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.__destroy(Er(t,"ERR_CREATE_OFFER"))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=Pr(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){var n,r;if(!e.destroyed){var i=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:i.type,sdp:i.sdp}),e.initiator||null===(r=(n=e)._requestMissingTransceivers)||void 0===r||r.call(n)}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.__destroy(Er(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.__destroy(Er(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||this._destroying||"failed"===this._pc.connectionState&&this.__destroy(Er(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.__destroy(Er(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.__destroy(Er(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"==={}.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e._destroying||e.getStats((function(n,r){if(!e.destroyed&&!e._destroying){n&&(r=[]);var i={},a={},o={},u=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));var s=function(t){u=!0;var n=a[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&s(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&s(e)})),u||Object.keys(o).length&&!Object.keys(a).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.__destroy(Er(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))};t()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>Lr||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t,n=e.data;n instanceof ArrayBuffer?n=new Uint8Array(n):!1===this.__objectMode&&(t=n,n=Rr.encode(t)),this.push(n)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.__destroy())}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Or.apply(null,e)}}]),n}(br);Fr.WEBRTC_SUPPORT=!!nn,Fr.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Fr.channelConfig={};var Dr,Ur=function(e){"use strict";(0,k.default)(n,e);var t=(0,B.default)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.default)(this,n),(e=t.call(this,r))._pc&&(e.streams=r.streams||(r.stream?[r.stream]:[]),e._senderMap=new Map,e.streams&&e.streams.forEach((function(t){e.addStream(t)})),e._pc.ontrack=function(t){e._onTrack(t)}),(0,A.default)(e)}return(0,E.default)(n,[{key:"addTransceiver",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Er(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.__destroy(Er(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Er(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(n){t.addTrack(n,e)}))}}},{key:"addTrack",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Er(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var n=this._senderMap.get(e)||new Map,r=n.get(t);if(r)throw r.removed?Er(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Er(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,n){if(!this._destroying){if(this.destroyed)throw Er(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw Er(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.__destroy(Er(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Er(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw Er(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.__destroy(Er(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Er(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(n){t.removeTrack(n,e)}))}}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some((function(e){return e.id===n.id}))||(t._remoteStreams.push(n),queueMicrotask((function(){t._debug("on stream"),t.emit("stream",n)})))}))}}]),n}(Fr),qr="data",Mr="signal",jr=function(e,t){var n=new Ur((0,x.default)((0,C.default)({iceServers:[{urls:Hr}]},t),{initiator:e,trickle:!1})),r=function(e){return i.push(e)},i=[];return n.on(qr,r),{id:n._id,created:Date.now(),connection:n._pc,get channel(){return n._channel},get isDead(){return n.destroyed},signal:function(t){return new Promise((function(r){e||n.on(Mr,r),n.signal(t)}))},sendData:function(e){return n.send(e)},destroy:function(){return n.destroy()},setHandlers:function(e){return Object.entries(e).forEach((function(e){var t=(0,T.default)(e,2),r=t[0],i=t[1];return n.on(r,i)}))},offerPromise:e?new Promise((function(e){return n.on(Mr,e)})):Promise.resolve(),addStream:function(e){return n.addStream(e)},removeStream:function(e){return n.removeStream(e)},addTrack:function(e,t){return n.addTrack(e,t)},removeTrack:function(e,t){return n.removeTrack(e,t)},replaceTrack:function(e,t,r){return n.replaceTrack(e,t,r)},drainEarlyData:function(e){n.off(qr,r),i.forEach(e),i=null}}},Hr=(0,R.default)(kt(5,(function(e,t){return"stun:stun".concat(t||"",".l.google.com:19302")}))).concat(["stun:global.stun.twilio.com:3478"]),zr=Object.getPrototypeOf(Uint8Array),Wr=16369,Kr=255,Vr="bufferedamountlow",Zr=function(e){return"@_"+e},Yr={},Gr="EVENT",Jr=Tt&&Et.utils.randomPrivateKey(),$r=Tt&&Ut(Et.getPublicKey(Jr)),Qr={},Xr={},ei=function(){return Math.floor(Date.now()/1e3)},ti=function(){var e=(0,b.default)((function(e,t){var n,r,i,a,o,u;return(0,O.__generator)(this,(function(s){switch(s.label){case 0:return n={kind:29333,content:t,pubkey:$r,created_at:ei(),tags:[["x",e]]},i=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",Ft(Mt([0,n.pubkey,n.created_at,n.kind,n.tags,n.content])))];case 1:return r=Ut.apply(void 0,[new(i.apply(Uint8Array,[void 0,s.sent()]))]),a=[Gr],o=[(0,C.default)({},n)],u={id:r},[4,Et.sign(r,Jr)];case 2:return[2,Mt.apply(void 0,[a.concat([x.default.apply(void 0,o.concat([(u.sig=Ut.apply(void 0,[s.sent()]),u)]))])])]}}))}));return function(t,n){return e.apply(this,arguments)}}(),ni=function(e,t){return Qr[e]=t,Mt(["REQ",e,{kinds:[29333],since:ei(),"#x":[t]}])},ri=function(e){return delete Qr[e],Mt(["CLOSE",e])},ii=function(e){var t,n,r,i=e.init,a=e.subscribe,o=e.announce,g={},m=!1;return function(e,_,w){var E,S,k=e.appId;if(null===(S=g[k])||void 0===S?void 0:S[_])return g[k][_];var A={},N={},B=qt(St,k,_),L=Kt(B),P=Kt(qt(B,xt)),F=e.password&&function(){var e=(0,b.default)((function(e,t,n){var r,i,a;return(0,O.__generator)(this,(function(o){switch(o.label){case 0:return i=(r=crypto.subtle).importKey,a=["raw"],[4,crypto.subtle.digest({name:"SHA-256"},Ft("".concat(e,":").concat(t,":").concat(n)))];case 1:return[2,i.apply(r,a.concat([o.sent(),{name:zt},!1,["encrypt","decrypt"]]))]}}))}));return function(t,n,r){return e.apply(this,arguments)}}()(e.password,k,_),D=function(e){return function(){var t=(0,b.default)((function(t){var n,r;return(0,O.__generator)(this,(function(i){switch(i.label){case 0:return F?(r={type:t.type},[4,e(F,t.sdp)]):[3,2];case 1:return r.sdp=i.sent(),n=r,[3,3];case 2:n=t,i.label=3;case 3:return[2,n]}}))}));return function(e){return t.apply(this,arguments)}}()},U=D(Zt),q=D(Vt),M=function(){return jr(!0,e.rtcConfig)},j=function(e,t,n){var r;N[t]?N[t]!==e&&e.destroy():(N[t]=e,J(e,t),null===(r=A[t])||void 0===r||r.forEach((function(e,t){t!==n&&e.destroy()})),delete A[t])},H=function(e,t){N[t]===e&&delete N[t]},z=function(e){return(E=n).push.apply(E,(0,R.default)(kt(e,M))),At(n.splice(0,e).map((function(e){return e.offerPromise.then(q).then((function(t){return{peer:e,offer:t}}))})))},W=function(t,n){return null==w?void 0:w({error:"incorrect password (".concat(e.password,") when decrypting ").concat(n),appId:k,peerId:t,roomId:_})},K=function(t){return function(){var n=(0,b.default)((function(n,r,i){var a,o,c,l,f,d,h,p,v,y,g,m,_,b,w,E,S,k,C,x,R,I,F,D,M,K;return(0,O.__generator)(this,(function(O){switch(O.label){case 0:return[4,At([L,P])];case 1:if(a=T.default.apply(void 0,[O.sent(),2]),o=a[0],c=a[1],n!==o&&n!==c)return[2];if(l="string"==typeof r?jt(r):r,f=l.peerId,d=l.offer,h=l.answer,p=l.peer,f===xt||N[f])return[3,16];if(f&&!d&&!h)return[3,14];if(!d)return[3,8];if((null===(v=A[f])||void 0===v?void 0:v[t])&&xt>f)return[2];(y=jr(!1,e.rtcConfig)).setHandlers({connect:function(){return j(y,f,t)},close:function(){return H(y,f)}}),O.label=2;case 2:return O.trys.push([2,4,,5]),[4,U(d)];case 3:return g=O.sent(),[3,5];case 4:return O.sent(),[2,void W(f,"offer")];case 5:return y.isDead?[2]:[4,At([Kt(qt(B,f)),y.signal(g)])];case 6:return m=T.default.apply(void 0,[O.sent(),2]),_=m[0],b=m[1],w=[_],E={peerId:xt},[4,q(b)];case 7:return i.apply(void 0,w.concat([Mt.apply(void 0,[(E.answer=O.sent(),E)])])),[3,13];case 8:if(!h)return[3,13];O.label=9;case 9:return O.trys.push([9,11,,12]),[4,U(h)];case 10:return S=O.sent(),[3,12];case 11:return O.sent(),[2,void W(f,"answer")];case 12:p?(p.setHandlers({connect:function(){return j(p,f,t)},close:function(){return H(p,f)}}),p.signal(S)):(C=null===(k=A[f])||void 0===k?void 0:k[t])&&!C.isDead&&C.signal(S),O.label=13;case 13:return[3,16];case 14:return(null===(x=A[f])||void 0===x?void 0:x[t])?[2]:[4,At([z(1),Kt(qt(B,f))])];case 15:R=T.default.apply(void 0,[O.sent(),2]),I=(0,T.default)(R[0],1),F=I[0],D=F.peer,M=F.offer,K=R[1],(u=A)[s=f]||(u[s]=[]),A[f][t]=D,setTimeout((function(){return function(e,t){var n;if(!N[e]){var r=null===(n=A[e])||void 0===n?void 0:n[t];r&&(delete A[e][t],r.destroy())}}(f,t)}),.9*Z[t]),D.setHandlers({connect:function(){return j(D,f,t)},close:function(){return H(D,f)}}),i(K,Mt({peerId:xt,offer:M})),O.label=16;case 16:return[2]}}))}));return function(e,t,r){return n.apply(this,arguments)}}()};if(!e)throw Ot("requires a config map as the first argument");if(!k&&!e.firebaseApp)throw Ot("config map is missing appId field");if(!_)throw Ot("roomId argument required");if(!m){var V=i(e);n=kt(20,M),t=Array.isArray(V)?V:[V],m=!0,r=setInterval((function(){return n=n.filter((function(e){var t=Date.now()-e.created<57333;return t||e.destroy(),t}))}),59052.99)}var Z=t.map((function(){return 5333})),Y=[],G=t.map(function(){var e=(0,b.default)((function(e,t){var n;return(0,O.__generator)(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return n=[r.sent()],[4,L];case 2:return n=n.concat(r.sent()),[4,P];case 3:return[2,a.apply(void 0,n.concat([r.sent(),K(t),z]))]}}))}));return function(t,n){return e.apply(this,arguments)}}());At([L,P]).then((function(e){var n=(0,T.default)(e,2),r=n[0],i=n[1],a=function(){var e=(0,b.default)((function(e,t){var n;return(0,O.__generator)(this,(function(u){switch(u.label){case 0:return[4,o(e,r,i)];case 1:return"number"==typeof(n=u.sent())&&(Z[t]=n),Y[t]=setTimeout((function(){return a(e,t)}),Z[t]),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}();G.forEach(function(){var e=(0,b.default)((function(e,n){return(0,O.__generator)(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return r.sent(),[4,t[n]];case 2:return a.apply(void 0,[r.sent(),n]),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}())}));var J=Bt;return(c=g)[l=k]||(c[l]={}),g[k][_]=function(e,t,n){var r={},i={},a={},o={},u={},s={},c={onPeerJoin:Bt,onPeerLeave:Bt,onPeerStream:Bt,onPeerTrack:Bt},l=function(e,t){return(e?Array.isArray(e)?e:[e]:Nt(r)).flatMap((function(e){var n=r[e];return n?t(e,n):(console.warn("".concat(St,": no peer with id ").concat(e," found")),[])}))},g=function(e){r[e]&&(delete r[e],delete a[e],delete o[e],c.onPeerLeave(e),t(e))},m=function(e){if(i[e])return[i[e].send,i[e].setOnComplete,i[e].setOnProgress];if(!e)throw Ot("action type argument is required");var t=Ft(e);if(t.byteLength>12)throw Ot('action type string "'.concat(e,'" (').concat(t.byteLength,"b) exceeds byte limit (12). Hint: choose a shorter name."));var n=new Uint8Array(12);n.set(t);var a=0;return i[e]={onComplete:Bt,onProgress:Bt,setOnComplete:function(t){return i[e]=(0,x.default)((0,C.default)({},i[e]),{onComplete:t})},setOnProgress:function(t){return i[e]=(0,x.default)((0,C.default)({},i[e]),{onProgress:t})},send:function(e,t,i,o){return(0,b.default)((function(){var u,s,c,f,d,h,p,v,y,g,m;return(0,O.__generator)(this,(function(_){switch(_.label){case 0:if(i&&"object"!=typeof i)throw Ot("action meta argument must be an object");if("undefined"===(u=void 0===e?"undefined":(0,I.default)(e)))throw Ot("action data cannot be undefined");if(s="string"!==u,c=e instanceof Blob,f=c||e instanceof ArrayBuffer||e instanceof zr,i&&!f)throw Ot("action meta argument can only be used with binary data");return f?(g=Uint8Array.bind,c?[4,e.arrayBuffer()]:[3,2]):[3,4];case 1:return m=_.sent(),[3,3];case 2:m=e,_.label=3;case 3:return y=new(g.apply(Uint8Array,[void 0,m])),[3,5];case 4:y=Ft(s?Mt(e):e),_.label=5;case 5:return d=y,h=i?Ft(Mt(i)):null,p=Math.ceil(d.byteLength/Wr)+(i?1:0)||1,v=kt(p,(function(e,t){var r=t===p-1,o=i&&0===t,u=new Uint8Array(15+(o?h.byteLength:r?d.byteLength-Wr*(p-(i?2:1)):Wr));return u.set(n),u.set([a],12),u.set([r|o<<1|f<<2|s<<3],13),u.set([Math.round((t+1)/p*Kr)],14),u.set(i?o?h:d.subarray((t-1)*Wr,t*Wr):d.subarray(t*Wr,(t+1)*Wr),15),u})),[2,(a=a+1&Kr,At(l(t,function(){var e=(0,b.default)((function(e,t){var n,a,u;return(0,O.__generator)(this,(function(s){switch(s.label){case 0:n=t.channel,a=0,s.label=1;case 1:return a<p?(u=v[a],n.bufferedAmount>n.bufferedAmountLowThreshold?[4,new Promise((function(e){var t=function(){n.removeEventListener(Vr,t),e()};n.addEventListener(Vr,t)}))]:[3,3]):[3,5];case 2:s.sent(),s.label=3;case 3:if(!r[e])return[3,5];t.sendData(u),a++,null==o||o(u[14]/Kr,e,i),s.label=4;case 4:return[3,1];case 5:return[2]}}))}));return function(t,n){return e.apply(this,arguments)}}())))]}}))}))()}},[i[e].send,i[e].setOnComplete,i[e].setOnProgress]},_=function(e,t){var n=new Uint8Array(t),r=Dt(n.subarray(0,12)).replaceAll("\0",""),o=(0,T.default)(n.subarray(12,13),1)[0],u=(0,T.default)(n.subarray(13,14),1)[0],s=(0,T.default)(n.subarray(14,15),1)[0],c=n.subarray(15),l=!!(1&u),g=!!(2&u),m=!!(4&u),_=!!(8&u);if(i[r]){(f=a)[d=e]||(f[d]={}),(h=a[e])[p=r]||(h[p]={});var b=(v=a[e][r])[y=o]||(v[y]={chunks:[]});if(g?b.meta=jt(Dt(c)):b.chunks.push(c),i[r].onProgress(s/Kr,e,b.meta),l){var w=new Uint8Array(b.chunks.reduce((function(e,t){return e+t.byteLength}),0));if(b.chunks.reduce((function(e,t){return w.set(t,e),e+t.byteLength}),0),delete a[e][r][o],m)i[r].onComplete(w,e,b.meta);else{var E=Dt(w);i[r].onComplete(_?jt(E):E,e)}}}else console.warn("".concat(St,": received message with unregistered type (").concat(r,")"))},w=(0,T.default)(m(Zr("ping")),2),E=w[0],S=w[1],k=(0,T.default)(m(Zr("pong")),2),A=k[0],R=k[1],N=(0,T.default)(m(Zr("signal")),2),B=N[0],L=N[1],P=(0,T.default)(m(Zr("stream")),2),F=P[0],D=P[1],U=(0,T.default)(m(Zr("track")),2),q=U[0],M=U[1],j=(0,T.default)(m(Zr("leave")),2),H=j[0],z=j[1];return function(e){J=e}((function(e,t){var n;r[t]||(r[t]=e,e.setHandlers({data:function(e){return _(t,e)},stream:function(e){c.onPeerStream(e,t,u[t]),delete u[t]},track:function(e,n){c.onPeerTrack(e,n,t,s[t]),delete s[t]},signal:function(e){return B(e,t)},close:function(){return g(t)},error:function(){return g(t)}}),c.onPeerJoin(t),null===(n=e.drainEarlyData)||void 0===n||n.call(e,(function(e){return _(t,e)})))})),S((function(e,t){return A("",t)})),R((function(e,t){var n;null===(n=o[t])||void 0===n||n.call(o),delete o[t]})),L((function(e,t){var n;return null===(n=r[t])||void 0===n?void 0:n.signal(e)})),D((function(e,t){return u[t]=e})),M((function(e,t){return s[t]=e})),z((function(e,t){return g(t)})),{makeAction:m,ping:function(e){return(0,b.default)((function(){var t;return(0,O.__generator)(this,(function(n){switch(n.label){case 0:if(!e)throw Ot("ping() must be called with target peer ID");return t=Date.now(),E("",e),[4,new Promise((function(t){return o[e]=t}))];case 1:return[2,(n.sent(),Date.now()-t)]}}))}))()},leave:function(){return(0,b.default)((function(){return(0,O.__generator)(this,(function(e){switch(e.label){case 0:return[4,H("")];case 1:return e.sent(),[4,new Promise((function(e){return setTimeout(e,99)}))];case 2:return e.sent(),Rt(r).forEach((function(e){var t=(0,T.default)(e,2),n=t[0];t[1].destroy(),delete r[n]})),n(),[2]}}))}))()},getPeers:function(){return It(Rt(r).map((function(e){var t=(0,T.default)(e,2);return[t[0],t[1].connection]})))},addStream:function(e,t,n){return l(t,function(){var t=(0,b.default)((function(t,r){return(0,O.__generator)(this,(function(i){switch(i.label){case 0:return n?[4,F(n,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r.addStream(e),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}())},removeStream:function(e,t){return l(t,(function(t,n){return n.removeStream(e)}))},addTrack:function(e,t,n,r){return l(n,function(){var n=(0,b.default)((function(n,i){return(0,O.__generator)(this,(function(a){switch(a.label){case 0:return r?[4,q(r,n)]:[3,2];case 1:a.sent(),a.label=2;case 2:return i.addTrack(e,t),[2]}}))}));return function(e,t){return n.apply(this,arguments)}}())},removeTrack:function(e,t,n){return l(n,(function(n,r){return r.removeTrack(e,t)}))},replaceTrack:function(e,t,n,r,i){return l(r,function(){var r=(0,b.default)((function(r,a){return(0,O.__generator)(this,(function(o){switch(o.label){case 0:return i?[4,q(i,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return a.replaceTrack(e,t,n),[2]}}))}));return function(e,t){return r.apply(this,arguments)}}())},onPeerJoin:function(e){return c.onPeerJoin=e},onPeerLeave:function(e){return c.onPeerLeave=e},onPeerStream:function(e){return c.onPeerStream=e},onPeerTrack:function(e){return c.onPeerTrack=e}}}(0,(function(e){return delete N[e]}),(function(){delete g[k][_],Y.forEach(clearTimeout),G.forEach(function(){var e=(0,b.default)((function(e){return(0,O.__generator)(this,(function(t){switch(t.label){case 0:return[4,e];case 1:return[2,t.sent()()]}}))}));return function(t){return e.apply(this,arguments)}}()),clearInterval(r)}))}}({init:function(e){return function(e,t,n){return(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||5)}(e,ai).map((function(e){var t=function(e,t){var n={},r=function(){var i=new WebSocket(e);i.onclose=function(){var t;null!==(t=(g=Ht)[m=e])&&void 0!==t||(g[m]=3333),setTimeout(r,Ht[e]),Ht[e]*=2},i.onmessage=function(e){return t(e.data)},n.socket=i,n.url=i.url,n.ready=new Promise((function(t){return i.onopen=function(){t(n),Ht[e]=3333}})),n.send=function(e){1===i.readyState&&i.send(e)}};return r(),n}(e,(function(e){var n,r=(0,T.default)(jt(e),4),i=r[0],a=r[1],o=r[2],u=r[3];if(i===Gr)null===(n=Xr[a])||void 0===n||n.call(Xr,Qr[a],o.content);else{var s="".concat(St,": relay failure from ").concat(t.url," - ");"NOTICE"===i?console.warn(s+a):"OK"!==i||o||console.warn(s+u)}}));return Yr[e]=t,t.ready}))},subscribe:function(e,t,n,r){var i=Ct(64),a=Ct(64);return Xr[i]=Xr[a]=function(t,n){return r(t,n,function(){var t=(0,b.default)((function(t,n){var r;return(0,O.__generator)(this,(function(i){switch(i.label){case 0:return r=e.send,[4,ti(t,n)];case 1:return[2,r.apply(e,[i.sent()])]}}))}));return function(e,n){return t.apply(this,arguments)}}())},e.send(ni(i,t)),e.send(ni(a,n)),function(){e.send(ri(i)),e.send(ri(a)),delete Xr[i],delete Xr[a]}},announce:function(e,t){return(0,b.default)((function(){var n;return(0,O.__generator)(this,(function(r){switch(r.label){case 0:return n=e.send,[4,ti(t,Mt({peerId:xt}))];case 1:return[2,n.apply(e,[r.sent()])]}}))}))()}}),ai=(Dr=Yr,["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","relay.rebelbase.site","e.nos.lol"].map((function(e){return"wss://"+e})))}))}();