!function(){var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("E0fFs",(function(t,n){var r,i,a,o;r=t.exports,i="joinRoom",a=function(){return An},Object.defineProperty(r,i,{get:a,set:o,enumerable:!0,configurable:!0});var s,u,c,l,d,f,h,p,_,v,y,m,g,b,w,C,S,k=e("f1evb"),E=e("hnmIs"),x=e("9Klpk"),T=e("3bWnf"),R=e("eT7f3"),A=e("kb0qF"),N=e("bgoEC"),L=e("7j4mF"),F=e("1Qswt"),O=e("5ENmm"),P=e("6Wo7Q"),I=e("rJmE6"),D=e("bWNdT"),M=e("32Euv"),j=e("84cK9"),U="Trystero",q=function(e,t){return Array(e).fill().map(t)},W=function(e){return q(e,(function(){return"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Math.floor(62*Math.random())]})).join("")},H=W(20),B=Promise.all.bind(Promise),Y=Object.entries,J=Object.fromEntries,z=Object.keys,K=function(){},V=function(e){return Error("".concat(U,": ").concat(e))},$=new TextEncoder,G=new TextDecoder,Q=function(e){return $.encode(e)},Z=function(e){return G.decode(e)},X=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("@")},ee=JSON.stringify,te=JSON.parse,ne={},re="AES-GCM",ie={},ae=(S=(0,E.default)((function(e){var t,n,r;return(0,M.__generator)(this,(function(i){switch(i.label){case 0:return ie[e]?[2,ie[e]]:(n=Array.from,r=Uint8Array.bind,[4,crypto.subtle.digest("SHA-1",Q(e))]);case 1:return t=n.apply(Array,[new(r.apply(Uint8Array,[void 0,i.sent()]))]).map((function(e){return e.toString(36)})).join(""),[2,(ie[e]=t,t)]}}))})),function(e){return S.apply(this,arguments)}),oe=function(){var e=(0,E.default)((function(e,t){var n,r,i,a,o,s;return(0,M.__generator)(this,(function(u){switch(u.label){case 0:return n=crypto.getRandomValues(new Uint8Array(16)),i=n.join(",")+"$",o=(a=crypto.subtle).encrypt,s=[{name:re,iv:n}],[4,e];case 1:return[4,o.apply(a,s.concat([u.sent(),Q(t)]))];case 2:return[2,i+(r=u.sent(),btoa(String.fromCharCode.apply(null,new Uint8Array(r))))]}}))}));return function(t,n){return e.apply(this,arguments)}}(),se=function(){var e=(0,E.default)((function(e,t){var n,r,i,a,o,s;return(0,M.__generator)(this,(function(u){switch(u.label){case 0:return n=(0,O.default)(t.split("$"),2),r=n[0],i=n[1],o=(a=crypto.subtle).decrypt,s=[{name:re,iv:new Uint8Array(r.split(","))}],[4,e];case 1:return[4,o.apply(a,s.concat([u.sent(),function(e){var t=atob(e);return new Uint8Array(t.length).map((function(e,n){return t.charCodeAt(n)})).buffer}(i)]))];case 2:return[2,Z.apply(void 0,[u.sent()])]}}))}));return function(t,n){return e.apply(this,arguments)}}();function ue(e){return e&&e.__esModule&&{}.hasOwnProperty.call(e,"default")?e.default:e}var ce,le,de={exports:{}};var fe=function(e){function t(e){var r,i,a,o=null;function s(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(s.enabled){var a=s,o=Number(new Date),u=o-(r||o);a.diff=u,a.prev=r,a.curr=o,r=o,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";c++;var i=t.formatters[r];if("function"==typeof i){var o=n[c];e=i.call(a,o),n.splice(c,1),c--}return e})),t.formatArgs.call(a,n),(a.log||t.log).apply(a,n)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=n,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==o?o:(i!==t.namespaces&&(i=t.namespaces,a=t.enabled(e)),a)},set:function(e){o=e}}),"function"==typeof t.init&&t.init(s),s}function n(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=(0,P.default)(t.names.map(r)).concat((0,P.default)(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.slice(1)+"$")):t.names.push(RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=function(){if(le)return ce;le=1;var e=1e3,t=60*e,n=60*t,r=24*n,i=7*r;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}return ce=function(o,s){s=s||{};var u=void 0===o?"undefined":(0,I.default)(o);if("string"===u&&o.length>0)return function(a){if(!((a+="").length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(o){var s=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return s*i;case"days":case"day":case"d":return s*r;case"hours":case"hour":case"hrs":case"hr":case"h":return s*n;case"minutes":case"minute":case"mins":case"min":case"m":return s*t;case"seconds":case"second":case"secs":case"sec":case"s":return s*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(o);if("number"===u&&isFinite(o))return s.long?function(i){var o=Math.abs(i);return o>=r?a(i,o,r,"day"):o>=n?a(i,o,n,"hour"):o>=t?a(i,o,t,"minute"):o>=e?a(i,o,e,"second"):i+" ms"}(o):function(i){var a=Math.abs(i);return a>=r?Math.round(i/r)+"d":a>=n?Math.round(i/n)+"h":a>=t?Math.round(i/t)+"m":a>=e?Math.round(i/e)+"s":i+"ms"}(o);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))}}(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==j&&"env"in j&&(e=void 0),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=fe(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(de,de.exports);var he,pe=ue(de.exports),_e="undefined"!=typeof window?window:self,ve=_e.RTCPeerConnection||_e.mozRTCPeerConnection||_e.webkitRTCPeerConnection,ye=_e.RTCSessionDescription||_e.mozRTCSessionDescription||_e.webkitRTCSessionDescription,me=_e.RTCIceCandidate||_e.mozRTCIceCandidate||_e.webkitRTCIceCandidate,ge={exports:{}},be="object"==typeof Reflect?Reflect:null,we=be&&"function"==typeof be.apply?be.apply:function(e,t,n){return function(){}.apply.call(e,t,n)};he=be&&"function"==typeof be.ownKeys?be.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var Ce=Number.isNaN||function(e){return e!=e};function Se(){Se.init.call(this)}ge.exports=Se,ge.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}Oe(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&Oe(e,"error",t,{once:!0})}(e,i)}))},Se.EventEmitter=Se,Se.prototype._events=void 0,Se.prototype._eventsCount=0,Se.prototype._maxListeners=void 0;var ke=10;function Ee(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===e?"undefined":(0,I.default)(e)))}function xe(e){return void 0===e._maxListeners?Se.defaultMaxListeners:e._maxListeners}function Te(e,t,n,r){var i,a,o,s;if(Ee(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=xe(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,console&&console.warn&&console.warn(s)}return e}function Re(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ae(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=Re.bind(r);return i.listener=n,r.wrapFn=i,i}function Ne(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):Fe(i,i.length)}function Le(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function Fe(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function Oe(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+(void 0===e?"undefined":(0,I.default)(e)));e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}Object.defineProperty(Se,"defaultMaxListeners",{enumerable:!0,get:function(){return ke},set:function(e){if("number"!=typeof e||e<0||Ce(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ke=e}}),Se.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Se.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||Ce(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Se.prototype.getMaxListeners=function(){return xe(this)},Se.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)we(s,this,t);else{var u=s.length,c=Fe(s,u);for(n=0;n<u;++n)we(c[n],this,t)}return!0},Se.prototype.addListener=function(e,t){return Te(this,e,t,!1)},Se.prototype.on=Se.prototype.addListener,Se.prototype.prependListener=function(e,t){return Te(this,e,t,!0)},Se.prototype.once=function(e,t){return Ee(t),this.on(e,Ae(this,e,t)),this},Se.prototype.prependOnceListener=function(e,t){return Ee(t),this.prependListener(e,Ae(this,e,t)),this},Se.prototype.removeListener=function(e,t){var n,r,i,a,o;if(Ee(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},Se.prototype.off=Se.prototype.removeListener,Se.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},Se.prototype.listeners=function(e){return Ne(this,e,!0)},Se.prototype.rawListeners=function(e){return Ne(this,e,!1)},Se.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Le.call(e,t)},Se.prototype.listenerCount=Le,Se.prototype.eventNames=function(){return this._eventsCount>0?he(this._events):[]};var Pe=ge.exports,Ie="function"==typeof queueMicrotask?queueMicrotask:function(e){return Promise.resolve().then(e)},De=function(){"use strict";function e(t){if((0,x.default)(this,e),!(t>0)||t-1&t)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}return(0,T.default)(e,[{key:"clear",value:function(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}},{key:"push",value:function(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}},{key:"shift",value:function(){var e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}},{key:"peek",value:function(){return this.buffer[this.btm]}},{key:"isEmpty",value:function(){return void 0===this.buffer[this.btm]}}]),e}(),Me=function(){"use strict";function e(t){(0,x.default)(this,e),this.decoder=new TextDecoder("utf16le"===t?"utf16-le":t)}return(0,T.default)(e,[{key:"decode",value:function(e){return this.decoder.decode(e,{stream:!0})}},{key:"flush",value:function(){return this.decoder.decode(new Uint8Array(0))}}]),e}(),je=Me,Ue=Me,qe=Pe.EventEmitter,We=Error("Stream was destroyed"),He=Ie,Be=function(){"use strict";function e(t){(0,x.default)(this,e),this.hwm=t||16,this.head=new De(this.hwm),this.tail=this.head,this.length=0}return(0,T.default)(e,[{key:"clear",value:function(){this.head=this.tail,this.head.clear(),this.length=0}},{key:"push",value:function(e){if(this.length++,!this.head.push(e)){var t=this.head;this.head=t.next=new De(2*this.head.buffer.length),this.head.push(e)}}},{key:"shift",value:function(){0!==this.length&&this.length--;var e=this.tail.shift();if(void 0===e&&this.tail.next){var t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}},{key:"peek",value:function(){var e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}},{key:"isEmpty",value:function(){return 0===this.length}}]),e}(),Ye=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";switch((0,x.default)(this,e),this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:throw Error("Unknown encoding: "+e)}}(t),this.encoding){case"utf8":this.decoder=new Ue;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new je(this.encoding)}}return(0,T.default)(e,[{key:"push",value:function(e){return"string"==typeof e?e:this.decoder.decode(e)}},{key:"write",value:function(e){return this.push(e)}},{key:"end",value:function(e){var t="";return e&&(t=this.push(e)),t+=this.decoder.flush()}}]),e}(),Je=536870910,ze=16384,Ke=32768,Ve=131072,$e=536870143,Ge=536838143,Qe=536739839,Ze=524288,Xe=1048576,et=2097152,tt=8388608,nt=16777216,rt=33554432,it=134217728,at=469499903,ot=503316479,st=262160,ut=8404992,ct=8405006,lt=33587200,dt=33587215,ft=270794767,ht=Symbol.asyncIterator||Symbol(),pt=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,a=n.map,o=void 0===a?null:a,s=n.mapWritable,u=n.byteLength,c=n.byteLengthWritable;(0,x.default)(this,e),this.stream=t,this.queue=new Be,this.highWaterMark=i,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=c||u||Lt,this.map=s||o,this.afterWrite=bt.bind(this),this.afterUpdateNextTick=St.bind(this)}return(0,T.default)(e,[{key:"ended",get:function(){return!!(this.stream._duplexState&tt)}},{key:"push",value:function(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=et,!0):(this.stream._duplexState|=6291456,!1)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=534773759),e}},{key:"end",value:function(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=535822335&this.stream._duplexState|134217728}},{key:"autoBatch",value:function(e,t){var n=[],r=this.stream;for(n.push(e);2359296==(r._duplexState&ft);)n.push(r._writableState.shift());if(15&r._duplexState)return t(null);r._writev(n,t)}},{key:"update",value:function(){var e=this.stream;e._duplexState|=Ze;do{for(;(e._duplexState&ft)===et;){var t=this.shift();e._duplexState|=67371008,e._write(t,this.afterWrite)}1310720&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536346623}},{key:"updateNonPrimary",value:function(){var e=this.stream;if((144965647&e._duplexState)===it)return e._duplexState=402653183&e._duplexState|262144,void e._final(mt.bind(this));4!=(14&e._duplexState)?1==(e._duplexState&dt)&&(e._duplexState=(e._duplexState|st)&Je,e._open(kt.bind(this))):e._duplexState&lt||(e._duplexState|=st,e._destroy(gt.bind(this)))}},{key:"continueUpdate",value:function(){return!!(this.stream._duplexState&rt)&&(this.stream._duplexState&=ot,!0)}},{key:"updateCallback",value:function(){(35127311&this.stream._duplexState)===Xe?this.update():this.updateNextTick()}},{key:"updateNextTick",value:function(){this.stream._duplexState&rt||(this.stream._duplexState|=rt,this.stream._duplexState&Ze||He(this.afterUpdateNextTick))}}]),e}(),_t=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,a=n.map,o=void 0===a?null:a,s=n.mapReadable,u=n.byteLength,c=n.byteLengthReadable;(0,x.default)(this,e),this.stream=t,this.queue=new Be,this.highWaterMark=0===i?1:i,this.buffered=0,this.readAhead=i>0,this.error=null,this.pipeline=null,this.byteLength=c||u||Lt,this.map=s||o,this.pipeTo=null,this.afterRead=wt.bind(this),this.afterUpdateNextTick=Ct.bind(this)}return(0,T.default)(e,[{key:"ended",get:function(){return!!(this.stream._duplexState&ze)}},{key:"pipe",value:function(e,t){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new vt(this.stream,e,t),t&&this.stream.on("error",Ft),Nt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Ft),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{var n=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",n),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",yt.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}},{key:"push",value:function(e){var t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=536805311&t._duplexState|1024,!1):(null!==this.map&&null===(e=this.map(e))||(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=536805375&t._duplexState|128),this.buffered<this.highWaterMark)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=536862591),e}},{key:"unshift",value:function(e){for(var t=[null!==this.map?this.map(e):e];this.buffered>0;)t.push(this.shift());for(var n=0;n<t.length-1;n++){var r=t[n];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}},{key:"read",value:function(){var e=this.stream;if(128==(16527&e._duplexState)){var t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=$e),2048&e._duplexState&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=Ve,this.updateNextTick()),null}},{key:"drain",value:function(){for(var e=this.stream;128==(16527&e._duplexState)&&768&e._duplexState;){var t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=$e),2048&e._duplexState&&e.emit("data",t)}}},{key:"update",value:function(){var e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)===Ve;)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=8192,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536870879}},{key:"updateNonPrimary",value:function(){var e=this.stream;1024==(1167&e._duplexState)&&(e._duplexState=536869887&e._duplexState|16384,e.emit("end"),(e._duplexState&ct)===ut&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(14&e._duplexState)?1==(e._duplexState&dt)&&(e._duplexState=(e._duplexState|st)&Je,e._open(kt.bind(this))):e._duplexState&lt||(e._duplexState|=st,e._destroy(gt.bind(this)))}},{key:"continueUpdate",value:function(){return!!(this.stream._duplexState&Ke)&&(this.stream._duplexState&=Ge,!0)}},{key:"updateCallback",value:function(){64==(32879&this.stream._duplexState)?this.update():this.updateNextTick()}},{key:"updateNextTick",value:function(){this.stream._duplexState&Ke||(this.stream._duplexState|=Ke,32&this.stream._duplexState||He(this.afterUpdateNextTick))}}]),e}(),vt=function(){"use strict";function e(t,n,r){(0,x.default)(this,e),this.from=t,this.to=n,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}return(0,T.default)(e,[{key:"finished",value:function(){this.pipeToFinished=!0}},{key:"done",value:function(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&ze||this.to.destroy(this.error||Error("Readable stream closed before ending")):this.from._duplexState&ze&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"))}}]),e}();function yt(){this.stream._duplexState|=512,this.updateCallback()}function mt(e){var t=this.stream;e&&t.destroy(e),14&t._duplexState||(t._duplexState|=tt,t.emit("finish")),(t._duplexState&ct)===ut&&(t._duplexState|=4),t._duplexState&=at,t._duplexState&Ze?this.updateNextTick():this.update()}function gt(e){var t=this.stream;e||this.error===We||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");var n=t._readableState,r=t._writableState;if(null!==n&&null!==n.pipeline&&n.pipeline.done(t,e),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(t,e)}}function bt(e){var t=this.stream;e&&t.destroy(e),t._duplexState&=at,null!==this.drains&&function(e){for(var t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),4194304==(6553615&t._duplexState)&&(t._duplexState&=532676607,(t._duplexState&nt)===nt&&t.emit("drain")),this.updateCallback()}function wt(e){e&&this.stream.destroy(e),this.stream._duplexState&=536870895,!1!==this.readAhead||256&this.stream._duplexState||(this.stream._duplexState&=Qe),this.updateCallback()}function Ct(){32&this.stream._duplexState||(this.stream._duplexState&=Ge,this.update())}function St(){this.stream._duplexState&Ze||(this.stream._duplexState&=ot,this.update())}function kt(e){var t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=64),142606351&t._duplexState||(t._duplexState|=Xe),t.emit("open")),t._duplexState&=536608751,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function Et(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=nt,this._writableState.updateNextTick())}var xt=function(e){"use strict";(0,A.default)(n,e);var t=(0,D.default)(n);function n(e){var r;return(0,x.default)(this,n),(r=t.call(this))._duplexState=0,r._readableState=null,r._writableState=null,e&&(e.open&&(r._open=e.open),e.destroy&&(r._destroy=e.destroy),e.predestroy&&(r._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",Ot.bind((0,k.default)(r)))),r.on("newListener",Et),(0,F.default)(r)}return(0,T.default)(n,[{key:"_open",value:function(e){e(null)}},{key:"_destroy",value:function(e){e(null)}},{key:"_predestroy",value:function(){}},{key:"readable",get:function(){return null!==this._readableState||void 0}},{key:"writable",get:function(){return null!==this._writableState||void 0}},{key:"destroyed",get:function(){return!!(8&this._duplexState)}},{key:"destroying",get:function(){return!!(14&this._duplexState)}},{key:"destroy",value:function(e){14&this._duplexState||(e||(e=We),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}]),n}(qe),Tt=function(e){"use strict";(0,A.default)(n,e);var t=(0,D.default)(n);function n(e){var r;return(0,x.default)(this,n),(r=t.call(this,e))._duplexState|=8519681,r._readableState=new _t((0,k.default)(r),e),e&&(!1===r._readableState.readAhead&&(r._duplexState&=Qe),e.read&&(r._read=e.read),e.eagerOpen&&r._readableState.updateNextTick(),e.encoding&&r.setEncoding(e.encoding)),(0,F.default)(r)}return(0,T.default)(n,[{key:"setEncoding",value:function(e){var t=new Ye(e),n=this._readableState.map||At;return this._readableState.map=function(e){var r=t.push(e);return""===r?null:n(r)},this}},{key:"_read",value:function(e){e(null)}},{key:"pipe",value:function(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}},{key:"read",value:function(){return this._readableState.updateNextTick(),this._readableState.read()}},{key:"push",value:function(e){return this._readableState.updateNextTick(),this._readableState.push(e)}},{key:"unshift",value:function(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}},{key:"resume",value:function(){return this._duplexState|=131328,this._readableState.updateNextTick(),this}},{key:"pause",value:function(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}},{key:ht,value:function(){var e,t=this,n=null,r=null,i=null;return this.on("error",(function(e){n=e})),this.on("readable",(function(){null!==r&&a(t.read())})),this.on("close",(function(){null!==r&&a(null)})),e={},(0,R.default)(e,ht,(function(){return this})),(0,R.default)(e,"next",(function(){return new Promise((function(e,n){r=e,i=n;var o=t.read();null!==o?a(o):8&t._duplexState&&a(null)}))})),(0,R.default)(e,"return",(function(){return o(null)})),(0,R.default)(e,"throw",(function(e){return o(e)})),e;function a(e){null!==i&&(n?i(n):null!==e||t._duplexState&ze?r({value:e,done:null===e}):i(We),i=r=null)}function o(e){return t.destroy(e),new Promise((function(n,r){if(8&t._duplexState)return n({value:void 0,done:!0});t.once("close",(function(){e?r(e):n({value:void 0,done:!0})}))}))}}}],[{key:"_fromAsyncIterator",value:function(e,t){var r,i=new n((0,L.default)((0,N.default)({},t),{read:function(t){e.next().then(a).then(t.bind(null,null)).catch(t)},predestroy:function(){r=e.return()},destroy:function(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}}));return i;function a(e){e.done?i.push(null):i.push(e.value)}}},{key:"from",value:function(e,t){if(Nt(r=e)&&r.readable)return e;var r;if(e[ht])return this._fromAsyncIterator(e[ht](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);var i=0;return new n((0,L.default)((0,N.default)({},t),{read:function(t){this.push(i===e.length?null:e[i++]),t(null)}}))}},{key:"isBackpressured",value:function(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}},{key:"isPaused",value:function(e){return!(256&e._duplexState)}}]),n}(xt),Rt=function(e){"use strict";(0,A.default)(n,e);var t=(0,D.default)(n);function n(e){var r;return(0,x.default)(this,n),(r=t.call(this,e))._duplexState=1|r._duplexState&Ve,r._writableState=new pt((0,k.default)(r),e),e&&(e.writev&&(r._writev=e.writev),e.write&&(r._write=e.write),e.final&&(r._final=e.final)),(0,F.default)(r)}return(0,T.default)(n,[{key:"cork",value:function(){this._duplexState|=268435456}},{key:"uncork",value:function(){this._duplexState&=268435455,this._writableState.updateNextTick()}},{key:"_writev",value:function(e,t){t(null)}},{key:"_write",value:function(e,t){this._writableState.autoBatch(e,t)}},{key:"_final",value:function(e){e(null)}},{key:"write",value:function(e){return this._writableState.updateNextTick(),this._writableState.push(e)}},{key:"end",value:function(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}]),n}(Tt);function At(e){return e}function Nt(e){return"number"==typeof e._duplexState&&function(e){return!!e._readableState||!!e._writableState}(e)}function Lt(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function Ft(){}function Ot(){this.destroy(Error("Stream aborted."))}var Pt=Rt;function It(e,t){for(var n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}for(var Dt=ue((function(e,t,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return It(e,n)}catch(t){n.message=e.message,n.stack=e.stack;var r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(e)),It(new r,n)}})),Mt="0123456789abcdef",jt=[],Ut=0;Ut<256;Ut++)jt[Ut]=Mt[Ut>>4&15]+Mt[15&Ut];for(var qt=function(e){for(var t=e.length,n="",r=0;r<t;)n+=jt[e[r++]];return n},Wt="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ht=0;Ht<64;Ht++)Wt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(Ht)]=Ht;new TextDecoder;var Bt=new TextEncoder,Yt="undefined"!=typeof window?window:self,Jt=Yt.crypto||Yt.msCrypto||{};Jt.subtle||Jt.webkitSubtle;var zt=function(e){var t=new Uint8Array(e);return Jt.getRandomValues(t)},Kt=pe("simple-peer"),Vt=65536;function $t(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var Gt=function(e){"use strict";(0,A.default)(n,e);var t=(0,D.default)(n);function n(e){var r;if((0,x.default)(this,n),r=t.call(this,e=Object.assign({allowHalfOpen:!1},e)),(0,R.default)((0,k.default)(r),"_pc",void 0),r.__objectMode=!!e.objectMode,r._id=qt(zt(4)).slice(0,7),r._debug("new peer %o",e),r.channelName=e.initiator?e.channelName||qt(zt(20)):null,r.initiator=e.initiator||!1,r.channelConfig=e.channelConfig||n.channelConfig,r.channelNegotiated=r.channelConfig.negotiated,r.config=Object.assign({},n.config,e.config),r.offerOptions=e.offerOptions||{},r.answerOptions=e.answerOptions||{},r.sdpTransform=e.sdpTransform||function(e){return e},r.trickle=void 0===e.trickle||e.trickle,r.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,r.iceCompleteTimeout=e.iceCompleteTimeout||5e3,r._destroying=!1,r._connected=!1,r.remoteAddress=void 0,r.remoteFamily=void 0,r.remotePort=void 0,r.localAddress=void 0,r.localFamily=void 0,r.localPort=void 0,!ve)throw"undefined"==typeof window?Dt(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):Dt(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");r._pcReady=!1,r._channelReady=!1,r._iceComplete=!1,r._iceCompleteTimer=null,r._channel=null,r._pendingCandidates=[],r._isNegotiating=!1,r._firstNegotiation=!0,r._batchedNegotiation=!1,r._queuedNegotiation=!1,r._sendersAwaitingStable=[],r._closingInterval=null,r._remoteTracks=[],r._remoteStreams=[],r._chunk=null,r._cb=null,r._interval=null;try{r._pc=new ve(r.config)}catch(e){return(0,F.default)(r,void r.__destroy(Dt(e,"ERR_PC_CONSTRUCTOR")))}return r._isReactNativeWebrtc="number"==typeof r._pc._peerConnectionId,r._pc.oniceconnectionstatechange=function(){r._onIceStateChange()},r._pc.onicegatheringstatechange=function(){r._onIceStateChange()},r._pc.onconnectionstatechange=function(){r._onConnectionStateChange()},r._pc.onsignalingstatechange=function(){r._onSignalingStateChange()},r._pc.onicecandidate=function(e){r._onIceCandidate(e)},"object"==typeof r._pc.peerIdentity&&r._pc.peerIdentity.catch((function(e){r.__destroy(Dt(e,"ERR_PC_PEER_IDENTITY"))})),r.initiator||r.channelNegotiated?r._setupData({channel:r._pc.createDataChannel(r.channelName,r.channelConfig)}):r._pc.ondatachannel=function(e){r._setupData(e)},r._debug("initial negotiation"),r._needsNegotiation(),r._onFinishBound=function(){r._onFinish()},r.once("finish",r._onFinishBound),(0,F.default)(r)}return(0,T.default)(n,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new ye(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.__destroy(Dt(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.__destroy(Dt(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,n=new me(e);this._pc.addIceCandidate(n).catch((function(e){!n.address||n.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):t.__destroy(Dt(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"_final",value:function(e){this._readableState.ended||this.push(null),e(null)}},{key:"__destroy",value:function(e){this.end(),this._destroy((function(){}),e)}},{key:"_destroy",value:function(e,t){var n=this;this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),setTimeout((function(){if(n._connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._closingInterval),n._closingInterval=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,n._pc.ontrack=null,n._pc.ondatachannel=null}n._pc=null,n._channel=null,t&&n.emit("error",t),e()}),0))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.__destroy(Dt(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=Vt),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){var n=e.error instanceof Error?e.error:Error("Datachannel error: ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));t.__destroy(Dt(n,"ERR_DATA_CHANNEL"))};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_write",value:function(e,t){if(this.destroyed)return t(Dt(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.__destroy(Dt(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Vt?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=t):t(null)}else this._debug("write before connect"),this._chunk=e,this._cb=t}},{key:"_onFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.__destroy()}),1e3)};this._connected?t():this.once("connect",t)}}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=$t(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.__destroy(Dt(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.__destroy(Dt(t,"ERR_CREATE_OFFER"))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=$t(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){var n,r;if(!e.destroyed){var i=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:i.type,sdp:i.sdp}),e.initiator||null===(r=(n=e)._requestMissingTransceivers)||void 0===r||r.call(n)}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.__destroy(Dt(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.__destroy(Dt(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||this._destroying||"failed"===this._pc.connectionState&&this.__destroy(Dt(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.__destroy(Dt(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.__destroy(Dt(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"==={}.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e._destroying||e.getStats((function(n,r){if(!e.destroyed&&!e._destroying){n&&(r=[]);var i={},a={},o={},s=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));var u=function(t){s=!0;var n=a[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)})),s||Object.keys(o).length&&!Object.keys(a).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.__destroy(Dt(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))};t()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>Vt||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t,n=e.data;n instanceof ArrayBuffer?n=new Uint8Array(n):!1===this.__objectMode&&(t=n,n=Bt.encode(t)),this.push(n)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.__destroy())}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Kt.apply(null,e)}}]),n}(Pt);Gt.WEBRTC_SUPPORT=!!ve,Gt.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Gt.channelConfig={};var Qt,Zt,Xt,en,tn,nn,rn,an,on,sn,un=function(e){"use strict";(0,A.default)(n,e);var t=(0,D.default)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,x.default)(this,n),(e=t.call(this,r))._pc&&(e.streams=r.streams||(r.stream?[r.stream]:[]),e._senderMap=new Map,e.streams&&e.streams.forEach((function(t){e.addStream(t)})),e._pc.ontrack=function(t){e._onTrack(t)}),(0,F.default)(e)}return(0,T.default)(n,[{key:"addTransceiver",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.__destroy(Dt(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(n){t.addTrack(n,e)}))}}},{key:"addTrack",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var n=this._senderMap.get(e)||new Map,r=n.get(t);if(r)throw r.removed?Dt(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Dt(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,n){if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw Dt(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.__destroy(Dt(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw Dt(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.__destroy(Dt(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this._destroying){if(this.destroyed)throw Dt(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(n){t.removeTrack(n,e)}))}}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some((function(e){return e.id===n.id}))||(t._remoteStreams.push(n),queueMicrotask((function(){t._debug("on stream"),t.emit("stream",n)})))}))}}]),n}(Gt),cn="data",ln="signal",dn=function(e,t){var n=new un((0,L.default)((0,N.default)({iceServers:[{urls:fn}]},t),{initiator:e,trickle:!1})),r=function(e){return i.push(e)},i=[];return n.on(cn,r),{id:n._id,created:Date.now(),connection:n._pc,get channel(){return n._channel},get isDead(){return n.destroyed},signal:function(t){return new Promise((function(r){e||n.on(ln,r),n.signal(t)}))},sendData:function(e){return n.send(e)},destroy:function(){return n.destroy()},setHandlers:function(e){return Object.entries(e).forEach((function(e){var t=(0,O.default)(e,2),r=t[0],i=t[1];return n.on(r,i)}))},offerPromise:e?new Promise((function(e){return n.on(ln,e)})):Promise.resolve(),addStream:function(e){return n.addStream(e)},removeStream:function(e){return n.removeStream(e)},addTrack:function(e,t){return n.addTrack(e,t)},removeTrack:function(e,t){return n.removeTrack(e,t)},replaceTrack:function(e,t,r){return n.replaceTrack(e,t,r)},drainEarlyData:function(e){n.off(cn,r),i.forEach(e),i=null}}},fn=(0,P.default)(q(5,(function(e,t){return"stun:stun".concat(t||"",".l.google.com:19302")}))).concat(["stun:global.stun.twilio.com:3478"]),hn=Object.getPrototypeOf(Uint8Array),pn=16369,_n=255,vn="bufferedamountlow",yn=function(e){return"@_"+e},mn={},gn={},bn={},wn={},Cn={},Sn={},kn={},En={},xn=function(){var e=(0,E.default)((function(e){var t;return(0,M.__generator)(this,(function(n){switch(n.label){case 0:return gn[e]?[2,gn[e]]:[4,ae(e)];case 1:return t=n.sent().slice(0,20),[2,(gn[e]=t,bn[t]=e,t)]}}))}));return function(t){return e.apply(this,arguments)}}(),Tn=function(){var e=(0,E.default)((function(e,t,n){var r,i;return(0,M.__generator)(this,(function(a){switch(a.label){case 0:return r=e.send,i={action:"announce"},[4,xn(t)];case 1:return[2,r.apply(e,[ee.apply(void 0,[N.default.apply(void 0,[(i.info_hash=a.sent(),i.peer_id=H,i),n])])])]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),Rn=function(e,t,n){return console.warn("".concat(U,": torrent tracker ").concat(n?"failure":"warning"," from ").concat(e," - ").concat(t))},An=(Qt={init:function(e){return function(e,t,n){return(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||3)}(e,Nn).map((function(e){var t=function(e,t){var n={},r=function(){var i=new WebSocket(e);i.onclose=function(){var t;null!==(t=(y=ne)[m=e])&&void 0!==t||(y[m]=3333),setTimeout(r,ne[e]),ne[e]*=2},i.onmessage=function(e){return t(e.data)},n.socket=i,n.url=i.url,n.ready=new Promise((function(t){return i.onopen=function(){t(n),ne[e]=3333}})),n.send=function(e){1===i.readyState&&i.send(e)}};return r(),n}(e,(function(e){var t=te(e),r=t["failure reason"],i=t["warning message"],a=t.interval,o=bn[t.info_hash];if(r)Rn(n,r,!0);else{var s,u;if(i&&Rn(n,i),a&&1e3*a>Sn[n]&&Cn[n][o]){var c=Math.min(1e3*a,120333);clearInterval(wn[n][o]),Sn[n]=c,wn[n][o]=setInterval(Cn[n][o],c)}kn[t.offer_id]||(t.offer||t.answer)&&(kn[t.offer_id]=!0,null===(u=(s=En[n])[o])||void 0===u||u.call(s,t))}})),n=t.url;return mn[n]=t,En[n]={},t.ready}))},subscribe:function(e,t,n,r,i){var a=e.url,o=function(){var n=(0,E.default)((function(){var n;return(0,M.__generator)(this,(function(a){switch(a.label){case 0:return[4,i(10)];case 1:return n=J.apply(void 0,[a.sent().map((function(e){return[W(20),e]}))]),En[e.url][t]=function(i){if(i.offer)r(t,{offer:i.offer,peerId:i.peer_id},(function(n,r){return Tn(e,t,{answer:te(r).answer,offer_id:i.offer_id,to_peer_id:i.peer_id})}));else if(i.answer){var a=n[i.offer_id];a&&r(t,{answer:i.answer,peerId:i.peer_id,peer:a.peer})}},Tn(e,t,{numwant:10,offers:Y(n).map((function(e){var t=(0,O.default)(e,2);return{offer_id:t[0],offer:t[1].offer}}))}),[2]}}))}));return function(){return n.apply(this,arguments)}}();return Sn[a]=33333,(g=Cn)[b=a]||(g[b]={}),Cn[a][t]=o,(w=wn)[C=a]||(w[C]={}),wn[a][t]=setInterval(o,Sn[a]),o(),function(){clearInterval(wn[a][t]),delete En[a][t],delete Cn[a][t]}},announce:function(e){return Sn[e.url]}},tn=Qt.init,nn=Qt.subscribe,rn=Qt.announce,an={},on=!1,function(e,t,n){var r,i,a=e.appId;if(null===(i=an[a])||void 0===i?void 0:i[t])return an[a][t];var o={},y={},m=X(U,a,t),g=ae(m),b=ae(X(m,H)),w=e.password&&function(){var e=(0,E.default)((function(e,t,n){var r,i,a;return(0,M.__generator)(this,(function(o){switch(o.label){case 0:return i=(r=crypto.subtle).importKey,a=["raw"],[4,crypto.subtle.digest({name:"SHA-256"},Q("".concat(e,":").concat(t,":").concat(n)))];case 1:return[2,i.apply(r,a.concat([o.sent(),{name:re},!1,["encrypt","decrypt"]]))]}}))}));return function(t,n,r){return e.apply(this,arguments)}}()(e.password,a,t),C=function(e){return function(){var t=(0,E.default)((function(t){var n,r;return(0,M.__generator)(this,(function(i){switch(i.label){case 0:return w?(r={type:t.type},[4,e(w,t.sdp)]):[3,2];case 1:return r.sdp=i.sent(),n=r,[3,3];case 2:n=t,i.label=3;case 3:return[2,n]}}))}));return function(e){return t.apply(this,arguments)}}()},S=C(se),k=C(oe),x=function(){return dn(!0,e.rtcConfig)},T=function(e,t,n){var r;y[t]?y[t]!==e&&e.destroy():(y[t]=e,ne(e,t),null===(r=o[t])||void 0===r||r.forEach((function(e,t){t!==n&&e.destroy()})),delete o[t])},R=function(e,t){y[t]===e&&delete y[t]},A=function(e){return(r=Xt).push.apply(r,(0,P.default)(q(e,x))),B(Xt.splice(0,e).map((function(e){return e.offerPromise.then(k).then((function(t){return{peer:e,offer:t}}))})))},F=function(r,i){return null==n?void 0:n({error:"incorrect password (".concat(e.password,") when decrypting ").concat(i),appId:a,peerId:r,roomId:t})},D=function(t){return function(){var n=(0,E.default)((function(n,r,i){var a,c,l,d,f,h,p,_,v,w,C,E,x,N,L,P,I,D,j,U,q,Y,J,z,K,V;return(0,M.__generator)(this,(function(M){switch(M.label){case 0:return[4,B([g,b])];case 1:if(a=O.default.apply(void 0,[M.sent(),2]),c=a[0],l=a[1],n!==c&&n!==l)return[2];if(d="string"==typeof r?te(r):r,f=d.peerId,h=d.offer,p=d.answer,_=d.peer,f===H||y[f])return[3,16];if(f&&!h&&!p)return[3,14];if(!h)return[3,8];if((null===(v=o[f])||void 0===v?void 0:v[t])&&H>f)return[2];(w=dn(!1,e.rtcConfig)).setHandlers({connect:function(){return T(w,f,t)},close:function(){return R(w,f)}}),M.label=2;case 2:return M.trys.push([2,4,,5]),[4,S(h)];case 3:return C=M.sent(),[3,5];case 4:return M.sent(),[2,void F(f,"offer")];case 5:return w.isDead?[2]:[4,B([ae(X(m,f)),w.signal(C)])];case 6:return E=O.default.apply(void 0,[M.sent(),2]),x=E[0],N=E[1],L=[x],P={peerId:H},[4,k(N)];case 7:return i.apply(void 0,L.concat([ee.apply(void 0,[(P.answer=M.sent(),P)])])),[3,13];case 8:if(!p)return[3,13];M.label=9;case 9:return M.trys.push([9,11,,12]),[4,S(p)];case 10:return I=M.sent(),[3,12];case 11:return M.sent(),[2,void F(f,"answer")];case 12:_?(_.setHandlers({connect:function(){return T(_,f,t)},close:function(){return R(_,f)}}),_.signal(I)):(j=null===(D=o[f])||void 0===D?void 0:D[t])&&!j.isDead&&j.signal(I),M.label=13;case 13:return[3,16];case 14:return(null===(U=o[f])||void 0===U?void 0:U[t])?[2]:[4,B([A(1),ae(X(m,f))])];case 15:q=O.default.apply(void 0,[M.sent(),2]),Y=(0,O.default)(q[0],1),J=Y[0],z=J.peer,K=J.offer,V=q[1],(s=o)[u=f]||(s[u]=[]),o[f][t]=z,setTimeout((function(){return function(e,t){var n;if(!y[e]){var r=null===(n=o[e])||void 0===n?void 0:n[t];r&&(delete o[e][t],r.destroy())}}(f,t)}),.9*W[t]),z.setHandlers({connect:function(){return T(z,f,t)},close:function(){return R(z,f)}}),i(V,ee({peerId:H,offer:K})),M.label=16;case 16:return[2]}}))}));return function(e,t,r){return n.apply(this,arguments)}}()};if(!e)throw V("requires a config map as the first argument");if(!a&&!e.firebaseApp)throw V("config map is missing appId field");if(!t)throw V("roomId argument required");if(!on){var j=tn(e);Xt=q(20,x),Zt=Array.isArray(j)?j:[j],on=!0,en=setInterval((function(){return Xt=Xt.filter((function(e){var t=Date.now()-e.created<57333;return t||e.destroy(),t}))}),59052.99)}var W=Zt.map((function(){return 5333})),$=[],G=Zt.map(function(){var e=(0,E.default)((function(e,t){var n;return(0,M.__generator)(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return n=[r.sent()],[4,g];case 2:return n=n.concat(r.sent()),[4,b];case 3:return[2,nn.apply(void 0,n.concat([r.sent(),D(t),A]))]}}))}));return function(t,n){return e.apply(this,arguments)}}());B([g,b]).then((function(e){var t=(0,O.default)(e,2),n=t[0],r=t[1],i=function(){var e=(0,E.default)((function(e,t){var a;return(0,M.__generator)(this,(function(o){switch(o.label){case 0:return[4,rn(e,n,r)];case 1:return"number"==typeof(a=o.sent())&&(W[t]=a),$[t]=setTimeout((function(){return i(e,t)}),W[t]),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}();G.forEach(function(){var e=(0,E.default)((function(e,t){return(0,M.__generator)(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,Zt[t]];case 2:return i.apply(void 0,[n.sent(),t]),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}())}));var ne=K;return(c=an)[l=a]||(c[l]={}),an[a][t]=function(e,t,n){var r={},i={},a={},o={},s={},u={},c={onPeerJoin:K,onPeerLeave:K,onPeerStream:K,onPeerTrack:K},l=function(e,t){return(e?Array.isArray(e)?e:[e]:z(r)).flatMap((function(e){var n=r[e];return n?t(e,n):(console.warn("".concat(U,": no peer with id ").concat(e," found")),[])}))},y=function(e){r[e]&&(delete r[e],delete a[e],delete o[e],c.onPeerLeave(e),t(e))},m=function(e){if(i[e])return[i[e].send,i[e].setOnComplete,i[e].setOnProgress];if(!e)throw V("action type argument is required");var t=Q(e);if(t.byteLength>12)throw V('action type string "'.concat(e,'" (').concat(t.byteLength,"b) exceeds byte limit (12). Hint: choose a shorter name."));var n=new Uint8Array(12);n.set(t);var a=0;return i[e]={onComplete:K,onProgress:K,setOnComplete:function(t){return i[e]=(0,L.default)((0,N.default)({},i[e]),{onComplete:t})},setOnProgress:function(t){return i[e]=(0,L.default)((0,N.default)({},i[e]),{onProgress:t})},send:function(e,t,i,o){return(0,E.default)((function(){var s,u,c,d,f,h,p,_,v,y,m;return(0,M.__generator)(this,(function(g){switch(g.label){case 0:if(i&&"object"!=typeof i)throw V("action meta argument must be an object");if("undefined"===(s=void 0===e?"undefined":(0,I.default)(e)))throw V("action data cannot be undefined");if(u="string"!==s,c=e instanceof Blob,d=c||e instanceof ArrayBuffer||e instanceof hn,i&&!d)throw V("action meta argument can only be used with binary data");return d?(y=Uint8Array.bind,c?[4,e.arrayBuffer()]:[3,2]):[3,4];case 1:return m=g.sent(),[3,3];case 2:m=e,g.label=3;case 3:return v=new(y.apply(Uint8Array,[void 0,m])),[3,5];case 4:v=Q(u?ee(e):e),g.label=5;case 5:return f=v,h=i?Q(ee(i)):null,p=Math.ceil(f.byteLength/pn)+(i?1:0)||1,_=q(p,(function(e,t){var r=t===p-1,o=i&&0===t,s=new Uint8Array(15+(o?h.byteLength:r?f.byteLength-pn*(p-(i?2:1)):pn));return s.set(n),s.set([a],12),s.set([r|o<<1|d<<2|u<<3],13),s.set([Math.round((t+1)/p*_n)],14),s.set(i?o?h:f.subarray((t-1)*pn,t*pn):f.subarray(t*pn,(t+1)*pn),15),s})),[2,(a=a+1&_n,B(l(t,function(){var e=(0,E.default)((function(e,t){var n,a,s;return(0,M.__generator)(this,(function(u){switch(u.label){case 0:n=t.channel,a=0,u.label=1;case 1:return a<p?(s=_[a],n.bufferedAmount>n.bufferedAmountLowThreshold?[4,new Promise((function(e){var t=function(){n.removeEventListener(vn,t),e()};n.addEventListener(vn,t)}))]:[3,3]):[3,5];case 2:u.sent(),u.label=3;case 3:if(!r[e])return[3,5];t.sendData(s),a++,null==o||o(s[14]/_n,e,i),u.label=4;case 4:return[3,1];case 5:return[2]}}))}));return function(t,n){return e.apply(this,arguments)}}())))]}}))}))()}},[i[e].send,i[e].setOnComplete,i[e].setOnProgress]},g=function(e,t){var n=new Uint8Array(t),r=Z(n.subarray(0,12)).replaceAll("\0",""),o=(0,O.default)(n.subarray(12,13),1)[0],s=(0,O.default)(n.subarray(13,14),1)[0],u=(0,O.default)(n.subarray(14,15),1)[0],c=n.subarray(15),l=!!(1&s),y=!!(2&s),m=!!(4&s),g=!!(8&s);if(i[r]){(d=a)[f=e]||(d[f]={}),(h=a[e])[p=r]||(h[p]={});var b=(_=a[e][r])[v=o]||(_[v]={chunks:[]});if(y?b.meta=te(Z(c)):b.chunks.push(c),i[r].onProgress(u/_n,e,b.meta),l){var w=new Uint8Array(b.chunks.reduce((function(e,t){return e+t.byteLength}),0));if(b.chunks.reduce((function(e,t){return w.set(t,e),e+t.byteLength}),0),delete a[e][r][o],m)i[r].onComplete(w,e,b.meta);else{var C=Z(w);i[r].onComplete(g?te(C):C,e)}}}else console.warn("".concat(U,": received message with unregistered type (").concat(r,")"))},b=(0,O.default)(m(yn("ping")),2),w=b[0],C=b[1],S=(0,O.default)(m(yn("pong")),2),k=S[0],x=S[1],T=(0,O.default)(m(yn("signal")),2),R=T[0],A=T[1],F=(0,O.default)(m(yn("stream")),2),P=F[0],D=F[1],j=(0,O.default)(m(yn("track")),2),W=j[0],H=j[1],$=(0,O.default)(m(yn("leave")),2),G=$[0],X=$[1];return function(e){ne=e}((function(e,t){var n;r[t]||(r[t]=e,e.setHandlers({data:function(e){return g(t,e)},stream:function(e){c.onPeerStream(e,t,s[t]),delete s[t]},track:function(e,n){c.onPeerTrack(e,n,t,u[t]),delete u[t]},signal:function(e){return R(e,t)},close:function(){return y(t)},error:function(){return y(t)}}),c.onPeerJoin(t),null===(n=e.drainEarlyData)||void 0===n||n.call(e,(function(e){return g(t,e)})))})),C((function(e,t){return k("",t)})),x((function(e,t){var n;null===(n=o[t])||void 0===n||n.call(o),delete o[t]})),A((function(e,t){var n;return null===(n=r[t])||void 0===n?void 0:n.signal(e)})),D((function(e,t){return s[t]=e})),H((function(e,t){return u[t]=e})),X((function(e,t){return y(t)})),{makeAction:m,ping:function(e){return(0,E.default)((function(){var t;return(0,M.__generator)(this,(function(n){switch(n.label){case 0:if(!e)throw V("ping() must be called with target peer ID");return t=Date.now(),w("",e),[4,new Promise((function(t){return o[e]=t}))];case 1:return[2,(n.sent(),Date.now()-t)]}}))}))()},leave:function(){return(0,E.default)((function(){return(0,M.__generator)(this,(function(e){switch(e.label){case 0:return[4,G("")];case 1:return e.sent(),[4,new Promise((function(e){return setTimeout(e,99)}))];case 2:return e.sent(),Y(r).forEach((function(e){var t=(0,O.default)(e,2),n=t[0];t[1].destroy(),delete r[n]})),n(),[2]}}))}))()},getPeers:function(){return J(Y(r).map((function(e){var t=(0,O.default)(e,2);return[t[0],t[1].connection]})))},addStream:function(e,t,n){return l(t,function(){var t=(0,E.default)((function(t,r){return(0,M.__generator)(this,(function(i){switch(i.label){case 0:return n?[4,P(n,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r.addStream(e),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}())},removeStream:function(e,t){return l(t,(function(t,n){return n.removeStream(e)}))},addTrack:function(e,t,n,r){return l(n,function(){var n=(0,E.default)((function(n,i){return(0,M.__generator)(this,(function(a){switch(a.label){case 0:return r?[4,W(r,n)]:[3,2];case 1:a.sent(),a.label=2;case 2:return i.addTrack(e,t),[2]}}))}));return function(e,t){return n.apply(this,arguments)}}())},removeTrack:function(e,t,n){return l(n,(function(n,r){return r.removeTrack(e,t)}))},replaceTrack:function(e,t,n,r,i){return l(r,function(){var r=(0,E.default)((function(r,a){return(0,M.__generator)(this,(function(o){switch(o.label){case 0:return i?[4,W(i,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return a.replaceTrack(e,t,n),[2]}}))}));return function(e,t){return r.apply(this,arguments)}}())},onPeerJoin:function(e){return c.onPeerJoin=e},onPeerLeave:function(e){return c.onPeerLeave=e},onPeerStream:function(e){return c.onPeerStream=e},onPeerTrack:function(e){return c.onPeerTrack=e}}}(0,(function(e){return delete y[e]}),(function(){delete an[a][t],$.forEach(clearTimeout),G.forEach(function(){var e=(0,E.default)((function(e){return(0,M.__generator)(this,(function(t){switch(t.label){case 0:return[4,e];case 1:return[2,t.sent()()]}}))}));return function(t){return e.apply(this,arguments)}}()),clearInterval(en)}))}),Nn=(sn=mn,["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.files.fm:7073/announce","tracker.btorrent.xyz"].map((function(e){return"wss://"+e})))}))}();