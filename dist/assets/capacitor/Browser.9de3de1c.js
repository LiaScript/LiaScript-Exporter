function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n=t.parcelRequire55a5;n.register("bH3SQ",(function(t,r){e(t.exports,"Connector",(function(){return u}));var i=n("4ekS1"),o=n("6Ndrt"),a=n("jXXgq");class u extends a.Connector{hasIndex(){return!0}async open(e,t,n){return await this.database.open(e,t,{table:"code",id:n})}load(e){return this.database.load(e)}store(e){return this.database.store(e)}update(e,t){this.database.transaction(e,t)}slide(e){this.database.slide(e)}async getIndex(){return await this.database.listIndex()}deleteFromIndex(e){this.database.deleteIndex(e)}async storeToIndex(e){return this.database.storeIndex(e)}restoreFromIndex(e,t){return this.database.restore(e,t)}async reset(e,t){e&&t&&(await this.database.reset(e,t),i.default.info("DB: reset => ",e,t))}getFromIndex(e){return this.database.getIndex(e)}async addMisc(e,t,n,r){this.database.addMisc(e,t,n,r)}async getMisc(e,t,n){return this.database.getMisc(e,t,n)}constructor(){super(),this.database=new o.LiaDB}}})),n.register("6Ndrt",(function(t,r){e(t.exports,"LiaDB",(function(){return a}));var i=n("kxHmC"),o=n("4ekS1");class a{open_(e){let t=new(0,i.default)(e);return t.version(1).stores({code:"[id+version], version",quiz:"[id+version], version",survey:"[id+version], version",task:"[id+version], version",offline:"[id+version], version"}),t}async open(e,t,n){this.version=t,this.db=this.open_(e);try{await this.db.open()}catch(e){o.default.warn("DB: open -> ",e.message),this.db=null}if(n&&this.db)return await this.db[n.table].get({id:n.id,version:t})}async store(e,t){this.db&&0!==this.version&&(o.default.warn(`liaDB: event(store), table(${e.table}), id(${e.id}), data(${e.data})`),await this.db[e.table].put({id:e.id,version:null!=t?t:this.version,data:e.data,created:(new Date).getTime()}))}async load(e,t){if(!this.db)return;o.default.info("loading => ",e.table,e.id);const n=await this.db[e.table].get({id:e.id,version:null!=t?t:this.version});return n?(o.default.info("restore table",e.table),n.data):null}async slide(e){try{let t=await this.db.offline.get({id:0,version:this.version});t.data.section_active=e,await this.db.offline.put(t)}catch(t){o.default.warn("DB: could not update slide => ",e)}}async transaction(e,t){if(!this.db||0===this.version)return;let n=this.db;await n.transaction("rw",n[e.table],(async()=>{const r=await n[e.table].get({id:e.id,version:this.version});r.data&&(r.data=t(r.data),await n[e.table].put(r))}))}async restore(e,t){if(await this.dbIndex.courses.get(e)){let n=this.open_(e);const r=await n.offline.get({id:0,version:null!=t?t:this.version});return void 0===r?null:r.data}}async getIndex(e){try{return await this.dbIndex.courses.get(e)}catch(e){o.default.warn("DB: getIndex -> ",e.message)}return null}async listIndex(e="updated",t=!1){const n=await this.dbIndex.courses.orderBy(e).toArray();return t||n.reverse(),n}async storeIndex(e){if(!this.dbIndex.isOpen())return void o.default.warn("DB: storeIndex ... db is closed");const t=new Date;let n=await this.dbIndex.courses.get(e.readme);if(n||(n={id:e.readme,title:e.definition.str_title,author:e.definition.author,created:t.getTime(),updated:null,updated_str:null,data:{}}),n.updated=t.getTime(),n.updated_str=t.toLocaleDateString(),n.data[e.version]){if(n.data[e.version].version!==e.definition.version){n.data[e.version]=e.definition,n.data[e.version].title=e.title,o.default.info("storing new version to index",n);let r=this.open_(e.readme);await r.open(),await r.offline.put({id:0,version:e.version,data:e,created:t.getTime(),misc:{}})}}else n.data[e.version]=e.definition,n.data[e.version].title=e.title,o.default.info("storing new version to index",n),await this.db.offline.put({id:0,version:e.version,data:e,created:t.getTime(),misc:{}});this.dbIndex.courses.put(n).then((function(e){o.default.info("DB: storeIndex",e)}))}async addMisc(e,t,n,r){const i=this.open_(e);await i.open(),await i.transaction("rw",i.offline,(async()=>{let e=await i.offline.get({id:0,version:t||this.version});e&&(e.misc[n]=r,await i.offline.put(e))}))}async getMisc(e,t,n){const r=this.open_(e);await r.open();const i=await r.offline.get({id:0,version:t||this.version});return n?null==i?void 0:i.misc[n]:null==i?void 0:i.misc}async deleteIndex(e){await Promise.all([this.dbIndex.courses.delete(e),i.default.delete(e)])}async reset(e,t){const n=this.open_(e);await n.open(),await Promise.all([n.code.where("version").equals(t).delete(),n.quiz.where("version").equals(t).delete(),n.survey.where("version").equals(t).delete(),n.task.where("version").equals(t).delete()])}constructor(){this.dbIndex=new(0,i.default)("Index"),this.dbIndex.version(1).stores({courses:"&id,updated,author,created,title"}),this.version=0}}})),n.register("kxHmC",(function(n,r){e(n.exports,"default",(function(){return dr}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};function a(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:t,s=Object.keys,c=Array.isArray;function l(e,t){return"object"!=typeof t||s(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||u.Promise||(u.Promise=Promise);var f=Object.getPrototypeOf,d={}.hasOwnProperty;function h(e,t){return d.call(e,t)}function p(e,t){"function"==typeof t&&(t=t(f(e))),("undefined"==typeof Reflect?s:Reflect.ownKeys)(t).forEach((function(n){v(e,n,t[n])}))}var y=Object.defineProperty;function v(e,t,n,r){y(e,t,l(n&&h(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function m(e){return{from:function(t){return e.prototype=Object.create(t.prototype),v(e.prototype,"constructor",e),{extend:p.bind(null,e.prototype)}}}}var b=Object.getOwnPropertyDescriptor;function g(e,t){var n;return b(e,t)||(n=f(e))&&g(n,t)}var w=[].slice;function _(e,t,n){return w.call(e,t,n)}function x(e,t){return t(e)}function k(e){if(!e)throw new Error("Assertion Failed")}function O(e){u.setImmediate?setImmediate(e):setTimeout(e,0)}function P(e,t){if("string"==typeof t&&h(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=P(e,t[r]);n.push(o)}return n}var a=t.indexOf(".");if(-1!==a){var u=e[t.substr(0,a)];return null==u?void 0:P(u,t.substr(a+1))}}function S(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){k("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)S(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var a=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?c(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var s=e[a];s&&h(e,a)||(s=e[a]={}),S(s,u,n)}}else void 0===n?c(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function E(e){var t={};for(var n in e)h(e,n)&&(t[n]=e[n]);return t}var K=[].concat;function I(e){return K.apply([],e)}var j="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(I([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return u[e]})),D=new Set(j.map((function(e){return u[e]})));function C(e){var t={};for(var n in e)if(h(e,n)){var r=e[n];t[n]=!r||"object"!=typeof r||D.has(r.constructor)?r:C(r)}return t}var A=null;function B(e){A=new WeakMap;var t=T(e);return A=null,t}function T(e){if(!e||"object"!=typeof e)return e;var t=A.get(e);if(t)return t;if(c(e)){t=[],A.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(T(e[n]))}else if(D.has(e.constructor))t=e;else{var i=f(e);for(var o in t=i===Object.prototype?{}:Object.create(i),A.set(e,t),e)h(e,o)&&(t[o]=T(e[o]))}return t}var q={}.toString;function R(e){return q.call(e).slice(8,-1)}var M="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",F="symbol"==typeof M?function(e){var t;return null!=e&&(t=e[M])&&t.apply(e)}:function(){return null};function N(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var L={};function U(e){var t,n,r,i;if(1===arguments.length){if(c(e))return e.slice();if(this===L&&"string"==typeof e)return[e];if(i=F(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var z="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},V=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],$=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(V),W={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Y(e,t){this.name=e,this.message=t}function X(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}function Q(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=X(e,t)}function G(e,t){this.name="BulkError",this.failures=Object.keys(t).map((function(e){return t[e]})),this.failuresByPos=t,this.message=X(e,this.failures)}m(Y).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(Q).from(Y),m(G).from(Y);var H=$.reduce((function(e,t){return e[t]=t+"Error",e}),{}),J=Y,Z=$.reduce((function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=W[t]||n,this.inner=null)}return m(r).from(J),e[t]=r,e}),{});Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError;var ee=V.reduce((function(e,t){return e[t+"Error"]=Z[t],e}),{}),te=$.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Z[t]),e}),{});function ne(){}function re(e){return e}function ie(e,t){return null==e||e===re?t:function(n){return t(e(n))}}function oe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ae(e,t){return e===ne?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?oe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?oe(i,this.onerror):i),void 0!==o?o:n}}function ue(e,t){return e===ne?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?oe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?oe(r,this.onerror):r)}}function se(e,t){return e===ne?t:function(n){var r=e.apply(this,arguments);l(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?oe(i,this.onsuccess):i),o&&(this.onerror=this.onerror?oe(o,this.onerror):o),void 0===r?void 0===a?void 0:a:l(r,a)}}function ce(e,t){return e===ne?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function le(e,t){return e===ne?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return t.apply(r,o)}))}return t.apply(this,arguments)}}te.ModifyError=Q,te.DexieError=Y,te.BulkError=G;var fe="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function de(e,t){fe=e}var he={},pe=100,ye="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,f(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,f(t),e]}(),ve=ye[0],me=ye[1],be=ye[2],ge=me&&me.then,we=ve&&ve.constructor,_e=!!be,xe=function(e,t){je.push([e,t]),Oe&&(queueMicrotask(Le),Oe=!1)},ke=!0,Oe=!0,Pe=[],Se=[],Ee=re,Ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ne,pgp:!1,env:{},finalize:ne},Ie=Ke,je=[],De=0,Ce=[];function Ae(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Ie;if("function"!=typeof e){if(e!==he)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Re(this,this._value))}this._state=null,this._value=null,++t.ref,qe(this,e)}var Be={get:function(){var e=Ie,t=He;function n(n,r){var i=this,o=!e.global&&(e!==Ie||t!==He),a=o&&!tt(),u=new Ae((function(t,u){Fe(i,new Te(st(n,e,o,a),st(r,e,o,a),t,u,e))}));return this._consoleTask&&(u._consoleTask=this._consoleTask),u}return n.prototype=he,n},set:function(e){v(this,"then",e&&e.prototype===he?Be:{get:function(){return e},set:Be.set})}};function Te(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function qe(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ue();t&&"function"==typeof t.then?qe(e,(function(e,n){t instanceof Ae?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Me(e)),n&&ze()}}),Re.bind(null,e))}catch(t){Re(e,t)}}function Re(e,t){if(Se.push(t),null===e._state){var n=e._lib&&Ue();t=Ee(t),e._state=!1,e._value=t,function(e){Pe.some((function(t){return t._value===e._value}))||Pe.push(e)}(e),Me(e),n&&ze()}}function Me(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Fe(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===De&&(++De,xe((function(){0==--De&&Ve()}),[]))}function Fe(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++De,xe(Ne,[n,e,t])}else e._listeners.push(t)}function Ne(e,t,n){try{var r,i=t._value;!t._state&&Se.length&&(Se=[]),r=fe&&t._consoleTask?t._consoleTask.run((function(){return e(i)})):e(i),t._state||-1!==Se.indexOf(i)||function(e){for(var t=Pe.length;t;)if(Pe[--t]._value===e._value)return void Pe.splice(t,1)}(t),n.resolve(r)}catch(e){n.reject(e)}finally{0==--De&&Ve(),--n.psd.ref||n.psd.finalize()}}function Le(){ut(Ke,(function(){Ue()&&ze()}))}function Ue(){var e=ke;return ke=!1,Oe=!1,e}function ze(){var e,t,n;do{for(;je.length>0;)for(e=je,je=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(je.length>0);ke=!0,Oe=!0}function Ve(){var e=Pe;Pe=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ce.slice(0),n=t.length;n;)t[--n]()}function $e(e){return new Ae(he,!1,e)}function We(e,t){var n=Ie;return function(){var r=Ue(),i=Ie;try{return ot(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ot(i,!1),r&&ze()}}}p(Ae.prototype,{then:Be,_then:function(e,t){Fe(this,new Te(null,null,e,t,Ie))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(function(e){return e instanceof t?n(e):$e(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):$e(e)}))},finally:function(e){return this.then((function(t){return Ae.resolve(e()).then((function(){return t}))}),(function(t){return Ae.resolve(e()).then((function(){return $e(t)}))}))},timeout:function(e,t){var n=this;return e<1/0?new Ae((function(r,i){var o=setTimeout((function(){return i(new Z.Timeout(t))}),e);n.then(r,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&v(Ae.prototype,Symbol.toStringTag,"Dexie.Promise"),Ke.env=at(),p(Ae,{all:function(){var e=U.apply(null,arguments).map(nt);return new Ae((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(i,o){return Ae.resolve(i).then((function(n){e[o]=n,--r||t(e)}),n)}))}))},resolve:function(e){return e instanceof Ae?e:e&&"function"==typeof e.then?new Ae((function(t,n){e.then(t,n)})):new Ae(he,!0,e)},reject:$e,race:function(){var e=U.apply(null,arguments).map(nt);return new Ae((function(t,n){e.map((function(e){return Ae.resolve(e).then(t,n)}))}))},PSD:{get:function(){return Ie},set:function(e){return Ie=e}},totalEchoes:{get:function(){return He}},newPSD:Ze,usePSD:ut,scheduler:{get:function(){return xe},set:function(e){xe=e}},rejectionMapper:{get:function(){return Ee},set:function(e){Ee=e}},follow:function(e,t){return new Ae((function(n,r){return Ze((function(t,n){var r=Ie;r.unhandleds=[],r.onunhandled=n,r.finalize=oe((function(){var e=this;!function(e){Ce.push((function t(){e(),Ce.splice(Ce.indexOf(t),1)})),++De,xe((function(){0==--De&&Ve()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}}),we&&(we.allSettled&&v(Ae,"allSettled",(function(){var e=U.apply(null,arguments).map(nt);return new Ae((function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach((function(e,i){return Ae.resolve(e).then((function(e){return r[i]={status:"fulfilled",value:e}}),(function(e){return r[i]={status:"rejected",reason:e}})).then((function(){return--n||t(r)}))}))}))})),we.any&&"undefined"!=typeof AggregateError&&v(Ae,"any",(function(){var e=U.apply(null,arguments).map(nt);return new Ae((function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach((function(e,o){return Ae.resolve(e).then((function(e){return t(e)}),(function(e){i[o]=e,--r||n(new AggregateError(i))}))}))}))})),we.withResolvers&&(Ae.withResolvers=we.withResolvers));var Ye={awaits:0,echoes:0,id:0},Xe=0,Qe=[],Ge=0,He=0,Je=0;function Ze(e,t,n,r){var i=Ie,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Je,Ke.env,o.env=_e?{Promise:Ae,PromiseProp:{value:Ae,configurable:!0,writable:!0},all:Ae.all,race:Ae.race,allSettled:Ae.allSettled,any:Ae.any,resolve:Ae.resolve,reject:Ae.reject}:{},t&&l(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=ut(o,e,n,r);return 0===o.ref&&o.finalize(),a}function et(){return Ye.id||(Ye.id=++Xe),++Ye.awaits,Ye.echoes+=pe,Ye.id}function tt(){return!!Ye.awaits&&(0==--Ye.awaits&&(Ye.id=0),Ye.echoes=Ye.awaits*pe,!0)}function nt(e){return Ye.echoes&&e&&e.constructor===we?(et(),e.then((function(e){return tt(),e}),(function(e){return tt(),lt(e)}))):e}function rt(e){++He,Ye.echoes&&0!=--Ye.echoes||(Ye.echoes=Ye.awaits=Ye.id=0),Qe.push(Ie),ot(e,!0)}function it(){var e=Qe[Qe.length-1];Qe.pop(),ot(e,!1)}function ot(e,t){var n=Ie;if((t?!Ye.echoes||Ge++&&e===Ie:!Ge||--Ge&&e===Ie)||queueMicrotask(t?rt.bind(null,e):it),e!==Ie&&(Ie=e,n===Ke&&(Ke.env=at()),_e)){var r=Ke.env.Promise,i=e.env;(n.global||e.global)&&(Object.defineProperty(u,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function at(){var e=u.Promise;return _e?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(u,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ut(e,t,n,r,i){var o=Ie;try{return ot(e,!0),t(n,r,i)}finally{ot(o,!1)}}function st(e,t,n,r){return"function"!=typeof e?e:function(){var i=Ie;n&&et(),ot(t,!0);try{return e.apply(this,arguments)}finally{ot(i,!1),r&&queueMicrotask(tt)}}}function ct(e){Promise===we&&0===Ye.echoes?0===Ge?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+ge).indexOf("[native code]")&&(et=tt=ne);var lt=Ae.reject;function ft(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Ie.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===H.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then((function(){return ft(e,t,n,r)}))):lt(i)}return i._promise(t,(function(e,t){return Ze((function(){return Ie.trans=i,r(e,t,i)}))})).then((function(e){if("readwrite"===t)try{i.idbtrans.commit()}catch(e){}return"readonly"===t?e:i._completion.then((function(){return e}))}))}if(e._state.openComplete)return lt(new Z.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return lt(new Z.DatabaseClosed);e.open().catch(ne)}return e._state.dbReadyPromise.then((function(){return ft(e,t,n,r)}))}var dt="4.2.1",ht=String.fromCharCode(65535),pt=-1/0,yt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",vt="String expected.",mt=[],bt="__dbnames",gt="readonly",wt="readwrite";function _t(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var xt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function kt(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=B(t))[e],t}}function Ot(){throw Z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Pt(e,t){try{var n=St(e),r=St(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}(Et(e),Et(t));case"Array":return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var a=Pt(e[o],t[o]);if(0!==a)return a}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function St(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=R(e);return"ArrayBuffer"===n?"binary":n}function Et(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Kt(e,t,n){var r=e.schema.yProps;return r?(t&&n.numFailures>0&&(t=t.filter((function(e,t){return!n.failures[t]}))),Promise.all(r.map((function(n){var r=n.updatesTable;return t?e.db.table(r).where("k").anyOf(t).delete():e.db.table(r).clear()}))).then((function(){return n}))):n}var It=function(){function e(e){this["@@propmod"]=e}return e.prototype.execute=function(e){var t,n=this["@@propmod"];if(void 0!==n.add){var r=n.add;if(c(r))return a(a([],c(e)?e:[],!0),r,!0).sort();if("number"==typeof r)return(Number(e)||0)+r;if("bigint"==typeof r)try{return BigInt(e)+r}catch(e){return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(void 0!==n.remove){var i=n.remove;if(c(i))return c(e)?e.filter((function(e){return!i.includes(e)})).sort():[];if("number"==typeof i)return Number(e)-i;if("bigint"==typeof i)try{return BigInt(e)-i}catch(e){return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}var o=null===(t=n.replacePrefix)||void 0===t?void 0:t[0];return o&&"string"==typeof e&&e.startsWith(o)?n.replacePrefix[1]+e.substring(o.length):e},e}();function jt(e,t){for(var n=s(t),r=n.length,i=!1,o=0;o<r;++o){var a=n[o],u=t[a],c=P(e,a);u instanceof It?(S(e,a,u.execute(c)),i=!0):c!==u&&(S(e,a,u),i=!0)}return i}var Dt=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||Ie.trans,i=this.name,o=fe&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function a(e,n,r){if(!r.schema[i])throw new Z.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var u=Ue();try{var s=r&&r.db._novip===this.db._novip?r===Ie.trans?r._promise(e,a,n):Ze((function(){return r._promise(e,a,n)}),{trans:r,transless:Ie.transless||Ie}):ft(this.db,e,[this.name],a);return o&&(s._consoleTask=o,s=s.catch((function(e){return console.trace(e),lt(e)}))),s}finally{u&&ze()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?lt(new Z.Type("Invalid argument to Table.get()")):this._trans("readonly",(function(t){return n.core.get({trans:t,key:e}).then((function(e){return n.hook.reading.fire(e)}))})).then(t)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(c(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=s(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){if(e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1})).sort((function(e,t){return e.keyPath.length-t.keyPath.length}))[0];if(n&&this.db._maxKey!==ht){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map((function(t){return e[t]})))}!n&&fe&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function o(e,t){return 0===Pt(e,t)}var a=t.reduce((function(t,n){var r=t[0],a=t[1],u=i[n],s=e[n];return[r||u,r||!u?_t(a,u&&u.multi?function(e){var t=P(e,n);return c(t)&&t.some((function(e){return o(s,e)}))}:function(e){return o(s,P(e,n))}):a]}),[null,null]),u=a[0],l=a[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,c(e)?"[".concat(e.join("+"),"]"):e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var t=this.db,n=this.name;this.schema.mappedClass=e,e.prototype instanceof Ot&&(e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(r,e),Object.defineProperty(r.prototype,"db",{get:function(){return t},enumerable:!1,configurable:!0}),r.prototype.table=function(){return n},r}(e));for(var r=new Set,o=e.prototype;o;o=f(o))Object.getOwnPropertyNames(o).forEach((function(e){return r.add(e)}));var a=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var i in t)if(!r.has(i))try{n[i]=t[i]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},e.prototype.defineClass=function(){return this.mapToClass((function(e){l(this,e)}))},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=kt(o)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[a]})})).then((function(e){return e.numFailures?Ae.reject(e.failures[0]):e.lastResult})).then((function(t){if(o)try{S(e,o,t)}catch(e){}return t}))},e.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",(function(i){return n.core.get({trans:i,key:e}).then((function(o){var a=null!=o?o:{};return jt(a,t),r&&S(a,r,e),n.core.mutate({trans:i,type:"put",values:[a],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then((function(e){return e.numFailures?Ae.reject(e.failures[0]):!!o}))}))}))},e.prototype.update=function(e,t){if("object"!=typeof e||c(e))return this.where(":id").equals(e).modify(t);var n=P(e,this.schema.primKey.keyPath);return void 0===n?lt(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=kt(o)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"put",values:[a],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Ae.reject(e.failures[0]):e.lastResult})).then((function(t){if(o)try{S(e,o,t)}catch(e){}return t}))},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then((function(n){return Kt(t,[e],n)})).then((function(e){return e.numFailures?Ae.reject(e.failures[0]):void 0}))}))},e.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:xt}).then((function(t){return Kt(e,null,t)}))})).then((function(e){return e.numFailures?Ae.reject(e.failures[0]):void 0}))},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(n){return t.core.getMany({keys:e,trans:n}).then((function(e){return e.map((function(e){return t.hook.reading.fire(e)}))}))}))},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,a=n.auto,u=n.keyPath;if(u&&i)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(kt(u)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:c,wantResults:o}).then((function(e){var t=e.numFailures,n=e.results,i=e.lastResult,a=e.failures;if(0===t)return o?n:i;throw new G("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(s," operations failed"),a)}))}))},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,a=n.auto,u=n.keyPath;if(u&&i)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(kt(u)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:c,wantResults:o}).then((function(e){var t=e.numFailures,n=e.results,i=e.lastResult,a=e.failures;if(0===t)return o?n:i;throw new G("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(s," operations failed"),a)}))}))},e.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map((function(e){return e.key})),i=e.map((function(e){return e.changes})),o=[];return this._trans("readwrite",(function(a){return n.getMany({trans:a,keys:r,cache:"clone"}).then((function(u){var s=[],c=[];e.forEach((function(e,n){var r=e.key,i=e.changes,a=u[n];if(a){for(var l=0,f=Object.keys(i);l<f.length;l++){var d=f[l],h=i[d];if(d===t.schema.primKey.keyPath){if(0!==Pt(h,r))throw new Z.Constraint("Cannot update primary key in bulkUpdate()")}else S(a,d,h)}o.push(n),s.push(r),c.push(a)}}));var l=s.length;return n.mutate({trans:a,type:"put",keys:s,values:c,updates:{keys:r,changeSpecs:i}}).then((function(e){var n=e.numFailures,r=e.failures;if(0===n)return l;for(var i=0,a=Object.keys(r);i<a.length;i++){var u=a[i],s=o[Number(u)];if(null!=s){var c=r[u];delete r[u],r[s]=c}}throw new G("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(l," operations failed"),r)}))}))}))},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:e}).then((function(n){return Kt(t,e,n)}))})).then((function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new G("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),o)}))},e}();function Ct(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"==typeof n)return t[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(e,r,i){if("object"!=typeof e){var a;r||(r=ce),i||(i=ne);var u={subscribers:[],fire:i,subscribe:function(e){-1===u.subscribers.indexOf(e)&&(u.subscribers.push(e),u.fire=r(u.fire,e))},unsubscribe:function(e){u.subscribers=u.subscribers.filter((function(t){return t!==e})),u.fire=u.subscribers.reduce(r,i)}};return t[e]=n[e]=u,u}s(a=e).forEach((function(e){var t=a[e];if(c(t))o(e,a[e][0],a[e][1]);else{if("asap"!==t)throw new Z.InvalidArgument("Invalid event config");var n=o(e,re,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){O((function(){e.apply(null,t)}))}))}))}}))}}function At(e,t){return m(t).from({prototype:e}),t}function Bt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Tt(e,t){e.filter=_t(e.filter,t)}function qt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return _t(r(),t())}:t,e.justLimit=n&&!r}function Rt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new Z.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Mt(e,t,n){var r=Rt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ft(e,t,n,r){var i=e.replayFilter?_t(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},a=function(e,n,r){if(!i||i(n,r,(function(e){return n.stop(e)}),(function(e){return n.fail(e)}))){var a=n.primaryKey,u=""+a;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(a)),h(o,u)||(o[u]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(a,n),Nt(Mt(e,r,n),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return Nt(Mt(e,r,n),_t(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Nt(e,t,n,r){var i=We(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then((function(e){if(e)return e.start((function(){var n=function(){return e.continue()};t&&!t(e,(function(e){return n=e}),(function(t){e.stop(t),n=ne}),(function(t){e.fail(t),n=ne}))||i(e.value,e,(function(e){return n=e})),n()}))}))}var Lt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,lt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,lt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=_t(t.algorithm,e)},e.prototype._iterate=function(e,t){return Ft(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&l(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read((function(n){return Ft(t,e,n,t.table.core)}))},e.prototype.count=function(e){var t=this;return this._read((function(e){var n=t._ctx,r=n.table.core;if(Bt(n,!0))return r.count({trans:e,query:{index:Rt(n,r.schema),range:n.range}}).then((function(e){return Math.min(e,n.limit)}));var i=0;return Ft(n,(function(){return++i,!1}),e,r).then((function(){return i}))})).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var a="next"===this._ctx.dir?1:-1;function u(e,t){return Pt(o(e,i),o(t,i))*a}return this.toArray((function(e){return e.sort(u)})).then(t)},e.prototype.toArray=function(e){var t=this;return this._read((function(e){var n=t._ctx;if("next"===n.dir&&Bt(n,!0)&&n.limit>0){var r=n.valueMapper,i=Rt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then((function(e){var t=e.result;return r?t.map(r):t}))}var o=[];return Ft(n,(function(e){return o.push(e)}),e,n.table.core).then((function(){return o}))}),e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Bt(t)?qt(t,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):qt(t,(function(){var t=e;return function(){return--t<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),qt(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},e.prototype.until=function(e,t){return Tt(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var t,n;return Tt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=_t(t.isMatch,n),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Bt(t,!0)&&t.limit>0)return this._read((function(e){var n=Rt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Tt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=h(n,t);return n[t]=!0,!r})),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(r){var i;i="function"==typeof e?e:function(t){return jt(t,e)};var o=n.table.core,a=o.schema.primaryKey,u=a.outbound,c=a.extractKey,l=200,f=t.db._options.modifyChunkSize;f&&(l="object"==typeof f?f[o.name]||f["*"]||200:f);var d=[],h=0,p=[],y=function(e,t){var n=t.failures,r=t.numFailures;h+=e-r;for(var i=0,o=s(n);i<o.length;i++){var a=o[i];d.push(n[a])}},v=e===Ut;return t.clone().primaryKeys().then((function(t){var a=Bt(n)&&n.limit===1/0&&("function"!=typeof e||v)&&{index:n.index,range:n.range},s=function(f){var d=Math.min(l,t.length-f),h=t.slice(f,f+d);return(v?Promise.resolve([]):o.getMany({trans:r,keys:h,cache:"immutable"})).then((function(p){var m=[],b=[],g=u?[]:null,w=v?h:[];if(!v)for(var _=0;_<d;++_){var x=p[_],k={value:B(x),primKey:t[f+_]};!1!==i.call(k,k.value,k)&&(null==k.value?w.push(t[f+_]):u||0===Pt(c(x),c(k.value))?(b.push(k.value),u&&g.push(t[f+_])):(w.push(t[f+_]),m.push(k.value)))}return Promise.resolve(m.length>0&&o.mutate({trans:r,type:"add",values:m}).then((function(e){for(var t in e.failures)w.splice(parseInt(t),1);y(m.length,e)}))).then((function(){return(b.length>0||a&&"object"==typeof e)&&o.mutate({trans:r,type:"put",keys:g,values:b,criteria:a,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:f>0}).then((function(e){return y(b.length,e)}))})).then((function(){return(w.length>0||a&&v)&&o.mutate({trans:r,type:"delete",keys:w,criteria:a,isAdditionalChunk:f>0}).then((function(e){return Kt(n.table,w,e)})).then((function(e){return y(w.length,e)}))})).then((function(){return t.length>f+d&&s(f+l)}))}))};return s(0).then((function(){if(d.length>0)throw new Q("Error modifying one or more objects",d,h,p);return t.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,t=e.range;return!Bt(e)||e.table.schema.yProps||!e.isPrimKey&&3!==t.type?this.modify(Ut):this._write((function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((function(e){var n=e.failures,r=e.numFailures;if(r)throw new Q("Could not delete some values",Object.keys(n).map((function(e){return n[e]})),t-r);return t-r}))}))}))},e}(),Ut=function(e,t){return t.value=null};function zt(e,t){return e<t?-1:e===t?0:1}function Vt(e,t){return e>t?-1:e===t?0:1}function $t(e,t,n){var r=e instanceof Ht?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Wt(e){return new e.Collection(e,(function(){return Gt("")})).limit(0)}function Yt(e,t,n,r,i,o){for(var a=Math.min(e.length,r.length),u=-1,s=0;s<a;++s){var c=t[s];if(c!==r[s])return i(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):u>=0?e.substr(0,u)+t[u]+n.substr(u+1):null;i(e[s],c)<0&&(u=s)}return a<r.length&&"next"===o?e+n.substr(e.length):a<e.length&&"prev"===o?e.substr(0,n.length):u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function Xt(e,t,n,r){var i,o,a,u,s,c,l,f=n.length;if(!n.every((function(e){return"string"==typeof e})))return $t(e,vt);function d(e){i=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),o=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),a="next"===e?zt:Vt;var t=n.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,t){return a(e.lower,t.lower)}));u=t.map((function(e){return e.upper})),s=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}d("next");var h=new e.Collection(e,(function(){return Qt(u[0],s[f-1]+r)}));h._ondirectionchange=function(e){d(e)};var p=0;return h._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var d=o(i);if(t(d,s,p))return!0;for(var h=null,y=p;y<f;++y){var v=Yt(i,d,u[y],s[y],a,c);null===v&&null===h?p=y+1:(null===h||a(h,v)>0)&&(h=v)}return n(null!==h?function(){e.continue(h+l)}:r),!1})),h}function Qt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Gt(e){return{type:1,lower:e,upper:e}}var Ht=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Wt(this):new this.Collection(this,(function(){return Qt(e,t,!n,!r)}))}catch(e){return $t(this,yt)}},e.prototype.equals=function(e){return null==e?$t(this,yt):new this.Collection(this,(function(){return Gt(e)}))},e.prototype.above=function(e){return null==e?$t(this,yt):new this.Collection(this,(function(){return Qt(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?$t(this,yt):new this.Collection(this,(function(){return Qt(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?$t(this,yt):new this.Collection(this,(function(){return Qt(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?$t(this,yt):new this.Collection(this,(function(){return Qt(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!=typeof e?$t(this,vt):this.between(e,e+ht,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):Xt(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],ht)},e.prototype.equalsIgnoreCase=function(e){return Xt(this,(function(e,t){return e===t[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=U.apply(L,arguments);return 0===e.length?Wt(this):Xt(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=U.apply(L,arguments);return 0===e.length?Wt(this):Xt(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,ht)},e.prototype.anyOf=function(){var e=this,t=U.apply(L,arguments),n=this._cmp;try{t.sort(n)}catch(e){return $t(this,yt)}if(0===t.length)return Wt(this);var r=new this.Collection(this,(function(){return Qt(t[0],t[t.length-1])}));r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm((function(e,r,o){for(var a=e.key;n(a,t[i])>0;)if(++i===t.length)return r(o),!1;return 0===n(a,t[i])||(r((function(){e.continue(t[i])})),!1)})),r},e.prototype.notEqual=function(e){return this.inAnyRange([[pt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=U.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return $t(this,yt)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[pt,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,a=this._min,u=this._max;if(0===e.length)return Wt(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0})))return $t(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var s,c=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers,f=i;function d(e,t){return f(e[0],t[0])}try{s=e.reduce((function(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=a(o[0],t[0]),o[1]=u(o[1],t[1]);break}}return n===i&&e.push(t),e}),[]),s.sort(d)}catch(e){return $t(this,yt)}var h=0,p=l?function(e){return i(e,s[h][1])>0}:function(e){return i(e,s[h][1])>=0},y=c?function(e){return o(e,s[h][0])>0}:function(e){return o(e,s[h][0])>=0},v=p,m=new this.Collection(this,(function(){return Qt(s[0][0],s[s.length-1][1],!c,!l)}));return m._ondirectionchange=function(e){"next"===e?(v=p,f=i):(v=y,f=o),s.sort(d)},m._addAlgorithm((function(e,t,r){for(var o=e.key;v(o);)if(++h===s.length)return t(r),!1;return!!function(e){return!p(e)&&!y(e)}(o)||(0===n._cmp(o,s[h][1])||0===n._cmp(o,s[h][0])||t((function(){f===i?e.continue(s[h][0]):e.continue(s[h][1])})),!1)})),m},e.prototype.startsWithAnyOf=function(){var e=U.apply(L,arguments);return e.every((function(e){return"string"==typeof e}))?0===e.length?Wt(this):this.inAnyRange(e.map((function(e){return[e,e+ht]}))):$t(this,"startsWithAnyOf() only works with strings")},e}();function Jt(e){return We((function(t){return Zt(t),e(t.target.error),!1}))}function Zt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var en="storagemutated",tn="x-storagemutated-1",nn=Ct(null,en),rn=function(){function e(){}return e.prototype._lock=function(){return k(!Ie.global),++this._reculock,1!==this._reculock||Ie.global||(Ie.lockOwnerFor=this),this},e.prototype._unlock=function(){if(k(!Ie.global),0==--this._reculock)for(Ie.global||(Ie.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ut(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&Ie.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(k(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(r);case"MissingAPIError":throw new Z.MissingAPI(r.message,r);default:throw new Z.OpenFailed(r)}if(!this.active)throw new Z.TransactionInactive;return k(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=We((function(n){Zt(n),t._reject(e.error)})),e.onabort=We((function(n){Zt(n),t.active&&t._reject(new Z.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=We((function(){t.active=!1,t._resolve(),"mutatedParts"in e&&nn.storagemutated.fire(e.mutatedParts)})),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return lt(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return lt(new Z.TransactionInactive);if(this._locked())return new Ae((function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},Ie])}));if(n)return Ze((function(){var e=new Ae((function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Ae((function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Ae.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return n}));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ae((function(e,r){n.then((function(n){return t._waitingQueue.push(We(e.bind(null,n)))}),(function(e){return t._waitingQueue.push(We(r.bind(null,e)))})).finally((function(){t._waitingFor===i&&(t._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Z.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(h(t,e))return t[e];var n=this.schema[e];if(!n)throw new Z.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function on(e,t,n,r,i,o,a,u){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+an(t),type:u}}function an(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function un(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=n,i=function(e){return[e.name,e]},r.reduce((function(e,t,n){var r=i(t);return r&&(e[r[0]]=r[1]),e}),{}))};var r,i}var sn=function(e){try{return e.only([[]]),sn=function(){return[[]]},[[]]}catch(e){return sn=function(){return ht},ht}};function cn(e){return null==e?function(){}:"string"==typeof e?function(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return P(t,e)}}(e):function(t){return P(t,e)}}function ln(e){return[].slice.call(e)}var fn=0;function dn(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function hn(e,t,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=function(e,t){return t.reduce((function(e,t){var n=t.create;return o(o({},e),n(e))}),e)}(function(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}var i=function(e,t){var n=ln(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((function(e){return t.objectStore(e)})).map((function(e){var t=e.keyPath,n=e.autoIncrement,r=c(t),i=null==t,o={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:cn(t)},indexes:ln(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,a={name:t,compound:c(i),keyPath:i,unique:n,multiEntry:r,extractKey:cn(i)};return o[dn(i)]=a,a})),getIndexByKeyPath:function(e){return o[dn(e)]}};return o[":id"]=a.primaryKey,null!=t&&(o[dn(t)]=a.primaryKey),a}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.schema,a=i.hasGetAll,u=o.tables.map((function(e){return function(e){var t=e.name;return{name:t,schema:e,mutate:function(e){var n=e.trans,i=e.type,o=e.keys,a=e.values,u=e.range;return new Promise((function(e,s){e=We(e);var c=n.objectStore(t),l=null==c.keyPath,f="put"===i||"add"===i;if(!f&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var d,h=(o||a||{length:1}).length;if(o&&a&&o.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],y=[],v=0,m=function(e){++v,Zt(e)};if("deleteRange"===i){if(4===u.type)return e({numFailures:v,failures:y,results:[],lastResult:void 0});3===u.type?p.push(d=c.clear()):p.push(d=c.delete(r(u)))}else{var b=f?l?[a,o]:[a,null]:[o,null],g=b[0],w=b[1];if(f)for(var _=0;_<h;++_)p.push(d=w&&void 0!==w[_]?c[i](g[_],w[_]):c[i](g[_])),d.onerror=m;else for(_=0;_<h;++_)p.push(d=c[i](g[_])),d.onerror=m}var x=function(t){var n=t.target.result;p.forEach((function(e,t){return null!=e.error&&(y[t]=e.error)})),e({numFailures:v,failures:y,results:"delete"===i?o:p.map((function(e){return e.result})),lastResult:n})};d.onerror=function(e){m(e),x(e)},d.onsuccess=x}))},getMany:function(e){var n=e.trans,r=e.keys;return new Promise((function(e,i){e=We(e);for(var o,a=n.objectStore(t),u=r.length,s=new Array(u),c=0,l=0,f=function(t){var n=t.target;s[n._pos]=n.result,++l===c&&e(s)},d=Jt(i),h=0;h<u;++h)null!=r[h]&&((o=a.get(r[h]))._pos=h,o.onsuccess=f,o.onerror=d,++c);0===c&&e(s)}))},get:function(e){var n=e.trans,r=e.key;return new Promise((function(e,i){e=We(e);var o=n.objectStore(t).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=Jt(i)}))},query:function(e){return function(n){return new Promise((function(i,o){i=We(i);var a=n.trans,u=n.values,s=n.limit,c=n.query,l=s===1/0?void 0:s,f=c.index,d=c.range,h=a.objectStore(t),p=f.isPrimaryKey?h:h.index(f.name),y=r(d);if(0===s)return i({result:[]});if(e){var v=u?p.getAll(y,l):p.getAllKeys(y,l);v.onsuccess=function(e){return i({result:e.target.result})},v.onerror=Jt(o)}else{var m=0,b=u||!("openKeyCursor"in p)?p.openCursor(y):p.openKeyCursor(y),g=[];b.onsuccess=function(e){var t=b.result;return t?(g.push(u?t.value:t.primaryKey),++m===s?i({result:g}):void t.continue()):i({result:g})},b.onerror=Jt(o)}}))}}(a),openCursor:function(e){var n=e.trans,i=e.values,o=e.query,a=e.reverse,u=e.unique;return new Promise((function(e,s){e=We(e);var c=o.index,l=o.range,f=n.objectStore(t),d=c.isPrimaryKey?f:f.index(c.name),h=a?u?"prevunique":"prev":u?"nextunique":"next",p=i||!("openKeyCursor"in d)?d.openCursor(r(l),h):d.openKeyCursor(r(l),h);p.onerror=Jt(s),p.onsuccess=We((function(t){var r=p.result;if(r){r.___id=++fn,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var a=r.advance.bind(r),u=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=We(s),r.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},r.start=function(e){var t=new Promise((function(e,t){e=We(e),p.onerror=Jt(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=u,e(t)}})),n=function(){if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=We((function(e){p.onsuccess=n,n()})),r.continue=i,r.continuePrimaryKey=o,r.advance=a,n(),t},e(r)}else e(null)}),s)}))},count:function(e){var n=e.query,i=e.trans,o=n.index,a=n.range;return new Promise((function(e,n){var u=i.objectStore(t),s=o.isPrimaryKey?u:u.index(o.name),c=r(a),l=c?s.count(c):s.count();l.onsuccess=We((function(t){return e(t.target.result)})),l.onerror=Jt(n)}))}}}(e)})),s={};return u.forEach((function(e){return s[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!s[e])throw new Error("Table '".concat(e,"' not found"));return s[e]},MIN_KEY:-1/0,MAX_KEY:sn(t),schema:o}}(t,i,r),e.dbcore);return{dbcore:a}}function pn(e,t){var n=t.db,r=hn(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((function(t){var n=t.name;e.core.schema.tables.some((function(e){return e.name===n}))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function yn(e,t,n,r){n.forEach((function(n){var i=r[n];t.forEach((function(t){var r=g(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?v(t,n,{get:function(){return this.table(n)},set:function(e){y(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function vn(e,t){t.forEach((function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]}))}function mn(e,t){return e._cfg.version-t._cfg.version}function bn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var a={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)a.recreate=!0,r.change.push(a);else{var u=i.idxByName,s=o.idxByName,c=void 0;for(c in u)s[c]||a.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([n,o])}return r}function gn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){return _n(i,e)})),i}function wn(e,t){s(e).forEach((function(n){t.db.objectStoreNames.contains(n)||(fe&&console.debug("Dexie: Creating missing table",n),gn(t,n,e[n].primKey,e[n].indexes))}))}function _n(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function xn(e,t,n){var r={};return _(t.objectStoreNames,0).forEach((function(e){for(var t=n.objectStore(e),i=t.keyPath,o=on(an(i),i||"",!0,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),a=[],u=0;u<t.indexNames.length;++u){var s=t.index(t.indexNames[u]);i=s.keyPath;var c=on(s.name,i,!!s.unique,!!s.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(c)}r[e]=un(e,o,a)})),r}function kn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var o=r[i],a=n.objectStore(o);e._hasGetAll="getAll"in a;for(var s=0;s<a.indexNames.length;++s){var c=a.indexNames[s],l=a.index(c).keyPath,f="string"==typeof l?l:"["+_(l).join("+")+"]";if(t[o]){var d=t[o].idxByName[f];d&&(d.name=c,delete t[o].idxByName[f],t[o].idxByName[c]=d)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&u.WorkerGlobalScope&&u instanceof u.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function On(e){return e.split(",").map((function(e,t){var n,r=e.split(":"),i=null===(n=r[1])||void 0===n?void 0:n.trim(),o=(e=r[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return on(o,a||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),c(a),0===t,i)}))}var Pn,Sn=function(){function e(){}return e.prototype._createTableSchema=function(e,t,n){return un(e,t,n)},e.prototype._parseIndexSyntax=function(e){return On(e)},e.prototype._parseStoresSpec=function(e,t){var n=this;s(e).forEach((function(r){if(null!==e[r]){var i=n._parseIndexSyntax(e[r]),o=i.shift();if(!o)throw new Z.Schema("Invalid schema for table "+r+": "+e[r]);if(o.unique=!0,o.multi)throw new Z.Schema("Primary key cannot be multiEntry*");i.forEach((function(e){if(e.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")}));var a=n._createTableSchema(r,o,i);t[r]=a}}))},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach((function(e){l(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,vn(t,[t._allTables,t,t.Transaction.prototype]),yn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],s(i),i),t._storeNames=s(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=le(this._cfg.contentUpgrade||ne,e),this},e}();function En(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new dr(bt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Kn(e){return e&&"function"==typeof e.databases}function In(e){return Ze((function(){return Ie.letThrough=!0,e()}))}function jn(e){return!("from"in e)}var Dn=function(e,t){if(!this){var n=new Dn;return e&&"d"in e&&l(n,e),n}l(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Cn(e,t,n){var r=Pt(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(jn(e))return l(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(Pt(n,e.from)<0)return i?Cn(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Tn(e);if(Pt(t,e.to)>0)return o?Cn(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Tn(e);Pt(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Pt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var a=!e.r;i&&!e.l&&An(e,i),o&&a&&An(e,o)}}function An(e,t){jn(t)||function e(t,n){var r=n.from,i=n.to,o=n.l,a=n.r;Cn(t,r,i),o&&e(t,o),a&&e(t,a)}(e,t)}function Bn(e){var t=jn(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Pt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Pt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Tn(e){var t,n,r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a="r"===i?"l":"r",u=o({},e),s=e[i];e.from=s.from,e.to=s.to,e[i]=s[i],u[i]=s[a],e[a]=u,u.d=qn(u)}e.d=qn(e)}function qn(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Rn(e,t){return s(t).forEach((function(n){e[n]?An(e[n],t[n]):e[n]=C(t[n])})),e}function Mn(e,t){return e.all||t.all||Object.keys(e).some((function(n){return t[n]&&function(e,t){var n=Bn(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=Bn(e),a=o.next(i.from),u=a.value;!r.done&&!a.done;){if(Pt(u.from,i.to)<=0&&Pt(u.to,i.from)>=0)return!0;Pt(i.from,u.from)<0?i=(r=n.next(u.from)).value:u=(a=o.next(i.from)).value}return!1}(t[n],e[n])}))}p(Dn.prototype,((Pn={add:function(e){return An(this,e),this},addKey:function(e){return Cn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach((function(e){return Cn(t,e,e)})),this},hasKey:function(e){var t=Bn(this).next(e).value;return t&&Pt(t.from,e)<=0&&Pt(t.to,e)>=0}})[M]=function(){return Bn(this)},Pn));var Fn={},Nn={},Ln=!1;function Un(e,t){Rn(Nn,e),Ln||(Ln=!0,setTimeout((function(){Ln=!1;var e=Nn;Nn={},zn(e,!1)}),0))}function zn(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(Fn);r<i.length;r++)Vn(u=i[r],e,n,t);else for(var o in e){var a=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(a){var u,s=a[1],c=a[2];(u=Fn["idb://".concat(s,"/").concat(c)])&&Vn(u,e,n,t)}}n.forEach((function(e){return e()}))}function Vn(e,t,n,r){for(var i=[],o=0,a=Object.entries(e.queries.query);o<a.length;o++){for(var u=a[o],s=u[0],c=[],l=0,f=u[1];l<f.length;l++){var d=f[l];Mn(t,d.obsSet)?d.subscribers.forEach((function(e){return n.add(e)})):r&&c.push(d)}r&&i.push([s,c])}if(r)for(var h=0,p=i;h<p.length;h++){var y=p[h];s=y[0],c=y[1],e.queries.query[s]=c}}function $n(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?lt(t.dbOpenError):e}));t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),o=!1;function a(){if(t.openCanceller!==r)throw new Z.DatabaseClosed("db.open() was cancelled")}var u,c=t.dbReadyResolve,l=null,f=!1,d=function(){return new Ae((function(r,u){if(a(),!n)throw new Z.MissingAPI;var c=e.name,h=t.autoSchema||!i?n.open(c):n.open(c,i);if(!h)throw new Z.MissingAPI;h.onerror=Jt(u),h.onblocked=We(e._fireOnBlocked),h.onupgradeneeded=We((function(r){if(l=h.transaction,t.autoSchema&&!e._options.allowEmptyDB){h.onerror=Zt,l.abort(),h.result.close();var i=n.deleteDatabase(c);i.onsuccess=i.onerror=We((function(){u(new Z.NoSuchDatabase("Database ".concat(c," doesnt exist")))}))}else{l.onerror=Jt(u);var a=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;f=a<1,e.idbdb=h.result,o&&function(e,t){wn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=xn(0,e.idbdb,t);kn(e,e._dbSchema,t);for(var r=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach((function(t){fe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),_n(n,t)}))},i=0,o=bn(n,e._dbSchema).change;i<o.length;i++){var a=r(o[i]);if("object"==typeof a)return a.value}}(e,l),function(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=un("$meta",On("")[0],[]),e._storeNames.push("$meta"));var o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);var a=o._reject.bind(o),u=Ie.transless||Ie;Ze((function(){if(Ie.trans=o,Ie.transless=u,0!==t)return pn(e,n),function(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then((function(e){return null!=e?e:n})):Ae.resolve(n)}(0,o,t).then((function(t){return function(e,t,n,r){var i=[],o=e._versions,a=e._dbSchema=xn(0,e.idbdb,r),u=o.filter((function(e){return e._cfg.version>=t}));return 0===u.length?Ae.resolve():(u.forEach((function(o){i.push((function(){var i=a,u=o._cfg.dbschema;kn(e,i,r),kn(e,u,r),a=e._dbSchema=u;var c=bn(i,u);c.add.forEach((function(e){gn(r,e[0],e[1].primKey,e[1].indexes)})),c.change.forEach((function(e){if(e.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach((function(e){return _n(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),_n(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var l=o._cfg.contentUpgrade;if(l&&o._cfg.version>t){pn(e,r),n._memoizedTables={};var f=E(u);c.del.forEach((function(e){f[e]=i[e]})),vn(e,[e.Transaction.prototype]),yn(e,[e.Transaction.prototype],s(f),f),n.schema=f;var d,h=z(l);h&&et();var p=Ae.follow((function(){if((d=l(n))&&h){var e=tt.bind(null,null);d.then(e,e)}}));return d&&"function"==typeof d.then?Ae.resolve(d):p.then((function(){return d}))}})),i.push((function(t){!function(e,t){[].slice.call(t.db.objectStoreNames).forEach((function(n){return null==e[n]&&t.db.deleteObjectStore(n)}))}(o._cfg.dbschema,t),vn(e,[e.Transaction.prototype]),yn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema})),i.push((function(t){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===o._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter((function(e){return"$meta"!==e}))):t.objectStore("$meta").put(o._cfg.version,"version"))}))})),function e(){return i.length?Ae.resolve(i.shift()(n.idbtrans)).then(e):Ae.resolve()}().then((function(){wn(a,r)})))}(e,t,o,n)})).catch(a);s(i).forEach((function(e){gn(n,e,i[e].primKey,i[e].indexes)})),pn(e,n),Ae.follow((function(){return e.on.populate.fire(o)})).catch(a)}))}(e,a/10,l,u)}}),u),h.onsuccess=We((function(){l=null;var n,a=e.idbdb=h.result,u=_(a.objectStoreNames);if(u.length>0)try{var p=a.transaction(1===(n=u).length?n[0]:n,"readonly");if(t.autoSchema)!function(e,t,n){e.verno=t.version/10;var r=e._dbSchema=xn(0,t,n);e._storeNames=_(t.objectStoreNames,0),yn(e,[e._allTables],s(r),r)}(e,a,p);else if(kn(e,e._dbSchema,p),!function(e,t){var n=bn(xn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((function(e){return e.add.length||e.change.length})))}(e,p)&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),a.close(),i=a.version+1,o=!0,r(d());pn(e,p)}catch(e){}mt.push(e),a.onversionchange=We((function(n){t.vcFired=!0,e.on("versionchange").fire(n)})),a.onclose=We((function(){e.close({disableAutoOpen:!1})})),f&&function(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Kn(n)&&t!==bt&&En(n,r).put({name:t}).catch(ne)}(e._deps,c),r()}),u)})).catch((function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),d();break;case"VersionError":if(i>0)return i=0,d()}return Ae.reject(e)}))};return Ae.race([r,("undefined"==typeof navigator?Ae.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var t=function(){return indexedDB.databases().finally(e)};u=setInterval(t,100),t()})).finally((function(){return clearInterval(u)})):Promise.resolve()).then(d)]).then((function(){return a(),t.onReadyBeingFired=[],Ae.resolve(In((function(){return e.on.ready.fire(e.vip)}))).then((function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(le,ne);return t.onReadyBeingFired=[],Ae.resolve(In((function(){return r(e.vip)}))).then(n)}}))})).finally((function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)})).catch((function(n){t.dbOpenError=n;try{l&&l.abort()}catch(e){}return r===t.openCanceller&&e._close(),lt(n)})).finally((function(){t.openComplete=!0,c()})).then((function(){if(f){var t={};e.tables.forEach((function(n){n.schema.indexes.forEach((function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new Dn(-1/0,[[[]]]))})),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new Dn(-1/0,[[[]]])})),nn(en).fire(t),zn(t,!0)}return e}))}function Wn(e){var t=function(t){return e.next(t)},n=i(t),r=i((function(t){return e.throw(t)}));function i(e){return function(t){var i=e(t),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):c(o)?Promise.all(o).then(n,r):n(o)}}return i(t)()}function Yn(e,t,n){var r=arguments.length;if(r<2)throw new Z.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,I(i),n]}function Xn(e,t,n,r,i){return Ae.resolve().then((function(){var o=Ie.transless||Ie,a=e._createTransaction(t,n,e._dbSchema,r);a.explicit=!0;var u={trans:a,transless:o};if(r)a.idbtrans=r.idbtrans;else try{a.create(),a.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===H.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then((function(){return Xn(e,t,n,null,i)}))):lt(r)}var s,c=z(i);c&&et();var l=Ae.follow((function(){if(s=i.call(a,a))if(c){var e=tt.bind(null,null);s.then(e,e)}else"function"==typeof s.next&&"function"==typeof s.throw&&(s=Wn(s))}),u);return(s&&"function"==typeof s.then?Ae.resolve(s).then((function(e){return a.active?e:lt(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return s}))).then((function(e){return r&&a._resolve(),a._completion.then((function(){return e}))})).catch((function(e){return a._reject(e),lt(e)}))}))}function Qn(e,t,n){for(var r=c(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var Gn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return o(o({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function u(e,t,n){var r=dn(e),s=i[r]=i[r]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,f=o(o({},n),{name:l?"".concat(r,"(virtual-from:").concat(n.name,")"):n.name,lowLevelIndex:n,isVirtual:l,keyTail:t,keyLength:c,extractKey:cn(e),unique:!l&&n.unique});return s.push(f),f.isPrimaryKey||a.push(f),c>1&&u(2===c?e[0]:e.slice(0,c-1),t+1,n),s.sort((function(e,t){return e.keyTail-t.keyTail})),f}var s=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var c=0,l=r.indexes;c<l.length;c++){var f=l[c];u(f.keyPath,0,f)}function d(t){var n,r,i=t.query.index;return i.isVirtual?o(o({},t),{query:{index:i.lowLevelIndex,range:(n=t.query.range,r=i.keyTail,{type:1===n.type?2:n.type,lower:Qn(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,r),lowerOpen:!0,upper:Qn(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,r),upperOpen:!0})}}):t}var h=o(o({},n),{schema:o(o({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:function(e){var t=i[dn(e)];return t&&t[0]}}),count:function(e){return n.count(d(e))},query:function(e){return n.query(d(e))},openCursor:function(t){var r=t.query.index,i=r.keyTail,o=r.isVirtual,a=r.keyLength;return o?n.openCursor(d(t)).then((function(n){return n&&function(n){var r=Object.create(n,{continue:{value:function(r){null!=r?n.continue(Qn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Qn(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return n.value}}});return r}(n)})):n.openCursor(t)}});return h}})}};function Hn(e,t,n,r){return n=n||{},r=r||"",s(e).forEach((function(i){if(h(t,i)){var o=e[i],a=t[i];if("object"==typeof o&&"object"==typeof a&&o&&a){var u=R(o);u!==R(a)?n[r+i]=t[i]:"Object"===u?Hn(o,a,n,r+i+"."):o!==a&&(n[r+i]=t[i])}else o!==a&&(n[r+i]=t[i])}else n[r+i]=void 0})),s(t).forEach((function(i){h(e,i)||(n[r+i]=t[i])})),n}function Jn(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Zn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return o(o({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return o(o({},n),{mutate:function(e){var i=Ie.trans,u=i.table(t).hook,s=u.deleting,c=u.creating,l=u.updating;switch(e.type){case"add":if(c.fire===ne)break;return i._promise("readwrite",(function(){return f(e)}),!0);case"put":if(c.fire===ne&&l.fire===ne)break;return i._promise("readwrite",(function(){return f(e)}),!0);case"delete":if(s.fire===ne)break;return i._promise("readwrite",(function(){return f(e)}),!0);case"deleteRange":if(s.fire===ne)break;return i._promise("readwrite",(function(){return function(e){return d(e.trans,e.range,1e4)}(e)}),!0)}return n.mutate(e);function f(e){var t=Ie.trans,i=e.keys||Jn(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?o(o({},e),{keys:i}):o({},e)).type&&(e.values=a([],e.values,!0)),e.keys&&(e.keys=a([],e.keys,!0)),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,i).then((function(o){var a=i.map((function(n,i){var a=o[i],u={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(u,n,a,t);else if("add"===e.type||void 0===a){var f=c.fire.call(u,n,e.values[i],t);null==n&&null!=f&&(n=f,e.keys[i]=n,r.outbound||S(e.values[i],r.keyPath,n))}else{var d=Hn(a,e.values[i]),p=l.fire.call(u,d,n,a,t);if(p){var y=e.values[i];Object.keys(p).forEach((function(e){h(y,e)?y[e]=p[e]:S(y,e,p[e])}))}}return u}));return n.mutate(e).then((function(t){for(var n=t.failures,r=t.results,u=t.numFailures,s=t.lastResult,c=0;c<i.length;++c){var l=r?r[c]:i[c],f=a[c];null==l?f.onerror&&f.onerror(n[c]):f.onsuccess&&f.onsuccess("put"===e.type&&o[c]?e.values[c]:l)}return{failures:n,results:r,numFailures:u,lastResult:s}})).catch((function(e){return a.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}function d(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((function(n){var r=n.result;return f({type:"delete",keys:r,trans:e}).then((function(n){return n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:d(e,o(o({},t),{lower:r[r.length-1],lowerOpen:!0}),i)}))}))}}})}})}};function er(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===Pt(t.keys[i],e[o])&&(r.push(n?B(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}var tr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return o(o({},n),{getMany:function(e){if(!e.cache)return n.getMany(e);var t=er(e.keys,e.trans._cache,"clone"===e.cache);return t?Ae.resolve(t):n.getMany(e).then((function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?B(t):t},t}))},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),n.mutate(e)}})}}}};function nr(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function rr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ir={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new Dn(e.MIN_KEY,e.MAX_KEY);return o(o({},e),{transaction:function(t,n,r){if(Ie.subscr&&"readonly"!==n)throw new Z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ie.querier));return e.transaction(t,n,r)},table:function(r){var i=e.table(r),a=i.schema,u=a.primaryKey,l=a.indexes,f=u.extractKey,d=u.outbound,h=u.autoIncrement&&l.filter((function(e){return e.compound&&e.keyPath.includes(u.keyPath)})),p=o(o({},i),{mutate:function(o){var s,l,f=o.trans,d=o.mutatedParts||(o.mutatedParts={}),p=function(e){var n="idb://".concat(t,"/").concat(r,"/").concat(e);return d[n]||(d[n]=new Dn)},y=p(""),v=p(":dels"),m=o.type,b="deleteRange"===o.type?[o.range]:"delete"===o.type?[o.keys]:o.values.length<50?[Jn(u,o).filter((function(e){return e})),o.values]:[],g=b[0],w=b[1],_=o.trans._cache;if(c(g)){y.addKeys(g);var x="delete"===m||g.length===w.length?er(g,_):null;x||v.addKeys(g),(x||w)&&function(e,t,n,r){t.indexes.forEach((function(t){var i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}var a=function(e){return t.multiEntry&&c(e)?e.forEach((function(e){return i.addKey(e)})):i.addKey(e)};(n||r).forEach((function(e,t){var i=n&&o(n[t]),u=r&&o(r[t]);0!==Pt(i,u)&&(null!=i&&a(i),null!=u&&a(u))}))}))}(p,a,x,w)}else if(g){var k={from:null!==(s=g.lower)&&void 0!==s?s:e.MIN_KEY,to:null!==(l=g.upper)&&void 0!==l?l:e.MAX_KEY};v.add(k),y.add(k)}else y.add(n),v.add(n),a.indexes.forEach((function(e){return p(e.name).add(n)}));return i.mutate(o).then((function(e){return!g||"add"!==o.type&&"put"!==o.type||(y.addKeys(e.results),h&&h.forEach((function(t){for(var n=o.values.map((function(e){return t.extractKey(e)})),r=t.keyPath.findIndex((function(e){return e===u.keyPath})),i=0,a=e.results.length;i<a;++i)n[i][r]=e.results[i];p(t.name).addKeys(n)}))),f.mutatedParts=Rn(f.mutatedParts||{},d),e}))}}),y=function(t){var n,r,i=t.query,o=i.index,a=i.range;return[o,new Dn(null!==(n=a.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=a.upper)&&void 0!==r?r:e.MAX_KEY)]},v={get:function(e){return[u,new Dn(e.key)]},getMany:function(e){return[u,(new Dn).addKeys(e.keys)]},count:y,query:y,openCursor:y};return s(v).forEach((function(e){p[e]=function(a){var u=Ie.subscr,s=!!u,c=nr(Ie,i)&&rr(e,a)?a.obsSet={}:u;if(s){var l=function(e){var n="idb://".concat(t,"/").concat(r,"/").concat(e);return c[n]||(c[n]=new Dn)},h=l(""),p=l(":dels"),y=v[e](a),m=y[0],b=y[1];if("query"===e&&m.isPrimaryKey&&!a.values?p.add(b):l(m.name||"").add(b),!m.isPrimaryKey){if("count"!==e){var g="query"===e&&d&&a.values&&i.query(o(o({},a),{values:!1}));return i[e].apply(this,arguments).then((function(t){if("query"===e){if(d&&a.values)return g.then((function(e){var n=e.result;return h.addKeys(n),t}));var n=a.values?t.result.map(f):t.result;a.values?h.addKeys(n):p.addKeys(n)}else if("openCursor"===e){var r=t,i=a.values;return r&&Object.create(r,{key:{get:function(){return p.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return p.addKey(e),e}},value:{get:function(){return i&&h.addKey(r.primaryKey),r.value}}})}return t}))}p.add(n)}}return i[e].apply(this,arguments)}})),p}})}};function or(e,t,n){if(0===n.numFailures)return t;if("deleteRange"===t.type)return null;var r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(n.numFailures===r)return null;var i=o({},t);return c(i.keys)&&(i.keys=i.keys.filter((function(e,t){return!(t in n.failures)}))),"values"in i&&c(i.values)&&(i.values=i.values.filter((function(e,t){return!(t in n.failures)}))),i}function ar(e,t){return function(e,t){return void 0===t.lower||(t.lowerOpen?Pt(e,t.lower)>0:Pt(e,t.lower)>=0)}(e,t)&&function(e,t){return void 0===t.upper||(t.upperOpen?Pt(e,t.upper)<0:Pt(e,t.upper)<=0)}(e,t)}function ur(e,t,n,r,i,o){if(!n||0===n.length)return e;var a=t.query.index,u=a.multiEntry,s=t.query.range,l=r.schema.primaryKey.extractKey,f=a.extractKey,d=(a.lowLevelIndex||a).extractKey,h=n.reduce((function(e,n){var r=e,i=[];if("add"===n.type||"put"===n.type)for(var o=new Dn,a=n.values.length-1;a>=0;--a){var d=n.values[a],h=l(d);if(!o.hasKey(h)){var p=f(d);(u&&c(p)?p.some((function(e){return ar(e,s)})):ar(p,s))&&(o.addKey(h),i.push(d))}}switch(n.type){case"add":var y=(new Dn).addKeys(t.values?e.map((function(e){return l(e)})):e);r=e.concat(t.values?i.filter((function(e){var t=l(e);return!y.hasKey(t)&&(y.addKey(t),!0)})):i.map((function(e){return l(e)})).filter((function(e){return!y.hasKey(e)&&(y.addKey(e),!0)})));break;case"put":var v=(new Dn).addKeys(n.values.map((function(e){return l(e)})));r=e.filter((function(e){return!v.hasKey(t.values?l(e):e)})).concat(t.values?i:i.map((function(e){return l(e)})));break;case"delete":var m=(new Dn).addKeys(n.keys);r=e.filter((function(e){return!m.hasKey(t.values?l(e):e)}));break;case"deleteRange":var b=n.range;r=e.filter((function(e){return!ar(l(e),b)}))}return r}),e);return h===e?e:(h.sort((function(e,t){return Pt(d(e),d(t))||Pt(l(e),l(t))})),t.limit&&t.limit<1/0&&(h.length>t.limit?h.length=t.limit:e.length===t.limit&&h.length<t.limit&&(i.dirty=!0)),o?Object.freeze(h):h)}function sr(e,t){return 0===Pt(e.lower,t.lower)&&0===Pt(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}var cr={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return o(o({},e),{transaction:function(n,r,i){var o=e.transaction(n,r,i);if("readwrite"===r){var a=new AbortController,u=a.signal,s=function(i){return function(){if(a.abort(),"readwrite"===r){for(var u=new Set,s=0,c=n;s<c.length;s++){var l=c[s],f=Fn["idb://".concat(t,"/").concat(l)];if(f){var d=e.table(l),h=f.optimisticOps.filter((function(e){return e.trans===o}));if(o._explicit&&i&&o.mutatedParts)for(var p=0,y=Object.values(f.queries.query);p<y.length;p++)for(var v=0,m=(w=y[p]).slice();v<m.length;v++)Mn((k=m[v]).obsSet,o.mutatedParts)&&(N(w,k),k.subscribers.forEach((function(e){return u.add(e)})));else if(h.length>0){f.optimisticOps=f.optimisticOps.filter((function(e){return e.trans!==o}));for(var b=0,g=Object.values(f.queries.query);b<g.length;b++)for(var w,_=0,x=(w=g[b]).slice();_<x.length;_++){var k;if(null!=(k=x[_]).res&&o.mutatedParts)if(i&&!k.dirty){var O=Object.isFrozen(k.res),P=ur(k.res,k.req,h,d,k,O);k.dirty?(N(w,k),k.subscribers.forEach((function(e){return u.add(e)}))):P!==k.res&&(k.res=P,k.promise=Ae.resolve({result:P}))}else k.dirty&&N(w,k),k.subscribers.forEach((function(e){return u.add(e)}))}}}}u.forEach((function(e){return e()}))}}};o.addEventListener("abort",s(!1),{signal:u}),o.addEventListener("error",s(!1),{signal:u}),o.addEventListener("complete",s(!0),{signal:u})}return o},table:function(n){var r=e.table(n),i=r.schema.primaryKey;return o(o({},r),{mutate:function(e){var a=Ie.trans;if(i.outbound||"disabled"===a.db._options.cache||a.explicit||"readwrite"!==a.idbtrans.mode)return r.mutate(e);var u=Fn["idb://".concat(t,"/").concat(n)];if(!u)return r.mutate(e);var s=r.mutate(e);return"add"!==e.type&&"put"!==e.type||!(e.values.length>=50||Jn(i,e).some((function(e){return null==e})))?(u.optimisticOps.push(e),e.mutatedParts&&Un(e.mutatedParts),s.then((function(t){if(t.numFailures>0){N(u.optimisticOps,e);var n=or(0,e,t);n&&u.optimisticOps.push(n),e.mutatedParts&&Un(e.mutatedParts)}})),s.catch((function(){N(u.optimisticOps,e),e.mutatedParts&&Un(e.mutatedParts)}))):s.then((function(t){var n=or(0,o(o({},e),{values:e.values.map((function(e,n){var r;if(t.failures[n])return e;var a=(null===(r=i.keyPath)||void 0===r?void 0:r.includes("."))?B(e):o({},e);return S(a,i.keyPath,t.results[n]),a}))}),t);u.optimisticOps.push(n),queueMicrotask((function(){return e.mutatedParts&&Un(e.mutatedParts)}))})),s},query:function(e){var i;if(!nr(Ie,r)||!rr("query",e))return r.query(e);var o="immutable"===(null===(i=Ie.trans)||void 0===i?void 0:i.db._options.cache),a=Ie,u=a.requery,s=a.signal,c=function(e,t,n,r){var i=Fn["idb://".concat(e,"/").concat(t)];if(!i)return[];var o=i.queries[n];if(!o)return[null,!1,i,null];var a=o[(r.query?r.query.index.name:null)||""];if(!a)return[null,!1,i,null];switch(n){case"query":var u=a.find((function(e){return e.req.limit===r.limit&&e.req.values===r.values&&sr(e.req.query.range,r.query.range)}));return u?[u,!0,i,a]:[a.find((function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&function(e,t){return function(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;var i=Pt(e,t);if(0===i){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&function(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;var i=Pt(e,t);if(0===i){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}(e.req.query.range,r.query.range)})),!1,i,a];case"count":var s=a.find((function(e){return sr(e.req.query.range,r.query.range)}));return[s,!!s,i,a]}}(t,n,"query",e),l=c[0],f=c[1],d=c[2],h=c[3];if(l&&f)l.obsSet=e.obsSet;else{var p=r.query(e).then((function(e){var t=e.result;if(l&&(l.res=t),o){for(var n=0,r=t.length;n<r;++n)Object.freeze(t[n]);Object.freeze(t)}else e.result=B(t);return e})).catch((function(e){return h&&l&&N(h,l),Promise.reject(e)}));l={obsSet:e.obsSet,promise:p,subscribers:new Set,type:"query",req:e,dirty:!1},h?h.push(l):(h=[l],d||(d=Fn["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),d.queries.query[e.query.index.name||""]=h)}return function(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",(function(){e.subscribers.delete(n),0===e.subscribers.size&&function(e,t){setTimeout((function(){0===e.subscribers.size&&N(t,e)}),3e3)}(e,t)}))}(l,h,u,s),l.promise.then((function(t){return{result:ur(t.result,e,null==d?void 0:d.optimisticOps,r,l,o)}}))}})}})}};function lr(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var fr,dr=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=o({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u,s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ne,dbReadyPromise:null,cancelOpen:ne,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};s.dbReadyPromise=new Ae((function(e){s.dbReadyResolve=e})),s.openCanceller=new Ae((function(e,t){s.cancelOpen=t})),this._state=s,this.name=t,this.on=Ct(this,"populate","blocked","versionchange","close",{ready:[le,ne]}),this.once=function(e,t){var n=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];r.on(e).unsubscribe(n),t.apply(r,i)};return r.on(e,n)},this.on.ready.subscribe=x(this.on.ready.subscribe,(function(t){return function(n,i){e.vip((function(){var e=r._state;if(e.openComplete)e.dbOpenError||Ae.resolve().then(n),i&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),i&&t(n);else{t(n);var o=r;i||t((function e(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(u=this,At(Lt.prototype,(function(e,t){this.db=u;var n=xt,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx,o=i.table,a=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:a!==re?a:null}}))),this.Table=function(e){return At(Dt.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Ct(null,{creating:[ae,ne],reading:[ie,re],updating:[se,ne],deleting:[ue,ne]})}))}(this),this.Transaction=function(e){return At(rn.prototype,(function(t,n,r,i,o){var a=this;"readonly"!==t&&n.forEach((function(e){var t,i=null===(t=r[e])||void 0===t?void 0:t.yProps;i&&(n=n.concat(i.map((function(e){return e.updatesTable}))))})),this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Ct(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ae((function(e,t){a._resolve=e,a._reject=t})),this._completion.then((function(){a.active=!1,a.on.complete.fire()}),(function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),lt(e)}))}))}(this),this.Version=function(e){return At(Sn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return At(Ht.prototype,(function(t,n,r){if(this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r},this._cmp=this._ascending=Pt,this._descending=function(e,t){return Pt(t,e)},this._max=function(e,t){return Pt(e,t)>0?e:t},this._min=function(e,t){return Pt(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new Z.MissingAPI}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))})),this._maxKey=sn(n.IDBKeyRange),this._createTransaction=function(e,t,n,i){return new r.Transaction(e,t,n,r._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(e){r.on("blocked").fire(e),mt.filter((function(e){return e.name===r.name&&e!==r&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(tr),this.use(cr),this.use(ir),this.use(Gn),this.use(Zn);var c=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return lr(r.table(e),c)};var i=Reflect.get(e,t,n);return i instanceof Dt?lr(i,c):"tables"===t?i.map((function(e){return lr(e,c)})):"_createTransaction"===t?function(){return lr(i.apply(this,arguments),c)}:i}});this.vip=c,a.forEach((function(e){return e(r)}))}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Z.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter((function(t){return t._cfg.version===e}))[0];return n||(n=new this.Version(e),t.push(n),t.sort(mn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Ie.letThrough||this._vip)?e():new Ae((function(e,n){if(t._state.openComplete)return n(new Z.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new Z.DatabaseClosed);t.open().catch(ne)}t._state.dbReadyPromise.then(e,n)})).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:n,level:null==r?10:r,name:i}),o.sort((function(e,t){return e.level-t.level})),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return r?e.create!==r:!!n&&e.name!==n}))),this},e.prototype.open=function(){var e=this;return ut(Ke,(function(){return $n(e)}))},e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=mt.indexOf(this);if(t>=0&&mt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Ae((function(t){e.dbReadyResolve=t})),e.openCanceller=new Ae((function(t,n){e.cancelOpen=n})))},e.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new Z.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new Z.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new Ae((function(i,o){var a=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=We((function(){var e,n,r,o;e=t._deps,n=t.name,r=e.indexedDB,o=e.IDBKeyRange,!Kn(r)&&n!==bt&&En(r,o).delete(n).catch(ne),i()})),n.onerror=Jt(o),n.onblocked=t._fireOnBlocked};if(n)throw new Z.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()}))},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return s(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Yn.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=Ie.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,a,u=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(a=t.map((function(e){var t=e instanceof r.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===gt)o=gt;else{if("rw"!=e&&e!=wt)throw new Z.InvalidArgument("Invalid transaction mode: "+e);o=wt}if(i){if(i.mode===gt&&o===wt){if(!u)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach((function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!u)throw new Z.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),u&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,(function(t,n){n(e)})):lt(e)}var s=Xn.bind(null,this,o,a,i,n);return i?i._promise(o,s,"lock"):Ie.trans?ut(Ie.transless,(function(){return r._whenReady(s)})):this._whenReady(s)},e.prototype.table=function(e){if(!h(this._allTables,e))throw new Z.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),hr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",pr=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},e.prototype[hr]=function(){return this},e}();try{function yr(e,t){const n=["A script is requesting permission to use IndexedDB.","",` Operation: ${e}`,t?` Database: ${t}`:"","","Do you want to allow this?"].join("\n");return window.confirm(n)}fr={indexedDB:u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,IDBKeyRange:u.IDBKeyRange||u.webkitIDBKeyRange};const _r=u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,xr=new Proxy(_r,{get(e,t,n){if("open"===t)return function(e,t){if(!yr("open",e))throw new DOMException("Blocked by policy","SecurityError");return _r.open(e,t)};if("deleteDatabase"===t)return function(e){if(!yr("deleteDatabase",e))throw new DOMException("Blocked by policy","SecurityError");return _r.deleteDatabase(e)};if("databases"===t)return function(...e){if(!yr("databases","(all)"))throw new DOMException("Blocked by policy","SecurityError");return _r.databases(...e)};if("cmp"===t)return function(e,t){if(!yr("cmp","(keys)"))throw new DOMException("Blocked by policy","SecurityError");return _r.cmp(e,t)};const r=Reflect.get(e,t,n);return"function"==typeof r?r.bind(e):r}});for(const kr of["indexedDB","webkitIndexedDB","mozIndexedDB","msIndexedDB"])Object.defineProperty(window,kr,{value:xr,writable:!1,configurable:!1})}catch(Or){fr={indexedDB:null,IDBKeyRange:null}}var vr=dr;function mr(e){var t=gr;try{gr=!0,nn.storagemutated.fire(e),zn(e,!0)}finally{gr=t}}p(vr,o(o({},te),{delete:function(e){return new vr(e,{addons:[]}).delete()},exists:function(e){return new vr(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){try{return(t=vr.dependencies,n=t.indexedDB,r=t.IDBKeyRange,Kn(n)?Promise.resolve(n.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==bt}))})):En(n,r).toCollection().primaryKeys()).then(e)}catch(t){return lt(new Z.MissingAPI)}var t,n,r},defineClass:function(){return function(e){l(this,e)}},ignoreTransaction:function(e){return Ie.trans?ut(Ie.transless,e):e()},vip:In,async:function(e){return function(){try{var t=Wn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ae.resolve(t)}catch(e){return lt(e)}}},spawn:function(e,t,n){try{var r=Wn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ae.resolve(r)}catch(e){return lt(e)}},currentTransaction:{get:function(){return Ie.trans||null}},waitFor:function(e,t){var n=Ae.resolve("function"==typeof e?vr.ignoreTransaction(e):e).timeout(t||6e4);return Ie.trans?Ie.trans.waitFor(n):n},Promise:Ae,debug:{get:function(){return fe},set:function(e){de(e)}},derive:m,extend:l,props:p,override:x,Events:Ct,on:nn,liveQuery:function(e){var t,n=!1,r=new pr((function(r){var i,o=z(e),a=!1,u={},s={},c={get closed(){return a},unsubscribe:function(){a||(a=!0,i&&i.abort(),l&&nn.storagemutated.unsubscribe(d))}};r.start&&r.start(c);var l=!1,f=function(){return ct(p)},d=function(e){Rn(u,e),Mn(s,u)&&f()},p=function(){if(!a&&fr.indexedDB){u={};var c={};i&&i.abort(),i=new AbortController;var p={subscr:c,signal:i.signal,requery:f,querier:e,trans:null},y=function(t){var n=Ue();try{o&&et();var r=Ze(e,t);return o&&(r=r.finally(tt)),r}finally{n&&ze()}}(p);Promise.resolve(y).then((function(e){n=!0,t=e,a||p.signal.aborted||(u={},function(e){for(var t in e)if(h(e,t))return!1;return!0}(s=c)||l||(nn(en,d),l=!0),ct((function(){return!a&&r.next&&r.next(e)})))}),(function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||a||ct((function(){a||r.error&&r.error(e)}))}))}};return setTimeout(f,0),c}));return r.hasValue=function(){return n},r.getValue=function(){return t},r},extendObservabilitySet:Rn,getByKeyPath:P,setByKeyPath:S,delByKeyPath:function(e,t){"string"==typeof t?S(e,t,void 0):"length"in t&&[].map.call(t,(function(t){S(e,t,void 0)}))},shallowClone:E,deepClone:B,getObjectDiff:Hn,cmp:Pt,asap:O,minKey:pt,addons:[],connections:mt,errnames:H,dependencies:fr,cache:Fn,semVer:dt,version:dt.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)}))})),vr.maxKey=sn(vr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(nn(en,(function(e){var t;gr||(t=new CustomEvent(tn,{detail:e}),gr=!0,dispatchEvent(t),gr=!1)})),addEventListener(tn,(function(e){var t=e.detail;gr||mr(t)})));var br,gr=!1,wr=function(){};"undefined"!=typeof BroadcastChannel&&((wr=function(){(br=new BroadcastChannel(tn)).onmessage=function(e){return e.data&&mr(e.data)}})(),"function"==typeof br.unref&&br.unref(),nn(en,(function(e){gr||br.postMessage(e)}))),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",(function(e){if(!dr.disableBfCache&&e.persisted){fe&&console.debug("Dexie: handling persisted pagehide"),null==br||br.close();for(var t=0,n=mt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}})),addEventListener("pageshow",(function(e){!dr.disableBfCache&&e.persisted&&(fe&&console.debug("Dexie: handling persisted pageshow"),wr(),mr({all:new Dn(-1/0,[[]])}))}))),Ae.rejectionMapper=function(e,t){if(!e||e instanceof Y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ee[e.name])return e;var n=new ee[e.name](t||e.message,e);return"stack"in e&&v(n,"stack",{get:function(){return this.inner.stack}}),n},de(fe)})),n.register("jXXgq",(function(t,r){e(t.exports,"Connector",(function(){return a}));var i=n("3MPaZ"),o=n("ayIBF");class a{hasIndex(){return!1}storage(){return new i.LiaStorage}initSettings(e,t=!1){return o.Settings.init(e,t,this.setSettings)}setSettings(e){o.Settings.update(e)}getSettings(){let e="";try{e=localStorage.getItem(o.Settings.PORT)}catch(e){console.warn("cannot write to localStorage")}let t=null;if("string"==typeof e){try{t=JSON.parse(e)}catch(e){console.warn("getSettings =>",e)}t||(t=o.Settings.data),window.innerWidth<=768&&(t.table_of_contents=!1)}return t}open(e,t,n){}load(e){}store(e){}update(e,t){}slide(e){}getIndex(){}deleteFromIndex(e){}async storeToIndex(e){}restoreFromIndex(e,t){}reset(e,t){this.initSettings(null,!0)}async getFromIndex(e){return null}async addMisc(e,t,n,r){console.log("addMisc not implemented")}async getMisc(e,t,n){console.log("getMisc not implemented")}constructor(){}}})),n.register("3MPaZ",(function(t,n){e(t.exports,"LiaStorage",(function(){return r}));class r{getItems(e=[]){"string"==typeof e&&(e=[e]);let t={};for(let n=0;n<e.length;n++){let r=localStorage.getItem(e[n]);t[e[n]]=r?JSON.parse(r):r}return t}setItems(e){this._setLocal(e)}_setLocal(e){if("object"==typeof e)for(const[t,n]of Object.entries(e))localStorage.setItem(t,JSON.stringify(n))}constructor(){}}}));
