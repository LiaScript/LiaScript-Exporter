var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("g9MJ9",(function(t,n){var r,a;r=t.exports,a=function(){return Kt},Object.defineProperty(r,"joinRoom",{get:a,set:undefined,enumerable:!0,configurable:!0});var o,s,i,c,l,d,f,u,y,p,m,h,v,g,w,b,A,k,T,x=e("2Xs1f"),P=e("dM3DM"),S=e("aQXMn");const E={p:0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,n:0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,h:1n,a:0n,b:7n,Gx:0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy:0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n},{p:C,n:L,Gx:U,Gy:D,b:I}=E,$=32,O={publicKey:33,publicKeyUncompressed:65,seed:48},R=(e="")=>{const t=Error(e);throw((...e)=>{"captureStackTrace"in Error&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(...e)})(t,R),t},j=(e,t,n="")=>{const r=(a=e)instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name;var a;const o=null==e?void 0:e.length,s=void 0!==t;return(!r||s&&o!==t)&&R((n&&`"${n}" `)+"expected Uint8Array"+(s?" of length "+t:"")+", got "+(r?"length="+o:"type="+typeof e)),e},H=e=>new Uint8Array(e),K=(e,t)=>e.toString(16).padStart(t,"0"),M=e=>Array.from(j(e)).map((e=>K(e,2))).join(""),B=e=>e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0,V=e=>{const t="hex invalid";if("string"!=typeof e)return R(t);const n=e.length,r=n/2;if(n%2)return R(t);const a=H(r);for(let n=0,o=0;n<r;n++,o+=2){const r=B(e.charCodeAt(o)),s=B(e.charCodeAt(o+1));if(void 0===r||void 0===s)return R(t);a[n]=16*r+s}return a},X=()=>null===globalThis||void 0===globalThis?void 0:globalThis.crypto,Z=()=>{var e;return null!==(T=null===(e=X())||void 0===e?void 0:e.subtle)&&void 0!==T?T:R("crypto.subtle must be defined, consider polyfill")},q=(...e)=>{const t=H(e.reduce(((e,t)=>e+j(t).length),0));let n=0;return e.forEach((e=>{t.set(e,n),n+=e.length})),t},Y=(e=32)=>X().getRandomValues(H(e)),G=BigInt,J=(e,t,n,r="bad number: out of range")=>(e=>"bigint"==typeof e)(e)&&t<=e&&e<n?e:R(r),N=(e,t=C)=>{const n=e%t;return n>=0n?n:t+n},_=e=>N(e,L),z=e=>e instanceof re?e:R("Point expected"),Q=e=>N(N(e*e)*e+I),F=e=>J(e,0n,C),W=e=>J(e,1n,C),ee=e=>0n===(1n&e),te=e=>Uint8Array.of(e),ne=e=>{const t=Q(W(e));let n=1n;for(let e=t,r=(C+1n)/4n;r>0n;r>>=1n)1n&r&&(n=n*e%C),e=e*e%C;return N(n*n)===t?n:R("sqrt invalid")};class re{static CURVE(){return E}static fromAffine(e){const{x:t,y:n}=e;return 0n===t&&0n===n?oe:new re(t,n,1n)}static fromBytes(e){j(e);const{publicKey:t,publicKeyUncompressed:n}=O;let r;const a=e.length,o=e[0],s=e.subarray(1),i=ie(s,0,$);if(a===t&&(2===o||3===o)){let e=ne(i);const t=ee(e);ee(G(o))!==t&&(e=N(-e)),r=new re(i,e,1n)}return a===n&&4===o&&(r=new re(i,ie(s,$,64),1n)),r?r.assertValidity():R("bad point: not on curve")}static fromHex(e){return re.fromBytes(V(e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(e){const{X:t,Y:n,Z:r}=this,{X:a,Y:o,Z:s}=z(e),i=N(t*s),c=N(a*r),l=N(n*s),d=N(o*r);return i===c&&l===d}is0(){return this.equals(oe)}negate(){return new re(this.X,N(-this.Y),this.Z)}double(){return this.add(this)}add(e){const{X:t,Y:n,Z:r}=this,{X:a,Y:o,Z:s}=z(e);let i=0n,c=0n,l=0n;const d=N(3n*I);let f=N(t*a),u=N(n*o),y=N(r*s),p=N(t+n),m=N(a+o);p=N(p*m),m=N(f+u),p=N(p-m),m=N(t+r);let h=N(a+s);return m=N(m*h),h=N(f+y),m=N(m-h),h=N(n+r),i=N(o+s),h=N(h*i),i=N(u+y),h=N(h-i),l=N(0n*m),i=N(d*y),l=N(i+l),i=N(u-l),l=N(u+l),c=N(i*l),u=N(f+f),u=N(u+f),y=N(0n*y),m=N(d*m),u=N(u+y),y=N(f-y),y=N(0n*y),m=N(m+y),f=N(u*m),c=N(c+f),f=N(h*m),i=N(p*i),i=N(i-f),f=N(p*u),l=N(h*l),l=N(l+f),new re(i,c,l)}subtract(e){return this.add(z(e).negate())}multiply(e,t=!0){if(!t&&0n===e)return oe;if((e=>{J(e,1n,L)})(e),1n===e)return this;if(this.equals(ae))return Oe(e).p;let n=oe,r=ae;for(let a=this;e>0n;a=a.double(),e>>=1n)1n&e?n=n.add(a):t&&(r=r.add(a));return n}multiplyUnsafe(e){return this.multiply(e,!1)}toAffine(){const{X:e,Y:t,Z:n}=this;if(this.equals(oe))return{x:0n,y:0n};if(1n===n)return{x:e,y:t};const r=((e,t)=>{(0n===e||t<=0n)&&R("no inverse n="+e+" mod="+t);let n=N(e,t),r=t,a=0n,o=1n;for(;0n!==n;){const e=r%n,t=a-o*(r/n);r=n,n=e,a=o,o=t}return 1n===r?N(a,t):R("no inverse")})(n,C);return 1n!==N(n*r)&&R("inverse invalid"),{x:N(e*r),y:N(t*r)}}assertValidity(){const{x:e,y:t}=this.toAffine();return W(e),W(t),N(t*t)===Q(e)?this:R("bad point: not on curve")}toBytes(e=!0){const{x:t,y:n}=this.assertValidity().toAffine(),r=le(t);return e?q((e=>te(ee(e)?2:3))(n),r):q(te(4),r,le(n))}toHex(e){return M(this.toBytes(e))}constructor(e,t,n){(0,x.default)(this,"X",void 0),(0,x.default)(this,"Y",void 0),(0,x.default)(this,"Z",void 0),this.X=F(e),this.Y=W(t),this.Z=F(n),Object.freeze(this)}}(0,x.default)(re,"BASE",void 0),(0,x.default)(re,"ZERO",void 0);const ae=new re(U,D,1n),oe=new re(0n,1n,0n);re.BASE=ae,re.ZERO=oe;const se=e=>G("0x"+(M(e)||"0")),ie=(e,t,n)=>se(e.subarray(t,n)),ce=2n**256n,le=e=>V(K(J(e,0n,ce),64)),de="SHA-256",fe={async hmacSha256Async(e,t){const n=Z(),r="HMAC",a=await n.importKey("raw",e,{name:r,hash:{name:de}},!1,["sign"]);return H(await n.sign(r,a,t))},hmacSha256:void 0,sha256Async:async e=>H(await Z().digest(de,e)),sha256:void 0},ue=e=>Uint8Array.from("BIP0340/"+e,(e=>e.charCodeAt(0))),ye="nonce",pe="challenge",me=(e,...t)=>{const n=(e=>{const t=fe[e];return"function"!=typeof t&&R("hashes."+e+" not set"),t})("sha256"),r=n(ue(e));return n(q(r,r,...t))},he=async(e,...t)=>{const n=fe.sha256Async,r=await n(ue(e));return await n(q(r,r,...t))},ve=e=>{const t=(e=>{const t=se(j(e,$,"secret key"));return J(t,1n,L,"invalid secret key: outside of range")})(e),n=ae.multiply(t),{x:r,y:a}=n.assertValidity().toAffine();return{d:ee(a)?t:_(-t),px:le(r)}},ge=e=>_(se(e)),we=(...e)=>ge(me(pe,...e)),be=async(...e)=>ge(await he(pe,...e)),Ae=e=>ve(e).px,ke=(Te=Ae,e=>{const t=((e=Y(O.seed))=>{j(e),(e.length<O.seed||e.length>1024)&&R("expected 40-1024b");const t=N(se(e),L-1n);return le(t+1n)})(e);return{secretKey:t,publicKey:Te(t)}});var Te;const xe=(e,t,n)=>{const{px:r,d:a}=ve(t);return{m:j(e),px:r,d:a,a:j(n,$)}},Pe=e=>{const t=ge(e);0n===t&&R("sign failed: k is zero");const{px:n,d:r}=ve(le(t));return{rx:n,k:r}},Se=(e,t,n,r)=>q(t,le(_(e+n*r))),Ee="invalid signature produced",Ce=(e,t,n,r)=>{const a=j(e,64,"signature"),o=j(t,void 0,"message"),s=j(n,$,"publicKey");try{const e=se(s),t=ne(e),n=ee(t)?t:N(-t),l=new re(e,n,1n).assertValidity(),d=le(l.toAffine().x),f=ie(a,0,$);J(f,1n,C);const u=ie(a,$,64);return J(u,1n,L),i=r(q(le(f),d,o)),c=e=>{const{x:t,y:n}=(r=l,a=u,o=_(-e),ae.multiply(a,!1).add(r.multiply(o,!1)).assertValidity()).toAffine();var r,a,o;return!(!ee(n)||t!==f)},i instanceof Promise?i.then(c):c(i)}catch(e){return!1}var i,c},Le=(e,t,n)=>Ce(e,t,n,we),Ue=async(e,t,n)=>Ce(e,t,n,be),De={keygen:ke,getPublicKey:Ae,sign(e,t,n=Y($)){const{m:r,px:a,d:o,a:s}=xe(e,t,n),i=me("aux",s),c=le(o^se(i)),l=me(ye,c,a,r),{rx:d,k:f}=Pe(l),u=we(d,a,r),y=Se(f,d,u,o);return Le(y,r,a)||R(Ee),y},verify:Le,async signAsync(e,t,n=Y($)){const{m:r,px:a,d:o,a:s}=xe(e,t,n),i=await he("aux",s),c=le(o^se(i)),l=await he(ye,c,a,r),{rx:d,k:f}=Pe(l),u=await be(d,a,r),y=Se(f,d,u,o);return await Ue(y,r,a)||R(Ee),y},verifyAsync:Ue};let Ie;const $e=(e,t)=>{const n=t.negate();return e?n:t},Oe=e=>{const t=Ie||(Ie=(()=>{const e=[];let t=ae,n=t;for(let r=0;r<33;r++){n=t,e.push(n);for(let r=1;r<128;r++)n=n.add(t),e.push(n);t=n.double()}return e})());let n=oe,r=ae;const a=G(255),o=G(8);for(let s=0;s<33;s++){let i=Number(e&a);e>>=o,i>128&&(i-=256,e+=1n);const c=128*s,l=c,d=c+Math.abs(i)-1,f=s%2!=0,u=i<0;0===i?r=r.add($e(f,t[l])):n=n.add($e(u,t[d]))}return 0n!==e&&R("invalid wnaf"),{p:n,f:r}},{floor:Re,random:je,sin:He}=Math,Ke="Trystero",Me=(e,t)=>Array(e).fill().map(t),Be=e=>Me(e,(()=>"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Re(62*je())])).join(""),Ve=Be(20),Xe=Promise.all.bind(Promise),Ze="undefined"!=typeof window,{entries:qe,fromEntries:Ye,keys:Ge}=Object,Je=()=>{},Ne=e=>Error(`${Ke}: ${e}`),_e=new TextEncoder,ze=new TextDecoder,Qe=e=>_e.encode(e),Fe=e=>ze.decode(e),We=e=>e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),et=(...e)=>e.join("@"),tt=JSON.stringify,nt=JSON.parse,rt=(e,t=Number.MAX_SAFE_INTEGER)=>e.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0)%t,at={};let ot=null,st=null;const it=()=>{ot||(ot=new Promise((e=>{st=e})).finally((()=>{st=null,ot=null})))},ct=()=>null==st?void 0:st(),lt="AES-GCM",dt={},ft=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,Qe(t))),ut=async e=>(o=dt)[s=e]||(o[s]=Array.from(await ft("SHA-1",e)).map((e=>e.toString(36))).join("")),yt=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));var r;return n.join(",")+"$"+(r=await crypto.subtle.encrypt({name:lt,iv:n},await e,Qe(t)),btoa(String.fromCharCode.apply(null,new Uint8Array(r))))},pt=async(e,t)=>{const[n,r]=t.split("$");return Fe(await crypto.subtle.decrypt({name:lt,iv:new Uint8Array(n.split(","))},await e,(e=>{const t=atob(e);return new Uint8Array(t.length).map(((e,n)=>t.charCodeAt(n))).buffer})(r)))},mt="icegatheringstatechange",ht="offer";var vt=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:r})=>{const a=new(n||RTCPeerConnection)((0,P.default)({iceServers:gt.concat(r||[])},t)),o={};let s=!1,i=!1,c=null;const l=e=>{e.binaryType="arraybuffer",e.bufferedAmountLowThreshold=65535,e.onmessage=e=>{var t;return null===(t=o.data)||void 0===t?void 0:t.call(o,e.data)},e.onopen=()=>{var e;return null===(e=o.connect)||void 0===e?void 0:e.call(o)},e.onclose=()=>{var e;return null===(e=o.close)||void 0===e?void 0:e.call(o)},e.onerror=e=>{var t;return null===(t=o.error)||void 0===t?void 0:t.call(o,e)}},d=e=>Promise.race([new Promise((t=>{const n=()=>{"complete"===e.iceGatheringState&&(e.removeEventListener(mt,n),t())};e.addEventListener(mt,n),n()})),new Promise((e=>setTimeout(e,5e3)))]).then((()=>({type:e.localDescription.type,sdp:e.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")})));return e?(c=a.createDataChannel("data"),l(c)):a.ondatachannel=({channel:e})=>{c=e,l(e)},a.onnegotiationneeded=async()=>{try{var e;s=!0,await a.setLocalDescription();const t=await d(a);null===(e=o.signal)||void 0===e||e.call(o,t)}catch(e){var t;null===(t=o.error)||void 0===t||t.call(o,e)}finally{s=!1}},a.onconnectionstatechange=()=>{var e;["disconnected","failed","closed"].includes(a.connectionState)&&(null===(e=o.close)||void 0===e||e.call(o))},a.ontrack=e=>{var t,n;null===(t=o.track)||void 0===t||t.call(o,e.track,e.streams[0]),null===(n=o.stream)||void 0===n||n.call(o,e.streams[0])},a.onremovestream=e=>{var t;return null===(t=o.stream)||void 0===t?void 0:t.call(o,e.stream)},e&&(a.canTrickleIceCandidates||a.onnegotiationneeded()),{created:Date.now(),connection:a,get channel(){return c},get isDead(){return"closed"===a.connectionState},async signal(t){var n;if("open"!==(null==c?void 0:c.readyState)||(null===(n=t.sdp)||void 0===n?void 0:n.includes("a=rtpmap")))try{if(t.type===ht){var r;if(s||"stable"!==a.signalingState&&!i){if(e)return;await Xe([a.setLocalDescription({type:"rollback"}),a.setRemoteDescription(t)])}else await a.setRemoteDescription(t);await a.setLocalDescription();const n=await d(a);return null===(r=o.signal)||void 0===r||r.call(o,n),n}if("answer"===t.type){i=!0;try{await a.setRemoteDescription(t)}finally{i=!1}}}catch(e){var l;null===(l=o.error)||void 0===l||l.call(o,e)}},sendData:e=>c.send(e),destroy(){null==c||c.close(),a.close(),s=!1,i=!1},setHandlers:e=>Object.assign(o,e),offerPromise:e?new Promise((e=>o.signal=t=>{t.type===ht&&e(t)})):Promise.resolve(),addStream:e=>e.getTracks().forEach((t=>a.addTrack(t,e))),removeStream:e=>a.getSenders().filter((t=>e.getTracks().includes(t.track))).forEach((e=>a.removeTrack(e))),addTrack:(e,t)=>a.addTrack(e,t),removeTrack(e){const t=a.getSenders().find((t=>t.track===e));t&&a.removeTrack(t)},replaceTrack(e,t){const n=a.getSenders().find((t=>t.track===e));if(n)return n.replaceTrack(t)}}};const gt=[...Me(3,((e,t)=>`stun:stun${t||""}.l.google.com:19302`)),"stun:stun.cloudflare.com:3478"].map((e=>({urls:e}))),wt=Object.getPrototypeOf(Uint8Array),bt=16369,At=255,kt="bufferedamountlow",Tt=e=>"@_"+e;var xt;const Pt={},St="EVENT",{secretKey:Et,publicKey:Ct}=De.keygen(),Lt=We(Ct),Ut={},Dt={},It={},$t=()=>Math.floor(Date.now()/1e3),Ot=e=>null!==(xt=(m=It)[h=e])&&void 0!==xt?xt:m[h]=rt(e,1e4)+2e4,Rt=async(e,t)=>{const n={kind:Ot(e),tags:[["x",e]],created_at:$t(),content:t,pubkey:Lt},r=await ft("SHA-256",tt([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]));return tt([St,(0,S.default)((0,P.default)({},n),{id:We(r),sig:We(await De.signAsync(r,Et))})])},jt=(e,t)=>(Ut[e]=t,tt(["REQ",e,{kinds:[Ot(t)],since:$t(),"#x":[t]}])),Ht=e=>(delete Ut[e],tt(["CLOSE",e])),Kt=(({init:e,subscribe:t,announce:n})=>{const r={};let a,o,s,m,h=!1;return(A,k,T)=>{var x;const{appId:E}=A;if(null===(x=r[E])||void 0===x?void 0:x[k])return r[E][k];const C={},L={},U=et(Ke,E,k),D=ut(U),I=ut(et(U,Ve)),$=(async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Qe(`${e}:${t}:${n}`)),{name:lt},!1,["encrypt","decrypt"]))(A.password||"",E,k),O=e=>async t=>({type:t.type,sdp:await e($,t.sdp)}),R=O(pt),j=O(yt),H=()=>vt(!0,A),K=(e,t,n)=>{var r;L[t]?L[t]!==e&&e.destroy():(L[t]=e,Y(e,t),null===(r=C[t])||void 0===r||r.forEach(((e,t)=>{t!==n&&e.destroy()})),delete C[t])},M=(e,t)=>{L[t]===e&&delete L[t]},B=e=>(o.push(...Me(e,H)),Xe(o.splice(0,e).map((e=>e.offerPromise.then(j).then((t=>({peer:e,offer:t}))))))),V=(e,t)=>null==T?void 0:T({error:`incorrect password (${A.password}) when decrypting ${t}`,appId:E,peerId:e,roomId:k});if(!A)throw Ne("requires a config map as the first argument");if(!E&&!A.firebaseApp)throw Ne("config map is missing appId field");if(!k)throw Ne("roomId argument required");if(!h){const t=e(A);o=Me(20,H),a=Array.isArray(t)?t:[t],h=!0,s=setInterval((()=>o=o.filter((e=>{const t=Date.now()-e.created<57333;return t||e.destroy(),t}))),59052.99),m=A.manualRelayReconnection?Je:(()=>{if(Ze){const e=new AbortController;return addEventListener("online",ct,{signal:e.signal}),addEventListener("offline",it,{signal:e.signal}),()=>e.abort()}return Je})()}const X=a.map((()=>5333)),Z=[],q=a.map((async(e,n)=>t(await e,await D,await I,(e=>async(t,n,r)=>{const[a,o]=await Xe([D,I]);if(t!==a&&t!==o)return;const{peerId:s,offer:i,answer:c,peer:l}="string"==typeof n?nt(n):n;if(s!==Ve&&!L[s])if(!s||i||c){if(i){var d;if((null===(d=C[s])||void 0===d?void 0:d[e])&&Ve>s)return;const t=vt(!1,A);let n;t.setHandlers({connect:()=>K(t,s,e),close:()=>M(t,s)});try{n=await R(i)}catch(e){return void V(s,"offer")}if(t.isDead)return;const[a,o]=await Xe([ut(et(U,s)),t.signal(n)]);r(a,tt({peerId:Ve,answer:await j(o)}))}else if(c){let t;try{t=await R(c)}catch(e){return void V(s,"answer")}if(l)l.setHandlers({connect:()=>K(l,s,e),close:()=>M(l,s)}),l.signal(t);else{var f;const n=null===(f=C[s])||void 0===f?void 0:f[e];n&&!n.isDead&&n.signal(t)}}}else{var u;if(null===(u=C[s])||void 0===u?void 0:u[e])return;const[[{peer:t,offer:n}],a]=await Xe([B(1),ut(et(U,s))]);(v=C)[g=s]||(v[g]=[]),C[s][e]=t,setTimeout((()=>((e,t)=>{var n;if(L[e])return;const r=null===(n=C[e])||void 0===n?void 0:n[t];r&&(delete C[e][t],r.destroy())})(s,e)),.9*X[e]),t.setHandlers({connect:()=>K(t,s,e),close:()=>M(t,s)}),r(a,tt({peerId:Ve,offer:n}))}})(n),B)));Xe([D,I]).then((([e,t])=>{const r=async(a,o)=>{const s=await n(a,e,t);"number"==typeof s&&(X[o]=s),Z[o]=setTimeout((()=>r(a,o)),X[o])};q.forEach((async(e,t)=>{await e,r(await a[t],t)}))}));let Y=Je;return(w=r)[b=E]||(w[b]={}),r[E][k]=((e,t,n)=>{const r={},a={},o={},s={},m={},h={},v={},g={onPeerJoin:Je,onPeerLeave:Je,onPeerStream:Je,onPeerTrack:Je},w=(e,t)=>(e?Array.isArray(e)?e:[e]:Ge(r)).flatMap((e=>{const n=r[e];return n?t(e,n):(console.warn(`${Ke}: no peer with id ${e} found`),[])})),b=e=>{r[e]&&(r[e].destroy(),delete r[e],delete s[e],delete m[e],g.onPeerLeave(e),t(e))},A=e=>{if(a[e])return o[e];if(!e)throw Ne("action type argument is required");const t=Qe(e);if(t.byteLength>12)throw Ne(`action type string "${e}" (${t.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const n=new Uint8Array(12);n.set(t);let s=0;return a[e]={onComplete:Je,onProgress:Je,setOnComplete:t=>a[e]=(0,S.default)((0,P.default)({},a[e]),{onComplete:t}),setOnProgress:t=>a[e]=(0,S.default)((0,P.default)({},a[e]),{onProgress:t}),async send(e,t,a,o){if(a&&"object"!=typeof a)throw Ne("action meta argument must be an object");const i=typeof e;if("undefined"===i)throw Ne("action data cannot be undefined");const c="string"!==i,l=e instanceof Blob,d=l||e instanceof ArrayBuffer||e instanceof wt;if(a&&!d)throw Ne("action meta argument can only be used with binary data");const f=d?new Uint8Array(l?await e.arrayBuffer():e):Qe(c?tt(e):e),u=a?Qe(tt(a)):null,y=Math.ceil(f.byteLength/bt)+(a?1:0)||1,p=Me(y,((e,t)=>{const r=t===y-1,o=a&&0===t,i=new Uint8Array(15+(o?u.byteLength:r?f.byteLength-bt*(y-(a?2:1)):bt));return i.set(n),i.set([s],12),i.set([r|o<<1|d<<2|c<<3],13),i.set([Math.round((t+1)/y*At)],14),i.set(a?o?u:f.subarray((t-1)*bt,t*bt):f.subarray(t*bt,(t+1)*bt),15),i}));return s=s+1&At,Xe(w(t,(async(e,t)=>{const{channel:n}=t;let s=0;for(;s<y;){const i=p[s];if(n.bufferedAmount>n.bufferedAmountLowThreshold&&await new Promise((e=>{const t=()=>{n.removeEventListener(kt,t),e()};n.addEventListener(kt,t)})),!r[e])break;t.sendData(i),s++,null==o||o(i[14]/At,e,a)}})))}},(i=o)[c=e]||(i[c]=[a[e].send,a[e].setOnComplete,a[e].setOnProgress])},k=async()=>{await R(""),await new Promise((e=>setTimeout(e,99))),qe(r).forEach((([e,t])=>{t.destroy(),delete r[e]})),n()},[T,x]=A(Tt("ping")),[E,C]=A(Tt("pong")),[L,U]=A(Tt("signal")),[D,I]=A(Tt("stream")),[$,O]=A(Tt("track")),[R,j]=A(Tt("leave"));return(e=>{Y=e})(((e,t)=>{r[t]||(r[t]=e,e.setHandlers({data:e=>((e,t)=>{const n=new Uint8Array(t),r=Fe(n.subarray(0,12)).replaceAll("\0",""),[o]=n.subarray(12,13),[i]=n.subarray(13,14),[c]=n.subarray(14,15),m=n.subarray(15),h=!!(1&i),v=!!(2&i),g=!!(4&i),w=!!(8&i);if(!a[r])return void console.warn(`${Ke}: received message with unregistered type (${r})`);(l=s)[d=e]||(l[d]={}),(f=s[e])[u=r]||(f[u]={});const b=(y=s[e][r])[p=o]||(y[p]={chunks:[]});if(v?b.meta=nt(Fe(m)):b.chunks.push(m),a[r].onProgress(c/At,e,b.meta),!h)return;const A=new Uint8Array(b.chunks.reduce(((e,t)=>e+t.byteLength),0));if(b.chunks.reduce(((e,t)=>(A.set(t,e),e+t.byteLength)),0),delete s[e][r][o],g)a[r].onComplete(A,e,b.meta);else{const t=Fe(A);a[r].onComplete(w?nt(t):t,e)}})(t,e),stream(e){g.onPeerStream(e,t,h[t]),delete h[t]},track(e,n){g.onPeerTrack(e,n,t,v[t]),delete v[t]},signal:e=>L(e,t),close:()=>b(t),error(e){console.error(e),b(t)}}),g.onPeerJoin(t))})),x(((e,t)=>E("",t))),C(((e,t)=>{var n;null===(n=m[t])||void 0===n||n.call(m),delete m[t]})),U(((e,t)=>{var n;return null===(n=r[t])||void 0===n?void 0:n.signal(e)})),I(((e,t)=>h[t]=e)),O(((e,t)=>v[t]=e)),j(((e,t)=>b(t))),Ze&&addEventListener("beforeunload",k),{makeAction:A,leave:k,async ping(e){if(!e)throw Ne("ping() must be called with target peer ID");const t=Date.now();return T("",e),await new Promise((t=>m[e]=t)),Date.now()-t},getPeers:()=>Ye(qe(r).map((([e,t])=>[e,t.connection]))),addStream:(e,t,n)=>w(t,(async(t,r)=>{n&&await D(n,t),r.addStream(e)})),removeStream:(e,t)=>w(t,((t,n)=>n.removeStream(e))),addTrack:(e,t,n,r)=>w(n,(async(n,a)=>{r&&await $(r,n),a.addTrack(e,t)})),removeTrack:(e,t)=>w(t,((t,n)=>n.removeTrack(e))),replaceTrack:(e,t,n,r)=>w(n,(async(n,a)=>{r&&await $(r,n),a.replaceTrack(e,t)})),onPeerJoin:e=>g.onPeerJoin=e,onPeerLeave:e=>g.onPeerLeave=e,onPeerStream:e=>g.onPeerStream=e,onPeerTrack:e=>g.onPeerTrack=e}})(0,(e=>delete L[e]),(()=>{delete r[E][k],Z.forEach(clearTimeout),q.forEach((async e=>(await e)())),clearInterval(s),m(),h=!1}))}})({init:e=>((e,t,n)=>(e.relayUrls||((e,t)=>{const n=[...e],r=()=>{const e=1e4*He(t++);return e-Re(e)};let a=n.length;for(;a;){const e=Re(r()*a--);[n[a],n[e]]=[n[e],n[a]]}return n})(t,rt(e.appId))).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||5))(e,Mt).map((e=>{const t=((e,t)=>{const n={},r=()=>{const a=new WebSocket(e);a.onclose=()=>{var t;ot?ot.then(r):(null!==(t=(A=at)[k=e])&&void 0!==t||(A[k]=3333),setTimeout(r,at[e]),at[e]*=2)},a.onmessage=e=>t(e.data),n.socket=a,n.url=a.url,n.ready=new Promise((t=>a.onopen=()=>{t(n),at[e]=3333})),n.send=e=>{1===a.readyState&&a.send(e)}};return r(),n})(e,(e=>{var n;const[r,a,o,s]=nt(e);if(r===St)null===(n=Dt[a])||void 0===n||n.call(Dt,Ut[a],o.content);else{const e=`${Ke}: relay failure from ${t.url} - `;"NOTICE"===r?console.warn(e+a):"OK"!==r||o||console.warn(e+s)}}));return Pt[e]=t,t.ready})),subscribe(e,t,n,r){const a=Be(64),o=Be(64);return Dt[a]=Dt[o]=(t,n)=>r(t,n,(async(t,n)=>e.send(await Rt(t,n)))),e.send(jt(a,t)),e.send(jt(o,n)),()=>{e.send(Ht(a)),e.send(Ht(o)),delete Dt[a],delete Dt[o]}},announce:async(e,t)=>e.send(await Rt(t,tt({peerId:Ve})))});const Mt=["black.nostrcity.club","ftp.halifax.rwth-aachen.de/nostr","nos.lol","nostr.cool110.xyz","nostr.data.haus","nostr.sathoarder.com","nostr.vulpem.com","relay.agorist.space","relay.binaryrobot.com","relay.damus.io","relay.fountain.fm","relay.mostro.network","relay.nostraddress.com","relay.nostrdice.com","relay.nostromo.social","relay.oldenburg.cool","relay.verified-nostr.com","yabu.me/v2"].map((e=>"wss://"+e))}));
