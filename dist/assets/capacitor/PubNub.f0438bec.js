var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("hj5SX",(function(s,t){var n,i;n=s.exports,i=function(){return a},Object.defineProperty(n,"Sync",{get:i,set:undefined,enumerable:!0,configurable:!0});var u=e("2Xs1f"),b=e("5Owdb"),o=e("4ekS1");class a extends b.Sync{destroy(){this.pubnub&&(this.pubnub.unsubscribeAll(),this.pubnub.stop()),super.destroy()}async connect(e){super.connect(e),this.publishKey=e.config.publishKey,this.subscribeKey=e.config.subscribeKey,window.PubNub?this.init(!0):this.load(["//cdn.pubnub.com/sdk/javascript/pubnub.4.33.1.min.js"],this)}init(e,s){if(!this.publishKey||!this.subscribeKey)return this.sendDisconnectError("You have to provide a valid pair of keys");const t=this.uniqueID();if(e&&window.PubNub&&t){this.channel=btoa(t),this.pubnub=new PubNub({publishKey:this.publishKey,subscribeKey:this.subscribeKey,uuid:this.token,heartbeatInterval:30,cipherKey:this.password}),this.pubnub.subscribe({channels:[this.channel],withPresence:!0,restore:!1});let e=this;this.pubnub.addListener({status:function(s){o.default.info("PUBNUB status:",s),"PNConnectedCategory"===s.category?e.sendConnect():"PNBadRequestCategory"===s.category&&e.sendDisconnectError(s.errorData.message)},message:function(s){if(s.publisher!==e.token){const[t,n,i]=s.message;t?i==e.db.timestamp?e.applyUpdate(b.base64_to_unit8(n)):i>e.db.timestamp?e.broadcast(!0,e.db.encode()):(e.db.timestamp=i,e.applyUpdate(b.base64_to_unit8(n),!0)):e.pubsubReceive(b.base64_to_unit8(n))}},presence:function(s){"leave"===s.action&&e.db.removePeer(s.uuid)}})}}broadcast(e,s){this.pubnub&&this.pubnub.publish({channel:this.channel,message:[e,b.uint8_to_base64(s),this.db.timestamp],storeInHistory:!1},(function(e,s){}))}constructor(...e){super(...e),(0,u.default)(this,"channel","")}}}));
