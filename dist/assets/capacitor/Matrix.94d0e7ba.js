function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i=r.parcelRequire55a5;i.register("id6ng",(function(t,r){e(t.exports,"Sync",(()=>s));var n=i("4WrLW"),o=i("gehsO");class s extends o.Sync{constructor(e,t){super(e,t,!1)}destroy(){this.client,super.destroy()}connect(e){super.connect(e),this.config=e.config,window.matrixcs?this.init(!0):this.load(["https://cdn.jsdelivr.net/npm/matrix-js-sdk@23.1.1/lib/browser-index.min.js"],this)}init(e,t){const r=this.uniqueID();if(e&&window.matrixcs&&r)try{this.client=window.matrixcs.createClient(this.config);try{this.client.canSupportVoip=!1,this.client.clientOpts={lazyLoadMembers:!0}}catch(e){console.warn("Matrix set protected params failed:",e.message)}this.provider=new(0,n.MatrixProvider)(this.db.doc,this.client,{type:"alias",alias:r}),this.provider.initialize();const e=this;this.db.doc.on("update",((t,r)=>{"exit"===r?e.destroy():e.update()})),this.sendConnect()}catch(e){this.sendDisconnectError("Could not connect to Matrix: "+e.message)}else this.sendDisconnectError("Could not load Matrix browser lib. "+t)}broadcast(e){}}})),i.register("4WrLW",(function(r,n){e(r.exports,"MatrixProvider",(()=>At));var o=i("gqfGh"),s=i("1ZSKT"),a=i("1nB6h"),c=i("fT4bc"),l=i("4pdMn"),u=i("7U5sq"),h=i("9Mq5w"),d=i("awmEs").Buffer;function f(e){return d.from(e).toString("base64")}function p(e){return d.from(e,"base64")}async function m(e,r,i,n){if(!i.signatures||1!==Object.keys(i.signatures).length)throw new Error("invalid signature");const o=Object.keys(i.signatures)[0];if(!r.hasWriteAccess(o,n))throw new Error("user doesn't have write access");const s=Object.keys(i.signatures[o])[0];if(!s.startsWith("ed25519:"))throw new Error("unexpected key");const c=s.substr(8);e.crypto.deviceList.startTrackingDeviceList(o);const l=(await e.crypto.deviceList.downloadKeys([o],!1))[o][c].keys[s];if(!l)throw new Error("key not found");await async function(e,r,i,n,o){const s="ed25519:"+n,c=((r.signatures||{})[i]||{})[s];if(!c)throw Error("No signature");const l=Object.assign({},r);delete l.unsigned,delete l.signatures;const u=t(a).stringify(l);e.verifySignature(o,u,c)}(e.crypto.olmDevice,i,o,c,l)}class g extends o.lifecycle.Disposable{constructor(e,t){super(),this.matrixClient=e,this.reader=t,this.disposed=!1,this.initialized=!1,this.initializing=!1,this.initializeOutdated=!1,this.members=new Map,this.processEvent=e=>{if("m.room.power_levels"===e.type||"m.room.member"===e.type){if(this.initializing)return void(this.initializeOutdated=!0);if(this.initialized){if("m.room.power_levels"===e.type)return void(this.powerLevels=e.content);if("m.room.member"===e.type){if("join"===e.content.membership||"invite"===e.content.membership){const t={displayname:e.content.displayname,user_id:e.state_key};this.members.set(e.state_key,t)}else this.members.delete(e.state_key);return}throw new Error("unexpected")}}},this._register(this.reader.onEvents((e=>e.events.forEach((e=>this.processEvent(e))))))}hasWriteAccess(e,t="m.room.message"){if(!this.members.has(e))return!1;const r=this.powerLevels;let i=r.events[t];void 0===i&&(i=r.events_default);let n=r.users[e];if(void 0===n&&(n=r.users_default),"number"!=typeof n||"number"!=typeof i)throw new Error("unexpected");return n>=i}async initialize(){if(this.initializing||this.initialized)throw new Error("already initializing / initialized");if(!this.reader.isStarted)throw new Error("MatrixReader must have started before initializing MatrixMemberReader");this.initializing=!0;const[e,t]=await Promise.all([this.matrixClient.getStateEvent(this.reader.roomId,"m.room.power_levels",void 0),this.matrixClient.members(this.reader.roomId,void 0,["knock","leave","ban"])]);if(this.initializeOutdated)return this.initializing=!1,this.initializeOutdated=!1,this.initialize();this.powerLevels=e,t.chunk.filter((e=>"m.room.member"===e.type&&("join"===e.content.membership||"invite"===e.content.membership))).forEach((e=>{this.members.set(e.state_key,{displayname:e.content.displayname,user_id:e.state_key})})),this.initializing=!1,this.initialized=!0}dispose(){this.disposed=!0,super.dispose()}}const v={snapshotInterval:30};class y extends o.lifecycle.Disposable{constructor(e,t,r,i={}){super(),this.matrixClient=e,this.roomId=t,this.translator=r,this.disposed=!1,this.polling=!1,this.messagesSinceSnapshot=0,this._onEvents=this._register(new o.event.Emitter),this.onEvents=this._onEvents.event,this.matrixRoomListener=(e,t,r)=>{throw console.error("not expected; Room.timeline on MatrixClient"),new Error("unexpected, we don't use /sync calls for MatrixReader, startClient should not be used on the Matrix client")},this.opts={...v,...i},this.matrixClient.on(c.RoomEvent.Timeline,this.matrixRoomListener)}processIncomingEventsForSnapshot(e){let t=!1;for(let r of e)if(this.translator.isUpdateEvent(r)){if(r.room_id!==this.roomId)throw new Error("event received with invalid roomid");this.messagesSinceSnapshot++,this.messagesSinceSnapshot%this.opts.snapshotInterval==0&&r.user_id===this.matrixClient.credentials.userId&&(t=!0)}else this.translator.isSnapshotEvent(r)&&(this.messagesSinceSnapshot=0,t=!1);return t}async decryptRawEventsIfNecessary(e){return await Promise.all(e.map((async e=>"m.room.encrypted"===e.type?(await this.matrixClient.crypto.decryptEvent(new(0,c.MatrixEvent)(e))).clearEvent:e)))}async peekPoll(){if(!this.latestToken)throw new Error("polling but no pagination token");if(!this.disposed)try{this.pendingPollRequest=this.matrixClient.http.authedRequest(void 0,c.Method.Get,"/events",{room_id:this.roomId,timeout:"30000",from:this.latestToken},void 0,{localTimeoutMs:6e4});const e=await this.pendingPollRequest;if(this.pendingPollRequest=void 0,this.disposed)return;const t=await this.decryptRawEventsIfNecessary(e.chunk),r=this.processIncomingEventsForSnapshot(t);t.length&&this._onEvents.fire({events:t,shouldSendSnapshot:r}),this.latestToken=e.end,this.peekPoll()}catch(e){console.error("peek error",e),this.disposed||(this.pollRetryTimeout=setTimeout((()=>this.peekPoll()),3e4))}}async getInitialDocumentUpdateEvents(e){let t,r=[],i="",n=!0;for(;n;){const o=await this.matrixClient.createMessagesRequest(this.roomId,i,30,c.Direction.Backward),s=await this.decryptRawEventsIfNecessary(o.chunk);for(let i of s)if(e)i.type===e&&r.push(i);else if(this.translator.isSnapshotEvent(i))r.push(i),t=i.content.last_event_id;else if(this.translator.isUpdateEvent(i)){if(t&&t===i.event_id)return this.latestToken||(this.latestToken=o.start),r.reverse();this.messagesSinceSnapshot++,r.push(i)}i=o.end,this.latestToken||(this.latestToken=o.start),n=!(o.start===o.end||!o.end)}return r.reverse()}startPolling(){if(this.polling)throw new Error("already polling");this.polling=!0,this.peekPoll()}get isStarted(){return this.polling}dispose(){this.disposed=!0,super.dispose(),this.pollRetryTimeout&&clearTimeout(this.pollRetryTimeout),this.pendingPollRequest&&this.pendingPollRequest.abort(),this.matrixClient.off(c.RoomEvent.Timeline,this.matrixRoomListener)}}const b=String.fromCharCode,w=/^\s*/g,_=/([A-Z])/g,S=(e,t)=>(e=>e.replace(w,""))(e.replace(_,(e=>`${t}${(e=>e.toLowerCase())(e)}`))),E=typeof TextEncoder<"u"?new TextEncoder:null,M=E?e=>E.encode(e):e=>{const t=unescape(encodeURIComponent(e)),r=t.length,i=new Uint8Array(r);for(let e=0;e<r;e++)i[e]=t.codePointAt(e);return i};let C=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});C&&1===C.decode(new Uint8Array).length&&(C=null);const I=()=>new Map,T=(e,t,r)=>{let i=e.get(t);return void 0===i&&e.set(t,i=r()),i};let k=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},R=!0;try{typeof localStorage<"u"&&(k=localStorage,R=!1)}catch{}const x=k,O=typeof h<"u"&&h.release&&/node|io\.js/.test(h.release.name),A=typeof window<"u"&&!O;let P;typeof navigator<"u"&&/Mac/.test(navigator.platform);const D=e=>(()=>{if(void 0===P)if(O){P=I();const e=h.argv;let t=null;for(let r=0;r<e.length;r++){const i=e[r];"-"===i[0]?(null!==t&&P.set(t,""),t=i):null!==t&&(P.set(t,i),t=null)}null!==t&&P.set(t,"")}else"object"==typeof location?(P=I(),(location.search||"?").slice(1).split("&").forEach((e=>{if(0!==e.length){const[t,r]=e.split("=");P.set(`--${S(t,"-")}`,r),P.set(`-${S(t,"-")}`,r)}}))):P=I();return P})().has(e),L=e=>(e=>void 0===e?null:e)(O?h.env[e.toUpperCase()]:x.getItem(e));var U;D("--"+(U="production"))||L(U);const N=Math.floor,j=Math.abs,B=Math.log10,F=(e,t)=>e<t?e:t,K=(e,t)=>e>t?e:t,q=128,$=127,W=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&N(e)===e);class V{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const H=()=>new V,G=e=>{const t=new Uint8Array((e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t})(e));let r=0;for(let i=0;i<e.bufs.length;i++){const n=e.bufs[i];t.set(n,r),r+=n.length}return t.set(re(e.cbuf.buffer,0,e.cpos),r),t},z=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*r),e.cpos=0),e.cbuf[e.cpos++]=t},Y=z,J=(e,t)=>{for(;t>$;)z(e,q|$&t),t>>>=7;z(e,$&t)},Z=(e,t)=>{const r=unescape(encodeURIComponent(t)),i=r.length;J(e,i);for(let t=0;t<i;t++)z(e,r.codePointAt(t))},Q=(e,t)=>{J(e,t.byteLength),((e,t)=>{const r=e.cbuf.length,i=e.cpos,n=F(r-i,t.length),o=t.length-n;e.cbuf.set(t.subarray(0,n),i),e.cpos+=n,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(K(2*r,o)),e.cbuf.set(t.subarray(n)),e.cpos=o)})(e,t)},X=(e,t)=>{((e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(re(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*K(r,t)),e.cpos=0)})(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},ee=new DataView(new ArrayBuffer(4)),te=(e,t)=>{switch(typeof t){case"string":z(e,119),Z(e,t);break;case"number":W(t)&&j(t)<=2147483647?(z(e,125),((e,t)=>{const r=(e=>0!==e?e<0:1/e<0)(t);for(r&&(t=-t),z(e,(t>63?q:0)|(r?64:0)|63&t),t>>>=6;t>0;)z(e,(t>$?q:0)|$&t),t>>>=7})(e,t)):(e=>(ee.setFloat32(0,e),ee.getFloat32(0)===e))(t)?(z(e,124),((e,t)=>{X(e,4).setFloat32(0,t,!1)})(e,t)):(z(e,123),((e,t)=>{X(e,8).setFloat64(0,t,!1)})(e,t));break;case"bigint":z(e,122),((e,t)=>{X(e,8).setBigInt64(0,t,!1)})(e,t);break;case"object":if(null===t)z(e,126);else if(t instanceof Array){z(e,117),J(e,t.length);for(let r=0;r<t.length;r++)te(e,t[r])}else if(t instanceof Uint8Array)z(e,116),Q(e,t);else{z(e,118);const r=Object.keys(t);J(e,r.length);for(let i=0;i<r.length;i++){const n=r[i];Z(e,n),te(e,t[n])}}break;case"boolean":z(e,t?120:121);break;default:z(e,127)}},re=(e,t,r)=>new Uint8Array(e,t,r),ie=A?e=>{let t="";for(let r=0;r<e.byteLength;r++)t+=b(e[r]);return btoa(t)}:e=>d.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),ne=A?e=>{const t=atob(e),r=(e=>new Uint8Array(e))(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}:e=>{const t=d.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)};class oe{constructor(e){this.arr=e,this.pos=0}}const se=e=>new oe(e),ae=e=>((e,t)=>{const r=re(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r})(e,le(e)),ce=e=>e.arr[e.pos++],le=e=>{let t=0,r=0;for(;;){const i=e.arr[e.pos++];if(t|=(i&$)<<r,r+=7,i<q)return t>>>0;if(r>53)throw new Error("Integer out of range!")}},ue=e=>{let t=le(e);if(0===t)return"";{let r=String.fromCodePoint(ce(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(ce(e));else for(;t>0;){const i=t<1e4?t:1e4,n=e.arr.subarray(e.pos,e.pos+i);e.pos+=i,r+=String.fromCodePoint.apply(null,n),t-=i}return decodeURIComponent(escape(r))}},he=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},de=[e=>{},e=>null,e=>{let t=e.arr[e.pos++],r=63&t,i=6;const n=(64&t)>0?-1:1;if(0==(t&q))return n*r;for(;;){if(t=e.arr[e.pos++],r|=(t&$)<<i,i+=7,t<q)return n*(r>>>0);if(i>53)throw new Error("Integer out of range!")}},e=>he(e,4).getFloat32(0,!1),e=>he(e,8).getFloat64(0,!1),e=>he(e,8).getBigInt64(0,!1),e=>!1,e=>!0,ue,e=>{const t=le(e),r={};for(let i=0;i<t;i++){r[ue(e)]=fe(e)}return r},e=>{const t=le(e),r=[];for(let i=0;i<t;i++)r.push(fe(e));return r},ae],fe=e=>de[127-ce(e)](e),pe=Date.now,me=()=>new Set,ge=Array.from;class ve{constructor(){this._observers=I()}on(e,t){T(this._observers,e,me).add(t)}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return ge((this._observers.get(e)||I()).values()).forEach((e=>e(...t)))}destroy(){this._observers=I()}}const ye=Object.keys,be=e=>ye(e).length,we=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),_e=()=>{},Se=(e,t)=>{if(null==e||null==t)return((e,t)=>e===t)(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;break;case Set:if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;break;case Map:if(e.size!==t.size)return!1;for(const r of e.keys())if(!t.has(r)||!Se(e.get(r),t.get(r)))return!1;break;case Object:if(be(e)!==be(t))return!1;for(const r in e)if(!we(e,r)||!Se(e[r],t[r]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Se(e[r],t[r]))return!1;break;default:return!1}return!0},Ee=3e4;class Me extends ve{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const e=pe();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach(((r,i)=>{i!==this.clientID&&Ee<=e-r.lastUpdated&&this.states.has(i)&&t.push(i)})),t.length>0&&Ce(this,t,"timeout")}),N(3e3)),e.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,r=this.meta.get(t),i=void 0===r?0:r.clock+1,n=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:i,lastUpdated:pe()});const o=[],s=[],a=[],c=[];null===e?c.push(t):null==n?null!=e&&o.push(t):(s.push(t),Se(n,e)||a.push(t)),(o.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:o,updated:a,removed:c},"local"]),this.emit("update",[{added:o,updated:s,removed:c},"local"])}setLocalStateField(e,t){const r=this.getLocalState();null!==r&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}}const Ce=(e,t,r)=>{const i=[];for(let r=0;r<t.length;r++){const n=t[r];if(e.states.has(n)){if(e.states.delete(n),n===e.clientID){const t=e.meta.get(n);e.meta.set(n,{clock:t.clock+1,lastUpdated:pe()})}i.push(n)}}i.length>0&&(e.emit("change",[{added:[],updated:[],removed:i},r]),e.emit("update",[{added:[],updated:[],removed:i},r]))},Ie=(e,t,r=e.states)=>{const i=t.length,n=H();J(n,i);for(let o=0;o<i;o++){const i=t[o],s=r.get(i)||null,a=e.meta.get(i).clock;J(n,i),J(n,a),Z(n,JSON.stringify(s))}return G(n)},Te=(e,t,r)=>{const i=se(t),n=pe(),o=[],s=[],a=[],c=[],l=le(i);for(let t=0;t<l;t++){const t=le(i);let r=le(i);const l=JSON.parse(ue(i)),u=e.meta.get(t),h=e.states.get(t),d=void 0===u?0:u.clock;(d<r||d===r&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?r++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:r,lastUpdated:n}),void 0===u&&null!==l?o.push(t):void 0!==u&&null===l?c.push(t):null!==l&&(Se(l,h)||a.push(t),s.push(t)))}(o.length>0||a.length>0||c.length>0)&&e.emit("change",[{added:o,updated:a,removed:c},r]),(o.length>0||s.length>0||c.length>0)&&e.emit("update",[{added:o,updated:s,removed:c},r])},ke=(e,t,r)=>((e,t,r)=>{J(e,1),Q(e,s.encodeStateAsUpdate(t,r))})(t,r,ae(e)),Re=(e,t,r)=>{try{s.applyUpdate(t,ae(e),r)}catch(e){console.error("Caught error while handling a Yjs update",e)}},xe=(e,t)=>{J(e,2),Q(e,t)},Oe=Re,Ae=(e,t,r,i)=>{const n=le(e);switch(n){case 0:ke(e,t,r);break;case 1:Re(e,r,i);break;case 2:Oe(e,r,i);break;default:throw new Error("Unknown message type")}return n},Pe=Symbol;class De{constructor(e,t){this.left=e,this.right=t}}const Le=(e,t)=>new De(e,t),Ue=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;const Ne=e=>((e,t)=>{const r=[];for(const[i,n]of e)r.push(t(n,i));return r})(e,((e,t)=>`${t}:${e};`)).join("");Ue.ELEMENT_NODE,Ue.TEXT_NODE,Ue.CDATA_SECTION_NODE,Ue.COMMENT_NODE,Ue.DOCUMENT_NODE,Ue.DOCUMENT_TYPE_NODE,Ue.DOCUMENT_FRAGMENT_NODE;const je=Pe(),Be=Pe(),Fe=Pe(),Ke=Pe(),qe=Pe(),$e=Pe(),We=Pe(),Ve=Pe(),He=Pe(),Ge={[je]:Le("font-weight","bold"),[Be]:Le("font-weight","normal"),[Fe]:Le("color","blue"),[qe]:Le("color","green"),[Ke]:Le("color","grey"),[$e]:Le("color","red"),[We]:Le("color","purple"),[Ve]:Le("color","orange"),[He]:Le("color","black")},ze={[je]:"[1m",[Be]:"[2m",[Fe]:"[34m",[qe]:"[32m",[Ke]:"[37m",[$e]:"[31m",[We]:"[35m",[Ve]:"[38;5;208m",[He]:"[0m"},Ye=O?e=>{const t=[],r=[];let i=0;for(;i<e.length;i++){const r=e[i],n=ze[r];if(void 0!==n)t.push(n);else{if(r.constructor!==String&&r.constructor!==Number)break;t.push(r)}}for(i>0&&(t.push("[0m"),r.push(t.join("")));i<e.length;i++){const t=e[i];t instanceof Symbol||r.push(t)}return r}:e=>{const t=[],r=[],i=I();let n=[],o=0;for(;o<e.length;o++){const n=e[o],s=Ge[n];if(void 0!==s)i.set(s.left,s.right);else{if(n.constructor!==String&&n.constructor!==Number)break;{const e=Ne(i);o>0||e.length>0?(t.push("%c"+n),r.push(e)):t.push(n)}}}for(o>0&&(n=r,n.unshift(t.join("")));o<e.length;o++){const t=e[o];t instanceof Symbol||n.push(t)}return n},Je=new Set,Ze=[qe,We,Ve,Fe];let Qe=0,Xe=pe();const et=e=>{const t=Ze[Qe],r=L("log"),i=null!==r&&("*"===r||"true"===r||new RegExp(r,"gi").test(e));return Qe=(Qe+1)%Ze.length,e+=": ",i?(...r)=>{const i=pe(),n=i-Xe;Xe=i,((...e)=>{console.log(...Ye(e)),Je.forEach((t=>t.print(e)))})(t,e,He,...r.map((e=>"string"==typeof e||"symbol"==typeof e?e:JSON.stringify(e))),t," +"+n+"ms")}:_e},tt=e=>new Error(e),rt=typeof crypto>"u"?null:crypto,it=null!==rt?e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);return rt.getRandomValues(r),t}:e=>{const t=new ArrayBuffer(e),r=new Uint8Array(t);for(let t=0;t<e;t++)r[t]=Math.ceil(4294967295*Math.random()>>>0);return t},nt=Math.random,ot=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^new Uint32Array(it(4))[0]&15>>e/4).toString(16))),st=async(e,t)=>{if(!t)return e;const r=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,e).then((e=>{const t=H();return Z(t,"AES-GCM"),Q(t,r),Q(t,new Uint8Array(e)),G(t)}))},at=async(e,t)=>{if(!t)return e;const r=se(e);"AES-GCM"!==ue(r)&&(e=>{Promise.reject(e)})(tt("Unknown encryption algorithm"));const i=ae(r),n=ae(r);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,n).then((e=>new Uint8Array(e)))},ct=new Map,lt=new Map;function ut(e){ct.forEach((t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&t.publishSignalingMessage(e,{type:"announce",from:e.peerId}))}))}const ht=new Map;const dt=typeof BroadcastChannel>"u"?class{constructor(e){this.room=e,this.onmessage=null,(e=>{R||addEventListener("storage",e)})((t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:ne(t.newValue||"")})))}postMessage(e){x.setItem(this.room,ie((e=>new Uint8Array(e))(e)))}}:BroadcastChannel,ft=e=>T(ht,e,(()=>{const t=new Set,r=new dt(e);return r.onmessage=e=>t.forEach((t=>t(e.data,"broadcastchannel"))),{bc:r,subs:t}})),pt=et("y-webrtc");class mt{constructor(e,t,r,i,n){this.provider=e,this.onCustomMessage=t,this.onPeerConnected=r,this.name=i,this.key=n,this.peerId=ot(),this.synced=!1,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=(()=>{let e=!0;return(t,r)=>{if(e){e=!1;try{t()}finally{e=!0}}else void 0!==r&&r()}})(),this.bcconnected=!1,this._bcSubscriber=e=>at(new Uint8Array(e),this.key).then((e=>this.mux((()=>{this.readMessage(e,(e=>{this.broadcastBcMessage(G(e))}))})))),this.readMessage=(e,t)=>{const r=se(e),i=H(),n=e=>{J(i,5),Q(i,e),t(i)};switch(le(r)){case 5:this.onCustomMessage(ae(r),n);break;case 4:{const e=1===ce(r),t=ue(r);if(t!==this.peerId&&(this.bcConns.has(t)&&!e||!this.bcConns.has(t)&&e)){const r=[],i=[];e?(this.bcConns.add(t),i.push(t),this.onPeerConnected(n)):(this.bcConns.delete(t),r.push(t)),this.provider.emit("peers",[{added:i,removed:r,webrtcPeers:Array.from(this.webrtcConns.keys()),bcPeers:Array.from(this.bcConns)}]),this.broadcastBcPeerId()}break}default:return void console.error("Unable to compute message")}}}broadcastBcPeerId(){if(this.provider.filterBcConns){const e=H();J(e,4),Y(e,1),Z(e,this.peerId),this.broadcastBcMessage(G(e))}}broadcastWebrtcConn(e){pt("broadcast message in ",je,this.name,Be),this.webrtcConns.forEach((t=>{try{t.peer.send(e)}catch{}}))}broadcastRoomMessage(e){const t=H();J(t,5),Q(t,e);const r=G(t);this.bcconnected&&this.broadcastBcMessage(r),this.broadcastWebrtcConn(r)}broadcastBcMessage(e){return st(e,this.key).then((e=>this.mux((()=>((e,t,r=null)=>{const i=ft(e);i.bc.postMessage(t),i.subs.forEach((e=>e(t,r)))})(this.name,e)))))}connect(){ut(this);((e,t)=>{ft(e).subs.add(t)})(this.name,this._bcSubscriber),this.bcconnected=!0,this.broadcastBcPeerId()}disconnect(){ct.forEach((e=>{e.connected&&e.send({type:"unsubscribe",topics:[this.name]})}));const e=H();J(e,4),Y(e,0),Z(e,this.peerId),this.broadcastBcMessage(G(e)),((e,t)=>{ft(e).subs.delete(t)})(this.name,this._bcSubscriber),this.bcconnected=!1,this.webrtcConns.forEach((e=>e.destroy()))}destroy(){this.disconnect()}}const gt=3e4,vt=e=>{if(e.shouldConnect&&null===e.ws){const t=new WebSocket(e.url),r=e.binaryType;let i=null;r&&(t.binaryType=r),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=t=>{e.lastMessageReceived=pe();const r=t.data,n="string"==typeof r?JSON.parse(r):r;n&&"pong"===n.type&&(clearTimeout(i),i=setTimeout(o,15e3)),e.emit("message",[n,e])};const n=t=>{null!==e.ws&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:t},e])):e.unsuccessfulReconnects++,setTimeout(vt,F(1200*B(e.unsuccessfulReconnects+1),2500),e)),clearTimeout(i)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>n(null),t.onerror=e=>n(e),t.onopen=()=>{e.lastMessageReceived=pe(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),i=setTimeout(o,15e3)}}};class yt extends ve{constructor(e,{binaryType:t}={}){super(),this.url=e,this.ws=null,this.binaryType=t||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval((()=>{this.connected&&gt<pe()-this.lastMessageReceived&&this.ws.close()}),15e3),vt(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&null===this.ws&&vt(this)}}const bt=et("y-webrtc");class wt{constructor(e,r,i,n){this.remotePeerId=i,this.room=n,this.closed=!1,this.connected=!1,this.synced=!1,bt("establishing connection to ",je,i),this.peer=new(t(l))({initiator:r,...n.provider.peerOpts}),this.peer.on("signal",(t=>{e.publishSignalingMessage(n,{to:i,from:n.peerId,type:"signal",signal:t})})),this.peer.on("connect",(()=>{bt("connected to ",je,i),this.connected=!0,n.onPeerConnected((e=>{const t=H();J(t,5),Q(t,e),this.sendWebrtcConn(t)}))})),this.peer.on("close",(()=>{this.connected=!1,this.closed=!0,n.webrtcConns.has(this.remotePeerId)&&(n.webrtcConns.delete(this.remotePeerId),n.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(n.webrtcConns.keys()),bcPeers:Array.from(n.bcConns)}])),this.peer.destroy(),bt("closed connection to ",je,i),ut(n)})),this.peer.on("error",(e=>{bt("Error in connection to ",je,i,": ",e),ut(n)})),this.peer.on("data",(e=>{bt("received message from ",je,this.remotePeerId,Ke," (",n.name,")",Be,He),this.room.readMessage(e,(e=>{this.sendWebrtcConn(e)}))}))}sendWebrtcConn(e){bt("send message to ",je,this.remotePeerId,Be,Ke," (",this.room.name,")",He);try{this.peer.send(G(e))}catch{}}destroy(){this.peer.destroy()}}const _t=et("y-webrtc");class St extends yt{constructor(e){super(e),this.providers=new Set,this.publishSignalingMessage=(e,t)=>{e.key?((e,t)=>{const r=H();return te(r,e),st(G(r),t)})(t,e.key).then((t=>{this.send({type:"publish",topic:e.name,data:ie(t)})})):this.send({type:"publish",topic:e.name,data:t})},this.on("connect",(()=>{_t(`connected (${e})`);const t=Array.from(lt.keys());this.send({type:"subscribe",topics:t}),lt.forEach((e=>this.publishSignalingMessage(e,{type:"announce",from:e.peerId})))})),this.on("message",(e=>{if("publish"===e.type){const t=e.topic,r=lt.get(t);if(null==r||"string"!=typeof t)return;const i=e=>{const t=r.webrtcConns,i=r.peerId;if(null==e||e.from===i||void 0!==e.to&&e.to!==i||r.bcConns.has(e.from))return;const n=t.has(e.from)?()=>{}:()=>r.provider.emit("peers",[{removed:[],added:[e.from],webrtcPeers:Array.from(r.webrtcConns.keys()),bcPeers:Array.from(r.bcConns)}]);switch(e.type){case"announce":t.size<r.provider.maxConns&&(T(t,e.from,(()=>new wt(this,!0,e.from,r))),n());break;case"signal":e.to===i&&(T(t,e.from,(()=>new wt(this,!1,e.from,r))).peer.signal(e.signal),n())}};r.key?"string"==typeof e.data&&((e,t)=>at(e,t).then((e=>fe(se(new Uint8Array(e))))))(ne(e.data),r.key).then(i):i(e.data)}})),this.on("disconnect",(()=>_t(`disconnect (${e})`)))}}et("y-webrtc");class Et extends ve{constructor(e,{signaling:t=["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"],password:r,maxConns:i=20+N(15*nt()),filterBcConns:n=!0,peerOpts:o={}}={}){super(),this.roomName=e,this.shouldConnect=!1,this.filterBcConns=!0,this.filterBcConns=n,this.shouldConnect=!1,this.signalingUrls=t,this.signalingConns=[],this.maxConns=i,this.peerOpts={iceServers:[]},this.key=r?((e,t)=>{const r=M(e).buffer,i=M(t).buffer;return crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"]).then((e=>crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])))})(r,e):Promise.resolve(void 0),this.key.then((t=>{this.room=((e,t,r,i,n)=>{if(lt.has(i))throw tt(`A Yjs Doc connected to room "${i}" already exists!`);const o=new mt(e,t,r,i,n);return lt.set(i,o),o})(this,this.onCustomMessage,this.onPeerConnected,e,t),this.shouldConnect?this.room.connect():this.room.disconnect()})),this.connect()}get connected(){return null!==this.room&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach((e=>{const t=T(ct,e,(()=>new St(e)));this.signalingConns.push(t),t.providers.add(this)})),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach((e=>{e.providers.delete(this),0===e.providers.size&&(e.destroy(),ct.delete(e.url))})),this.room&&this.room.disconnect()}destroy(){this.key.then((()=>{var e;null==(e=this.room)||e.destroy(),lt.delete(this.roomName)})),super.destroy()}}const Mt=et("y-webrtc");class Ct extends Et{constructor(e,t,r,i,n,o,s=new Me(e)){super(t,{password:r,...o}),this.doc=e,this.roomPassword=r,this.sign=i,this.verify=n,this.awareness=s,this.onCustomMessage=(e,t)=>{const r=se(e),i=H();switch(le(r)){case 0:{const e=fe(r);this.verify(e).then((()=>{const t=p(e.message),r=se(t);if(2!==Ae(r,i,this.doc,this))throw Mt("error: expect only updates"),new Error("error: only update messages expected")}),(e=>{console.error("couldn't verify message")}));break}case 1:Te(this.awareness,ae(r),this)}},this.onPeerConnected=e=>{const t=H(),r=this.awareness.getStates();r.size>0&&(J(t,1),Q(t,Ie(this.awareness,Array.from(r.keys()))),e(G(t)))},this._docUpdateHandler=async(e,t)=>{if(!this.room)return;const r=H();J(r,0);const i=H();xe(i,e);const n={message:f(G(i))};await this.sign(n),te(r,n),this.room.broadcastRoomMessage(G(r))},this._awarenessUpdateHandler=({added:e,updated:t,removed:r},i)=>{if(!this.room)return;const n=e.concat(t).concat(r);Mt("awareness change ",{added:e,updated:t,removed:r},"local",this.awareness.clientID);const o=H();J(o,1),Q(o,Ie(this.awareness,n)),this.room.broadcastRoomMessage(G(o))},e.on("destroy",this.destroy.bind(this)),this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),window.addEventListener("beforeunload",(()=>{Ce(this.awareness,[e.clientID],"window unload"),lt.forEach((e=>{e.disconnect()}))}))}destroy(){this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("destroy",this.destroy),super.destroy()}}const It={flushInterval:500,retryIfForbiddenInterval:3e4};class Tt extends o.lifecycle.Disposable{constructor(e,t,r={}){super(),this.matrixClient=e,this.translator=t,this.pendingUpdates=[],this.isSendingUpdates=!1,this._canWrite=!0,this._onCanWriteChanged=this._register(new o.event.Emitter),this.onCanWriteChanged=this._onCanWriteChanged.event,this._onSentAllEvents=this._register(new o.event.Emitter),this.onSentAllEvents=this._onSentAllEvents.event,this.flushUpdatesToMatrix=async()=>{if(this.isSendingUpdates||!this.pendingUpdates.length||!this.roomId)return;this.isSendingUpdates=!0;const e=s.mergeUpdates(this.pendingUpdates);this.pendingUpdates=[];let t=!1;try{console.log("Sending updates"),await this.translator.sendUpdate(this.matrixClient,this.roomId,e),this.setCanWrite(!0),console.log("sent updates")}catch(r){if("M_FORBIDDEN"===r.errcode){console.warn("not allowed to edit document",r),this.setCanWrite(!1);try{await this.matrixClient.joinRoom(this.roomId),console.log("joined room",this.roomId),t=!0}catch(e){console.warn("failed to join room",e)}}else console.error("error sending updates",r);this.pendingUpdates.unshift(e)}finally{this.isSendingUpdates=!1}this.pendingUpdates.length?this.retryTimeoutHandler=setTimeout((()=>{this.throttledFlushUpdatesToMatrix()}),t?0:this.canWrite?this.opts.flushInterval:this.opts.retryIfForbiddenInterval):(console.log("_onSentAllEvents"),this._onSentAllEvents.fire())},this.opts={...It,...r},this.throttledFlushUpdatesToMatrix=u.throttle(this.flushUpdatesToMatrix,this.canWrite?this.opts.flushInterval:this.opts.retryIfForbiddenInterval)}setCanWrite(e){this._canWrite!==e&&(this._canWrite=e,this._onCanWriteChanged.fire())}async initialize(e){this.roomId=e,this.throttledFlushUpdatesToMatrix()}get canWrite(){return this._canWrite}writeUpdate(e){this.pendingUpdates.push(e),this.throttledFlushUpdatesToMatrix()}async waitForFlush(){!this.pendingUpdates.length&&!this.isSendingUpdates||await o.event.Event.toPromise(this.onSentAllEvents)}dispose(){super.dispose(),clearTimeout(this.retryTimeoutHandler),this.throttledFlushUpdatesToMatrix.cancel()}}const kt="m.room.message",Rt={updatesAsRegularMessages:!1,updateEventType:"matrix-crdt.doc_update",snapshotEventType:"matrix-crdt.doc_snapshot"};class xt{constructor(e={}){this.opts={...Rt,...e}}async sendUpdate(e,t,r){const i=f(r),n={update:i};if(this.opts.updatesAsRegularMessages){const r={body:this.opts.updateEventType+": "+i,msgtype:this.opts.updateEventType,...n};e.scheduler=void 0,await e.sendEvent(t,kt,r,"")}else await e.sendEvent(t,this.opts.updateEventType,n,"")}async sendSnapshot(e,t,r,i){const n=f(r),o={update:n,last_event_id:i};if(this.opts.updatesAsRegularMessages){const r={body:this.opts.snapshotEventType+": "+n,msgtype:this.opts.snapshotEventType,...o};e.scheduler=void 0,await e.sendEvent(t,kt,r,"")}else await e.sendEvent(t,this.opts.snapshotEventType,o,"")}isUpdateEvent(e){return this.opts.updatesAsRegularMessages?e.type===kt&&e.content.msgtype===this.opts.updateEventType:e.type===this.opts.updateEventType}isSnapshotEvent(e){return this.opts.updatesAsRegularMessages?e.type===kt&&e.content.msgtype===this.opts.snapshotEventType:e.type===this.opts.snapshotEventType}get WrappedEventType(){return this.opts.updatesAsRegularMessages?kt:this.opts.updateEventType}}const Ot={enableExperimentalWebrtcSync:!1,reader:{},writer:{},translator:{}};class At extends o.lifecycle.Disposable{constructor(e,t,r,i,n={}){if(super(),this.doc=e,this.matrixClient=t,this.room=r,this.awareness=i,this.disposed=!1,this.initializedPromise=new Promise((e=>{this.initializedResolve=e})),this._onDocumentAvailable=this._register(new o.event.Emitter),this._onDocumentUnavailable=this._register(new o.event.Emitter),this._onReceivedEvents=this._register(new o.event.Emitter),this.onDocumentAvailable=this._onDocumentAvailable.event,this.onReceivedEvents=this._onReceivedEvents.event,this.onDocumentUnavailable=this._onDocumentUnavailable.event,this.totalEventsReceived=0,this.documentUpdateListener=async(e,t)=>{t===this||this.webrtcProvider&&t===this.webrtcProvider||null!=t&&t.provider||this.throttledWriter.writeUpdate(e)},this.processIncomingEvents=(e,t=!1)=>{e=e.filter((e=>!(!this.translator.isUpdateEvent(e)&&!this.translator.isSnapshotEvent(e)))),this.totalEventsReceived+=e.length;const r=e.map((e=>new Uint8Array(p(e.content.update)))),i=s.mergeUpdates(r);if(!r.length)return i;if(s.applyUpdate(this.doc,i,this),t){const t=e[e.length-1],r=s.encodeStateAsUpdate(this.doc);this.translator.sendSnapshot(this.matrixClient,this._roomId,r,t.event_id).catch((e=>{console.error("failed to send snapshot")}))}return e.filter((e=>e.user_id!==this.matrixClient.credentials.userId)).length&&this._onReceivedEvents.fire(),i},i&&!n.enableExperimentalWebrtcSync)throw new Error("awareness is only supported when using enableExperimentalWebrtcSync=true");this.opts={...Ot,...n},this.translator=new xt(this.opts.translator),this.throttledWriter=new Tt(this.matrixClient,this.translator,this.opts.writer),e.on("update",this.documentUpdateListener)}get onCanWriteChanged(){return this.throttledWriter.onCanWriteChanged}get canWrite(){return this.throttledWriter.canWrite}get roomId(){return this._roomId}get matrixReader(){return this.reader}async initializeWebrtc(){if(!this._roomId)throw new Error("not initialized");if(!this.reader)throw new Error("needs reader to initialize webrtc");const e=this._register(new g(this.matrixClient,this.reader));await e.initialize(),this.webrtcProvider=new Ct(this.doc,this._roomId,this._roomId,(async e=>{await async function(e,t){await e.crypto.signObject(t)}(this.matrixClient,e)}),(async t=>{await m(this.matrixClient,e,t,this.translator.WrappedEventType)}),void 0,this.awareness)}async initializeNoCatch(){const e="id"===this.room.type?this.room.id:this.room.alias;try{if("id"===this.room.type)this._roomId=this.room.id;else if("alias"===this.room.type){const e=await this.matrixClient.getRoomIdForAlias(this.room.alias);this._roomId=e.room_id}if(!this._roomId)throw new Error("error receiving room id");console.log("room resolved",this._roomId),await this.throttledWriter.initialize(this._roomId)}catch(t){let r=5e3;return"M_NOT_FOUND"===t.errcode?(console.log("room not found",e),this._onDocumentUnavailable.fire()):"ConnectionError"===t.name?console.log("room not found (offline)",e):(console.error("error retrieving room",e,t),r=3e4,this._onDocumentUnavailable.fire()),void(this.initializeTimeoutHandler=setTimeout((()=>{this.initialize()}),r))}let t=s.encodeStateAsUpdate(this.doc);const r=s.encodeStateVectorFromUpdate(t),i=s.diffUpdate(t,r);let n=s.snapshot(this.doc);const o=await this.initializeReader();this._onDocumentAvailable.fire();const a=s.encodeStateVectorFromUpdate(o),c=s.diffUpdate(t,a);if(function(e,t){return function(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e.getUint8(r)!==t.getUint8(r))return!1;return!0}(new DataView(e),new DataView(t))}(i.buffer,c.buffer)){let e=new s.Doc;if(s.applyUpdate(e,o),function(e,t){for(const[r,i]of t.ds.clients.entries()){const t=e.ds.clients.get(r)||[];if(i.length>t.length)return!1;for(let e=0;e<i.length;e++){const r=i[e],n=t[e];if(r.clock!==n.clock||r.len!==n.len)return!1}}return!0}(s.snapshot(e),n))return void this.initializedResolve()}c.length>2&&this.throttledWriter.writeUpdate(c),this.initializedResolve()}async initializeReader(){if(this.reader)throw new Error("already initialized reader");if(!this._roomId)throw new Error("no roomId");this.reader=this._register(new y(this.matrixClient,this._roomId,this.translator,this.opts.reader)),this._register(this.reader.onEvents((e=>this.processIncomingEvents(e.events,e.shouldSendSnapshot))));const e=await this.reader.getInitialDocumentUpdateEvents();return this.reader.startPolling(),this.processIncomingEvents(e)}async waitForFlush(){await this.initializedPromise,await this.throttledWriter.waitForFlush()}async initialize(){try{await this.initializeNoCatch(),await this.initializedPromise,!this.disposed&&this.opts.enableExperimentalWebrtcSync&&await this.initializeWebrtc()}catch(e){throw console.error(e),e}}dispose(){var e,t;super.dispose(),this.disposed=!0,null==(e=this.webrtcProvider)||e.destroy(),null==(t=this.reader)||t.dispose(),clearTimeout(this.initializeTimeoutHandler),this.doc.off("update",this.documentUpdateListener)}}et("y-webrtc")})),i.register("gqfGh",(function(t,n){e(t.exports,"lifecycle",(()=>w)),e(t.exports,"event",(()=>Se));i("awmEs").Buffer;var o=i("9Mq5w");function s(e,t,...r){return function(e,t){let r;return r=0===t.length?e:e.replace(/\{(\d+)\}/g,(function(e,r){const i=r[0];return void 0!==t[i]?t[i]:e})),r}(t,r)}function a(e){const t=this;let r,i=!1;return function(){return i||(i=!0,r=e.apply(t,arguments)),r}}var c;!function(e){e.is=function(e){return e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator]};const t=Object.freeze([]);e.empty=function(){return t},e.single=function*(e){yield e},e.from=function(e){return e||t},e.isEmpty=function(e){return!e||!0===e[Symbol.iterator]().next().done},e.first=function(e){return e[Symbol.iterator]().next().value},e.some=function(e,t){for(const r of e)if(t(r))return!0;return!1},e.find=function(e,t){for(const r of e)if(t(r))return r},e.filter=function*(e,t){for(const r of e)t(r)&&(yield r)},e.map=function*(e,t){let r=0;for(const i of e)yield t(i,r++)},e.concat=function*(...e){for(const t of e)for(const e of t)yield e},e.concatNested=function*(e){for(const t of e)for(const e of t)yield e},e.reduce=function(e,t,r){let i=r;for(const r of e)i=t(i,r);return i},e.slice=function*(e,t,r=e.length){for(t<0&&(t+=e.length),r<0?r+=e.length:r>e.length&&(r=e.length);t<r;t++)yield e[t]},e.consume=function(t,r=Number.POSITIVE_INFINITY){const i=[];if(0===r)return[i,t];const n=t[Symbol.iterator]();for(let t=0;t<r;t++){const t=n.next();if(t.done)return[i,e.empty()];i.push(t.value)}return[i,{[Symbol.iterator]:()=>n}]},e.equals=function(e,t,r=((e,t)=>e===t)){const i=e[Symbol.iterator](),n=t[Symbol.iterator]();for(;;){const e=i.next(),t=n.next();if(e.done!==t.done)return!1;if(e.done)return!0;if(!r(e.value,t.value))return!1}}}(c||(c={}));let l=null;function u(e){var t;return null==(t=l)||t.trackDisposable(e),e}function h(e){var t;null==(t=l)||t.markAsDisposed(e)}function d(e,t){var r;null==(r=l)||r.setParent(e,t)}class f extends Error{constructor(e){super(`Encountered errors while disposing of store. Errors: [${e.join(", ")}]`),this.errors=e}}function p(e){if(c.is(e)){let t=[];for(const r of e)if(r)try{r.dispose()}catch(e){t.push(e)}if(1===t.length)throw t[0];if(t.length>1)throw new f(t);return Array.isArray(e)?[]:e}if(e)return e.dispose(),e}function m(...e){const t=g((()=>p(e)));return function(e,t){if(l)for(const r of e)l.setParent(r,t)}(e,t),t}function g(e){const t=u({dispose:a((()=>{h(t),e()}))});return t}class v{constructor(){this._toDispose=new Set,this._isDisposed=!1,u(this)}dispose(){this._isDisposed||(h(this),this._isDisposed=!0,this.clear())}clear(){try{p(this._toDispose.values())}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return d(e,this),this._isDisposed?v.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}}v.DISABLE_DISPOSED_WARNING=!1;class y{constructor(){this._store=new v,u(this),d(this._store,this)}dispose(){h(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}}y.None=Object.freeze({dispose(){}});class b{constructor(){this._isDisposed=!1,u(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||(null==(t=this._value)||t.dispose(),e&&d(e,this),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,h(this),null==(e=this._value)||e.dispose(),this._value=void 0}clearAndLeak(){const e=this._value;return this._value=void 0,e&&d(e,null),e}}var w={__proto__:null,setDisposableTracker:function(e){l=e},markAsSingleton:function(e){var t;return null==(t=l)||t.markAsSingleton(e),e},MultiDisposeError:f,isDisposable:function(e){return"function"==typeof e.dispose&&0===e.dispose.length},dispose:p,combinedDisposable:m,toDisposable:g,DisposableStore:v,Disposable:y,MutableDisposable:b,RefCountedDisposable:class{constructor(e){this._disposable=e,this._counter=1}acquire(){return this._counter++,this}release(){return 0==--this._counter&&this._disposable.dispose(),this}},ReferenceCollection:class{constructor(){this.references=new Map}acquire(e,...t){let r=this.references.get(e);r||(r={counter:0,object:this.createReferencedObject(e,...t)},this.references.set(e,r));const{object:i}=r,n=a((()=>{0==--r.counter&&(this.destroyReferencedObject(e,r.object),this.references.delete(e))}));return r.counter++,{object:i,dispose:n}}},AsyncReferenceCollection:class{constructor(e){this.referenceCollection=e}async acquire(e,...t){const r=this.referenceCollection.acquire(e,...t);try{return{object:await r.object,dispose:()=>r.dispose()}}catch(e){throw r.dispose(),e}}},ImmortalReference:class{constructor(e){this.object=e}dispose(){}}};function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_.apply(this,arguments)}class S{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout((()=>{if(e.stack)throw new Error(e.message+"\n\n"+e.stack);throw e}),0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach((t=>{t(e)}))}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}}const E=new S;function M(e){I(e)||E.onUnexpectedError(e)}const C="Canceled";function I(e){return e instanceof Error&&e.name===C&&e.message===C}class T extends Error{constructor(){super(C),this.name=this.message}}class k extends Error{constructor(e){super("NotImplemented"),e&&(this.message=e)}}class R extends Error{constructor(e){super("NotSupported"),e&&(this.message=e)}}class x extends Error{constructor(){super(...arguments),this.isExpected=!0}}class O{constructor(e){this.element=e,this.next=O.Undefined,this.prev=O.Undefined}}O.Undefined=new O(void 0);class A{constructor(){this._first=O.Undefined,this._last=O.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===O.Undefined}clear(){let e=this._first;for(;e!==O.Undefined;){const t=e.next;e.prev=O.Undefined,e.next=O.Undefined,e=t}this._first=O.Undefined,this._last=O.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){const r=new O(e);if(this._first===O.Undefined)this._first=r,this._last=r;else if(t){const e=this._last;this._last=r,r.prev=e,e.next=r}else{const e=this._first;this._first=r,r.next=e,e.prev=r}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(r))}}shift(){if(this._first!==O.Undefined){const e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==O.Undefined){const e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==O.Undefined&&e.next!==O.Undefined){const t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===O.Undefined&&e.next===O.Undefined?(this._first=O.Undefined,this._last=O.Undefined):e.next===O.Undefined?(this._last=this._last.prev,this._last.next=O.Undefined):e.prev===O.Undefined&&(this._first=this._first.next,this._first.prev=O.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==O.Undefined;)yield e.element,e=e.next}}var P,D,L;const U="en";let N,j,B,F=!1,K=!1,q=!1,$=!1,W=!1,V=!1,H=!1,G=U;const z="object"==typeof self?self:"object"==typeof r?r:{};let Y;void 0!==z.vscode&&void 0!==z.vscode.process?Y=z.vscode.process:void 0!==o&&(Y=o);const J="string"==typeof(null==(P=Y)||null==(D=P.versions)?void 0:D.electron)&&"renderer"===Y.type,Z=J&&(null==(L=Y)?void 0:L.sandboxed),Q=(()=>{var e;if(Z)return"bypassHeatCheck";const t=null==(e=Y)?void 0:e.env.VSCODE_BROWSER_CODE_LOADING;return"string"==typeof t?"none"===t||"code"===t||"bypassHeatCheck"===t||"bypassHeatCheckAndEagerCompile"===t?t:"bypassHeatCheck":void 0})(),X="string"==typeof Q;if("object"!=typeof navigator||J)if("object"==typeof Y){F="win32"===Y.platform,K="darwin"===Y.platform,q="linux"===Y.platform,$=q&&!!Y.env.SNAP&&!!Y.env.SNAP_REVISION,N=U,G=U;const e=Y.env.VSCODE_NLS_CONFIG;if(e)try{const t=JSON.parse(e),r=t.availableLanguages["*"];N=t.locale,G=r||U,j=t._translationsConfigFile}catch(e){}W=!0}else console.error("Unable to resolve platform.");else B=navigator.userAgent,F=B.indexOf("Windows")>=0,K=B.indexOf("Macintosh")>=0,H=(B.indexOf("Macintosh")>=0||B.indexOf("iPad")>=0||B.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,q=B.indexOf("Linux")>=0,V=!0,N=navigator.language,G=N;var ee,te;(te=ee||(ee={}))[te.Web=0]="Web",te[te.Mac=1]="Mac",te[te.Linux=2]="Linux",te[te.Windows=3]="Windows";let re=0;K?re=1:F?re=3:q&&(re=2);const ie=F,ne=K,oe=q,se=W,ae=V,ce=G;var le,ue;(ue=le||(le={})).value=function(){return ce},ue.isDefaultVariant=function(){return 2===ce.length?"en"===ce:ce.length>=3&&"e"===ce[0]&&"n"===ce[1]&&"-"===ce[2]},ue.isDefault=function(){return"en"===ce};const he=function(){var e;if(z.setImmediate)return z.setImmediate.bind(z);if("function"==typeof z.postMessage&&!z.importScripts){let e=[];z.addEventListener("message",(t=>{if(t.data&&t.data.vscodeSetImmediateId)for(let r=0,i=e.length;r<i;r++){const i=e[r];if(i.id===t.data.vscodeSetImmediateId)return e.splice(r,1),void i.callback()}}));let t=0;return r=>{const i=++t;e.push({id:i,callback:r}),z.postMessage({vscodeSetImmediateId:i},"*")}}if("function"==typeof(null==(e=Y)?void 0:e.nextTick))return Y.nextTick.bind(Y);const t=Promise.resolve();return e=>t.then(e)}();var de,fe;(fe=de||(de={}))[fe.Windows=1]="Windows",fe[fe.Macintosh=2]="Macintosh",fe[fe.Linux=3]="Linux";const pe=z.performance&&"function"==typeof z.performance.now;class me{constructor(e){this._highResolution=pe&&e,this._startTime=this._now(),this._stopTime=-1}static create(e=!0){return new me(e)}stop(){this._stopTime=this._now()}elapsed(){return-1!==this._stopTime?this._stopTime-this._startTime:this._now()-this._startTime}_now(){return this._highResolution?z.performance.now():Date.now()}}var ge;!function(e){function t(e){return(t,r=null,i)=>{let n,o=!1;return n=e((e=>{if(!o)return n?n.dispose():o=!0,t.call(r,e)}),null,i),o&&n.dispose(),n}}function r(e,t){return s(((r,i=null,n)=>e((e=>r.call(i,t(e))),null,n)))}function i(e,t){return s(((r,i=null,n)=>e((e=>{t(e),r.call(i,e)}),null,n)))}function n(e,t){return s(((r,i=null,n)=>e((e=>t(e)&&r.call(i,e)),null,n)))}function o(e,t,i){let n=i;return r(e,(e=>(n=t(n,e),n)))}function s(e){let t;const r=new we({onFirstListenerAdd(){t=e(r.fire,r)},onLastListenerRemove(){t.dispose()}});return r.event}function a(e,t,r=100,i=!1,n){let o,s,a,c=0;const l=new we({leakWarningThreshold:n,onFirstListenerAdd(){o=e((e=>{c++,s=t(s,e),i&&!a&&(l.fire(s),s=void 0),clearTimeout(a),a=setTimeout((()=>{const e=s;s=void 0,a=void 0,(!i||c>1)&&l.fire(e),c=0}),r)}))},onLastListenerRemove(){o.dispose()}});return l.event}function c(e,t=((e,t)=>e===t)){let r,i=!0;return n(e,(e=>{const n=i||!t(e,r);return i=!1,r=e,n}))}e.None=()=>y.None,e.once=t,e.map=r,e.forEach=i,e.filter=n,e.signal=function(e){return e},e.any=function(...e){return(t,r=null,i)=>m(...e.map((e=>e((e=>t.call(r,e)),null,i))))},e.reduce=o,e.debounce=a,e.latch=c,e.split=function(t,r){return[e.filter(t,r),e.filter(t,(e=>!r(e)))]},e.buffer=function(e,t=!1,r=[]){let i=r.slice(),n=e((e=>{i?i.push(e):s.fire(e)}));const o=()=>{i&&i.forEach((e=>s.fire(e))),i=null},s=new we({onFirstListenerAdd(){n||(n=e((e=>s.fire(e))))},onFirstListenerDidAdd(){i&&(t?setTimeout(o):o())},onLastListenerRemove(){n&&n.dispose(),n=null}});return s.event};class l{constructor(e){this.event=e}map(e){return new l(r(this.event,e))}forEach(e){return new l(i(this.event,e))}filter(e){return new l(n(this.event,e))}reduce(e,t){return new l(o(this.event,e,t))}latch(){return new l(c(this.event))}debounce(e,t=100,r=!1,i){return new l(a(this.event,e,t,r,i))}on(e,t,r){return this.event(e,t,r)}once(e,r,i){return t(this.event)(e,r,i)}}e.chain=function(e){return new l(e)},e.fromNodeEventEmitter=function(e,t,r=(e=>e)){const i=(...e)=>n.fire(r(...e)),n=new we({onFirstListenerAdd:()=>e.on(t,i),onLastListenerRemove:()=>e.removeListener(t,i)});return n.event},e.fromDOMEventEmitter=function(e,t,r=(e=>e)){const i=(...e)=>n.fire(r(...e)),n=new we({onFirstListenerAdd:()=>e.addEventListener(t,i),onLastListenerRemove:()=>e.removeEventListener(t,i)});return n.event},e.toPromise=function(e){return new Promise((r=>t(e)(r)))}}(ge||(ge={}));class ve{constructor(e){this._listenerCount=0,this._invocationCount=0,this._elapsedOverall=0,this._name=`${e}_${ve._idPool++}`}start(e){this._stopWatch=new me(!0),this._listenerCount=e}stop(){if(this._stopWatch){const e=this._stopWatch.elapsed();this._elapsedOverall+=e,this._invocationCount+=1,console.info(`did FIRE ${this._name}: elapsed_ms: ${e.toFixed(5)}, listener: ${this._listenerCount} (elapsed_overall: ${this._elapsedOverall.toFixed(2)}, invocations: ${this._invocationCount})`),this._stopWatch=void 0}}}ve._idPool=0;let ye=-1;class be{constructor(e,t=Math.random().toString(18).slice(2,5)){this.customThreshold=e,this.name=t,this._warnCountdown=0}dispose(){this._stacks&&this._stacks.clear()}check(e){let t=ye;if("number"==typeof this.customThreshold&&(t=this.customThreshold),t<=0||e<t)return;this._stacks||(this._stacks=new Map);const r=(new Error).stack.split("\n").slice(3).join("\n"),i=this._stacks.get(r)||0;if(this._stacks.set(r,i+1),this._warnCountdown-=1,this._warnCountdown<=0){let r;this._warnCountdown=.5*t;let i=0;for(const[e,t]of this._stacks)(!r||i<t)&&(r=e,i=t);console.warn(`[${this.name}] potential listener LEAK detected, having ${e} listeners already. MOST frequent listener (${i}):`),console.warn(r)}return()=>{const e=this._stacks.get(r)||0;this._stacks.set(r,e-1)}}}class we{constructor(e){var t;this._disposed=!1,this._options=e,this._leakageMon=ye>0?new be(this._options&&this._options.leakWarningThreshold):void 0,this._perfMon=null!=(t=this._options)&&t._profName?new ve(this._options._profName):void 0}get event(){return this._event||(this._event=(e,t,r)=>{var i;this._listeners||(this._listeners=new A);const n=this._listeners.isEmpty();n&&this._options&&this._options.onFirstListenerAdd&&this._options.onFirstListenerAdd(this);const o=this._listeners.push(t?[e,t]:e);n&&this._options&&this._options.onFirstListenerDidAdd&&this._options.onFirstListenerDidAdd(this),this._options&&this._options.onListenerDidAdd&&this._options.onListenerDidAdd(this,e,t);const s=null==(i=this._leakageMon)?void 0:i.check(this._listeners.size),a=g((()=>{if(s&&s(),!this._disposed&&(o(),this._options&&this._options.onLastListenerRemove)){this._listeners&&!this._listeners.isEmpty()||this._options.onLastListenerRemove(this)}}));return r instanceof v?r.add(a):Array.isArray(r)&&r.push(a),a}),this._event}fire(e){if(this._listeners){var t,r;this._deliveryQueue||(this._deliveryQueue=new A);for(let t of this._listeners)this._deliveryQueue.push([t,e]);for(null==(t=this._perfMon)||t.start(this._deliveryQueue.size);this._deliveryQueue.size>0;){const[e,t]=this._deliveryQueue.shift();try{"function"==typeof e?e.call(void 0,t):e[0].call(e[1],t)}catch(e){M(e)}}null==(r=this._perfMon)||r.stop()}}dispose(){var e,t,r,i;this._disposed||(this._disposed=!0,null==(e=this._listeners)||e.clear(),null==(t=this._deliveryQueue)||t.clear(),null==(r=this._options)||null==r.onLastListenerRemove||r.onLastListenerRemove(),null==(i=this._leakageMon)||i.dispose())}}class _e extends we{constructor(e){super(e),this._isPaused=0,this._eventQueue=new A,this._mergeFn=null==e?void 0:e.merge}pause(){this._isPaused++}resume(){if(0!==this._isPaused&&0==--this._isPaused)if(this._mergeFn){const e=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(e))}else for(;!this._isPaused&&0!==this._eventQueue.size;)super.fire(this._eventQueue.shift())}fire(e){this._listeners&&(0!==this._isPaused?this._eventQueue.push(e):super.fire(e))}}var Se={__proto__:null,get Event(){return ge},setGlobalLeakWarningThreshold:function(e){const t=ye;return ye=e,{dispose(){ye=t}}},Emitter:we,AsyncEmitter:class extends we{async fireAsync(e,t,r){if(this._listeners){this._asyncDeliveryQueue||(this._asyncDeliveryQueue=new A);for(const t of this._listeners)this._asyncDeliveryQueue.push([t,e]);for(;this._asyncDeliveryQueue.size>0&&!t.isCancellationRequested;){const[e,t]=this._asyncDeliveryQueue.shift(),i=[],n=_({},t,{waitUntil:t=>{if(Object.isFrozen(i))throw new Error("waitUntil can NOT be called asynchronous");r&&(t=r(t,"function"==typeof e?e:e[0])),i.push(t)}});try{"function"==typeof e?e.call(void 0,n):e[0].call(e[1],n)}catch(e){M(e);continue}Object.freeze(i),await Promise.allSettled(i).then((e=>{for(const t of e)"rejected"===t.status&&M(t.reason)}))}}}},PauseableEmitter:_e,DebounceEmitter:class extends _e{constructor(e){var t;super(e),this._delay=null!=(t=e.delay)?t:100}fire(e){this._handle||(this.pause(),this._handle=setTimeout((()=>{this._handle=void 0,this.resume()}),this._delay)),super.fire(e)}},EventMultiplexer:class{constructor(){this.hasListeners=!1,this.events=[],this.emitter=new we({onFirstListenerAdd:()=>this.onFirstListenerAdd(),onLastListenerRemove:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(e){const t={event:e,listener:null};this.events.push(t),this.hasListeners&&this.hook(t);return g(a((()=>{this.hasListeners&&this.unhook(t);const e=this.events.indexOf(t);this.events.splice(e,1)})))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach((e=>this.hook(e)))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach((e=>this.unhook(e)))}hook(e){e.listener=e.event((e=>this.emitter.fire(e)))}unhook(e){e.listener&&e.listener.dispose(),e.listener=null}dispose(){this.emitter.dispose()}},EventBufferer:class{constructor(){this.buffers=[]}wrapEvent(e){return(t,r,i)=>e((e=>{const i=this.buffers[this.buffers.length-1];i?i.push((()=>t.call(r,e))):t.call(r,e)}),void 0,i)}bufferEvents(e){const t=[];this.buffers.push(t);const r=e();return this.buffers.pop(),t.forEach((e=>e())),r}},Relay:class{constructor(){this.listening=!1,this.inputEvent=ge.None,this.inputEventListener=y.None,this.emitter=new we({onFirstListenerDidAdd:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onLastListenerRemove:()=>{this.listening=!1,this.inputEventListener.dispose()}}),this.event=this.emitter.event}set input(e){this.inputEvent=e,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=e(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}}};class Ee extends y{constructor(e,t="",r="",i=!0,n){super(),this._onDidChange=this._register(new we),this.onDidChange=this._onDidChange.event,this._enabled=!0,this._checked=!1,this._id=e,this._label=t,this._cssClass=r,this._enabled=i,this._actionCallback=n}get id(){return this._id}get label(){return this._label}set label(e){this._setLabel(e)}_setLabel(e){this._label!==e&&(this._label=e,this._onDidChange.fire({label:e}))}get tooltip(){return this._tooltip||""}set tooltip(e){this._setTooltip(e)}_setTooltip(e){this._tooltip!==e&&(this._tooltip=e,this._onDidChange.fire({tooltip:e}))}get class(){return this._cssClass}set class(e){this._setClass(e)}_setClass(e){this._cssClass!==e&&(this._cssClass=e,this._onDidChange.fire({class:e}))}get enabled(){return this._enabled}set enabled(e){this._setEnabled(e)}_setEnabled(e){this._enabled!==e&&(this._enabled=e,this._onDidChange.fire({enabled:e}))}get checked(){return this._checked}set checked(e){this._setChecked(e)}_setChecked(e){this._checked!==e&&(this._checked=e,this._onDidChange.fire({checked:e}))}async run(e,t){this._actionCallback&&await this._actionCallback(e)}}class Me extends Ee{constructor(e){super(Me.ID,e,e?"separator text":"separator"),this.checked=!1,this.enabled=!1}static join(...e){let t=[];for(const r of e)r.length&&(t=t.length?[...t,new Me,...r]:r);return t}}Me.ID="vs.actions.separator";class Ce extends Ee{constructor(){super(Ce.ID,s(0,"(empty)"),void 0,!1)}}Ce.ID="vs.actions.empty";const Ie=Object.freeze((function(e,t){const r=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(r)}}}));var Te,ke;(ke=Te||(Te={})).isCancellationToken=function(e){return e===ke.None||e===ke.Cancelled||e instanceof Re||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested&&"function"==typeof e.onCancellationRequested},ke.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:ge.None}),ke.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Ie});class Re{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Ie:(this._emitter||(this._emitter=new we),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}function xe(e,t){return e<t?-1:e>t?1:0}function Oe(e){return e>=97&&e<=122}function Ae(e){return e>=65&&e<=90}function Pe(e){return Oe(e)||Ae(e)}function De(e,t){return e.length===t.length&&Le(e,t)}function Le(e,t,r=e.length){for(let i=0;i<r;i++){const r=e.charCodeAt(i),n=t.charCodeAt(i);if(r!==n)if(Pe(r)&&Pe(n)){const e=Math.abs(r-n);if(0!==e&&32!==e)return!1}else if(String.fromCharCode(r).toLowerCase()!==String.fromCharCode(n).toLowerCase())return!1}return!0}function Ue(e,t){const r=t.length;return!(t.length>e.length)&&Le(e,t,r)}function Ne(e){return 55296<=e&&e<=56319}function je(e){return 56320<=e&&e<=57343}function Be(e,t){return t-56320+(e-55296<<10)+65536}String.fromCharCode(65279);var Fe,Ke,qe,$e;(Ke=Fe||(Fe={}))[Ke.Other=0]="Other",Ke[Ke.Prepend=1]="Prepend",Ke[Ke.CR=2]="CR",Ke[Ke.LF=3]="LF",Ke[Ke.Control=4]="Control",Ke[Ke.Extend=5]="Extend",Ke[Ke.Regional_Indicator=6]="Regional_Indicator",Ke[Ke.SpacingMark=7]="SpacingMark",Ke[Ke.L=8]="L",Ke[Ke.V=9]="V",Ke[Ke.T=10]="T",Ke[Ke.LV=11]="LV",Ke[Ke.LVT=12]="LVT",Ke[Ke.ZWJ=13]="ZWJ",Ke[Ke.Extended_Pictographic=14]="Extended_Pictographic";class We{constructor(){this._data=JSON.parse("[0,0,0,51592,51592,11,44424,44424,11,72251,72254,5,7150,7150,7,48008,48008,11,55176,55176,11,128420,128420,14,3276,3277,5,9979,9980,14,46216,46216,11,49800,49800,11,53384,53384,11,70726,70726,5,122915,122916,5,129320,129327,14,2558,2558,5,5906,5908,5,9762,9763,14,43360,43388,8,45320,45320,11,47112,47112,11,48904,48904,11,50696,50696,11,52488,52488,11,54280,54280,11,70082,70083,1,71350,71350,7,73111,73111,5,127892,127893,14,128726,128727,14,129473,129474,14,2027,2035,5,2901,2902,5,3784,3789,5,6754,6754,5,8418,8420,5,9877,9877,14,11088,11088,14,44008,44008,5,44872,44872,11,45768,45768,11,46664,46664,11,47560,47560,11,48456,48456,11,49352,49352,11,50248,50248,11,51144,51144,11,52040,52040,11,52936,52936,11,53832,53832,11,54728,54728,11,69811,69814,5,70459,70460,5,71096,71099,7,71998,71998,5,72874,72880,5,119149,119149,7,127374,127374,14,128335,128335,14,128482,128482,14,128765,128767,14,129399,129400,14,129680,129685,14,1476,1477,5,2377,2380,7,2759,2760,5,3137,3140,7,3458,3459,7,4153,4154,5,6432,6434,5,6978,6978,5,7675,7679,5,9723,9726,14,9823,9823,14,9919,9923,14,10035,10036,14,42736,42737,5,43596,43596,5,44200,44200,11,44648,44648,11,45096,45096,11,45544,45544,11,45992,45992,11,46440,46440,11,46888,46888,11,47336,47336,11,47784,47784,11,48232,48232,11,48680,48680,11,49128,49128,11,49576,49576,11,50024,50024,11,50472,50472,11,50920,50920,11,51368,51368,11,51816,51816,11,52264,52264,11,52712,52712,11,53160,53160,11,53608,53608,11,54056,54056,11,54504,54504,11,54952,54952,11,68108,68111,5,69933,69940,5,70197,70197,7,70498,70499,7,70845,70845,5,71229,71229,5,71727,71735,5,72154,72155,5,72344,72345,5,73023,73029,5,94095,94098,5,121403,121452,5,126981,127182,14,127538,127546,14,127990,127990,14,128391,128391,14,128445,128449,14,128500,128505,14,128752,128752,14,129160,129167,14,129356,129356,14,129432,129442,14,129648,129651,14,129751,131069,14,173,173,4,1757,1757,1,2274,2274,1,2494,2494,5,2641,2641,5,2876,2876,5,3014,3016,7,3262,3262,7,3393,3396,5,3570,3571,7,3968,3972,5,4228,4228,7,6086,6086,5,6679,6680,5,6912,6915,5,7080,7081,5,7380,7392,5,8252,8252,14,9096,9096,14,9748,9749,14,9784,9786,14,9833,9850,14,9890,9894,14,9938,9938,14,9999,9999,14,10085,10087,14,12349,12349,14,43136,43137,7,43454,43456,7,43755,43755,7,44088,44088,11,44312,44312,11,44536,44536,11,44760,44760,11,44984,44984,11,45208,45208,11,45432,45432,11,45656,45656,11,45880,45880,11,46104,46104,11,46328,46328,11,46552,46552,11,46776,46776,11,47000,47000,11,47224,47224,11,47448,47448,11,47672,47672,11,47896,47896,11,48120,48120,11,48344,48344,11,48568,48568,11,48792,48792,11,49016,49016,11,49240,49240,11,49464,49464,11,49688,49688,11,49912,49912,11,50136,50136,11,50360,50360,11,50584,50584,11,50808,50808,11,51032,51032,11,51256,51256,11,51480,51480,11,51704,51704,11,51928,51928,11,52152,52152,11,52376,52376,11,52600,52600,11,52824,52824,11,53048,53048,11,53272,53272,11,53496,53496,11,53720,53720,11,53944,53944,11,54168,54168,11,54392,54392,11,54616,54616,11,54840,54840,11,55064,55064,11,65438,65439,5,69633,69633,5,69837,69837,1,70018,70018,7,70188,70190,7,70368,70370,7,70465,70468,7,70712,70719,5,70835,70840,5,70850,70851,5,71132,71133,5,71340,71340,7,71458,71461,5,71985,71989,7,72002,72002,7,72193,72202,5,72281,72283,5,72766,72766,7,72885,72886,5,73104,73105,5,92912,92916,5,113824,113827,4,119173,119179,5,121505,121519,5,125136,125142,5,127279,127279,14,127489,127490,14,127570,127743,14,127900,127901,14,128254,128254,14,128369,128370,14,128400,128400,14,128425,128432,14,128468,128475,14,128489,128494,14,128715,128720,14,128745,128745,14,128759,128760,14,129004,129023,14,129296,129304,14,129340,129342,14,129388,129392,14,129404,129407,14,129454,129455,14,129485,129487,14,129659,129663,14,129719,129727,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2363,2363,7,2402,2403,5,2507,2508,7,2622,2624,7,2691,2691,7,2786,2787,5,2881,2884,5,3006,3006,5,3072,3072,5,3170,3171,5,3267,3268,7,3330,3331,7,3406,3406,1,3538,3540,5,3655,3662,5,3897,3897,5,4038,4038,5,4184,4185,5,4352,4447,8,6068,6069,5,6155,6157,5,6448,6449,7,6742,6742,5,6783,6783,5,6966,6970,5,7042,7042,7,7143,7143,7,7212,7219,5,7412,7412,5,8206,8207,4,8294,8303,4,8596,8601,14,9410,9410,14,9742,9742,14,9757,9757,14,9770,9770,14,9794,9794,14,9828,9828,14,9855,9855,14,9882,9882,14,9900,9903,14,9929,9933,14,9963,9967,14,9987,9988,14,10006,10006,14,10062,10062,14,10175,10175,14,11744,11775,5,42607,42607,5,43043,43044,7,43263,43263,5,43444,43445,7,43569,43570,5,43698,43700,5,43766,43766,5,44032,44032,11,44144,44144,11,44256,44256,11,44368,44368,11,44480,44480,11,44592,44592,11,44704,44704,11,44816,44816,11,44928,44928,11,45040,45040,11,45152,45152,11,45264,45264,11,45376,45376,11,45488,45488,11,45600,45600,11,45712,45712,11,45824,45824,11,45936,45936,11,46048,46048,11,46160,46160,11,46272,46272,11,46384,46384,11,46496,46496,11,46608,46608,11,46720,46720,11,46832,46832,11,46944,46944,11,47056,47056,11,47168,47168,11,47280,47280,11,47392,47392,11,47504,47504,11,47616,47616,11,47728,47728,11,47840,47840,11,47952,47952,11,48064,48064,11,48176,48176,11,48288,48288,11,48400,48400,11,48512,48512,11,48624,48624,11,48736,48736,11,48848,48848,11,48960,48960,11,49072,49072,11,49184,49184,11,49296,49296,11,49408,49408,11,49520,49520,11,49632,49632,11,49744,49744,11,49856,49856,11,49968,49968,11,50080,50080,11,50192,50192,11,50304,50304,11,50416,50416,11,50528,50528,11,50640,50640,11,50752,50752,11,50864,50864,11,50976,50976,11,51088,51088,11,51200,51200,11,51312,51312,11,51424,51424,11,51536,51536,11,51648,51648,11,51760,51760,11,51872,51872,11,51984,51984,11,52096,52096,11,52208,52208,11,52320,52320,11,52432,52432,11,52544,52544,11,52656,52656,11,52768,52768,11,52880,52880,11,52992,52992,11,53104,53104,11,53216,53216,11,53328,53328,11,53440,53440,11,53552,53552,11,53664,53664,11,53776,53776,11,53888,53888,11,54000,54000,11,54112,54112,11,54224,54224,11,54336,54336,11,54448,54448,11,54560,54560,11,54672,54672,11,54784,54784,11,54896,54896,11,55008,55008,11,55120,55120,11,64286,64286,5,66272,66272,5,68900,68903,5,69762,69762,7,69817,69818,5,69927,69931,5,70003,70003,5,70070,70078,5,70094,70094,7,70194,70195,7,70206,70206,5,70400,70401,5,70463,70463,7,70475,70477,7,70512,70516,5,70722,70724,5,70832,70832,5,70842,70842,5,70847,70848,5,71088,71089,7,71102,71102,7,71219,71226,5,71231,71232,5,71342,71343,7,71453,71455,5,71463,71467,5,71737,71738,5,71995,71996,5,72000,72000,7,72145,72147,7,72160,72160,5,72249,72249,7,72273,72278,5,72330,72342,5,72752,72758,5,72850,72871,5,72882,72883,5,73018,73018,5,73031,73031,5,73109,73109,5,73461,73462,7,94031,94031,5,94192,94193,7,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,126976,126979,14,127184,127231,14,127344,127345,14,127405,127461,14,127514,127514,14,127561,127567,14,127778,127779,14,127896,127896,14,127985,127986,14,127995,127999,5,128326,128328,14,128360,128366,14,128378,128378,14,128394,128397,14,128405,128406,14,128422,128423,14,128435,128443,14,128453,128464,14,128479,128480,14,128484,128487,14,128496,128498,14,128640,128709,14,128723,128724,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129096,129103,14,129292,129292,14,129311,129311,14,129329,129330,14,129344,129349,14,129360,129374,14,129394,129394,14,129402,129402,14,129413,129425,14,129445,129450,14,129466,129471,14,129483,129483,14,129511,129535,14,129653,129655,14,129667,129670,14,129705,129711,14,129731,129743,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2307,2307,7,2366,2368,7,2382,2383,7,2434,2435,7,2497,2500,5,2519,2519,5,2563,2563,7,2631,2632,5,2677,2677,5,2750,2752,7,2763,2764,7,2817,2817,5,2879,2879,5,2891,2892,7,2914,2915,5,3008,3008,5,3021,3021,5,3076,3076,5,3146,3149,5,3202,3203,7,3264,3265,7,3271,3272,7,3298,3299,5,3390,3390,5,3402,3404,7,3426,3427,5,3535,3535,5,3544,3550,7,3635,3635,7,3763,3763,7,3893,3893,5,3953,3966,5,3981,3991,5,4145,4145,7,4157,4158,5,4209,4212,5,4237,4237,5,4520,4607,10,5970,5971,5,6071,6077,5,6089,6099,5,6277,6278,5,6439,6440,5,6451,6456,7,6683,6683,5,6744,6750,5,6765,6770,7,6846,6846,5,6964,6964,5,6972,6972,5,7019,7027,5,7074,7077,5,7083,7085,5,7146,7148,7,7154,7155,7,7222,7223,5,7394,7400,5,7416,7417,5,8204,8204,5,8233,8233,4,8288,8292,4,8413,8416,5,8482,8482,14,8986,8987,14,9193,9203,14,9654,9654,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9775,14,9792,9792,14,9800,9811,14,9825,9826,14,9831,9831,14,9852,9853,14,9872,9873,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9936,9936,14,9941,9960,14,9974,9974,14,9982,9985,14,9992,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10145,10145,14,11013,11015,14,11503,11505,5,12334,12335,5,12951,12951,14,42612,42621,5,43014,43014,5,43047,43047,7,43204,43205,5,43335,43345,5,43395,43395,7,43450,43451,7,43561,43566,5,43573,43574,5,43644,43644,5,43710,43711,5,43758,43759,7,44005,44005,5,44012,44012,7,44060,44060,11,44116,44116,11,44172,44172,11,44228,44228,11,44284,44284,11,44340,44340,11,44396,44396,11,44452,44452,11,44508,44508,11,44564,44564,11,44620,44620,11,44676,44676,11,44732,44732,11,44788,44788,11,44844,44844,11,44900,44900,11,44956,44956,11,45012,45012,11,45068,45068,11,45124,45124,11,45180,45180,11,45236,45236,11,45292,45292,11,45348,45348,11,45404,45404,11,45460,45460,11,45516,45516,11,45572,45572,11,45628,45628,11,45684,45684,11,45740,45740,11,45796,45796,11,45852,45852,11,45908,45908,11,45964,45964,11,46020,46020,11,46076,46076,11,46132,46132,11,46188,46188,11,46244,46244,11,46300,46300,11,46356,46356,11,46412,46412,11,46468,46468,11,46524,46524,11,46580,46580,11,46636,46636,11,46692,46692,11,46748,46748,11,46804,46804,11,46860,46860,11,46916,46916,11,46972,46972,11,47028,47028,11,47084,47084,11,47140,47140,11,47196,47196,11,47252,47252,11,47308,47308,11,47364,47364,11,47420,47420,11,47476,47476,11,47532,47532,11,47588,47588,11,47644,47644,11,47700,47700,11,47756,47756,11,47812,47812,11,47868,47868,11,47924,47924,11,47980,47980,11,48036,48036,11,48092,48092,11,48148,48148,11,48204,48204,11,48260,48260,11,48316,48316,11,48372,48372,11,48428,48428,11,48484,48484,11,48540,48540,11,48596,48596,11,48652,48652,11,48708,48708,11,48764,48764,11,48820,48820,11,48876,48876,11,48932,48932,11,48988,48988,11,49044,49044,11,49100,49100,11,49156,49156,11,49212,49212,11,49268,49268,11,49324,49324,11,49380,49380,11,49436,49436,11,49492,49492,11,49548,49548,11,49604,49604,11,49660,49660,11,49716,49716,11,49772,49772,11,49828,49828,11,49884,49884,11,49940,49940,11,49996,49996,11,50052,50052,11,50108,50108,11,50164,50164,11,50220,50220,11,50276,50276,11,50332,50332,11,50388,50388,11,50444,50444,11,50500,50500,11,50556,50556,11,50612,50612,11,50668,50668,11,50724,50724,11,50780,50780,11,50836,50836,11,50892,50892,11,50948,50948,11,51004,51004,11,51060,51060,11,51116,51116,11,51172,51172,11,51228,51228,11,51284,51284,11,51340,51340,11,51396,51396,11,51452,51452,11,51508,51508,11,51564,51564,11,51620,51620,11,51676,51676,11,51732,51732,11,51788,51788,11,51844,51844,11,51900,51900,11,51956,51956,11,52012,52012,11,52068,52068,11,52124,52124,11,52180,52180,11,52236,52236,11,52292,52292,11,52348,52348,11,52404,52404,11,52460,52460,11,52516,52516,11,52572,52572,11,52628,52628,11,52684,52684,11,52740,52740,11,52796,52796,11,52852,52852,11,52908,52908,11,52964,52964,11,53020,53020,11,53076,53076,11,53132,53132,11,53188,53188,11,53244,53244,11,53300,53300,11,53356,53356,11,53412,53412,11,53468,53468,11,53524,53524,11,53580,53580,11,53636,53636,11,53692,53692,11,53748,53748,11,53804,53804,11,53860,53860,11,53916,53916,11,53972,53972,11,54028,54028,11,54084,54084,11,54140,54140,11,54196,54196,11,54252,54252,11,54308,54308,11,54364,54364,11,54420,54420,11,54476,54476,11,54532,54532,11,54588,54588,11,54644,54644,11,54700,54700,11,54756,54756,11,54812,54812,11,54868,54868,11,54924,54924,11,54980,54980,11,55036,55036,11,55092,55092,11,55148,55148,11,55216,55238,9,65056,65071,5,65529,65531,4,68097,68099,5,68159,68159,5,69446,69456,5,69688,69702,5,69808,69810,7,69815,69816,7,69821,69821,1,69888,69890,5,69932,69932,7,69957,69958,7,70016,70017,5,70067,70069,7,70079,70080,7,70089,70092,5,70095,70095,5,70191,70193,5,70196,70196,5,70198,70199,5,70367,70367,5,70371,70378,5,70402,70403,7,70462,70462,5,70464,70464,5,70471,70472,7,70487,70487,5,70502,70508,5,70709,70711,7,70720,70721,7,70725,70725,7,70750,70750,5,70833,70834,7,70841,70841,7,70843,70844,7,70846,70846,7,70849,70849,7,71087,71087,5,71090,71093,5,71100,71101,5,71103,71104,5,71216,71218,7,71227,71228,7,71230,71230,7,71339,71339,5,71341,71341,5,71344,71349,5,71351,71351,5,71456,71457,7,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123628,123631,5,125252,125258,5,126980,126980,14,127183,127183,14,127245,127247,14,127340,127343,14,127358,127359,14,127377,127386,14,127462,127487,6,127491,127503,14,127535,127535,14,127548,127551,14,127568,127569,14,127744,127777,14,127780,127891,14,127894,127895,14,127897,127899,14,127902,127984,14,127987,127989,14,127991,127994,14,128000,128253,14,128255,128317,14,128329,128334,14,128336,128359,14,128367,128368,14,128371,128377,14,128379,128390,14,128392,128393,14,128398,128399,14,128401,128404,14,128407,128419,14,128421,128421,14,128424,128424,14,128433,128434,14,128444,128444,14,128450,128452,14,128465,128467,14,128476,128478,14,128481,128481,14,128483,128483,14,128488,128488,14,128495,128495,14,128499,128499,14,128506,128591,14,128710,128714,14,128721,128722,14,128725,128725,14,128728,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129664,129666,14,129671,129679,14,129686,129704,14,129712,129718,14,129728,129730,14,129744,129750,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2259,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3134,3136,5,3142,3144,5,3157,3158,5,3201,3201,5,3260,3260,5,3263,3263,5,3266,3266,5,3270,3270,5,3274,3275,7,3285,3286,5,3328,3329,5,3387,3388,5,3391,3392,7,3398,3400,7,3405,3405,5,3415,3415,5,3457,3457,5,3530,3530,5,3536,3537,7,3542,3542,5,3551,3551,5,3633,3633,5,3636,3642,5,3761,3761,5,3764,3772,5,3864,3865,5,3895,3895,5,3902,3903,7,3967,3967,7,3974,3975,5,3993,4028,5,4141,4144,5,4146,4151,5,4155,4156,7,4182,4183,7,4190,4192,5,4226,4226,5,4229,4230,5,4253,4253,5,4448,4519,9,4957,4959,5,5938,5940,5,6002,6003,5,6070,6070,7,6078,6085,7,6087,6088,7,6109,6109,5,6158,6158,4,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6848,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7673,5,8203,8203,4,8205,8205,13,8232,8232,4,8234,8238,4,8265,8265,14,8293,8293,4,8400,8412,5,8417,8417,5,8421,8432,5,8505,8505,14,8617,8618,14,9000,9000,14,9167,9167,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9776,9783,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9935,14,9937,9937,14,9939,9940,14,9961,9962,14,9968,9973,14,9975,9978,14,9981,9981,14,9986,9986,14,9989,9989,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10084,14,10133,10135,14,10160,10160,14,10548,10549,14,11035,11036,14,11093,11093,14,11647,11647,5,12330,12333,5,12336,12336,14,12441,12442,5,12953,12953,14,42608,42610,5,42654,42655,5,43010,43010,5,43019,43019,5,43045,43046,5,43052,43052,5,43188,43203,7,43232,43249,5,43302,43309,5,43346,43347,7,43392,43394,5,43443,43443,5,43446,43449,5,43452,43453,5,43493,43493,5,43567,43568,7,43571,43572,7,43587,43587,5,43597,43597,7,43696,43696,5,43703,43704,5,43713,43713,5,43756,43757,5,43765,43765,7,44003,44004,7,44006,44007,7,44009,44010,7,44013,44013,5,44033,44059,12,44061,44087,12,44089,44115,12,44117,44143,12,44145,44171,12,44173,44199,12,44201,44227,12,44229,44255,12,44257,44283,12,44285,44311,12,44313,44339,12,44341,44367,12,44369,44395,12,44397,44423,12,44425,44451,12,44453,44479,12,44481,44507,12,44509,44535,12,44537,44563,12,44565,44591,12,44593,44619,12,44621,44647,12,44649,44675,12,44677,44703,12,44705,44731,12,44733,44759,12,44761,44787,12,44789,44815,12,44817,44843,12,44845,44871,12,44873,44899,12,44901,44927,12,44929,44955,12,44957,44983,12,44985,45011,12,45013,45039,12,45041,45067,12,45069,45095,12,45097,45123,12,45125,45151,12,45153,45179,12,45181,45207,12,45209,45235,12,45237,45263,12,45265,45291,12,45293,45319,12,45321,45347,12,45349,45375,12,45377,45403,12,45405,45431,12,45433,45459,12,45461,45487,12,45489,45515,12,45517,45543,12,45545,45571,12,45573,45599,12,45601,45627,12,45629,45655,12,45657,45683,12,45685,45711,12,45713,45739,12,45741,45767,12,45769,45795,12,45797,45823,12,45825,45851,12,45853,45879,12,45881,45907,12,45909,45935,12,45937,45963,12,45965,45991,12,45993,46019,12,46021,46047,12,46049,46075,12,46077,46103,12,46105,46131,12,46133,46159,12,46161,46187,12,46189,46215,12,46217,46243,12,46245,46271,12,46273,46299,12,46301,46327,12,46329,46355,12,46357,46383,12,46385,46411,12,46413,46439,12,46441,46467,12,46469,46495,12,46497,46523,12,46525,46551,12,46553,46579,12,46581,46607,12,46609,46635,12,46637,46663,12,46665,46691,12,46693,46719,12,46721,46747,12,46749,46775,12,46777,46803,12,46805,46831,12,46833,46859,12,46861,46887,12,46889,46915,12,46917,46943,12,46945,46971,12,46973,46999,12,47001,47027,12,47029,47055,12,47057,47083,12,47085,47111,12,47113,47139,12,47141,47167,12,47169,47195,12,47197,47223,12,47225,47251,12,47253,47279,12,47281,47307,12,47309,47335,12,47337,47363,12,47365,47391,12,47393,47419,12,47421,47447,12,47449,47475,12,47477,47503,12,47505,47531,12,47533,47559,12,47561,47587,12,47589,47615,12,47617,47643,12,47645,47671,12,47673,47699,12,47701,47727,12,47729,47755,12,47757,47783,12,47785,47811,12,47813,47839,12,47841,47867,12,47869,47895,12,47897,47923,12,47925,47951,12,47953,47979,12,47981,48007,12,48009,48035,12,48037,48063,12,48065,48091,12,48093,48119,12,48121,48147,12,48149,48175,12,48177,48203,12,48205,48231,12,48233,48259,12,48261,48287,12,48289,48315,12,48317,48343,12,48345,48371,12,48373,48399,12,48401,48427,12,48429,48455,12,48457,48483,12,48485,48511,12,48513,48539,12,48541,48567,12,48569,48595,12,48597,48623,12,48625,48651,12,48653,48679,12,48681,48707,12,48709,48735,12,48737,48763,12,48765,48791,12,48793,48819,12,48821,48847,12,48849,48875,12,48877,48903,12,48905,48931,12,48933,48959,12,48961,48987,12,48989,49015,12,49017,49043,12,49045,49071,12,49073,49099,12,49101,49127,12,49129,49155,12,49157,49183,12,49185,49211,12,49213,49239,12,49241,49267,12,49269,49295,12,49297,49323,12,49325,49351,12,49353,49379,12,49381,49407,12,49409,49435,12,49437,49463,12,49465,49491,12,49493,49519,12,49521,49547,12,49549,49575,12,49577,49603,12,49605,49631,12,49633,49659,12,49661,49687,12,49689,49715,12,49717,49743,12,49745,49771,12,49773,49799,12,49801,49827,12,49829,49855,12,49857,49883,12,49885,49911,12,49913,49939,12,49941,49967,12,49969,49995,12,49997,50023,12,50025,50051,12,50053,50079,12,50081,50107,12,50109,50135,12,50137,50163,12,50165,50191,12,50193,50219,12,50221,50247,12,50249,50275,12,50277,50303,12,50305,50331,12,50333,50359,12,50361,50387,12,50389,50415,12,50417,50443,12,50445,50471,12,50473,50499,12,50501,50527,12,50529,50555,12,50557,50583,12,50585,50611,12,50613,50639,12,50641,50667,12,50669,50695,12,50697,50723,12,50725,50751,12,50753,50779,12,50781,50807,12,50809,50835,12,50837,50863,12,50865,50891,12,50893,50919,12,50921,50947,12,50949,50975,12,50977,51003,12,51005,51031,12,51033,51059,12,51061,51087,12,51089,51115,12,51117,51143,12,51145,51171,12,51173,51199,12,51201,51227,12,51229,51255,12,51257,51283,12,51285,51311,12,51313,51339,12,51341,51367,12,51369,51395,12,51397,51423,12,51425,51451,12,51453,51479,12,51481,51507,12,51509,51535,12,51537,51563,12,51565,51591,12,51593,51619,12,51621,51647,12,51649,51675,12,51677,51703,12,51705,51731,12,51733,51759,12,51761,51787,12,51789,51815,12,51817,51843,12,51845,51871,12,51873,51899,12,51901,51927,12,51929,51955,12,51957,51983,12,51985,52011,12,52013,52039,12,52041,52067,12,52069,52095,12,52097,52123,12,52125,52151,12,52153,52179,12,52181,52207,12,52209,52235,12,52237,52263,12,52265,52291,12,52293,52319,12,52321,52347,12,52349,52375,12,52377,52403,12,52405,52431,12,52433,52459,12,52461,52487,12,52489,52515,12,52517,52543,12,52545,52571,12,52573,52599,12,52601,52627,12,52629,52655,12,52657,52683,12,52685,52711,12,52713,52739,12,52741,52767,12,52769,52795,12,52797,52823,12,52825,52851,12,52853,52879,12,52881,52907,12,52909,52935,12,52937,52963,12,52965,52991,12,52993,53019,12,53021,53047,12,53049,53075,12,53077,53103,12,53105,53131,12,53133,53159,12,53161,53187,12,53189,53215,12,53217,53243,12,53245,53271,12,53273,53299,12,53301,53327,12,53329,53355,12,53357,53383,12,53385,53411,12,53413,53439,12,53441,53467,12,53469,53495,12,53497,53523,12,53525,53551,12,53553,53579,12,53581,53607,12,53609,53635,12,53637,53663,12,53665,53691,12,53693,53719,12,53721,53747,12,53749,53775,12,53777,53803,12,53805,53831,12,53833,53859,12,53861,53887,12,53889,53915,12,53917,53943,12,53945,53971,12,53973,53999,12,54001,54027,12,54029,54055,12,54057,54083,12,54085,54111,12,54113,54139,12,54141,54167,12,54169,54195,12,54197,54223,12,54225,54251,12,54253,54279,12,54281,54307,12,54309,54335,12,54337,54363,12,54365,54391,12,54393,54419,12,54421,54447,12,54449,54475,12,54477,54503,12,54505,54531,12,54533,54559,12,54561,54587,12,54589,54615,12,54617,54643,12,54645,54671,12,54673,54699,12,54701,54727,12,54729,54755,12,54757,54783,12,54785,54811,12,54813,54839,12,54841,54867,12,54869,54895,12,54897,54923,12,54925,54951,12,54953,54979,12,54981,55007,12,55009,55035,12,55037,55063,12,55065,55091,12,55093,55119,12,55121,55147,12,55149,55175,12,55177,55203,12,55243,55291,10,65024,65039,5,65279,65279,4,65520,65528,4,66045,66045,5,66422,66426,5,68101,68102,5,68152,68154,5,68325,68326,5,69291,69292,5,69632,69632,7,69634,69634,7,69759,69761,5]")}static getInstance(){return We._INSTANCE||(We._INSTANCE=new We),We._INSTANCE}getGraphemeBreakType(e){if(e<32)return 10===e?3:13===e?2:4;if(e<127)return 0;const t=this._data,r=t.length/3;let i=1;for(;i<=r;)if(e<t[3*i])i*=2;else{if(!(e>t[3*i+1]))return t[3*i+2];i=2*i+1}return 0}}We._INSTANCE=null,($e=qe||(qe={}))[$e.zwj=8205]="zwj",$e[$e.emojiVariantSelector=65039]="emojiVariantSelector",$e[$e.enclosingKeyCap=8419]="enclosingKeyCap";let Ve;if(void 0!==z.vscode&&void 0!==z.vscode.process){const e=z.vscode.process;Ve={get platform(){return e.platform},get env(){return e.env},cwd:()=>e.cwd(),nextTick:e=>he(e)}}else Ve=void 0!==o?{get platform(){return o.platform},get env(){return o.env},cwd:()=>o.cwd(),nextTick:e=>o.nextTick(e)}:{get platform(){return ie?"win32":ne?"darwin":"linux"},nextTick:e=>he(e),get env(){return{}},cwd:()=>"/"};const He=Ve.cwd,Ge=Ve.env,ze=Ve.platform;Ve.nextTick;const Ye=65,Je=97,Ze=90,Qe=122,Xe=46,et=47,tt=92,rt=58;class it extends Error{constructor(e,t,r){let i;"string"==typeof t&&0===t.indexOf("not ")?(i="must not be",t=t.replace(/^not /,"")):i="must be";const n=-1!==e.indexOf(".")?"property":"argument";let o=`The "${e}" ${n} ${i} of type ${t}`;o+=". Received type "+typeof r,super(o),this.code="ERR_INVALID_ARG_TYPE"}}function nt(e,t){if("string"!=typeof e)throw new it(t,"string",e)}function ot(e){return e===et||e===tt}function st(e){return e===et}function at(e){return e>=Ye&&e<=Ze||e>=Je&&e<=Qe}function ct(e,t,r,i){let n="",o=0,s=-1,a=0,c=0;for(let l=0;l<=e.length;++l){if(l<e.length)c=e.charCodeAt(l);else{if(i(c))break;c=et}if(i(c)){if(s===l-1||1===a);else if(2===a){if(n.length<2||2!==o||n.charCodeAt(n.length-1)!==Xe||n.charCodeAt(n.length-2)!==Xe){if(n.length>2){const e=n.lastIndexOf(r);-1===e?(n="",o=0):(n=n.slice(0,e),o=n.length-1-n.lastIndexOf(r)),s=l,a=0;continue}if(0!==n.length){n="",o=0,s=l,a=0;continue}}t&&(n+=n.length>0?`${r}..`:"..",o=2)}else n.length>0?n+=`${r}${e.slice(s+1,l)}`:n=e.slice(s+1,l),o=l-s-1;s=l,a=0}else c===Xe&&-1!==a?++a:a=-1}return n}function lt(e,t){if(null===t||"object"!=typeof t)throw new it("pathObject","Object",t);const r=t.dir||t.root,i=t.base||`${t.name||""}${t.ext||""}`;return r?r===t.root?`${r}${i}`:`${r}${e}${i}`:i}const ut={resolve(...e){let t="",r="",i=!1;for(let n=e.length-1;n>=-1;n--){let o;if(n>=0){if(o=e[n],nt(o,"path"),0===o.length)continue}else 0===t.length?o=He():(o=Ge[`=${t}`]||He(),(void 0===o||o.slice(0,2).toLowerCase()!==t.toLowerCase()&&o.charCodeAt(2)===tt)&&(o=`${t}\\`));const s=o.length;let a=0,c="",l=!1;const u=o.charCodeAt(0);if(1===s)ot(u)&&(a=1,l=!0);else if(ot(u))if(l=!0,ot(o.charCodeAt(1))){let e=2,t=e;for(;e<s&&!ot(o.charCodeAt(e));)e++;if(e<s&&e!==t){const r=o.slice(t,e);for(t=e;e<s&&ot(o.charCodeAt(e));)e++;if(e<s&&e!==t){for(t=e;e<s&&!ot(o.charCodeAt(e));)e++;e!==s&&e===t||(c=`\\\\${r}\\${o.slice(t,e)}`,a=e)}}}else a=1;else at(u)&&o.charCodeAt(1)===rt&&(c=o.slice(0,2),a=2,s>2&&ot(o.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(t.length>0){if(c.toLowerCase()!==t.toLowerCase())continue}else t=c;if(i){if(t.length>0)break}else if(r=`${o.slice(a)}\\${r}`,i=l,l&&t.length>0)break}return r=ct(r,!i,"\\",ot),i?`${t}\\${r}`:`${t}${r}`||"."},normalize(e){nt(e,"path");const t=e.length;if(0===t)return".";let r,i=0,n=!1;const o=e.charCodeAt(0);if(1===t)return st(o)?"\\":e;if(ot(o))if(n=!0,ot(e.charCodeAt(1))){let n=2,o=n;for(;n<t&&!ot(e.charCodeAt(n));)n++;if(n<t&&n!==o){const s=e.slice(o,n);for(o=n;n<t&&ot(e.charCodeAt(n));)n++;if(n<t&&n!==o){for(o=n;n<t&&!ot(e.charCodeAt(n));)n++;if(n===t)return`\\\\${s}\\${e.slice(o)}\\`;n!==o&&(r=`\\\\${s}\\${e.slice(o,n)}`,i=n)}}}else i=1;else at(o)&&e.charCodeAt(1)===rt&&(r=e.slice(0,2),i=2,t>2&&ot(e.charCodeAt(2))&&(n=!0,i=3));let s=i<t?ct(e.slice(i),!n,"\\",ot):"";return 0!==s.length||n||(s="."),s.length>0&&ot(e.charCodeAt(t-1))&&(s+="\\"),void 0===r?n?`\\${s}`:s:n?`${r}\\${s}`:`${r}${s}`},isAbsolute(e){nt(e,"path");const t=e.length;if(0===t)return!1;const r=e.charCodeAt(0);return ot(r)||t>2&&at(r)&&e.charCodeAt(1)===rt&&ot(e.charCodeAt(2))},join(...e){if(0===e.length)return".";let t,r;for(let i=0;i<e.length;++i){const n=e[i];nt(n,"path"),n.length>0&&(void 0===t?t=r=n:t+=`\\${n}`)}if(void 0===t)return".";let i=!0,n=0;if("string"==typeof r&&ot(r.charCodeAt(0))){++n;const e=r.length;e>1&&ot(r.charCodeAt(1))&&(++n,e>2&&(ot(r.charCodeAt(2))?++n:i=!1))}if(i){for(;n<t.length&&ot(t.charCodeAt(n));)n++;n>=2&&(t=`\\${t.slice(n)}`)}return ut.normalize(t)},relative(e,t){if(nt(e,"from"),nt(t,"to"),e===t)return"";const r=ut.resolve(e),i=ut.resolve(t);if(r===i)return"";if((e=r.toLowerCase())===(t=i.toLowerCase()))return"";let n=0;for(;n<e.length&&e.charCodeAt(n)===tt;)n++;let o=e.length;for(;o-1>n&&e.charCodeAt(o-1)===tt;)o--;const s=o-n;let a=0;for(;a<t.length&&t.charCodeAt(a)===tt;)a++;let c=t.length;for(;c-1>a&&t.charCodeAt(c-1)===tt;)c--;const l=c-a,u=s<l?s:l;let h=-1,d=0;for(;d<u;d++){const r=e.charCodeAt(n+d);if(r!==t.charCodeAt(a+d))break;r===tt&&(h=d)}if(d!==u){if(-1===h)return i}else{if(l>u){if(t.charCodeAt(a+d)===tt)return i.slice(a+d+1);if(2===d)return i.slice(a+d)}s>u&&(e.charCodeAt(n+d)===tt?h=d:2===d&&(h=3)),-1===h&&(h=0)}let f="";for(d=n+h+1;d<=o;++d)d!==o&&e.charCodeAt(d)!==tt||(f+=0===f.length?"..":"\\..");return a+=h,f.length>0?`${f}${i.slice(a,c)}`:(i.charCodeAt(a)===tt&&++a,i.slice(a,c))},toNamespacedPath(e){if("string"!=typeof e)return e;if(0===e.length)return"";const t=ut.resolve(e);if(t.length<=2)return e;if(t.charCodeAt(0)===tt){if(t.charCodeAt(1)===tt){const e=t.charCodeAt(2);if(63!==e&&e!==Xe)return`\\\\?\\UNC\\${t.slice(2)}`}}else if(at(t.charCodeAt(0))&&t.charCodeAt(1)===rt&&t.charCodeAt(2)===tt)return`\\\\?\\${t}`;return e},dirname(e){nt(e,"path");const t=e.length;if(0===t)return".";let r=-1,i=0;const n=e.charCodeAt(0);if(1===t)return ot(n)?e:".";if(ot(n)){if(r=i=1,ot(e.charCodeAt(1))){let n=2,o=n;for(;n<t&&!ot(e.charCodeAt(n));)n++;if(n<t&&n!==o){for(o=n;n<t&&ot(e.charCodeAt(n));)n++;if(n<t&&n!==o){for(o=n;n<t&&!ot(e.charCodeAt(n));)n++;if(n===t)return e;n!==o&&(r=i=n+1)}}}}else at(n)&&e.charCodeAt(1)===rt&&(r=t>2&&ot(e.charCodeAt(2))?3:2,i=r);let o=-1,s=!0;for(let r=t-1;r>=i;--r)if(ot(e.charCodeAt(r))){if(!s){o=r;break}}else s=!1;if(-1===o){if(-1===r)return".";o=r}return e.slice(0,o)},basename(e,t){void 0!==t&&nt(t,"ext"),nt(e,"path");let r,i=0,n=-1,o=!0;if(e.length>=2&&at(e.charCodeAt(0))&&e.charCodeAt(1)===rt&&(i=2),void 0!==t&&t.length>0&&t.length<=e.length){if(t===e)return"";let s=t.length-1,a=-1;for(r=e.length-1;r>=i;--r){const c=e.charCodeAt(r);if(ot(c)){if(!o){i=r+1;break}}else-1===a&&(o=!1,a=r+1),s>=0&&(c===t.charCodeAt(s)?-1==--s&&(n=r):(s=-1,n=a))}return i===n?n=a:-1===n&&(n=e.length),e.slice(i,n)}for(r=e.length-1;r>=i;--r)if(ot(e.charCodeAt(r))){if(!o){i=r+1;break}}else-1===n&&(o=!1,n=r+1);return-1===n?"":e.slice(i,n)},extname(e){nt(e,"path");let t=0,r=-1,i=0,n=-1,o=!0,s=0;e.length>=2&&e.charCodeAt(1)===rt&&at(e.charCodeAt(0))&&(t=i=2);for(let a=e.length-1;a>=t;--a){const t=e.charCodeAt(a);if(ot(t)){if(!o){i=a+1;break}}else-1===n&&(o=!1,n=a+1),t===Xe?-1===r?r=a:1!==s&&(s=1):-1!==r&&(s=-1)}return-1===r||-1===n||0===s||1===s&&r===n-1&&r===i+1?"":e.slice(r,n)},format:lt.bind(null,"\\"),parse(e){nt(e,"path");const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;const r=e.length;let i=0,n=e.charCodeAt(0);if(1===r)return ot(n)?(t.root=t.dir=e,t):(t.base=t.name=e,t);if(ot(n)){if(i=1,ot(e.charCodeAt(1))){let t=2,n=t;for(;t<r&&!ot(e.charCodeAt(t));)t++;if(t<r&&t!==n){for(n=t;t<r&&ot(e.charCodeAt(t));)t++;if(t<r&&t!==n){for(n=t;t<r&&!ot(e.charCodeAt(t));)t++;t===r?i=t:t!==n&&(i=t+1)}}}}else if(at(n)&&e.charCodeAt(1)===rt){if(r<=2)return t.root=t.dir=e,t;if(i=2,ot(e.charCodeAt(2))){if(3===r)return t.root=t.dir=e,t;i=3}}i>0&&(t.root=e.slice(0,i));let o=-1,s=i,a=-1,c=!0,l=e.length-1,u=0;for(;l>=i;--l)if(n=e.charCodeAt(l),ot(n)){if(!c){s=l+1;break}}else-1===a&&(c=!1,a=l+1),n===Xe?-1===o?o=l:1!==u&&(u=1):-1!==o&&(u=-1);return-1!==a&&(-1===o||0===u||1===u&&o===a-1&&o===s+1?t.base=t.name=e.slice(s,a):(t.name=e.slice(s,o),t.base=e.slice(s,a),t.ext=e.slice(o,a))),t.dir=s>0&&s!==i?e.slice(0,s-1):t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},ht={resolve(...e){let t="",r=!1;for(let i=e.length-1;i>=-1&&!r;i--){const n=i>=0?e[i]:He();nt(n,"path"),0!==n.length&&(t=`${n}/${t}`,r=n.charCodeAt(0)===et)}return t=ct(t,!r,"/",st),r?`/${t}`:t.length>0?t:"."},normalize(e){if(nt(e,"path"),0===e.length)return".";const t=e.charCodeAt(0)===et,r=e.charCodeAt(e.length-1)===et;return 0===(e=ct(e,!t,"/",st)).length?t?"/":r?"./":".":(r&&(e+="/"),t?`/${e}`:e)},isAbsolute:e=>(nt(e,"path"),e.length>0&&e.charCodeAt(0)===et),join(...e){if(0===e.length)return".";let t;for(let r=0;r<e.length;++r){const i=e[r];nt(i,"path"),i.length>0&&(void 0===t?t=i:t+=`/${i}`)}return void 0===t?".":ht.normalize(t)},relative(e,t){if(nt(e,"from"),nt(t,"to"),e===t)return"";if((e=ht.resolve(e))===(t=ht.resolve(t)))return"";const r=e.length,i=r-1,n=t.length-1,o=i<n?i:n;let s=-1,a=0;for(;a<o;a++){const r=e.charCodeAt(1+a);if(r!==t.charCodeAt(1+a))break;r===et&&(s=a)}if(a===o)if(n>o){if(t.charCodeAt(1+a)===et)return t.slice(1+a+1);if(0===a)return t.slice(1+a)}else i>o&&(e.charCodeAt(1+a)===et?s=a:0===a&&(s=0));let c="";for(a=1+s+1;a<=r;++a)a!==r&&e.charCodeAt(a)!==et||(c+=0===c.length?"..":"/..");return`${c}${t.slice(1+s)}`},toNamespacedPath:e=>e,dirname(e){if(nt(e,"path"),0===e.length)return".";const t=e.charCodeAt(0)===et;let r=-1,i=!0;for(let t=e.length-1;t>=1;--t)if(e.charCodeAt(t)===et){if(!i){r=t;break}}else i=!1;return-1===r?t?"/":".":t&&1===r?"//":e.slice(0,r)},basename(e,t){void 0!==t&&nt(t,"ext"),nt(e,"path");let r,i=0,n=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t===e)return"";let s=t.length-1,a=-1;for(r=e.length-1;r>=0;--r){const c=e.charCodeAt(r);if(c===et){if(!o){i=r+1;break}}else-1===a&&(o=!1,a=r+1),s>=0&&(c===t.charCodeAt(s)?-1==--s&&(n=r):(s=-1,n=a))}return i===n?n=a:-1===n&&(n=e.length),e.slice(i,n)}for(r=e.length-1;r>=0;--r)if(e.charCodeAt(r)===et){if(!o){i=r+1;break}}else-1===n&&(o=!1,n=r+1);return-1===n?"":e.slice(i,n)},extname(e){nt(e,"path");let t=-1,r=0,i=-1,n=!0,o=0;for(let s=e.length-1;s>=0;--s){const a=e.charCodeAt(s);if(a!==et)-1===i&&(n=!1,i=s+1),a===Xe?-1===t?t=s:1!==o&&(o=1):-1!==t&&(o=-1);else if(!n){r=s+1;break}}return-1===t||-1===i||0===o||1===o&&t===i-1&&t===r+1?"":e.slice(t,i)},format:lt.bind(null,"/"),parse(e){nt(e,"path");const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;const r=e.charCodeAt(0)===et;let i;r?(t.root="/",i=1):i=0;let n=-1,o=0,s=-1,a=!0,c=e.length-1,l=0;for(;c>=i;--c){const t=e.charCodeAt(c);if(t!==et)-1===s&&(a=!1,s=c+1),t===Xe?-1===n?n=c:1!==l&&(l=1):-1!==n&&(l=-1);else if(!a){o=c+1;break}}if(-1!==s){const i=0===o&&r?1:o;-1===n||0===l||1===l&&n===s-1&&n===o+1?t.base=t.name=e.slice(i,s):(t.name=e.slice(i,n),t.base=e.slice(i,s),t.ext=e.slice(n,s))}return o>0?t.dir=e.slice(0,o-1):r&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ht.win32=ut.win32=ut,ht.posix=ut.posix=ht;const dt="win32"===ze?ut.normalize:ht.normalize,ft=("win32"===ze?ut.isAbsolute:ht.isAbsolute,"win32"===ze?ut.join:ht.join,"win32"===ze?ut.resolve:ht.resolve),pt="win32"===ze?ut.relative:ht.relative,mt="win32"===ze?ut.dirname:ht.dirname,gt=("win32"===ze?ut.basename:ht.basename,"win32"===ze?ut.extname:ht.extname,"win32"===ze?ut.format:ht.format,"win32"===ze?ut.parse:ht.parse,"win32"===ze?ut.toNamespacedPath:ht.toNamespacedPath,"win32"===ze?ut.sep:ht.sep);"win32"===ze?ut.delimiter:ht.delimiter;Object.prototype.hasOwnProperty;function vt(e){return 47===e||92===e}function yt(e){return e.replace(/[\\/]/g,ht.sep)}function bt(e){return-1===e.indexOf("/")&&(e=yt(e)),/^[a-zA-Z]:(\/|$)/.test(e)&&(e="/"+e),e}function wt(e,t=ht.sep){if(!e)return"";const r=e.length,i=e.charCodeAt(0);if(vt(i)){if(vt(e.charCodeAt(1))&&!vt(e.charCodeAt(2))){let i=3;const n=i;for(;i<r&&!vt(e.charCodeAt(i));i++);if(n!==i&&!vt(e.charCodeAt(i+1)))for(i+=1;i<r;i++)if(vt(e.charCodeAt(i)))return e.slice(0,i+1).replace(/[\\/]/g,t)}return t}if(St(i)&&58===e.charCodeAt(1))return vt(e.charCodeAt(2))?e.slice(0,2)+t:e.slice(0,2);let n=e.indexOf("://");if(-1!==n)for(n+=3;n<r;n++)if(vt(e.charCodeAt(n)))return e.slice(0,n+1);return""}function _t(e,t,r,i=gt){if(e===t)return!0;if(!e||!t)return!1;if(t.length>e.length)return!1;if(r){if(!Ue(e,t))return!1;if(t.length===e.length)return!0;let r=t.length;return t.charAt(t.length-1)===i&&r--,e.charAt(r)===i}return t.charAt(t.length-1)!==i&&(t+=i),0===e.indexOf(t)}function St(e){return e>=65&&e<=90||e>=97&&e<=122}const Et=/^\w[\w\d+.-]*$/,Mt=/^\//,Ct=/^\/\//;function It(e,t){if(!e.scheme&&t)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${e.authority}", path: "${e.path}", query: "${e.query}", fragment: "${e.fragment}"}`);if(e.scheme&&!Et.test(e.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(e.path)if(e.authority){if(!Mt.test(e.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(Ct.test(e.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}const Tt="",kt="/",Rt=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class xt{constructor(e,t,r,i,n,o=!1){"object"==typeof e?(this.scheme=e.scheme||Tt,this.authority=e.authority||Tt,this.path=e.path||Tt,this.query=e.query||Tt,this.fragment=e.fragment||Tt):(this.scheme=function(e,t){return e||t?e:"file"}(e,o),this.authority=t||Tt,this.path=function(e,t){switch(e){case"https":case"http":case"file":t?t[0]!==kt&&(t=kt+t):t=kt}return t}(this.scheme,r||Tt),this.query=i||Tt,this.fragment=n||Tt,It(this,o))}static isUri(e){return e instanceof xt||!!e&&("string"==typeof e.authority&&"string"==typeof e.fragment&&"string"==typeof e.path&&"string"==typeof e.query&&"string"==typeof e.scheme&&"string"==typeof e.fsPath&&"function"==typeof e.with&&"function"==typeof e.toString)}get fsPath(){return Ut(this,!1)}with(e){if(!e)return this;let{scheme:t,authority:r,path:i,query:n,fragment:o}=e;return void 0===t?t=this.scheme:null===t&&(t=Tt),void 0===r?r=this.authority:null===r&&(r=Tt),void 0===i?i=this.path:null===i&&(i=Tt),void 0===n?n=this.query:null===n&&(n=Tt),void 0===o?o=this.fragment:null===o&&(o=Tt),t===this.scheme&&r===this.authority&&i===this.path&&n===this.query&&o===this.fragment?this:new At(t,r,i,n,o)}static parse(e,t=!1){const r=Rt.exec(e);return r?new At(r[2]||Tt,Ft(r[4]||Tt),Ft(r[5]||Tt),Ft(r[7]||Tt),Ft(r[9]||Tt),t):new At(Tt,Tt,Tt,Tt,Tt)}static file(e){let t=Tt;if(ie&&(e=e.replace(/\\/g,kt)),e[0]===kt&&e[1]===kt){const r=e.indexOf(kt,2);-1===r?(t=e.substring(2),e=kt):(t=e.substring(2,r),e=e.substring(r)||kt)}return new At("file",t,e,Tt,Tt)}static from(e){const t=new At(e.scheme,e.authority,e.path,e.query,e.fragment);return It(t,!0),t}static joinPath(e,...t){if(!e.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let r;return r=ie&&"file"===e.scheme?xt.file(ut.join(Ut(e,!0),...t)).path:ht.join(e.path,...t),e.with({path:r})}toString(e=!1){return Nt(this,e)}toJSON(){return this}static revive(e){if(e){if(e instanceof xt)return e;{const t=new At(e);return t._formatted=e.external,t._fsPath=e._sep===Ot?e.fsPath:null,t}}return e}}const Ot=ie?1:void 0;class At extends xt{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=Ut(this,!1)),this._fsPath}toString(e=!1){return e?Nt(this,!0):(this._formatted||(this._formatted=Nt(this,!1)),this._formatted)}toJSON(){const e={$mid:1};return this._fsPath&&(e.fsPath=this._fsPath,e._sep=Ot),this._formatted&&(e.external=this._formatted),this.path&&(e.path=this.path),this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority),this.query&&(e.query=this.query),this.fragment&&(e.fragment=this.fragment),e}}const Pt={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function Dt(e,t){let r,i=-1;for(let n=0;n<e.length;n++){const o=e.charCodeAt(n);if(o>=97&&o<=122||o>=65&&o<=90||o>=48&&o<=57||45===o||46===o||95===o||126===o||t&&47===o)-1!==i&&(r+=encodeURIComponent(e.substring(i,n)),i=-1),void 0!==r&&(r+=e.charAt(n));else{void 0===r&&(r=e.substr(0,n));const t=Pt[o];void 0!==t?(-1!==i&&(r+=encodeURIComponent(e.substring(i,n)),i=-1),r+=t):-1===i&&(i=n)}}return-1!==i&&(r+=encodeURIComponent(e.substring(i))),void 0!==r?r:e}function Lt(e){let t;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);35===i||63===i?(void 0===t&&(t=e.substr(0,r)),t+=Pt[i]):void 0!==t&&(t+=e[r])}return void 0!==t?t:e}function Ut(e,t){let r;return r=e.authority&&e.path.length>1&&"file"===e.scheme?`//${e.authority}${e.path}`:47===e.path.charCodeAt(0)&&(e.path.charCodeAt(1)>=65&&e.path.charCodeAt(1)<=90||e.path.charCodeAt(1)>=97&&e.path.charCodeAt(1)<=122)&&58===e.path.charCodeAt(2)?t?e.path.substr(1):e.path[1].toLowerCase()+e.path.substr(2):e.path,ie&&(r=r.replace(/\//g,"\\")),r}function Nt(e,t){const r=t?Lt:Dt;let i="",{scheme:n,authority:o,path:s,query:a,fragment:c}=e;if(n&&(i+=n,i+=":"),(o||"file"===n)&&(i+=kt,i+=kt),o){let e=o.indexOf("@");if(-1!==e){const t=o.substr(0,e);o=o.substr(e+1),e=t.indexOf(":"),-1===e?i+=r(t,!1):(i+=r(t.substr(0,e),!1),i+=":",i+=r(t.substr(e+1),!1)),i+="@"}o=o.toLowerCase(),e=o.indexOf(":"),-1===e?i+=r(o,!1):(i+=r(o.substr(0,e),!1),i+=o.substr(e))}if(s){if(s.length>=3&&47===s.charCodeAt(0)&&58===s.charCodeAt(2)){const e=s.charCodeAt(1);e>=65&&e<=90&&(s=`/${String.fromCharCode(e+32)}:${s.substr(3)}`)}else if(s.length>=2&&58===s.charCodeAt(1)){const e=s.charCodeAt(0);e>=65&&e<=90&&(s=`${String.fromCharCode(e+32)}:${s.substr(2)}`)}i+=r(s,!0)}return a&&(i+="?",i+=r(a,!1)),c&&(i+="#",i+=t?c:Dt(c,!1)),i}function jt(e){try{return decodeURIComponent(e)}catch(t){return e.length>3?e.substr(0,3)+jt(e.substr(3)):e}}const Bt=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function Ft(e){return e.match(Bt)?e.replace(Bt,(e=>jt(e))):e}var Kt,qt;(qt=Kt||(Kt={})).inMemory="inmemory",qt.vscode="vscode",qt.internal="private",qt.walkThrough="walkThrough",qt.walkThroughSnippet="walkThroughSnippet",qt.http="http",qt.https="https",qt.file="file",qt.mailto="mailto",qt.untitled="untitled",qt.data="data",qt.command="command",qt.vscodeRemote="vscode-remote",qt.vscodeRemoteResource="vscode-remote-resource",qt.userData="vscode-userdata",qt.vscodeCustomEditor="vscode-custom-editor",qt.vscodeNotebook="vscode-notebook",qt.vscodeNotebookCell="vscode-notebook-cell",qt.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",qt.vscodeNotebookCellOutput="vscode-notebook-cell-output",qt.vscodeInteractive="vscode-interactive",qt.vscodeInteractiveInput="vscode-interactive-input",qt.vscodeSettings="vscode-settings",qt.vscodeWorkspaceTrust="vscode-workspace-trust",qt.vscodeTerminal="vscode-terminal",qt.webviewPanel="webview-panel",qt.vscodeWebview="vscode-webview",qt.extension="extension",qt.vscodeFileResource="vscode-file",qt.tmp="tmp";const $t=new class{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null}setPreferredWebSchema(e){this._preferredWebSchema=e}setDelegate(e){this._delegate=e}set(e,t,r){this._hosts[e]=t,this._ports[e]=r}setConnectionToken(e,t){this._connectionTokens[e]=t}rewrite(e){if(this._delegate)return this._delegate(e);const t=e.authority;let r=this._hosts[t];r&&-1!==r.indexOf(":")&&(r=`[${r}]`);const i=this._ports[t],n=this._connectionTokens[t];let o=`path=${encodeURIComponent(e.path)}`;return"string"==typeof n&&(o+=`&tkn=${encodeURIComponent(n)}`),xt.from({scheme:ae?this._preferredWebSchema:Kt.vscodeRemoteResource,authority:`${r}:${i}`,path:"/vscode-remote-resource",query:o})}};new class{constructor(){this.FALLBACK_AUTHORITY="vscode-app"}asBrowserUri(e,t,r){const i=this.toUri(e,t);if(i.scheme===Kt.vscodeRemote)return $t.rewrite(i);let n=!1;return se&&(r||X)&&i.scheme===Kt.file&&(n=!0),i.scheme===Kt.file&&"function"==typeof z.importScripts&&"vscode-file://vscode-app"===z.origin&&(n=!0),n?i.with({scheme:Kt.vscodeFileResource,authority:i.authority||this.FALLBACK_AUTHORITY,query:null,fragment:null}):i}asFileUri(e,t){const r=this.toUri(e,t);return r.scheme===Kt.vscodeFileResource?r.with({scheme:Kt.file,authority:r.authority!==this.FALLBACK_AUTHORITY?r.authority:null,query:null,fragment:null}):r}toUri(e,t){return xt.isUri(e)?e:xt.parse(t.toUrl(e))}};function Wt(e){return Ut(e,!0)}class Vt{constructor(e){this._ignorePathCasing=e}compare(e,t,r=!1){return e===t?0:xe(this.getComparisonKey(e,r),this.getComparisonKey(t,r))}isEqual(e,t,r=!1){return e===t||!(!e||!t)&&this.getComparisonKey(e,r)===this.getComparisonKey(t,r)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:t?null:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,r=!1){if(e.scheme===t.scheme){if(e.scheme===Kt.file)return _t(Wt(e),Wt(t),this._ignorePathCasing(e))&&e.query===t.query&&(r||e.fragment===t.fragment);if(zt(e.authority,t.authority))return _t(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(r||e.fragment===t.fragment)}return!1}joinPath(e,...t){return xt.joinPath(e,...t)}basenameOrAuthority(e){return Gt(e)||e.authority}basename(e){return ht.basename(e.path)}extname(e){return ht.extname(e.path)}dirname(e){if(0===e.path.length)return e;let t;return e.scheme===Kt.file?t=xt.file(mt(Wt(e))).path:(t=ht.dirname(e.path),e.authority&&t.length&&47!==t.charCodeAt(0)&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return t=e.scheme===Kt.file?xt.file(dt(Wt(e))).path:ht.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!zt(e.authority,t.authority))return;if(e.scheme===Kt.file){const r=pt(Wt(e),Wt(t));return ie?yt(r):r}let r=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let e=0;for(const t=Math.min(r.length,i.length);e<t&&(r.charCodeAt(e)===i.charCodeAt(e)||r.charAt(e).toLowerCase()===i.charAt(e).toLowerCase());e++);r=i.substr(0,e)+r.substr(e)}return ht.relative(r,i)}resolvePath(e,t){if(e.scheme===Kt.file){const r=xt.file(ft(Wt(e),t));return e.with({authority:r.authority,path:r.path})}return t=bt(t),e.with({path:ht.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&"/"===e.path[0]}isEqualAuthority(e,t){return e===t||De(e,t)}hasTrailingPathSeparator(e,t=gt){if(e.scheme===Kt.file){const r=Wt(e);return r.length>wt(r).length&&r[r.length-1]===t}{const t=e.path;return t.length>1&&47===t.charCodeAt(t.length-1)&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=gt){return Yt(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=gt){let r=!1;if(e.scheme===Kt.file){const i=Wt(e);r=void 0!==i&&i.length===wt(i).length&&i[i.length-1]===t}else{t="/";const i=e.path;r=1===i.length&&47===i.charCodeAt(i.length-1)}return r||Yt(e,t)?e:e.with({path:e.path+"/"})}}const Ht=new Vt((()=>!1)),Gt=(new Vt((e=>e.scheme!==Kt.file||!oe)),new Vt((e=>!0)),Ht.isEqual.bind(Ht),Ht.isEqualOrParent.bind(Ht),Ht.getComparisonKey.bind(Ht),Ht.basenameOrAuthority.bind(Ht),Ht.basename.bind(Ht)),zt=(Ht.extname.bind(Ht),Ht.dirname.bind(Ht),Ht.joinPath.bind(Ht),Ht.normalizePath.bind(Ht),Ht.relativePath.bind(Ht),Ht.resolvePath.bind(Ht),Ht.isAbsolutePath.bind(Ht),Ht.isEqualAuthority.bind(Ht)),Yt=Ht.hasTrailingPathSeparator.bind(Ht);Ht.removeTrailingPathSeparator.bind(Ht),Ht.addTrailingPathSeparator.bind(Ht);var Jt,Zt;(Zt=Jt||(Jt={})).META_DATA_LABEL="label",Zt.META_DATA_DESCRIPTION="description",Zt.META_DATA_SIZE="size",Zt.META_DATA_MIME="mime",Zt.parseMetaData=function(e){const t=new Map;e.path.substring(e.path.indexOf(";")+1,e.path.lastIndexOf(";")).split(";").forEach((e=>{const[r,i]=e.split(":");r&&i&&t.set(r,i)}));const r=e.path.substring(0,e.path.indexOf(";"));return r&&t.set(Zt.META_DATA_MIME,r),t};let Qt;!function(){if("function"!=typeof requestIdleCallback||"function"!=typeof cancelIdleCallback){const e=Object.freeze({didTimeout:!0,timeRemaining:()=>15});Qt=t=>{const r=setTimeout((()=>t(e)));let i=!1;return{dispose(){i||(i=!0,clearTimeout(r))}}}}else Qt=(e,t)=>{const r=requestIdleCallback(e,"number"==typeof t?{timeout:t}:void 0);let i=!1;return{dispose(){i||(i=!0,cancelIdleCallback(r))}}}}();class Xt{constructor(e){this._didRun=!1,this._executor=()=>{try{this._value=e()}catch(e){this._error=e}finally{this._didRun=!0}},this._handle=Qt((()=>this._executor()))}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}}var er;(er||(er={})).settled=async function(e){let t;const r=await Promise.all(e.map((e=>e.then((e=>e),(e=>{t||(t=e)})))));if(void 0!==t)throw t;return r};var tr,rr;(rr=tr||(tr={}))[rr.Null=0]="Null",rr[rr.Backspace=8]="Backspace",rr[rr.Tab=9]="Tab",rr[rr.LineFeed=10]="LineFeed",rr[rr.CarriageReturn=13]="CarriageReturn",rr[rr.Space=32]="Space",rr[rr.ExclamationMark=33]="ExclamationMark",rr[rr.DoubleQuote=34]="DoubleQuote",rr[rr.Hash=35]="Hash",rr[rr.DollarSign=36]="DollarSign",rr[rr.PercentSign=37]="PercentSign",rr[rr.Ampersand=38]="Ampersand",rr[rr.SingleQuote=39]="SingleQuote",rr[rr.OpenParen=40]="OpenParen",rr[rr.CloseParen=41]="CloseParen",rr[rr.Asterisk=42]="Asterisk",rr[rr.Plus=43]="Plus",rr[rr.Comma=44]="Comma",rr[rr.Dash=45]="Dash",rr[rr.Period=46]="Period",rr[rr.Slash=47]="Slash",rr[rr.Digit0=48]="Digit0",rr[rr.Digit1=49]="Digit1",rr[rr.Digit2=50]="Digit2",rr[rr.Digit3=51]="Digit3",rr[rr.Digit4=52]="Digit4",rr[rr.Digit5=53]="Digit5",rr[rr.Digit6=54]="Digit6",rr[rr.Digit7=55]="Digit7",rr[rr.Digit8=56]="Digit8",rr[rr.Digit9=57]="Digit9",rr[rr.Colon=58]="Colon",rr[rr.Semicolon=59]="Semicolon",rr[rr.LessThan=60]="LessThan",rr[rr.Equals=61]="Equals",rr[rr.GreaterThan=62]="GreaterThan",rr[rr.QuestionMark=63]="QuestionMark",rr[rr.AtSign=64]="AtSign",rr[rr.A=65]="A",rr[rr.B=66]="B",rr[rr.C=67]="C",rr[rr.D=68]="D",rr[rr.E=69]="E",rr[rr.F=70]="F",rr[rr.G=71]="G",rr[rr.H=72]="H",rr[rr.I=73]="I",rr[rr.J=74]="J",rr[rr.K=75]="K",rr[rr.L=76]="L",rr[rr.M=77]="M",rr[rr.N=78]="N",rr[rr.O=79]="O",rr[rr.P=80]="P",rr[rr.Q=81]="Q",rr[rr.R=82]="R",rr[rr.S=83]="S",rr[rr.T=84]="T",rr[rr.U=85]="U",rr[rr.V=86]="V",rr[rr.W=87]="W",rr[rr.X=88]="X",rr[rr.Y=89]="Y",rr[rr.Z=90]="Z",rr[rr.OpenSquareBracket=91]="OpenSquareBracket",rr[rr.Backslash=92]="Backslash",rr[rr.CloseSquareBracket=93]="CloseSquareBracket",rr[rr.Caret=94]="Caret",rr[rr.Underline=95]="Underline",rr[rr.BackTick=96]="BackTick",rr[rr.a=97]="a",rr[rr.b=98]="b",rr[rr.c=99]="c",rr[rr.d=100]="d",rr[rr.e=101]="e",rr[rr.f=102]="f",rr[rr.g=103]="g",rr[rr.h=104]="h",rr[rr.i=105]="i",rr[rr.j=106]="j",rr[rr.k=107]="k",rr[rr.l=108]="l",rr[rr.m=109]="m",rr[rr.n=110]="n",rr[rr.o=111]="o",rr[rr.p=112]="p",rr[rr.q=113]="q",rr[rr.r=114]="r",rr[rr.s=115]="s",rr[rr.t=116]="t",rr[rr.u=117]="u",rr[rr.v=118]="v",rr[rr.w=119]="w",rr[rr.x=120]="x",rr[rr.y=121]="y",rr[rr.z=122]="z",rr[rr.OpenCurlyBrace=123]="OpenCurlyBrace",rr[rr.Pipe=124]="Pipe",rr[rr.CloseCurlyBrace=125]="CloseCurlyBrace",rr[rr.Tilde=126]="Tilde",rr[rr.U_Combining_Grave_Accent=768]="U_Combining_Grave_Accent",rr[rr.U_Combining_Acute_Accent=769]="U_Combining_Acute_Accent",rr[rr.U_Combining_Circumflex_Accent=770]="U_Combining_Circumflex_Accent",rr[rr.U_Combining_Tilde=771]="U_Combining_Tilde",rr[rr.U_Combining_Macron=772]="U_Combining_Macron",rr[rr.U_Combining_Overline=773]="U_Combining_Overline",rr[rr.U_Combining_Breve=774]="U_Combining_Breve",rr[rr.U_Combining_Dot_Above=775]="U_Combining_Dot_Above",rr[rr.U_Combining_Diaeresis=776]="U_Combining_Diaeresis",rr[rr.U_Combining_Hook_Above=777]="U_Combining_Hook_Above",rr[rr.U_Combining_Ring_Above=778]="U_Combining_Ring_Above",rr[rr.U_Combining_Double_Acute_Accent=779]="U_Combining_Double_Acute_Accent",rr[rr.U_Combining_Caron=780]="U_Combining_Caron",rr[rr.U_Combining_Vertical_Line_Above=781]="U_Combining_Vertical_Line_Above",rr[rr.U_Combining_Double_Vertical_Line_Above=782]="U_Combining_Double_Vertical_Line_Above",rr[rr.U_Combining_Double_Grave_Accent=783]="U_Combining_Double_Grave_Accent",rr[rr.U_Combining_Candrabindu=784]="U_Combining_Candrabindu",rr[rr.U_Combining_Inverted_Breve=785]="U_Combining_Inverted_Breve",rr[rr.U_Combining_Turned_Comma_Above=786]="U_Combining_Turned_Comma_Above",rr[rr.U_Combining_Comma_Above=787]="U_Combining_Comma_Above",rr[rr.U_Combining_Reversed_Comma_Above=788]="U_Combining_Reversed_Comma_Above",rr[rr.U_Combining_Comma_Above_Right=789]="U_Combining_Comma_Above_Right",rr[rr.U_Combining_Grave_Accent_Below=790]="U_Combining_Grave_Accent_Below",rr[rr.U_Combining_Acute_Accent_Below=791]="U_Combining_Acute_Accent_Below",rr[rr.U_Combining_Left_Tack_Below=792]="U_Combining_Left_Tack_Below",rr[rr.U_Combining_Right_Tack_Below=793]="U_Combining_Right_Tack_Below",rr[rr.U_Combining_Left_Angle_Above=794]="U_Combining_Left_Angle_Above",rr[rr.U_Combining_Horn=795]="U_Combining_Horn",rr[rr.U_Combining_Left_Half_Ring_Below=796]="U_Combining_Left_Half_Ring_Below",rr[rr.U_Combining_Up_Tack_Below=797]="U_Combining_Up_Tack_Below",rr[rr.U_Combining_Down_Tack_Below=798]="U_Combining_Down_Tack_Below",rr[rr.U_Combining_Plus_Sign_Below=799]="U_Combining_Plus_Sign_Below",rr[rr.U_Combining_Minus_Sign_Below=800]="U_Combining_Minus_Sign_Below",rr[rr.U_Combining_Palatalized_Hook_Below=801]="U_Combining_Palatalized_Hook_Below",rr[rr.U_Combining_Retroflex_Hook_Below=802]="U_Combining_Retroflex_Hook_Below",rr[rr.U_Combining_Dot_Below=803]="U_Combining_Dot_Below",rr[rr.U_Combining_Diaeresis_Below=804]="U_Combining_Diaeresis_Below",rr[rr.U_Combining_Ring_Below=805]="U_Combining_Ring_Below",rr[rr.U_Combining_Comma_Below=806]="U_Combining_Comma_Below",rr[rr.U_Combining_Cedilla=807]="U_Combining_Cedilla",rr[rr.U_Combining_Ogonek=808]="U_Combining_Ogonek",rr[rr.U_Combining_Vertical_Line_Below=809]="U_Combining_Vertical_Line_Below",rr[rr.U_Combining_Bridge_Below=810]="U_Combining_Bridge_Below",rr[rr.U_Combining_Inverted_Double_Arch_Below=811]="U_Combining_Inverted_Double_Arch_Below",rr[rr.U_Combining_Caron_Below=812]="U_Combining_Caron_Below",rr[rr.U_Combining_Circumflex_Accent_Below=813]="U_Combining_Circumflex_Accent_Below",rr[rr.U_Combining_Breve_Below=814]="U_Combining_Breve_Below",rr[rr.U_Combining_Inverted_Breve_Below=815]="U_Combining_Inverted_Breve_Below",rr[rr.U_Combining_Tilde_Below=816]="U_Combining_Tilde_Below",rr[rr.U_Combining_Macron_Below=817]="U_Combining_Macron_Below",rr[rr.U_Combining_Low_Line=818]="U_Combining_Low_Line",rr[rr.U_Combining_Double_Low_Line=819]="U_Combining_Double_Low_Line",rr[rr.U_Combining_Tilde_Overlay=820]="U_Combining_Tilde_Overlay",rr[rr.U_Combining_Short_Stroke_Overlay=821]="U_Combining_Short_Stroke_Overlay",rr[rr.U_Combining_Long_Stroke_Overlay=822]="U_Combining_Long_Stroke_Overlay",rr[rr.U_Combining_Short_Solidus_Overlay=823]="U_Combining_Short_Solidus_Overlay",rr[rr.U_Combining_Long_Solidus_Overlay=824]="U_Combining_Long_Solidus_Overlay",rr[rr.U_Combining_Right_Half_Ring_Below=825]="U_Combining_Right_Half_Ring_Below",rr[rr.U_Combining_Inverted_Bridge_Below=826]="U_Combining_Inverted_Bridge_Below",rr[rr.U_Combining_Square_Below=827]="U_Combining_Square_Below",rr[rr.U_Combining_Seagull_Below=828]="U_Combining_Seagull_Below",rr[rr.U_Combining_X_Above=829]="U_Combining_X_Above",rr[rr.U_Combining_Vertical_Tilde=830]="U_Combining_Vertical_Tilde",rr[rr.U_Combining_Double_Overline=831]="U_Combining_Double_Overline",rr[rr.U_Combining_Grave_Tone_Mark=832]="U_Combining_Grave_Tone_Mark",rr[rr.U_Combining_Acute_Tone_Mark=833]="U_Combining_Acute_Tone_Mark",rr[rr.U_Combining_Greek_Perispomeni=834]="U_Combining_Greek_Perispomeni",rr[rr.U_Combining_Greek_Koronis=835]="U_Combining_Greek_Koronis",rr[rr.U_Combining_Greek_Dialytika_Tonos=836]="U_Combining_Greek_Dialytika_Tonos",rr[rr.U_Combining_Greek_Ypogegrammeni=837]="U_Combining_Greek_Ypogegrammeni",rr[rr.U_Combining_Bridge_Above=838]="U_Combining_Bridge_Above",rr[rr.U_Combining_Equals_Sign_Below=839]="U_Combining_Equals_Sign_Below",rr[rr.U_Combining_Double_Vertical_Line_Below=840]="U_Combining_Double_Vertical_Line_Below",rr[rr.U_Combining_Left_Angle_Below=841]="U_Combining_Left_Angle_Below",rr[rr.U_Combining_Not_Tilde_Above=842]="U_Combining_Not_Tilde_Above",rr[rr.U_Combining_Homothetic_Above=843]="U_Combining_Homothetic_Above",rr[rr.U_Combining_Almost_Equal_To_Above=844]="U_Combining_Almost_Equal_To_Above",rr[rr.U_Combining_Left_Right_Arrow_Below=845]="U_Combining_Left_Right_Arrow_Below",rr[rr.U_Combining_Upwards_Arrow_Below=846]="U_Combining_Upwards_Arrow_Below",rr[rr.U_Combining_Grapheme_Joiner=847]="U_Combining_Grapheme_Joiner",rr[rr.U_Combining_Right_Arrowhead_Above=848]="U_Combining_Right_Arrowhead_Above",rr[rr.U_Combining_Left_Half_Ring_Above=849]="U_Combining_Left_Half_Ring_Above",rr[rr.U_Combining_Fermata=850]="U_Combining_Fermata",rr[rr.U_Combining_X_Below=851]="U_Combining_X_Below",rr[rr.U_Combining_Left_Arrowhead_Below=852]="U_Combining_Left_Arrowhead_Below",rr[rr.U_Combining_Right_Arrowhead_Below=853]="U_Combining_Right_Arrowhead_Below",rr[rr.U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below=854]="U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below",rr[rr.U_Combining_Right_Half_Ring_Above=855]="U_Combining_Right_Half_Ring_Above",rr[rr.U_Combining_Dot_Above_Right=856]="U_Combining_Dot_Above_Right",rr[rr.U_Combining_Asterisk_Below=857]="U_Combining_Asterisk_Below",rr[rr.U_Combining_Double_Ring_Below=858]="U_Combining_Double_Ring_Below",rr[rr.U_Combining_Zigzag_Above=859]="U_Combining_Zigzag_Above",rr[rr.U_Combining_Double_Breve_Below=860]="U_Combining_Double_Breve_Below",rr[rr.U_Combining_Double_Breve=861]="U_Combining_Double_Breve",rr[rr.U_Combining_Double_Macron=862]="U_Combining_Double_Macron",rr[rr.U_Combining_Double_Macron_Below=863]="U_Combining_Double_Macron_Below",rr[rr.U_Combining_Double_Tilde=864]="U_Combining_Double_Tilde",rr[rr.U_Combining_Double_Inverted_Breve=865]="U_Combining_Double_Inverted_Breve",rr[rr.U_Combining_Double_Rightwards_Arrow_Below=866]="U_Combining_Double_Rightwards_Arrow_Below",rr[rr.U_Combining_Latin_Small_Letter_A=867]="U_Combining_Latin_Small_Letter_A",rr[rr.U_Combining_Latin_Small_Letter_E=868]="U_Combining_Latin_Small_Letter_E",rr[rr.U_Combining_Latin_Small_Letter_I=869]="U_Combining_Latin_Small_Letter_I",rr[rr.U_Combining_Latin_Small_Letter_O=870]="U_Combining_Latin_Small_Letter_O",rr[rr.U_Combining_Latin_Small_Letter_U=871]="U_Combining_Latin_Small_Letter_U",rr[rr.U_Combining_Latin_Small_Letter_C=872]="U_Combining_Latin_Small_Letter_C",rr[rr.U_Combining_Latin_Small_Letter_D=873]="U_Combining_Latin_Small_Letter_D",rr[rr.U_Combining_Latin_Small_Letter_H=874]="U_Combining_Latin_Small_Letter_H",rr[rr.U_Combining_Latin_Small_Letter_M=875]="U_Combining_Latin_Small_Letter_M",rr[rr.U_Combining_Latin_Small_Letter_R=876]="U_Combining_Latin_Small_Letter_R",rr[rr.U_Combining_Latin_Small_Letter_T=877]="U_Combining_Latin_Small_Letter_T",rr[rr.U_Combining_Latin_Small_Letter_V=878]="U_Combining_Latin_Small_Letter_V",rr[rr.U_Combining_Latin_Small_Letter_X=879]="U_Combining_Latin_Small_Letter_X",rr[rr.LINE_SEPARATOR=8232]="LINE_SEPARATOR",rr[rr.PARAGRAPH_SEPARATOR=8233]="PARAGRAPH_SEPARATOR",rr[rr.NEXT_LINE=133]="NEXT_LINE",rr[rr.U_CIRCUMFLEX=94]="U_CIRCUMFLEX",rr[rr.U_GRAVE_ACCENT=96]="U_GRAVE_ACCENT",rr[rr.U_DIAERESIS=168]="U_DIAERESIS",rr[rr.U_MACRON=175]="U_MACRON",rr[rr.U_ACUTE_ACCENT=180]="U_ACUTE_ACCENT",rr[rr.U_CEDILLA=184]="U_CEDILLA",rr[rr.U_MODIFIER_LETTER_LEFT_ARROWHEAD=706]="U_MODIFIER_LETTER_LEFT_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_RIGHT_ARROWHEAD=707]="U_MODIFIER_LETTER_RIGHT_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_UP_ARROWHEAD=708]="U_MODIFIER_LETTER_UP_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_DOWN_ARROWHEAD=709]="U_MODIFIER_LETTER_DOWN_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING=722]="U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING",rr[rr.U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING=723]="U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING",rr[rr.U_MODIFIER_LETTER_UP_TACK=724]="U_MODIFIER_LETTER_UP_TACK",rr[rr.U_MODIFIER_LETTER_DOWN_TACK=725]="U_MODIFIER_LETTER_DOWN_TACK",rr[rr.U_MODIFIER_LETTER_PLUS_SIGN=726]="U_MODIFIER_LETTER_PLUS_SIGN",rr[rr.U_MODIFIER_LETTER_MINUS_SIGN=727]="U_MODIFIER_LETTER_MINUS_SIGN",rr[rr.U_BREVE=728]="U_BREVE",rr[rr.U_DOT_ABOVE=729]="U_DOT_ABOVE",rr[rr.U_RING_ABOVE=730]="U_RING_ABOVE",rr[rr.U_OGONEK=731]="U_OGONEK",rr[rr.U_SMALL_TILDE=732]="U_SMALL_TILDE",rr[rr.U_DOUBLE_ACUTE_ACCENT=733]="U_DOUBLE_ACUTE_ACCENT",rr[rr.U_MODIFIER_LETTER_RHOTIC_HOOK=734]="U_MODIFIER_LETTER_RHOTIC_HOOK",rr[rr.U_MODIFIER_LETTER_CROSS_ACCENT=735]="U_MODIFIER_LETTER_CROSS_ACCENT",rr[rr.U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR=741]="U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR",rr[rr.U_MODIFIER_LETTER_HIGH_TONE_BAR=742]="U_MODIFIER_LETTER_HIGH_TONE_BAR",rr[rr.U_MODIFIER_LETTER_MID_TONE_BAR=743]="U_MODIFIER_LETTER_MID_TONE_BAR",rr[rr.U_MODIFIER_LETTER_LOW_TONE_BAR=744]="U_MODIFIER_LETTER_LOW_TONE_BAR",rr[rr.U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR=745]="U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR",rr[rr.U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK=746]="U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK",rr[rr.U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK=747]="U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK",rr[rr.U_MODIFIER_LETTER_UNASPIRATED=749]="U_MODIFIER_LETTER_UNASPIRATED",rr[rr.U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD=751]="U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_LOW_UP_ARROWHEAD=752]="U_MODIFIER_LETTER_LOW_UP_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD=753]="U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD=754]="U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD",rr[rr.U_MODIFIER_LETTER_LOW_RING=755]="U_MODIFIER_LETTER_LOW_RING",rr[rr.U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT=756]="U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT",rr[rr.U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT=757]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT",rr[rr.U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT=758]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT",rr[rr.U_MODIFIER_LETTER_LOW_TILDE=759]="U_MODIFIER_LETTER_LOW_TILDE",rr[rr.U_MODIFIER_LETTER_RAISED_COLON=760]="U_MODIFIER_LETTER_RAISED_COLON",rr[rr.U_MODIFIER_LETTER_BEGIN_HIGH_TONE=761]="U_MODIFIER_LETTER_BEGIN_HIGH_TONE",rr[rr.U_MODIFIER_LETTER_END_HIGH_TONE=762]="U_MODIFIER_LETTER_END_HIGH_TONE",rr[rr.U_MODIFIER_LETTER_BEGIN_LOW_TONE=763]="U_MODIFIER_LETTER_BEGIN_LOW_TONE",rr[rr.U_MODIFIER_LETTER_END_LOW_TONE=764]="U_MODIFIER_LETTER_END_LOW_TONE",rr[rr.U_MODIFIER_LETTER_SHELF=765]="U_MODIFIER_LETTER_SHELF",rr[rr.U_MODIFIER_LETTER_OPEN_SHELF=766]="U_MODIFIER_LETTER_OPEN_SHELF",rr[rr.U_MODIFIER_LETTER_LOW_LEFT_ARROW=767]="U_MODIFIER_LETTER_LOW_LEFT_ARROW",rr[rr.U_GREEK_LOWER_NUMERAL_SIGN=885]="U_GREEK_LOWER_NUMERAL_SIGN",rr[rr.U_GREEK_TONOS=900]="U_GREEK_TONOS",rr[rr.U_GREEK_DIALYTIKA_TONOS=901]="U_GREEK_DIALYTIKA_TONOS",rr[rr.U_GREEK_KORONIS=8125]="U_GREEK_KORONIS",rr[rr.U_GREEK_PSILI=8127]="U_GREEK_PSILI",rr[rr.U_GREEK_PERISPOMENI=8128]="U_GREEK_PERISPOMENI",rr[rr.U_GREEK_DIALYTIKA_AND_PERISPOMENI=8129]="U_GREEK_DIALYTIKA_AND_PERISPOMENI",rr[rr.U_GREEK_PSILI_AND_VARIA=8141]="U_GREEK_PSILI_AND_VARIA",rr[rr.U_GREEK_PSILI_AND_OXIA=8142]="U_GREEK_PSILI_AND_OXIA",rr[rr.U_GREEK_PSILI_AND_PERISPOMENI=8143]="U_GREEK_PSILI_AND_PERISPOMENI",rr[rr.U_GREEK_DASIA_AND_VARIA=8157]="U_GREEK_DASIA_AND_VARIA",rr[rr.U_GREEK_DASIA_AND_OXIA=8158]="U_GREEK_DASIA_AND_OXIA",rr[rr.U_GREEK_DASIA_AND_PERISPOMENI=8159]="U_GREEK_DASIA_AND_PERISPOMENI",rr[rr.U_GREEK_DIALYTIKA_AND_VARIA=8173]="U_GREEK_DIALYTIKA_AND_VARIA",rr[rr.U_GREEK_DIALYTIKA_AND_OXIA=8174]="U_GREEK_DIALYTIKA_AND_OXIA",rr[rr.U_GREEK_VARIA=8175]="U_GREEK_VARIA",rr[rr.U_GREEK_OXIA=8189]="U_GREEK_OXIA",rr[rr.U_GREEK_DASIA=8190]="U_GREEK_DASIA",rr[rr.U_OVERLINE=8254]="U_OVERLINE",rr[rr.UTF8_BOM=65279]="UTF8_BOM";const ir=new class{constructor(){this._icons=new Map,this._onDidRegister=new we}add(e){const t=this._icons.get(e.id);t?e.description?t.description=e.description:console.error(`Duplicate registration of codicon ${e.id}`):(this._icons.set(e.id,e),this._onDidRegister.fire(e))}get(e){return this._icons.get(e)}get all(){return this._icons.values()}get onDidRegister(){return this._onDidRegister.event}};class nr{constructor(e,t,r){this.id=e,this.definition=t,this.description=r,ir.add(this)}get classNames(){return"codicon codicon-"+this.id}get classNamesArray(){return["codicon","codicon-"+this.id]}get cssSelector(){return".codicon.codicon-"+this.id}}var or,sr;!function(e){e.iconNameSegment="[A-Za-z0-9]+",e.iconNameExpression="[A-Za-z0-9\\-]+",e.iconModifierExpression="~[A-Za-z]+";const t=new RegExp(`^(${e.iconNameExpression})(${e.iconModifierExpression})?$`);function r(e){if(e instanceof nr)return["codicon","codicon-"+e.id];const i=t.exec(e.id);if(!i)return r(nr.error);let[,n,o]=i;const s=["codicon","codicon-"+n];return o&&s.push("codicon-modifier-"+o.substr(1)),s}e.asClassNameArray=r,e.asClassName=function(e){return r(e).join(" ")},e.asCSSSelector=function(e){return"."+r(e).join(".")}}(or||(or={})),(sr=nr||(nr={})).add=new sr("add",{fontCharacter:"\\ea60"}),sr.plus=new sr("plus",{fontCharacter:"\\ea60"}),sr.gistNew=new sr("gist-new",{fontCharacter:"\\ea60"}),sr.repoCreate=new sr("repo-create",{fontCharacter:"\\ea60"}),sr.lightbulb=new sr("lightbulb",{fontCharacter:"\\ea61"}),sr.lightBulb=new sr("light-bulb",{fontCharacter:"\\ea61"}),sr.repo=new sr("repo",{fontCharacter:"\\ea62"}),sr.repoDelete=new sr("repo-delete",{fontCharacter:"\\ea62"}),sr.gistFork=new sr("gist-fork",{fontCharacter:"\\ea63"}),sr.repoForked=new sr("repo-forked",{fontCharacter:"\\ea63"}),sr.gitPullRequest=new sr("git-pull-request",{fontCharacter:"\\ea64"}),sr.gitPullRequestAbandoned=new sr("git-pull-request-abandoned",{fontCharacter:"\\ea64"}),sr.recordKeys=new sr("record-keys",{fontCharacter:"\\ea65"}),sr.keyboard=new sr("keyboard",{fontCharacter:"\\ea65"}),sr.tag=new sr("tag",{fontCharacter:"\\ea66"}),sr.tagAdd=new sr("tag-add",{fontCharacter:"\\ea66"}),sr.tagRemove=new sr("tag-remove",{fontCharacter:"\\ea66"}),sr.person=new sr("person",{fontCharacter:"\\ea67"}),sr.personFollow=new sr("person-follow",{fontCharacter:"\\ea67"}),sr.personOutline=new sr("person-outline",{fontCharacter:"\\ea67"}),sr.personFilled=new sr("person-filled",{fontCharacter:"\\ea67"}),sr.gitBranch=new sr("git-branch",{fontCharacter:"\\ea68"}),sr.gitBranchCreate=new sr("git-branch-create",{fontCharacter:"\\ea68"}),sr.gitBranchDelete=new sr("git-branch-delete",{fontCharacter:"\\ea68"}),sr.sourceControl=new sr("source-control",{fontCharacter:"\\ea68"}),sr.mirror=new sr("mirror",{fontCharacter:"\\ea69"}),sr.mirrorPublic=new sr("mirror-public",{fontCharacter:"\\ea69"}),sr.star=new sr("star",{fontCharacter:"\\ea6a"}),sr.starAdd=new sr("star-add",{fontCharacter:"\\ea6a"}),sr.starDelete=new sr("star-delete",{fontCharacter:"\\ea6a"}),sr.starEmpty=new sr("star-empty",{fontCharacter:"\\ea6a"}),sr.comment=new sr("comment",{fontCharacter:"\\ea6b"}),sr.commentAdd=new sr("comment-add",{fontCharacter:"\\ea6b"}),sr.alert=new sr("alert",{fontCharacter:"\\ea6c"}),sr.warning=new sr("warning",{fontCharacter:"\\ea6c"}),sr.search=new sr("search",{fontCharacter:"\\ea6d"}),sr.searchSave=new sr("search-save",{fontCharacter:"\\ea6d"}),sr.logOut=new sr("log-out",{fontCharacter:"\\ea6e"}),sr.signOut=new sr("sign-out",{fontCharacter:"\\ea6e"}),sr.logIn=new sr("log-in",{fontCharacter:"\\ea6f"}),sr.signIn=new sr("sign-in",{fontCharacter:"\\ea6f"}),sr.eye=new sr("eye",{fontCharacter:"\\ea70"}),sr.eyeUnwatch=new sr("eye-unwatch",{fontCharacter:"\\ea70"}),sr.eyeWatch=new sr("eye-watch",{fontCharacter:"\\ea70"}),sr.circleFilled=new sr("circle-filled",{fontCharacter:"\\ea71"}),sr.primitiveDot=new sr("primitive-dot",{fontCharacter:"\\ea71"}),sr.closeDirty=new sr("close-dirty",{fontCharacter:"\\ea71"}),sr.debugBreakpoint=new sr("debug-breakpoint",{fontCharacter:"\\ea71"}),sr.debugBreakpointDisabled=new sr("debug-breakpoint-disabled",{fontCharacter:"\\ea71"}),sr.debugHint=new sr("debug-hint",{fontCharacter:"\\ea71"}),sr.primitiveSquare=new sr("primitive-square",{fontCharacter:"\\ea72"}),sr.edit=new sr("edit",{fontCharacter:"\\ea73"}),sr.pencil=new sr("pencil",{fontCharacter:"\\ea73"}),sr.info=new sr("info",{fontCharacter:"\\ea74"}),sr.issueOpened=new sr("issue-opened",{fontCharacter:"\\ea74"}),sr.gistPrivate=new sr("gist-private",{fontCharacter:"\\ea75"}),sr.gitForkPrivate=new sr("git-fork-private",{fontCharacter:"\\ea75"}),sr.lock=new sr("lock",{fontCharacter:"\\ea75"}),sr.mirrorPrivate=new sr("mirror-private",{fontCharacter:"\\ea75"}),sr.close=new sr("close",{fontCharacter:"\\ea76"}),sr.removeClose=new sr("remove-close",{fontCharacter:"\\ea76"}),sr.x=new sr("x",{fontCharacter:"\\ea76"}),sr.repoSync=new sr("repo-sync",{fontCharacter:"\\ea77"}),sr.sync=new sr("sync",{fontCharacter:"\\ea77"}),sr.clone=new sr("clone",{fontCharacter:"\\ea78"}),sr.desktopDownload=new sr("desktop-download",{fontCharacter:"\\ea78"}),sr.beaker=new sr("beaker",{fontCharacter:"\\ea79"}),sr.microscope=new sr("microscope",{fontCharacter:"\\ea79"}),sr.vm=new sr("vm",{fontCharacter:"\\ea7a"}),sr.deviceDesktop=new sr("device-desktop",{fontCharacter:"\\ea7a"}),sr.file=new sr("file",{fontCharacter:"\\ea7b"}),sr.fileText=new sr("file-text",{fontCharacter:"\\ea7b"}),sr.more=new sr("more",{fontCharacter:"\\ea7c"}),sr.ellipsis=new sr("ellipsis",{fontCharacter:"\\ea7c"}),sr.kebabHorizontal=new sr("kebab-horizontal",{fontCharacter:"\\ea7c"}),sr.mailReply=new sr("mail-reply",{fontCharacter:"\\ea7d"}),sr.reply=new sr("reply",{fontCharacter:"\\ea7d"}),sr.organization=new sr("organization",{fontCharacter:"\\ea7e"}),sr.organizationFilled=new sr("organization-filled",{fontCharacter:"\\ea7e"}),sr.organizationOutline=new sr("organization-outline",{fontCharacter:"\\ea7e"}),sr.newFile=new sr("new-file",{fontCharacter:"\\ea7f"}),sr.fileAdd=new sr("file-add",{fontCharacter:"\\ea7f"}),sr.newFolder=new sr("new-folder",{fontCharacter:"\\ea80"}),sr.fileDirectoryCreate=new sr("file-directory-create",{fontCharacter:"\\ea80"}),sr.trash=new sr("trash",{fontCharacter:"\\ea81"}),sr.trashcan=new sr("trashcan",{fontCharacter:"\\ea81"}),sr.history=new sr("history",{fontCharacter:"\\ea82"}),sr.clock=new sr("clock",{fontCharacter:"\\ea82"}),sr.folder=new sr("folder",{fontCharacter:"\\ea83"}),sr.fileDirectory=new sr("file-directory",{fontCharacter:"\\ea83"}),sr.symbolFolder=new sr("symbol-folder",{fontCharacter:"\\ea83"}),sr.logoGithub=new sr("logo-github",{fontCharacter:"\\ea84"}),sr.markGithub=new sr("mark-github",{fontCharacter:"\\ea84"}),sr.github=new sr("github",{fontCharacter:"\\ea84"}),sr.terminal=new sr("terminal",{fontCharacter:"\\ea85"}),sr.console=new sr("console",{fontCharacter:"\\ea85"}),sr.repl=new sr("repl",{fontCharacter:"\\ea85"}),sr.zap=new sr("zap",{fontCharacter:"\\ea86"}),sr.symbolEvent=new sr("symbol-event",{fontCharacter:"\\ea86"}),sr.error=new sr("error",{fontCharacter:"\\ea87"}),sr.stop=new sr("stop",{fontCharacter:"\\ea87"}),sr.variable=new sr("variable",{fontCharacter:"\\ea88"}),sr.symbolVariable=new sr("symbol-variable",{fontCharacter:"\\ea88"}),sr.array=new sr("array",{fontCharacter:"\\ea8a"}),sr.symbolArray=new sr("symbol-array",{fontCharacter:"\\ea8a"}),sr.symbolModule=new sr("symbol-module",{fontCharacter:"\\ea8b"}),sr.symbolPackage=new sr("symbol-package",{fontCharacter:"\\ea8b"}),sr.symbolNamespace=new sr("symbol-namespace",{fontCharacter:"\\ea8b"}),sr.symbolObject=new sr("symbol-object",{fontCharacter:"\\ea8b"}),sr.symbolMethod=new sr("symbol-method",{fontCharacter:"\\ea8c"}),sr.symbolFunction=new sr("symbol-function",{fontCharacter:"\\ea8c"}),sr.symbolConstructor=new sr("symbol-constructor",{fontCharacter:"\\ea8c"}),sr.symbolBoolean=new sr("symbol-boolean",{fontCharacter:"\\ea8f"}),sr.symbolNull=new sr("symbol-null",{fontCharacter:"\\ea8f"}),sr.symbolNumeric=new sr("symbol-numeric",{fontCharacter:"\\ea90"}),sr.symbolNumber=new sr("symbol-number",{fontCharacter:"\\ea90"}),sr.symbolStructure=new sr("symbol-structure",{fontCharacter:"\\ea91"}),sr.symbolStruct=new sr("symbol-struct",{fontCharacter:"\\ea91"}),sr.symbolParameter=new sr("symbol-parameter",{fontCharacter:"\\ea92"}),sr.symbolTypeParameter=new sr("symbol-type-parameter",{fontCharacter:"\\ea92"}),sr.symbolKey=new sr("symbol-key",{fontCharacter:"\\ea93"}),sr.symbolText=new sr("symbol-text",{fontCharacter:"\\ea93"}),sr.symbolReference=new sr("symbol-reference",{fontCharacter:"\\ea94"}),sr.goToFile=new sr("go-to-file",{fontCharacter:"\\ea94"}),sr.symbolEnum=new sr("symbol-enum",{fontCharacter:"\\ea95"}),sr.symbolValue=new sr("symbol-value",{fontCharacter:"\\ea95"}),sr.symbolRuler=new sr("symbol-ruler",{fontCharacter:"\\ea96"}),sr.symbolUnit=new sr("symbol-unit",{fontCharacter:"\\ea96"}),sr.activateBreakpoints=new sr("activate-breakpoints",{fontCharacter:"\\ea97"}),sr.archive=new sr("archive",{fontCharacter:"\\ea98"}),sr.arrowBoth=new sr("arrow-both",{fontCharacter:"\\ea99"}),sr.arrowDown=new sr("arrow-down",{fontCharacter:"\\ea9a"}),sr.arrowLeft=new sr("arrow-left",{fontCharacter:"\\ea9b"}),sr.arrowRight=new sr("arrow-right",{fontCharacter:"\\ea9c"}),sr.arrowSmallDown=new sr("arrow-small-down",{fontCharacter:"\\ea9d"}),sr.arrowSmallLeft=new sr("arrow-small-left",{fontCharacter:"\\ea9e"}),sr.arrowSmallRight=new sr("arrow-small-right",{fontCharacter:"\\ea9f"}),sr.arrowSmallUp=new sr("arrow-small-up",{fontCharacter:"\\eaa0"}),sr.arrowUp=new sr("arrow-up",{fontCharacter:"\\eaa1"}),sr.bell=new sr("bell",{fontCharacter:"\\eaa2"}),sr.bold=new sr("bold",{fontCharacter:"\\eaa3"}),sr.book=new sr("book",{fontCharacter:"\\eaa4"}),sr.bookmark=new sr("bookmark",{fontCharacter:"\\eaa5"}),sr.debugBreakpointConditionalUnverified=new sr("debug-breakpoint-conditional-unverified",{fontCharacter:"\\eaa6"}),sr.debugBreakpointConditional=new sr("debug-breakpoint-conditional",{fontCharacter:"\\eaa7"}),sr.debugBreakpointConditionalDisabled=new sr("debug-breakpoint-conditional-disabled",{fontCharacter:"\\eaa7"}),sr.debugBreakpointDataUnverified=new sr("debug-breakpoint-data-unverified",{fontCharacter:"\\eaa8"}),sr.debugBreakpointData=new sr("debug-breakpoint-data",{fontCharacter:"\\eaa9"}),sr.debugBreakpointDataDisabled=new sr("debug-breakpoint-data-disabled",{fontCharacter:"\\eaa9"}),sr.debugBreakpointLogUnverified=new sr("debug-breakpoint-log-unverified",{fontCharacter:"\\eaaa"}),sr.debugBreakpointLog=new sr("debug-breakpoint-log",{fontCharacter:"\\eaab"}),sr.debugBreakpointLogDisabled=new sr("debug-breakpoint-log-disabled",{fontCharacter:"\\eaab"}),sr.briefcase=new sr("briefcase",{fontCharacter:"\\eaac"}),sr.broadcast=new sr("broadcast",{fontCharacter:"\\eaad"}),sr.browser=new sr("browser",{fontCharacter:"\\eaae"}),sr.bug=new sr("bug",{fontCharacter:"\\eaaf"}),sr.calendar=new sr("calendar",{fontCharacter:"\\eab0"}),sr.caseSensitive=new sr("case-sensitive",{fontCharacter:"\\eab1"}),sr.check=new sr("check",{fontCharacter:"\\eab2"}),sr.checklist=new sr("checklist",{fontCharacter:"\\eab3"}),sr.chevronDown=new sr("chevron-down",{fontCharacter:"\\eab4"}),sr.chevronLeft=new sr("chevron-left",{fontCharacter:"\\eab5"}),sr.chevronRight=new sr("chevron-right",{fontCharacter:"\\eab6"}),sr.chevronUp=new sr("chevron-up",{fontCharacter:"\\eab7"}),sr.chromeClose=new sr("chrome-close",{fontCharacter:"\\eab8"}),sr.chromeMaximize=new sr("chrome-maximize",{fontCharacter:"\\eab9"}),sr.chromeMinimize=new sr("chrome-minimize",{fontCharacter:"\\eaba"}),sr.chromeRestore=new sr("chrome-restore",{fontCharacter:"\\eabb"}),sr.circleOutline=new sr("circle-outline",{fontCharacter:"\\eabc"}),sr.debugBreakpointUnverified=new sr("debug-breakpoint-unverified",{fontCharacter:"\\eabc"}),sr.circleSlash=new sr("circle-slash",{fontCharacter:"\\eabd"}),sr.circuitBoard=new sr("circuit-board",{fontCharacter:"\\eabe"}),sr.clearAll=new sr("clear-all",{fontCharacter:"\\eabf"}),sr.clippy=new sr("clippy",{fontCharacter:"\\eac0"}),sr.closeAll=new sr("close-all",{fontCharacter:"\\eac1"}),sr.cloudDownload=new sr("cloud-download",{fontCharacter:"\\eac2"}),sr.cloudUpload=new sr("cloud-upload",{fontCharacter:"\\eac3"}),sr.code=new sr("code",{fontCharacter:"\\eac4"}),sr.collapseAll=new sr("collapse-all",{fontCharacter:"\\eac5"}),sr.colorMode=new sr("color-mode",{fontCharacter:"\\eac6"}),sr.commentDiscussion=new sr("comment-discussion",{fontCharacter:"\\eac7"}),sr.compareChanges=new sr("compare-changes",{fontCharacter:"\\eafd"}),sr.creditCard=new sr("credit-card",{fontCharacter:"\\eac9"}),sr.dash=new sr("dash",{fontCharacter:"\\eacc"}),sr.dashboard=new sr("dashboard",{fontCharacter:"\\eacd"}),sr.database=new sr("database",{fontCharacter:"\\eace"}),sr.debugContinue=new sr("debug-continue",{fontCharacter:"\\eacf"}),sr.debugDisconnect=new sr("debug-disconnect",{fontCharacter:"\\ead0"}),sr.debugPause=new sr("debug-pause",{fontCharacter:"\\ead1"}),sr.debugRestart=new sr("debug-restart",{fontCharacter:"\\ead2"}),sr.debugStart=new sr("debug-start",{fontCharacter:"\\ead3"}),sr.debugStepInto=new sr("debug-step-into",{fontCharacter:"\\ead4"}),sr.debugStepOut=new sr("debug-step-out",{fontCharacter:"\\ead5"}),sr.debugStepOver=new sr("debug-step-over",{fontCharacter:"\\ead6"}),sr.debugStop=new sr("debug-stop",{fontCharacter:"\\ead7"}),sr.debug=new sr("debug",{fontCharacter:"\\ead8"}),sr.deviceCameraVideo=new sr("device-camera-video",{fontCharacter:"\\ead9"}),sr.deviceCamera=new sr("device-camera",{fontCharacter:"\\eada"}),sr.deviceMobile=new sr("device-mobile",{fontCharacter:"\\eadb"}),sr.diffAdded=new sr("diff-added",{fontCharacter:"\\eadc"}),sr.diffIgnored=new sr("diff-ignored",{fontCharacter:"\\eadd"}),sr.diffModified=new sr("diff-modified",{fontCharacter:"\\eade"}),sr.diffRemoved=new sr("diff-removed",{fontCharacter:"\\eadf"}),sr.diffRenamed=new sr("diff-renamed",{fontCharacter:"\\eae0"}),sr.diff=new sr("diff",{fontCharacter:"\\eae1"}),sr.discard=new sr("discard",{fontCharacter:"\\eae2"}),sr.editorLayout=new sr("editor-layout",{fontCharacter:"\\eae3"}),sr.emptyWindow=new sr("empty-window",{fontCharacter:"\\eae4"}),sr.exclude=new sr("exclude",{fontCharacter:"\\eae5"}),sr.extensions=new sr("extensions",{fontCharacter:"\\eae6"}),sr.eyeClosed=new sr("eye-closed",{fontCharacter:"\\eae7"}),sr.fileBinary=new sr("file-binary",{fontCharacter:"\\eae8"}),sr.fileCode=new sr("file-code",{fontCharacter:"\\eae9"}),sr.fileMedia=new sr("file-media",{fontCharacter:"\\eaea"}),sr.filePdf=new sr("file-pdf",{fontCharacter:"\\eaeb"}),sr.fileSubmodule=new sr("file-submodule",{fontCharacter:"\\eaec"}),sr.fileSymlinkDirectory=new sr("file-symlink-directory",{fontCharacter:"\\eaed"}),sr.fileSymlinkFile=new sr("file-symlink-file",{fontCharacter:"\\eaee"}),sr.fileZip=new sr("file-zip",{fontCharacter:"\\eaef"}),sr.files=new sr("files",{fontCharacter:"\\eaf0"}),sr.filter=new sr("filter",{fontCharacter:"\\eaf1"}),sr.flame=new sr("flame",{fontCharacter:"\\eaf2"}),sr.foldDown=new sr("fold-down",{fontCharacter:"\\eaf3"}),sr.foldUp=new sr("fold-up",{fontCharacter:"\\eaf4"}),sr.fold=new sr("fold",{fontCharacter:"\\eaf5"}),sr.folderActive=new sr("folder-active",{fontCharacter:"\\eaf6"}),sr.folderOpened=new sr("folder-opened",{fontCharacter:"\\eaf7"}),sr.gear=new sr("gear",{fontCharacter:"\\eaf8"}),sr.gift=new sr("gift",{fontCharacter:"\\eaf9"}),sr.gistSecret=new sr("gist-secret",{fontCharacter:"\\eafa"}),sr.gist=new sr("gist",{fontCharacter:"\\eafb"}),sr.gitCommit=new sr("git-commit",{fontCharacter:"\\eafc"}),sr.gitCompare=new sr("git-compare",{fontCharacter:"\\eafd"}),sr.gitMerge=new sr("git-merge",{fontCharacter:"\\eafe"}),sr.githubAction=new sr("github-action",{fontCharacter:"\\eaff"}),sr.githubAlt=new sr("github-alt",{fontCharacter:"\\eb00"}),sr.globe=new sr("globe",{fontCharacter:"\\eb01"}),sr.grabber=new sr("grabber",{fontCharacter:"\\eb02"}),sr.graph=new sr("graph",{fontCharacter:"\\eb03"}),sr.gripper=new sr("gripper",{fontCharacter:"\\eb04"}),sr.heart=new sr("heart",{fontCharacter:"\\eb05"}),sr.home=new sr("home",{fontCharacter:"\\eb06"}),sr.horizontalRule=new sr("horizontal-rule",{fontCharacter:"\\eb07"}),sr.hubot=new sr("hubot",{fontCharacter:"\\eb08"}),sr.inbox=new sr("inbox",{fontCharacter:"\\eb09"}),sr.issueClosed=new sr("issue-closed",{fontCharacter:"\\eba4"}),sr.issueReopened=new sr("issue-reopened",{fontCharacter:"\\eb0b"}),sr.issues=new sr("issues",{fontCharacter:"\\eb0c"}),sr.italic=new sr("italic",{fontCharacter:"\\eb0d"}),sr.jersey=new sr("jersey",{fontCharacter:"\\eb0e"}),sr.json=new sr("json",{fontCharacter:"\\eb0f"}),sr.kebabVertical=new sr("kebab-vertical",{fontCharacter:"\\eb10"}),sr.key=new sr("key",{fontCharacter:"\\eb11"}),sr.law=new sr("law",{fontCharacter:"\\eb12"}),sr.lightbulbAutofix=new sr("lightbulb-autofix",{fontCharacter:"\\eb13"}),sr.linkExternal=new sr("link-external",{fontCharacter:"\\eb14"}),sr.link=new sr("link",{fontCharacter:"\\eb15"}),sr.listOrdered=new sr("list-ordered",{fontCharacter:"\\eb16"}),sr.listUnordered=new sr("list-unordered",{fontCharacter:"\\eb17"}),sr.liveShare=new sr("live-share",{fontCharacter:"\\eb18"}),sr.loading=new sr("loading",{fontCharacter:"\\eb19"}),sr.location=new sr("location",{fontCharacter:"\\eb1a"}),sr.mailRead=new sr("mail-read",{fontCharacter:"\\eb1b"}),sr.mail=new sr("mail",{fontCharacter:"\\eb1c"}),sr.markdown=new sr("markdown",{fontCharacter:"\\eb1d"}),sr.megaphone=new sr("megaphone",{fontCharacter:"\\eb1e"}),sr.mention=new sr("mention",{fontCharacter:"\\eb1f"}),sr.milestone=new sr("milestone",{fontCharacter:"\\eb20"}),sr.mortarBoard=new sr("mortar-board",{fontCharacter:"\\eb21"}),sr.move=new sr("move",{fontCharacter:"\\eb22"}),sr.multipleWindows=new sr("multiple-windows",{fontCharacter:"\\eb23"}),sr.mute=new sr("mute",{fontCharacter:"\\eb24"}),sr.noNewline=new sr("no-newline",{fontCharacter:"\\eb25"}),sr.note=new sr("note",{fontCharacter:"\\eb26"}),sr.octoface=new sr("octoface",{fontCharacter:"\\eb27"}),sr.openPreview=new sr("open-preview",{fontCharacter:"\\eb28"}),sr.package_=new sr("package",{fontCharacter:"\\eb29"}),sr.paintcan=new sr("paintcan",{fontCharacter:"\\eb2a"}),sr.pin=new sr("pin",{fontCharacter:"\\eb2b"}),sr.play=new sr("play",{fontCharacter:"\\eb2c"}),sr.run=new sr("run",{fontCharacter:"\\eb2c"}),sr.plug=new sr("plug",{fontCharacter:"\\eb2d"}),sr.preserveCase=new sr("preserve-case",{fontCharacter:"\\eb2e"}),sr.preview=new sr("preview",{fontCharacter:"\\eb2f"}),sr.project=new sr("project",{fontCharacter:"\\eb30"}),sr.pulse=new sr("pulse",{fontCharacter:"\\eb31"}),sr.question=new sr("question",{fontCharacter:"\\eb32"}),sr.quote=new sr("quote",{fontCharacter:"\\eb33"}),sr.radioTower=new sr("radio-tower",{fontCharacter:"\\eb34"}),sr.reactions=new sr("reactions",{fontCharacter:"\\eb35"}),sr.references=new sr("references",{fontCharacter:"\\eb36"}),sr.refresh=new sr("refresh",{fontCharacter:"\\eb37"}),sr.regex=new sr("regex",{fontCharacter:"\\eb38"}),sr.remoteExplorer=new sr("remote-explorer",{fontCharacter:"\\eb39"}),sr.remote=new sr("remote",{fontCharacter:"\\eb3a"}),sr.remove=new sr("remove",{fontCharacter:"\\eb3b"}),sr.replaceAll=new sr("replace-all",{fontCharacter:"\\eb3c"}),sr.replace=new sr("replace",{fontCharacter:"\\eb3d"}),sr.repoClone=new sr("repo-clone",{fontCharacter:"\\eb3e"}),sr.repoForcePush=new sr("repo-force-push",{fontCharacter:"\\eb3f"}),sr.repoPull=new sr("repo-pull",{fontCharacter:"\\eb40"}),sr.repoPush=new sr("repo-push",{fontCharacter:"\\eb41"}),sr.report=new sr("report",{fontCharacter:"\\eb42"}),sr.requestChanges=new sr("request-changes",{fontCharacter:"\\eb43"}),sr.rocket=new sr("rocket",{fontCharacter:"\\eb44"}),sr.rootFolderOpened=new sr("root-folder-opened",{fontCharacter:"\\eb45"}),sr.rootFolder=new sr("root-folder",{fontCharacter:"\\eb46"}),sr.rss=new sr("rss",{fontCharacter:"\\eb47"}),sr.ruby=new sr("ruby",{fontCharacter:"\\eb48"}),sr.saveAll=new sr("save-all",{fontCharacter:"\\eb49"}),sr.saveAs=new sr("save-as",{fontCharacter:"\\eb4a"}),sr.save=new sr("save",{fontCharacter:"\\eb4b"}),sr.screenFull=new sr("screen-full",{fontCharacter:"\\eb4c"}),sr.screenNormal=new sr("screen-normal",{fontCharacter:"\\eb4d"}),sr.searchStop=new sr("search-stop",{fontCharacter:"\\eb4e"}),sr.server=new sr("server",{fontCharacter:"\\eb50"}),sr.settingsGear=new sr("settings-gear",{fontCharacter:"\\eb51"}),sr.settings=new sr("settings",{fontCharacter:"\\eb52"}),sr.shield=new sr("shield",{fontCharacter:"\\eb53"}),sr.smiley=new sr("smiley",{fontCharacter:"\\eb54"}),sr.sortPrecedence=new sr("sort-precedence",{fontCharacter:"\\eb55"}),sr.splitHorizontal=new sr("split-horizontal",{fontCharacter:"\\eb56"}),sr.splitVertical=new sr("split-vertical",{fontCharacter:"\\eb57"}),sr.squirrel=new sr("squirrel",{fontCharacter:"\\eb58"}),sr.starFull=new sr("star-full",{fontCharacter:"\\eb59"}),sr.starHalf=new sr("star-half",{fontCharacter:"\\eb5a"}),sr.symbolClass=new sr("symbol-class",{fontCharacter:"\\eb5b"}),sr.symbolColor=new sr("symbol-color",{fontCharacter:"\\eb5c"}),sr.symbolConstant=new sr("symbol-constant",{fontCharacter:"\\eb5d"}),sr.symbolEnumMember=new sr("symbol-enum-member",{fontCharacter:"\\eb5e"}),sr.symbolField=new sr("symbol-field",{fontCharacter:"\\eb5f"}),sr.symbolFile=new sr("symbol-file",{fontCharacter:"\\eb60"}),sr.symbolInterface=new sr("symbol-interface",{fontCharacter:"\\eb61"}),sr.symbolKeyword=new sr("symbol-keyword",{fontCharacter:"\\eb62"}),sr.symbolMisc=new sr("symbol-misc",{fontCharacter:"\\eb63"}),sr.symbolOperator=new sr("symbol-operator",{fontCharacter:"\\eb64"}),sr.symbolProperty=new sr("symbol-property",{fontCharacter:"\\eb65"}),sr.wrench=new sr("wrench",{fontCharacter:"\\eb65"}),sr.wrenchSubaction=new sr("wrench-subaction",{fontCharacter:"\\eb65"}),sr.symbolSnippet=new sr("symbol-snippet",{fontCharacter:"\\eb66"}),sr.tasklist=new sr("tasklist",{fontCharacter:"\\eb67"}),sr.telescope=new sr("telescope",{fontCharacter:"\\eb68"}),sr.textSize=new sr("text-size",{fontCharacter:"\\eb69"}),sr.threeBars=new sr("three-bars",{fontCharacter:"\\eb6a"}),sr.thumbsdown=new sr("thumbsdown",{fontCharacter:"\\eb6b"}),sr.thumbsup=new sr("thumbsup",{fontCharacter:"\\eb6c"}),sr.tools=new sr("tools",{fontCharacter:"\\eb6d"}),sr.triangleDown=new sr("triangle-down",{fontCharacter:"\\eb6e"}),sr.triangleLeft=new sr("triangle-left",{fontCharacter:"\\eb6f"}),sr.triangleRight=new sr("triangle-right",{fontCharacter:"\\eb70"}),sr.triangleUp=new sr("triangle-up",{fontCharacter:"\\eb71"}),sr.twitter=new sr("twitter",{fontCharacter:"\\eb72"}),sr.unfold=new sr("unfold",{fontCharacter:"\\eb73"}),sr.unlock=new sr("unlock",{fontCharacter:"\\eb74"}),sr.unmute=new sr("unmute",{fontCharacter:"\\eb75"}),sr.unverified=new sr("unverified",{fontCharacter:"\\eb76"}),sr.verified=new sr("verified",{fontCharacter:"\\eb77"}),sr.versions=new sr("versions",{fontCharacter:"\\eb78"}),sr.vmActive=new sr("vm-active",{fontCharacter:"\\eb79"}),sr.vmOutline=new sr("vm-outline",{fontCharacter:"\\eb7a"}),sr.vmRunning=new sr("vm-running",{fontCharacter:"\\eb7b"}),sr.watch=new sr("watch",{fontCharacter:"\\eb7c"}),sr.whitespace=new sr("whitespace",{fontCharacter:"\\eb7d"}),sr.wholeWord=new sr("whole-word",{fontCharacter:"\\eb7e"}),sr.window=new sr("window",{fontCharacter:"\\eb7f"}),sr.wordWrap=new sr("word-wrap",{fontCharacter:"\\eb80"}),sr.zoomIn=new sr("zoom-in",{fontCharacter:"\\eb81"}),sr.zoomOut=new sr("zoom-out",{fontCharacter:"\\eb82"}),sr.listFilter=new sr("list-filter",{fontCharacter:"\\eb83"}),sr.listFlat=new sr("list-flat",{fontCharacter:"\\eb84"}),sr.listSelection=new sr("list-selection",{fontCharacter:"\\eb85"}),sr.selection=new sr("selection",{fontCharacter:"\\eb85"}),sr.listTree=new sr("list-tree",{fontCharacter:"\\eb86"}),sr.debugBreakpointFunctionUnverified=new sr("debug-breakpoint-function-unverified",{fontCharacter:"\\eb87"}),sr.debugBreakpointFunction=new sr("debug-breakpoint-function",{fontCharacter:"\\eb88"}),sr.debugBreakpointFunctionDisabled=new sr("debug-breakpoint-function-disabled",{fontCharacter:"\\eb88"}),sr.debugStackframeActive=new sr("debug-stackframe-active",{fontCharacter:"\\eb89"}),sr.debugStackframeDot=new sr("debug-stackframe-dot",{fontCharacter:"\\eb8a"}),sr.debugStackframe=new sr("debug-stackframe",{fontCharacter:"\\eb8b"}),sr.debugStackframeFocused=new sr("debug-stackframe-focused",{fontCharacter:"\\eb8b"}),sr.debugBreakpointUnsupported=new sr("debug-breakpoint-unsupported",{fontCharacter:"\\eb8c"}),sr.symbolString=new sr("symbol-string",{fontCharacter:"\\eb8d"}),sr.debugReverseContinue=new sr("debug-reverse-continue",{fontCharacter:"\\eb8e"}),sr.debugStepBack=new sr("debug-step-back",{fontCharacter:"\\eb8f"}),sr.debugRestartFrame=new sr("debug-restart-frame",{fontCharacter:"\\eb90"}),sr.callIncoming=new sr("call-incoming",{fontCharacter:"\\eb92"}),sr.callOutgoing=new sr("call-outgoing",{fontCharacter:"\\eb93"}),sr.menu=new sr("menu",{fontCharacter:"\\eb94"}),sr.expandAll=new sr("expand-all",{fontCharacter:"\\eb95"}),sr.feedback=new sr("feedback",{fontCharacter:"\\eb96"}),sr.groupByRefType=new sr("group-by-ref-type",{fontCharacter:"\\eb97"}),sr.ungroupByRefType=new sr("ungroup-by-ref-type",{fontCharacter:"\\eb98"}),sr.account=new sr("account",{fontCharacter:"\\eb99"}),sr.bellDot=new sr("bell-dot",{fontCharacter:"\\eb9a"}),sr.debugConsole=new sr("debug-console",{fontCharacter:"\\eb9b"}),sr.library=new sr("library",{fontCharacter:"\\eb9c"}),sr.output=new sr("output",{fontCharacter:"\\eb9d"}),sr.runAll=new sr("run-all",{fontCharacter:"\\eb9e"}),sr.syncIgnored=new sr("sync-ignored",{fontCharacter:"\\eb9f"}),sr.pinned=new sr("pinned",{fontCharacter:"\\eba0"}),sr.githubInverted=new sr("github-inverted",{fontCharacter:"\\eba1"}),sr.debugAlt=new sr("debug-alt",{fontCharacter:"\\eb91"}),sr.serverProcess=new sr("server-process",{fontCharacter:"\\eba2"}),sr.serverEnvironment=new sr("server-environment",{fontCharacter:"\\eba3"}),sr.pass=new sr("pass",{fontCharacter:"\\eba4"}),sr.stopCircle=new sr("stop-circle",{fontCharacter:"\\eba5"}),sr.playCircle=new sr("play-circle",{fontCharacter:"\\eba6"}),sr.record=new sr("record",{fontCharacter:"\\eba7"}),sr.debugAltSmall=new sr("debug-alt-small",{fontCharacter:"\\eba8"}),sr.vmConnect=new sr("vm-connect",{fontCharacter:"\\eba9"}),sr.cloud=new sr("cloud",{fontCharacter:"\\ebaa"}),sr.merge=new sr("merge",{fontCharacter:"\\ebab"}),sr.exportIcon=new sr("export",{fontCharacter:"\\ebac"}),sr.graphLeft=new sr("graph-left",{fontCharacter:"\\ebad"}),sr.magnet=new sr("magnet",{fontCharacter:"\\ebae"}),sr.notebook=new sr("notebook",{fontCharacter:"\\ebaf"}),sr.redo=new sr("redo",{fontCharacter:"\\ebb0"}),sr.checkAll=new sr("check-all",{fontCharacter:"\\ebb1"}),sr.pinnedDirty=new sr("pinned-dirty",{fontCharacter:"\\ebb2"}),sr.passFilled=new sr("pass-filled",{fontCharacter:"\\ebb3"}),sr.circleLargeFilled=new sr("circle-large-filled",{fontCharacter:"\\ebb4"}),sr.circleLargeOutline=new sr("circle-large-outline",{fontCharacter:"\\ebb5"}),sr.combine=new sr("combine",{fontCharacter:"\\ebb6"}),sr.gather=new sr("gather",{fontCharacter:"\\ebb6"}),sr.table=new sr("table",{fontCharacter:"\\ebb7"}),sr.variableGroup=new sr("variable-group",{fontCharacter:"\\ebb8"}),sr.typeHierarchy=new sr("type-hierarchy",{fontCharacter:"\\ebb9"}),sr.typeHierarchySub=new sr("type-hierarchy-sub",{fontCharacter:"\\ebba"}),sr.typeHierarchySuper=new sr("type-hierarchy-super",{fontCharacter:"\\ebbb"}),sr.gitPullRequestCreate=new sr("git-pull-request-create",{fontCharacter:"\\ebbc"}),sr.runAbove=new sr("run-above",{fontCharacter:"\\ebbd"}),sr.runBelow=new sr("run-below",{fontCharacter:"\\ebbe"}),sr.notebookTemplate=new sr("notebook-template",{fontCharacter:"\\ebbf"}),sr.debugRerun=new sr("debug-rerun",{fontCharacter:"\\ebc0"}),sr.workspaceTrusted=new sr("workspace-trusted",{fontCharacter:"\\ebc1"}),sr.workspaceUntrusted=new sr("workspace-untrusted",{fontCharacter:"\\ebc2"}),sr.workspaceUnspecified=new sr("workspace-unspecified",{fontCharacter:"\\ebc3"}),sr.terminalCmd=new sr("terminal-cmd",{fontCharacter:"\\ebc4"}),sr.terminalDebian=new sr("terminal-debian",{fontCharacter:"\\ebc5"}),sr.terminalLinux=new sr("terminal-linux",{fontCharacter:"\\ebc6"}),sr.terminalPowershell=new sr("terminal-powershell",{fontCharacter:"\\ebc7"}),sr.terminalTmux=new sr("terminal-tmux",{fontCharacter:"\\ebc8"}),sr.terminalUbuntu=new sr("terminal-ubuntu",{fontCharacter:"\\ebc9"}),sr.terminalBash=new sr("terminal-bash",{fontCharacter:"\\ebca"}),sr.arrowSwap=new sr("arrow-swap",{fontCharacter:"\\ebcb"}),sr.copy=new sr("copy",{fontCharacter:"\\ebcc"}),sr.personAdd=new sr("person-add",{fontCharacter:"\\ebcd"}),sr.filterFilled=new sr("filter-filled",{fontCharacter:"\\ebce"}),sr.wand=new sr("wand",{fontCharacter:"\\ebcf"}),sr.debugLineByLine=new sr("debug-line-by-line",{fontCharacter:"\\ebd0"}),sr.inspect=new sr("inspect",{fontCharacter:"\\ebd1"}),sr.layers=new sr("layers",{fontCharacter:"\\ebd2"}),sr.layersDot=new sr("layers-dot",{fontCharacter:"\\ebd3"}),sr.layersActive=new sr("layers-active",{fontCharacter:"\\ebd4"}),sr.compass=new sr("compass",{fontCharacter:"\\ebd5"}),sr.compassDot=new sr("compass-dot",{fontCharacter:"\\ebd6"}),sr.compassActive=new sr("compass-active",{fontCharacter:"\\ebd7"}),sr.azure=new sr("azure",{fontCharacter:"\\ebd8"}),sr.issueDraft=new sr("issue-draft",{fontCharacter:"\\ebd9"}),sr.gitPullRequestClosed=new sr("git-pull-request-closed",{fontCharacter:"\\ebda"}),sr.gitPullRequestDraft=new sr("git-pull-request-draft",{fontCharacter:"\\ebdb"}),sr.debugAll=new sr("debug-all",{fontCharacter:"\\ebdc"}),sr.debugCoverage=new sr("debug-coverage",{fontCharacter:"\\ebdd"}),sr.dropDownButton=new sr("drop-down-button",sr.chevronDown.definition);Object.prototype.hasOwnProperty;var ar,cr;function lr(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}class ur{constructor(e,t,r,i=1){this._rgbaBrand=void 0,this.r=0|Math.min(255,Math.max(0,e)),this.g=0|Math.min(255,Math.max(0,t)),this.b=0|Math.min(255,Math.max(0,r)),this.a=lr(Math.max(Math.min(1,i),0),3)}static equals(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}}class hr{constructor(e,t,r,i){this._hslaBrand=void 0,this.h=0|Math.max(Math.min(360,e),0),this.s=lr(Math.max(Math.min(1,t),0),3),this.l=lr(Math.max(Math.min(1,r),0),3),this.a=lr(Math.max(Math.min(1,i),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.l===t.l&&e.a===t.a}static fromRGBA(e){const t=e.r/255,r=e.g/255,i=e.b/255,n=e.a,o=Math.max(t,r,i),s=Math.min(t,r,i);let a=0,c=0;const l=(s+o)/2,u=o-s;if(u>0){switch(c=Math.min(l<=.5?u/(2*l):u/(2-2*l),1),o){case t:a=(r-i)/u+(r<i?6:0);break;case r:a=(i-t)/u+2;break;case i:a=(t-r)/u+4}a*=60,a=Math.round(a)}return new hr(a,c,l,n)}static _hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}static toRGBA(e){const t=e.h/360,{s:r,l:i,a:n}=e;let o,s,a;if(0===r)o=s=a=i;else{const e=i<.5?i*(1+r):i+r-i*r,n=2*i-e;o=hr._hue2rgb(n,e,t+1/3),s=hr._hue2rgb(n,e,t),a=hr._hue2rgb(n,e,t-1/3)}return new ur(Math.round(255*o),Math.round(255*s),Math.round(255*a),n)}}class dr{constructor(e,t,r,i){this._hsvaBrand=void 0,this.h=0|Math.max(Math.min(360,e),0),this.s=lr(Math.max(Math.min(1,t),0),3),this.v=lr(Math.max(Math.min(1,r),0),3),this.a=lr(Math.max(Math.min(1,i),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.v===t.v&&e.a===t.a}static fromRGBA(e){const t=e.r/255,r=e.g/255,i=e.b/255,n=Math.max(t,r,i),o=n-Math.min(t,r,i),s=0===n?0:o/n;let a;return a=0===o?0:n===t?((r-i)/o%6+6)%6:n===r?(i-t)/o+2:(t-r)/o+4,new dr(Math.round(60*a),s,n,e.a)}static toRGBA(e){const{h:t,s:r,v:i,a:n}=e,o=i*r,s=o*(1-Math.abs(t/60%2-1)),a=i-o;let[c,l,u]=[0,0,0];return t<60?(c=o,l=s):t<120?(c=s,l=o):t<180?(l=o,u=s):t<240?(l=s,u=o):t<300?(c=s,u=o):t<=360&&(c=o,u=s),c=Math.round(255*(c+a)),l=Math.round(255*(l+a)),u=Math.round(255*(u+a)),new ur(c,l,u,n)}}class fr{constructor(e){if(!e)throw new Error("Color needs a value");if(e instanceof ur)this.rgba=e;else if(e instanceof hr)this._hsla=e,this.rgba=hr.toRGBA(e);else{if(!(e instanceof dr))throw new Error("Invalid color ctor argument");this._hsva=e,this.rgba=dr.toRGBA(e)}}static fromHex(e){return fr.Format.CSS.parseHex(e)||fr.red}get hsla(){return this._hsla?this._hsla:hr.fromRGBA(this.rgba)}get hsva(){return this._hsva?this._hsva:dr.fromRGBA(this.rgba)}equals(e){return!!e&&ur.equals(this.rgba,e.rgba)&&hr.equals(this.hsla,e.hsla)&&dr.equals(this.hsva,e.hsva)}getRelativeLuminance(){return lr(.2126*fr._relativeLuminanceForComponent(this.rgba.r)+.7152*fr._relativeLuminanceForComponent(this.rgba.g)+.0722*fr._relativeLuminanceForComponent(this.rgba.b),4)}static _relativeLuminanceForComponent(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}getContrastRatio(e){const t=this.getRelativeLuminance(),r=e.getRelativeLuminance();return t>r?(t+.05)/(r+.05):(r+.05)/(t+.05)}isDarker(){return(299*this.rgba.r+587*this.rgba.g+114*this.rgba.b)/1e3<128}isLighter(){return(299*this.rgba.r+587*this.rgba.g+114*this.rgba.b)/1e3>=128}isLighterThan(e){return this.getRelativeLuminance()>e.getRelativeLuminance()}isDarkerThan(e){return this.getRelativeLuminance()<e.getRelativeLuminance()}lighten(e){return new fr(new hr(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*e,this.hsla.a))}darken(e){return new fr(new hr(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*e,this.hsla.a))}transparent(e){const{r:t,g:r,b:i,a:n}=this.rgba;return new fr(new ur(t,r,i,n*e))}isTransparent(){return 0===this.rgba.a}isOpaque(){return 1===this.rgba.a}opposite(){return new fr(new ur(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(e){const t=e.rgba,r=this.rgba.a,i=t.a,n=r+i*(1-r);if(n<1e-6)return fr.transparent;const o=this.rgba.r*r/n+t.r*i*(1-r)/n,s=this.rgba.g*r/n+t.g*i*(1-r)/n,a=this.rgba.b*r/n+t.b*i*(1-r)/n;return new fr(new ur(o,s,a,n))}makeOpaque(e){if(this.isOpaque()||1!==e.rgba.a)return this;const{r:t,g:r,b:i,a:n}=this.rgba;return new fr(new ur(e.rgba.r-n*(e.rgba.r-t),e.rgba.g-n*(e.rgba.g-r),e.rgba.b-n*(e.rgba.b-i),1))}flatten(...e){const t=e.reduceRight(((e,t)=>fr._flatten(t,e)));return fr._flatten(this,t)}static _flatten(e,t){const r=1-e.rgba.a;return new fr(new ur(r*t.rgba.r+e.rgba.a*e.rgba.r,r*t.rgba.g+e.rgba.a*e.rgba.g,r*t.rgba.b+e.rgba.a*e.rgba.b))}toString(){return""+fr.Format.CSS.format(this)}static getLighterColor(e,t,r){if(e.isLighterThan(t))return e;r=r||.5;const i=e.getRelativeLuminance(),n=t.getRelativeLuminance();return r=r*(n-i)/n,e.lighten(r)}static getDarkerColor(e,t,r){if(e.isDarkerThan(t))return e;r=r||.5;const i=e.getRelativeLuminance();return r=r*(i-t.getRelativeLuminance())/i,e.darken(r)}}fr.white=new fr(new ur(255,255,255,1)),fr.black=new fr(new ur(0,0,0,1)),fr.red=new fr(new ur(255,0,0,1)),fr.blue=new fr(new ur(0,0,255,1)),fr.green=new fr(new ur(0,255,0,1)),fr.cyan=new fr(new ur(0,255,255,1)),fr.lightgrey=new fr(new ur(211,211,211,1)),fr.transparent=new fr(new ur(0,0,0,0)),ar=fr||(fr={}),function(e){function t(e){const t=e.toString(16);return 2!==t.length?"0"+t:t}function r(e){switch(e){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:case 65:return 10;case 98:case 66:return 11;case 99:case 67:return 12;case 100:case 68:return 13;case 101:case 69:return 14;case 102:case 70:return 15}return 0}e.formatRGB=function(e){return 1===e.rgba.a?`rgb(${e.rgba.r}, ${e.rgba.g}, ${e.rgba.b})`:ar.Format.CSS.formatRGBA(e)},e.formatRGBA=function(e){return`rgba(${e.rgba.r}, ${e.rgba.g}, ${e.rgba.b}, ${+e.rgba.a.toFixed(2)})`},e.formatHSL=function(e){return 1===e.hsla.a?`hsl(${e.hsla.h}, ${(100*e.hsla.s).toFixed(2)}%, ${(100*e.hsla.l).toFixed(2)}%)`:ar.Format.CSS.formatHSLA(e)},e.formatHSLA=function(e){return`hsla(${e.hsla.h}, ${(100*e.hsla.s).toFixed(2)}%, ${(100*e.hsla.l).toFixed(2)}%, ${e.hsla.a.toFixed(2)})`},e.formatHex=function(e){return`#${t(e.rgba.r)}${t(e.rgba.g)}${t(e.rgba.b)}`},e.formatHexA=function(e,r=!1){return r&&1===e.rgba.a?ar.Format.CSS.formatHex(e):`#${t(e.rgba.r)}${t(e.rgba.g)}${t(e.rgba.b)}${t(Math.round(255*e.rgba.a))}`},e.format=function(e){return e.isOpaque()?ar.Format.CSS.formatHex(e):ar.Format.CSS.formatRGBA(e)},e.parseHex=function(e){const t=e.length;if(0===t)return null;if(35!==e.charCodeAt(0))return null;if(7===t){const t=16*r(e.charCodeAt(1))+r(e.charCodeAt(2)),i=16*r(e.charCodeAt(3))+r(e.charCodeAt(4)),n=16*r(e.charCodeAt(5))+r(e.charCodeAt(6));return new ar(new ur(t,i,n,1))}if(9===t){const t=16*r(e.charCodeAt(1))+r(e.charCodeAt(2)),i=16*r(e.charCodeAt(3))+r(e.charCodeAt(4)),n=16*r(e.charCodeAt(5))+r(e.charCodeAt(6)),o=16*r(e.charCodeAt(7))+r(e.charCodeAt(8));return new ar(new ur(t,i,n,o/255))}if(4===t){const t=r(e.charCodeAt(1)),i=r(e.charCodeAt(2)),n=r(e.charCodeAt(3));return new ar(new ur(16*t+t,16*i+i,16*n+n))}if(5===t){const t=r(e.charCodeAt(1)),i=r(e.charCodeAt(2)),n=r(e.charCodeAt(3)),o=r(e.charCodeAt(4));return new ar(new ur(16*t+t,16*i+i,16*n+n,(16*o+o)/255))}return null}}((cr=ar.Format||(ar.Format={})).CSS||(cr.CSS={}));new Xt((()=>{const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return{collator:e,collatorIsNumeric:e.resolvedOptions().numeric}})),new Xt((()=>({collator:new Intl.Collator(void 0,{numeric:!0})}))),new Xt((()=>({collator:new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"})})));function pr(e,t,r){let i=null,n=null;if("function"==typeof r.value?(i="value",n=r.value,0!==n.length&&console.warn("Memoize should only be used in functions with zero parameters")):"function"==typeof r.get&&(i="get",n=r.get),!n)throw new Error("not supported");const o=`$memoize$${t}`;r[i]=function(...e){return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:n.apply(this,e)}),this[o]}}let mr;var gr,vr,yr,br,wr,_r;(br=yr||(yr={}))[br.Scheme=1]="Scheme",br[br.Authority=2]="Authority",br[br.Path=3]="Path",br[br.Query=4]="Query",br[br.Fragment=5]="Fragment";class Sr{constructor(e){this._iter=e}static forUris(e=(()=>!1)){return new Sr(new $bf4b3cef373f087d$var$UriIterator(e))}static forPaths(){return new Sr(new $bf4b3cef373f087d$var$PathIterator)}static forStrings(){return new Sr(new $bf4b3cef373f087d$var$StringIterator)}static forConfigKeys(){return new Sr(new $bf4b3cef373f087d$var$ConfigKeysIterator)}clear(){this._root=void 0}set(e,t){const r=this._iter.reset(e);let i;for(this._root||(this._root=new $bf4b3cef373f087d$var$TernarySearchTreeNode,this._root.segment=r.value()),this._root;;){const e=r.cmp(i.segment);if(e>0)i.left||(i.left=new $bf4b3cef373f087d$var$TernarySearchTreeNode,i.left.segment=r.value()),i.left;else if(e<0)i.right||(i.right=new $bf4b3cef373f087d$var$TernarySearchTreeNode,i.right.segment=r.value()),i.right;else{if(!r.hasNext())break;r.next(),i.mid||(i.mid=new $bf4b3cef373f087d$var$TernarySearchTreeNode,i.mid.segment=r.value()),i.mid}}const n=i.value;return i.value=t,i.key=e,n}get(e){var t;return null==this._getNode(e)?void 0:t.value}_getNode(e){const t=this._iter.reset(e);let r=this._root;for(;r;){const e=t.cmp(r.segment);if(e>0)r.left;else if(e<0)r.right;else{if(!t.hasNext())break;t.next(),r.mid}}return r}has(e){const t=this._getNode(e);return!(void 0===(null==t?void 0:t.value)&&void 0===(null==t?void 0:t.mid))}delete(e){return this._delete(e,!1)}deleteSuperstr(e){return this._delete(e,!0)}_delete(e,t){const r=this._iter.reset(e),i=[];let n=this._root;for(;n;){const e=r.cmp(n.segment);if(e>0)i.push([1,n]),n.left;else if(e<0)i.push([-1,n]),n.right;else{if(!r.hasNext()){for(t?(n.left=void 0,n.mid=void 0,n.right=void 0):n.value=void 0;i.length>0&&n.isEmpty();){let[e,t]=i.pop();switch(e){case 1:t.left=void 0;break;case 0:t.mid=void 0;break;case-1:t.right=void 0}t}break}r.next(),i.push([0,n]),n.mid}}}findSubstr(e){const t=this._iter.reset(e);let r,i=this._root;for(;i;){const e=t.cmp(i.segment);if(e>0)i.left;else if(e<0)i.right;else{if(!t.hasNext())break;t.next(),i.value||r,i.mid}}return i&&i.value||r}findSuperstr(e){const t=this._iter.reset(e);let r=this._root;for(;r;){const e=t.cmp(r.segment);if(e>0)r.left;else if(e<0)r.right;else{if(!t.hasNext())return r.mid?this._entries(r.mid):void 0;t.next(),r.mid}}}forEach(e){for(const[t,r]of this)e(r,t)}*[Symbol.iterator](){yield*this._entries(this._root)}*_entries(e){if(!e)return;const t=[e];for(;t.length>0;){const e=t.pop();e&&(e.value&&(yield[e.key,e.value]),e.left&&t.push(e.left),e.mid&&t.push(e.mid),e.right&&t.push(e.right))}}}class Er{constructor(e,t){this[gr]="ResourceMap",e instanceof Er?(this.map=new Map(e.map),this.toKey=null!=t?t:Er.defaultToKey):(this.map=new Map,this.toKey=null!=e?e:Er.defaultToKey)}set(e,t){return this.map.set(this.toKey(e),t),this}get(e){return this.map.get(this.toKey(e))}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){void 0!==t&&(e=e.bind(t));for(let[t,r]of this.map)e(r,xt.parse(t),this)}values(){return this.map.values()}*keys(){for(let e of this.map.keys())yield xt.parse(e)}*entries(){for(let e of this.map.entries())yield[xt.parse(e[0]),e[1]]}*[(gr=Symbol.toStringTag,Symbol.iterator)](){for(let e of this.map)yield[xt.parse(e[0]),e[1]]}}Er.defaultToKey=e=>e.toString(),(_r=wr||(wr={}))[_r.None=0]="None",_r[_r.AsOld=1]="AsOld",_r[_r.AsNew=2]="AsNew";class Mr{constructor(){this[vr]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return null==(e=this._head)?void 0:e.value}get last(){var e;return null==(e=this._tail)?void 0:e.value}has(e){return this._map.has(e)}get(e,t=0){const r=this._map.get(e);if(r)return 0!==t&&this.touch(r,t),r.value}set(e,t,r=0){let i=this._map.get(e);if(i)i.value=t,0!==r&&this.touch(i,r);else{switch(i={key:e,value:t,next:void 0,previous:void 0},r){case 0:case 2:default:this.addItemLast(i);break;case 1:this.addItemFirst(i)}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){const r=this._state;let i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const e=this,t=this._state;let r=this._head;const i={[Symbol.iterator]:()=>i,next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){const e={value:r.key,done:!1};return r=r.next,e}return{value:void 0,done:!0}}};return i}values(){const e=this,t=this._state;let r=this._head;const i={[Symbol.iterator]:()=>i,next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){const e={value:r.value,done:!1};return r=r.next,e}return{value:void 0,done:!0}}};return i}entries(){const e=this,t=this._state;let r=this._head;const i={[Symbol.iterator]:()=>i,next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){const e={value:[r.key,r.value],done:!1};return r=r.next,e}return{value:void 0,done:!0}}};return i}[(vr=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(0===e)return void this.clear();let t=this._head,r=this.size;for(;t&&r>e;)this._map.delete(t.key),t=t.next,r--;this._head=t,this._size=r,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e,this._state++}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(1===t||2===t)if(1===t){if(e===this._head)return;const t=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(t.previous=r,r.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(2===t){if(e===this._tail)return;const t=e.next,r=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=r,r.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}toJSON(){const e=[];return this.forEach(((t,r)=>{e.push([r,t])})),e}fromJSON(e){this.clear();for(const[t,r]of e)this.set(t,r)}}class Cr extends Mr{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=2){return super.get(e,t)}peek(e){return super.get(e,0)}set(e,t){return super.set(e,t,2),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}mr=Symbol.iterator;function Ir(...e){return function(t,r){for(let i=0,n=e.length;i<n;i++){const n=e[i](t,r);if(n)return n}return null}}kr.bind(void 0,!1);const Tr=kr.bind(void 0,!0);function kr(e,t,r){if(!r||r.length<t.length)return null;let i;return i=e?Ue(r,t):0===r.indexOf(t),i?t.length>0?[{start:0,end:t.length}]:[]:null}function Rr(e,t){const r=t.toLowerCase().indexOf(e.toLowerCase());return-1===r?null:[{start:r,end:r+e.length}]}function xr(e,t){return Or(e.toLowerCase(),t.toLowerCase(),0,0)}function Or(e,t,r,i){if(r===e.length)return[];if(i===t.length)return null;if(e[r]===t[i]){let n=null;return(n=Or(e,t,r+1,i+1))?jr({start:i,end:i+1},n):null}return Or(e,t,r,i+1)}function Ar(e){return 97<=e&&e<=122}function Pr(e){return 65<=e&&e<=90}function Dr(e){return 48<=e&&e<=57}function Lr(e){return 32===e||9===e||10===e||13===e}const Ur=new Set;function Nr(e){return Ar(e)||Pr(e)||Dr(e)}function jr(e,t){return 0===t.length?t=[e]:e.end===t[0].start?t[0].start=e.start:t.unshift(e),t}function Br(e,t){for(let r=t;r<e.length;r++){const t=e.charCodeAt(r);if(Pr(t)||Dr(t)||r>0&&!Nr(e.charCodeAt(r-1)))return r}return e.length}function Fr(e,t,r,i){if(r===e.length)return[];if(i===t.length)return null;if(e[r]!==t[i].toLowerCase())return null;{let n=null,o=i+1;for(n=Fr(e,t,r+1,i+1);!n&&(o=Br(t,o))<t.length;)n=Fr(e,t,r+1,o),o++;return null===n?null:jr({start:i,end:i+1},n)}}function Kr(e,t){if(!t)return null;if(0===(t=t.trim()).length)return null;if(!function(e){let t=0,r=0,i=0,n=0;for(let o=0;o<e.length;o++)i=e.charCodeAt(o),Pr(i)&&t++,Ar(i)&&r++,Lr(i)&&n++;return 0!==t&&0!==r||0!==n?t<=5:e.length<=30}(e))return null;if(t.length>60)return null;const r=function(e){let t=0,r=0,i=0,n=0,o=0;for(let s=0;s<e.length;s++)o=e.charCodeAt(s),Pr(o)&&t++,Ar(o)&&r++,Nr(o)&&i++,Dr(o)&&n++;return{upperPercent:t/e.length,lowerPercent:r/e.length,alphaPercent:i/e.length,numericPercent:n/e.length}}(t);if(!function(e){const{upperPercent:t,lowerPercent:r,alphaPercent:i,numericPercent:n}=e;return r>.2&&t<.8&&i>.6&&n<.2}(r)){if(!function(e){const{upperPercent:t,lowerPercent:r}=e;return 0===r&&t>.6}(r))return null;t=t.toLowerCase()}let i=null,n=0;for(e=e.toLowerCase();n<t.length&&null===(i=Fr(e,t,0,n));)n=Br(t,n+1);return i}"`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?".split("").forEach((e=>Ur.add(e.charCodeAt(0))));Ir(Tr,Kr,Rr),Ir(Tr,Kr,xr),new Cr(1e4);const qr=128;function $r(){const e=[],t=[];for(let e=0;e<=qr;e++)t[e]=0;for(let r=0;r<=qr;r++)e.push(t.slice(0));return e}function Wr(e){const t=[];for(let r=0;r<=e;r++)t[r]=0;return t}Wr(2*qr),Wr(2*qr),$r(),$r(),$r();var Vr,Hr,Gr,zr;(Hr=Vr||(Vr={}))[Hr.Diag=1]="Diag",Hr[Hr.Left=2]="Left",Hr[Hr.LeftLeft=3]="LeftLeft",(zr=Gr||(Gr={})).Default=[-100,0],zr.isDefault=function(e){return!e||2===e.length&&-100===e[0]&&0===e[1]};Object.freeze({score:0});new Cr(1e4);var Yr,Jr;function Zr(e,t,r=32){const i=r-t;return(e<<t|(~((1<<i)-1)&e)>>>i)>>>0}function Qr(e,t=0,r=e.byteLength,i=0){for(let n=0;n<r;n++)e[t+n]=i}function Xr(e,t=32){return e instanceof ArrayBuffer?Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join(""):function(e,t,r="0"){for(;e.length<t;)e=r+e;return e}((e>>>0).toString(16),t/4)}(Jr=Yr||(Yr={}))[Jr.BLOCK_SIZE=64]="BLOCK_SIZE",Jr[Jr.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT";class ei{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(e){const t=e.length;if(0===t)return;const r=this._buff;let i,n,o=this._buffLen,s=this._leftoverHighSurrogate;for(0!==s?(i=s,n=-1,s=0):(i=e.charCodeAt(0),n=0);;){let a=i;if(Ne(i)){if(!(n+1<t)){s=i;break}{const t=e.charCodeAt(n+1);je(t)?(n++,a=Be(i,t)):a=65533}}else je(i)&&(a=65533);if(o=this._push(r,o,a),n++,!(n<t))break;i=e.charCodeAt(n)}this._buffLen=o,this._leftoverHighSurrogate=s}_push(e,t,r){return r<128?e[t++]=r:r<2048?(e[t++]=192|(1984&r)>>>6,e[t++]=128|(63&r)>>>0):r<65536?(e[t++]=224|(61440&r)>>>12,e[t++]=128|(4032&r)>>>6,e[t++]=128|(63&r)>>>0):(e[t++]=240|(1835008&r)>>>18,e[t++]=128|(258048&r)>>>12,e[t++]=128|(4032&r)>>>6,e[t++]=128|(63&r)>>>0),t>=64&&(this._step(),t-=64,this._totalLen+=64,e[0]=e[64],e[1]=e[65],e[2]=e[66]),t}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Xr(this._h0)+Xr(this._h1)+Xr(this._h2)+Xr(this._h3)+Xr(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,Qr(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Qr(this._buff));const e=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(e/4294967296),!1),this._buffDV.setUint32(60,e%4294967296,!1),this._step()}_step(){const e=ei._bigBlock32,t=this._buffDV;for(let r=0;r<64;r+=4)e.setUint32(r,t.getUint32(r,!1),!1);for(let t=64;t<320;t+=4)e.setUint32(t,Zr(e.getUint32(t-12,!1)^e.getUint32(t-32,!1)^e.getUint32(t-56,!1)^e.getUint32(t-64,!1),1),!1);let r,i,n,o=this._h0,s=this._h1,a=this._h2,c=this._h3,l=this._h4;for(let t=0;t<80;t++)t<20?(r=s&a|~s&c,i=1518500249):t<40?(r=s^a^c,i=1859775393):t<60?(r=s&a|s&c|a&c,i=2400959708):(r=s^a^c,i=3395469782),n=Zr(o,5)+r+l+i+e.getUint32(4*t,!1)&4294967295,l=c,c=a,a=Zr(s,30),s=o,o=n;this._h0=this._h0+o&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+a&4294967295,this._h3=this._h3+c&4294967295,this._h4=this._h4+l&4294967295}}ei._bigBlock32=new DataView(new ArrayBuffer(320));class ti{constructor(e,t=10){if(this.capacity=t,e.length<1)throw new Error("not supported");this.size=1,this.head=this.tail=this.cursor={value:e[0],previous:void 0,next:void 0};for(let t=1;t<e.length;t++)this.add(e[t])}add(e){const t={value:e,previous:this.tail,next:void 0};for(this.tail.next=t,this.tail=t,this.cursor=this.tail,this.size++;this.size>this.capacity;)this.head=this.head.next,this.head.previous=void 0,this.size--}replaceLast(e){this.tail.value=e}isAtEnd(){return this.cursor===this.tail}current(){return this.cursor.value}previous(){return this.cursor.previous&&(this.cursor=this.cursor.previous),this.cursor.value}next(){return this.cursor.next&&(this.cursor=this.cursor.next),this.cursor.value}has(e){let t=this.head;for(;t;){if(t.value===e)return!0;t.next}return!1}resetCursor(){return this.cursor=this.tail,this.cursor.value}*[Symbol.iterator](){let e=this.head;for(;e;)yield e.value,e=e.next}}const ri=new RegExp(`\\$\\(${or.iconNameExpression}(?:${or.iconModifierExpression})?\\)`,"g");new RegExp(`(\\\\)?${ri.source}`,"g");new RegExp(`\\\\${ri.source}`,"g");new RegExp(`(\\s)?(\\\\)?${ri.source}(\\s)?`,"g");var ii,ni;(ni=ii||(ii={}))[ni.Paragraph=0]="Paragraph",ni[ni.Break=1]="Break";class oi{constructor(e){this._prefix=e,this._lastId=0}nextId(){return this._prefix+ ++this._lastId}}new oi("id#");var si,ai,ci,li,ui,hi,di,fi,pi;(ai=si||(si={}))[ai.None=0]="None",ai[ai.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",ai[ai.UnexpectedEndOfString=2]="UnexpectedEndOfString",ai[ai.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",ai[ai.InvalidUnicode=4]="InvalidUnicode",ai[ai.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",ai[ai.InvalidCharacter=6]="InvalidCharacter",(li=ci||(ci={}))[li.OpenBraceToken=1]="OpenBraceToken",li[li.CloseBraceToken=2]="CloseBraceToken",li[li.OpenBracketToken=3]="OpenBracketToken",li[li.CloseBracketToken=4]="CloseBracketToken",li[li.CommaToken=5]="CommaToken",li[li.ColonToken=6]="ColonToken",li[li.NullKeyword=7]="NullKeyword",li[li.TrueKeyword=8]="TrueKeyword",li[li.FalseKeyword=9]="FalseKeyword",li[li.StringLiteral=10]="StringLiteral",li[li.NumericLiteral=11]="NumericLiteral",li[li.LineCommentTrivia=12]="LineCommentTrivia",li[li.BlockCommentTrivia=13]="BlockCommentTrivia",li[li.LineBreakTrivia=14]="LineBreakTrivia",li[li.Trivia=15]="Trivia",li[li.Unknown=16]="Unknown",li[li.EOF=17]="EOF",(hi=ui||(ui={}))[hi.InvalidSymbol=1]="InvalidSymbol",hi[hi.InvalidNumberFormat=2]="InvalidNumberFormat",hi[hi.PropertyNameExpected=3]="PropertyNameExpected",hi[hi.ValueExpected=4]="ValueExpected",hi[hi.ColonExpected=5]="ColonExpected",hi[hi.CommaExpected=6]="CommaExpected",hi[hi.CloseBraceExpected=7]="CloseBraceExpected",hi[hi.CloseBracketExpected=8]="CloseBracketExpected",hi[hi.EndOfFileExpected=9]="EndOfFileExpected",hi[hi.InvalidCommentToken=10]="InvalidCommentToken",hi[hi.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",hi[hi.UnexpectedEndOfString=12]="UnexpectedEndOfString",hi[hi.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",hi[hi.InvalidUnicode=14]="InvalidUnicode",hi[hi.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",hi[hi.InvalidCharacter=16]="InvalidCharacter",(di||(di={})).DEFAULT={allowTrailingComma:!0},(pi=fi||(fi={}))[pi.nullCharacter=0]="nullCharacter",pi[pi.maxAsciiCharacter=127]="maxAsciiCharacter",pi[pi.lineFeed=10]="lineFeed",pi[pi.carriageReturn=13]="carriageReturn",pi[pi.lineSeparator=8232]="lineSeparator",pi[pi.paragraphSeparator=8233]="paragraphSeparator",pi[pi.nextLine=133]="nextLine",pi[pi.space=32]="space",pi[pi.nonBreakingSpace=160]="nonBreakingSpace",pi[pi.enQuad=8192]="enQuad",pi[pi.emQuad=8193]="emQuad",pi[pi.enSpace=8194]="enSpace",pi[pi.emSpace=8195]="emSpace",pi[pi.threePerEmSpace=8196]="threePerEmSpace",pi[pi.fourPerEmSpace=8197]="fourPerEmSpace",pi[pi.sixPerEmSpace=8198]="sixPerEmSpace",pi[pi.figureSpace=8199]="figureSpace",pi[pi.punctuationSpace=8200]="punctuationSpace",pi[pi.thinSpace=8201]="thinSpace",pi[pi.hairSpace=8202]="hairSpace",pi[pi.zeroWidthSpace=8203]="zeroWidthSpace",pi[pi.narrowNoBreakSpace=8239]="narrowNoBreakSpace",pi[pi.ideographicSpace=12288]="ideographicSpace",pi[pi.mathematicalSpace=8287]="mathematicalSpace",pi[pi.ogham=5760]="ogham",pi[pi._=95]="_",pi[pi.$=36]="$",pi[pi._0=48]="_0",pi[pi._1=49]="_1",pi[pi._2=50]="_2",pi[pi._3=51]="_3",pi[pi._4=52]="_4",pi[pi._5=53]="_5",pi[pi._6=54]="_6",pi[pi._7=55]="_7",pi[pi._8=56]="_8",pi[pi._9=57]="_9",pi[pi.a=97]="a",pi[pi.b=98]="b",pi[pi.c=99]="c",pi[pi.d=100]="d",pi[pi.e=101]="e",pi[pi.f=102]="f",pi[pi.g=103]="g",pi[pi.h=104]="h",pi[pi.i=105]="i",pi[pi.j=106]="j",pi[pi.k=107]="k",pi[pi.l=108]="l",pi[pi.m=109]="m",pi[pi.n=110]="n",pi[pi.o=111]="o",pi[pi.p=112]="p",pi[pi.q=113]="q",pi[pi.r=114]="r",pi[pi.s=115]="s",pi[pi.t=116]="t",pi[pi.u=117]="u",pi[pi.v=118]="v",pi[pi.w=119]="w",pi[pi.x=120]="x",pi[pi.y=121]="y",pi[pi.z=122]="z",pi[pi.A=65]="A",pi[pi.B=66]="B",pi[pi.C=67]="C",pi[pi.D=68]="D",pi[pi.E=69]="E",pi[pi.F=70]="F",pi[pi.G=71]="G",pi[pi.H=72]="H",pi[pi.I=73]="I",pi[pi.J=74]="J",pi[pi.K=75]="K",pi[pi.L=76]="L",pi[pi.M=77]="M",pi[pi.N=78]="N",pi[pi.O=79]="O",pi[pi.P=80]="P",pi[pi.Q=81]="Q",pi[pi.R=82]="R",pi[pi.S=83]="S",pi[pi.T=84]="T",pi[pi.U=85]="U",pi[pi.V=86]="V",pi[pi.W=87]="W",pi[pi.X=88]="X",pi[pi.Y=89]="Y",pi[pi.Z=90]="Z",pi[pi.ampersand=38]="ampersand",pi[pi.asterisk=42]="asterisk",pi[pi.at=64]="at",pi[pi.backslash=92]="backslash",pi[pi.bar=124]="bar",pi[pi.caret=94]="caret",pi[pi.closeBrace=125]="closeBrace",pi[pi.closeBracket=93]="closeBracket",pi[pi.closeParen=41]="closeParen",pi[pi.colon=58]="colon",pi[pi.comma=44]="comma",pi[pi.dot=46]="dot",pi[pi.doubleQuote=34]="doubleQuote",pi[pi.equals=61]="equals",pi[pi.exclamation=33]="exclamation",pi[pi.greaterThan=62]="greaterThan",pi[pi.lessThan=60]="lessThan",pi[pi.minus=45]="minus",pi[pi.openBrace=123]="openBrace",pi[pi.openBracket=91]="openBracket",pi[pi.openParen=40]="openParen",pi[pi.percent=37]="percent",pi[pi.plus=43]="plus",pi[pi.question=63]="question",pi[pi.semicolon=59]="semicolon",pi[pi.singleQuote=39]="singleQuote",pi[pi.slash=47]="slash",pi[pi.tilde=126]="tilde",pi[pi.backspace=8]="backspace",pi[pi.formFeed=12]="formFeed",pi[pi.byteOrderMark=65279]="byteOrderMark",pi[pi.tab=9]="tab",pi[pi.verticalTab=11]="verticalTab";var mi,gi;(gi=mi||(mi={}))[gi.DependsOnKbLayout=-1]="DependsOnKbLayout",gi[gi.Unknown=0]="Unknown",gi[gi.Backspace=1]="Backspace",gi[gi.Tab=2]="Tab",gi[gi.Enter=3]="Enter",gi[gi.Shift=4]="Shift",gi[gi.Ctrl=5]="Ctrl",gi[gi.Alt=6]="Alt",gi[gi.PauseBreak=7]="PauseBreak",gi[gi.CapsLock=8]="CapsLock",gi[gi.Escape=9]="Escape",gi[gi.Space=10]="Space",gi[gi.PageUp=11]="PageUp",gi[gi.PageDown=12]="PageDown",gi[gi.End=13]="End",gi[gi.Home=14]="Home",gi[gi.LeftArrow=15]="LeftArrow",gi[gi.UpArrow=16]="UpArrow",gi[gi.RightArrow=17]="RightArrow",gi[gi.DownArrow=18]="DownArrow",gi[gi.Insert=19]="Insert",gi[gi.Delete=20]="Delete",gi[gi.KEY_0=21]="KEY_0",gi[gi.KEY_1=22]="KEY_1",gi[gi.KEY_2=23]="KEY_2",gi[gi.KEY_3=24]="KEY_3",gi[gi.KEY_4=25]="KEY_4",gi[gi.KEY_5=26]="KEY_5",gi[gi.KEY_6=27]="KEY_6",gi[gi.KEY_7=28]="KEY_7",gi[gi.KEY_8=29]="KEY_8",gi[gi.KEY_9=30]="KEY_9",gi[gi.KEY_A=31]="KEY_A",gi[gi.KEY_B=32]="KEY_B",gi[gi.KEY_C=33]="KEY_C",gi[gi.KEY_D=34]="KEY_D",gi[gi.KEY_E=35]="KEY_E",gi[gi.KEY_F=36]="KEY_F",gi[gi.KEY_G=37]="KEY_G",gi[gi.KEY_H=38]="KEY_H",gi[gi.KEY_I=39]="KEY_I",gi[gi.KEY_J=40]="KEY_J",gi[gi.KEY_K=41]="KEY_K",gi[gi.KEY_L=42]="KEY_L",gi[gi.KEY_M=43]="KEY_M",gi[gi.KEY_N=44]="KEY_N",gi[gi.KEY_O=45]="KEY_O",gi[gi.KEY_P=46]="KEY_P",gi[gi.KEY_Q=47]="KEY_Q",gi[gi.KEY_R=48]="KEY_R",gi[gi.KEY_S=49]="KEY_S",gi[gi.KEY_T=50]="KEY_T",gi[gi.KEY_U=51]="KEY_U",gi[gi.KEY_V=52]="KEY_V",gi[gi.KEY_W=53]="KEY_W",gi[gi.KEY_X=54]="KEY_X",gi[gi.KEY_Y=55]="KEY_Y",gi[gi.KEY_Z=56]="KEY_Z",gi[gi.Meta=57]="Meta",gi[gi.ContextMenu=58]="ContextMenu",gi[gi.F1=59]="F1",gi[gi.F2=60]="F2",gi[gi.F3=61]="F3",gi[gi.F4=62]="F4",gi[gi.F5=63]="F5",gi[gi.F6=64]="F6",gi[gi.F7=65]="F7",gi[gi.F8=66]="F8",gi[gi.F9=67]="F9",gi[gi.F10=68]="F10",gi[gi.F11=69]="F11",gi[gi.F12=70]="F12",gi[gi.F13=71]="F13",gi[gi.F14=72]="F14",gi[gi.F15=73]="F15",gi[gi.F16=74]="F16",gi[gi.F17=75]="F17",gi[gi.F18=76]="F18",gi[gi.F19=77]="F19",gi[gi.NumLock=78]="NumLock",gi[gi.ScrollLock=79]="ScrollLock",gi[gi.US_SEMICOLON=80]="US_SEMICOLON",gi[gi.US_EQUAL=81]="US_EQUAL",gi[gi.US_COMMA=82]="US_COMMA",gi[gi.US_MINUS=83]="US_MINUS",gi[gi.US_DOT=84]="US_DOT",gi[gi.US_SLASH=85]="US_SLASH",gi[gi.US_BACKTICK=86]="US_BACKTICK",gi[gi.US_OPEN_SQUARE_BRACKET=87]="US_OPEN_SQUARE_BRACKET",gi[gi.US_BACKSLASH=88]="US_BACKSLASH",gi[gi.US_CLOSE_SQUARE_BRACKET=89]="US_CLOSE_SQUARE_BRACKET",gi[gi.US_QUOTE=90]="US_QUOTE",gi[gi.OEM_8=91]="OEM_8",gi[gi.OEM_102=92]="OEM_102",gi[gi.NUMPAD_0=93]="NUMPAD_0",gi[gi.NUMPAD_1=94]="NUMPAD_1",gi[gi.NUMPAD_2=95]="NUMPAD_2",gi[gi.NUMPAD_3=96]="NUMPAD_3",gi[gi.NUMPAD_4=97]="NUMPAD_4",gi[gi.NUMPAD_5=98]="NUMPAD_5",gi[gi.NUMPAD_6=99]="NUMPAD_6",gi[gi.NUMPAD_7=100]="NUMPAD_7",gi[gi.NUMPAD_8=101]="NUMPAD_8",gi[gi.NUMPAD_9=102]="NUMPAD_9",gi[gi.NUMPAD_MULTIPLY=103]="NUMPAD_MULTIPLY",gi[gi.NUMPAD_ADD=104]="NUMPAD_ADD",gi[gi.NUMPAD_SEPARATOR=105]="NUMPAD_SEPARATOR",gi[gi.NUMPAD_SUBTRACT=106]="NUMPAD_SUBTRACT",gi[gi.NUMPAD_DECIMAL=107]="NUMPAD_DECIMAL",gi[gi.NUMPAD_DIVIDE=108]="NUMPAD_DIVIDE",gi[gi.KEY_IN_COMPOSITION=109]="KEY_IN_COMPOSITION",gi[gi.ABNT_C1=110]="ABNT_C1",gi[gi.ABNT_C2=111]="ABNT_C2",gi[gi.MAX_VALUE=112]="MAX_VALUE";class vi{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}}const yi=new vi,bi=new vi,wi=new vi;var _i,Si,Ei,Mi,Ci,Ii;!function(){function e(e,t,r=t,i=r){yi.define(e,t),bi.define(e,r),wi.define(e,i)}e(0,"unknown"),e(1,"Backspace"),e(2,"Tab"),e(3,"Enter"),e(4,"Shift"),e(5,"Ctrl"),e(6,"Alt"),e(7,"PauseBreak"),e(8,"CapsLock"),e(9,"Escape"),e(10,"Space"),e(11,"PageUp"),e(12,"PageDown"),e(13,"End"),e(14,"Home"),e(15,"LeftArrow","Left"),e(16,"UpArrow","Up"),e(17,"RightArrow","Right"),e(18,"DownArrow","Down"),e(19,"Insert"),e(20,"Delete"),e(21,"0"),e(22,"1"),e(23,"2"),e(24,"3"),e(25,"4"),e(26,"5"),e(27,"6"),e(28,"7"),e(29,"8"),e(30,"9"),e(31,"A"),e(32,"B"),e(33,"C"),e(34,"D"),e(35,"E"),e(36,"F"),e(37,"G"),e(38,"H"),e(39,"I"),e(40,"J"),e(41,"K"),e(42,"L"),e(43,"M"),e(44,"N"),e(45,"O"),e(46,"P"),e(47,"Q"),e(48,"R"),e(49,"S"),e(50,"T"),e(51,"U"),e(52,"V"),e(53,"W"),e(54,"X"),e(55,"Y"),e(56,"Z"),e(57,"Meta"),e(58,"ContextMenu"),e(59,"F1"),e(60,"F2"),e(61,"F3"),e(62,"F4"),e(63,"F5"),e(64,"F6"),e(65,"F7"),e(66,"F8"),e(67,"F9"),e(68,"F10"),e(69,"F11"),e(70,"F12"),e(71,"F13"),e(72,"F14"),e(73,"F15"),e(74,"F16"),e(75,"F17"),e(76,"F18"),e(77,"F19"),e(78,"NumLock"),e(79,"ScrollLock"),e(80,";",";","OEM_1"),e(81,"=","=","OEM_PLUS"),e(82,",",",","OEM_COMMA"),e(83,"-","-","OEM_MINUS"),e(84,".",".","OEM_PERIOD"),e(85,"/","/","OEM_2"),e(86,"`","`","OEM_3"),e(110,"ABNT_C1"),e(111,"ABNT_C2"),e(87,"[","[","OEM_4"),e(88,"\\","\\","OEM_5"),e(89,"]","]","OEM_6"),e(90,"'","'","OEM_7"),e(91,"OEM_8"),e(92,"OEM_102"),e(93,"NumPad0"),e(94,"NumPad1"),e(95,"NumPad2"),e(96,"NumPad3"),e(97,"NumPad4"),e(98,"NumPad5"),e(99,"NumPad6"),e(100,"NumPad7"),e(101,"NumPad8"),e(102,"NumPad9"),e(103,"NumPad_Multiply"),e(104,"NumPad_Add"),e(105,"NumPad_Separator"),e(106,"NumPad_Subtract"),e(107,"NumPad_Decimal"),e(108,"NumPad_Divide")}(),(Si=_i||(_i={})).toString=function(e){return yi.keyCodeToStr(e)},Si.fromString=function(e){return yi.strToKeyCode(e)},Si.toUserSettingsUS=function(e){return bi.keyCodeToStr(e)},Si.toUserSettingsGeneral=function(e){return wi.keyCodeToStr(e)},Si.fromUserSettings=function(e){return bi.strToKeyCode(e)||wi.strToKeyCode(e)},(Mi=Ei||(Ei={}))[Mi.CtrlCmd=2048]="CtrlCmd",Mi[Mi.Shift=1024]="Shift",Mi[Mi.Alt=512]="Alt",Mi[Mi.WinCtrl=256]="WinCtrl",Mi[Mi.KeyCode=255]="KeyCode",(Ii=Ci||(Ci={}))[Ii.CtrlCmd=2048]="CtrlCmd",Ii[Ii.Shift=1024]="Shift",Ii[Ii.Alt=512]="Alt",Ii[Ii.WinCtrl=256]="WinCtrl";class Ti{constructor(e,t,r=t){this.modifierLabels=[null],this.modifierLabels[2]=e,this.modifierLabels[1]=t,this.modifierLabels[3]=r}toLabel(e,t,r){if(0===t.length)return null;const i=[];for(let n=0,o=t.length;n<o;n++){const o=t[n],s=r(o);if(null===s)return null;i[n]=ki(o,s,this.modifierLabels[e])}return i.join(" ")}}new Ti({ctrlKey:"⌃",shiftKey:"⇧",altKey:"⌥",metaKey:"⌘",separator:""},{ctrlKey:s(0,"Ctrl"),shiftKey:s(0,"Shift"),altKey:s(0,"Alt"),metaKey:s(0,"Windows"),separator:"+"},{ctrlKey:s(0,"Ctrl"),shiftKey:s(0,"Shift"),altKey:s(0,"Alt"),metaKey:s(0,"Super"),separator:"+"}),new Ti({ctrlKey:s(0,"Control"),shiftKey:s(0,"Shift"),altKey:s(0,"Alt"),metaKey:s(0,"Command"),separator:"+"},{ctrlKey:s(0,"Control"),shiftKey:s(0,"Shift"),altKey:s(0,"Alt"),metaKey:s(0,"Windows"),separator:"+"},{ctrlKey:s(0,"Control"),shiftKey:s(0,"Shift"),altKey:s(0,"Alt"),metaKey:s(0,"Super"),separator:"+"}),new Ti({ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Cmd",separator:"+"},{ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Super",separator:"+"}),new Ti({ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"cmd",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"win",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"meta",separator:"+"});function ki(e,t,r){if(null===t)return"";const i=[];return e.ctrlKey&&i.push(r.ctrlKey),e.shiftKey&&i.push(r.shiftKey),e.altKey&&i.push(r.altKey),e.metaKey&&i.push(r.metaKey),""!==t&&i.push(t),i.join(r.separator)}var Ri,xi;(xi=Ri||(Ri={}))[xi.DependsOnKbLayout=-1]="DependsOnKbLayout",xi[xi.None=0]="None",xi[xi.Hyper=1]="Hyper",xi[xi.Super=2]="Super",xi[xi.Fn=3]="Fn",xi[xi.FnLock=4]="FnLock",xi[xi.Suspend=5]="Suspend",xi[xi.Resume=6]="Resume",xi[xi.Turbo=7]="Turbo",xi[xi.Sleep=8]="Sleep",xi[xi.WakeUp=9]="WakeUp",xi[xi.KeyA=10]="KeyA",xi[xi.KeyB=11]="KeyB",xi[xi.KeyC=12]="KeyC",xi[xi.KeyD=13]="KeyD",xi[xi.KeyE=14]="KeyE",xi[xi.KeyF=15]="KeyF",xi[xi.KeyG=16]="KeyG",xi[xi.KeyH=17]="KeyH",xi[xi.KeyI=18]="KeyI",xi[xi.KeyJ=19]="KeyJ",xi[xi.KeyK=20]="KeyK",xi[xi.KeyL=21]="KeyL",xi[xi.KeyM=22]="KeyM",xi[xi.KeyN=23]="KeyN",xi[xi.KeyO=24]="KeyO",xi[xi.KeyP=25]="KeyP",xi[xi.KeyQ=26]="KeyQ",xi[xi.KeyR=27]="KeyR",xi[xi.KeyS=28]="KeyS",xi[xi.KeyT=29]="KeyT",xi[xi.KeyU=30]="KeyU",xi[xi.KeyV=31]="KeyV",xi[xi.KeyW=32]="KeyW",xi[xi.KeyX=33]="KeyX",xi[xi.KeyY=34]="KeyY",xi[xi.KeyZ=35]="KeyZ",xi[xi.Digit1=36]="Digit1",xi[xi.Digit2=37]="Digit2",xi[xi.Digit3=38]="Digit3",xi[xi.Digit4=39]="Digit4",xi[xi.Digit5=40]="Digit5",xi[xi.Digit6=41]="Digit6",xi[xi.Digit7=42]="Digit7",xi[xi.Digit8=43]="Digit8",xi[xi.Digit9=44]="Digit9",xi[xi.Digit0=45]="Digit0",xi[xi.Enter=46]="Enter",xi[xi.Escape=47]="Escape",xi[xi.Backspace=48]="Backspace",xi[xi.Tab=49]="Tab",xi[xi.Space=50]="Space",xi[xi.Minus=51]="Minus",xi[xi.Equal=52]="Equal",xi[xi.BracketLeft=53]="BracketLeft",xi[xi.BracketRight=54]="BracketRight",xi[xi.Backslash=55]="Backslash",xi[xi.IntlHash=56]="IntlHash",xi[xi.Semicolon=57]="Semicolon",xi[xi.Quote=58]="Quote",xi[xi.Backquote=59]="Backquote",xi[xi.Comma=60]="Comma",xi[xi.Period=61]="Period",xi[xi.Slash=62]="Slash",xi[xi.CapsLock=63]="CapsLock",xi[xi.F1=64]="F1",xi[xi.F2=65]="F2",xi[xi.F3=66]="F3",xi[xi.F4=67]="F4",xi[xi.F5=68]="F5",xi[xi.F6=69]="F6",xi[xi.F7=70]="F7",xi[xi.F8=71]="F8",xi[xi.F9=72]="F9",xi[xi.F10=73]="F10",xi[xi.F11=74]="F11",xi[xi.F12=75]="F12",xi[xi.PrintScreen=76]="PrintScreen",xi[xi.ScrollLock=77]="ScrollLock",xi[xi.Pause=78]="Pause",xi[xi.Insert=79]="Insert",xi[xi.Home=80]="Home",xi[xi.PageUp=81]="PageUp",xi[xi.Delete=82]="Delete",xi[xi.End=83]="End",xi[xi.PageDown=84]="PageDown",xi[xi.ArrowRight=85]="ArrowRight",xi[xi.ArrowLeft=86]="ArrowLeft",xi[xi.ArrowDown=87]="ArrowDown",xi[xi.ArrowUp=88]="ArrowUp",xi[xi.NumLock=89]="NumLock",xi[xi.NumpadDivide=90]="NumpadDivide",xi[xi.NumpadMultiply=91]="NumpadMultiply",xi[xi.NumpadSubtract=92]="NumpadSubtract",xi[xi.NumpadAdd=93]="NumpadAdd",xi[xi.NumpadEnter=94]="NumpadEnter",xi[xi.Numpad1=95]="Numpad1",xi[xi.Numpad2=96]="Numpad2",xi[xi.Numpad3=97]="Numpad3",xi[xi.Numpad4=98]="Numpad4",xi[xi.Numpad5=99]="Numpad5",xi[xi.Numpad6=100]="Numpad6",xi[xi.Numpad7=101]="Numpad7",xi[xi.Numpad8=102]="Numpad8",xi[xi.Numpad9=103]="Numpad9",xi[xi.Numpad0=104]="Numpad0",xi[xi.NumpadDecimal=105]="NumpadDecimal",xi[xi.IntlBackslash=106]="IntlBackslash",xi[xi.ContextMenu=107]="ContextMenu",xi[xi.Power=108]="Power",xi[xi.NumpadEqual=109]="NumpadEqual",xi[xi.F13=110]="F13",xi[xi.F14=111]="F14",xi[xi.F15=112]="F15",xi[xi.F16=113]="F16",xi[xi.F17=114]="F17",xi[xi.F18=115]="F18",xi[xi.F19=116]="F19",xi[xi.F20=117]="F20",xi[xi.F21=118]="F21",xi[xi.F22=119]="F22",xi[xi.F23=120]="F23",xi[xi.F24=121]="F24",xi[xi.Open=122]="Open",xi[xi.Help=123]="Help",xi[xi.Select=124]="Select",xi[xi.Again=125]="Again",xi[xi.Undo=126]="Undo",xi[xi.Cut=127]="Cut",xi[xi.Copy=128]="Copy",xi[xi.Paste=129]="Paste",xi[xi.Find=130]="Find",xi[xi.AudioVolumeMute=131]="AudioVolumeMute",xi[xi.AudioVolumeUp=132]="AudioVolumeUp",xi[xi.AudioVolumeDown=133]="AudioVolumeDown",xi[xi.NumpadComma=134]="NumpadComma",xi[xi.IntlRo=135]="IntlRo",xi[xi.KanaMode=136]="KanaMode",xi[xi.IntlYen=137]="IntlYen",xi[xi.Convert=138]="Convert",xi[xi.NonConvert=139]="NonConvert",xi[xi.Lang1=140]="Lang1",xi[xi.Lang2=141]="Lang2",xi[xi.Lang3=142]="Lang3",xi[xi.Lang4=143]="Lang4",xi[xi.Lang5=144]="Lang5",xi[xi.Abort=145]="Abort",xi[xi.Props=146]="Props",xi[xi.NumpadParenLeft=147]="NumpadParenLeft",xi[xi.NumpadParenRight=148]="NumpadParenRight",xi[xi.NumpadBackspace=149]="NumpadBackspace",xi[xi.NumpadMemoryStore=150]="NumpadMemoryStore",xi[xi.NumpadMemoryRecall=151]="NumpadMemoryRecall",xi[xi.NumpadMemoryClear=152]="NumpadMemoryClear",xi[xi.NumpadMemoryAdd=153]="NumpadMemoryAdd",xi[xi.NumpadMemorySubtract=154]="NumpadMemorySubtract",xi[xi.NumpadClear=155]="NumpadClear",xi[xi.NumpadClearEntry=156]="NumpadClearEntry",xi[xi.ControlLeft=157]="ControlLeft",xi[xi.ShiftLeft=158]="ShiftLeft",xi[xi.AltLeft=159]="AltLeft",xi[xi.MetaLeft=160]="MetaLeft",xi[xi.ControlRight=161]="ControlRight",xi[xi.ShiftRight=162]="ShiftRight",xi[xi.AltRight=163]="AltRight",xi[xi.MetaRight=164]="MetaRight",xi[xi.BrightnessUp=165]="BrightnessUp",xi[xi.BrightnessDown=166]="BrightnessDown",xi[xi.MediaPlay=167]="MediaPlay",xi[xi.MediaRecord=168]="MediaRecord",xi[xi.MediaFastForward=169]="MediaFastForward",xi[xi.MediaRewind=170]="MediaRewind",xi[xi.MediaTrackNext=171]="MediaTrackNext",xi[xi.MediaTrackPrevious=172]="MediaTrackPrevious",xi[xi.MediaStop=173]="MediaStop",xi[xi.Eject=174]="Eject",xi[xi.MediaPlayPause=175]="MediaPlayPause",xi[xi.MediaSelect=176]="MediaSelect",xi[xi.LaunchMail=177]="LaunchMail",xi[xi.LaunchApp2=178]="LaunchApp2",xi[xi.LaunchApp1=179]="LaunchApp1",xi[xi.SelectTask=180]="SelectTask",xi[xi.LaunchScreenSaver=181]="LaunchScreenSaver",xi[xi.BrowserSearch=182]="BrowserSearch",xi[xi.BrowserHome=183]="BrowserHome",xi[xi.BrowserBack=184]="BrowserBack",xi[xi.BrowserForward=185]="BrowserForward",xi[xi.BrowserStop=186]="BrowserStop",xi[xi.BrowserRefresh=187]="BrowserRefresh",xi[xi.BrowserFavorites=188]="BrowserFavorites",xi[xi.ZoomToggle=189]="ZoomToggle",xi[xi.MailReply=190]="MailReply",xi[xi.MailForward=191]="MailForward",xi[xi.MailSend=192]="MailSend",xi[xi.MAX_VALUE=193]="MAX_VALUE";const Oi=[],Ai=Object.create(null),Pi=Object.create(null),Di=[],Li=[];!function(){function e(e,t){Oi[e]=t,Ai[t]=e,Pi[t.toLowerCase()]=e}e(0,"None"),e(1,"Hyper"),e(2,"Super"),e(3,"Fn"),e(4,"FnLock"),e(5,"Suspend"),e(6,"Resume"),e(7,"Turbo"),e(8,"Sleep"),e(9,"WakeUp"),e(10,"KeyA"),e(11,"KeyB"),e(12,"KeyC"),e(13,"KeyD"),e(14,"KeyE"),e(15,"KeyF"),e(16,"KeyG"),e(17,"KeyH"),e(18,"KeyI"),e(19,"KeyJ"),e(20,"KeyK"),e(21,"KeyL"),e(22,"KeyM"),e(23,"KeyN"),e(24,"KeyO"),e(25,"KeyP"),e(26,"KeyQ"),e(27,"KeyR"),e(28,"KeyS"),e(29,"KeyT"),e(30,"KeyU"),e(31,"KeyV"),e(32,"KeyW"),e(33,"KeyX"),e(34,"KeyY"),e(35,"KeyZ"),e(36,"Digit1"),e(37,"Digit2"),e(38,"Digit3"),e(39,"Digit4"),e(40,"Digit5"),e(41,"Digit6"),e(42,"Digit7"),e(43,"Digit8"),e(44,"Digit9"),e(45,"Digit0"),e(46,"Enter"),e(47,"Escape"),e(48,"Backspace"),e(49,"Tab"),e(50,"Space"),e(51,"Minus"),e(52,"Equal"),e(53,"BracketLeft"),e(54,"BracketRight"),e(55,"Backslash"),e(56,"IntlHash"),e(57,"Semicolon"),e(58,"Quote"),e(59,"Backquote"),e(60,"Comma"),e(61,"Period"),e(62,"Slash"),e(63,"CapsLock"),e(64,"F1"),e(65,"F2"),e(66,"F3"),e(67,"F4"),e(68,"F5"),e(69,"F6"),e(70,"F7"),e(71,"F8"),e(72,"F9"),e(73,"F10"),e(74,"F11"),e(75,"F12"),e(76,"PrintScreen"),e(77,"ScrollLock"),e(78,"Pause"),e(79,"Insert"),e(80,"Home"),e(81,"PageUp"),e(82,"Delete"),e(83,"End"),e(84,"PageDown"),e(85,"ArrowRight"),e(86,"ArrowLeft"),e(87,"ArrowDown"),e(88,"ArrowUp"),e(89,"NumLock"),e(90,"NumpadDivide"),e(91,"NumpadMultiply"),e(92,"NumpadSubtract"),e(93,"NumpadAdd"),e(94,"NumpadEnter"),e(95,"Numpad1"),e(96,"Numpad2"),e(97,"Numpad3"),e(98,"Numpad4"),e(99,"Numpad5"),e(100,"Numpad6"),e(101,"Numpad7"),e(102,"Numpad8"),e(103,"Numpad9"),e(104,"Numpad0"),e(105,"NumpadDecimal"),e(106,"IntlBackslash"),e(107,"ContextMenu"),e(108,"Power"),e(109,"NumpadEqual"),e(110,"F13"),e(111,"F14"),e(112,"F15"),e(113,"F16"),e(114,"F17"),e(115,"F18"),e(116,"F19"),e(117,"F20"),e(118,"F21"),e(119,"F22"),e(120,"F23"),e(121,"F24"),e(122,"Open"),e(123,"Help"),e(124,"Select"),e(125,"Again"),e(126,"Undo"),e(127,"Cut"),e(128,"Copy"),e(129,"Paste"),e(130,"Find"),e(131,"AudioVolumeMute"),e(132,"AudioVolumeUp"),e(133,"AudioVolumeDown"),e(134,"NumpadComma"),e(135,"IntlRo"),e(136,"KanaMode"),e(137,"IntlYen"),e(138,"Convert"),e(139,"NonConvert"),e(140,"Lang1"),e(141,"Lang2"),e(142,"Lang3"),e(143,"Lang4"),e(144,"Lang5"),e(145,"Abort"),e(146,"Props"),e(147,"NumpadParenLeft"),e(148,"NumpadParenRight"),e(149,"NumpadBackspace"),e(150,"NumpadMemoryStore"),e(151,"NumpadMemoryRecall"),e(152,"NumpadMemoryClear"),e(153,"NumpadMemoryAdd"),e(154,"NumpadMemorySubtract"),e(155,"NumpadClear"),e(156,"NumpadClearEntry"),e(157,"ControlLeft"),e(158,"ShiftLeft"),e(159,"AltLeft"),e(160,"MetaLeft"),e(161,"ControlRight"),e(162,"ShiftRight"),e(163,"AltRight"),e(164,"MetaRight"),e(165,"BrightnessUp"),e(166,"BrightnessDown"),e(167,"MediaPlay"),e(168,"MediaRecord"),e(169,"MediaFastForward"),e(170,"MediaRewind"),e(171,"MediaTrackNext"),e(172,"MediaTrackPrevious"),e(173,"MediaStop"),e(174,"Eject"),e(175,"MediaPlayPause"),e(176,"MediaSelect"),e(177,"LaunchMail"),e(178,"LaunchApp2"),e(179,"LaunchApp1"),e(180,"SelectTask"),e(181,"LaunchScreenSaver"),e(182,"BrowserSearch"),e(183,"BrowserHome"),e(184,"BrowserBack"),e(185,"BrowserForward"),e(186,"BrowserStop"),e(187,"BrowserRefresh"),e(188,"BrowserFavorites"),e(189,"ZoomToggle"),e(190,"MailReply"),e(191,"MailForward"),e(192,"MailSend")}(),function(){for(let e=0;e<=193;e++)Di[e]=-1;for(let e=0;e<=112;e++)Li[e]=-1;function e(e,t){Di[e]=t,0!==t&&3!==t&&5!==t&&4!==t&&6!==t&&57!==t&&(Li[t]=e)}Li[3]=46,e(0,0),e(1,0),e(2,0),e(3,0),e(4,0),e(5,0),e(6,0),e(7,0),e(8,0),e(9,0),e(46,3),e(47,9),e(48,1),e(49,2),e(50,10),e(63,8),e(64,59),e(65,60),e(66,61),e(67,62),e(68,63),e(69,64),e(70,65),e(71,66),e(72,67),e(73,68),e(74,69),e(75,70),e(76,0),e(77,79),e(78,7),e(79,19),e(80,14),e(81,11),e(82,20),e(83,13),e(84,12),e(85,17),e(86,15),e(87,18),e(88,16),e(89,78),e(90,108),e(91,103),e(92,106),e(93,104),e(94,3),e(95,94),e(96,95),e(97,96),e(98,97),e(99,98),e(100,99),e(101,100),e(102,101),e(103,102),e(104,93),e(105,107),e(107,58),e(108,0),e(109,0),e(110,71),e(111,72),e(112,73),e(113,74),e(114,75),e(115,76),e(116,77),e(117,0),e(118,0),e(119,0),e(120,0),e(121,0),e(122,0),e(123,0),e(124,0),e(125,0),e(126,0),e(127,0),e(128,0),e(129,0),e(130,0),e(131,0),e(132,0),e(133,0),e(134,105),e(136,0),e(138,0),e(139,0),e(140,0),e(141,0),e(142,0),e(143,0),e(144,0),e(145,0),e(146,0),e(147,0),e(148,0),e(149,0),e(150,0),e(151,0),e(152,0),e(153,0),e(154,0),e(155,0),e(156,0),e(157,5),e(158,4),e(159,6),e(160,57),e(161,5),e(162,4),e(163,6),e(164,57),e(165,0),e(166,0),e(167,0),e(168,0),e(169,0),e(170,0),e(171,0),e(172,0),e(173,0),e(174,0),e(175,0),e(176,0),e(177,0),e(178,0),e(179,0),e(180,0),e(181,0),e(182,0),e(183,0),e(184,0),e(185,0),e(186,0),e(187,0),e(188,0),e(189,0),e(190,0),e(191,0),e(192,0)}();Object.create(null);var Ui,Ni;(Ni=Ui||(Ui={}))[Ni.TEXT=0]="TEXT",Ni[Ni.VARIABLE=1]="VARIABLE",Ni[Ni.SEPARATOR=2]="SEPARATOR";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function ji(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}class Bi{constructor(e){this.nodes=e}toString(){return this.nodes.map((e=>"string"==typeof e?e:e.label)).join("")}}ji([pr],Bi.prototype,"toString",null);var Fi,Ki;(Ki=Fi||(Fi={}))[Ki.Uri=1]="Uri",Ki[Ki.Regexp=2]="Regexp",Ki[Ki.ScmResource=3]="ScmResource",Ki[Ki.ScmResourceGroup=4]="ScmResourceGroup",Ki[Ki.ScmProvider=5]="ScmProvider",Ki[Ki.CommentController=6]="CommentController",Ki[Ki.CommentThread=7]="CommentThread",Ki[Ki.CommentThreadReply=8]="CommentThreadReply",Ki[Ki.CommentNode=9]="CommentNode",Ki[Ki.CommentThreadNode=10]="CommentThreadNode",Ki[Ki.TimelineActionContext=11]="TimelineActionContext",Ki[Ki.NotebookCellActionContext=12]="NotebookCellActionContext",Ki[Ki.TestItemContext=13]="TestItemContext";var qi,$i;($i=qi||(qi={})).text="text/plain",$i.binary="application/octet-stream",$i.unknown="application/unknown",$i.markdown="text/markdown";new Cr(1e4);const Wi=new Cr(1e4);function Vi(e){return Gi(e,"NFD",Wi)}const Hi=/[^\u0000-\u0080]/;function Gi(e,t,r){if(!e)return e;const i=r.get(e);if(i)return i;let n;return Hi.test(e)?e.normalize(t):e,r.set(e,n),n}!function(){const e=/[\u0300-\u036f]/g}();var zi,Yi;(Yi=zi||(zi={}))[Yi.OK=0]="OK",Yi[Yi.Info=1]="Info",Yi[Yi.Warning=2]="Warning",Yi[Yi.Error=3]="Error",Yi[Yi.Fatal=4]="Fatal";var Ji,Zi,Qi,Xi;(Zi=Ji||(Ji={}))[Zi.stdout=0]="stdout",Zi[Zi.stderr=1]="stderr",(Xi=Qi||(Qi={}))[Xi.Success=0]="Success",Xi[Xi.Unknown=1]="Unknown",Xi[Xi.AccessDenied=2]="AccessDenied",Xi[Xi.ProcessNotFound=3]="ProcessNotFound";var en;!function(e){function t(e,t){if(e.start>=t.end||t.start>=e.end)return{start:0,end:0};const r=Math.max(e.start,t.start),i=Math.min(e.end,t.end);return i-r<=0?{start:0,end:0}:{start:r,end:i}}function r(e){return e.end-e.start<=0}e.intersect=t,e.isEmpty=r,e.intersects=function(e,i){return!r(t(e,i))},e.relativeComplement=function(e,t){const i=[],n={start:e.start,end:Math.min(t.start,e.end)},o={start:Math.max(t.end,e.start),end:e.end};return r(n)||i.push(n),r(o)||i.push(o),i}}(en||(en={}));class tn{constructor(e,t,r,i,n){this.uri=e,this.relativePath=t,this.context=r,this.element=i,this.parent=n,this._children=new Map}get childrenCount(){return this._children.size}get children(){return this._children.values()}get name(){return ht.basename(this.relativePath)}get(e){return this._children.get(e)}set(e,t){this._children.set(e,t)}delete(e){this._children.delete(e)}clear(){this._children.clear()}}ji([pr],tn.prototype,"name",null);var rn,nn;(nn=rn||(rn={}))[nn.Auto=1]="Auto",nn[nn.Hidden=2]="Hidden",nn[nn.Visible=3]="Visible";var on,sn;(sn=on||(on={}))[sn.Ignore=0]="Ignore",sn[sn.Info=1]="Info",sn[sn.Warning=2]="Warning",sn[sn.Error=3]="Error",function(e){const t="error",r="warning",i="warn",n="info",o="ignore";e.fromValue=function(o){return o?De(t,o)?e.Error:De(r,o)||De(i,o)?e.Warning:De(n,o)?e.Info:e.Ignore:e.Ignore},e.toString=function(i){switch(i){case e.Error:return t;case e.Warning:return r;case e.Info:return n;default:return o}}}(on||(on={}));class an{constructor(e,t=65536){this.comparator=e,this[$bf4b3cef373f087d$var$_a]="SkipList",this._level=0,this._size=0,this._maxLevel=Math.max(1,0|Math.log2(t)),this._header=new $bf4b3cef373f087d$var$Node(this._maxLevel,$bf4b3cef373f087d$var$NIL,$bf4b3cef373f087d$var$NIL)}get size(){return this._size}clear(){this._header=new $bf4b3cef373f087d$var$Node(this._maxLevel,$bf4b3cef373f087d$var$NIL,$bf4b3cef373f087d$var$NIL)}has(e){return Boolean(an._search(this,e,this.comparator))}get(e){var t;return null==an._search(this,e,this.comparator)?void 0:t.value}set(e,t){return an._insert(this,e,t,this.comparator)&&(this._size+=1),this}delete(e){const t=an._delete(this,e,this.comparator);return t&&(this._size-=1),t}forEach(e,t){let r=this._header.forward[0];for(;r;)e.call(t,r.value,r.key,this),r.forward[0]}[(Symbol.toStringTag,Symbol.iterator)](){return this.entries()}*entries(){let e=this._header.forward[0];for(;e;)yield[e.key,e.value],e.forward[0]}*keys(){let e=this._header.forward[0];for(;e;)yield e.key,e.forward[0]}*values(){let e=this._header.forward[0];for(;e;)yield e.value,e.forward[0]}toString(){let e="[SkipList]:",t=this._header.forward[0];for(;t;)`node(${t.key}, ${t.value}, lvl:${t.level})`,t.forward[0];return e}static _search(e,t,r){let i=e._header;for(let n=e._level-1;n>=0;n--)for(;i.forward[n]&&r(i.forward[n].key,t)<0;)i.forward[n];if(i.forward[0],i&&0===r(i.key,t))return i}static _insert(e,t,r,i){let n=[],o=e._header;for(let r=e._level-1;r>=0;r--){for(;o.forward[r]&&i(o.forward[r].key,t)<0;)o.forward[r];n[r]=o}if(o.forward[0],o&&0===i(o.key,t))return o.value=r,!1;{let i=an._randomLevel(e);if(i>e._level){for(let t=e._level;t<i;t++)n[t]=e._header;e._level=i}new $bf4b3cef373f087d$var$Node(i,t,r);for(let e=0;e<i;e++)o.forward[e]=n[e].forward[e],n[e].forward[e]=o;return!0}}static _randomLevel(e,t=.5){let r=1;for(;Math.random()<t&&r<e._maxLevel;)1;return r}static _delete(e,t,r){let i=[],n=e._header;for(let o=e._level-1;o>=0;o--){for(;n.forward[o]&&r(n.forward[o].key,t)<0;)n.forward[o];i[o]=n}if(n.forward[0],!n||0!==r(n.key,t))return!1;for(let t=0;t<e._level&&i[t].forward[t]===n;t++)i[t].forward[t]=n.forward[t];for(;e._level>0&&e._header.forward[e._level-1]===$bf4b3cef373f087d$var$NIL;)e._level-=1;return!0}}var cn,ln;(ln=cn||(cn={}))[ln.MAX_SAFE_SMALL_INTEGER=1073741824]="MAX_SAFE_SMALL_INTEGER",ln[ln.MIN_SAFE_SMALL_INTEGER=-1073741824]="MIN_SAFE_SMALL_INTEGER",ln[ln.MAX_UINT_8=255]="MAX_UINT_8",ln[ln.MAX_UINT_16=65535]="MAX_UINT_16",ln[ln.MAX_UINT_32=4294967295]="MAX_UINT_32",ln[ln.UNICODE_SUPPLEMENTARY_PLANE_BEGIN=65536]="UNICODE_SUPPLEMENTARY_PLANE_BEGIN";new class{transformIncoming(e){return e}transformOutgoing(e){return e}transformOutgoingURI(e){return e}transformOutgoingScheme(e){return e}};new Uint8Array(16);const un=[];for(let e=0;e<256;e++)un.push(e.toString(16).padStart(2,"0"));let hn;hn="object"==typeof crypto&&"function"==typeof crypto.getRandomValues?crypto.getRandomValues.bind(crypto):function(e){for(let t=0;t<e.length;t++)e[t]=Math.floor(256*Math.random());return e}})),i.register("1nB6h",(function(e,t){for(var r=/[\\\"\x00-\x1F]/g,i={},n=0;n<32;++n)i[String.fromCharCode(n)]="\\U"+("0000"+n.toString(16)).slice(-4).toUpperCase();function o(e){return r.lastIndex=0,e.replace(r,(function(e){return i[e]}))}function s(e){switch(typeof e){case"string":return'"'+o(e)+'"';case"number":return isFinite(e)?e:"null";case"boolean":return e;case"object":return null===e?"null":Array.isArray(e)?function(e){for(var t="[",r="",i=0;i<e.length;++i)r+=t,t=",",r+=s(e[i]);return","!=t?"[]":r+"]"}(e):function(e){var t="{",r="",i=Object.keys(e);i.sort();for(var n=0;n<i.length;++n){var a=i[n];r+=t+'"'+o(a)+'":',t=",",r+=s(e[a])}return","!=t?"{}":r+"}"}(e);default:throw new Error("Cannot stringify: "+typeof e)}}i["\b"]="\\b",i["\t"]="\\t",i["\n"]="\\n",i["\f"]="\\f",i["\r"]="\\r",i['"']='\\"',i["\\"]="\\\\",e.exports={stringify:s}})),i.register("fT4bc",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0});var n={};e.exports.default=void 0;var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("3a1NA"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}if(Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))})),r.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");let a;r.__js_sdk_entrypoint=!0;try{a=r.indexedDB}catch(e){}a&&o.setCryptoStoreFactory((()=>new o.IndexedDBCryptoStore(a,"matrix-js-sdk:crypto")));var c=o;e.exports.default=c,r.matrixcs=o})),i.register("3a1NA",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0});var n={setCryptoStoreFactory:!0,createClient:!0,createRoomWidgetClient:!0,ContentHelpers:!0,createNewMatrixCall:!0,GroupCallEvent:!0,GroupCallIntent:!0,GroupCallState:!0,GroupCallType:!0};e.exports.ContentHelpers=void 0,Object.defineProperty(e.exports,"GroupCallEvent",{enumerable:!0,get:function(){return j.GroupCallEvent}}),Object.defineProperty(e.exports,"GroupCallIntent",{enumerable:!0,get:function(){return j.GroupCallIntent}}),Object.defineProperty(e.exports,"GroupCallState",{enumerable:!0,get:function(){return j.GroupCallState}}),Object.defineProperty(e.exports,"GroupCallType",{enumerable:!0,get:function(){return j.GroupCallType}}),e.exports.createClient=function(e){return new c.MatrixClient(K(e))},Object.defineProperty(e.exports,"createNewMatrixCall",{enumerable:!0,get:function(){return N.createNewMatrixCall}}),e.exports.createRoomWidgetClient=function(e,t,r,i){return new l.RoomWidgetClient(e,t,r,K(i))},e.exports.setCryptoStoreFactory=function(e){F=e};var o=i("8WTLW");Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))}));var s=i("fzuFx");Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===s[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return s[t]}}))}));var a=i("laezH");Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))}));var c=i("5pxqF");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var l=i("1SWS1");Object.keys(l).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===l[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return l[t]}}))}));var u=i("cH9or");Object.keys(u).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===u[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return u[t]}}))}));var h=i("fIT1M");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var d=i("7Ac1Y");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=i("dsM0i");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var p=i("6cjco");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var m=i("7BSj1");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var g=i("846Vo");Object.keys(g).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===g[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return g[t]}}))}));var v=i("jxKcy");Object.keys(v).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===v[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return v[t]}}))}));var y=i("d1gZy");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=i("3yMwy");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var w=i("6koSf");Object.keys(w).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===w[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return w[t]}}))}));var _=i("l2mJP");Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var S=i("fLhqT");Object.keys(S).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===S[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return S[t]}}))}));var E=i("l2QFk");Object.keys(E).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===E[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return E[t]}}))}));var M=i("6zVPc");Object.keys(M).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===M[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return M[t]}}))}));var C=i("7ZHER");Object.keys(C).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===C[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return C[t]}}))}));var I=i("8Sn18");Object.keys(I).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===I[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return I[t]}}))}));var T=i("27kVK");Object.keys(T).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===T[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return T[t]}}))}));var k=i("gH6iW");Object.keys(k).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===k[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return k[t]}}))}));var R=i("juNaO");Object.keys(R).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===R[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return R[t]}}))}));var x=i("ldT3p");Object.keys(x).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===x[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return x[t]}}))}));var O=i("avVpE");Object.keys(O).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===O[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return O[t]}}))}));var A=i("8JM9X");Object.keys(A).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===A[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return A[t]}}))}));var P=i("aj0Or");Object.keys(P).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===P[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return P[t]}}))}));var D=i("2jZ2n");Object.keys(D).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===D[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return D[t]}}))}));var L=i("eOWig");Object.keys(L).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(n,t)||t in e.exports&&e.exports[t]===L[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return L[t]}}))}));var U=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=B(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("aVwsu"));e.exports.ContentHelpers=U;var N=i("7L16h"),j=i("hadDF");function B(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(B=function(e){return e?r:t})(e)}let F=()=>new o.MemoryCryptoStore;function K(e){var t,i,n;return e.store=null!==(t=e.store)&&void 0!==t?t:new s.MemoryStore({localStorage:r.localStorage}),e.scheduler=null!==(i=e.scheduler)&&void 0!==i?i:new a.MatrixScheduler,e.cryptoStore=null!==(n=e.cryptoStore)&&void 0!==n?n:F(),e}})),i.register("8WTLW",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MemoryCryptoStore=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.MemoryCryptoStore=class{constructor(){(0,n.default)(this,"outgoingRoomKeyRequests",[]),(0,n.default)(this,"account",null),(0,n.default)(this,"crossSigningKeys",null),(0,n.default)(this,"privateKeys",{}),(0,n.default)(this,"sessions",{}),(0,n.default)(this,"sessionProblems",{}),(0,n.default)(this,"notifiedErrorDevices",{}),(0,n.default)(this,"inboundGroupSessions",{}),(0,n.default)(this,"inboundGroupSessionsWithheld",{}),(0,n.default)(this,"deviceData",null),(0,n.default)(this,"rooms",{}),(0,n.default)(this,"sessionsNeedingBackup",{}),(0,n.default)(this,"sharedHistoryInboundGroupSessions",{}),(0,n.default)(this,"parkedSharedHistory",new Map)}async startup(){return this}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return s.promiseTry((()=>{const r=this._getOutgoingRoomKeyRequest(t);return r?(o.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),r):(o.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this.outgoingRoomKeyRequests.push(e),e)}))}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this.outgoingRoomKeyRequests)if(s.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this.outgoingRoomKeyRequests)for(const r of e)if(t.state===r)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter((t=>t.state==e)))}getOutgoingRoomKeyRequestsByTarget(e,t,r){const i=[];for(const n of this.outgoingRoomKeyRequests)for(const o of r)n.state===o&&n.recipients.some((r=>r.userId===e&&r.deviceId===t))&&i.push(n);return Promise.resolve(i)}updateOutgoingRoomKeyRequest(e,t,r){for(const i of this.outgoingRoomKeyRequests)if(i.requestId===e)return i.state!==t?(o.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${i.state}`),Promise.resolve(null)):(Object.assign(i,r),Promise.resolve(i));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let r=0;r<this.outgoingRoomKeyRequests.length;r++){const i=this.outgoingRoomKeyRequests[r];if(i.requestId===e)return i.state!=t?(o.logger.warn(`Cannot delete room key request in state ${i.state} (expected ${t})`),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(r,1),Promise.resolve(i))}return Promise.resolve(null)}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,r){t(this.privateKeys[r]||null)}storeCrossSigningKeys(e,t){this.crossSigningKeys=t}storeSecretStorePrivateKey(e,t,r){this.privateKeys[t]=r}countEndToEndSessions(e,t){t(Object.keys(this.sessions).length)}getEndToEndSession(e,t,r,i){i((this.sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,r){r(this.sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this.sessions).forEach((([e,r])=>{Object.entries(r).forEach((([r,i])=>{t(l(l({},i),{},{deviceKey:e,sessionId:r}))}))}))}storeEndToEndSession(e,t,r,i){let n=this.sessions[e];void 0===n&&(n={},this.sessions[e]=n),n[t]=r}async storeEndToEndSessionProblem(e,t,r){const i=this.sessionProblems[e]=this.sessionProblems[e]||[];i.push({type:t,fixed:r,time:Date.now()}),i.sort(((e,t)=>e.time-t.time))}async getEndToEndSessionProblem(e,t){const r=this.sessionProblems[e]||[];if(!r.length)return null;const i=r[r.length-1];for(const e of r)if(e.time>t)return Object.assign({},e,{fixed:i.fixed});return i.fixed?null:i}async filterOutNotifiedErrorDevices(e){const t=this.notifiedErrorDevices,r=[];for(const i of e){const{userId:e,deviceInfo:n}=i;e in t?n.deviceId in t[e]||(r.push(i),t[e][n.deviceId]=!0):(r.push(i),t[e]={[n.deviceId]:!0})}return r}getEndToEndInboundGroupSession(e,t,r,i){const n=e+"/"+t;i(this.inboundGroupSessions[n]||null,this.inboundGroupSessionsWithheld[n]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this.inboundGroupSessions))t({senderKey:e.slice(0,43),sessionId:e.slice(44),sessionData:this.inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,r,i){const n=e+"/"+t;void 0===this.inboundGroupSessions[n]&&(this.inboundGroupSessions[n]=r)}storeEndToEndInboundGroupSession(e,t,r,i){this.inboundGroupSessions[e+"/"+t]=r}storeEndToEndInboundGroupSessionWithheld(e,t,r,i){const n=e+"/"+t;this.inboundGroupSessionsWithheld[n]=r}getEndToEndDeviceData(e,t){t(this.deviceData)}storeEndToEndDeviceData(e,t){this.deviceData=e}storeEndToEndRoom(e,t,r){this.rooms[e]=t}getEndToEndRooms(e,t){t(this.rooms)}getSessionsNeedingBackup(e){const t=[];for(const r in this.sessionsNeedingBackup)if(this.inboundGroupSessions[r]&&(t.push({senderKey:r.slice(0,43),sessionId:r.slice(44),sessionData:this.inboundGroupSessions[r]}),e&&r.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this.sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this.sessionsNeedingBackup[e]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,r){const i=this.sharedHistoryInboundGroupSessions[e]||[];i.push([t,r]),this.sharedHistoryInboundGroupSessions[e]=i}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}addParkedSharedHistory(e,t){var r;const i=null!==(r=this.parkedSharedHistory.get(e))&&void 0!==r?r:[];i.push(t),this.parkedSharedHistory.set(e,i)}takeParkedSharedHistory(e){var t;const r=null!==(t=this.parkedSharedHistory.get(e))&&void 0!==t?t:[];return this.parkedSharedHistory.delete(e),Promise.resolve(r)}doTxn(e,t,r){return Promise.resolve(r(null))}}})),i.register("lHCw5",(function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("3EUCw",(function(e,t){var r=i("3Onxw");e.exports=function(e,t,i){return(t=r(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("3Onxw",(function(e,t){var r=i("agEcb").default,n=i("9LgqJ");e.exports=function(e){var t=n(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("agEcb",(function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("9LgqJ",(function(e,t){var r=i("agEcb").default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("gEWrD",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.logger=void 0;var n=r(i("34w0R"));const o="matrix";n.default.methodFactory=function(e,t,r){return function(...t){this.prefix&&t.unshift(this.prefix);return"error"===e||"warn"===e||"trace"===e||"info"===e?console[e](...t):console.log(...t)}};const s=n.default.getLogger(o);function a(e){e.withPrefix=function(e){return function(e){const t=n.default.getLogger(`${o}-${e}`);t.prefix!==e&&(a(t),t.prefix=e,t.setLevel(n.default.levels.DEBUG,!1));return t}((this.prefix||"")+e)}}e.exports.logger=s,s.setLevel(n.default.levels.DEBUG,!1),a(s)})),i.register("34w0R",(function(e,t){var r,i;r=e.exports,i=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function n(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(t,r){for(var n=0;n<i.length;n++){var o=i[n];this[o]=n<t?e:this.methodFactory(o,t,r)}this.log=this.debug}function a(e,r,i){return function(){typeof console!==t&&(s.call(this,r,i),this[e].apply(this,arguments))}}function c(i,s,c){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&r?o:void 0!==console[i]?n(console,i):void 0!==console.log?n(console,"log"):e)}(i)||a.apply(this,arguments)}function l(e,r,n){var o,a=this;r=null==r?"WARN":r;var l="loglevel";function u(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,i=r.indexOf(encodeURIComponent(l)+"=");-1!==i&&(e=/^([^;]+)/.exec(r.slice(i))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=n||c,a.getLevel=function(){return o},a.setLevel=function(r,n){if("string"==typeof r&&void 0!==a.levels[r.toUpperCase()]&&(r=a.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(o=r,!1!==n&&function(e){var r=(i[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+r+";"}catch(e){}}}(r),s.call(a,r,e),typeof console===t&&r<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){r=e,u()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(r,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var h=u();null==h&&(h=r),a.setLevel(h,!1)}var u=new l,h={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new l(e,u.getLevel(),u.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=d),u},u.getLoggers=function(){return h},u.default=u,u},"function"==typeof define&&define.amd?define(i):e.exports?e.exports=i():r.log=i()})),i.register("gjhRv",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DEFAULT_ALPHABET=void 0,e.exports.alphabetPad=g,e.exports.averageBetweenStrings=function(e,t,r=m){const i=Math.max(e.length,t.length),n=y(g(e,i,r),r),o=y(g(t,i,r),r),s=(n+o)/BigInt(2);return s===n||s==o?v(s,r)+r[0]:v(s,r)},e.exports.baseToString=v,e.exports.checkObjectHasKeys=function(e,t){for(const r of t)if(!e.hasOwnProperty(r))throw new Error("Missing required key: "+r)},e.exports.chunkPromises=async function(e,t){const r=[];for(let i=0;i<e.length;i+=t)r.push(...await Promise.all(e.slice(i,i+t).map((e=>e()))));return r},e.exports.compare=function(e,t){return w.compare(e,t)},e.exports.decodeParams=function(e){const t={},r=new URLSearchParams(e);for(const e of r.keys()){const i=r.getAll(e);t[e]=1===i.length?i[0]:i}return t},e.exports.deepCompare=function e(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if("number"==typeof t&&isNaN(t)&&isNaN(r))return!0;if(null===t||null===r)return t===r;if(!(t instanceof Object))return!1;if(t.constructor!==r.constructor||t.prototype!==r.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===r.toString();if(Array.isArray(t)){if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1}else{for(const e in r)if(r.hasOwnProperty(e)!==t.hasOwnProperty(e))return!1;for(const i in t)if(r.hasOwnProperty(i)!==t.hasOwnProperty(i)||!e(t[i],r[i]))return!1}return!0},e.exports.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},e.exports.deepSortedObjectEntries=function e(t){if("object"!=typeof t)return t;if(null==t||Array.isArray(t))return t;const r=[];for(const[i,n]of Object.entries(t))r.push([i,e(n)]);return r.sort(((e,t)=>b(e[0],t[0]))),r},e.exports.defer=function(){let e,t;const r=new Promise(((r,i)=>{e=r,t=i}));return{resolve:e,reject:t,promise:r}},e.exports.encodeParams=function(e,t){const r=null!=t?t:new URLSearchParams;for(const[t,i]of Object.entries(e))null!=i&&(Array.isArray(i)?i.forEach((e=>{r.append(t,String(e))})):r.append(t,String(i)));return r},e.exports.encodeUri=function(e,t){for(const r in t){if(!t.hasOwnProperty(r))continue;const i=t[r];null!=i&&(e=e.replace(r,encodeURIComponent(i)))}return e},e.exports.ensureNoTrailingSlash=function(e){return null!=e&&e.endsWith("/")?e.slice(0,-1):e},e.exports.escapeRegExp=p,e.exports.globToRegexp=function(e,t=!1){const r=[[/\\\*/g,".*"],[/\?/g,"."]];t||r.push([/\\\[(!|)(.*)\\]/g,(e,t,r)=>["[",t?"^":"",r.replace(/\\-/,"-"),"]"].join("")]);return r.reduce(((e,t)=>t?e.replace(t[0],t[1]):e),p(e))},e.exports.immediate=function(){return new Promise(setImmediate)},e.exports.internaliseString=function(e){e instanceof String&&(e=e.toString());h.has(e)||h.set(e,e);return h.get(e)},e.exports.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},e.exports.isNullOrUndefined=function(e){return null==e},e.exports.isNumber=function(e){return"number"==typeof e&&isFinite(e)},e.exports.isSupportedReceiptType=function(e){return[c.ReceiptType.Read,c.ReceiptType.ReadPrivate].includes(e)},e.exports.lexicographicCompare=b,e.exports.mapsEqual=function(e,t,r=((e,t)=>e===t)){if(e.size!==t.size)return!1;for(const[i,n]of e){const e=t.get(i);if(void 0===e||!r(n,e))return!1}return!0},e.exports.nextString=function(e,t=m){return v(y(e,t)+BigInt(1),t)},e.exports.normalize=function(e){return d(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()},e.exports.prevString=function(e,t=m){return v(y(e,t)-BigInt(1),t)},e.exports.promiseMapSeries=async function(e,t){for(const r of e)await t(await r)},e.exports.promiseTry=function(e){return Promise.resolve(e())},e.exports.recursivelyAssign=function e(t,r,i=!1){for(const[n,o]of Object.entries(r))t[n]instanceof Object&&o?e(t[n],o):null==o&&i||(t[n]=o);return t},e.exports.removeDirectionOverrideChars=function(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""},e.exports.removeElement=function(e,t,r){let i;if(r){for(i=e.length-1;i>=0;i--)if(t(e[i],i,e))return e.splice(i,1),!0}else for(i=0;i<e.length;i++)if(t(e[i],i,e))return e.splice(i,1),!0;return!1},e.exports.removeHiddenChars=d,e.exports.replaceParam=function(e,t,r){const i=u(u({},r),{},{[t]:r[e]});return delete i[e],i},e.exports.simpleRetryOperation=function(e){return(0,s.default)((t=>e(t)),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},e.exports.sleep=function(e,t){return new Promise((r=>{setTimeout(r,e,t)}))},e.exports.sortEventsByLatestContentTimestamp=function(e,t){return _(t)-_(e)},e.exports.stringToBase=y;var n=r(i("3EUCw")),o=r(i("1B9Ch")),s=r(i("1q9CE")),a=i("1HWgt"),c=i("cXHgq");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const h=new Map;function d(e){return"string"==typeof e?(0,o.default)(e.normalize("NFD").replace(f,"")):""}const f=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const m=(()=>{let e="";for(let t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function g(e,t,r=m){return e.padEnd(t,r[0])}function v(e,t=m){const r=BigInt(t.length);var i;if(e<=r)return null!==(i=t[Number(e)-1])&&void 0!==i?i:"";let n=e/r,o=Number(e%r)-1;return o<0&&(n-=BigInt(Math.abs(o)),o=Number(r)-1),v(n,t)+t[o]}function y(e,t=m){const r=BigInt(t.length);let i=BigInt(0);for(let n=e.length-1,o=BigInt(0);n>=0;n--,o++){const s=e.charCodeAt(n)-t.charCodeAt(0);i+=BigInt(1+s)*r**o}return i}function b(e,t){return e<t?-1:e>t?1:0}e.exports.DEFAULT_ALPHABET=m;const w=new Intl.Collator;function _(e){var t;return null!==(t=a.M_TIMESTAMP.findIn(e.getContent()))&&void 0!==t?t:-1}})),i.register("1B9Ch",(function(e,t){var r=i("c1YLc");var n=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function o(e){return r[e]}e.exports=function(e){return e.replace(n,o)}})),i.register("c1YLc",(function(e,t){e.exports=JSON.parse('{"0":"O","1":"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ","ﱞ":"ﹲّ","ࣲ":"ٍ","ﱟ":"ﹴّ","ﳲ":"ﹷّ","ﱠ":"ﹶّ","ﳳ":"ﹹّ","ﱡ":"ﹸّ","ؚ":"ِ","̗":"ِ","ﳴ":"ﹻّ","ﱢ":"ﹺّ","ﱣ":"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":","ː":":","ꓽ":":","⩴":"::=","⧴":":→","！":"!","ǃ":"!","ⵑ":"!","‼":"!!","⁉":"!?","ʔ":"?","Ɂ":"?","ॽ":"?","Ꭾ":"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·","ᐧ":"·","⋯":"···","ⵈ":"···","ᑄ":"·<","⋗":"·>","ᐷ":"·>","ᑀ":"·>","ᔯ":"·4","ᑾ":"·b","ᒀ":"·ḃ","ᑺ":"·d","ᒘ":"·J","ᒶ":"·L","ᑶ":"·P","ᑗ":"·U","ᐺ":"·V","ᐼ":"·Ʌ","ᒮ":"·Γ","ᐎ":"·Δ","ᑙ":"·Ո","ᐌ":"·ᐁ","ᐐ":"·ᐄ","ᐒ":"·ᐅ","ᐔ":"·ᐆ","ᐗ":"·ᐊ","ᐙ":"·ᐋ","ᐾ":"·ᐲ","ᑂ":"·ᐴ","ᑆ":"·ᐹ","ᑛ":"·ᑏ","ᑔ":"·ᑐ","ᑝ":"·ᑐ","ᑟ":"·ᑑ","ᑡ":"·ᑕ","ᑣ":"·ᑖ","ᑴ":"·ᑫ","ᑸ":"·ᑮ","ᑼ":"·ᑰ","ᒒ":"·ᒉ","ᒔ":"·ᒋ","ᒖ":"·ᒌ","ᒚ":"·ᒎ","ᒜ":"·ᒐ","ᒞ":"·ᒑ","ᒬ":"·ᒣ","ᒰ":"·ᒦ","ᒲ":"·ᒧ","ᒴ":"·ᒨ","ᒸ":"·ᒫ","ᓉ":"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ","ᓋ":"·ᓇ","ᓍ":"·ᓈ","ᓜ":"·ᓓ","ᓞ":"·ᓕ","ᓠ":"·ᓖ","ᓢ":"·ᓗ","ᓤ":"·ᓘ","ᓦ":"·ᓚ","ᓨ":"·ᓛ","ᓶ":"·ᓭ","ᓸ":"·ᓯ","ᓺ":"·ᓰ","ᓼ":"·ᓱ","ᓾ":"·ᓲ","ᔀ":"·ᓴ","ᔂ":"·ᓵ","ᔗ":"·ᔐ","ᔙ":"·ᔑ","ᔛ":"·ᔒ","ᔝ":"·ᔓ","ᔟ":"·ᔔ","ᔡ":"·ᔕ","ᔣ":"·ᔖ","ᔱ":"·ᔨ","ᔳ":"·ᔩ","ᔵ":"·ᔪ","ᔷ":"·ᔫ","ᔹ":"·ᔭ","ᔻ":"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ","ᕎ":"·ᕌ","ᕛ":"·ᕚ","ᕨ":"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"\'","＇":"\'","‘":"\'","’":"\'","‛":"\'","′":"\'","‵":"\'","՚":"\'","׳":"\'","`":"\'","`":"\'","｀":"\'","´":"\'","΄":"\'","´":"\'","᾽":"\'","᾿":"\'","῾":"\'","ʹ":"\'","ʹ":"\'","ˈ":"\'","ˊ":"\'","ˋ":"\'","˴":"\'","ʻ":"\'","ʽ":"\'","ʼ":"\'","ʾ":"\'","ꞌ":"\'","י":"\'","ߴ":"\'","ߵ":"\'","ᑊ":"\'","ᛌ":"\'","𖽑":"\'","𖽒":"\'","᳓":"\'\'","\\"":"\'\'","＂":"\'\'","“":"\'\'","”":"\'\'","‟":"\'\'","″":"\'\'","‶":"\'\'","〃":"\'\'","״":"\'\'","˝":"\'\'","ʺ":"\'\'","˶":"\'\'","ˮ":"\'\'","ײ":"\'\'","‴":"\'\'\'","‷":"\'\'\'","⁗":"\'\'\'\'","Ɓ":"\'B","Ɗ":"\'D","ŉ":"\'n","Ƥ":"\'P","Ƭ":"\'T","Ƴ":"\'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬","く":"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/","〳":"/","Ⳇ":"/","ノ":"/","丿":"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\\\","﹨":"\\\\","∖":"\\\\","⟍":"\\\\","⧵":"\\\\","⧹":"\\\\","𝈏":"\\\\","𝈻":"\\\\","㇔":"\\\\","丶":"\\\\","⼂":"\\\\","⳹":"\\\\\\\\","⑊":"\\\\\\\\","⟈":"\\\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ","ъ":"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵","ð":"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<","ᐸ":"<","ᚲ":"<","⋖":"<·","Ⲵ":"<·","ᑅ":"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">","ᐳ":">","𖼿":">","ᑁ":">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー","ᅳ":"ー","ㅡ":"ー","一":"ー","⼀":"ー","ᆖ":"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ","ᆕ":"ーᅮ","ᅴ":"ー丨","ㅢ":"ー丨","ᆗ":"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2","Ƨ":"2","Ϩ":"2","Ꙅ":"2","ᒿ":"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁","ƻ":"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3","Ȝ":"3","Ʒ":"3","Ꝫ":"3","Ⳍ":"3","З":"3","Ӡ":"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂","Ҙ":"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4","Ꮞ":"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.","ᔰ":"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5","Ƽ":"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6","б":"6","Ꮾ":"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8","ȣ":"8","Ȣ":"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a","ａ":"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a","ɑ":"a","α":"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a","а":"a","ⷶ":"ͣ","Ａ":"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A","Α":"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A","А":"A","Ꭺ":"A","ᗅ":"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲","ǎ":"ă","Ǎ":"Ă","ȧ":"å","Ȧ":"Å","ẚ":"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA","æ":"ae","ӕ":"ae","Æ":"AE","Ӕ":"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ","ᗄ":"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b","Ƅ":"b","Ь":"b","Ꮟ":"b","ᑲ":"b","ᖯ":"b","Ｂ":"B","ℬ":"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B","Β":"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B","В":"B","Ᏼ":"B","ᗷ":"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B","ɓ":"b̔","ᑳ":"ḃ","ƃ":"b̄","Ƃ":"b̄","Б":"b̄","ƀ":"b̵","ҍ":"b̵","Ҍ":"b̵","ѣ":"b̵","Ѣ":"b̵","ᑿ":"b·","ᒁ":"ḃ·","ᒈ":"b\'","Ы":"bl","в":"ʙ","ᏼ":"ʙ","ｃ":"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c","ϲ":"c","ⲥ":"c","с":"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C","Ｃ":"C","Ⅽ":"C","ℂ":"C","ℭ":"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C","С":"C","Ꮯ":"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠","ç":"c̦","ҫ":"c̦","Ç":"C̦","Ҫ":"C̦","Ƈ":"C\'","℅":"c/o","℆":"c/u","🅭":"㏄\\t⃝","⋴":"ꞓ","ɛ":"ꞓ","ε":"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ","є":"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ","Є":"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d","Ꮷ":"d","ᑯ":"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D","Ꭰ":"D","ᗞ":"D","ᗪ":"D","ꓓ":"D","ɗ":"d̔","ɖ":"d̨","ƌ":"d̄","đ":"d̵","Đ":"D̵","Ð":"D̵","Ɖ":"D̵","₫":"ḏ̵","ꝺ":"Ꝺ","ᑻ":"d·","ᒇ":"d\'","ʤ":"dȝ","ǳ":"dz","ʣ":"dz","ǲ":"Dz","Ǳ":"DZ","ǆ":"dž","ǅ":"Dž","Ǆ":"DŽ","ʥ":"dʑ","ꭰ":"ᴅ","⸹":"ẟ","δ":"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ","ծ":"ẟ","ᕷ":"ẟ","℮":"e","ｅ":"e","ℯ":"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e","е":"e","ҽ":"e","ⷷ":"ͤ","⋿":"E","Ｅ":"E","ℰ":"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E","Ε":"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E","Е":"E","ⴹ":"E","Ꭼ":"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E","ě":"ĕ","Ě":"Ĕ","ɇ":"e̸","Ɇ":"E̸","ҿ":"ę","ꭼ":"ᴇ","ə":"ǝ","ә":"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ","ɚ":"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵","Ә":"Ə","𝈡":"Ɛ","ℇ":"Ɛ","Ԑ":"Ɛ","Ꮛ":"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ","з":"ɜ","ҙ":"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f","ſ":"f","ẝ":"f","ք":"f","𝈓":"F","ℱ":"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F","Ϝ":"F","𝟊":"F","ᖴ":"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F","ƒ":"f̦","Ƒ":"F̦","ᵮ":"f̴","℻":"FAX","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ʩ":"fŋ","ᖵ":"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ","ᖷ":"ꟻ","ｇ":"g","ℊ":"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g","ɡ":"g","ᶃ":"g","ƍ":"g","ց":"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G","Ꮐ":"G","Ᏻ":"G","ꓖ":"G","ᶢ":"ᵍ","ɠ":"g̔","ǧ":"ğ","Ǧ":"Ğ","ǵ":"ģ","ǥ":"g̵","Ǥ":"G̵","Ɠ":"G\'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ","ｈ":"h","ℎ":"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h","һ":"h","հ":"h","Ꮒ":"h","Ｈ":"H","ℋ":"H","ℌ":"H","ℍ":"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H","Η":"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H","Н":"H","Ꮋ":"H","ᕼ":"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ","ɦ":"h̔","ꚕ":"h̔","Ᏺ":"h̔","Ⱨ":"H̩","Ң":"H̩","ħ":"h̵","ℏ":"h̵","ћ":"h̵","Ħ":"H̵","Ӊ":"H̦","Ӈ":"H̦","н":"ʜ","ꮋ":"ʜ","ң":"ʜ̩","ӊ":"ʜ̦","ӈ":"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ","Ꭸ":"Ⱶ","Ꮀ":"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i","ｉ":"i","ⅰ":"i","ℹ":"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i","ı":"i","𝚤":"i","ɪ":"i","ɩ":"i","ι":"i","ι":"i","ͺ":"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i","і":"i","ꙇ":"i","ӏ":"i","ꭵ":"i","Ꭵ":"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲","ǐ":"ĭ","Ǐ":"Ĭ","ɨ":"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii","ĳ":"ij","ⅳ":"iv","ⅸ":"ix","ｊ":"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j","ϳ":"j","ј":"j","Ｊ":"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J","Ј":"J","Ꭻ":"J","ᒍ":"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵","ᒙ":"J·","𝚥":"ȷ","յ":"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k","K":"K","Ｋ":"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K","Κ":"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K","К":"K","Ꮶ":"K","ᛕ":"K","ꓗ":"K","𐔘":"K","ƙ":"k̔","Ⱪ":"K̩","Қ":"K̩","₭":"K̵","Ꝁ":"K̵","Ҟ":"K̵","Ƙ":"K\'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l","I":"l","Ｉ":"l","Ⅰ":"l","ℐ":"l","ℑ":"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l","Ɩ":"l","ｌ":"l","ⅼ":"l","ℓ":"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l","ǀ":"l","Ι":"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l","І":"l","Ӏ":"l","ו":"l","ן":"l","ا":"l","𞸀":"l","𞺀":"l","ﺎ":"l","ﺍ":"l","ߊ":"l","ⵏ":"l","ᛁ":"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L","ℒ":"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L","Ꮮ":"L","ᒪ":"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L","ﴼ":"l̋","ﴽ":"l̋","ł":"l̸","Ł":"L̸","ɭ":"l̨","Ɨ":"l̵","ƚ":"l̵","ɫ":"l̴","إ":"lٕ","ﺈ":"lٕ","ﺇ":"lٕ","ٳ":"lٕ","ŀ":"l·","Ŀ":"l·","ᒷ":"l·","🄂":"l,","⒈":"l.","ױ":"l\'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点","ǉ":"lj","Ĳ":"lJ","ǈ":"Lj","Ǉ":"LJ","‖":"ll","∥":"ll","Ⅱ":"ll","ǁ":"ll","װ":"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点","Ю":"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点","ʪ":"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX","ɮ":"lȝ","ʫ":"lz","أ":"lٴ","ﺄ":"lٴ","ﺃ":"lٴ","ٲ":"lٴ","ٵ":"lٴ","ﷳ":"lكبر","ﷲ":"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ","Ｍ":"M","Ⅿ":"M","ℳ":"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M","Μ":"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M","М":"M","Ꮇ":"M","ᗰ":"M","ᛖ":"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n","ո":"n","ռ":"n","Ｎ":"N","ℕ":"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N","Ν":"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊","ɳ":"n̨","ƞ":"n̩","η":"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩","Ɲ":"N̦","ᵰ":"n̴","ǌ":"nj","ǋ":"Nj","Ǌ":"NJ","№":"No","ͷ":"ᴎ","и":"ᴎ","𐑍":"ᴎ","ņ":"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o","ｏ":"o","ℴ":"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o","ο":"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o","σ":"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o","о":"o","ჿ":"o","օ":"o","ס":"o","ه":"o","𞸤":"o","𞹤":"o","𞺄":"o","ﻫ":"o","ﻬ":"o","ﻪ":"o","ﻩ":"o","ھ":"o","ﮬ":"o","ﮭ":"o","ﮫ":"o","ﮪ":"o","ہ":"o","ﮨ":"o","ﮩ":"o","ﮧ":"o","ﮦ":"o","ە":"o","ഠ":"o","ဝ":"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O","Ｏ":"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O","Ο":"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O","О":"O","Օ":"O","ⵔ":"O","ዐ":"O","ଠ":"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º","ǒ":"ŏ","Ǒ":"Ŏ","ۿ":"ô","Ő":"Ö","ø":"o̸","ꬾ":"o̸","Ø":"O̸","ⵁ":"O̸","Ǿ":"Ó̸","ɵ":"o̵","ꝋ":"o̵","ө":"o̵","ѳ":"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵","Ɵ":"O̵","Ꝋ":"O̵","θ":"O̵","ϑ":"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵","Θ":"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵","Ө":"O̵","Ѳ":"O̵","ⴱ":"O̵","Ꮎ":"O̵","Ꮻ":"O̵","ꭴ":"ơ","ﳙ":"oٰ","🄁":"O,","🄀":"O.","ơ":"o\'","Ơ":"O\'","Ꭴ":"O\'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀","œ":"oe","Œ":"OE","ɶ":"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO","ﳗ":"oج","ﱑ":"oج","ﳘ":"oم","ﱒ":"oم","ﶓ":"oمج","ﶔ":"oمم","ﱓ":"oى","ﱔ":"oى","ൟ":"oരo","တ":"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p","ｐ":"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p","ρ":"p","ϱ":"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p","р":"p","Ｐ":"P","ℙ":"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P","Ρ":"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P","Р":"P","Ꮲ":"P","ᑭ":"P","ꓑ":"P","𐊕":"P","ƥ":"p̔","ᵽ":"p̵","ᑷ":"p·","ᒆ":"P\'","ᴩ":"ᴘ","ꮲ":"ᴘ","φ":"ɸ","ϕ":"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ","ф":"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q","գ":"q","զ":"q","ℚ":"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q","ʠ":"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ","κ":"ĸ","ϰ":"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ","к":"ĸ","ꮶ":"ĸ","қ":"ĸ̩","ҟ":"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r","г":"r","ꮁ":"r","𝈖":"R","ℛ":"R","ℜ":"R","ℝ":"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R","Ʀ":"R","Ꭱ":"R","Ꮢ":"R","𐒴":"R","ᖇ":"R","ꓣ":"R","𖼵":"R","ɽ":"r̨","ɼ":"r̩","ɍ":"r̵","ғ":"r̵","ᵲ":"r̴","ґ":"r\'","𑣣":"rn","m":"rn","ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸","ɱ":"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ","я":"ᴙ","ᵳ":"ɾ̴","℩":"ɿ","ｓ":"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s","ƽ":"s","ѕ":"s","ꮪ":"s","𑣁":"s","𐑈":"s","Ｓ":"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S","Ѕ":"S","Տ":"S","Ꮥ":"S","Ꮪ":"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S","ʂ":"s̨","ᵴ":"s̴","ꞵ":"ß","β":"ß","ϐ":"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß","Ᏸ":"ß","🝜":"sss","ﬆ":"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ","Σ":"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T","Ｔ":"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T","Τ":"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T","Т":"T","Ꭲ":"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T","ƭ":"t̔","⍡":"T̈","Ⱦ":"T̸","Ț":"Ţ","Ʈ":"T̨","Ҭ":"T̩","₮":"T⃫","ŧ":"t̵","Ŧ":"T̵","ᵵ":"t̴","Ⴀ":"Ꞇ","Ꜩ":"T3","ʨ":"tɕ","℡":"TEL","ꝷ":"tf","ʦ":"ts","ʧ":"tʃ","ꜩ":"tȝ","τ":"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ","т":"ᴛ","ꭲ":"ᴛ","ҭ":"ᴛ̩","ţ":"ƫ","ț":"ƫ","Ꮏ":"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u","ʋ":"u","υ":"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u","ս":"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U","Ս":"U","ሀ":"U","𐓎":"U","ᑌ":"U","ꓴ":"U","𖽂":"U","𑢸":"U","ǔ":"ŭ","Ǔ":"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵","Ꮜ":"U̵","ᑘ":"U·","ᑧ":"U\'","ᵫ":"ue","ꭣ":"uo","ṃ":"ꭑ","պ":"ɰ","ሣ":"ɰ","℧":"Ʊ","ᘮ":"Ʊ","ᘴ":"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v","ｖ":"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v","ν":"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v","ѵ":"v","ט":"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V","Ѵ":"V","ⴸ":"V","Ꮩ":"V","ᐯ":"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵","ᐻ":"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ","Λ":"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ","Л":"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ","ᐱ":"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦","ᐽ":"Ʌ·","ɯ":"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w","ѡ":"w","ԝ":"w","ա":"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W","Ꮃ":"W","Ꮤ":"W","ꓪ":"W","ѽ":"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ","м":"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x","ｘ":"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x","х":"x","ᕁ":"x","ᕽ":"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X","Ｘ":"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X","Χ":"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X","Х":"X","ⵝ":"X","ᚷ":"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ","Ҳ":"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll","ɣ":"y","ᶌ":"y","ｙ":"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y","ʏ":"y","ỿ":"y","ꭚ":"y","γ":"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y","у":"y","ү":"y","ყ":"y","𑣜":"y","Ｙ":"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y","Υ":"Y","ϒ":"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y","У":"Y","Ү":"Y","Ꭹ":"Y","Ꮍ":"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y","ƴ":"y̔","ɏ":"y̵","ұ":"y̵","¥":"Y̵","Ɏ":"Y̵","Ұ":"Y̵","ʒ":"ȝ","ꝫ":"ȝ","ⳍ":"ȝ","ӡ":"ȝ","ჳ":"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z","Ｚ":"Z","ℤ":"Z","ℨ":"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z","Ζ":"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z","Ꮓ":"Z","ꓜ":"Z","𑢩":"Z","ʐ":"z̨","ƶ":"z̵","Ƶ":"Z̵","ȥ":"z̦","Ȥ":"Z̦","ᵶ":"z̴","ƿ":"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ","ϩ":"ƨ","ꙅ":"ƨ","ь":"ƅ","ꮟ":"ƅ","ы":"ƅi","ꭾ":"ɂ","ˤ":"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ","Г":"Γ","Ꮁ":"Γ","ᒥ":"Γ","𖼇":"Γ","Ғ":"Γ̵","ᒯ":"Γ·","Ґ":"Γ\'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ","ᐃ":"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲","ᐏ":"Δ·","ᐬ":"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ","µ":"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ","ϖ":"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π","п":"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π","П":"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ","ϛ":"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ","Ф":"Φ","Փ":"Φ","ቀ":"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ","ѱ":"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ","Ѱ":"Ψ","𐓑":"Ψ","ᛘ":"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω","Ω":"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω","ᘯ":"Ω","ᘵ":"Ω","𐊶":"Ω","⍹":"ω̲","ώ":"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ","җ":"ж̩","Җ":"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И","Й":"Ѝ","Ҋ":"Ѝ̦","ѝ":"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ","Ꮗ":"Ѡ","ᗯ":"Ѡ","Ѽ":"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ","ӌ":"ҷ","Ӌ":"Ҷ","Ҿ":"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ","և":"եւ","ኔ":"ձ","ﬔ":"մե","ﬕ":"մի","ﬗ":"մխ","ﬓ":"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո","በ":"Ո","ᑎ":"Ո","ꓵ":"Ո","ᑚ":"Ո·","ᑨ":"Ո\'","ﬖ":"վն","₽":"Ք","˓":"ՙ","ʿ":"ՙ","ℵ":"א","ﬡ":"א","אָ":"אַ","אּ":"אַ","ﭏ":"אל","ℶ":"ב","ℷ":"ג","ℸ":"ד","ﬢ":"ד","ﬣ":"ה","יּ":"יִ","ﬤ":"כ","ﬥ":"ל","ﬦ":"ם","ﬠ":"ע","ﬧ":"ר","שׂ":"שׁ","שּ":"שׁ","שּׂ":"שּׁ","ﬨ":"ת","ﺀ":"ء","۽":"ء͈","ﺂ":"آ","ﺁ":"آ","ﭑ":"ٱ","ﭐ":"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب","ﺑ":"ب","ﺒ":"ب","ﺐ":"ب","ﺏ":"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ","ﲠ":"بo","ﳢ":"بo","ﲜ":"بج","ﰅ":"بج","ﲝ":"بح","ﰆ":"بح","ﷂ":"بحى","ﲞ":"بخ","ﰇ":"بخ","ﳒ":"بخ","ﱋ":"بخ","ﶞ":"بخى","ﱪ":"بر","ﱫ":"بز","ﲟ":"بم","ﳡ":"بم","ﱬ":"بم","ﰈ":"بم","ﱭ":"بن","ﱮ":"بى","ﰉ":"بى","ﱯ":"بى","ﰊ":"بى","ﭔ":"ٻ","ﭕ":"ٻ","ﭓ":"ٻ","ﭒ":"ٻ","ې":"ٻ","ﯦ":"ٻ","ﯧ":"ٻ","ﯥ":"ٻ","ﯤ":"ٻ","ﭜ":"ڀ","ﭝ":"ڀ","ﭛ":"ڀ","ﭚ":"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة","ö":"ة","ﺔ":"ة","ﺓ":"ة","ۃ":"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت","ﺗ":"ت","ﺘ":"ت","ﺖ":"ت","ﺕ":"ت","ﲥ":"تo","ﳤ":"تo","ﲡ":"تج","ﰋ":"تج","ﵐ":"تجم","ﶠ":"تجى","ﶟ":"تجى","ﲢ":"تح","ﰌ":"تح","ﵒ":"تحج","ﵑ":"تحج","ﵓ":"تحم","ﲣ":"تخ","ﰍ":"تخ","ﵔ":"تخم","ﶢ":"تخى","ﶡ":"تخى","ﱰ":"تر","ﱱ":"تز","ﲤ":"تم","ﳣ":"تم","ﱲ":"تم","ﰎ":"تم","ﵕ":"تمج","ﵖ":"تمح","ﵗ":"تمخ","ﶤ":"تمى","ﶣ":"تمى","ﱳ":"تن","ﱴ":"تى","ﰏ":"تى","ﱵ":"تى","ﰐ":"تى","ﭠ":"ٺ","ﭡ":"ٺ","ﭟ":"ٺ","ﭞ":"ٺ","ﭤ":"ٿ","ﭥ":"ٿ","ﭣ":"ٿ","ﭢ":"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج","ﺟ":"ج","ﺠ":"ج","ﺞ":"ج","ﺝ":"ج","ﲧ":"جح","ﰕ":"جح","ﶦ":"جحى","ﶾ":"جحى","ﷻ":"جل جلlلo","ﲨ":"جم","ﰖ":"جم","ﵙ":"جمح","ﵘ":"جمح","ﶧ":"جمى","ﶥ":"جمى","ﴝ":"جى","ﴁ":"جى","ﴞ":"جى","ﴂ":"جى","ﭸ":"ڃ","ﭹ":"ڃ","ﭷ":"ڃ","ﭶ":"ڃ","ﭴ":"ڄ","ﭵ":"ڄ","ﭳ":"ڄ","ﭲ":"ڄ","ﭼ":"چ","ﭽ":"چ","ﭻ":"چ","ﭺ":"چ","ﮀ":"ڇ","ﮁ":"ڇ","ﭿ":"ڇ","ﭾ":"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح","ﺣ":"ح","ﺤ":"ح","ﺢ":"ح","ﺡ":"ح","څ":"حۛ","ځ":"حٔ","ݲ":"حٔ","ﲩ":"حج","ﰗ":"حج","ﶿ":"حجى","ﲪ":"حم","ﰘ":"حم","ﵛ":"حمى","ﵚ":"حمى","ﴛ":"حى","ﳿ":"حى","ﴜ":"حى","ﴀ":"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ","ﺧ":"خ","ﺨ":"خ","ﺦ":"خ","ﺥ":"خ","ﲫ":"خج","ﰙ":"خج","ﰚ":"خح","ﲬ":"خم","ﰛ":"خم","ﴟ":"خى","ﴃ":"خى","ﴠ":"خى","ﴄ":"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د","ﺪ":"د","ﺩ":"د","ڈ":"دؕ","ﮉ":"دؕ","ﮈ":"دؕ","ڎ":"دۛ","ﮇ":"دۛ","ﮆ":"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ","ﺬ":"ذ","ﺫ":"ذ","ﱛ":"ذٰ","ڋ":"ڊؕ","ﮅ":"ڌ","ﮄ":"ڌ","ﮃ":"ڍ","ﮂ":"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر","ﺮ":"ر","ﺭ":"ر","ڑ":"رؕ","ﮍ":"رؕ","ﮌ":"رؕ","ژ":"رۛ","ﮋ":"رۛ","ﮊ":"رۛ","ڒ":"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ","ﱜ":"رٰ","ﷶ":"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز","ﺰ":"ز","ﺯ":"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س","ﺳ":"س","ﺴ":"س","ﺲ":"س","ﺱ":"س","ش":"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ","ﺷ":"سۛ","ﺸ":"سۛ","ﺶ":"سۛ","ﺵ":"سۛ","ݾ":"س̂","ﴱ":"سo","ﳨ":"سo","ﴲ":"سۛo","ﳪ":"سۛo","ﲭ":"سج","ﴴ":"سج","ﰜ":"سج","ﴭ":"سۛج","ﴷ":"سۛج","ﴥ":"سۛج","ﴉ":"سۛج","ﵝ":"سجح","ﵞ":"سجى","ﵩ":"سۛجى","ﲮ":"سح","ﴵ":"سح","ﰝ":"سح","ﴮ":"سۛح","ﴸ":"سۛح","ﴦ":"سۛح","ﴊ":"سۛح","ﵜ":"سحج","ﵨ":"سۛحم","ﵧ":"سۛحم","ﶪ":"سۛحى","ﲯ":"سخ","ﴶ":"سخ","ﰞ":"سخ","ﴯ":"سۛخ","ﴹ":"سۛخ","ﴧ":"سۛخ","ﴋ":"سۛخ","ﶨ":"سخى","ﷆ":"سخى","ﴪ":"سر","ﴎ":"سر","ﴩ":"سۛر","ﴍ":"سۛر","ﲰ":"سم","ﳧ":"سم","ﰟ":"سم","ﴰ":"سۛم","ﳩ":"سۛم","ﴨ":"سۛم","ﴌ":"سۛم","ﵡ":"سمج","ﵠ":"سمح","ﵟ":"سمح","ﵫ":"سۛمخ","ﵪ":"سۛمخ","ﵣ":"سمم","ﵢ":"سمم","ﵭ":"سۛمم","ﵬ":"سۛمم","ﴗ":"سى","ﳻ":"سى","ﴘ":"سى","ﳼ":"سى","ﴙ":"سۛى","ﳽ":"سۛى","ﴚ":"سۛى","ﳾ":"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص","ﺻ":"ص","ﺼ":"ص","ﺺ":"ص","ﺹ":"ص","ڞ":"صۛ","ࢯ":"ص̤̣","ﲱ":"صح","ﰠ":"صح","ﵥ":"صحح","ﵤ":"صحح","ﶩ":"صحى","ﲲ":"صخ","ﴫ":"صر","ﴏ":"صر","ﷵ":"صلعم","ﷹ":"صلى","ﷰ":"صلى","ﷺ":"صلى lللo علىo وسلم","ﲳ":"صم","ﰡ":"صم","ﷅ":"صمم","ﵦ":"صمم","ﴡ":"صى","ﴅ":"صى","ﴢ":"صى","ﴆ":"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض","ﺿ":"ض","ﻀ":"ض","ﺾ":"ض","ﺽ":"ض","ﲴ":"ضج","ﰢ":"ضج","ﲵ":"ضح","ﰣ":"ضح","ﵮ":"ضحى","ﶫ":"ضحى","ﲶ":"ضخ","ﰤ":"ضخ","ﵰ":"ضخم","ﵯ":"ضخم","ﴬ":"ضر","ﴐ":"ضر","ﲷ":"ضم","ﰥ":"ضم","ﴣ":"ضى","ﴇ":"ضى","ﴤ":"ضى","ﴈ":"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط","ﻃ":"ط","ﻄ":"ط","ﻂ":"ط","ﻁ":"ط","ڟ":"طۛ","ﲸ":"طح","ﰦ":"طح","ﴳ":"طم","ﴺ":"طم","ﰧ":"طم","ﵲ":"طمح","ﵱ":"طمح","ﵳ":"طمم","ﵴ":"طمى","ﴑ":"طى","ﳵ":"طى","ﴒ":"طى","ﳶ":"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ","ﻇ":"ظ","ﻈ":"ظ","ﻆ":"ظ","ﻅ":"ظ","ﲹ":"ظم","ﴻ":"ظم","ﰨ":"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع","ﻋ":"ع","ﻌ":"ع","ﻊ":"ع","ﻉ":"ع","ﲺ":"عج","ﰩ":"عج","ﷄ":"عجم","ﵵ":"عجم","ﷷ":"علىo","ﲻ":"عم","ﰪ":"عم","ﵷ":"عمم","ﵶ":"عمم","ﵸ":"عمى","ﶶ":"عمى","ﴓ":"عى","ﳷ":"عى","ﴔ":"عى","ﳸ":"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ","ﻏ":"غ","ﻐ":"غ","ﻎ":"غ","ﻍ":"غ","ﲼ":"غج","ﰫ":"غج","ﲽ":"غم","ﰬ":"غم","ﵹ":"غمم","ﵻ":"غمى","ﵺ":"غمى","ﴕ":"غى","ﳹ":"غى","ﴖ":"غى","ﳺ":"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف","ﻓ":"ف","ﻔ":"ف","ﻒ":"ف","ﻑ":"ف","ڧ":"ف","ﲾ":"فج","ﰭ":"فج","ﲿ":"فح","ﰮ":"فح","ﳀ":"فخ","ﰯ":"فخ","ﵽ":"فخم","ﵼ":"فخم","ﳁ":"فم","ﰰ":"فم","ﷁ":"فمى","ﱼ":"فى","ﰱ":"فى","ﱽ":"فى","ﰲ":"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ","ڤ":"ڡۛ","ﭬ":"ڡۛ","ﭭ":"ڡۛ","ﭫ":"ڡۛ","ﭪ":"ڡۛ","ڨ":"ڡۛ","ࢤ":"ڢۛ","ﭰ":"ڦ","ﭱ":"ڦ","ﭯ":"ڦ","ﭮ":"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق","ﻗ":"ق","ﻘ":"ق","ﻖ":"ق","ﻕ":"ق","ﳂ":"قح","ﰳ":"قح","ﷱ":"قلى","ﳃ":"قم","ﰴ":"قم","ﶴ":"قمح","ﵾ":"قمح","ﵿ":"قمم","ﶲ":"قمى","ﱾ":"قى","ﰵ":"قى","ﱿ":"قى","ﰶ":"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك","ﻛ":"ك","ﻜ":"ك","ﻚ":"ك","ﻙ":"ك","ک":"ك","ﮐ":"ك","ﮑ":"ك","ﮏ":"ك","ﮎ":"ك","ڪ":"ك","ڭ":"كۛ","ﯕ":"كۛ","ﯖ":"كۛ","ﯔ":"كۛ","ﯓ":"كۛ","ݣ":"كۛ","ﲀ":"كl","ﰷ":"كl","ﳄ":"كج","ﰸ":"كج","ﳅ":"كح","ﰹ":"كح","ﳆ":"كخ","ﰺ":"كخ","ﳇ":"كل","ﳫ":"كل","ﲁ":"كل","ﰻ":"كل","ﳈ":"كم","ﳬ":"كم","ﲂ":"كم","ﰼ":"كم","ﷃ":"كمم","ﶻ":"كمم","ﶷ":"كمى","ﲃ":"كى","ﰽ":"كى","ﲄ":"كى","ﰾ":"كى","ݢ":"ڬ","ﮔ":"گ","ﮕ":"گ","ﮓ":"گ","ﮒ":"گ","ࢰ":"گ","ڴ":"گۛ","ﮜ":"ڱ","ﮝ":"ڱ","ﮛ":"ڱ","ﮚ":"ڱ","ﮘ":"ڳ","ﮙ":"ڳ","ﮗ":"ڳ","ﮖ":"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل","ﻟ":"ل","ﻠ":"ل","ﻞ":"ل","ﻝ":"ل","ڷ":"لۛ","ڵ":"ل̆","ﻼ":"لl","ﻻ":"لl","ﻺ":"لlٕ","ﻹ":"لlٕ","ﻸ":"لlٴ","ﻷ":"لlٴ","ﳍ":"لo","ﻶ":"لآ","ﻵ":"لآ","ﳉ":"لج","ﰿ":"لج","ﶃ":"لجج","ﶄ":"لجج","ﶺ":"لجم","ﶼ":"لجم","ﶬ":"لجى","ﳊ":"لح","ﱀ":"لح","ﶵ":"لحم","ﶀ":"لحم","ﶂ":"لحى","ﶁ":"لحى","ﳋ":"لخ","ﱁ":"لخ","ﶆ":"لخم","ﶅ":"لخم","ﳌ":"لم","ﳭ":"لم","ﲅ":"لم","ﱂ":"لم","ﶈ":"لمح","ﶇ":"لمح","ﶭ":"لمى","ﲆ":"لى","ﱃ":"لى","ﲇ":"لى","ﱄ":"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م","ﻣ":"م","ﻤ":"م","ﻢ":"م","ﻡ":"م","ࢧ":"مۛ","۾":"م͈","ﲈ":"مl","ﳎ":"مج","ﱅ":"مج","ﶌ":"مجح","ﶒ":"مجخ","ﶍ":"مجم","ﷀ":"مجى","ﳏ":"مح","ﱆ":"مح","ﶉ":"محج","ﶊ":"محم","ﷴ":"محمد","ﶋ":"محى","ﳐ":"مخ","ﱇ":"مخ","ﶎ":"مخج","ﶏ":"مخم","ﶹ":"مخى","ﳑ":"مم","ﲉ":"مم","ﱈ":"مم","ﶱ":"ممى","ﱉ":"مى","ﱊ":"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن","ﻧ":"ن","ﻨ":"ن","ﻦ":"ن","ﻥ":"ن","ݨ":"نؕ","ݩ":"ن̆","ﳖ":"نo","ﳯ":"نo","ﶸ":"نجح","ﶽ":"نجح","ﶘ":"نجم","ﶗ":"نجم","ﶙ":"نجى","ﷇ":"نجى","ﳓ":"نح","ﱌ":"نح","ﶕ":"نحم","ﶖ":"نحى","ﶳ":"نحى","ﳔ":"نخ","ﱍ":"نخ","ﲊ":"نر","ﲋ":"نز","ﳕ":"نم","ﳮ":"نم","ﲌ":"نم","ﱎ":"نم","ﶛ":"نمى","ﶚ":"نمى","ﲍ":"نن","ﲎ":"نى","ﱏ":"نى","ﲏ":"نى","ﱐ":"نى","ۂ":"ۀ","ﮥ":"ۀ","ﮤ":"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و","ﻮ":"و","ﻭ":"و","ࢱ":"و","ۋ":"وۛ","ﯟ":"وۛ","ﯞ":"وۛ","ۇ":"و̓","ﯘ":"و̓","ﯗ":"و̓","ۆ":"و̆","ﯚ":"و̆","ﯙ":"و̆","ۉ":"و̂","ﯣ":"و̂","ﯢ":"و̂","ۈ":"وٰ","ﯜ":"وٰ","ﯛ":"وٰ","ؤ":"وٴ","ﺆ":"وٴ","ﺅ":"وٴ","ٶ":"وٴ","ٷ":"و̓ٴ","ﯝ":"و̓ٴ","ﷸ":"وسلم","ﯡ":"ۅ","ﯠ":"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى","ں":"ى","𞸝":"ى","𞹝":"ى","ﮟ":"ى","ﮞ":"ى","ࢽ":"ى","ﯨ":"ى","ﯩ":"ى","ﻰ":"ى","ﻯ":"ى","ي":"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى","ﻳ":"ى","ﻴ":"ى","ﻲ":"ى","ﻱ":"ى","ی":"ى","ﯾ":"ى","ﯿ":"ى","ﯽ":"ى","ﯼ":"ى","ے":"ى","ﮯ":"ى","ﮮ":"ى","ٹ":"ىؕ","ﭨ":"ىؕ","ﭩ":"ىؕ","ﭧ":"ىؕ","ﭦ":"ىؕ","ڻ":"ىؕ","ﮢ":"ىؕ","ﮣ":"ىؕ","ﮡ":"ىؕ","ﮠ":"ىؕ","پ":"ىۛ","ﭘ":"ىۛ","ﭙ":"ىۛ","ﭗ":"ىۛ","ﭖ":"ىۛ","ث":"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ","ﺛ":"ىۛ","ﺜ":"ىۛ","ﺚ":"ىۛ","ﺙ":"ىۛ","ڽ":"ىۛ","ۑ":"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆","ێ":"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ","ﲐ":"ىٰ","ﱝ":"ىٰ","ﳞ":"ىo","ﳱ":"ىo","ﳦ":"ىۛo","ئ":"ىٴ","ﺋ":"ىٴ","ﺌ":"ىٴ","ﺊ":"ىٴ","ﺉ":"ىٴ","ٸ":"ىٴ","ﯫ":"ىٴl","ﯪ":"ىٴl","ﲛ":"ىٴo","ﳠ":"ىٴo","ﯭ":"ىٴo","ﯬ":"ىٴo","ﯸ":"ىٴٻ","ﯷ":"ىٴٻ","ﯶ":"ىٴٻ","ﲗ":"ىٴج","ﰀ":"ىٴج","ﲘ":"ىٴح","ﰁ":"ىٴح","ﲙ":"ىٴخ","ﱤ":"ىٴر","ﱥ":"ىٴز","ﲚ":"ىٴم","ﳟ":"ىٴم","ﱦ":"ىٴم","ﰂ":"ىٴم","ﱧ":"ىٴن","ﯯ":"ىٴو","ﯮ":"ىٴو","ﯱ":"ىٴو̓","ﯰ":"ىٴو̓","ﯳ":"ىٴو̆","ﯲ":"ىٴو̆","ﯵ":"ىٴوٰ","ﯴ":"ىٴوٰ","ﯻ":"ىٴى","ﯺ":"ىٴى","ﱨ":"ىٴى","ﯹ":"ىٴى","ﰃ":"ىٴى","ﱩ":"ىٴى","ﰄ":"ىٴى","ﳚ":"ىج","ﱕ":"ىج","ﰑ":"ىۛج","ﶯ":"ىجى","ﳛ":"ىح","ﱖ":"ىح","ﶮ":"ىحى","ﳜ":"ىخ","ﱗ":"ىخ","ﲑ":"ىر","ﱶ":"ىۛر","ﲒ":"ىز","ﱷ":"ىۛز","ﳝ":"ىم","ﳰ":"ىم","ﲓ":"ىم","ﱘ":"ىم","ﲦ":"ىۛم","ﳥ":"ىۛم","ﱸ":"ىۛم","ﰒ":"ىۛم","ﶝ":"ىمم","ﶜ":"ىمم","ﶰ":"ىمى","ﲔ":"ىن","ﱹ":"ىۛن","ﲕ":"ىى","ﱙ":"ىى","ﲖ":"ىى","ﱚ":"ىى","ﱺ":"ىۛى","ﰓ":"ىۛى","ﱻ":"ىۛى","ﰔ":"ىۛى","ﮱ":"ۓ","ﮰ":"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ","Մ":"ሆ","Ռ":"ቡ","Ի":"ኮ","Պ":"ጣ","आ":"अा","ऒ":"अाॆ","ओ":"अाे","औ":"अाै","ऄ":"अॆ","ऑ":"अॉ","ऍ":"एॅ","ऎ":"एॆ","ऐ":"एे","ई":"र्इ","ઽ":"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्","আ":"অা","ৠ":"ঋৃ","ৡ":"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ","ਉ":"ੳੁ","ਊ":"ੳੂ","ਆ":"ਅਾ","ਐ":"ਅੈ","ਔ":"ਅੌ","ਇ":"ੲਿ","ਈ":"ੲੀ","ਏ":"ੲੇ","આ":"અા","ઑ":"અાૅ","ઓ":"અાે","ઔ":"અાૈ","ઍ":"અૅ","એ":"અે","ઐ":"અૈ","ଆ":"ଅା","௮":"அ","ர":"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ","ഉ":"உ","ஊ":"உள","ഊ":"உൗ","௭":"எ","௷":"எவ","ஜ":"ஐ","ജ":"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி","ണ":"ண","௺":"நீ","௴":"மீ","௰":"ய","ഴ":"ழ","ௗ":"ள","ை":"ன","ശ":"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ","ಅ":"అ","ಆ":"ఆ","ಇ":"ఇ","ౠ":"ఋా","ౡ":"ఌా","ಒ":"ఒ","ఔ":"ఒౌ","ಔ":"ఒౌ","ఓ":"ఒౕ","ಓ":"ఒౕ","ಜ":"జ","ಞ":"ఞ","ఢ":"డ̣","ಣ":"ణ","థ":"ధּ","భ":"బ̣","ಯ":"య","ఠ":"రּ","ಱ":"ఱ","ಲ":"ల","ష":"వ̣","హ":"వా","మ":"వు","ూ":"ుా","ౄ":"ృా","ೡ":"ಌಾ","ഈ":"ഇൗ","ഐ":"എെ","ഓ":"ഒാ","ഔ":"ഒൗ","ൡ":"ഞ","൫":"ദ്ര","൹":"നു","ഌ":"നു","ങ":"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ","റ":"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳","ฃ":"ข","ด":"ค","ต":"ค","ม":"ฆ","ຈ":"จ","ซ":"ช","ฏ":"ฎ","ท":"ฑ","ບ":"บ","ປ":"ป","ຝ":"ฝ","ພ":"พ","ຟ":"ฟ","ฦ":"ภ","ຍ":"ย","។":"ฯ","ๅ":"า","ำ":"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู","แ":"เเ","ໜ":"ຫນ","ໝ":"ຫມ","ຳ":"̊າ","༂":"འུྂཿ","༃":"འུྂ༔","ཪ":"ར","ༀ":"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ","က":"ဂာ","ၰ":"ဃှ","ၦ":"ပှ","ဟ":"ပာ","ၯ":"ပာှ","ၾ":"ၽှ","ဩ":"သြ","ဪ":"သြော်","႞":"ႃ̊","ឣ":"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ","ᢖ":"ᡜ","ᡕ":"ᠵ","ῶ":"Ꮿ","ᐍ":"ᐁ·","ᐫ":"ᐁᐠ","ᐑ":"ᐄ·","ᐓ":"ᐅ·","ᐭ":"ᐅᐠ","ᐕ":"ᐆ·","ᐘ":"ᐊ·","ᐮ":"ᐊᐠ","ᐚ":"ᐋ·","ᣝ":"ᐞᣟ","ᓑ":"ᐡ","ᕀ":"ᐩ","ᐿ":"ᐲ·","ᑃ":"ᐴ·","⍩":"ᐵ","ᑇ":"ᐹ·","ᑜ":"ᑏ·","⸧":"ᑐ","⊃":"ᑐ","ᑞ":"ᑐ·","ᑩ":"ᑐ\'","⟉":"ᑐ/","⫗":"ᑐᑕ","ᑠ":"ᑑ·","⸦":"ᑕ","⊂":"ᑕ","ᑢ":"ᑕ·","ᑪ":"ᑕ\'","ᑤ":"ᑖ·","ᑵ":"ᑫ·","ᒅ":"ᑫ\'","ᑹ":"ᑮ·","ᑽ":"ᑰ·","ᘃ":"ᒉ","ᒓ":"ᒉ·","ᒕ":"ᒋ·","ᒗ":"ᒌ·","ᒛ":"ᒎ·","ᘂ":"ᒐ","ᒝ":"ᒐ·","ᒟ":"ᒑ·","ᒭ":"ᒣ·","ᒱ":"ᒦ·","ᒳ":"ᒧ·","ᒵ":"ᒨ·","ᒹ":"ᒫ·","ᓊ":"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·","ᓌ":"ᓇ·","ᓎ":"ᓈ·","ᘄ":"ᓓ","ᓝ":"ᓓ·","ᓟ":"ᓕ·","ᓡ":"ᓖ·","ᓣ":"ᓗ·","ᓥ":"ᓘ·","ᘇ":"ᓚ","ᓧ":"ᓚ·","ᓩ":"ᓛ·","ᓷ":"ᓭ·","ᓹ":"ᓯ·","ᓻ":"ᓰ·","ᓽ":"ᓱ·","ᓿ":"ᓲ·","ᔁ":"ᓴ·","ᔃ":"ᓵ·","ᔌ":"ᔋ<","ᔎ":"ᔋb","ᔍ":"ᔋᑕ","ᔏ":"ᔋᒐ","ᔘ":"ᔐ·","ᔚ":"ᔑ·","ᔜ":"ᔒ·","ᔞ":"ᔓ·","ᔠ":"ᔔ·","ᔢ":"ᔕ·","ᔤ":"ᔖ·","ᔲ":"ᔨ·","ᔴ":"ᔩ·","ᔶ":"ᔪ·","ᔸ":"ᔫ·","ᔺ":"ᔭ·","ᔼ":"ᔮ·","ᘢ":"ᕃ","ᣠ":"ᕃ·","ᘣ":"ᕆ","ᘤ":"ᕊ","ᕏ":"ᕌ·","ᖃ":"ᕐb","ᖄ":"ᕐḃ","ᖁ":"ᕐd","ᕿ":"ᕐP","ᙯ":"ᕐᑫ","ᕾ":"ᕐᑬ","ᖀ":"ᕐᑮ","ᖂ":"ᕐᑰ","ᖅ":"ᕐᒃ","ᕜ":"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·","ᕩ":"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·","ᖑ":"ᖕJ","ᙰ":"ᖕᒉ","ᖎ":"ᖕᒊ","ᖏ":"ᖕᒋ","ᖐ":"ᖕᒌ","ᖒ":"ᖕᒎ","ᖓ":"ᖕᒐ","ᖔ":"ᖕᒑ","ᙳ":"ᖖJ","ᙱ":"ᖖᒋ","ᙲ":"ᖖᒌ","ᙴ":"ᖖᒎ","ᙵ":"ᖖᒐ","ᙶ":"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ","ˡ":"ᣳ","ʳ":"ᣴ","ˢ":"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ","ᛡ":"ᚼ","⍿":"ᚽ","ᛂ":"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥","ㄱ":"ᄀ","ᆨ":"ᄀ","ᄁ":"ᄀᄀ","ㄲ":"ᄀᄀ","ᆩ":"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ","ᇃ":"ᄀᄅ","ᇻ":"ᄀᄇ","ᆪ":"ᄀᄉ","ㄳ":"ᄀᄉ","ᇄ":"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ","ㄴ":"ᄂ","ᆫ":"ᄂ","ᄓ":"ᄂᄀ","ᇅ":"ᄂᄀ","ᄔ":"ᄂᄂ","ㅥ":"ᄂᄂ","ᇿ":"ᄂᄂ","ᄕ":"ᄂᄃ","ㅦ":"ᄂᄃ","ᇆ":"ᄂᄃ","ퟋ":"ᄂᄅ","ᄖ":"ᄂᄇ","ᅛ":"ᄂᄉ","ᇇ":"ᄂᄉ","ㅧ":"ᄂᄉ","ᅜ":"ᄂᄌ","ᆬ":"ᄂᄌ","ㄵ":"ᄂᄌ","ퟌ":"ᄂᄎ","ᇉ":"ᄂᄐ","ᅝ":"ᄂᄒ","ᆭ":"ᄂᄒ","ㄶ":"ᄂᄒ","ᇈ":"ᄂᅀ","ㅨ":"ᄂᅀ","ㄷ":"ᄃ","ᆮ":"ᄃ","ᄗ":"ᄃᄀ","ᇊ":"ᄃᄀ","ᄄ":"ᄃᄃ","ㄸ":"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ","ᇋ":"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ","ㄹ":"ᄅ","ᆯ":"ᄅ","ꥤ":"ᄅᄀ","ᆰ":"ᄅᄀ","ㄺ":"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ","ᇌ":"ᄅᄀᄉ","ㅩ":"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ","ᄘ":"ᄅᄂ","ᇍ":"ᄅᄂ","ꥦ":"ᄅᄃ","ᇎ":"ᄅᄃ","ㅪ":"ᄅᄃ","ꥧ":"ᄅᄃᄃ","ᇏ":"ᄅᄃᄒ","ᄙ":"ᄅᄅ","ᇐ":"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ","ᆱ":"ᄅᄆ","ㄻ":"ᄅᄆ","ᇑ":"ᄅᄆᄀ","ᇒ":"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ","ᆲ":"ᄅᄇ","ㄼ":"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ","ᇓ":"ᄅᄇᄉ","ㅫ":"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ","ᇕ":"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ","ᇔ":"ᄅᄇᄒ","ꥬ":"ᄅᄉ","ᆳ":"ᄅᄉ","ㄽ":"ᄅᄉ","ᇖ":"ᄅᄉᄉ","ᄛ":"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ","ᇘ":"ᄅᄏ","ᆴ":"ᄅᄐ","ㄾ":"ᄅᄐ","ᆵ":"ᄅᄑ","ㄿ":"ᄅᄑ","ᄚ":"ᄅᄒ","ㅀ":"ᄅᄒ","ᄻ":"ᄅᄒ","ᆶ":"ᄅᄒ","ퟲ":"ᄅᄒ","ᇗ":"ᄅᅀ","ㅬ":"ᄅᅀ","ퟛ":"ᄅᅌ","ᇙ":"ᄅᅙ","ㅭ":"ᄅᅙ","ퟜ":"ᄅᅙᄒ","ㅁ":"ᄆ","ᆷ":"ᄆ","ꥯ":"ᄆᄀ","ᇚ":"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ","ᇛ":"ᄆᄅ","ퟠ":"ᄆᄆ","ᄜ":"ᄆᄇ","ㅮ":"ᄆᄇ","ᇜ":"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ","ᇝ":"ᄆᄉ","ㅯ":"ᄆᄉ","ᇞ":"ᄆᄉᄉ","ᄝ":"ᄆᄋ","ㅱ":"ᄆᄋ","ᇢ":"ᄆᄋ","ퟢ":"ᄆᄌ","ᇠ":"ᄆᄎ","ᇡ":"ᄆᄒ","ᇟ":"ᄆᅀ","ㅰ":"ᄆᅀ","ㅂ":"ᄇ","ᆸ":"ᄇ","ᄞ":"ᄇᄀ","ㅲ":"ᄇᄀ","ᄟ":"ᄇᄂ","ᄠ":"ᄇᄃ","ㅳ":"ᄇᄃ","ퟣ":"ᄇᄃ","ᇣ":"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ","ᄈ":"ᄇᄇ","ㅃ":"ᄇᄇ","ퟦ":"ᄇᄇ","ᄬ":"ᄇᄇᄋ","ㅹ":"ᄇᄇᄋ","ᄡ":"ᄇᄉ","ㅄ":"ᄇᄉ","ᆹ":"ᄇᄉ","ᄢ":"ᄇᄉᄀ","ㅴ":"ᄇᄉᄀ","ᄣ":"ᄇᄉᄃ","ㅵ":"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ","ᄤ":"ᄇᄉᄇ","ᄥ":"ᄇᄉᄉ","ᄦ":"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ","ᄫ":"ᄇᄋ","ㅸ":"ᄇᄋ","ᇦ":"ᄇᄋ","ᄧ":"ᄇᄌ","ㅶ":"ᄇᄌ","ퟨ":"ᄇᄌ","ᄨ":"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ","ᄩ":"ᄇᄐ","ㅷ":"ᄇᄐ","ᄪ":"ᄇᄑ","ᇤ":"ᄇᄑ","ꥴ":"ᄇᄒ","ᇥ":"ᄇᄒ","ㅅ":"ᄉ","ᆺ":"ᄉ","ᄭ":"ᄉᄀ","ㅺ":"ᄉᄀ","ᇧ":"ᄉᄀ","ᄮ":"ᄉᄂ","ㅻ":"ᄉᄂ","ᄯ":"ᄉᄃ","ㅼ":"ᄉᄃ","ᇨ":"ᄉᄃ","ᄰ":"ᄉᄅ","ᇩ":"ᄉᄅ","ᄱ":"ᄉᄆ","ퟪ":"ᄉᄆ","ᄲ":"ᄉᄇ","ㅽ":"ᄉᄇ","ᇪ":"ᄉᄇ","ᄳ":"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ","ᄊ":"ᄉᄉ","ㅆ":"ᄉᄉ","ᆻ":"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ","ᄴ":"ᄉᄉᄉ","ᄵ":"ᄉᄋ","ᄶ":"ᄉᄌ","ㅾ":"ᄉᄌ","ퟯ":"ᄉᄌ","ᄷ":"ᄉᄎ","ퟰ":"ᄉᄎ","ᄸ":"ᄉᄏ","ᄹ":"ᄉᄐ","ퟱ":"ᄉᄐ","ᄺ":"ᄉᄑ","ퟮ":"ᄉᅀ","ㅇ":"ᄋ","ᆼ":"ᄋ","ᅁ":"ᄋᄀ","ᇬ":"ᄋᄀ","ᇭ":"ᄋᄀᄀ","ᅂ":"ᄋᄃ","ꥶ":"ᄋᄅ","ᅃ":"ᄋᄆ","ᅄ":"ᄋᄇ","ᅅ":"ᄋᄉ","ᇱ":"ᄋᄉ","ㆂ":"ᄋᄉ","ᅇ":"ᄋᄋ","ㆀ":"ᄋᄋ","ᇮ":"ᄋᄋ","ᅈ":"ᄋᄌ","ᅉ":"ᄋᄎ","ᇯ":"ᄋᄏ","ᅊ":"ᄋᄐ","ᅋ":"ᄋᄑ","ꥷ":"ᄋᄒ","ᅆ":"ᄋᅀ","ᇲ":"ᄋᅀ","ㆃ":"ᄋᅀ","ㅈ":"ᄌ","ᆽ":"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ","ᅍ":"ᄌᄋ","ᄍ":"ᄌᄌ","ㅉ":"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ","ㅊ":"ᄎ","ᆾ":"ᄎ","ᅒ":"ᄎᄏ","ᅓ":"ᄎᄒ","ㅋ":"ᄏ","ᆿ":"ᄏ","ㅌ":"ᄐ","ᇀ":"ᄐ","ꥹ":"ᄐᄐ","ㅍ":"ᄑ","ᇁ":"ᄑ","ᅖ":"ᄑᄇ","ᇳ":"ᄑᄇ","ퟺ":"ᄑᄉ","ᅗ":"ᄑᄋ","ㆄ":"ᄑᄋ","ᇴ":"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ","ㅎ":"ᄒ","ᇂ":"ᄒ","ᇵ":"ᄒᄂ","ᇶ":"ᄒᄅ","ᇷ":"ᄒᄆ","ᇸ":"ᄒᄇ","ꥻ":"ᄒᄉ","ᅘ":"ᄒᄒ","ㆅ":"ᄒᄒ","ᄽ":"ᄼᄼ","ᄿ":"ᄾᄾ","ㅿ":"ᅀ","ᇫ":"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ","ㆁ":"ᅌ","ᇰ":"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ","ᅏ":"ᅎᅎ","ᅑ":"ᅐᅐ","ㆆ":"ᅙ","ᇹ":"ᅙ","ꥼ":"ᅙᅙ","ㅤ":"ᅠ","ㅏ":"ᅡ","ᆣ":"ᅡー","ᅶ":"ᅡᅩ","ᅷ":"ᅡᅮ","ᅢ":"ᅡ丨","ㅐ":"ᅡ丨","ㅑ":"ᅣ","ᅸ":"ᅣᅩ","ᅹ":"ᅣᅭ","ᆤ":"ᅣᅮ","ᅤ":"ᅣ丨","ㅒ":"ᅣ丨","ㅓ":"ᅥ","ᅼ":"ᅥー","ᅺ":"ᅥᅩ","ᅻ":"ᅥᅮ","ᅦ":"ᅥ丨","ㅔ":"ᅥ丨","ㅕ":"ᅧ","ᆥ":"ᅧᅣ","ᅽ":"ᅧᅩ","ᅾ":"ᅧᅮ","ᅨ":"ᅧ丨","ㅖ":"ᅧ丨","ㅗ":"ᅩ","ᅪ":"ᅩᅡ","ㅘ":"ᅩᅡ","ᅫ":"ᅩᅡ丨","ㅙ":"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨","ᅿ":"ᅩᅥ","ᆀ":"ᅩᅥ丨","ힰ":"ᅩᅧ","ᆁ":"ᅩᅧ丨","ᆂ":"ᅩᅩ","ힱ":"ᅩᅩ丨","ᆃ":"ᅩᅮ","ᅬ":"ᅩ丨","ㅚ":"ᅩ丨","ㅛ":"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨","ᆄ":"ᅭᅣ","ㆇ":"ᅭᅣ","ᆆ":"ᅭᅣ","ᆅ":"ᅭᅣ丨","ㆈ":"ᅭᅣ丨","ힴ":"ᅭᅥ","ᆇ":"ᅭᅩ","ᆈ":"ᅭ丨","ㆉ":"ᅭ丨","ㅜ":"ᅮ","ᆉ":"ᅮᅡ","ᆊ":"ᅮᅡ丨","ᅯ":"ᅮᅥ","ㅝ":"ᅮᅥ","ᆋ":"ᅮᅥー","ᅰ":"ᅮᅥ丨","ㅞ":"ᅮᅥ丨","ힵ":"ᅮᅧ","ᆌ":"ᅮᅧ丨","ᆍ":"ᅮᅮ","ᅱ":"ᅮ丨","ㅟ":"ᅮ丨","ힶ":"ᅮ丨丨","ㅠ":"ᅲ","ᆎ":"ᅲᅡ","ힷ":"ᅲᅡ丨","ᆏ":"ᅲᅥ","ᆐ":"ᅲᅥ丨","ᆑ":"ᅲᅧ","ㆊ":"ᅲᅧ","ᆒ":"ᅲᅧ丨","ㆋ":"ᅲᅧ丨","ힸ":"ᅲᅩ","ᆓ":"ᅲᅮ","ᆔ":"ᅲ丨","ㆌ":"ᅲ丨","ㆍ":"ᆞ","ퟅ":"ᆞᅡ","ᆟ":"ᆞᅥ","ퟆ":"ᆞᅥ丨","ᆠ":"ᆞᅮ","ᆢ":"ᆞᆞ","ᆡ":"ᆞ丨","ㆎ":"ᆞ丨","ヘ":"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄","不":"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨","ᅵ":"丨","ㅣ":"丨","⼁":"丨","ᆜ":"丨ー","ᆘ":"丨ᅡ","ᆙ":"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨","ᆚ":"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ","ᆛ":"丨ᅮ","ퟃ":"丨ᅲ","ᆝ":"丨ᆞ","ퟄ":"丨丨","串":"串","丸":"丸","丹":"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀","亂":"亂","㇚":"亅","⼅":"亅","了":"了","ニ":"二","⼆":"二","𠄢":"𠄢","⼇":"亠","亮":"亮","⼈":"人","イ":"亻","⺅":"亻","什":"什","仌":"仌","令":"令","你":"你","倂":"併","倂":"併","侀":"侀","來":"來","例":"例","侮":"侮","侮":"侮","侻":"侻","便":"便","值":"値","倫":"倫","偺":"偺","備":"備","像":"像","僚":"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿","兀":"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全","兩":"兩","ハ":"八","⼋":"八","六":"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况","冷":"冷","凉":"凉","凌":"凌","凜":"凜","凞":"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃","切":"切","切":"切","列":"列","利":"利","㓟":"㓟","刺":"刺","刻":"刻","剆":"剆","割":"割","剷":"剷","劉":"劉","𠠄":"𠠄","カ":"力","力":"力","⼒":"力","劣":"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉","勒":"勒","勞":"勞","勤":"勤","勤":"勤","勵":"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕","北":"北","北":"北","⼕":"匚","⼖":"匸","匿":"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博","ト":"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即","卵":"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶","參":"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣","ロ":"口","⼝":"口","囗":"口","⼞":"口","句":"句","叫":"叫","叱":"叱","吆":"吆","吏":"吏","吝":"吝","吸":"吸","呂":"呂","呈":"呈","周":"周","咞":"咞","咢":"咢","咽":"咽","䎛":"㖈","哶":"哶","唐":"唐","啓":"啓","啟":"啓","啕":"啕","啣":"啣","善":"善","善":"善","喇":"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳","嗀":"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器","囹":"囹","圖":"圖","圗":"圗","⼟":"土","士":"土","⼠":"土","型":"型","城":"城","㦳":"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀","塚":"塚","塚":"塚","塞":"塞","填":"塡","壿":"墫","墬":"墬","墳":"墳","壘":"壘","壟":"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊","タ":"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄","奈":"奈","契":"契","奔":"奔","奢":"奢","女":"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦","嬀":"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀","宅":"宅","𡧈":"𡧈","寃":"寃","寘":"寘","寧":"寧","寧":"寧","寧":"寧","寮":"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸","尿":"尿","屠":"屠","屢":"屢","層":"層","履":"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦","崙":"崙","嵃":"嵃","嵐":"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲","嶺":"嶺","⼮":"巛","巢":"巢","エ":"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾","帲":"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干","年":"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广","度":"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶","廊":"廊","廊":"廊","廉":"廉","廒":"廒","廓":"廓","廙":"廙","廬":"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱","弄":"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳","律":"律","㣣":"㣣","徚":"徚","復":"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志","念":"念","忹":"忹","怒":"怒","怜":"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘","惡":"惡","𢛔":"𢛔","愈":"愈","慨":"慨","慄":"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎","憐":"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲","懶":"懶","懶":"懶","戀":"戀","⼽":"戈","成":"成","戛":"戛","戮":"戮","戴":"戴","⼾":"戶","戸":"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱","拉":"拉","拏":"拏","拓":"拓","拔":"拔","拼":"拼","拾":"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨","捻":"捻","掃":"掃","掠":"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮","搉":"㩁","撚":"撚","撝":"撝","擄":"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬","數":"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗","料":"料","⽄":"斤","⽅":"方","旅":"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日","易":"易","曶":"㫚","㫤":"㫤","晉":"晉","晩":"晚","晴":"晴","晴":"晴","暑":"暑","暑":"暑","暈":"暈","㬈":"㬈","暜":"暜","暴":"暴","曆":"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰","更":"更","書":"書","⽉":"月","𣍟":"𣍟","肦":"朌","胐":"朏","胊":"朐","脁":"朓","胶":"㬵","朗":"朗","朗":"朗","朗":"朗","脧":"朘","望":"望","望":"望","幐":"㬺","䐠":"㬻","𣎓":"𣎓","膧":"朣","𣎜":"𣎜","⽊":"木","李":"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃","柿":"杮","杻":"杻","枅":"枅","林":"林","㭉":"㭉","𣏕":"𣏕","柳":"柳","柺":"柺","栗":"栗","栟":"栟","桒":"桒","𣑭":"𣑭","梁":"梁","梅":"梅","梅":"梅","梎":"梎","梨":"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝","槩":"㮣","樧":"榝","榣":"榣","槪":"槪","樂":"樂","樂":"樂","樂":"樂","樓":"樓","𣚣":"𣚣","檨":"檨","櫓":"櫓","櫛":"櫛","欄":"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲","歷":"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟","殮":"殮","⽎":"殳","殺":"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧","沈":"沈","沿":"沿","泌":"泌","泍":"泍","泥":"泥","𣲼":"𣲼","洛":"洛","洞":"洞","洴":"洴","派":"派","流":"流","流":"流","流":"流","洖":"洖","浩":"浩","浪":"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞","淋":"淋","淚":"淚","淪":"淪","淹":"淹","渚":"渚","港":"港","湮":"湮","潙":"溈","滋":"滋","滋":"滋","溜":"溜","溺":"溺","滇":"滇","滑":"滑","滛":"滛","㴳":"㴳","漏":"漏","漢":"漢","漢":"漢","漣":"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆","濫":"濫","濾":"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災","炙":"炙","炭":"炭","烈":"烈","烙":"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅","煉":"煉","𤋮":"𤋮","熜":"熜","燎":"燎","燐":"燐","𤎫":"𤎫","爐":"爐","爛":"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛","牢":"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯","狀":"狀","𤜵":"𤜵","狼":"狼","猪":"猪","猪":"猪","𤠔":"𤠔","獵":"獵","獺":"獺","⽞":"玄","率":"率","率":"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥","玲":"玲","㺸":"㺸","㺸":"㺸","珞":"珞","琉":"琉","理":"理","琢":"琢","瑇":"瑇","瑜":"瑜","瑩":"瑩","瑱":"瑱","瑱":"瑱","璅":"璅","璉":"璉","璘":"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶","留":"留","略":"略","異":"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒","痢":"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝","療":"療","癩":"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼","益":"益","益":"益","盛":"盛","盧":"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳","省":"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹","晣":"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝","硏":"研","硎":"硎","硫":"硫","碌":"碌","碌":"碌","碑":"碑","磊":"磊","磌":"磌","磌":"磌","磻":"磻","䃣":"䃣","礪":"礪","⽰":"示","⺭":"礻","礼":"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝","神":"神","祥":"祥","視":"視","視":"視","祿":"祿","𥚚":"𥚚","禍":"禍","禎":"禎","福":"福","福":"福","𥛅":"𥛅","禮":"禮","⽱":"禸","⽲":"禾","秊":"秊","䄯":"䄯","秫":"秫","稜":"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱","立":"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹","笠":"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐","簾":"簾","籠":"籠","⽶":"米","类":"类","粒":"粒","精":"精","糒":"糒","糖":"糖","糨":"糨","䊠":"䊠","糣":"糣","糧":"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀","紐":"紐","索":"索","累":"累","絶":"絕","絣":"絣","絛":"絛","綠":"綠","綾":"綾","緇":"緇","練":"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉","縷":"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙","罹":"罹","罺":"罺","羅":"羅","𦌾":"𦌾","⽺":"羊","羕":"羕","羚":"羚","羽":"羽","⽻":"羽","翺":"翺","老":"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳","聆":"聆","聠":"聠","𦖨":"𦖨","聯":"聯","聰":"聰","聾":"聾","⾀":"聿","⺺":"肀","⾁":"肉","肋":"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙","腁":"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵","朦":"䑃","臘":"臘","⾂":"臣","臨":"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮","良":"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽","若":"若","若":"若","苦":"苦","𦬼":"𦬼","茶":"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓","菉":"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華","菱":"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭","落":"落","葉":"葉","蔿":"蒍","𦳕":"𦳕","𦵫":"𦵫","蓮":"蓮","蓱":"蓱","蓳":"蓳","蓼":"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬","藍":"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡","藺":"藺","蘆":"蘆","䕫":"䕫","蘒":"蘒","蘭":"蘭","𧃒":"𧃒","虁":"蘷","蘿":"蘿","⾌":"虍","⻁":"虎","虐":"虐","虜":"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊","螺":"螺","蠁":"蠁","䗹":"䗹","蠟":"蠟","⾎":"血","行":"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤","裂":"裂","𧙧":"𧙧","裏":"裏","裗":"裗","裞":"裞","裡":"裡","裸":"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁","襤":"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆","見":"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦","詽":"訮","訞":"䚶","䚾":"䚾","䛇":"䛇","誠":"誠","說":"說","說":"說","調":"調","請":"請","諒":"諒","論":"論","諭":"諭","諭":"諭","諸":"諸","諸":"諸","諾":"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹","識":"識","讀":"讀","讏":"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆","豈":"豈","豕":"豕","⾗":"豕","豣":"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁","賂":"賂","賈":"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起","趆":"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼","跺":"跥","路":"路","跰":"跰","躛":"躗","⾝":"身","車":"車","⾞":"車","軔":"軔","輧":"軿","輦":"輦","輪":"輪","輸":"輸","輸":"輸","輻":"輻","轢":"轢","⻋":"车","⾟":"辛","辞":"辞","辰":"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡","連":"連","逸":"逸","逸":"逸","遲":"遲","遼":"遼","𨗒":"𨗒","𨗭":"𨗭","邏":"邏","⾢":"邑","邔":"邔","郎":"郎","郞":"郎","郞":"郎","郱":"郱","都":"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉","酪":"酪","醙":"醙","醴":"醴","⾤":"釆","里":"里","⾥":"里","量":"量","金":"金","⾦":"金","鈴":"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼","錄":"錄","鍊":"鍊","鎮":"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕","閭":"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝","阮":"阮","陋":"陋","降":"降","陵":"陵","陸":"陸","陼":"陼","隆":"隆","隣":"隣","䧦":"䧦","⾪":"隶","隷":"隷","隸":"隷","隸":"隷","⾫":"隹","雃":"雃","離":"離","難":"難","難":"難","⾬":"雨","零":"零","雷":"雷","霣":"霣","𩅅":"𩅅","露":"露","靈":"靈","⾭":"靑","⻘":"青","靖":"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋","領":"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻","類":"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢","飯":"飯","飼":"飼","䬳":"䬳","館":"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂","駱":"駱","駾":"駾","驪":"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚","魯":"魯","鱀":"鱀","鱗":"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎","鶴":"鶴","𪄅":"𪄅","䳸":"䳸","鷺":"鷺","𪈎":"𪈎","鸞":"鸞","鹃":"鹂","⿄":"鹵","鹿":"鹿","⿅":"鹿","𪊑":"𪊑","麗":"麗","麟":"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍","黎":"黎","䵖":"䵖","⿊":"黑","黒":"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿","龍":"龍","⿓":"龍","龎":"龎","⻰":"龙","龜":"龜","龜":"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"}')})),i.register("1q9CE",(function(e,t){var r=i("af1Rx");const n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class o extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((i,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const a=r.operation(t);a.attempt((async r=>{try{i(await e(r))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof o)a.stop(),s(e.originalError);else if(e instanceof TypeError&&(c=e.message,!n.includes(c)))a.stop(),s(e);else{((e,t,r)=>{const i=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=i})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}a.retry(e)||s(a.mainError())}}var c}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=o})),i.register("af1Rx",(function(e,t){e.exports=i("UtToO")})),i.register("UtToO",(function(t,r){var n,o,s,a;e(t.exports,"operation",(()=>n),(e=>n=e)),e(t.exports,"timeouts",(()=>o),(e=>o=e)),e(t.exports,"createTimeout",(()=>s),(e=>s=e)),e(t.exports,"wrap",(()=>a),(e=>a=e));var c=i("5AFpt");n=function(e){var t=o(e);return new c(t,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},o=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],n=0;n<t.retries;n++)i.push(this.createTimeout(n,t));return e&&e.forever&&!i.length&&i.push(this.createTimeout(n,t)),i.sort((function(e,t){return e-t})),i},s=function(e,t){var r=t.randomize?Math.random()+1:1,i=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return i=Math.min(i,t.maxTimeout)},a=function(e,t,r){if(t instanceof Array&&(r=t,t=null),!r)for(var i in r=[],e)"function"==typeof e[i]&&r.push(i);for(var o=0;o<r.length;o++){var s=r[o],a=e[s];e[s]=function(r){var i=n(t),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))})),i.attempt((function(){r.apply(e,o)}))}.bind(e,a),e[s].options=t}}})),i.register("5AFpt",(function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var i=this;return this._timer=setTimeout((function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout((function(){i._operationTimeoutCb(i._attempts)}),i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)}),r),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var n=this._errors[i],o=n.message,s=(e[o]||0)+1;e[o]=s,s>=r&&(t=n,r=s)}return t}})),i.register("1HWgt",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_TIMESTAMP=e.exports.M_LOCATION=e.exports.M_ASSET=e.exports.LocationAssetType=void 0;var r=i("1c8ok");let n;var o;i("hNnnH"),e.exports.LocationAssetType=n,(o=n||(e.exports.LocationAssetType=n={})).Self="m.self",o.Pin="m.pin";const s=new r.UnstableValue("m.asset","org.matrix.msc3488.asset");e.exports.M_ASSET=s;const a=new r.UnstableValue("m.ts","org.matrix.msc3488.ts");e.exports.M_TIMESTAMP=a;const c=new r.UnstableValue("m.location","org.matrix.msc3488.location");e.exports.M_LOCATION=c})),i.register("1c8ok",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnstableValue=e.exports.ServerControlledNamespacedValue=e.exports.NamespacedValue=void 0;var n=r(i("3EUCw"));class o{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){const e=[this.name],t=this.altName;return t&&e.push(t),e}matches(e){return this.name===e||this.altName===e}findIn(e){let t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){let t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}e.exports.NamespacedValue=o;e.exports.ServerControlledNamespacedValue=class extends o{constructor(...e){super(...e),(0,n.default)(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}};e.exports.UnstableValue=class extends o{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}})),i.register("hNnnH",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.REFERENCE_RELATION=e.exports.M_TEXT=e.exports.M_MESSAGE=e.exports.M_HTML=void 0,e.exports.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);{const r=t,i=e;return r.matches(i.name)||(0,n.isProvided)(i.altName)&&r.matches(i.altName)}};var r=i("e0VXi"),n=i("cn4jF");const o=new r.UnstableValue("m.message","org.matrix.msc1767.message");e.exports.M_MESSAGE=o;const s=new r.UnstableValue("m.text","org.matrix.msc1767.text");e.exports.M_TEXT=s;const a=new r.UnstableValue("m.html","org.matrix.msc1767.html");e.exports.M_HTML=a;const c=new r.NamespacedValue("m.reference");e.exports.REFERENCE_RELATION=c})),i.register("e0VXi",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0});var r=i("691Ie");Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===r[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return r[t]}}))}));var n=i("7JSYH");Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===n[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return n[t]}}))}));var o=i("2vZrC");Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))}));var s=i("4k4R4");Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===s[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return s[t]}}))}));var a=i("eJUlz");Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))}));var c=i("9JN1j");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var l=i("l4IA5");Object.keys(l).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===l[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return l[t]}}))}));var u=i("4Iqka");Object.keys(u).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===u[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return u[t]}}))}));var h=i("6qEZY");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var d=i("01mY3");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=i("5gF5q");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var p=i("brH2J");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var m=i("hI9Mb");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var g=i("ihKsJ");Object.keys(g).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===g[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return g[t]}}))}));var v=i("7i9Hl");Object.keys(v).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===v[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return v[t]}}))}));var y=i("2ilqY");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=i("ltSOQ");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var w=i("iOEfK");Object.keys(w).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===w[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return w[t]}}))}));var _=i("k3thZ");Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var S=i("f6GOx");Object.keys(S).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===S[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return S[t]}}))}));var E=i("7IS0W");Object.keys(E).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===E[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return E[t]}}))}))})),i.register("691Ie",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ExtensibleEvents=void 0;var r=i("eJUlz"),n=i("2vZrC"),o=i("6qEZY"),s=i("01mY3"),a=i("ihKsJ"),c=i("iOEfK"),l=i("5gF5q");function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),f(this,"interpreters",new r.NamespacedMap([[o.LEGACY_M_ROOM_MESSAGE,o.parseMRoomMessage],[a.M_MESSAGE,s.parseMMessage],[a.M_EMOTE,s.parseMMessage],[a.M_NOTICE,s.parseMMessage],[c.M_POLL_START,l.parseMPoll],[c.M_POLL_RESPONSE,l.parseMPoll],[c.M_POLL_END,l.parseMPoll]])),f(this,"_unknownInterpretOrder",[a.M_MESSAGE])}var t,i,h;return t=e,h=[{key:"defaultInstance",get:function(){return e._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return e.defaultInstance.unknownInterpretOrder},set:function(t){e.defaultInstance.unknownInterpretOrder=t}},{key:"registerInterpreter",value:function(t,r){e.defaultInstance.registerInterpreter(t,r)}},{key:"parse",value:function(t){return e.defaultInstance.parse(t)}}],(i=[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var t,r=u(this.unknownInterpretOrder);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this.interpreters.has(i)){var o=this.interpreters.get(i)(e);if(o)return o}}}catch(e){r.e(e)}finally{r.f()}return null}catch(e){if(e instanceof n.InvalidEventError)return null;throw e}}}])&&d(t.prototype,i),h&&d(t,h),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.ExtensibleEvents=p,f(p,"_defaultInstance",new p)})),i.register("eJUlz",(function(e,t){function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.NamespacedMap=void 0;var o=function(){function e(t){var i,n,o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=this,n="internalMap",o=new Map,n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,t){var s,a=r(t);try{for(a.s();!(s=a.n()).done;){var c=s.value;this.set(c[0],c[1])}}catch(e){a.e(e)}finally{a.f()}}}var t,i,o;return t=e,(i=[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}])&&n(t.prototype,i),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.NamespacedMap=o})),i.register("2vZrC",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e){var t=a();return function(){var i,n=l(e);if(t){var o=l(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,i)}}function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return s(e,arguments,l(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),c(i,e)},o(e)}function s(e,t,r){return s=a()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&c(n,r.prototype),n},s.apply(null,arguments)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InvalidEventError=void 0;var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(a,e);var t,r,o,s=n(a);function a(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this,e)}return t=a,r&&i(t.prototype,r),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(o(Error));e.exports.InvalidEventError=u})),i.register("6qEZY",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LEGACY_M_ROOM_MESSAGE=void 0,e.exports.parseMRoomMessage=function(e){var t,i,s;if(a.M_MESSAGE.findIn(e.content)||a.M_TEXT.findIn(e.content))return new r.MessageEvent(e);var c,h=null===(t=e.content)||void 0===t?void 0:t.msgtype,d=null===(i=e.content)||void 0===i?void 0:i.body,f="org.matrix.custom.html"===(null===(s=e.content)||void 0===s?void 0:s.format)?e.content.formatted_body:null;return"m.text"===h?new r.MessageEvent(l(l({},e),{},{content:l(l({},e.content),{},(c={},u(c,a.M_TEXT.name,d),u(c,a.M_HTML.name,f),c))})):"m.notice"===h?new n.NoticeEvent(l(l({},e),{},{content:l(l({},e.content),{},(p={},u(p,a.M_TEXT.name,d),u(p,a.M_HTML.name,f),p))})):"m.emote"===h?new o.EmoteEvent(l(l({},e),{},{content:l(l({},e.content),{},(m={},u(m,a.M_TEXT.name,d),u(m,a.M_HTML.name,f),m))})):null;var p,m};var r=i("7i9Hl"),n=i("ltSOQ"),o=i("2ilqY"),s=i("4k4R4"),a=i("ihKsJ");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=new s.NamespacedValue("m.room.message");e.exports.LEGACY_M_ROOM_MESSAGE=h})),i.register("7i9Hl",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MessageEvent=void 0;var n=i("hI9Mb"),o=i("9JN1j"),s=i("2vZrC"),a=i("ihKsJ"),c=i("4Iqka");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=m(e);if(t){var o=m(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}(this,i)}}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(l,e);var t,r,i,n=f(l);function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),g(p(t=n.call(this,e)),"text",void 0),g(p(t),"html",void 0),g(p(t),"renderings",void 0);var r=a.M_MESSAGE.findIn(t.wireContent),i=a.M_TEXT.findIn(t.wireContent),c=a.M_HTML.findIn(t.wireContent);if((0,o.isProvided)(r)){if(!Array.isArray(r))throw new s.InvalidEventError("m.message contents must be an array");var u=r.find((function(e){return!(0,o.isProvided)(e.mimetype)||"text/plain"===e.mimetype})),h=r.find((function(e){return"text/html"===e.mimetype}));if(!u)throw new s.InvalidEventError("m.message is missing a plain text representation");t.text=u.body,t.html=null==h?void 0:h.body,t.renderings=r}else{if(!(0,o.isOptionalAString)(i))throw new s.InvalidEventError("Missing textual representation for event");t.text=i,t.html=c,t.renderings=[{body:i,mimetype:"text/plain"}],t.html&&t.renderings.push({body:t.html,mimetype:"text/html"})}return t}return t=l,i=[{key:"from",value:function(e,t){var r;return new l({type:a.M_MESSAGE.name,content:(r={},g(r,a.M_TEXT.name,e),g(r,a.M_HTML.name,t),r)})}}],(r=[{key:"isEmote",get:function(){return a.M_EMOTE.matches(this.wireFormat.type)||(0,o.isProvided)(a.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return a.M_NOTICE.matches(this.wireFormat.type)||(0,o.isProvided)(a.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,a.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=g({},a.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;void 0!==t&&"text/plain"!==t||(e=g({},a.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:u(u({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}])&&h(t.prototype,r),i&&h(t,i),Object.defineProperty(t,"prototype",{writable:!1}),l}(n.ExtensibleEvent);e.exports.MessageEvent=v})),i.register("hI9Mb",(function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ExtensibleEvent=void 0;var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wireFormat=t}var t,i,n;return t=e,(i=[{key:"wireContent",get:function(){return this.wireFormat.content}}])&&r(t.prototype,i),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.ExtensibleEvent=i})),i.register("9JN1j",(function(e,t){function r(e){return null!=e}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isOptionalAString=function(e){return r(e)&&"string"==typeof e},e.exports.isProvided=r})),i.register("ihKsJ",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_TEXT=e.exports.M_NOTICE=e.exports.M_MESSAGE=e.exports.M_HTML=e.exports.M_EMOTE=void 0;var r=i("4k4R4"),n=new r.UnstableValue("m.message","org.matrix.msc1767.message");e.exports.M_MESSAGE=n;var o=new r.UnstableValue("m.text","org.matrix.msc1767.text");e.exports.M_TEXT=o;var s=new r.UnstableValue("m.html","org.matrix.msc1767.html");e.exports.M_HTML=s;var a=new r.UnstableValue("m.emote","org.matrix.msc1767.emote");e.exports.M_EMOTE=a;var c=new r.UnstableValue("m.notice","org.matrix.msc1767.notice");e.exports.M_NOTICE=c})),i.register("4k4R4",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=o(e);if(t){var s=o(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,i)}}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnstableValue=e.exports.NamespacedValue=void 0;var l=function(){function e(t,r){if(s(this,e),this.stable=t,this.unstable=r,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return c(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();e.exports.NamespacedValue=l;var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(r,e);var t=n(r);function r(e,i){var n;if(s(this,r),!(n=t.call(this,e,i)).unstable)throw new Error("Unstable value must be supplied");return n}return c(r,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),r}(l);e.exports.UnstableValue=u})),i.register("4Iqka",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var r=t,i=e;return r.matches(i.name)||r.matches(i.altName)}})),i.register("ltSOQ",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.NoticeEvent=void 0;var n=i("7i9Hl"),o=i("ihKsJ"),s=i("4Iqka");function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},l.apply(this,arguments)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=d(e);if(t){var o=d(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,i)}}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(f,e);var t,r,i,n=h(f);function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),n.call(this,e)}return t=f,i=[{key:"from",value:function(e,t){var r;return new f({type:o.M_NOTICE.name,content:(r={},a(r,o.M_TEXT.name,e),a(r,o.M_HTML.name,t),r)})}}],(r=[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,s.isEventTypeSame)(e,o.M_NOTICE)||l(d(f.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=l(d(f.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}])&&c(t.prototype,r),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),f}(n.MessageEvent);e.exports.NoticeEvent=f})),i.register("2ilqY",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EmoteEvent=void 0;var n=i("7i9Hl"),o=i("ihKsJ"),s=i("4Iqka");function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},l.apply(this,arguments)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=d(e);if(t){var o=d(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,i)}}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(f,e);var t,r,i,n=h(f);function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),n.call(this,e)}return t=f,i=[{key:"from",value:function(e,t){var r;return new f({type:o.M_EMOTE.name,content:(r={},a(r,o.M_TEXT.name,e),a(r,o.M_HTML.name,t),r)})}}],(r=[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,s.isEventTypeSame)(e,o.M_EMOTE)||l(d(f.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=l(d(f.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}])&&c(t.prototype,r),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),f}(n.MessageEvent);e.exports.EmoteEvent=f})),i.register("01mY3",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.parseMMessage=function(e){if(n.M_EMOTE.matches(e.type))return new o.EmoteEvent(e);if(n.M_NOTICE.matches(e.type))return new s.NoticeEvent(e);return new r.MessageEvent(e)};var r=i("7i9Hl"),n=i("ihKsJ"),o=i("2ilqY"),s=i("ltSOQ")})),i.register("iOEfK",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_POLL_START=e.exports.M_POLL_RESPONSE=e.exports.M_POLL_KIND_UNDISCLOSED=e.exports.M_POLL_KIND_DISCLOSED=e.exports.M_POLL_END=void 0;var r=i("4k4R4"),n=new r.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");e.exports.M_POLL_KIND_DISCLOSED=n;var o=new r.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");e.exports.M_POLL_KIND_UNDISCLOSED=o;var s=new r.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");e.exports.M_POLL_START=s;var a=new r.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");e.exports.M_POLL_RESPONSE=a;var c=new r.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");e.exports.M_POLL_END=c})),i.register("5gF5q",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.parseMPoll=function(e){if(r.M_POLL_START.matches(e.type))return new n.PollStartEvent(e);if(r.M_POLL_RESPONSE.matches(e.type))return new o.PollResponseEvent(e);if(r.M_POLL_END.matches(e.type))return new s.PollEndEvent(e);return null};var r=i("iOEfK"),n=i("k3thZ"),o=i("f6GOx"),s=i("7IS0W")})),i.register("k3thZ",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollStartEvent=e.exports.PollAnswerSubevent=void 0;var n=i("iOEfK"),o=i("7i9Hl"),s=i("ihKsJ"),a=i("2vZrC"),c=i("4k4R4"),l=i("4Iqka"),u=i("hI9Mb");function h(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function b(e,t){return b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},b(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=S(e);if(t){var o=S(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _(e)}(this,i)}}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=function(e){y(r,e);var t=w(r);function r(e){var i;m(this,r),E(_(i=t.call(this,e)),"id",void 0);var n=e.content.id;if(!n||"string"!=typeof n)throw new a.InvalidEventError("Answer ID must be a non-empty string");return i.id=n,i}return v(r,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:p({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new r({type:"org.matrix.sdk.poll.answer",content:E({id:e},s.M_TEXT.name,t)})}}]),r}(o.MessageEvent);e.exports.PollAnswerSubevent=M;var C=function(e){y(r,e);var t=w(r);function r(e){var i;m(this,r),E(_(i=t.call(this,e)),"question",void 0),E(_(i),"kind",void 0),E(_(i),"rawKind",void 0),E(_(i),"maxSelections",void 0),E(_(i),"answers",void 0);var s=n.M_POLL_START.findIn(i.wireContent);if(!s.question)throw new a.InvalidEventError("A question is required");if(i.question=new o.MessageEvent({type:"org.matrix.sdk.poll.question",content:s.question}),i.rawKind=s.kind,n.M_POLL_KIND_DISCLOSED.matches(i.rawKind)?i.kind=n.M_POLL_KIND_DISCLOSED:i.kind=n.M_POLL_KIND_UNDISCLOSED,i.maxSelections=Number.isFinite(s.max_selections)&&s.max_selections>0?s.max_selections:1,!Array.isArray(s.answers))throw new a.InvalidEventError("Poll answers must be an array");var c=s.answers.slice(0,20).map((function(e){return new M({type:"org.matrix.sdk.poll.answer",content:e})}));if(c.length<=0)throw new a.InvalidEventError("No answers available");return i.answers=c,i}return v(r,[{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,n.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:n.M_POLL_START.name,content:(e={},E(e,n.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map((function(e){return e.serialize().content}))}),E(e,s.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map((function(e,t){return"".concat(t+1,". ").concat(e.text)})).join("\n"))),e)}}}],[{key:"from",value:function(e,t,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new r({type:n.M_POLL_START.name,content:(o={},E(o,s.M_TEXT.name,e),E(o,n.M_POLL_START.name,{question:E({},s.M_TEXT.name,e),kind:i instanceof c.NamespacedValue?i.name:i,max_selections:a,answers:t.map((function(e){return E({id:h(Array(16)).map((function(){return I.charAt(Math.floor(Math.random()*I.length))})).join("")},s.M_TEXT.name,e)}))}),o)})}}]),r}(u.ExtensibleEvent);e.exports.PollStartEvent=C;var I="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"})),i.register("f6GOx",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollResponseEvent=void 0;var n=i("hI9Mb"),o=i("iOEfK"),s=i("2vZrC"),a=i("brH2J"),c=i("4Iqka");function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=f(e);if(t){var o=f(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,i)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(f,e);var t,r,i,n=h(f);function f(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),p(d(t=n.call(this,e)),"internalAnswerIds",void 0),p(d(t),"internalSpoiled",void 0),p(d(t),"pollEventId",void 0);var r=t.wireContent["m.relates_to"];if(!a.REFERENCE_RELATION.matches(null==r?void 0:r.rel_type)||"string"!=typeof(null==r?void 0:r.event_id))throw new s.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=r.event_id,t.validateAgainst(null),t}return t=f,i=[{key:"from",value:function(e,t){return new f({type:o.M_POLL_RESPONSE.name,content:p({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:t}},o.M_POLL_RESPONSE.name,{answers:e})})}}],(r=[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=o.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var r=t.answers;if(r.some((function(e){return"string"!=typeof e}))||0===r.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(r.some((function(t){return!e.answers.some((function(e){return e.id===t}))})))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);r=r.slice(0,e.maxSelections)}this.internalAnswerIds=r,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,o.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:o.M_POLL_RESPONSE.name,content:p({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:this.pollEventId}},o.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}])&&l(t.prototype,r),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),f}(n.ExtensibleEvent);e.exports.PollResponseEvent=m})),i.register("brH2J",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.REFERENCE_RELATION=void 0;var r=new(i("4k4R4").NamespacedValue)("m.reference");e.exports.REFERENCE_RELATION=r})),i.register("7IS0W",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollEndEvent=void 0;var n=i("iOEfK"),o=i("2vZrC"),s=i("brH2J"),a=i("7i9Hl"),c=i("ihKsJ"),l=i("4Iqka");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=g(e);if(t){var o=g(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,i)}}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(g,e);var t,r,i,u=p(g);function g(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),v(m(t=u.call(this,e)),"pollEventId",void 0),v(m(t),"closingMessage",void 0);var r=t.wireContent["m.relates_to"];if(!s.REFERENCE_RELATION.matches(null==r?void 0:r.rel_type)||"string"!=typeof(null==r?void 0:r.event_id))throw new o.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=r.event_id,t.closingMessage=new a.MessageEvent(t.wireFormat),t}return t=g,i=[{key:"from",value:function(e,t){var r;return new g({type:n.M_POLL_END.name,content:(r={"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:e}},v(r,n.M_POLL_END.name,{}),v(r,c.M_TEXT.name,t),r)})}}],(r=[{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,n.M_POLL_END)}},{key:"serialize",value:function(){return{type:n.M_POLL_END.name,content:h(v({"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:this.pollEventId}},n.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}])&&d(t.prototype,r),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),g}(i("hI9Mb").ExtensibleEvent);e.exports.PollEndEvent=y})),i.register("7JSYH",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("l4IA5",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LegacyMsgType=void 0,e.exports.isEventLike=function(e,t){var i=e.content;if(t===r.Text)return o.M_MESSAGE.matches(e.type)||"m.room.message"===e.type&&"m.text"===(null==i?void 0:i.msgtype);if(t===r.Emote)return o.M_EMOTE.matches(e.type)||"m.room.message"===e.type&&"m.emote"===(null==i?void 0:i.msgtype);if(t===r.Notice)return o.M_NOTICE.matches(e.type)||"m.room.message"===e.type&&"m.notice"===(null==i?void 0:i.msgtype);return!1};var r,n,o=i("ihKsJ");e.exports.LegacyMsgType=r,(n=r||(e.exports.LegacyMsgType=r={})).Text="m.text",n.Notice="m.notice",n.Emote="m.emote"})),i.register("cn4jF",(function(e,t){function r(e){return null!=e}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isOptionalAString=function(e){return r(e)&&"string"==typeof e},e.exports.isProvided=r})),i.register("cXHgq",(function(e,t){let r;var i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ReceiptType=e.exports.MAIN_ROOM_TIMELINE=void 0,e.exports.ReceiptType=r,(i=r||(e.exports.ReceiptType=r={})).Read="m.read",i.FullyRead="m.fully_read",i.ReadPrivate="m.read.private";e.exports.MAIN_ROOM_TIMELINE="main"})),i.register("fzuFx",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MemoryStore=void 0;var n=r(i("3EUCw")),o=i("fLhqT"),s=i("l2mJP");function a(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}e.exports.MemoryStore=class{constructor(e={}){(0,n.default)(this,"rooms",{}),(0,n.default)(this,"users",{}),(0,n.default)(this,"syncToken",null),(0,n.default)(this,"filters",{}),(0,n.default)(this,"accountData",{}),(0,n.default)(this,"localStorage",void 0),(0,n.default)(this,"oobMembers",{}),(0,n.default)(this,"pendingEvents",{}),(0,n.default)(this,"clientOptions",void 0),(0,n.default)(this,"pendingToDeviceBatches",[]),(0,n.default)(this,"nextToDeviceBatchId",0),(0,n.default)(this,"onRoomMember",((e,t,r)=>{if("invite"===r.membership)return;const i=this.users[r.userId]||new o.User(r.userId);r.name&&(i.setDisplayName(r.name),r.events.member&&i.setRawDisplayName(r.events.member.getDirectionalContent().displayname)),r.events.member&&r.events.member.getContent().avatar_url&&i.setAvatarUrl(r.events.member.getContent().avatar_url),this.users[i.userId]=i})),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(s.RoomStateEvent.Members,this.onRoomMember),e.currentState.getMembers().forEach((t=>{this.onRoomMember(null,e.currentState,t)}))}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(s.RoomStateEvent.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map((function(e){return e.summary}))}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,r,i){}storeFilter(e){null!=e&&e.userId&&null!=e&&e.filterId&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)}getFilter(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null}getFilterIdByName(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const e=this.localStorage.getItem(t);if(a(e))return e}catch(e){}return null}setFilterIdByName(e,t){if(!this.localStorage)return;const r="mxjssdk_memory_filter_"+e;try{a(t)?this.localStorage.setItem(r,t):this.localStorage.removeItem(r)}catch(e){}}storeAccountDataEvents(e){e.forEach((e=>{!Object.keys(e.getContent()).length?delete this.accountData[e.getType()]:this.accountData[e.getType()]=e}))}getAccountData(e){return this.accountData[e]}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers[e]||null)}setOutOfBandMembers(e,t){return this.oobMembers[e]=t,Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers={},Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}async getPendingEvents(e){var t;return null!==(t=this.pendingEvents[e])&&void 0!==t?t:[]}async setPendingEvents(e,t){this.pendingEvents[e]=t}saveToDeviceBatches(e){for(const t of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:t.eventType,txnId:t.txnId,batch:t.batch});return Promise.resolve()}async getOldestToDeviceBatch(){return 0===this.pendingToDeviceBatches.length?null:this.pendingToDeviceBatches[0]}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter((t=>t.id!==e)),Promise.resolve()}}})),i.register("fLhqT",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UserEvent=e.exports.User=void 0;var n=r(i("3EUCw")),o=i("75Qdj");let s;var a;e.exports.UserEvent=s,(a=s||(e.exports.UserEvent=s={})).DisplayName="User.displayName",a.AvatarUrl="User.avatarUrl",a.Presence="User.presence",a.CurrentlyActive="User.currentlyActive",a.LastPresenceTs="User.lastPresenceTs";class c extends o.TypedEventEmitter{constructor(e){super(),this.userId=e,(0,n.default)(this,"modified",-1),(0,n.default)(this,"displayName",void 0),(0,n.default)(this,"rawDisplayName",void 0),(0,n.default)(this,"avatarUrl",void 0),(0,n.default)(this,"presenceStatusMsg",void 0),(0,n.default)(this,"presence","offline"),(0,n.default)(this,"lastActiveAgo",0),(0,n.default)(this,"lastPresenceTs",0),(0,n.default)(this,"currentlyActive",!1),(0,n.default)(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}setPresenceEvent(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const r=[];(e.getContent().presence!==this.presence||t)&&r.push(s.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push(s.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push(s.DisplayName),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&r.push(s.CurrentlyActive),this.presence=e.getContent().presence,r.push(s.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(const t of r)this.emit(t,e,this)}setDisplayName(e){const t=this.displayName;this.displayName=e,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}e.exports.User=c})),i.register("75Qdj",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TypedEventEmitter=e.exports.EventEmitterEvents=void 0;var r=i("k4yOc");let n;var o;e.exports.EventEmitterEvents=n,(o=n||(e.exports.EventEmitterEvents=n={})).NewListener="newListener",o.RemoveListener="removeListener",o.Error="error";class s extends r.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e,...t){return super.emit(e,...t)}eventNames(){return super.eventNames()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}e.exports.TypedEventEmitter=s})),i.register("k4yOc",(function(e,t){var r,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,o),i(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&g(e,"error",t,r)}(e,n,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,r,i){var n,o,s,a;if(c(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),(n=l(e))>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=h.bind(i);return n.listener=r,i.wrapFn=n,n}function f(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):m(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function g(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(o){i.once&&e.removeEventListener(t,n),r(o)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,u=m(c,l);for(r=0;r<l;++r)n(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,o,s;if(c(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,o=Object.keys(r);for(i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}})),i.register("l2mJP",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomStateEvent=e.exports.RoomState=void 0;var n,o,s=r(i("3EUCw")),a=i("6koSf"),c=i("gEWrD"),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),u=i("ldT3p"),h=i("7BSj1"),d=i("8JM9X"),f=i("75Qdj"),p=i("6cjco"),m=i("eu84r"),g=i("iuO3m");function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let w;var _;(o=n||(n={}))[o.NotStarted=0]="NotStarted",o[o.InProgress=1]="InProgress",o[o.Finished=2]="Finished",e.exports.RoomStateEvent=w,(_=w||(e.exports.RoomStateEvent=w={})).Events="RoomState.events",_.Members="RoomState.members",_.NewMember="RoomState.newMember",_.Update="RoomState.update",_.BeaconLiveness="RoomState.BeaconLiveness",_.Marker="RoomState.Marker";class S extends f.TypedEventEmitter{constructor(e,t={status:n.NotStarted}){super(),this.roomId=e,this.oobMemberFlags=t,(0,s.default)(this,"reEmitter",new m.TypedReEmitter(this)),(0,s.default)(this,"sentinels",{}),(0,s.default)(this,"displayNameToUserIds",new Map),(0,s.default)(this,"userIdsToDisplayNames",{}),(0,s.default)(this,"tokenToInvite",{}),(0,s.default)(this,"joinedMemberCount",null),(0,s.default)(this,"summaryJoinedMemberCount",null),(0,s.default)(this,"invitedMemberCount",null),(0,s.default)(this,"summaryInvitedMemberCount",null),(0,s.default)(this,"modified",-1),(0,s.default)(this,"members",{}),(0,s.default)(this,"events",new Map),(0,s.default)(this,"paginationToken",null),(0,s.default)(this,"beacons",new Map),(0,s.default)(this,"_liveBeaconIds",[]),this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce(((e,t)=>"join"===t.membership?e+1:e),0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce(((e,t)=>"invite"===t.membership?e+1:e),0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter((t=>!e.includes(t.userId)))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let t=this.sentinels[e];if(void 0===t){t=new a.RoomMember(this.roomId,e);const r=this.members[e];null!=r&&r.events.member&&t.setMembershipEvent(r.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());const r=this.events.get(e).get(t);return r||null}get hasLiveBeacons(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){const e=new S(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=n.NotStarted,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==n.Finished&&this.getMembers().forEach((t=>{var r;t.isOutOfBand()&&(null===(r=e.getMember(t.userId))||void 0===r||r.markOutOfBand())})),e}setUnknownStateEvents(e){const t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)}setStateEvents(e,t){this.updateModifiedTime(),e.forEach((e=>{if(e.getRoomId()!==this.roomId||!e.isState())return;g.M_BEACON_INFO.matches(e.getType())&&this.setBeacon(e);const t=this.getStateEventMatching(e);var r;(this.setStateEvent(e),e.getType()===u.EventType.RoomMember)&&(this.updateDisplayNameCache(e.getStateKey(),null!==(r=e.getContent().displayname)&&void 0!==r?r:""),this.updateThirdPartyTokenCache(e));this.emit(w.Events,e,this,t)})),this.onBeaconLivenessChange(),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===u.EventType.RoomMember){const t=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const r=this.getOrCreateMember(t,e);r.setMembershipEvent(e,this),this.updateMember(r),this.emit(w.Members,e,this,r)}else if(e.getType()===u.EventType.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(this.members).forEach((t=>{const r=t.getLastModifiedTime();t.setPowerLevelEvent(e),r!==t.getLastModifiedTime()&&this.emit(w.Members,e,this,t)})),this.sentinels={}}else u.UNSTABLE_MSC2716_MARKER.matches(e.getType())&&this.emit(w.Marker,e,t)})),this.emit(w.Update,this)}processBeaconEvents(e,t){if(!e.length||!this.beacons.size)return;const r=[...this.beacons.values()].reduce(((e,t)=>b(b({},e),{},{[t.beaconInfoId]:t})),{}),i=(e,t)=>{if(!g.M_BEACON.matches(t.getType()))return;const i=r[e];i&&i.addLocations([t])};e.forEach((e=>{var n;const o=null===(n=e.getRelation())||void 0===n?void 0:n.event_id;o&&r[o]&&(t.decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()?e.once(h.MatrixEventEvent.Decrypted,(async()=>{i(o,e)})):i(o,e))}))}getOrCreateMember(e,t){let r=this.members[e];return r||(r=new a.RoomMember(this.roomId,e),this.members[e]=r,this.emit(w.NewMember,t,this,r)),r}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){const t=(0,p.getBeaconInfoIdentifier)(e);if(this.beacons.has(t)){const i=this.beacons.get(t);var r;return e.isRedacted()?void(i.beaconInfoId===(null===(r=e.getRedactionEvent())||void 0===r?void 0:r.redacts)&&(i.destroy(),this.beacons.delete(t))):i.update(e)}if(e.isRedacted())return;const i=new p.Beacon(e);this.reEmitter.reEmit(i,[p.BeaconEvent.New,p.BeaconEvent.Update,p.BeaconEvent.Destroy,p.BeaconEvent.LivenessChange]),this.emit(p.BeaconEvent.New,e,i),i.on(p.BeaconEvent.LivenessChange,this.onBeaconLivenessChange.bind(this)),i.on(p.BeaconEvent.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(i.identifier,i)}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter((e=>e.isLive)).map((e=>e.identifier)),this.emit(w.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var t,r;return null!==(t=null===(r=this.events.get(e.getType()))||void 0===r?void 0:r.get(e.getStateKey()))&&void 0!==t?t:null}updateMember(e){const t=this.getStateEvents(u.EventType.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===n.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===n.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===n.NotStarted&&(this.oobMemberFlags.status=n.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===n.InProgress&&(this.oobMemberFlags.status=n.NotStarted)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),c.logger.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=n.NotStarted}setOutOfBandMembers(e){c.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===n.InProgress&&(c.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=n.Finished,e.forEach((e=>this.setOutOfBandMember(e))),this.emit(w.Update,this))}setOutOfBandMember(e){if(e.getType()!==u.EventType.RoomMember)return;const t=e.getStateKey(),r=this.getMember(t);if(r&&!r.isOutOfBand())return;const i=this.getOrCreateMember(t,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit(w.Members,e,this,i)}setTypingEvent(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var t;return null!==(t=this.displayNameToUserIds.get(l.removeHiddenChars(e)))&&void 0!==t?t:[]}maySendRedactionForEvent(e,t){const r=this.getMember(t);if(!r||"leave"===r.membership)return!1;if(e.status||e.isRedacted())return!1;const i=this.maySendEvent(u.EventType.RoomRedaction,t);return e.getSender()===t?i:this.hasSufficientPowerLevelFor("redact",r.powerLevel)}hasSufficientPowerLevelFor(e,t){const r=this.getStateEvents(u.EventType.RoomPowerLevels,"");let i={};r&&(i=r.getContent());let n=50;return l.isNumber(i[e])&&(n=i[e]),t>=n}maySendMessage(e){return this.maySendEventOfType(u.EventType.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!(t.isGuest()||!t.credentials.userId)&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,r){const i=this.getStateEvents(u.EventType.RoomPowerLevels,"");let n,o={},s=0,a=0,c=0;if(i){n=i.getContent(),o=n.events||{},s=Number.isSafeInteger(n.state_default)?n.state_default:50;const e=n.users&&n.users[t];Number.isSafeInteger(e)?c=e:Number.isSafeInteger(n.users_default)&&(c=n.users_default),Number.isSafeInteger(n.events_default)&&(a=n.events_default)}let l=r?s:a;return Number.isSafeInteger(o[e])&&(l=o[e]),c>=l}mayTriggerNotifOfType(e,t){const r=this.getMember(t);if(!r)return!1;const i=this.getStateEvents(u.EventType.RoomPowerLevels,"");let n=50;return i&&i.getContent()&&i.getContent().notifications&&l.isNumber(i.getContent().notifications[e])&&(n=i.getContent().notifications[e]),r.powerLevel>=n}getJoinRule(){var e;const t=this.getStateEvents(u.EventType.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||d.JoinRule.Invite}getHistoryVisibility(){var e;const t=this.getStateEvents(u.EventType.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||d.HistoryVisibility.Shared}getGuestAccess(){var e;const t=this.getStateEvents(u.EventType.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||d.GuestAccess.Forbidden}findPredecessor(e=!1){if(e){const e=this.getStateEvents(u.EventType.RoomPredecessor,"");if(e){const t=e.getContent().predecessor_room_id;let r=e.getContent().last_known_event_id;if("string"!=typeof r&&(r=null),"string"==typeof t)return{roomId:t,eventId:r}}}const t=this.getStateEvents(u.EventType.RoomCreate,"");if(t){const e=t.getContent().predecessor;if(e){const t=e.room_id;if("string"==typeof t){let r=e.event_id;return"string"==typeof r&&""!==r||(r=null),{roomId:t,eventId:r}}}}return null}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const t=(e.getContent().third_party_invite.signed||{}).token;if(!t)return;this.getStateEvents(u.EventType.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}updateDisplayNameCache(e,t){const r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){const t=l.removeHiddenChars(r),i=this.displayNameToUserIds.get(t);if(i){const r=i.filter((t=>t!==e));this.displayNameToUserIds.set(t,r)}}this.userIdsToDisplayNames[e]=t;const i=t&&l.removeHiddenChars(t);if(i){var n;const t=null!==(n=this.displayNameToUserIds.get(i))&&void 0!==n?n:[];t.push(e),this.displayNameToUserIds.set(i,t)}}}e.exports.RoomState=S})),i.register("6koSf",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomMemberEvent=e.exports.RoomMember=void 0;var n=r(i("3EUCw")),o=i("juNaO"),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),a=i("gEWrD"),c=i("75Qdj"),l=i("ldT3p");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}let h;var d;e.exports.RoomMemberEvent=h,(d=h||(e.exports.RoomMemberEvent=h={})).Membership="RoomMember.membership",d.Name="RoomMember.name",d.PowerLevel="RoomMember.powerLevel",d.Typing="RoomMember.typing";class f extends c.TypedEventEmitter{constructor(e,t){super(),this.roomId=e,this.userId=t,(0,n.default)(this,"_isOutOfBand",!1),(0,n.default)(this,"modified",-1),(0,n.default)(this,"requestedProfileInfo",!1),(0,n.default)(this,"typing",!1),(0,n.default)(this,"name",void 0),(0,n.default)(this,"rawDisplayName",void 0),(0,n.default)(this,"powerLevel",0),(0,n.default)(this,"powerLevelNorm",0),(0,n.default)(this,"user",void 0),(0,n.default)(this,"membership",void 0),(0,n.default)(this,"disambiguate",!1),(0,n.default)(this,"events",{}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){var r,i;const n=null!==(r=e.getDirectionalContent().displayname)&&void 0!==r?r:"";if(e.getType()!==l.EventType.RoomMember)return;this._isOutOfBand=!1,this.events.member=e;const o=this.membership;this.membership=e.getDirectionalContent().membership,void 0===this.membership&&a.logger.trace(`membership event with membership undefined (forwardLooking: ${e.forwardLooking})!`,e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=function(e,t,r){if(!t||t===e)return!1;if(!s.removeHiddenChars(t))return!1;if(!r)return!1;if(p.test(t))return!0;if(m.test(t))return!0;const i=r.getUserIdsWithDisplayName(t);return!!i.some((t=>t!==e))}(this.userId,n,t);const c=this.name;this.name=function(e,t,r){return t&&t!==e?r?s.removeDirectionOverrideChars(t)+" ("+e+")":s.removeHiddenChars(t)?s.removeDirectionOverrideChars(t):e:e}(this.userId,n,this.disambiguate),this.rawDisplayName=s.removeDirectionOverrideChars(null!==(i=e.getDirectionalContent().displayname)&&void 0!==i?i:""),this.rawDisplayName&&s.removeHiddenChars(this.rawDisplayName)||(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(h.Membership,e,this,o)),c!==this.name&&(this.updateModifiedTime(),this.emit(h.Name,e,this,c))}setPowerLevelEvent(e){if(e.getType()!==l.EventType.RoomPowerLevels||""!==e.getStateKey())return;const t=e.getDirectionalContent();let r=t.users_default||0;const i=t.users||{};Object.values(i).forEach((e=>{r=Math.max(r,e)}));const n=this.powerLevel,o=this.powerLevelNorm;void 0!==i[this.userId]&&Number.isInteger(i[this.userId])?this.powerLevel=i[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,r>0&&(this.powerLevelNorm=100*this.powerLevel/r),n===this.powerLevel&&o===this.powerLevelNorm||(this.updateModifiedTime(),this.emit(h.PowerLevel,e,this))}setTypingEvent(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const r=e.getContent().user_ids;Array.isArray(r)&&(-1!==r.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit(h.Typing,e,this)))}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return"leave"===this.membership&&void 0!==this.events.member&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const e=this.events.member;let t=e.getContent(),r=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),r=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return r}}getAvatarUrl(e,t,r,i,n=!0,s){const a=this.getMxcAvatarUrl();if(!a&&!n)return null;const c=(0,o.getHttpUriForMxc)(e,a,t,r,i,s);return c||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:void 0}}e.exports.RoomMember=f;const p=/@.+:.+/,m=/[\u200E\u200F\u202A-\u202F]/})),i.register("juNaO",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.getHttpUriForMxc=function(e,t,i,n,o,s=!1){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return s?t:"";let a=t.slice(6),c="/_matrix/media/r0/download/";const l={};i&&(l.width=Math.round(i).toString());n&&(l.height=Math.round(n).toString());o&&(l.method=o);Object.keys(l).length>0&&(c="/_matrix/media/r0/thumbnail/");const u=a.indexOf("#");let h="";u>=0&&(h=a.slice(u),a=a.slice(0,u));const d=0===Object.keys(l).length?"":"?"+r.encodeParams(l);return e+c+a+d+h};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}})),i.register("ldT3p",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UNSTABLE_MSC3089_TREE_SUBTYPE=e.exports.UNSTABLE_MSC3089_LEAF=e.exports.UNSTABLE_MSC3089_BRANCH=e.exports.UNSTABLE_MSC3088_PURPOSE=e.exports.UNSTABLE_MSC3088_ENABLED=e.exports.UNSTABLE_MSC2716_MARKER=e.exports.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=e.exports.ToDeviceMessageId=e.exports.RoomType=e.exports.RoomCreateTypeField=e.exports.RelationType=e.exports.PUSHER_ENABLED=e.exports.PUSHER_DEVICE_ID=e.exports.MsgType=e.exports.MSC3912_RELATION_BASED_REDACTIONS_PROP=e.exports.LOCAL_NOTIFICATION_SETTINGS_PREFIX=e.exports.EventType=e.exports.EVENT_VISIBILITY_CHANGE_TYPE=void 0;var r=i("1c8ok");let n;var o;let s;var a;let c;var l;e.exports.EventType=n,(o=n||(e.exports.EventType=n={})).RoomCanonicalAlias="m.room.canonical_alias",o.RoomCreate="m.room.create",o.RoomJoinRules="m.room.join_rules",o.RoomMember="m.room.member",o.RoomThirdPartyInvite="m.room.third_party_invite",o.RoomPowerLevels="m.room.power_levels",o.RoomName="m.room.name",o.RoomTopic="m.room.topic",o.RoomAvatar="m.room.avatar",o.RoomPinnedEvents="m.room.pinned_events",o.RoomEncryption="m.room.encryption",o.RoomHistoryVisibility="m.room.history_visibility",o.RoomGuestAccess="m.room.guest_access",o.RoomServerAcl="m.room.server_acl",o.RoomTombstone="m.room.tombstone",o.RoomPredecessor="org.matrix.msc3946.room_predecessor",o.SpaceChild="m.space.child",o.SpaceParent="m.space.parent",o.RoomRedaction="m.room.redaction",o.RoomMessage="m.room.message",o.RoomMessageEncrypted="m.room.encrypted",o.Sticker="m.sticker",o.CallInvite="m.call.invite",o.CallCandidates="m.call.candidates",o.CallAnswer="m.call.answer",o.CallHangup="m.call.hangup",o.CallReject="m.call.reject",o.CallSelectAnswer="m.call.select_answer",o.CallNegotiate="m.call.negotiate",o.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",o.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",o.CallReplaces="m.call.replaces",o.CallAssertedIdentity="m.call.asserted_identity",o.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",o.KeyVerificationRequest="m.key.verification.request",o.KeyVerificationStart="m.key.verification.start",o.KeyVerificationCancel="m.key.verification.cancel",o.KeyVerificationMac="m.key.verification.mac",o.KeyVerificationDone="m.key.verification.done",o.KeyVerificationKey="m.key.verification.key",o.KeyVerificationAccept="m.key.verification.accept",o.KeyVerificationReady="m.key.verification.ready",o.RoomMessageFeedback="m.room.message.feedback",o.Reaction="m.reaction",o.PollStart="org.matrix.msc3381.poll.start",o.Typing="m.typing",o.Receipt="m.receipt",o.Presence="m.presence",o.FullyRead="m.fully_read",o.Tag="m.tag",o.SpaceOrder="org.matrix.msc3230.space_order",o.PushRules="m.push_rules",o.Direct="m.direct",o.IgnoredUserList="m.ignored_user_list",o.RoomKey="m.room_key",o.RoomKeyRequest="m.room_key_request",o.ForwardedRoomKey="m.forwarded_room_key",o.Dummy="m.dummy",o.GroupCallPrefix="org.matrix.msc3401.call",o.GroupCallMemberPrefix="org.matrix.msc3401.call.member",e.exports.RelationType=s,(a=s||(e.exports.RelationType=s={})).Annotation="m.annotation",a.Replace="m.replace",a.Reference="m.reference",a.Thread="m.thread",e.exports.MsgType=c,(l=c||(e.exports.MsgType=c={})).Text="m.text",l.Emote="m.emote",l.Notice="m.notice",l.Image="m.image",l.File="m.file",l.Audio="m.audio",l.Location="m.location",l.Video="m.video",l.KeyVerificationRequest="m.key.verification.request";let u;var h;e.exports.RoomCreateTypeField="type",e.exports.RoomType=u,(h=u||(e.exports.RoomType=u={})).Space="m.space",h.UnstableCall="org.matrix.msc3417.call",h.ElementVideo="io.element.video";e.exports.ToDeviceMessageId="org.matrix.msgid";const d=new r.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose");e.exports.UNSTABLE_MSC3088_PURPOSE=d;const f=new r.UnstableValue("m.enabled","org.matrix.msc3088.enabled");e.exports.UNSTABLE_MSC3088_ENABLED=f;const p=new r.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree");e.exports.UNSTABLE_MSC3089_TREE_SUBTYPE=p;const m=new r.UnstableValue("m.leaf","org.matrix.msc3089.leaf");e.exports.UNSTABLE_MSC3089_LEAF=m;const g=new r.UnstableValue("m.branch","org.matrix.msc3089.branch");e.exports.UNSTABLE_MSC3089_BRANCH=g;const v=new r.UnstableValue("m.room.marker","org.matrix.msc2716.marker");e.exports.UNSTABLE_MSC2716_MARKER=v;const y=new r.UnstableValue("with_relations","org.matrix.msc3912.with_relations");e.exports.MSC3912_RELATION_BASED_REDACTIONS_PROP=y;const b=new r.UnstableValue("io.element.functional_members","io.element.functional_members");e.exports.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=b;const w=new r.UnstableValue("m.visibility","org.matrix.msc3531.visibility");e.exports.EVENT_VISIBILITY_CHANGE_TYPE=w;const _=new r.UnstableValue("enabled","org.matrix.msc3881.enabled");e.exports.PUSHER_ENABLED=_;const S=new r.UnstableValue("device_id","org.matrix.msc3881.device_id");e.exports.PUSHER_DEVICE_ID=S;const E=new r.UnstableValue("m.local_notification_settings","org.matrix.msc3890.local_notification_settings");e.exports.LOCAL_NOTIFICATION_SETTINGS_PREFIX=E})),i.register("7BSj1",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),Object.defineProperty(e.exports,"EventStatus",{enumerable:!0,get:function(){return f.EventStatus}}),e.exports.MatrixEventEvent=e.exports.MatrixEvent=void 0;var n=r(i("3EUCw")),o=i("e0VXi"),s=i("gEWrD"),a=i("ldT3p"),c=i("gjhRv"),l=i("etzbv"),u=i("eu84r"),h=i("75Qdj"),d=i("8iY8t"),f=i("hGOrY");const p=Object.freeze({visible:!0});let m;var g;e.exports.MatrixEventEvent=m,(g=m||(e.exports.MatrixEventEvent=m={})).Decrypted="Event.decrypted",g.BeforeRedaction="Event.beforeRedaction",g.VisibilityChange="Event.visibilityChange",g.LocalEventIdReplaced="Event.localEventIdReplaced",g.Status="Event.status",g.Replaced="Event.replaced",g.RelationsCreated="Event.relationsCreated";class v extends h.TypedEventEmitter{constructor(e={}){var t;super(),this.event=e,(0,n.default)(this,"pushActions",null),(0,n.default)(this,"_replacingEvent",null),(0,n.default)(this,"_localRedactionEvent",null),(0,n.default)(this,"_isCancelled",!1),(0,n.default)(this,"clearEvent",void 0),(0,n.default)(this,"visibility",p),(0,n.default)(this,"_hasCachedExtEv",!1),(0,n.default)(this,"_cachedExtEv",void 0),(0,n.default)(this,"senderCurve25519Key",null),(0,n.default)(this,"claimedEd25519Key",null),(0,n.default)(this,"forwardingCurve25519KeyChain",[]),(0,n.default)(this,"untrusted",null),(0,n.default)(this,"decryptionPromise",null),(0,n.default)(this,"retryDecryption",!1),(0,n.default)(this,"txnId",void 0),(0,n.default)(this,"thread",void 0),(0,n.default)(this,"threadId",void 0),(0,n.default)(this,"localTimestamp",void 0),(0,n.default)(this,"sender",null),(0,n.default)(this,"target",null),(0,n.default)(this,"status",null),(0,n.default)(this,"error",null),(0,n.default)(this,"forwardLooking",!0),(0,n.default)(this,"verificationRequest",void 0),(0,n.default)(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((t=>{"string"==typeof e[t]&&(e[t]=(0,c.internaliseString)(e[t]))})),["membership","avatar_url","displayname"].forEach((t=>{var r;"string"==typeof(null===(r=e.content)||void 0===r?void 0:r[t])&&(e.content[t]=(0,c.internaliseString)(e.content[t]))})),["rel_type"].forEach((t=>{var r,i;"string"==typeof(null===(r=e.content)||void 0===r||null===(i=r["m.relates_to"])||void 0===i?void 0:i[t])&&(e.content["m.relates_to"][t]=(0,c.internaliseString)(e.content["m.relates_to"][t]))})),this.txnId=e.txn_id,this.localTimestamp=Date.now()-(null!==(t=this.getAge())&&void 0!==t?t:0),this.reEmitter=new u.TypedReEmitter(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=o.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){const e=Object.assign({},this.getContent());if(this.getWireType()===a.EventType.RoomMessageEncrypted)for(const[t,r]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||void 0===e[t]&&(e[t]=r);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender||this.event.user_id}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){let e=`id=${this.getId()} type=${this.getWireType()} sender=${this.getSender()}`;const t=this.getRoomId();t&&(e+=` room=${t}`);const r=this.getDate();return r&&(e+=` ts=${r.toISOString()}`),e}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var e;const t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];return(null==t?void 0:t.rel_type)===l.THREAD_RELATION_TYPE.name?t.event_id:(null===(r=this.getThread())||void 0===r?void 0:r.id)||this.threadId;var r}get isThreadRoot(){var e;return!!this.getServerAggregatedRelation(l.THREAD_RELATION_TYPE.name)||(null===(e=this.getThread())||void 0===e?void 0:e.id)===this.getId()}get replyEventId(){var e;const t=this.getContent()["m.relates_to"]||this.getWireContent()["m.relates_to"];return null==t||null===(e=t["m.in_reply_to"])||void 0===e?void 0:e.event_id}get relationEventId(){var e,t;return null===(e=this.getWireContent())||void 0===e||null===(t=e["m.relates_to"])||void 0===t?void 0:t.event_id}getPrevContent(){return this.getUnsigned().prev_content||this.event.prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age||this.event.age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}makeEncrypted(e,t,r,i){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=r,this.claimedEd25519Key=i}isBeingDecrypted(){return null!=this.decryptionPromise}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){var e,t;return"m.bad.encrypted"===(null===(e=this.clearEvent)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.msgtype)}shouldAttemptDecryption(){return!this.isRedacted()&&(!this.isBeingDecrypted()&&(!this.clearEvent&&!!this.isEncrypted()))}async attemptDecryption(e,t={}){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");const r=this.clearEvent&&!this.isDecryptionFailure(),i=t.forceRedecryptIfUntrusted&&this.isKeySourceUntrusted();if(r&&!i)throw new Error("Attempt to decrypt event which has already been decrypted");return this.decryptionPromise?(s.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this.decryptionPromise):(this.decryptionPromise=this.decryptionLoop(e,t),this.decryptionPromise)}cancelAndResendKeyRequest(e,t){const r=this.getWireContent();return e.requestRoomKey({algorithm:r.algorithm,room_id:this.getRoomId(),session_id:r.session_id,sender_key:r.sender_key},this.getKeyRequestRecipients(t),!0)}getKeyRequestRecipients(e){const t=this.getWireContent(),r=[{userId:e,deviceId:"*"}],i=this.getSender();return i!==e&&r.push({userId:i,deviceId:t.device_id}),r}async decryptionLoop(e,t={}){for(await Promise.resolve();;){let r,i;this.retryDecryption=!1;try{e?(r=await e.decryptEvent(this),!0===t.isRetry&&s.logger.info(`Decrypted event on retry (${this.getDetails()})`)):r=this.badEncryptedMessage("Encryption not enabled")}catch(e){const t=e instanceof d.DecryptionError?e.detailedString:String(e);if(i=e,this.retryDecryption){s.logger.log(`Error decrypting event (${this.getDetails()}), but retrying: ${t}`);continue}s.logger.warn(`Error decrypting event (${this.getDetails()}): ${t}`),r=this.badEncryptedMessage(String(e))}return this.decryptionPromise=null,this.retryDecryption=!1,this.setClearData(r),this.setPushActions(null),void(!1!==t.emit&&this.emit(m.Decrypted,this,i))}}badEncryptedMessage(e){return{clearEvent:{type:a.EventType.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}}setClearData(e){var t,r;this.clearEvent=e.clearEvent,this.senderCurve25519Key=null!==(t=e.senderCurve25519Key)&&void 0!==t?t:null,this.claimedEd25519Key=null!==(r=e.claimedEd25519Key)&&void 0!==r?r:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===a.EventType.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(m.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var t,r;const i=null===(t=null==e?void 0:e.visible)||void 0===t||t,n=null!==(r=null==e?void 0:e.reason)&&void 0!==r?r:null;let o=!1;this.visibility.visible!==i?o=!0:this.visibility.visible||this.visibility.reason===n||(o=!0),o&&(this.visibility=i?p:Object.freeze({visible:!1,reason:n}),this.emit(m.VisibilityChange,this,i))}messageVisibility(){return this.visibility}makeRedacted(e){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit(m.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(const e in this.event)this.event.hasOwnProperty(e)&&!y.has(e)&&delete this.event[e];this.isEncrypted()&&(this.clearEvent=void 0);const t=this.getType()in b?b[this.getType()]:{},r=this.getContent();for(const e in r)r.hasOwnProperty(e)&&!t[e]&&delete r[e];this.invalidateExtensibleEvent()}isRedacted(){return Boolean(this.getUnsigned().redacted_because)}isRedaction(){return this.getType()===a.EventType.RoomRedaction}asVisibilityChange(){if(!a.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType()))return null;const e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;const t=e.event_id;if(!t)return null;const r=this.getWireContent(),i=!!r.visible,n=r.reason;return n&&"string"!=typeof n?null:{visible:i,reason:n,eventId:t}}isVisibilityEvent(){return a.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType())}getRedactionEvent(){var e,t,r,i;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null!==(r=null===(i=this.clearEvent)||void 0===i?void 0:i.unsigned.redacted_because)&&void 0!==r?r:null:null!==(t=this.event.unsigned)&&void 0!==t&&t.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushActions}setPushActions(e){this.pushActions=e}handleRemoteEcho(e){const t=this.getUnsigned(),r=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit(m.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-this.getAge()}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(m.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(m.LocalEventIdReplaced,this)}isRelation(e){var t;const r=null===(t=this.getWireContent())||void 0===t?void 0:t["m.relates_to"];return(!this.isState()||(null==r?void 0:r.rel_type)!==a.RelationType.Replace)&&!(null==r||!r.rel_type||!r.event_id||e&&r.rel_type!==e)}getRelation(){var e;return this.isRelation()&&null!==(e=this.getWireContent()["m.relates_to"])&&void 0!==e?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=null!=e?e:null,this.emit(m.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}replacingEventId(){const e=this.getServerAggregatedRelation(a.RelationType.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){const e=this.getServerAggregatedRelation(a.RelationType.Replace);if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent){var t;return null!==(t=this._replacingEvent.getDate())&&void 0!==t?t:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const e=this.getRelation();return this.replyEventId?this.replyEventId:e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssocation(){return!!this.getAssociatedId()}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(e=!0){this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){const e=new v(JSON.parse(JSON.stringify(this.event)));for(const[t,r]of Object.entries(this))"event"!==t&&(e[t]=r);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;const t=(0,c.deepSortedObjectEntries)(this.event),r=(0,c.deepSortedObjectEntries)(e.event);return JSON.stringify(t)===JSON.stringify(r)}toJSON(){const e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setVerificationRequest(e){this.verificationRequest=e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.thread&&this.reEmitter.stopReEmitting(this.thread,[l.ThreadEvent.Update]),this.thread=e,this.setThreadId(null==e?void 0:e.id),e&&this.reEmitter.reEmit(e,[l.ThreadEvent.Update])}getThread(){return this.thread}setThreadId(e){this.threadId=e}}e.exports.MatrixEvent=v;const y=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),b={[a.EventType.RoomMember]:{membership:1},[a.EventType.RoomCreate]:{creator:1},[a.EventType.RoomJoinRules]:{join_rule:1},[a.EventType.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}}})),i.register("etzbv",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ThreadFilterType=e.exports.ThreadEvent=e.exports.Thread=e.exports.THREAD_RELATION_TYPE=e.exports.FeatureSupport=e.exports.FILTER_RELATED_BY_SENDERS=e.exports.FILTER_RELATED_BY_REL_TYPES=void 0,e.exports.determineFeatureSupport=function(e,t){return e?w.Stable:t?w.Experimental:w.None},e.exports.threadFilterTypeToFilter=function(e){if(e===I.My)return"participated";return"all"};var n=r(i("3EUCw")),o=i("5pxqF"),s=i("eu84r"),a=i("ldT3p"),c=i("7BSj1"),l=i("jxKcy"),u=i("d1gZy"),h=i("846Vo"),d=i("1c8ok"),f=i("gEWrD"),p=i("auLUJ"),m=i("cXHgq");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let y;var b;let w;var _;e.exports.ThreadEvent=y,(b=y||(e.exports.ThreadEvent=y={})).New="Thread.new",b.Update="Thread.update",b.NewReply="Thread.newReply",b.ViewThread="Thread.viewThread",b.Delete="Thread.delete",e.exports.FeatureSupport=w,(_=w||(e.exports.FeatureSupport=w={}))[_.None=0]="None",_[_.Experimental=1]="Experimental",_[_.Stable=2]="Stable";class S extends p.ReadReceipt{constructor(e,t,r){var i;if(super(),this.id=e,this.rootEvent=t,(0,n.default)(this,"timelineSet",void 0),(0,n.default)(this,"timeline",[]),(0,n.default)(this,"_currentUserParticipated",!1),(0,n.default)(this,"reEmitter",void 0),(0,n.default)(this,"lastEvent",void 0),(0,n.default)(this,"replyCount",0),(0,n.default)(this,"lastPendingEvent",void 0),(0,n.default)(this,"pendingReplyCount",0),(0,n.default)(this,"room",void 0),(0,n.default)(this,"client",void 0),(0,n.default)(this,"pendingEventOrdering",void 0),(0,n.default)(this,"initialEventsFetched",!S.hasServerSideSupport),(0,n.default)(this,"replayEvents",[]),(0,n.default)(this,"onBeforeRedaction",((e,t)=>{null!=e&&e.isRelation(C.name)&&this.room.eventShouldLiveIn(e).threadId===this.id&&e.getId()!==this.id&&!t.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(y.Update,this))})),(0,n.default)(this,"onRedaction",(async e=>{if(e.threadRootId===this.id)if(this.replyCount<=0){for(const e of this.timeline)this.clearEventMetadata(e);this.lastEvent=this.rootEvent,this._currentUserParticipated=!1,this.emit(y.Delete,this)}else await this.updateThreadMetadata()})),(0,n.default)(this,"onTimelineEvent",((e,t,r)=>{r||t.addLocalEchoReceipt(e.getSender(),e,m.ReceiptType.Read),this.onEcho(e,null!=r&&r)})),(0,n.default)(this,"onLocalEcho",(e=>{this.onEcho(e,!1)})),(0,n.default)(this,"onEcho",(async(e,t)=>{e.threadRootId===this.id&&this.lastEvent!==e&&(await this.updateThreadMetadata(),e.isRelation(C.name)&&(t||this.emit(y.NewReply,this,e)))})),null==r||!r.room)throw new Error("element-web#22141: A thread requires a room in order to function");this.room=r.room,this.client=r.client,this.pendingEventOrdering=null!==(i=r.pendingEventOrdering)&&void 0!==i?i:o.PendingEventOrdering.Chronological,this.timelineSet=new u.EventTimelineSet(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new s.TypedReEmitter(this),this.reEmitter.reEmit(this.timelineSet,[h.RoomEvent.Timeline,h.RoomEvent.TimelineReset]),this.room.on(c.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.room.on(h.RoomEvent.Redaction,this.onRedaction),this.room.on(h.RoomEvent.LocalEchoUpdated,this.onLocalEcho),this.timelineSet.on(h.RoomEvent.Timeline,this.onTimelineEvent),this.processReceipts(r.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}async fetchRootEvent(){this.rootEvent=this.room.findEventById(this.id);try{const e=await this.client.fetchRoomEvent(this.roomId,this.id),t=this.client.getEventMapper();this.rootEvent=t(e)}catch(e){f.logger.error("Failed to fetch thread root to construct thread with",e)}await this.processEvent(this.rootEvent)}static setServerSideSupport(e){S.hasServerSideSupport=e,e!==w.Stable&&(E.setPreferUnstable(!0),M.setPreferUnstable(!0),C.setPreferUnstable(!0))}static setServerSideListSupport(e){S.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){S.hasServerSideFwdPaginationSupport=e}get roomState(){return this.room.getLiveTimeline().getState(l.EventTimeline.FORWARDS)}addEventToTimeline(e,t){this.findEventById(e.getId())||(this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState}),this.timeline=this.events)}addEvents(e,t){e.forEach((e=>this.addEvent(e,t,!1))),this.updateThreadMetadata()}async addEvent(e,t,r=!0){this.setEventMetadata(e);const i=this.lastReply(),n=!i||e.localTimestamp>=i.localTimestamp;if(S.hasServerSideSupport){if(!t&&this.initialEventsFetched&&n)this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e);else if(e.isRelation(a.RelationType.Annotation)||e.isRelation(a.RelationType.Replace)){var o,s,c;if(this.initialEventsFetched)this.addEventToTimeline(e,t);else null===(c=this.replayEvents)||void 0===c||c.push(e);return null===(o=this.timelineSet.relations)||void 0===o||o.aggregateParentEvent(e),void(null===(s=this.timelineSet.relations)||void 0===s||s.aggregateChildEvent(e,this.timelineSet))}}else this.addEventToTimeline(e,t),this.client.decryptEventIfNeeded(e,{});S.hasServerSideSupport&&this.rootEvent||!e.isRelation(C.name)||this.replyCount++,r&&(this.emit(y.NewReply,this,e),this.updateThreadMetadata())}async processEvent(e){e&&(this.setEventMetadata(e),await this.fetchEditsWhereNeeded(e)),this.timeline=this.events}processReceipts(e=[]){for(const{eventId:t,receiptType:r,userId:i,receipt:n,synthetic:o}of e)this.addReceiptToStructure(t,r,i,n,o)}getRootEventBundledRelationship(e=this.rootEvent){return null==e?void 0:e.getServerAggregatedRelation(C.name)}async processRootEvent(){const e=this.getRootEventBundledRelationship();if(S.hasServerSideSupport&&e){this.replyCount=e.count,this._currentUserParticipated=!!e.current_user_participated;const t=this.client.getEventMapper();this.lastEvent=t(v(v({},e.latest_event),{},{room_id:this.roomId})),this.updatePendingReplyCount(),await this.processEvent(this.lastEvent)}}updatePendingReplyCount(){const e=(this.pendingEventOrdering===o.PendingEventOrdering.Detached?this.room.getPendingEvents():this.events).filter((e=>{var t;return e.threadRootId===this.id&&e.isRelation(C.name)&&null!==e.status&&e.getId()!==(null===(t=this.lastEvent)||void 0===t?void 0:t.getId())}));this.lastPendingEvent=e.length?e[e.length-1]:void 0,this.pendingReplyCount=e.length}async resetLiveTimeline(e,t){const r=this.liveTimeline;this.timelineSet.resetLiveTimeline(null!=e?e:void 0,null!=t?t:void 0);const i=this.liveTimeline;let n,o;if(e){n=(await this.client.createMessagesRequest(this.roomId,e,1,l.Direction.Forward)).end}if(t){o=(await this.client.createMessagesRequest(this.roomId,t,1,l.Direction.Backward)).start}var s,a;t&&r.getPaginationToken(l.Direction.Forward)===t&&r.setPaginationToken(null!==(s=o)&&void 0!==s?s:null,l.Direction.Forward);e&&i.getPaginationToken(l.Direction.Backward)===e&&i.setPaginationToken(null!==(a=n)&&void 0!==a?a:null,l.Direction.Backward)}async updateThreadMetadata(){if(this.updatePendingReplyCount(),S.hasServerSideSupport&&(this.initialEventsFetched||await this.processRootEvent(),await this.fetchRootEvent()),await this.processRootEvent(),!this.initialEventsFetched){this.initialEventsFetched=!0;try{0===this.replyCount&&this.rootEvent?(this.timelineSet.addEventsToTimeline([this.rootEvent],!0,this.liveTimeline,null),this.liveTimeline.setPaginationToken(null,l.Direction.Backward)):await this.client.paginateEventTimeline(this.liveTimeline,{backwards:!0,limit:Math.max(1,this.length)});for(const e of this.replayEvents)this.addEvent(e,!1);this.replayEvents=null,this.emit(h.RoomEvent.TimelineReset,this.room,this.timelineSet,!0)}catch(e){f.logger.error("Failed to load start of newly created thread: ",e),this.initialEventsFetched=!1}}this.emit(y.Update,this)}async fetchEditsWhereNeeded(...e){return Promise.all(e.filter((e=>e.isEncrypted())).map((e=>{if(!e.isRelation())return this.client.relations(this.roomId,e.getId(),a.RelationType.Replace,e.getType(),{limit:1}).then((t=>{t.events.length&&e.makeReplaced(t.events[0])})).catch((e=>{f.logger.error("Failed to load edits for encrypted thread event",e)}))})))}setEventMetadata(e){e&&(l.EventTimeline.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){var t,r,i;e&&(e.setThread(void 0),null===(t=e.event)||void 0===t||null===(r=t.unsigned)||void 0===r||null===(i=r["m.relations"])||void 0===i||delete i[C.name])}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(e=(()=>!0)){for(let t=this.timeline.length-1;t>=0;t--){const r=this.timeline[t];if(e(r))return r}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,t;return null!==(e=null!==(t=this.lastPendingEvent)&&void 0!==t?t:this.lastEvent)&&void 0!==e?e:this.lastReply()}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof c.MatrixEvent}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,t){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,t){const r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){const e=i.getTs()<this.room.getOldestThreadedReceiptTs(),t=i.getId();if(e&&t)return t}const n=super.getEventReadUpTo(e,t);if(i){const t=this.room.getLastUnthreadedReceiptFor(e);if(!t)return n;for(let e=(null===(o=this.timeline)||void 0===o?void 0:o.length)-1;e>=0;--e){var o,s;const r=this.timeline[e];if(r.getId()===n)return n;if(r.getTs()<t.ts)return null!==(s=r.getId())&&void 0!==s?s:n}}return n}hasUserReadEvent(e,t){if(e===this.client.getUserId()){var r,i,n,o,s,a;const t=(null!==(r=null===(i=this.lastReply())||void 0===i?void 0:i.getTs())&&void 0!==r?r:0)<this.room.getOldestThreadedReceiptTs(),c=null!==(n=null===(o=this.room.getLastUnthreadedReceiptFor(e))||void 0===o?void 0:o.ts)&&void 0!==n?n:0,l=(null!==(s=null==this||null===(a=this.lastReply())||void 0===a?void 0:a.getTs())&&void 0!==s?s:0)<c;if(t||l)return!0}return super.hasUserReadEvent(e,t)}}e.exports.Thread=S,(0,n.default)(S,"hasServerSideSupport",w.None),(0,n.default)(S,"hasServerSideListSupport",w.None),(0,n.default)(S,"hasServerSideFwdPaginationSupport",w.None);const E=new d.ServerControlledNamespacedValue("related_by_senders","io.element.relation_senders");e.exports.FILTER_RELATED_BY_SENDERS=E;const M=new d.ServerControlledNamespacedValue("related_by_rel_types","io.element.relation_types");e.exports.FILTER_RELATED_BY_REL_TYPES=M;const C=new d.ServerControlledNamespacedValue("m.thread","io.element.thread");let I;var T;e.exports.THREAD_RELATION_TYPE=C,e.exports.ThreadFilterType=I,(T=I||(e.exports.ThreadFilterType=I={}))[T.My=0]="My",T[T.All=1]="All"})),i.register("5pxqF",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UNSTABLE_MSC3852_LAST_SEEN_UA=e.exports.RoomVersionStability=e.exports.PendingEventOrdering=e.exports.MatrixClient=e.exports.M_AUTHENTICATION=e.exports.ClientEvent=e.exports.CRYPTO_ENABLED=void 0,e.exports.fixNotificationCountOnDecryption=_e;var o=n(i("62hJ7")),s=n(i("3EUCw")),a=i("1dCYQ"),c=i("7BSj1"),l=i("geh4X"),u=i("7L16h"),h=i("l2QFk"),d=i("3Aotm"),f=oe(i("gjhRv")),p=i("jxKcy"),m=i("dpNo2"),g=i("fIT1M"),v=oe(i("dvbGC")),y=i("eu84r"),b=i("hT5WU"),w=i("gEWrD"),_=i("8Sn18"),S=i("cH9or"),E=i("l5WvI"),M=i("iyAPZ"),C=i("1AObg"),I=i("fLhqT"),T=i("juNaO"),k=i("4BsMv"),R=i("ctOxk"),x=i("8ersy"),O=oe(i("aVwsu")),A=i("846Vo"),P=i("6koSf"),D=i("ldT3p"),L=i("8JM9X"),U=i("2RTzj"),N=i("863Vm"),j=i("bdffL"),B=i("ksd78"),F=i("2jZ2n"),K=i("avVpE"),q=i("hadDF"),$=i("gF0zJ"),W=i("gokP2"),V=i("75Qdj"),H=i("cXHgq"),G=i("6nR3T"),z=i("etzbv"),Y=i("iuO3m"),J=i("1c8ok"),Z=i("cr5BD"),Q=i("32gyR"),X=i("gw07V"),ee=i("ekrRE");const te=["server","limit","since"];function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ne(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ne=function(e){return e?r:t})(e)}function oe(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=ne(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}const se=(0,E.isCryptoAvailable)();e.exports.CRYPTO_ENABLED=se;const ae=6e5,ce=new J.UnstableValue("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent");let le;var ue;let he;var de,fe,pe;e.exports.UNSTABLE_MSC3852_LAST_SEEN_UA=ce,e.exports.PendingEventOrdering=le,(ue=le||(e.exports.PendingEventOrdering=le={})).Chronological="chronological",ue.Detached="detached",e.exports.RoomVersionStability=he,(de=he||(e.exports.RoomVersionStability=he={})).Stable="stable",de.Unstable="unstable",(pe=fe||(fe={})).MasterKey="master_key",pe.SelfSigningKey="self_signing_key",pe.UserSigningKey="user_signing_key";const me=new J.UnstableValue("m.authentication","org.matrix.msc2965.authentication");e.exports.M_AUTHENTICATION=me;const ge="$";let ve;var ye;e.exports.ClientEvent=ve,(ye=ve||(e.exports.ClientEvent=ve={})).Sync="sync",ye.Event="event",ye.ToDeviceEvent="toDeviceEvent",ye.AccountData="accountData",ye.Room="Room",ye.DeleteRoom="deleteRoom",ye.SyncUnexpectedError="sync.unexpectedError",ye.ClientWellKnown="WellKnown.client",ye.ReceivedVoipEvent="received_voip_event",ye.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",ye.TurnServers="turnServers",ye.TurnServersError="turnServers.error";const be=new J.UnstableValue("action","org.matrix.msc3824.action");class we extends V.TypedEventEmitter{constructor(e){var t;super(),(0,s.default)(this,"reEmitter",new y.TypedReEmitter(this)),(0,s.default)(this,"olmVersion",null),(0,s.default)(this,"usingExternalCrypto",!1),(0,s.default)(this,"store",void 0),(0,s.default)(this,"deviceId",void 0),(0,s.default)(this,"credentials",void 0),(0,s.default)(this,"pickleKey",void 0),(0,s.default)(this,"scheduler",void 0),(0,s.default)(this,"clientRunning",!1),(0,s.default)(this,"timelineSupport",!1),(0,s.default)(this,"urlPreviewCache",{}),(0,s.default)(this,"identityServer",void 0),(0,s.default)(this,"http",void 0),(0,s.default)(this,"crypto",void 0),(0,s.default)(this,"cryptoBackend",void 0),(0,s.default)(this,"cryptoCallbacks",void 0),(0,s.default)(this,"callEventHandler",void 0),(0,s.default)(this,"groupCallEventHandler",void 0),(0,s.default)(this,"supportsCallTransfer",!1),(0,s.default)(this,"forceTURN",!1),(0,s.default)(this,"iceCandidatePoolSize",0),(0,s.default)(this,"idBaseUrl",void 0),(0,s.default)(this,"baseUrl",void 0),(0,s.default)(this,"canSupportVoip",!1),(0,s.default)(this,"peekSync",null),(0,s.default)(this,"isGuestAccount",!1),(0,s.default)(this,"ongoingScrollbacks",{}),(0,s.default)(this,"notifTimelineSet",null),(0,s.default)(this,"cryptoStore",void 0),(0,s.default)(this,"verificationMethods",void 0),(0,s.default)(this,"fallbackICEServerAllowed",!1),(0,s.default)(this,"roomList",void 0),(0,s.default)(this,"syncApi",void 0),(0,s.default)(this,"roomNameGenerator",void 0),(0,s.default)(this,"pushRules",void 0),(0,s.default)(this,"syncLeftRoomsPromise",void 0),(0,s.default)(this,"syncedLeftRooms",!1),(0,s.default)(this,"clientOpts",void 0),(0,s.default)(this,"clientWellKnownIntervalID",void 0),(0,s.default)(this,"canResetTimelineCallback",void 0),(0,s.default)(this,"canSupport",new Map),(0,s.default)(this,"pushProcessor",new m.PushProcessor(this)),(0,s.default)(this,"serverVersionsPromise",void 0),(0,s.default)(this,"cachedCapabilities",void 0),(0,s.default)(this,"clientWellKnown",void 0),(0,s.default)(this,"clientWellKnownPromise",void 0),(0,s.default)(this,"turnServers",[]),(0,s.default)(this,"turnServersExpiry",0),(0,s.default)(this,"checkTurnServersIntervalID",void 0),(0,s.default)(this,"exportedOlmDeviceToImport",void 0),(0,s.default)(this,"txnCtr",0),(0,s.default)(this,"mediaHandler",new $.MediaHandler(this)),(0,s.default)(this,"sessionId",void 0),(0,s.default)(this,"pendingEventEncryption",new Map),(0,s.default)(this,"useE2eForGroupCall",!0),(0,s.default)(this,"toDeviceMessageQueue",void 0),(0,s.default)(this,"ignoredInvites",void 0),(0,s.default)(this,"startCallEventHandler",(()=>{this.isInitialSyncComplete()&&(this.callEventHandler.start(),this.groupCallEventHandler.start(),this.off(ve.Sync,this.startCallEventHandler))})),e.baseUrl=f.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=f.ensureNoTrailingSlash(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=null!==(t=e.usingExternalCrypto)&&void 0!==t&&t,this.store=e.store||new l.StubStore,this.deviceId=e.deviceId||null,this.sessionId=(0,N.randomString)(10);const r=e.userId||null;this.credentials={userId:r},this.http=new S.MatrixHttpApi(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,prefix:S.ClientPrefix.R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?this.deviceId?w.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?w.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):w.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((async e=>{const t=this.getRoom(e.getRoomId());e.status!==c.EventStatus.SENDING&&this.updatePendingEventStatus(t,e,c.EventStatus.SENDING);const r=await this.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,c.EventStatus.SENT,r.event_id),r})),(0,u.supportsMatrixCall)()&&(this.callEventHandler=new d.CallEventHandler(this),this.groupCallEventHandler=new W.GroupCallEventHandler(this),this.canSupportVoip=!0,this.on(ve.Sync,this.startCallEventHandler)),this.timelineSupport=Boolean(e.timelineSupport),this.cryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,void 0!==e.useE2eForGroupCall&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.roomList=new b.RoomList(this.cryptoStore),this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new Z.ToDeviceMessageQueue(this),this.on(c.MatrixEventEvent.Decrypted,(e=>{_e(this,e)})),this.on(A.RoomEvent.Receipt,((e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const i=e.getContent();if(!(Object.keys(i).filter((e=>{for(const[t,r]of Object.entries(i[e]))if(f.isSupportedReceiptType(t)&&r&&Object.keys(r).includes(this.getUserId()))return!0;return!1})).length>0))return;const n=20,o=t.getLiveTimeline().getEvents();let s=0;for(let e=o.length-1;e>=0;e--){var r;if(e===o.length-n)return;const i=o[e];if(t.hasUserReadEvent(this.getUserId(),i.getId()))break;const a=this.getPushActionsForEvent(i);s+=null!=a&&null!==(r=a.tweaks)&&void 0!==r&&r.highlight?1:0}t.setUnreadNotificationCount(A.NotificationCountType.Highlight,s)}})),this.ignoredInvites=new Q.IgnoredInvites(this)}async startClient(e){var t;if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e});const r=this.getUserId();r&&this.store.storeUser(new I.User(r)),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval((()=>{this.checkTurnServers()}),ae),this.checkTurnServers()),this.syncApi&&(w.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop());try{await this.getVersions();const{threads:e,list:t,fwdPagination:r}=await this.doesServerSupportThread();z.Thread.setServerSideSupport(e),z.Thread.setServerSideListSupport(t),z.Thread.setServerSideFwdPaginationSupport(r)}catch(e){w.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",e)}this.clientOpts=null!==(t=e)&&void 0!==t?t:{},this.clientOpts.slidingSync?this.syncApi=new G.SlidingSyncSdk(this.clientOpts.slidingSync,this,this.clientOpts,this.buildSyncApiOptions()):this.syncApi=new a.SyncApi(this,this.clientOpts,this.buildSyncApiOptions()),this.clientOpts.hasOwnProperty("experimentalThreadSupport")&&w.logger.warn("`experimentalThreadSupport` has been deprecated, use `threadSupport` instead"),!this.clientOpts.hasOwnProperty("threadSupport")&&this.clientOpts.hasOwnProperty("experimentalThreadSupport")&&(this.clientOpts.threadSupport=this.clientOpts.experimentalThreadSupport),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval((()=>{this.fetchClientWellKnown()}),1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.toDeviceMessageQueue.start()}buildSyncApiOptions(){return{crypto:this.crypto,cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e)}}stopClient(){var e,t,i,n,o;null===(e=this.cryptoBackend)||void 0===e||e.stop(),this.clientRunning&&(w.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=void 0,null===(i=this.peekSync)||void 0===i||i.stopPeeking(),null===(n=this.callEventHandler)||void 0===n||n.stop(),null===(o=this.groupCallEventHandler)||void 0===o||o.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,r.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,void 0!==this.clientWellKnownIntervalID&&r.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop())}async rehydrateDevice(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const e=await this.getDehydratedDevice();if(!e)return;if(!e.device_data||!e.device_id)return void w.logger.info("no dehydrated device found");const t=new r.Olm.Account;try{const r=e.device_data;if(r.algorithm!==R.DEHYDRATION_ALGORITHM)return void w.logger.warn("Wrong algorithm for dehydrated device");w.logger.log("unpickling dehydrated device");const i=await this.cryptoCallbacks.getDehydrationKey(r,(e=>{t.unpickle(new Uint8Array(e),r.account)}));t.unpickle(i,r.account),w.logger.log("unpickled device");if((await this.http.authedRequest(S.Method.Post,"/dehydrated_device/claim",void 0,{device_id:e.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=e.device_id,w.logger.info("using dehydrated device");const r=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:t.pickle(r),sessions:[],pickleKey:r},t.free(),this.deviceId}return t.free(),void w.logger.info("not using dehydrated device")}catch(e){t.free(),w.logger.warn("could not unpickle",e)}}async getDehydratedDevice(){try{return await this.http.authedRequest(S.Method.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void w.logger.info("could not get dehydrated device",e)}}async setDehydrationKey(e,t,r){if(this.crypto)return this.crypto.dehydrationManager.setKeyAndQueueDehydration(e,t,r);w.logger.warn("not dehydrating device if crypto is not enabled")}async createDehydratedDevice(e,t,r){if(this.crypto)return await this.crypto.dehydrationManager.setKey(e,t,r),this.crypto.dehydrationManager.dehydrateDevice();w.logger.warn("not dehydrating device if crypto is not enabled")}async exportDevice(){if(this.crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this.crypto.olmDevice.export()};w.logger.warn("not exporting device if crypto is not enabled")}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData());return e.push((async()=>{let e;try{e=r.indexedDB}catch(e){return}for(const t of[`${ee.RUST_SDK_STORE_PREFIX}::matrix-sdk-crypto`,`${ee.RUST_SDK_STORE_PREFIX}::matrix-sdk-crypto-meta`]){const r=new Promise(((r,i)=>{w.logger.info(`Removing IndexedDB instance ${t}`);const n=e.deleteDatabase(t);n.onsuccess=e=>{w.logger.info(`Removed IndexedDB instance ${t}`),r(0)},n.onerror=e=>{w.logger.warn(`Failed to remove IndexedDB instance ${t}:`,e),r(0)},n.onblocked=e=>{w.logger.info(`cannot yet remove IndexedDB instance ${t}`)}}));await r}})()),Promise.all(e).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getSafeUserId(){const e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return(0,u.createNewMatrixCall)(this,e)}async createGroupCall(e,t,r,i,n,o){if(this.getGroupCallForRoom(e))throw new Error(`${e} already has an existing group call`);const s=this.getRoom(e);if(!s)throw new Error(`Cannot find room ${e}`);return new q.GroupCall(this,s,t,r,i,void 0,n,o).create()}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,t;return null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.getSyncState())&&void 0!==e?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return!!e&&(e===a.SyncState.Prepared||e===a.SyncState.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,t;return this.toDeviceMessageQueue.sendQueue(),null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.retryImmediately())&&void 0!==e&&e}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(e=!1){const t=(new Date).getTime();return this.cachedCapabilities&&!e&&t<this.cachedCapabilities.expiration?(w.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(S.Method.Get,"/capabilities").catch((e=>(w.logger.error(e),{}))).then(((e={})=>{const r=e.capabilities||{},i=Object.keys(r).length?216e5:6e4+5e3*Math.random();return this.cachedCapabilities={capabilities:r,expiration:t+i},w.logger.log("Caching capabilities: ",r),r}))}async initCrypto(){if(!(0,E.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.cryptoBackend)return void w.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");w.logger.log("Crypto: Starting up crypto store..."),await this.cryptoStore.startup(),w.logger.log("Crypto: initialising roomlist..."),await this.roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new E.Crypto(this,e,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods);this.reEmitter.reEmit(t,[E.CryptoEvent.KeyBackupFailed,E.CryptoEvent.KeyBackupSessionsRemaining,E.CryptoEvent.RoomKeyRequest,E.CryptoEvent.RoomKeyRequestCancellation,E.CryptoEvent.Warning,E.CryptoEvent.DevicesUpdated,E.CryptoEvent.WillUpdateDevices,E.CryptoEvent.DeviceVerificationChanged,E.CryptoEvent.UserTrustStatusChanged,E.CryptoEvent.KeysChanged]),w.logger.log("Crypto: initialising crypto object..."),await t.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=E.Crypto.getOlmVersion(),t.registerEventHandlers(this),this.cryptoBackend=this.crypto=t,this.crypto.uploadDeviceKeys().catch((e=>{w.logger.error("Error uploading device keys",e)}))}async initRustCrypto(){if(this.cryptoBackend)return void w.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");const t=this.getDeviceId();if(null===t)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const r=await Promise.resolve().then((function(){return i("4F8Wb")})).then((e=>oe(e))),n=await r.initRustCrypto(this.http,e,t);this.cryptoBackend=n,this.on(P.RoomMemberEvent.Membership,n.onRoomMembership.bind(n))}isCryptoEnabled(){return!!this.cryptoBackend}getDeviceEd25519Key(){var e,t;return null!==(e=null===(t=this.crypto)||void 0===t?void 0:t.getDeviceEd25519Key())&&void 0!==e?e:null}getDeviceCurve25519Key(){var e,t;return null!==(e=null===(t=this.crypto)||void 0===t?void 0:t.getDeviceCurve25519Key())&&void 0!==e?e:null}async uploadKeys(){w.logger.warn("MatrixClient.uploadKeys is deprecated")}downloadKeys(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}setDeviceVerified(e,t,r=!0){const i=this.setDeviceVerification(e,t,r,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),i}setDeviceBlocked(e,t,r=!0){return this.setDeviceVerification(e,t,null,r,null)}setDeviceKnown(e,t,r=!0){return this.setDeviceVerification(e,t,null,null,r)}async setDeviceVerification(e,t,r,i,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.setDeviceVerification(e,t,r,i,n)}requestVerificationDM(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}findVerificationRequestDMInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}beginKeyVerification(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,r)}checkSecretStorageKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}setGlobalBlacklistUnverifiedDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices=e,e}getGlobalBlacklistUnverifiedDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.globalErrorOnUnknownDevices=e}getGlobalErrorOnUnknownDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalErrorOnUnknownDevices}getCrossSigningId(e=x.CrossSigningKey.Master){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.checkUserTrust(e)}checkDeviceTrust(e,t){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.checkDeviceTrust(e,t)}checkIfOwnDeviceCrossSigned(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkIfOwnDeviceCrossSigned(e)}checkOwnCrossSigningTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}legacyDeviceVerification(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,r)}prepareToEncrypt(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.prepareToEncrypt(e)}userHasCrossSigningKeys(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.userHasCrossSigningKeys()}isCrossSigningReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.setCryptoTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}addSecretStorageKey(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,r)}hasSecretStorageKey(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}storeSecret(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,r)}getSecret(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}isSecretStored(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e)}requestSecret(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}getDefaultSecretStorageKeyId(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}setDefaultSecretStorageKeyId(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}checkSecretStoragePrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}async getEventSenderDeviceInfo(e){return this.crypto?this.crypto.getEventSenderDeviceInfo(e):null}async isEventSenderVerified(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()}getOutgoingRoomKeyRequest(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");const t=e.getWireContent(),r={session_id:t.session_id,sender_key:t.sender_key,algorithm:t.algorithm,room_id:e.getRoomId()};return r.session_id&&r.sender_key&&r.algorithm&&r.room_id?this.crypto.cryptoStore.getOutgoingRoomKeyRequest(r):Promise.resolve(null)}cancelAndResendEventRoomKeyRequest(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}isRoomEncrypted(e){const t=this.getRoom(e);if(!t)return!1;return!!t.currentState.getStateEvents(D.EventType.RoomEncryption,"")||this.roomList.isRoomEncrypted(e)}encryptAndSendToDevices(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.encryptAndSendToDevices(e,t)}forceDiscardSession(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}exportRoomKeys(){return this.cryptoBackend?this.cryptoBackend.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}checkKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.checkKeyBackup()}async getKeyBackupVersion(){let e;try{e=await this.http.authedRequest(S.Method.Get,"/room_keys/version",void 0,void 0,{prefix:S.ClientPrefix.V3})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}return j.BackupManager.checkBackupVersion(e),e}isKeyBackupTrusted(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}async prepareKeyBackupVersion(e,t={secureSecretStorage:!1}){if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:r,auth_data:i,recovery_key:n,privateKey:o}=await this.crypto.backupManager.prepareKeyBackupVersion(e);return t.secureSecretStorage&&(await this.storeSecret("m.megolm_backup.v1",(0,v.encodeBase64)(o)),w.logger.info("Key backup private key stored in secret storage")),{algorithm:r,auth_data:i,recovery_key:n}}isKeyBackupKeyStored(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1"))}async createKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.createKeyBackupVersion(e);const t={algorithm:e.algorithm,auth_data:e.auth_data};await this.crypto.signObject(t.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto.crossSigningInfo.getId()&&await this.crypto.crossSigningInfo.signObject(t.auth_data,"master");const r=await this.http.authedRequest(S.Method.Post,"/room_keys/version",void 0,t,{prefix:S.ClientPrefix.V3});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||w.logger.error("Key backup not usable even though we just created it"),r}async deleteKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.version&&this.crypto.backupManager.disableKeyBackup();const t=f.encodeUri("/room_keys/version/$version",{$version:e});await this.http.authedRequest(S.Method.Delete,t,void 0,void 0,{prefix:S.ClientPrefix.V3})}makeKeyBackupPath(e,t,r){let i;i=void 0!==t?f.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?f.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys";return{path:i,queryData:void 0===r?void 0:{version:r}}}async sendKeyBackup(e,t,r,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=this.makeKeyBackupPath(e,t,r);await this.http.authedRequest(S.Method.Put,n.path,n.queryData,i,{prefix:S.ClientPrefix.V3})}async scheduleAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.scheduleAllGroupSessionsForBackup()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return(0,M.decodeRecoveryKey)(e),!0}catch(e){return!1}}keyBackupKeyFromPassword(e,t){return(0,C.keyFromAuthData)(t.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return(0,M.decodeRecoveryKey)(e)}async restoreKeyBackupWithPassword(e,t,r,i,n){const o=await(0,C.keyFromAuthData)(i.auth_data,e);return this.restoreKeyBackup(o,t,r,i,n)}async restoreKeyBackupWithSecretStorage(e,t,r,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=await this.getSecret("m.megolm_backup.v1"),o=(0,E.fixBackupKey)(n);if(o){const e=await this.crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",o,[e[0]])}const s=(0,v.decodeBase64)(o||n);return this.restoreKeyBackup(s,t,r,e,i)}restoreKeyBackupWithRecoveryKey(e,t,r,i,n){const o=(0,M.decodeRecoveryKey)(e);return this.restoreKeyBackup(o,t,r,i,n)}async restoreKeyBackupWithCache(e,t,r,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=await this.crypto.getSessionBackupPrivateKey();if(!n)throw new Error("Couldn't get key");return this.restoreKeyBackup(n,e,t,r,i)}async restoreKeyBackup(e,t,r,i,n){const o=null==n?void 0:n.cacheCompleteCallback,s=null==n?void 0:n.progressCallback;if(!this.crypto)throw new Error("End-to-end encryption disabled");let a=0,c=[];const l=this.makeKeyBackupPath(t,r,i.version),u=await j.BackupManager.makeAlgorithm(i,(async()=>e)),h=u.untrusted;try{if(!await u.keyMatches(e))return Promise.reject(new S.MatrixError({errcode:we.RESTORE_BACKUP_ERROR_BAD_KEY}));this.crypto.storeSessionBackupPrivateKey(e).catch((e=>{w.logger.warn("Error caching session backup key:",e)})).then(o),s&&s({stage:"fetch"});const i=await this.http.authedRequest(S.Method.Get,l.path,l.queryData,void 0,{prefix:S.ClientPrefix.V3});if(i.rooms){const e=i.rooms;for(const[t,r]of Object.entries(e)){if(!r.sessions)continue;a+=Object.keys(r.sessions).length;const e=await u.decryptSessions(r.sessions);for(const r of e)r.room_id=t,c.push(r)}}else if(i.sessions){const e=i.sessions;a=Object.keys(e).length,c=await u.decryptSessions(e);for(const e of c)e.room_id=t}else{a=1;try{const[e]=await u.decryptSessions({[r]:i});e.room_id=t,e.session_id=r,c.push(e)}catch(e){w.logger.log("Failed to decrypt megolm session from backup",e)}}}finally{u.free()}return await this.importRoomKeys(c,{progressCallback:s,untrusted:h,source:"backup"}),await this.checkKeyBackup(),{total:a,imported:c.length}}async deleteKeysFromBackup(e,t,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");const i=this.makeKeyBackupPath(e,t,r);await this.http.authedRequest(S.Method.Delete,i.path,i.queryData,void 0,{prefix:S.ClientPrefix.V3})}async sendSharedHistoryKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");const r=this.roomList.getRoomEncryption(e);if(!r)return void w.logger.error("Unknown room.  Not sharing decryption keys");const i=await this.crypto.downloadKeys(t),n={};for(const[e,t]of Object.entries(i))n[e]=Object.values(t);const o=this.crypto.getRoomDecryptor(e,r.algorithm);o.sendSharedHistoryInboundSessions?await o.sendSharedHistoryInboundSessions(n):w.logger.warn("Algorithm does not support sharing previous keys",r.algorithm)}getMediaConfig(){return this.http.authedRequest(S.Method.Get,"/config",void 0,void 0,{prefix:S.MediaPrefix.R0})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(e=!1){const t=this.store.getRooms(),r=new Set;for(const n of t){var i;const t=null===(i=n.findPredecessor(e))||void 0===i?void 0:i.roomId;t&&r.add(t)}return t.filter((e=>!e.currentState.getStateEvents(D.EventType.RoomTombstone,"")||!r.has(e.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t){const r=f.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return(0,S.retryNetworkOperation)(5,(()=>this.http.authedRequest(S.Method.Put,r,void 0,t)))}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=f.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(S.Method.Get,t)}catch(e){var r;if("M_NOT_FOUND"===(null===(r=e.data)||void 0===r?void 0:r.errcode))return null;throw e}}async deleteAccountData(e){const t=this.canSupport.get(X.Feature.AccountDataDeletion);if(t===X.ServerSupport.Unsupported)return void await this.setAccountData(e,{});const r=f.encodeUri("/user/$userId/account_data/$type",{$userId:this.getSafeUserId(),$type:e}),i=t===X.ServerSupport.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return await this.http.authedRequest(S.Method.Delete,r,void 0,void 0,i)}getIgnoredUsers(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){const t={ignored_users:{}};return e.forEach((e=>{t.ignored_users[e]={}})),this.setAccountData("m.ignored_user_list",t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,t={}){void 0===t.syncRoom&&(t.syncRoom=!0);const r=this.getRoom(e);if(null!=r&&r.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(r);let i=Promise.resolve();if(t.inviteSignUrl){const e=new URL(t.inviteSignUrl);e.searchParams.set("mxid",this.credentials.userId),i=this.http.requestOtherUrl(S.Method.Post,e)}const n={};t.viaServers&&(n.server_name=t.viaServers);try{const r={},o=await i;o&&(r.third_party_signed=o);const s=f.encodeUri("/join/$roomid",{$roomid:e}),c=(await this.http.authedRequest(S.Method.Post,s,n,r)).room_id,l=new a.SyncApi(this,this.clientOpts,this.buildSyncApiOptions()).createRoom(c);return t.syncRoom,l}catch(e){throw e}}resendEvent(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,c.EventStatus.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![c.EventStatus.QUEUED,c.EventStatus.NOT_SENT,c.EventStatus.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===c.EventStatus.ENCRYPTING?this.pendingEventEncryption.delete(e.getId()):this.scheduler&&e.status===c.EventStatus.QUEUED&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,c.EventStatus.CANCELLED)}setRoomName(e,t){return this.sendStateEvent(e,D.EventType.RoomName,{name:t})}setRoomTopic(e,t,r){const i=O.makeTopicContent(t,r);return this.sendStateEvent(e,D.EventType.RoomTopic,i)}getRoomTags(e){const t=f.encodeUri("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(S.Method.Get,t)}setRoomTag(e,t,r){const i=f.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(S.Method.Put,i,void 0,r)}deleteRoomTag(e,t){const r=f.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(S.Method.Delete,r)}setRoomAccountData(e,t,r){const i=f.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(S.Method.Put,i,void 0,r)}setPowerLevel(e,t,r,i){let n={users:{}};if(i.getType()===D.EventType.RoomPowerLevels&&(n=f.deepCopy(i.getContent())),Array.isArray(t))for(const e of t)n.users[e]=r;else n.users[t]=r;const o=f.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(S.Method.Put,o,void 0,n)}async unstable_createLiveBeacon(e,t){return this.unstable_setLiveBeacon(e,t)}async unstable_setLiveBeacon(e,t){return this.sendStateEvent(e,Y.M_BEACON_INFO.name,t,this.getUserId())}sendEvent(e,t,r,i,n){var o;let s,a,c,l;if(null!=t&&t.startsWith(ge)||null===t?(l=n,c=i,a=r,s=t):(l=i,c=r,a=t,s=null),s&&(null===(o=c["m.relates_to"])||void 0===o||!o.rel_type)){var u,h;const t=!(null===(u=c["m.relates_to"])||void 0===u||!u["m.in_reply_to"]);c["m.relates_to"]=ie(ie({},c["m.relates_to"]),{},{rel_type:z.THREAD_RELATION_TYPE.name,event_id:s,is_falling_back:!t});const r=null===(h=this.getRoom(e))||void 0===h?void 0:h.getThread(s);var d,f;if(r&&!t)c["m.relates_to"]["m.in_reply_to"]={event_id:null!==(d=null===(f=r.lastReply((e=>e.isRelation(z.THREAD_RELATION_TYPE.name)&&!e.status)))||void 0===f?void 0:f.getId())&&void 0!==d?d:s}}return this.sendCompleteEvent(e,s,{type:a,content:c},l)}sendCompleteEvent(e,t,r,i){i||(i=this.makeTxnId());const n=new c.MatrixEvent(Object.assign(r,{event_id:"~"+e+":"+i,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),s=t?null==o?void 0:o.getThread(t):void 0;s&&n.setThread(s),this.reEmitter.reEmit(n,[c.MatrixEventEvent.Replaced,c.MatrixEventEvent.VisibilityChange]),null==o||o.reEmitter.reEmit(n,[c.MatrixEventEvent.BeforeRedaction]);const a=n.getAssociatedId();if(null!=a&&a.startsWith("~")){const e=null==o?void 0:o.getPendingEvents().find((e=>e.getId()===a));null==e||e.once(c.MatrixEventEvent.LocalEventIdReplaced,(()=>{n.updateAssociatedId(e.getId())}))}const l=n.getType();return w.logger.log(`sendEvent of type ${l} in ${e} with txnId ${i}`),n.setTxnId(i),n.setStatus(c.EventStatus.SENDING),null==o||o.addPendingEvent(n,i),n.status===c.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(o,n)}encryptAndSendEvent(e,t){let r=!1;return Promise.resolve().then((()=>{const i=this.encryptEventIfNeeded(t,null!=e?e:void 0);return i?(this.pendingEventEncryption.set(t.getId(),i),this.updatePendingEventStatus(e,t,c.EventStatus.ENCRYPTING),i.then((()=>{this.pendingEventEncryption.has(t.getId())?this.updatePendingEventStatus(e,t,c.EventStatus.SENDING):r=!0}))):null})).then((()=>{if(r)return{};let i=null;return this.scheduler&&(i=this.scheduler.queueEvent(t),i&&this.scheduler.getQueueForEvent(t).length>1&&this.updatePendingEventStatus(e,t,c.EventStatus.QUEUED)),i||(i=this.sendEventHttpRequest(t),e&&(i=i.then((r=>(e.updatePendingEvent(t,c.EventStatus.SENT,r.event_id),r))))),i})).catch((r=>{w.logger.error("Error sending event",r.stack||r);try{t.error=r,this.updatePendingEventStatus(e,t,c.EventStatus.NOT_SENT)}catch(e){w.logger.error("Exception in error handler!",e.stack||r)}throw r instanceof S.MatrixError&&(r.event=t),r}))}encryptEventIfNeeded(e,t){if(e.isEncrypted())return null;if(e.isRedaction())return null;if(!t||!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.cryptoBackend&&this.usingExternalCrypto)return null;if(e.getType()===D.EventType.Reaction)return null;if(!this.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.cryptoBackend.encryptEvent(e,t)}getEncryptedIfNeededEventType(e,t){return t===D.EventType.Reaction?t:this.isRoomEncrypted(e)?D.EventType.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,r){e?e.updatePendingEvent(t,r):t.setStatus(r)}sendEventHttpRequest(e){let t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));const r={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};let i;if(e.isState()){let t="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(t="/rooms/$roomId/state/$eventType/$stateKey"),i=f.encodeUri(t,r)}else if(e.isRedaction()){const t="/rooms/$roomId/redact/$redactsEventId/$txnId";i=f.encodeUri(t,ie({$redactsEventId:e.event.redacts},r))}else i=f.encodeUri("/rooms/$roomId/send/$eventType/$txnId",r);return this.http.authedRequest(S.Method.Put,i,void 0,e.getWireContent()).then((t=>(w.logger.log(`Event sent to ${e.getRoomId()} with event id ${t.event_id}`),t)))}redactEvent(e,t,r,i,n){var o,s,a,c,l;null!==(o=r)&&void 0!==o&&o.startsWith(ge)||(n=i,i=r,r=t,t=null);const u=null===(s=n)||void 0===s?void 0:s.reason;if(null!==(a=n)&&void 0!==a&&a.with_relations&&this.canSupport.get(X.Feature.RelationBasedRedactions)===X.ServerSupport.Unsupported)throw new Error(`Server does not support relation based redactions roomId ${e} eventId ${r} txnId: ${i} threadId ${t}`);const h=null!==(c=n)&&void 0!==c&&c.with_relations?{[this.canSupport.get(X.Feature.RelationBasedRedactions)===X.ServerSupport.Stable?D.MSC3912_RELATION_BASED_REDACTIONS_PROP.stable:D.MSC3912_RELATION_BASED_REDACTIONS_PROP.unstable]:null===(l=n)||void 0===l?void 0:l.with_relations}:{};return this.sendCompleteEvent(e,t,{type:D.EventType.RoomRedaction,content:ie(ie({},h),{},{reason:u}),redacts:r},i)}sendMessage(e,t,r,i){"string"!=typeof t&&null!==t&&(i=r,r=t,t=null);const n=D.EventType.RoomMessage,o=r;return this.sendEvent(e,t,n,o,i)}sendTextMessage(e,t,r,i){var n;null!==(n=t)&&void 0!==n&&n.startsWith(ge)||null===t||(i=r,r=t,t=null);const o=O.makeTextMessage(r);return this.sendMessage(e,t,o,i)}sendNotice(e,t,r,i){var n;null!==(n=t)&&void 0!==n&&n.startsWith(ge)||null===t||(i=r,r=t,t=null);const o=O.makeNotice(r);return this.sendMessage(e,t,o,i)}sendEmoteMessage(e,t,r,i){var n;null!==(n=t)&&void 0!==n&&n.startsWith(ge)||null===t||(i=r,r=t,t=null);const o=O.makeEmoteMessage(r);return this.sendMessage(e,t,o,i)}sendImageMessage(e,t,r,i,n="Image"){var o;null!==(o=t)&&void 0!==o&&o.startsWith(ge)||null===t||(n=i||"Image",i=r,r=t,t=null);const s={msgtype:D.MsgType.Image,url:r,info:i,body:n};return this.sendMessage(e,t,s)}sendStickerMessage(e,t,r,i,n="Sticker"){var o;null!==(o=t)&&void 0!==o&&o.startsWith(ge)||null===t||(n=i||"Sticker",i=r,r=t,t=null);const s={url:r,info:i,body:n};return this.sendEvent(e,t,D.EventType.Sticker,s)}sendHtmlMessage(e,t,r,i){var n;null!==(n=t)&&void 0!==n&&n.startsWith(ge)||null===t||(i=r,r=t,t=null);const o=O.makeHtmlMessage(r,i);return this.sendMessage(e,t,o)}sendHtmlNotice(e,t,r,i){var n;null!==(n=t)&&void 0!==n&&n.startsWith(ge)||null===t||(i=r,r=t,t=null);const o=O.makeHtmlNotice(r,i);return this.sendMessage(e,t,o)}sendHtmlEmote(e,t,r,i){var n;null!==(n=t)&&void 0!==n&&n.startsWith(ge)||null===t||(i=r,r=t,t=null);const o=O.makeHtmlEmote(r,i);return this.sendMessage(e,t,o)}async sendReceipt(e,t,r,i=!1){if(this.isGuest())return Promise.resolve({});const n=f.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()});if(!i){const t=!!e.threadRootId;r=ie(ie({},r),{},{thread_id:t?e.threadRootId:H.MAIN_ROOM_TIMELINE})}const o=this.http.authedRequest(S.Method.Post,n,void 0,r||{}),s=this.getRoom(e.getRoomId());return s&&this.credentials.userId&&s.addLocalEchoReceipt(this.credentials.userId,e,t),o}async sendReadReceipt(e,t=H.ReceiptType.Read,r=!1){if(!e)return;const i=e.getId(),n=this.getRoom(e.getRoomId());if(null!=n&&n.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);return this.sendReceipt(e,t,{},r)}async setRoomReadMarkers(e,t,r,i){const n=this.getRoom(e);if(n&&n.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let o,s;if(r){if(o=r.getId(),null!=n&&n.hasPendingEvent(o))throw new Error(`Cannot set read receipt to a pending event (${o})`);null==n||n.addLocalEchoReceipt(this.credentials.userId,r,H.ReceiptType.Read)}if(i){if(s=i.getId(),null!=n&&n.hasPendingEvent(s))throw new Error(`Cannot set read receipt to a pending event (${s})`);null==n||n.addLocalEchoReceipt(this.credentials.userId,i,H.ReceiptType.ReadPrivate)}return await this.setRoomReadMarkersHttpRequest(e,t,o,s)}getUrlPreview(e,t){t=6e4*Math.floor(t/6e4);const r=new URL(e);r.hash="";const i=t+"_"+(e=r.toString()),n=this.urlPreviewCache[i];if(n)return n;const o=this.http.authedRequest(S.Method.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:S.MediaPrefix.R0});return this.urlPreviewCache[i]=o,o}sendTyping(e,t,r){if(this.isGuest())return Promise.resolve({});const i=f.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),n={typing:t};return t&&(n.timeout=r||2e4),this.http.authedRequest(S.Method.Put,i,void 0,n)}getRoomUpgradeHistory(e,t=!1,r=!1){const i=this.getRoom(e);if(!i)return[];return[...this.findPredecessorRooms(i,t,r),i,...this.findSuccessorRooms(i,t,r)]}findPredecessorRooms(e,t,r){var i;const n=[];let o=null===(i=e.findPredecessor(r))||void 0===i?void 0:i.roomId;for(;null!==o;){var s;const i=this.getRoom(o);if(null===i)break;if(t){const t=i.currentState.getStateEvents(D.EventType.RoomTombstone,"");if(!t||t.getContent().replacement_room!==e.roomId)break}n.splice(0,0,i),o=null===(s=(e=i).findPredecessor(r))||void 0===s?void 0:s.roomId}return n}findSuccessorRooms(e,t,r){const i=[];let n=e.currentState.getStateEvents(D.EventType.RoomTombstone,"");for(;n;){const s=this.getRoom(n.getContent().replacement_room);if(!s)break;if(s.roomId===e.roomId)break;if(t){var o;const t=null===(o=s.findPredecessor(r))||void 0===o?void 0:o.roomId;if(!t||t!==e.roomId)break}i.push(s);if(new Set(i.map((e=>e.roomId))).size<i.length)return i.slice(0,i.length-1);n=(e=s).currentState.getStateEvents(D.EventType.RoomTombstone,"")}return i}invite(e,t,r){return this.membershipChange(e,t,"invite",r)}inviteByEmail(e,t){return this.inviteByThreePid(e,"email",t)}async inviteByThreePid(e,t,r){var i;const n=f.encodeUri("/rooms/$roomId/invite",{$roomId:e}),o=this.getIdentityServerUrl(!0);if(!o)return Promise.reject(new S.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const s={id_server:o,medium:t,address:r};if(null!==(i=this.identityServer)&&void 0!==i&&i.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(s.id_access_token=e)}return this.http.authedRequest(S.Method.Post,n,void 0,s)}leave(e){return this.membershipChange(e,void 0,"leave")}leaveRoomChain(e,t=!0){const r=this.getRoomUpgradeHistory(e);let i=r;if(!t){i=[];for(const t of r)if(i.push(t),t.roomId===e)break}const n={},o=[],s=e=>this.leave(e).then((()=>{delete n[e]})).catch((t=>{n[e]=t}));for(const e of i)o.push(s(e.roomId));return Promise.all(o).then((()=>n))}ban(e,t,r){return this.membershipChange(e,t,"ban",r)}forget(e,t=!0){const r=this.membershipChange(e,void 0,"forget");return t?r.then((t=>(this.store.removeRoom(e),this.emit(ve.DeleteRoom,e),t))):r}unban(e,t){const r=f.encodeUri("/rooms/$roomId/unban",{$roomId:e}),i={user_id:t};return this.http.authedRequest(S.Method.Post,r,void 0,i)}kick(e,t,r){const i=f.encodeUri("/rooms/$roomId/kick",{$roomId:e}),n={user_id:t,reason:r};return this.http.authedRequest(S.Method.Post,i,void 0,n)}membershipChange(e,t,r,i){const n=f.encodeUri("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(S.Method.Post,n,void 0,{user_id:t,reason:i})}getPushActionsForEvent(e,t=!1){return e.getPushActions()&&!t||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}setProfileInfo(e,t){const r=f.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(S.Method.Put,r,void 0,t)}async setDisplayName(e){const t=await this.setProfileInfo("displayname",{displayname:e}),r=this.getUser(this.getUserId());return r&&(r.displayName=e,r.emit(I.UserEvent.DisplayName,r.events.presence,r)),t}async setAvatarUrl(e){const t=await this.setProfileInfo("avatar_url",{avatar_url:e}),r=this.getUser(this.getUserId());return r&&(r.avatarUrl=e,r.emit(I.UserEvent.AvatarUrl,r.events.presence,r)),t}mxcUrlToHttp(e,t,r,i,n){return(0,T.getHttpUriForMxc)(this.baseUrl,e,t,r,i,n)}async setPresence(e){const t=f.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});if(-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);await this.http.authedRequest(S.Method.Put,t,void 0,e)}getPresence(e){const t=f.encodeUri("/presence/$userId/status",{$userId:e});return this.http.authedRequest(S.Method.Get,t)}scrollback(e,t=30){let r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){const e=Date.now()-i.errorTs;r=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const n=this.store.scrollback(e,t).length;if(n===t)return Promise.resolve(e);t-=n;const o=new Promise(((i,n)=>{(0,f.sleep)(r).then((()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,p.Direction.Backward))).then((t=>{var r,n;const o=t.chunk.map(this.getEventMapper());if(t.state){const r=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(r)}const[s,a]=e.partitionThreadedEvents(o);this.processAggregatedTimelineEvents(e,s),e.addEventsToTimeline(s,!0,e.getLiveTimeline()),this.processThreadEvents(e,a,!0),e.oldState.paginationToken=null!==(r=t.end)&&void 0!==r?r:null,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,o,null!==(n=t.end)&&void 0!==n?n:null,!0),delete this.ongoingScrollbacks[e.roomId],i(e)})).catch((t=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},n(t)}))}));return i={promise:o},this.ongoingScrollbacks[e.roomId]=i,o}getEventMapper(e){return(0,U.eventMapperFor)(this,e||{})}async getEventTimeline(e,t){var r,i,n,o;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(null==e||!e.room)throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);if(e.thread&&this.supportsThreads())return this.getThreadTimeline(e,t);const s=f.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let a;null!==(r=this.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(a={filter:JSON.stringify(h.Filter.LAZY_LOADING_MESSAGES_FILTER)});const c=await this.http.authedRequest(S.Method.Get,s,a);if(!c.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);const l=this.getEventMapper(),u=l(c.event);if(u.isRelation(z.THREAD_RELATION_TYPE.name))return void w.logger.warn("Tried loading a regular timeline at the position of a thread event");const d=[...c.events_after.reverse().map(l),u,...c.events_before.map(l)];let m=e.getTimelineForEvent(d[0].getId());m?m.getState(p.EventTimeline.BACKWARDS).setUnknownStateEvents(c.state.map(l)):(m=e.addTimeline(),m.initialiseState(c.state.map(l)),m.getState(p.EventTimeline.FORWARDS).paginationToken=c.end);const[g,v]=e.room.partitionThreadedEvents(d);return e.addEventsToTimeline(g,!0,m,c.start),this.processThreadEvents(e.room,v,!0),this.processAggregatedTimelineEvents(e.room,g),null!==(i=null!==(n=e.getTimelineForEvent(t))&&void 0!==n?n:null===(o=e.room.findThreadForEvent(u))||void 0===o?void 0:o.liveTimeline)&&void 0!==i?i:m}async getThreadTimeline(e,t){var r;if(!this.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");const i=f.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),n={limit:"0"};null!==(r=this.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(n.filter=JSON.stringify(h.Filter.LAZY_LOADING_MESSAGES_FILTER));const o=await this.http.authedRequest(S.Method.Get,i,n),s=this.getEventMapper(),a=s(o.event);if(e.canContain(a)&&z.Thread.hasServerSideSupport){if(z.Thread.hasServerSideFwdPaginationSupport){var c,l,u;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");const r=e.thread,i=await this.fetchRelations(e.room.roomId,r.id,z.THREAD_RELATION_TYPE.name,null,{dir:p.Direction.Backward,from:o.start}),n=await this.fetchRelations(e.room.roomId,r.id,z.THREAD_RELATION_TYPE.name,null,{dir:p.Direction.Forward,from:o.end}),h=[...n.chunk.reverse().map(s),a,...i.chunk.map(s)];for(const t of h){var d;await(null===(d=e.thread)||void 0===d?void 0:d.processEvent(t))}let f=e.getTimelineForEvent(a.getId());if(f?f.getState(p.EventTimeline.BACKWARDS).setUnknownStateEvents(o.state.map(s)):(f=e.addTimeline(),f.initialiseState(o.state.map(s))),e.addEventsToTimeline(h,!0,f,n.next_batch),!i.next_batch){const t=await this.fetchRoomEvent(e.room.roomId,r.id);e.addEventsToTimeline([s(t)],!0,f,null)}return f.setPaginationToken(null!==(c=i.next_batch)&&void 0!==c?c:null,p.Direction.Backward),f.setPaginationToken(null!==(l=n.next_batch)&&void 0!==l?l:null,p.Direction.Forward),this.processAggregatedTimelineEvents(e.room,h),null!==(u=e.getTimelineForEvent(t))&&void 0!==u?u:f}{var m;const t=e.thread,r=await this.fetchRelations(e.room.roomId,t.id,z.THREAD_RELATION_TYPE.name,null,{dir:p.Direction.Backward,from:o.start}),i=[];let n=o.end;for(;n;){var g;const r=await this.fetchRelations(e.room.roomId,t.id,z.THREAD_RELATION_TYPE.name,null,{dir:p.Direction.Forward,from:n});n=null!==(g=r.next_batch)&&void 0!==g?g:null,i.push(...r.chunk)}const c=[...i.reverse().map(s),a,...r.chunk.map(s)];for(const t of c){var v;await(null===(v=e.thread)||void 0===v?void 0:v.processEvent(t))}const l=e.getLiveTimeline();if(l.getState(p.EventTimeline.BACKWARDS).setUnknownStateEvents(o.state.map(s)),e.addEventsToTimeline(c,!0,l,null),!r.next_batch){const r=await this.fetchRoomEvent(e.room.roomId,t.id);e.addEventsToTimeline([s(r)],!0,l,null)}return l.setPaginationToken(null!==(m=r.next_batch)&&void 0!==m?m:null,p.Direction.Backward),l.setPaginationToken(null,p.Direction.Forward),this.processAggregatedTimelineEvents(e.room,c),l}}}async getLatestTimeline(e){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");let t;if(null!==e.threadListType){var r;t=null===(r=(await this.createThreadListMessagesRequest(e.room.roomId,null,1,p.Direction.Backward,e.threadListType,e.getFilter())).chunk)||void 0===r?void 0:r[0]}else if(e.thread&&z.Thread.hasServerSideSupport){var i;t=null===(i=(await this.fetchRelations(e.room.roomId,e.thread.id,z.THREAD_RELATION_TYPE.name,null,{dir:p.Direction.Backward,limit:1})).chunk)||void 0===i?void 0:i[0]}else{var n,o;const r=f.encodeUri("/rooms/$roomId/messages",{$roomId:e.room.roomId}),i={dir:"b"};null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(i.filter=JSON.stringify(h.Filter.LAZY_LOADING_MESSAGES_FILTER));t=null===(o=(await this.http.authedRequest(S.Method.Get,r,i)).chunk)||void 0===o?void 0:o[0]}if(!t)throw new Error("No message returned when trying to construct getLatestTimeline");return this.getEventTimeline(e,t.event_id)}createMessagesRequest(e,t,r=30,i,n){var o;const s=f.encodeUri("/rooms/$roomId/messages",{$roomId:e}),a={limit:r.toString(),dir:i};t&&(a.from=t);let c=null;var l;(null!==(o=this.clientOpts)&&void 0!==o&&o.lazyLoadMembers&&(c=Object.assign({},h.Filter.LAZY_LOADING_MESSAGES_FILTER)),n)&&(c=c||{},Object.assign(c,null===(l=n.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON()));return c&&(a.filter=JSON.stringify(c)),this.http.authedRequest(S.Method.Get,s,a)}createThreadListMessagesRequest(e,t,r=30,i=p.Direction.Backward,n=z.ThreadFilterType.All,o){var s;const a=f.encodeUri("/rooms/$roomId/threads",{$roomId:e}),c={limit:r.toString(),dir:i,include:(0,z.threadFilterTypeToFilter)(n)};t&&(c.from=t);let l={};var u;(null!==(s=this.clientOpts)&&void 0!==s&&s.lazyLoadMembers&&(l=ie({},h.Filter.LAZY_LOADING_MESSAGES_FILTER)),o)&&(l=ie(ie({},l),null===(u=o.getRoomTimelineFilterComponent())||void 0===u?void 0:u.toJSON()));Object.keys(l).length&&(c.filter=JSON.stringify(l));const d={prefix:z.Thread.hasServerSideListSupport===z.FeatureSupport.Stable?"/_matrix/client/v1":"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(S.Method.Get,a,c,void 0,d).then((e=>{var t;return ie(ie({},e),{},{chunk:null===(t=e.chunk)||void 0===t?void 0:t.reverse(),start:e.prev_batch,end:e.next_batch})}))}paginateEventTimeline(e,t){const r=e.getTimelineSet()===this.notifTimelineSet,i=this.getRoom(e.getRoomId()),n=e.getTimelineSet().threadListType,o=e.getTimelineSet().thread,s=(t=t||{}).backwards||!1;if(r&&!s)throw new Error("paginateNotifTimeline can only paginate backwards");const a=s?p.EventTimeline.BACKWARDS:p.EventTimeline.FORWARDS,c=e.getPaginationToken(a),l=e.paginationRequests[a];if(l)return l;let u,h,d;var f;if(r)u="/notifications",h={limit:(null!==(f=t.limit)&&void 0!==f?f:30).toString(),only:"highlight"},c&&"end"!==c&&(h.from=c),d=this.http.authedRequest(S.Method.Get,"/notifications",h).then((async t=>{const r=t.next_token,i=[];for(let e=0;e<t.notifications.length;e++){const r=t.notifications[e],n=this.getEventMapper()(r.event);n.setPushActions(m.PushProcessor.actionListToActionsObject(r.actions)),n.event.room_id=r.room_id,i[e]=n}const n=e.getTimelineSet();return n.addEventsToTimeline(i,s,e,r),this.processAggregatedTimelineEvents(n.room,i),s&&!t.next_token&&e.setPaginationToken(null,a),Boolean(t.next_token)})).finally((()=>{e.paginationRequests[a]=null})),e.paginationRequests[a]=d;else if(null!==n){if(!i)throw new Error("Unknown room "+e.getRoomId());if(!z.Thread.hasServerSideFwdPaginationSupport&&a===p.Direction.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");d=this.createThreadListMessagesRequest(e.getRoomId(),c,t.limit,a,n,e.getFilter()).then((t=>{if(t.state){const r=e.getState(a),i=t.state.map(this.getEventMapper());r.setUnknownStateEvents(i)}const r=t.end,n=t.chunk.map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(n,s,e,r),this.processAggregatedTimelineEvents(i,n),this.processThreadRoots(i,n,s),s&&t.end==t.start&&e.setPaginationToken(null,a),t.end!==t.start})).finally((()=>{e.paginationRequests[a]=null})),e.paginationRequests[a]=d}else if(o){var g,v;const r=this.getRoom(null!==(g=e.getRoomId())&&void 0!==g?g:void 0);if(!r)throw new Error("Unknown room "+e.getRoomId());d=this.fetchRelations(null!==(v=e.getRoomId())&&void 0!==v?v:"",o.id,z.THREAD_RELATION_TYPE.name,null,{dir:a,limit:t.limit,from:null!=c?c:void 0}).then((async t=>{const i=this.getEventMapper(),n=t.chunk.map(i);for(const e of n.slice().reverse()){await(null==o?void 0:o.processEvent(e));const t=e.getSender();s&&null!==(null==o?void 0:o.getEventReadUpTo(t))||r.addLocalEchoReceipt(t,e,H.ReceiptType.Read)}const c=t.next_batch,l=e.getTimelineSet();if(l.addEventsToTimeline(n,s,e,null!=c?c:null),!c&&s){var u;const t=await this.fetchRoomEvent(null!==(u=e.getRoomId())&&void 0!==u?u:"",o.id);l.addEventsToTimeline([i(t)],!0,e,null)}return this.processAggregatedTimelineEvents(l.room,n),s&&!c&&e.setPaginationToken(null,a),Boolean(c)})).finally((()=>{e.paginationRequests[a]=null})),e.paginationRequests[a]=d}else{if(!i)throw new Error("Unknown room "+e.getRoomId());d=this.createMessagesRequest(e.getRoomId(),c,t.limit,a,e.getFilter()).then((t=>{if(t.state){const r=e.getState(a),i=t.state.map(this.getEventMapper());r.setUnknownStateEvents(i)}const r=t.end,n=t.chunk.map(this.getEventMapper()),o=e.getTimelineSet(),[c]=i.partitionThreadedEvents(n);o.addEventsToTimeline(c,s,e,r),this.processAggregatedTimelineEvents(i,c),this.processThreadRoots(i,c.filter((e=>e.getServerAggregatedRelation(z.THREAD_RELATION_TYPE.name))),!1);const l=void 0===t.end||t.end===t.start;return s&&l&&e.setPaginationToken(null,a),!l})).finally((()=>{e.paginationRequests[a]=null})),e.paginationRequests[a]=d}return d}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var t;return null===(t=this.peekSync)||void 0===t||t.stopPeeking(),this.peekSync=new a.SyncApi(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){const r=this.sendStateEvent(e,D.EventType.RoomGuestAccess,{guest_access:t.allowJoin?"can_join":"forbidden"},"");let i=Promise.resolve(void 0);return t.allowRead&&(i=this.sendStateEvent(e,D.EventType.RoomHistoryVisibility,{history_visibility:"world_readable"},"")),Promise.all([i,r]).then()}requestRegisterEmailToken(e,t,r,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:i})}requestRegisterMsisdnToken(e,t,r,i,n){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:i,next_link:n})}requestAdd3pidEmailToken(e,t,r,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:i})}requestAdd3pidMsisdnToken(e,t,r,i,n){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:i,next_link:n})}requestPasswordEmailToken(e,t,r,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:i})}requestPasswordMsisdnToken(e,t,r,i,n){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:i,next_link:n})}async requestTokenFromEndpoint(e,t){const r=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){var i;const e=new URL(this.idBaseUrl);if(r.id_server=e.host,null!==(i=this.identityServer)&&void 0!==i&&i.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(r.id_access_token=e)}}return this.http.request(S.Method.Post,e,void 0,r)}getRoomPushRule(e,t){var r,i;if(this.pushRules)return null===(r=this.pushRules[e])||void 0===r||null===(i=r.room)||void 0===i?void 0:i.find((e=>e.rule_id===t));throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,t,r){let i,n=!1;const o=this.getRoomPushRule(e,t);if(null!=o&&o.actions.includes(K.PushRuleActionName.DontNotify)&&(n=!0),r)if(o){if(!n){const r=f.defer();this.deletePushRule(e,K.PushRuleKind.RoomSpecific,o.rule_id).then((()=>{this.addPushRule(e,K.PushRuleKind.RoomSpecific,t,{actions:[K.PushRuleActionName.DontNotify]}).then((()=>{r.resolve()})).catch((e=>{r.reject(e)}))})).catch((e=>{r.reject(e)})),i=r.promise}}else i=this.addPushRule(e,K.PushRuleKind.RoomSpecific,t,{actions:[K.PushRuleActionName.DontNotify]});else n&&(i=this.deletePushRule(e,K.PushRuleKind.RoomSpecific,o.rule_id));if(i)return new Promise(((e,t)=>{i.then((()=>{this.getPushRules().then((t=>{this.pushRules=t,e()})).catch((e=>{t(e)}))})).catch((e=>{this.getPushRules().then((r=>{this.pushRules=r,t(e)})).catch((r=>{t(e)}))}))}))}searchMessageText(e){const t={search_term:e.query};return"keys"in e&&(t.keys=e.keys),this.search({body:{search_categories:{room_events:t}}})}searchRoomEvents(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:F.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:t,results:[],highlights:[]};return this.search({body:t}).then((e=>this.processRoomEventsSearch(r,e)))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},r=this.search(t,e.abortSignal).then((t=>this.processRoomEventsSearch(e,t))).finally((()=>{e.pendingRequest=void 0}));return e.pendingRequest=r,r}processRoomEventsSearch(e,t){var r,i;const n=t.search_categories.room_events;e.count=n.count,e.next_batch=n.next_batch;const o=new Set(n.highlights);e.highlights.forEach((e=>{o.add(e)})),e.highlights=Array.from(o);const s=this.getEventMapper(),a=null!==(r=null===(i=n.results)||void 0===i?void 0:i.length)&&void 0!==r?r:0;for(let t=0;t<a;t++){const r=k.SearchResult.fromJson(n.results[t],s),i=this.getRoom(r.context.getEvent().getRoomId());if(i)for(const e of r.context.getTimeline()){const t=i.getMember(e.getSender());!e.sender&&t&&(e.sender=t)}e.results.push(r)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new a.SyncApi(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then((()=>{w.logger.log("Marking success of sync left room request"),this.syncedLeftRooms=!0})).finally((()=>{this.syncLeftRoomsPromise=void 0})),this.syncLeftRoomsPromise}createFilter(e){const t=f.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(S.Method.Post,t,void 0,e).then((t=>{const r=h.Filter.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(r),r}))}getFilter(e,t,r){if(r){const r=this.store.getFilter(e,t);if(r)return Promise.resolve(r)}const i=f.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(S.Method.Get,i).then((r=>{const i=h.Filter.fromJson(e,t,r);return this.store.storeFilter(i),i}))}async getOrCreateFilter(e,t){const r=this.store.getFilterIdByName(e);let i;if(r){try{const e=await this.getFilter(this.credentials.userId,r,!0);if(e){const n=e.getDefinition(),o=t.getDefinition();f.deepCompare(n,o)&&(i=r)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}i||this.store.setFilterIdByName(e,void 0)}if(i)return i;const n=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,n.filterId),n.filterId}getOpenIdToken(){const e=f.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(S.Method.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(S.Method.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return void 0!==this.checkTurnServersIntervalID}async checkTurnServers(){if(!this.canSupportVoip)return;let e=!1;const t=this.turnServersExpiry-Date.now();if(t>ae)w.logger.debug("TURN creds are valid for another "+t+" ms: not fetching new ones."),e=!0;else{w.logger.debug("Fetching new TURN credentials");try{const t=await this.turnServer();if(t.uris){w.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");const r={urls:t.uris,username:t.username,credential:t.password};this.turnServers=[r],this.turnServersExpiry=Date.now()+1e3*t.ttl,e=!0,this.emit(ve.TurnServers,this.turnServers)}}catch(e){w.logger.error("Failed to get TURN URIs",e),403===e.httpStatus?(w.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&r.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.emit(ve.TurnServersError,e,!0)):this.emit(ve.TurnServersError,e,!1)}}return e}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=f.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(S.Method.Get,e,void 0,void 0,{prefix:""}).then((e=>e.admin))}whoisSynapseUser(e){const t=f.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(S.Method.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const t=f.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(S.Method.Post,t,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){var e;this.clientWellKnownPromise=g.AutoDiscovery.getRawClientConfig(null!==(e=this.getDomain())&&void 0!==e?e:void 0),this.clientWellKnown=await this.clientWellKnownPromise,this.emit(ve.ClientWellKnown,this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((([t,r])=>e.includes(typeof r))).reduce(((e,[t,r])=>(e[t]=r,e)),{});return this.store.storeClientOptions(t)}async _unstable_getSharedRooms(e){const t=await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"),r=await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666.mutual_rooms");if(!t&&!r)throw Error("Server does not support mutual_rooms API");const i=f.encodeUri(`/uk.half-shot.msc2666/user/${r?"mutual_rooms":"shared_rooms"}/$userId`,{$userId:e});return(await this.http.authedRequest(S.Method.Get,i,void 0,void 0,{prefix:S.ClientPrefix.Unstable})).joined}async getVersions(){if(this.serverVersionsPromise)return this.serverVersionsPromise;this.serverVersionsPromise=this.http.request(S.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((e=>{throw this.serverVersionsPromise=void 0,e}));const e=await this.serverVersionsPromise;return this.canSupport=await(0,X.buildFeatureSupportMap)(e),this.serverVersionsPromise}async isVersionSupported(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)}async doesServerSupportLazyLoading(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,r=e.unstable_features;return t&&t.includes("r0.5.0")||r&&r["m.lazy_load_members"]}async doesServerRequireIdServerParam(){const e=await this.getVersions();if(!e)return!0;const t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const r=e.unstable_features;return!r||(void 0===r["m.require_identity_server"]||r["m.require_identity_server"])}async doesServerAcceptIdentityAccessToken(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,r=e.unstable_features;return t&&t.includes("r0.6.0")||r&&r["m.id_access_token"]}async doesServerSupportSeparateAddAndBind(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,r=e.unstable_features;return(null==t?void 0:t.includes("r0.6.0"))||(null==r?void 0:r["m.separate_add_and_bind"])}async doesServerSupportUnstableFeature(e){const t=await this.getVersions();if(!t)return!1;const r=t.unstable_features;return r&&!!r[e]}async doesServerForceEncryptionForPreset(e){const t=await this.getVersions();if(!t)return!1;const r=t.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return r&&!!r[`io.element.e2ee_forced.${i}`]}async doesServerSupportThread(){if(await this.isVersionSupported("v1.4"))return{threads:z.FeatureSupport.Stable,list:z.FeatureSupport.Stable,fwdPagination:z.FeatureSupport.Stable};try{const[e,t,r,i,n,o]=await Promise.all([this.doesServerSupportUnstableFeature("org.matrix.msc3440"),this.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3856"),this.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3715"),this.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:(0,z.determineFeatureSupport)(t,e),list:(0,z.determineFeatureSupport)(i,r),fwdPagination:(0,z.determineFeatureSupport)(o,n)}}catch(e){return{threads:z.FeatureSupport.None,list:z.FeatureSupport.None,fwdPagination:z.FeatureSupport.None}}}doesServerSupportLogoutDevices(){return this.isVersionSupported("r0.6.1")}hasLazyLoadMembersEnabled(){var e;return!(null===(e=this.clientOpts)||void 0===e||!e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,t,r,i,n={dir:p.Direction.Backward}){var o,s;const a=i?this.getEncryptedIfNeededEventType(e,i):null,[c,l]=await Promise.all([this.fetchRoomEvent(e,t),this.fetchRelations(e,t,r,a,n)]),u=this.getEventMapper(),h=c?u(c):void 0;let d=l.chunk.map(u);if(a===D.EventType.RoomMessageEncrypted){const e=h?d.concat(h):d;await Promise.all(e.map((e=>this.decryptEventIfNeeded(e)))),null!==i&&(d=d.filter((e=>e.getType()===i)))}return h&&r===D.RelationType.Replace&&(d=d.filter((e=>e.getSender()===h.getSender()))),{originalEvent:null!=h?h:null,events:d,nextBatch:null!==(o=l.next_batch)&&void 0!==o?o:null,prevBatch:null!==(s=l.prev_batch)&&void 0!==s?s:null}}getCrossSigningCacheCallbacks(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return(0,N.randomString)(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&this.isCryptoEnabled()&&e.attemptDecryption(this.cryptoBackend,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case _.SERVICE_TYPES.IS:return this.http.getUrl("/terms",void 0,S.IdentityPrefix.V2,t);case _.SERVICE_TYPES.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",t);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(e=!1){var t,r;return e&&(null!==(t=this.idBaseUrl)&&void 0!==t&&t.startsWith("http://")||null!==(r=this.idBaseUrl)&&void 0!==r&&r.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=f.ensureNoTrailingSlash(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}setAccessToken(e){this.http.opts.accessToken=e}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(S.Method.Get,"/register/available",{username:e}).then((e=>e.available)).catch((e=>"M_USER_IN_USE"!==e.errcode&&Promise.reject(e)))}register(e,t,r,i,n,o,s){!0===n?n={email:!0}:null!=n&&!1!==n||(n={}),r&&(i.session=r);const a={auth:i,refresh_token:!0};return null!=e&&(a.username=e),null!=t&&(a.password=t),n.email&&(a.bind_email=!0),n.msisdn&&(a.bind_msisdn=!0),null!=o&&(a.guest_access_token=o),null!=s&&(a.inhibit_login=s),null!=t&&(a.x_show_msisdn=!0),this.registerRequest(a)}registerGuest({body:e}={}){return this.registerRequest(e||{},"guest")}registerRequest(e,t){const r={};return t&&(r.kind=t),this.http.request(S.Method.Post,"/register",r,e)}refreshToken(e){return this.http.authedRequest(S.Method.Post,"/refresh",void 0,{refresh_token:e},{prefix:S.ClientPrefix.V1,inhibitLogoutEmit:!0})}loginFlows(){return this.http.request(S.Method.Get,"/login")}login(e,t){const r={type:e};return Object.assign(r,t),this.http.authedRequest(S.Method.Post,"/login",void 0,r).then((e=>(e.access_token&&e.user_id&&(this.http.opts.accessToken=e.access_token,this.credentials={userId:e.user_id}),e)))}loginWithPassword(e,t){return this.login("m.login.password",{user:e,password:t})}loginWithSAML2(e){return this.login("m.login.saml2",{relay_state:e})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e,t="sso",r,i){let n="/login/"+t+"/redirect";r&&(n+="/"+r);const o={redirectUrl:e,[be.unstable]:i};return this.http.getUrl(n,o,S.ClientPrefix.R0).href}loginWithToken(e){return this.login("m.login.token",{token:e})}async logout(e=!1){var t,r;if(null!==(t=this.crypto)&&void 0!==t&&null!==(r=t.backupManager)&&void 0!==r&&r.getKeyBackupEnabled())try{for(;await this.crypto.backupManager.backupPendingKeys(200)>0;);}catch(e){w.logger.error("Key backup request failed when logging out. Some keys may be missing from backup",e)}return e&&(this.stopClient(),this.http.abort()),this.http.authedRequest(S.Method.Post,"/logout")}deactivateAccount(e,t){const r={};return e&&(r.auth=e),void 0!==t&&(r.erase=t),this.http.authedRequest(S.Method.Post,"/account/deactivate",void 0,r)}requestLoginToken(e){const t={auth:e};return this.http.authedRequest(S.Method.Post,"/org.matrix.msc3882/login/token",void 0,t,{prefix:S.ClientPrefix.Unstable})}getFallbackAuthUrl(e,t){const r=f.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:t},S.ClientPrefix.R0).href}async createRoom(e){var t;const r=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(r.length>0&&null!==(t=this.identityServer)&&void 0!==t&&t.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();if(e)for(const t of r)t.id_access_token=e}return this.http.authedRequest(S.Method.Post,"/createRoom",void 0,e)}fetchRelations(e,t,r,i,n={dir:p.Direction.Backward}){let o=n;z.Thread.hasServerSideFwdPaginationSupport===z.FeatureSupport.Experimental&&(o=(0,f.replaceParam)("dir","org.matrix.msc3715.dir",o));const s=f.encodeParams(o);let a="/rooms/$roomId/relations/$eventId";null!==r?(a+="/$relationType",null!==i&&(a+="/$eventType")):null!==i&&(w.logger.warn(`eventType: ${i} ignored when fetching\n            relations as relationType is null`),i=null);const c=f.encodeUri(a+"?"+s,{$roomId:e,$eventId:t,$relationType:r,$eventType:i});return this.http.authedRequest(S.Method.Get,c,void 0,void 0,{prefix:S.ClientPrefix.V1})}roomState(e){const t=f.encodeUri("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(S.Method.Get,t)}fetchRoomEvent(e,t){const r=f.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(S.Method.Get,r)}members(e,t,r,i){const n={};t&&(n.membership=t),r&&(n.not_membership=r),i&&(n.at=i);const o=f.encodeParams(n),s=f.encodeUri("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(S.Method.Get,s)}upgradeRoom(e,t){const r=f.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(S.Method.Post,r,void 0,{new_version:t})}getStateEvent(e,t,r){const i={$roomId:e,$eventType:t,$stateKey:r};let n=f.encodeUri("/rooms/$roomId/state/$eventType",i);return void 0!==r&&(n=f.encodeUri(n+"/$stateKey",i)),this.http.authedRequest(S.Method.Get,n)}sendStateEvent(e,t,r,i="",n={}){const o={$roomId:e,$eventType:t,$stateKey:i};let s=f.encodeUri("/rooms/$roomId/state/$eventType",o);return void 0!==i&&(s=f.encodeUri(s+"/$stateKey",o)),this.http.authedRequest(S.Method.Put,s,void 0,r,n)}roomInitialSync(e,t){var r;const i=f.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(S.Method.Get,i,{limit:null!==(r=null==t?void 0:t.toString())&&void 0!==r?r:"30"})}async setRoomReadMarkersHttpRequest(e,t,r,i){const n=f.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),o={[H.ReceiptType.FullyRead]:t,[H.ReceiptType.Read]:r};return(await this.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")||await this.isVersionSupported("v1.4"))&&(o[H.ReceiptType.ReadPrivate]=i),this.http.authedRequest(S.Method.Post,n,void 0,o)}getJoinedRooms(){const e=f.encodeUri("/joined_rooms",{});return this.http.authedRequest(S.Method.Get,e)}getJoinedRoomMembers(e){const t=f.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(S.Method.Get,t)}publicRooms(e={}){let{server:t,limit:r,since:i}=e,n=(0,o.default)(e,te);const s={server:t,limit:r,since:i};return 0===Object.keys(n).length?this.http.authedRequest(S.Method.Get,"/publicRooms",s):this.http.authedRequest(S.Method.Post,"/publicRooms",s,n)}createAlias(e,t){const r=f.encodeUri("/directory/room/$alias",{$alias:e}),i={room_id:t};return this.http.authedRequest(S.Method.Put,r,void 0,i)}deleteAlias(e){const t=f.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(S.Method.Delete,t)}getLocalAliases(e){const t=f.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),r=S.ClientPrefix.V3;return this.http.authedRequest(S.Method.Get,t,void 0,void 0,{prefix:r})}getRoomIdForAlias(e){const t=f.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(S.Method.Get,t)}resolveRoomAlias(e){const t=f.encodeUri("/directory/room/$alias",{$alias:e});return this.http.request(S.Method.Get,t)}getRoomDirectoryVisibility(e){const t=f.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(S.Method.Get,t)}setRoomDirectoryVisibility(e,t){const r=f.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(S.Method.Put,r,void 0,{visibility:t})}setRoomDirectoryVisibilityAppService(e,t,r){const i=f.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(S.Method.Put,i,void 0,{visibility:r})}searchUserDirectory({term:e,limit:t}){const r={search_term:e};return void 0!==t&&(r.limit=t),this.http.authedRequest(S.Method.Post,"/user_directory/search",void 0,r)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t){const r=t?f.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):f.encodeUri("/profile/$userId",{$userId:e});return this.http.authedRequest(S.Method.Get,r)}getThreePids(){return this.http.authedRequest(S.Method.Get,"/account/3pid")}addThreePid(e,t){const r={threePidCreds:e,bind:t};return this.http.authedRequest(S.Method.Post,"/account/3pid",void 0,r)}async addThreePidOnly(e){const t=await this.isVersionSupported("r0.6.0")?S.ClientPrefix.R0:S.ClientPrefix.Unstable;return this.http.authedRequest(S.Method.Post,"/account/3pid/add",void 0,e,{prefix:t})}async bindThreePid(e){const t=await this.isVersionSupported("r0.6.0")?S.ClientPrefix.R0:S.ClientPrefix.Unstable;return this.http.authedRequest(S.Method.Post,"/account/3pid/bind",void 0,e,{prefix:t})}async unbindThreePid(e,t){const r={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},i=await this.isVersionSupported("r0.6.0")?S.ClientPrefix.R0:S.ClientPrefix.Unstable;return this.http.authedRequest(S.Method.Post,"/account/3pid/unbind",void 0,r,{prefix:i})}deleteThreePid(e,t){return this.http.authedRequest(S.Method.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}setPassword(e,t,r){const i={auth:e,new_password:t,logout_devices:r};return this.http.authedRequest(S.Method.Post,"/account/password",void 0,i)}getDevices(){return this.http.authedRequest(S.Method.Get,"/devices")}getDevice(e){const t=f.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(S.Method.Get,t)}setDeviceDetails(e,t){const r=f.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(S.Method.Put,r,void 0,t)}deleteDevice(e,t){const r=f.encodeUri("/devices/$device_id",{$device_id:e}),i={};return t&&(i.auth=t),this.http.authedRequest(S.Method.Delete,r,void 0,i)}deleteMultipleDevices(e,t){const r={devices:e};t&&(r.auth=t);return this.http.authedRequest(S.Method.Post,"/delete_devices",void 0,r)}async getPushers(){const e=await this.http.authedRequest(S.Method.Get,"/pushers");return await this.doesServerSupportUnstableFeature("org.matrix.msc3881")||(e.pushers=e.pushers.map((e=>(e.hasOwnProperty(D.PUSHER_ENABLED.name)||(e[D.PUSHER_ENABLED.name]=!0),e)))),e}setPusher(e){return this.http.authedRequest(S.Method.Post,"/pushers/set",void 0,e)}setLocalNotificationSettings(e,t){const r=`${D.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name}.${e}`;return this.setAccountData(r,t)}getPushRules(){return this.http.authedRequest(S.Method.Get,"/pushrules/").then((e=>m.PushProcessor.rewriteDefaultRules(e)))}addPushRule(e,t,r,i){const n=f.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this.http.authedRequest(S.Method.Put,n,void 0,i)}deletePushRule(e,t,r){const i=f.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this.http.authedRequest(S.Method.Delete,i)}setPushRuleEnabled(e,t,r,i){const n=f.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:r});return this.http.authedRequest(S.Method.Put,n,void 0,{enabled:i})}setPushRuleActions(e,t,r,i){const n=f.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:r});return this.http.authedRequest(S.Method.Put,n,void 0,{actions:i})}search({body:e,next_batch:t},r){const i={};return t&&(i.next_batch=t),this.http.authedRequest(S.Method.Post,"/search",i,e,{abortSignal:r})}uploadKeysRequest(e,t){return this.http.authedRequest(S.Method.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(S.Method.Post,"/keys/signatures/upload",void 0,e,{prefix:S.ClientPrefix.V3})}downloadKeysForUsers(e,{token:t}={}){const r={device_keys:{}};return void 0!==t&&(r.token=t),e.forEach((e=>{r.device_keys[e]=[]})),this.http.authedRequest(S.Method.Post,"/keys/query",void 0,r)}claimOneTimeKeys(e,t="signed_curve25519",r){const i={};void 0===t&&(t="signed_curve25519");for(const[r,n]of e){const e=i[r]||{};i[r]=e,e[n]=t}const n={one_time_keys:i};r&&(n.timeout=r);return this.http.authedRequest(S.Method.Post,"/keys/claim",void 0,n)}getKeyChanges(e,t){const r={from:e,to:t};return this.http.authedRequest(S.Method.Get,"/keys/changes",r)}uploadDeviceSigningKeys(e,t){const r=Object.assign({},t);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(S.Method.Post,"/keys/device_signing/upload",void 0,r,{prefix:S.ClientPrefix.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");const t=this.http.getUrl("/account/register",void 0,S.IdentityPrefix.V2,this.idBaseUrl);return this.http.requestOtherUrl(S.Method.Post,t,e)}requestEmailToken(e,t,r,i,n){const o={client_secret:t,email:e,send_attempt:null==r?void 0:r.toString(),next_link:i};return this.http.idServerRequest(S.Method.Post,"/validate/email/requestToken",o,S.IdentityPrefix.V2,n)}requestMsisdnToken(e,t,r,i,n,o){const s={client_secret:r,country:e,phone_number:t,send_attempt:null==i?void 0:i.toString(),next_link:n};return this.http.idServerRequest(S.Method.Post,"/validate/msisdn/requestToken",s,S.IdentityPrefix.V2,o)}submitMsisdnToken(e,t,r,i){const n={sid:e,client_secret:t,token:r};return this.http.idServerRequest(S.Method.Post,"/validate/msisdn/submitToken",n,S.IdentityPrefix.V2,i)}submitMsisdnTokenOtherUrl(e,t,r,i){const n={sid:t,client_secret:r,token:i};return this.http.requestOtherUrl(S.Method.Post,e,n)}getIdentityHashDetails(e){return this.http.idServerRequest(S.Method.Get,"/hash_details",void 0,S.IdentityPrefix.V2,e)}async identityHashedLookup(e,t){const i={},n=await this.getIdentityHashDetails(t);if(!n||!n.lookup_pepper||!n.algorithms)throw new Error("Unsupported identity server: bad response");i.pepper=n.lookup_pepper;const o={};if(n.algorithms.includes("sha256")){const t=new r.Olm.Utility;i.addresses=e.map((e=>{const r=e[0].toLowerCase(),n=e[1].toLowerCase(),s=t.sha256(`${r} ${n} ${i.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return o[s]=e[0],s})),i.algorithm="sha256"}else{if(!n.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");i.addresses=e.map((e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return o[t]=e[0],t})),i.algorithm="none"}const s=await this.http.idServerRequest(S.Method.Post,"/lookup",i,S.IdentityPrefix.V2,t);if(null==s||!s.mappings)return[];const a=[];for(const e of Object.keys(s.mappings)){const t=s.mappings[e],r=o[e];if(!r)throw new Error("Identity server returned more results than expected");a.push({address:r,mxid:t})}return a}async lookupThreePid(e,t,r){const i=(await this.identityHashedLookup([[t,e]],r)).find((e=>e.address===t));if(!i)return{};return{address:t,medium:e,mxid:i.mxid}}async bulkLookupThreePids(e,t){const r=await this.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),i=[];for(const t of r){const r=e.find((e=>e[1]===t.address));if(!r)throw new Error("Identity sever returned unexpected results");i.push([r[0],t.address,t.mxid])}return{threepids:i}}getIdentityAccount(e){return this.http.idServerRequest(S.Method.Get,"/account",void 0,S.IdentityPrefix.V2,e)}sendToDevice(e,t,r){const i=f.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),n={messages:t},o=Object.keys(t).reduce(((e,r)=>(e[r]=Object.keys(t[r]),e)),{});return w.logger.log(`PUT ${i}`,o),this.http.authedRequest(S.Method.Put,i,void 0,n)}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(S.Method.Get,"/thirdparty/protocols").then((e=>{if(!e||"object"!=typeof e)throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e}))}getThirdpartyLocation(e,t){const r=f.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(S.Method.Get,r,t)}getThirdpartyUser(e,t){const r=f.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(S.Method.Get,r,t)}getTerms(e,t){const r=this.termsUrlForService(e,t);return this.http.requestOtherUrl(S.Method.Get,r)}agreeToTerms(e,t,r,i){const n=this.termsUrlForService(e,t),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(S.Method.Post,n,{user_accepts:i},{headers:o})}reportEvent(e,t,r,i){const n=f.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(S.Method.Post,n,void 0,{score:r,reason:i})}getRoomHierarchy(e,t,r,i=!1,n){const o=f.encodeUri("/rooms/$roomId/hierarchy",{$roomId:e}),s={suggested_only:String(i),max_depth:null==r?void 0:r.toString(),from:n,limit:null==t?void 0:t.toString()};return this.http.authedRequest(S.Method.Get,o,s,void 0,{prefix:S.ClientPrefix.V1}).catch((e=>{if("M_UNRECOGNIZED"===e.errcode)return this.http.authedRequest(S.Method.Get,o,s,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw e}))}async unstableCreateFileTree(e){const{room_id:t}=await this.createRoom({name:e,preset:L.Preset.PrivateChat,power_level_content_override:ie(ie({},B.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{},{users:{[this.getUserId()]:100}}),creation_content:{[D.RoomCreateTypeField]:D.RoomType.Space},initial_state:[{type:D.UNSTABLE_MSC3088_PURPOSE.name,state_key:D.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:{[D.UNSTABLE_MSC3088_ENABLED.name]:!0}},{type:D.EventType.RoomEncryption,state_key:"",content:{algorithm:v.MEGOLM_ALGORITHM}}]});return new B.MSC3089TreeSpace(this,t)}unstableGetFileTreeSpace(e){var t,r;const i=this.getRoom(e);if("join"!==(null==i?void 0:i.getMyMembership()))return null;const n=i.currentState.getStateEvents(D.EventType.RoomCreate,""),o=i.currentState.getStateEvents(D.UNSTABLE_MSC3088_PURPOSE.name,D.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!n)throw new Error("Expected single room create event");return null!=o&&null!==(t=o.getContent())&&void 0!==t&&t[D.UNSTABLE_MSC3088_ENABLED.name]?(null===(r=n.getContent())||void 0===r?void 0:r[D.RoomCreateTypeField])!==D.RoomType.Space?null:new B.MSC3089TreeSpace(this,e):null}slidingSync(e,t,r){const i={};e.pos&&(i.pos=e.pos,delete e.pos),e.timeout&&(i.timeout=e.timeout,delete e.timeout);const n=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(S.Method.Post,"/sync",i,e,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:t,localTimeoutMs:n,abortSignal:r})}supportsExperimentalThreads(){var e;return w.logger.warn("supportsExperimentalThreads() is deprecated, use supportThreads() instead"),(null===(e=this.clientOpts)||void 0===e?void 0:e.experimentalThreadSupport)||!1}supportsThreads(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.threadSupport)||!1}async getRoomSummary(e,t){const r=f.encodeUri("/rooms/$roomid/summary",{$roomid:e});return this.http.authedRequest(S.Method.Get,r,{via:t},void 0,{prefix:"/_matrix/client/unstable/im.nheko.summary"})}processThreadEvents(e,t,r){e.processThreadedEvents(t,r)}processThreadRoots(e,t,r){e.processThreadRoots(t,r)}processBeaconEvents(e,t){this.processAggregatedTimelineEvents(e,t)}processAggregatedTimelineEvents(e,t){null!=t&&t.length&&e&&(e.currentState.processBeaconEvents(t,this),e.processPollEvents(t))}async whoami(){return this.http.authedRequest(S.Method.Get,"/account/whoami")}async timestampToEvent(e,t,r){const i=f.encodeUri("/rooms/$roomId/timestamp_to_event",{$roomId:e}),n={ts:t.toString(),dir:r};try{return await this.http.authedRequest(S.Method.Get,i,n,void 0,{prefix:S.ClientPrefix.V1})}catch(e){if("M_UNRECOGNIZED"===e.errcode&&(400===e.httpStatus||404===e.httpStatus||405===e.httpStatus))return await this.http.authedRequest(S.Method.Get,i,n,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw e}}}function _e(e,t){var r,i;const n=t.getPushActions(),o=e.getPushActionsForEvent(t,!0),s=e.getRoom(t.getRoomId());if(!s||!e.getUserId())return;const a=!!t.threadRootId&&!t.isThreadRoot,c=s.getUnreadCountForEventContext(A.NotificationCountType.Highlight,t),l=!(null==n||null===(r=n.tweaks)||void 0===r||!r.highlight),u=!(null==o||null===(i=o.tweaks)||void 0===i||!i.highlight);if(l!==u||c>0){let r;if(a){const i=s.getThread(t.threadRootId);r=!i||i.hasUserReadEvent(e.getUserId(),t.getId())}else r=s.hasUserReadEvent(e.getUserId(),t.getId());if(!r){var h;let e=c;u&&!l&&e++,!u&&l&&e--,a?s.setThreadUnreadNotificationCount(t.threadRootId,A.NotificationCountType.Highlight,e):s.setUnreadNotificationCount(A.NotificationCountType.Highlight,e);(null!==(h=a?s.getThreadUnreadNotificationCount(t.threadRootId,A.NotificationCountType.Total):s.getRoomUnreadNotificationCount(A.NotificationCountType.Total))&&void 0!==h?h:0)<e&&(a?s.setThreadUnreadNotificationCount(t.threadRootId,A.NotificationCountType.Total,e):s.setUnreadNotificationCount(A.NotificationCountType.Total,e))}}}e.exports.MatrixClient=we,(0,s.default)(we,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")})),i.register("62hJ7",(function(e,t){var r=i("7wwUb");e.exports=function(e,t){if(null==e)return{};var i,n,o=r(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o},e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("7wwUb",(function(e,t){e.exports=function(e,t){if(null==e)return{};var r,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||(n[r]=e[r]);return n},e.exports.__esModule=!0,e.exports.default=e.exports})),i.register("1dCYQ",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SyncState=e.exports.SyncApi=void 0,e.exports._createAndReEmitRoom=U,e.exports.defaultClientOpts=P,e.exports.defaultSyncApiOpts=D;var o=n(i("3EUCw")),s=i("fLhqT"),a=i("846Vo"),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=S(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),l=i("l2QFk"),u=i("jxKcy"),h=i("dpNo2"),d=i("gEWrD"),f=i("dsM0i"),p=i("5pxqF"),m=i("cH9or"),g=i("ldT3p"),v=i("l2mJP"),y=i("6koSf"),b=i("6cjco"),w=i("aYGbo"),_=i("gw07V");function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(S=function(e){return e?r:t})(e)}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const C=!0;let I;var T;e.exports.SyncState=I,(T=I||(e.exports.SyncState=I={})).Error="ERROR",T.Prepared="PREPARED",T.Stopped="STOPPED",T.Syncing="SYNCING",T.Catchup="CATCHUP",T.Reconnecting="RECONNECTING";const k=["org.matrix.msc2716v3"];function R(e,t){return`FILTER_SYNC_${e}`+(t?"_"+t:"")}function x(...e){C&&d.logger.log(...e)}var O,A;function P(e){return M({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:3e4,pendingEventOrdering:p.PendingEventOrdering.Chronological,threadSupport:!1},e)}function D(e){return M({canResetEntireTimeline:e=>!1},e)}(A=O||(O={})).Offline="offline",A.Online="online",A.Unavailable="unavailable";function L(e,t){const r=new s.User(t);return e.reEmitter.reEmit(r,[s.UserEvent.AvatarUrl,s.UserEvent.DisplayName,s.UserEvent.Presence,s.UserEvent.CurrentlyActive,s.UserEvent.LastPresenceTs]),r}function U(e,t,r){const{timelineSupport:i}=e,n=new a.Room(t,e,e.getUserId(),{lazyLoadMembers:r.lazyLoadMembers,pendingEventOrdering:r.pendingEventOrdering,timelineSupport:i});return e.reEmitter.reEmit(n,[a.RoomEvent.Name,a.RoomEvent.Redaction,a.RoomEvent.RedactionCancelled,a.RoomEvent.Receipt,a.RoomEvent.Tags,a.RoomEvent.LocalEchoUpdated,a.RoomEvent.AccountData,a.RoomEvent.MyMembership,a.RoomEvent.Timeline,a.RoomEvent.TimelineReset,v.RoomStateEvent.Events,v.RoomStateEvent.Members,v.RoomStateEvent.NewMember,v.RoomStateEvent.Update,b.BeaconEvent.New,b.BeaconEvent.Update,b.BeaconEvent.Destroy,b.BeaconEvent.LivenessChange]),n.on(v.RoomStateEvent.NewMember,((t,r,i)=>{var n;i.user=null!==(n=e.getUser(i.userId))&&void 0!==n?n:void 0,e.reEmitter.reEmit(i,[y.RoomMemberEvent.Name,y.RoomMemberEvent.Typing,y.RoomMemberEvent.PowerLevel,y.RoomMemberEvent.Membership])})),n}e.exports.SyncApi=class{constructor(e,t,r){this.client=e,(0,o.default)(this,"opts",void 0),(0,o.default)(this,"syncOpts",void 0),(0,o.default)(this,"_peekRoom",null),(0,o.default)(this,"currentSyncRequest",void 0),(0,o.default)(this,"abortController",void 0),(0,o.default)(this,"syncState",null),(0,o.default)(this,"syncStateData",void 0),(0,o.default)(this,"catchingUp",!1),(0,o.default)(this,"running",!1),(0,o.default)(this,"keepAliveTimer",void 0),(0,o.default)(this,"connectionReturnedDefer",void 0),(0,o.default)(this,"notifEvents",[]),(0,o.default)(this,"failedSyncCount",0),(0,o.default)(this,"storeIsInvalid",!1),(0,o.default)(this,"getPushRules",(async()=>{try{x("Getting push rules...");const e=await this.client.getPushRules();x("Got push rules"),this.client.pushRules=e}catch(e){if(d.logger.error("Getting push rules failed",e),this.shouldAbortSync(e))return;return x("Waiting for saved sync before retrying push rules..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,e),this.getPushRules()}})),(0,o.default)(this,"buildDefaultFilter",(()=>{const e=new l.Filter(this.client.credentials.userId);return this.client.canSupport.get(_.Feature.ThreadUnreadNotifications)!==_.ServerSupport.Unsupported&&e.setUnreadThreadNotifications(!0),e})),(0,o.default)(this,"checkLazyLoadStatus",(async()=>{if(x("Checking lazy load status..."),this.opts.lazyLoadMembers&&this.client.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers){x("Checking server lazy load support...");await this.client.doesServerSupportLazyLoading()?(x("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=this.buildDefaultFilter()),this.opts.filter.setLazyLoadMembers(!0)):(x("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)}x("Checking whether lazy loading has changed in store...");if(await this.wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this.storeIsInvalid=!0;const e=new f.InvalidStoreError(f.InvalidStoreState.ToggledLazyLoading,!!this.opts.lazyLoadMembers);return this.updateSyncState(I.Error,{error:e}),void d.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}var e;this.opts.lazyLoadMembers&&(null===(e=this.syncOpts.crypto)||void 0===e||e.enableLazyLoading());try{x("Storing client options..."),await this.client.storeClientOptions(),x("Stored client options")}catch(e){throw d.logger.error("Storing client options failed",e),e}})),(0,o.default)(this,"getFilter",(async()=>{let e,t;x("Getting filter..."),e=this.opts.filter?this.opts.filter:this.buildDefaultFilter();try{t=await this.client.getOrCreateFilter(R(this.client.credentials.userId),e)}catch(e){return d.logger.error("Getting filter failed",e),this.shouldAbortSync(e)?{}:(x("Waiting for saved sync before retrying filter..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,e),this.getFilter())}return{filter:e,filterId:t}})),(0,o.default)(this,"savedSyncPromise",void 0),(0,o.default)(this,"onOnline",(()=>{x("Browser thinks we are back online"),this.startKeepAlives(0)})),this.opts=P(t),this.syncOpts=D(r),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[a.RoomEvent.Timeline,a.RoomEvent.TimelineReset])}createRoom(e){const t=U(this.client,e,this.opts);return t.on(v.RoomStateEvent.Marker,((e,r)=>{this.onMarkerStateEvent(t,e,r)})),t}onMarkerStateEvent(e,t,{timelineWasEmpty:r}={}){if(r)return void d.logger.debug(`MarkerState: Ignoring markerEventId=${t.getId()} in roomId=${e.roomId} because the timeline was empty before the marker arrived which means there is nothing to refresh.`);k.includes(e.getVersion())||t.getSender()===e.getCreator()?(d.logger.debug(`MarkerState: Timeline needs to be refreshed because a new markerEventId=${t.getId()} was sent in roomId=${e.roomId}`),e.setTimelineNeedsRefresh(!0),e.emit(a.RoomEvent.HistoryImportedWithinTimeline,t,e)):d.logger.debug(`MarkerState: Ignoring markerEventId=${t.getId()} in roomId=${e.roomId} because MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.`)}async syncLeftRooms(){var e;const t=this.client,r=new l.Filter(this.client.credentials.userId);r.setTimelineLimit(1),r.setIncludeLeaveRooms(!0);const i=this.opts.pollTimeout+8e4,n={timeout:0,filter:await t.getOrCreateFilter(R(t.credentials.userId,"LEFT_ROOMS"),r)},o=await t.http.authedRequest(m.Method.Get,"/sync",n,void 0,{localTimeoutMs:i});let s=[];null!==(e=o.rooms)&&void 0!==e&&e.leave&&(s=this.mapSyncResponseToRoomArray(o.rooms.leave));return(await Promise.all(s.map((async e=>{const r=e.room;if(!e.isBrandNewRoom)return;e.timeline=e.timeline||{prev_batch:null,events:[]};const i=this.mapSyncEventsFormat(e.timeline,r),n=this.mapSyncEventsFormat(e.state,r);return r.getLiveTimeline().setPaginationToken(e.timeline.prev_batch,u.EventTimeline.BACKWARDS),await this.injectRoomEvents(r,n,i),r.recalculate(),t.store.storeRoom(r),t.emit(p.ClientEvent.Room,r),this.processEventsForNotifs(r,i),r})))).filter(Boolean)}peek(e){var t;if((null===(t=this._peekRoom)||void 0===t?void 0:t.roomId)===e)return Promise.resolve(this._peekRoom);const r=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((e=>{e.messages=e.messages||{chunk:[]},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const t=c.deepCopy(e.state).map(r.getEventMapper()),i=e.state.map(r.getEventMapper()),n=e.messages.chunk.map(r.getEventMapper());return Array.isArray(e.presence)&&e.presence.map(r.getEventMapper()).forEach((function(e){let t=r.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=L(r,e.getContent().user_id),t.setPresenceEvent(e),r.store.storeUser(t)),r.emit(p.ClientEvent.Event,e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(t),this._peekRoom.currentState.setStateEvents(i),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(n.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),r.store.storeRoom(this._peekRoom),r.emit(p.ClientEvent.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom}))}stopPeeking(){this._peekRoom=null}peekPoll(e,t){var r;this._peekRoom===e?this.client.http.authedRequest(m.Method.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,{localTimeoutMs:5e4,abortSignal:null===(r=this.abortController)||void 0===r?void 0:r.signal}).then((t=>{if(this._peekRoom!==e)return void x("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(this.client.getEventMapper()).forEach((e=>{let t=this.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=L(this.client,e.getContent().user_id),t.setPresenceEvent(e),this.client.store.storeUser(t)),this.client.emit(p.ClientEvent.Event,e)}));const r=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(this.client.getEventMapper());e.addLiveEvents(r),this.peekPoll(e,t.end)}),(r=>{d.logger.error("[%s] Peek poll failed: %s",e.roomId,r),setTimeout((()=>{this.peekPoll(e,t)}),3e4)})):x("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}async recoverFromSyncStartupError(e,t){await e;const r=this.startKeepAlives();this.updateSyncState(I.Error,{error:t}),await r}async wasLazyLoadingToggled(e=!1){let t=!1;if(!await this.client.store.isNewlyCreated()){const r=await this.client.store.getClientOptions();return r&&(t=!!r.lazyLoadMembers),t!==e}return!1}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(d.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(I.Error,{error:e}),!0)}async sync(){var e,t;if(this.running=!0,this.abortController=new AbortController,null===(e=r.window)||void 0===e||null===(t=e.addEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.client.isGuest())return this.doSync({});x("Getting saved sync token...");const i=this.client.store.getSavedSyncToken().then((e=>(x("Got saved sync token"),e)));this.savedSyncPromise=this.client.store.getSavedSync().then((e=>{if(x(`Got reply from saved sync, exists? ${!!e}`),e)return this.syncFromCache(e)})).catch((e=>{d.logger.error("Getting saved sync failed",e)})),await this.getPushRules(),await this.checkLazyLoadStatus();const{filterId:n,filter:o}=await this.getFilter();if(o){if(this.client.resetNotifTimelineSet(),!this.currentSyncRequest){let e=n;const t=await i;if(t)x("Sending first sync request...");else{x("Sending initial sync request...");const t=this.buildDefaultFilter();t.setDefinition(o.getDefinition()),t.setTimelineLimit(this.opts.initialSyncLimit),e=JSON.stringify(t.getDefinition())}this.currentSyncRequest=this.doSyncRequest({filter:e},t)}return x("Waiting for saved sync before starting sync processing..."),await this.savedSyncPromise,this.doSync({filter:n})}}stop(){var e,t,i;x("SyncApi.stop"),null===(e=r.window)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.running=!1,null===(i=this.abortController)||void 0===i||i.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}async syncFromCache(e){x("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const r={nextSyncToken:t,catchingUp:!1,fromCache:!0},i={next_batch:t,rooms:e.roomsData,account_data:{events:e.accountData}};try{await this.processSyncResponse(r,i)}catch(e){d.logger.error("Error processing cached sync",e)}this.storeIsInvalid||this.updateSyncState(I.Prepared,r)}async doSync(e){for(;this.running;){const t=this.client.store.getSyncToken();let r;try{this.currentSyncRequest||(this.currentSyncRequest=this.doSyncRequest(e,t)),r=await this.currentSyncRequest}catch(e){if(await this.onSyncError(e))return;continue}finally{this.currentSyncRequest=void 0}this.client.store.setSyncToken(r.next_batch),this.failedSyncCount=0,await this.client.store.setSyncData(r);const i={oldSyncToken:null!=t?t:void 0,nextSyncToken:r.next_batch,catchingUp:this.catchingUp};this.syncOpts.crypto&&await this.syncOpts.crypto.onSyncWillProcess(i);try{await this.processSyncResponse(i,r)}catch(e){d.logger.error("Caught /sync error",e),this.client.emit(p.ClientEvent.SyncUnexpectedError,e)}i.catchingUp=this.catchingUp,e.hasSyncedBefore||(this.updateSyncState(I.Prepared,i),e.hasSyncedBefore=!0),this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.onSyncCompleted(i),this.updateSyncState(I.Syncing,i),this.client.store.wantsSave()&&(this.syncOpts.crypto&&await this.syncOpts.crypto.saveDeviceList(0),this.client.store.save())}this.running||(x("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState(I.Stopped))}doSyncRequest(e,t){var r;const i=this.getSyncParams(e,t);return this.client.http.authedRequest(m.Method.Get,"/sync",i,void 0,{localTimeoutMs:i.timeout+8e4,abortSignal:null===(r=this.abortController)||void 0===r?void 0:r.signal})}getSyncParams(e,t){let r=this.opts.pollTimeout;(this.getSyncState()!==I.Syncing||this.catchingUp)&&(this.catchingUp=!0,r=0);let i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());const n={filter:i,timeout:r};return this.opts.disablePresence&&(n.set_presence=O.Offline),t?n.since=t:n._cacheBuster=Date.now(),[I.Reconnecting,I.Error].includes(this.getSyncState())&&(n.timeout=0),n}async onSyncError(e){if(!this.running)return x("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState(I.Stopped),!0;if(d.logger.error("/sync error %s",e),this.shouldAbortSync(e))return!0;this.failedSyncCount++,d.logger.log("Number of consecutive failed sync requests:",this.failedSyncCount),x("Starting keep-alive");const t=this.startKeepAlives();this.currentSyncRequest=void 0,this.updateSyncState(this.failedSyncCount>=3?I.Error:I.Reconnecting,{error:e});return await t&&this.getSyncState()===I.Error&&this.updateSyncState(I.Catchup,{catchingUp:!0}),!1}async processSyncResponse(e,t){var r,i;const n=this.client;if(Array.isArray(null===(r=t.presence)||void 0===r?void 0:r.events)&&t.presence.events.map(n.getEventMapper()).forEach((function(e){let t=n.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=L(n,e.getSender()),t.setPresenceEvent(e),n.store.storeUser(t)),n.emit(p.ClientEvent.Event,e)})),Array.isArray(null===(i=t.account_data)||void 0===i?void 0:i.events)){const e=t.account_data.events.map(n.getEventMapper()),r=e.reduce(((e,t)=>(e[t.getType()]=n.store.getAccountData(t.getType()),e)),{});n.store.storeAccountDataEvents(e),e.forEach((function(e){if(e.getType()===g.EventType.PushRules){const t=e.getContent();n.pushRules=h.PushProcessor.rewriteDefaultRules(t)}const t=r[e.getType()];return n.emit(p.ClientEvent.AccountData,e,t),e}))}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){let e=t.to_device.events;this.syncOpts.cryptoCallbacks&&(e=await this.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(e));const r=[];e.map(n.getEventMapper({toDevice:!0})).map((e=>{if("m.key.verification.cancel"===e.getType()){const t=e.getContent().transaction_id;t&&r.push(t)}return e})).forEach((function(e){const t=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=t.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){const i=t.transaction_id;r.includes(i)&&e.flagCancelled()}n.emit(p.ClientEvent.ToDeviceEvent,e)}else d.logger.log("Ignoring undecryptable to-device event from "+e.getSender())}))}else this.catchingUp=!1;let o=[],s=[],l=[];if(t.rooms&&(t.rooms.invite&&(o=this.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(s=this.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(l=this.mapSyncResponseToRoomArray(t.rooms.leave))),this.notifEvents=[],await c.promiseMapSeries(o,(async e=>{var t;const r=e.room,i=this.mapSyncEventsFormat(e.invite_state,r);await this.injectRoomEvents(r,i);const o=null===(t=r.currentState.getStateEvents(g.EventType.RoomMember,n.getUserId()))||void 0===t?void 0:t.getSender(),s=n.crypto;if(s){const e=await s.cryptoStore.takeParkedSharedHistory(r.roomId);for(const t of e)t.senderId===o&&await s.olmDevice.addInboundGroupSession(r.roomId,t.senderKey,t.forwardingCurve25519KeyChain,t.sessionId,t.sessionKey,t.keysClaimed,!0,{sharedHistory:!0,untrusted:!0})}e.isBrandNewRoom?(r.recalculate(),n.store.storeRoom(r),n.emit(p.ClientEvent.Room,r)):r.recalculate(),i.forEach((function(e){n.emit(p.ClientEvent.Event,e)}))})),await c.promiseMapSeries(s,(async t=>{var r;const i=t.room,o=this.mapSyncEventsFormat(t.state,i),s=this.mapSyncEventsFormat(t.timeline,i,!1),c=this.mapSyncEventsFormat(t.ephemeral),l=this.mapSyncEventsFormat(t.account_data),h=n.isRoomEncrypted(i.roomId);var f,m;t.unread_notifications&&(i.setUnreadNotificationCount(a.NotificationCountType.Total,null!==(f=t.unread_notifications.notification_count)&&void 0!==f?f:0),(!h||i.getUnreadNotificationCount(a.NotificationCountType.Highlight)<=0)&&i.setUnreadNotificationCount(a.NotificationCountType.Highlight,null!==(m=t.unread_notifications.highlight_count)&&void 0!==m?m:0));const v=null!==(r=t[w.UNREAD_THREAD_NOTIFICATIONS.name])&&void 0!==r?r:t[w.UNREAD_THREAD_NOTIFICATIONS.altName];if(v){i.resetThreadUnreadNotificationCount(Object.keys(v));for(const[e,t]of Object.entries(v)){var y;i.setThreadUnreadNotificationCount(e,a.NotificationCountType.Total,null!==(y=t.notification_count)&&void 0!==y?y:0);const r=i.getThreadUnreadNotificationCount(e,a.NotificationCountType.Highlight)<=0;var b;if(!h||h&&r)i.setThreadUnreadNotificationCount(e,a.NotificationCountType.Highlight,null!==(b=t.highlight_count)&&void 0!==b?b:0)}}else i.resetThreadUnreadNotificationCount();if(t.timeline=t.timeline||{},t.isBrandNewRoom)null!==t.timeline.prev_batch&&i.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,u.EventTimeline.BACKWARDS);else if(t.timeline.limited){let r=!0;for(let e=s.length-1;e>=0;e--){const t=s[e].getId();if(i.getTimelineForEvent(t)){x(`Already have event ${t} in limited sync - not resetting`),r=!1,s.splice(0,e);break}}var _;if(r)i.resetLiveTimeline(t.timeline.prev_batch,this.syncOpts.canResetEntireTimeline(i.roomId)?null:null!==(_=e.oldSyncToken)&&void 0!==_?_:null),n.resetNotifTimelineSet()}if(this.syncOpts.cryptoCallbacks)for(const e of o.concat(s))e.isState()&&e.getType()===g.EventType.RoomEncryption&&""===e.getStateKey()&&await this.syncOpts.cryptoCallbacks.onCryptoEvent(i,e);try{await this.injectRoomEvents(i,o,s,e.fromCache)}catch(e){d.logger.error(`Failed to process events on room ${i.roomId}:`,e)}t.summary&&i.setSummary(t.summary),i.addEphemeralEvents(c),i.addAccountData(l),i.recalculate(),t.isBrandNewRoom&&(n.store.storeRoom(i),n.emit(p.ClientEvent.Room,i)),this.processEventsForNotifs(i,s);const S=e=>n.emit(p.ClientEvent.Event,e);o.forEach(S),s.forEach(S),c.forEach(S),l.forEach(S),i.decryptCriticalEvents()})),await c.promiseMapSeries(l,(async e=>{const t=e.room,r=this.mapSyncEventsFormat(e.state,t),i=this.mapSyncEventsFormat(e.timeline,t),o=this.mapSyncEventsFormat(e.account_data);await this.injectRoomEvents(t,r,i),t.addAccountData(o),t.recalculate(),e.isBrandNewRoom&&(n.store.storeRoom(t),n.emit(p.ClientEvent.Room,t)),this.processEventsForNotifs(t,i),r.forEach((function(e){n.emit(p.ClientEvent.Event,e)})),i.forEach((function(e){n.emit(p.ClientEvent.Event,e)})),o.forEach((function(e){n.emit(p.ClientEvent.Event,e)}))})),e.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((function(e){var t;null===(t=n.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e)}))),t.device_lists&&this.syncOpts.crypto&&await this.syncOpts.crypto.handleDeviceListChanges(e,t.device_lists),this.syncOpts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.syncOpts.crypto.updateOneTimeKeyCount(e)}if(this.syncOpts.crypto&&(t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"])){const e=t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"];this.syncOpts.crypto.setNeedsNewFallback(Array.isArray(e)&&!e.includes("signed_curve25519"))}}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=c.defer()),this.connectionReturnedDefer.promise}pokeKeepAlive(e=!1){var t;const r=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(e),this.connectionReturnedDefer=void 0)};this.client.http.request(m.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3,abortSignal:null===(t=this.abortController)||void 0===t?void 0:t.signal}).then((()=>{r()}),(t=>{400==t.httpStatus||404==t.httpStatus?this.keepAliveTimer=setTimeout(r,2e3):(e=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,e),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(I.Error,{error:t}))}))}mapSyncResponseToRoomArray(e){const t=this.client;return Object.keys(e).map((r=>{const i=e[r];let n=t.store.getRoom(r),o=!1;return n||(n=this.createRoom(r),o=!0),i.room=n,i.isBrandNewRoom=o,i}))}mapSyncEventsFormat(e,t,r=!0){if(!e||!Array.isArray(e.events))return[];const i=this.client.getEventMapper({decrypt:r});return e.events.map((function(e){return t&&(e.room_id=t.roomId),i(e)}))}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(r){if(r.requestedProfileInfo)return;r.requestedProfileInfo=!0;const i=t.getUser(r.userId);let n;n=i?Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):t.getProfileInfo(r.userId),n.then((function(t){const i=r.events.member;"invite"===(null==i?void 0:i.getContent().membership)&&(i.getContent().avatar_url=t.avatar_url,i.getContent().displayname=t.displayname,r.setMembershipEvent(i,e.currentState))}),(function(e){}))}))}async injectRoomEvents(e,t,r,i=!1){const n=e.getLiveTimeline(),o=0==n.getEvents().length;if(o){for(const e of t)this.client.getPushActionsForEvent(e);n.initialiseState(t,{timelineWasEmpty:o})}this.resolveInvites(e),e.recalculate(),o||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(r||[],{fromCache:i,timelineWasEmpty:o}),this.client.processBeaconEvents(e,r)}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(const e of t){var r;const t=this.client.getPushActionsForEvent(e);null!=t&&t.notify&&null!==(r=t.tweaks)&&void 0!==r&&r.highlight&&this.notifEvents.push(e)}}getGuestFilter(){return"{}"}updateSyncState(e,t){const r=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(p.ClientEvent.Sync,this.syncState,r,t)}}})),i.register("846Vo",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomNameType=e.exports.RoomEvent=e.exports.Room=e.exports.NotificationCountType=e.exports.KNOWN_SAFE_ROOM_VERSION=void 0;var n=r(i("3EUCw")),o=i("e0VXi"),s=i("d1gZy"),a=i("jxKcy"),c=i("juNaO"),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=I(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),u=i("7BSj1"),h=i("hGOrY"),d=i("6koSf"),f=i("eOWig"),p=i("gEWrD"),m=i("eu84r"),g=i("ldT3p"),v=i("5pxqF"),y=i("l2QFk"),b=i("l2mJP"),w=i("6cjco"),_=i("etzbv"),S=i("cXHgq"),E=i("95VbJ"),M=i("auLUJ"),C=i("3yMwy");function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(I=function(e){return e?r:t})(e)}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.KNOWN_SAFE_ROOM_VERSION="9";const R=["1","2","3","4","5","6","7","8","9"];let x;var O;let A;var P;e.exports.NotificationCountType=x,(O=x||(e.exports.NotificationCountType=x={})).Highlight="highlight",O.Total="total",e.exports.RoomEvent=A,(P=A||(e.exports.RoomEvent=A={})).MyMembership="Room.myMembership",P.Tags="Room.tags",P.AccountData="Room.accountData",P.Receipt="Room.receipt",P.Name="Room.name",P.Redaction="Room.redaction",P.RedactionCancelled="Room.redactionCancelled",P.LocalEchoUpdated="Room.localEchoUpdated",P.Timeline="Room.timeline",P.TimelineReset="Room.timelineReset",P.TimelineRefresh="Room.TimelineRefresh",P.OldStateUpdated="Room.OldStateUpdated",P.CurrentStateUpdated="Room.CurrentStateUpdated",P.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",P.UnreadNotifications="Room.UnreadNotifications";class D extends M.ReadReceipt{constructor(e,t,r,i={}){super(),this.roomId=e,this.client=t,this.myUserId=r,this.opts=i,(0,n.default)(this,"reEmitter",void 0),(0,n.default)(this,"txnToEvent",{}),(0,n.default)(this,"notificationCounts",{}),(0,n.default)(this,"threadNotifications",new Map),(0,n.default)(this,"cachedThreadReadReceipts",new Map),(0,n.default)(this,"oldestThreadedReceiptTs",1/0),(0,n.default)(this,"unthreadedReceipts",new Map),(0,n.default)(this,"timelineSets",void 0),(0,n.default)(this,"polls",new Map),(0,n.default)(this,"threadsTimelineSets",[]),(0,n.default)(this,"filteredTimelineSets",{}),(0,n.default)(this,"timelineNeedsRefresh",!1),(0,n.default)(this,"pendingEventList",void 0),(0,n.default)(this,"blacklistUnverifiedDevices",void 0),(0,n.default)(this,"selfMembership",void 0),(0,n.default)(this,"summaryHeroes",null),(0,n.default)(this,"getTypeWarning",!1),(0,n.default)(this,"getVersionWarning",!1),(0,n.default)(this,"membersPromise",void 0),(0,n.default)(this,"name",void 0),(0,n.default)(this,"normalizedName",void 0),(0,n.default)(this,"tags",{}),(0,n.default)(this,"accountData",{}),(0,n.default)(this,"summary",null),(0,n.default)(this,"timeline",void 0),(0,n.default)(this,"oldState",void 0),(0,n.default)(this,"currentState",void 0),(0,n.default)(this,"relations",new E.RelationsContainer(this.client,this)),(0,n.default)(this,"threads",new Map),(0,n.default)(this,"lastThread",void 0),(0,n.default)(this,"visibilityEvents",new Map),(0,n.default)(this,"threadTimelineSetsPromise",null),(0,n.default)(this,"threadsReady",!1),(0,n.default)(this,"updateThreadRootEvents",((e,t,r)=>{var i,n;e.length&&(this.updateThreadRootEvent(null===(i=this.threadsTimelineSets)||void 0===i?void 0:i[0],e,t,r),e.hasCurrentUserParticipated&&this.updateThreadRootEvent(null===(n=this.threadsTimelineSets)||void 0===n?void 0:n[1],e,t,r))})),(0,n.default)(this,"updateThreadRootEvent",((e,t,r,i)=>{e&&t.rootEvent&&(i&&e.removeEvent(t.id),_.Thread.hasServerSideSupport?e.addLiveEvent(t.rootEvent,{duplicateStrategy:s.DuplicateStrategy.Replace,fromCache:!1,roomState:this.currentState}):e.addEventToTimeline(t.rootEvent,e.getLiveTimeline(),{toStartOfTimeline:r}))})),(0,n.default)(this,"applyRedaction",(e=>{if(e.isRedaction()){const t=e.event.redacts,r=t?this.findEventById(t):void 0;if(r){if(r.makeRedacted(e),r.isState()){const e=this.currentState.getStateEvents(r.getType(),r.getStateKey());(null==e?void 0:e.getId())===r.getId()&&this.currentState.setStateEvents([r])}this.emit(A.Redaction,e,this),this.visibilityEvents.delete(t),r.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e)}}})),this.setMaxListeners(100),this.reEmitter=new m.TypedReEmitter(this),i.pendingEventOrdering=i.pendingEventOrdering||v.PendingEventOrdering.Chronological,this.name=e,this.normalizedName=e,this.timelineSets=[new s.EventTimelineSet(this,i)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[A.Timeline,A.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===v.PendingEventOrdering.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then((e=>{const r=this.client.getEventMapper({toDevice:!1,decrypt:!1});e.forEach((async e=>{const i=r(e);await t.decryptEventIfNeeded(i),i.setStatus(h.EventStatus.NOT_SENT),this.addPendingEvent(i,i.getTxnId())}))}))),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}async createThreadsTimelineSets(){var e;if(this.threadTimelineSetsPromise)return this.threadTimelineSetsPromise;if(null!==(e=this.client)&&void 0!==e&&e.supportsThreads())try{this.threadTimelineSetsPromise=Promise.all([this.createThreadTimelineSet(),this.createThreadTimelineSet(_.ThreadFilterType.My)]);const e=await this.threadTimelineSetsPromise;return this.threadsTimelineSets.push(...e),e}catch(e){return this.threadTimelineSetsPromise=null,null}return null}async decryptCriticalEvents(){if(!this.client.isCryptoEnabled())return;const e=this.getEventReadUpTo(this.client.getUserId(),!0),t=this.getLiveTimeline().getEvents(),r=t.findIndex((t=>t.event.event_id===e)),i=t.slice(r).reverse().map((e=>this.client.decryptEventIfNeeded(e,{isRetry:!0})));await Promise.allSettled(i)}async decryptAllEvents(){if(!this.client.isCryptoEnabled())return;const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map((e=>this.client.decryptEventIfNeeded(e,{isRetry:!0})));await Promise.allSettled(e)}getCreator(){var e;const t=this.currentState.getStateEvents(g.EventType.RoomCreate,"");return null!==(e=null==t?void 0:t.getContent().creator)&&void 0!==e?e:null}getVersion(){var e;const t=this.currentState.getStateEvents(g.EventType.RoomCreate,"");return t?null!==(e=t.getContent().room_version)&&void 0!==e?e:"1":(this.getVersionWarning||(p.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}shouldUpgradeToVersion(){return R.includes(this.getVersion())?null:"9"}async getRecommendedVersion(){let e=(await this.client.getCapabilities())["m.room_versions"];if(!e){e={default:"9",available:{}};for(const t of R)e.available[t]=v.RoomVersionStability.Stable}let t=this.checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){p.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");if(e=(await this.client.getCapabilities(!0))["m.room_versions"],!e)return p.logger.warn("No room version capability - assuming upgrade required."),t;t=this.checkVersionAgainstCapability(e)}return t}checkVersionAgainstCapability(e){const t=this.getVersion();p.logger.log(`[${this.roomId}] Current version: ${t}`),p.logger.log(`[${this.roomId}] Version capability: `,e);const r={version:t,needsUpgrade:!1,urgent:!1};if(t===e.default)return r;return Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?p.logger.warn(`URGENT upgrade required on ${this.roomId}`):p.logger.warn(`Non-urgent upgrade required on ${this.roomId}`)),r}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(g.EventType.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const t=l.removeElement(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}hasPendingEvent(e){var t,r;return null!==(t=null===(r=this.pendingEventList)||void 0===r?void 0:r.some((t=>t.getId()===e)))&&void 0!==t&&t}getPendingEvent(e){var t,r;return null!==(t=null===(r=this.pendingEventList)||void 0===r?void 0:r.find((t=>t.getId()===e)))&&void 0!==t?t:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}getLastActiveTimestamp(){const e=this.getLiveTimeline().getEvents();if(e.length){return e[e.length-1].getTs()}return Number.MIN_SAFE_INTEGER}getMyMembership(){var e;return null!==(e=this.selfMembership)&&void 0!==e?e:"leave"}getDMInviter(){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter();if("invite"===this.selfMembership){var t;if(2===this.getInvitedAndJoinedMemberCount())return null===(t=this.summaryHeroes)||void 0===t?void 0:t[0]}}guessDMUserId(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const t=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return t?t.userId:this.myUserId}getAvatarFallbackMember(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(e){const e=this.summaryHeroes.map((e=>this.getMember(e))).find((e=>!!e));if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find((e=>e.userId!==this.myUserId));if(e)return e}if(e){const e=this.summaryHeroes.map((e=>this.client.getUser(e))).find((e=>!!e));if(e){const t=new d.RoomMember(this.roomId,e.userId);return t.user=e,t}}}updateMyMembership(e){const t=this.selfMembership;this.selfMembership=e,t!==e&&("leave"===e&&this.cleanupAfterLeaving(),this.emit(A.MyMembership,this,e,t))}async loadMembersFromServer(){const e=this.client.store.getSyncToken();return(await this.client.members(this.roomId,void 0,"leave",null!=e?e:void 0)).chunk}async loadMembers(){let e=!1,t=await this.client.store.getOutOfBandMembers(this.roomId);(null===t||this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId))&&(e=!0,t=await this.loadMembersFromServer(),p.logger.log(`LL: got ${t.length} members from server for room ${this.roomId}`));return{memberEvents:t.map(this.client.getEventMapper()),fromServer:e}}membersLoaded(){return!this.opts.lazyLoadMembers||this.currentState.outOfBandMembersReady()}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this.loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),e.fromServer))).catch((e=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){const e=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>{var t;return null===(t=e.events.member)||void 0===t?void 0:t.event}));p.logger.log(`LL: telling store to write ${e.length} members for room ${this.roomId}`);return this.client.store.setOutOfBandMembers(this.roomId,e).catch((e=>{p.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{p.logger.error(e)})),this.membersPromise=e,this.membersPromise}async clearLoadedMembersIfNeeded(){this.opts.lazyLoadMembers&&this.membersPromise&&(await this.loadMembersIfNeeded(),await this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=void 0)}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch((e=>{p.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),p.logger.log(e)}))}async refreshLiveTimeline(){const e=this.getLiveTimeline(),t=e.getPaginationToken(a.EventTimeline.FORWARDS),r=e.getPaginationToken(a.EventTimeline.BACKWARDS),i=e.getEvents(),n=i[i.length-1];p.logger.log(`[refreshLiveTimeline for ${this.roomId}] at mostRecentEventInTimeline=${n&&n.getId()} liveTimelineBefore=${e.toString()} forwardPaginationToken=${t} backwardPaginationToken=${r}`);const o=this.getUnfilteredTimelineSet();let s;n?(this.resetLiveTimeline(null,null),this.emit(A.TimelineRefresh,this,o),s=await this.client.getEventTimeline(o,n.getId())):s=await this.client.getLatestTimeline(o);const c=o.getLiveTimeline();!c||null===c.getPaginationToken(a.Direction.Forward)&&null===c.getPaginationToken(a.Direction.Backward)&&0===c.getEvents().length?(p.logger.log(`[refreshLiveTimeline for ${this.roomId}] using our new live timeline`),s.setPaginationToken(t,a.EventTimeline.FORWARDS),o.setLiveTimeline(s),this.fixUpLegacyTimelineFields()):p.logger.log(`[refreshLiveTimeline for ${this.roomId}] \`/sync\` or some other request beat us to creating a new live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history.`),this.setTimelineNeedsRefresh(!1),this.emit(A.TimelineRefresh,this,o)}resetLiveTimeline(e,t){for(const r of this.timelineSets)r.resetLiveTimeline(null!=e?e:void 0,null!=t?t:void 0);for(const r of this.threads.values())r.resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){const e=this.oldState,t=this.currentState;this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(a.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(a.EventTimeline.FORWARDS),e!==this.oldState&&this.emit(A.OldStateUpdated,this,e,this.oldState),t!==this.currentState&&(this.emit(A.CurrentStateUpdated,this,t,this.currentState),this.reEmitter.stopReEmitting(t,[b.RoomStateEvent.Events,b.RoomStateEvent.Members,b.RoomStateEvent.NewMember,b.RoomStateEvent.Update,b.RoomStateEvent.Marker,w.BeaconEvent.New,w.BeaconEvent.Update,w.BeaconEvent.Destroy,w.BeaconEvent.LivenessChange]),this.reEmitter.reEmit(this.currentState,[b.RoomStateEvent.Events,b.RoomStateEvent.Members,b.RoomStateEvent.NewMember,b.RoomStateEvent.Update,b.RoomStateEvent.Marker,w.BeaconEvent.New,w.BeaconEvent.Update,w.BeaconEvent.Destroy,w.BeaconEvent.LivenessChange]))}async hasUnverifiedDevices(){if(!this.client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e){if(this.client.getStoredDevicesForUser(t.userId).some((e=>e.isUnverified())))return!0}return!1}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){const t=this.findEventById(e),r=this.findThreadForEvent(t);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){let t=this.getUnfilteredTimelineSet().findEventById(e);if(!t){const r=this.getThreads();for(let i=0;i<r.length;i++){if(t=r[i].findEventById(e),t)return t}}return t}getUnreadNotificationCount(e=x.Total){let t=this.getRoomUnreadNotificationCount(e);for(const i of this.threadNotifications.values()){var r;t+=null!==(r=i[e])&&void 0!==r?r:0}return t}getUnreadCountForEventContext(e=x.Total,t){var r;return null!==(r=!!t.threadRootId&&!t.isThreadRoot?this.getThreadUnreadNotificationCount(t.threadRootId,e):this.getRoomUnreadNotificationCount(e))&&void 0!==r?r:0}getRoomUnreadNotificationCount(e=x.Total){var t;return null!==(t=this.notificationCounts[e])&&void 0!==t?t:0}getThreadUnreadNotificationCount(e,t=x.Total){var r,i;return null!==(r=null===(i=this.threadNotifications.get(e))||void 0===i?void 0:i[t])&&void 0!==r?r:0}hasThreadUnreadNotification(){for(const r of this.threadNotifications.values()){var e,t;if((null!==(e=r.highlight)&&void 0!==e?e:0)>0||(null!==(t=r.total)&&void 0!==t?t:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,t,r){var i,n;const o=k({highlight:null===(i=this.threadNotifications.get(e))||void 0===i?void 0:i.highlight,total:null===(n=this.threadNotifications.get(e))||void 0===n?void 0:n.total},{[t]:r});this.threadNotifications.set(e,o),this.emit(A.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){let e=null;for(const i of this.threadNotifications.values()){var t,r;if((null!==(t=i.highlight)&&void 0!==t?t:0)>0)return x.Highlight;(null!==(r=i.total)&&void 0!==r?r:0)>0&&!e&&(e=x.Total)}return e}resetThreadUnreadNotificationCount(e){if(e)for(const[t]of this.threadNotifications)e.includes(t)||this.threadNotifications.delete(t);else this.threadNotifications.clear();this.emit(A.UnreadNotifications)}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t,this.emit(A.UnreadNotifications,this.notificationCounts)}setSummary(e){const t=e["m.heroes"],r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(t)&&(this.summaryHeroes=t.filter((e=>e!==this.myUserId)))}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return void 0===this.blacklistUnverifiedDevices?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,t,r,i,n=!0){const o=this.currentState.getStateEvents(g.EventType.RoomAvatar,"");if(!o&&!n)return null;const s=o?o.getContent().url:null;return s?(0,c.getHttpUriForMxc)(e,s,t,r,i):null}getMxcAvatarUrl(){var e,t;return(null===(e=this.currentState.getStateEvents(g.EventType.RoomAvatar,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.url)||null}getCanonicalAlias(){const e=this.currentState.getStateEvents(g.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){const e=this.currentState.getStateEvents(g.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,r,i){r.getTimelineSet().addEventsToTimeline(e,t,r,i)}getThread(e){var t;return null!==(t=this.threads.get(e))&&void 0!==t?t:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership("join")}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}async getEncryptionTargetMembers(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e}shouldEncryptForInvitedMembers(){var e;const t=this.currentState.getStateEvents(g.EventType.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){const r=this.getMember(e);return!!r&&r.membership===t}getOrCreateFilteredTimelineSet(e,{prepopulateTimeline:t=!0,useSyncEvents:r=!0,pendingEvents:i=!0}={}){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];const n=Object.assign({filter:e,pendingEvents:i},this.opts),o=new s.EventTimelineSet(this,n);this.reEmitter.reEmit(o,[A.Timeline,A.TimelineReset]),r&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));const c=this.getLiveTimeline();if(t){c.getEvents().forEach((function(e){o.addLiveEvent(e)}));let e=c;for(;e.getNeighbouringTimeline(a.EventTimeline.BACKWARDS);)e=e.getNeighbouringTimeline(a.EventTimeline.BACKWARDS);o.getLiveTimeline().setPaginationToken(e.getPaginationToken(a.EventTimeline.BACKWARDS),a.EventTimeline.BACKWARDS)}else if(r){const e=c.getPaginationToken(a.Direction.Forward);o.getLiveTimeline().setPaginationToken(e,a.Direction.Backward)}return o}async getThreadListFilter(e=_.ThreadFilterType.All){const t=this.client.getUserId(),r=new y.Filter(t),i={room:{timeline:{[_.FILTER_RELATED_BY_REL_TYPES.name]:[_.THREAD_RELATION_TYPE.name]}}};e===_.ThreadFilterType.My&&(i.room.timeline[_.FILTER_RELATED_BY_SENDERS.name]=[t]),r.setDefinition(i);const n=await this.client.getOrCreateFilter(`THREAD_PANEL_${this.roomId}_${e}`,r);return r.filterId=n,r}async createThreadTimelineSet(e){let t;if(_.Thread.hasServerSideListSupport)t=new s.EventTimelineSet(this,k(k({},this.opts),{},{pendingEvents:!1}),void 0,void 0,null!=e?e:_.ThreadFilterType.All),this.reEmitter.reEmit(t,[A.Timeline,A.TimelineReset]);else if(_.Thread.hasServerSideSupport){const r=await this.getThreadListFilter(e);t=this.getOrCreateFilteredTimelineSet(r,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else t=new s.EventTimelineSet(this,{pendingEvents:!1}),Array.from(this.threads).forEach((([,r])=>{if(0===r.length)return;const i=r.timeline.some((e=>e.getSender()===this.client.getUserId()));(e!==_.ThreadFilterType.My||i)&&t.getLiveTimeline().addEvent(r.rootEvent,{toStartOfTimeline:!1})}));return t}processThreadRoots(e,t){for(const r of e)a.EventTimeline.setEventMetadata(r,this.currentState,t),this.getThread(r.getId())||this.createThread(r.getId(),r,[],t)}async fetchRoomThreads(){if(!this.threadsReady&&this.client.supportsThreads()){if(_.Thread.hasServerSideListSupport)await Promise.all([this.fetchRoomThreadList(_.ThreadFilterType.All),this.fetchRoomThreadList(_.ThreadFilterType.My)]);else{const r=await this.getThreadListFilter(),{chunk:i}=await this.client.createMessagesRequest(this.roomId,"",Number.MAX_SAFE_INTEGER,a.Direction.Backward,r);if(!i.length)return;const n=i.map(this.client.getEventMapper()).sort(((e,t)=>{const r=e.getServerAggregatedRelation(_.THREAD_RELATION_TYPE.name),i=t.getServerAggregatedRelation(_.THREAD_RELATION_TYPE.name);return r.latest_event.origin_server_ts-i.latest_event.origin_server_ts}));let o;const c=this.getLiveTimeline().getState(a.EventTimeline.FORWARDS);for(const r of n){var e;const i={duplicateStrategy:s.DuplicateStrategy.Ignore,fromCache:!1,roomState:c};null===(e=this.threadsTimelineSets[0])||void 0===e||e.addLiveEvent(r,i);const n=r.getServerAggregatedRelation(_.THREAD_RELATION_TYPE.name);var t;if(null!=n&&n.current_user_participated)null===(t=this.threadsTimelineSets[1])||void 0===t||t.addLiveEvent(r,i),o=r}this.processThreadRoots(n,!0),this.client.decryptEventIfNeeded(n[n.length-1]),o&&this.client.decryptEventIfNeeded(o)}this.on(_.ThreadEvent.NewReply,this.onThreadNewReply),this.on(_.ThreadEvent.Delete,this.onThreadDelete),this.threadsReady=!0}}async processPollEvents(e){const t=e=>{if(o.M_POLL_START.matches(e.getType()))try{const t=new C.Poll(e,this.client,this);this.polls.set(e.getId(),t),this.emit(C.PollEvent.New,t)}catch{}},r=e=>{const t=e.relationEventId;if(t&&this.polls.has(t)){const r=this.polls.get(t);null==r||r.onNewRelation(e)}},i=e=>{t(e),r(e)};for(const t of e)try{await this.client.decryptEventIfNeeded(t),i(t)}catch{}}async fetchRoomThreadList(e){const t=e===_.ThreadFilterType.My?this.threadsTimelineSets[1]:this.threadsTimelineSets[0],{chunk:r,end:i}=await this.client.createThreadListMessagesRequest(this.roomId,null,void 0,a.Direction.Backward,t.threadListType,t.getFilter());if(t.getLiveTimeline().setPaginationToken(null!=i?i:null,a.Direction.Backward),!r.length)return;const n=r.map(this.client.getEventMapper());this.processThreadRoots(n,!0);const o=this.getLiveTimeline().getState(a.EventTimeline.FORWARDS);for(const e of n)t.addLiveEvent(e,{duplicateStrategy:s.DuplicateStrategy.Replace,fromCache:!1,roomState:o})}onThreadNewReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var t;this.threads.delete(e.id);const r=this.getTimelineForEvent(e.id),i=null==r||null===(t=r.getEvents())||void 0===t?void 0:t.find((t=>t.getId()===e.id));i?e.clearEventMetadata(i):p.logger.debug("onThreadDelete: Could not find root event in room timeline");for(const t of this.threadsTimelineSets)t.removeEvent(e.id)}removeFilteredTimelineSet(e){const t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];const r=this.timelineSets.indexOf(t);r>-1&&this.timelineSets.splice(r,1)}eventShouldLiveIn(e,t,r){var i,n;if(null===(i=this.client)||void 0===i||!i.supportsThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||null!=r&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};if(e.isRelation(_.THREAD_RELATION_TYPE.name))return{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:e.threadRootId};const o=e.getAssociatedId(),s=null!==(n=this.findEventById(o))&&void 0!==n?n:null==t?void 0:t.find((e=>e.getId()===o));return s&&(e.isRelation()||e.isRedaction())?this.eventShouldLiveIn(s,t,r):null!=r&&r.has(e.relationEventId)?{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.relationEventId}:{shouldLiveInRoom:!0,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;const{threadId:t}=this.eventShouldLiveIn(e);return t?this.getThread(t):null}addThreadedEvents(e,t,r=!1){let i=this.getThread(e);if(!i){var n;const o=null!==(n=this.findEventById(e))&&void 0!==n?n:t.find((t=>t.getId()===e));i=this.createThread(e,o,t,r)}i.addEvents(t,r)}processThreadedEvents(e,t){e.forEach(this.applyRedaction);const r={};for(const t of e){var i;const{threadId:e,shouldLiveInThread:n}=this.eventShouldLiveIn(t);n&&!r[e]&&(r[e]=[]),null===(i=r[e])||void 0===i||i.push(t)}Object.entries(r).map((([e,r])=>this.addThreadedEvents(e,r,t)))}createThread(e,t,r=[],i){var n,o,s;if(this.threads.has(e))return this.threads.get(e);if(t){const e=this.relations.getAllChildEventsForEvent(t.getId());null!=e&&e.length&&(r=r.concat(e.filter((e=>!e.isRelation(g.RelationType.Replace)))))}const a=new _.Thread(e,t,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:null!==(n=this.cachedThreadReadReceipts.get(e))&&void 0!==n?n:[]});this.cachedThreadReadReceipts.delete(e),a.addEvents(r,!1),this.threads.set(a.id,a),this.reEmitter.reEmit(a,[_.ThreadEvent.Delete,_.ThreadEvent.Update,_.ThreadEvent.NewReply,A.Timeline,A.TimelineReset]);const c=(null===(o=this.lastThread)||void 0===o?void 0:o.rootEvent)&&(null==t?void 0:t.localTimestamp)&&(null===(s=this.lastThread.rootEvent)||void 0===s?void 0:s.localTimestamp)<(null==t?void 0:t.localTimestamp);return this.lastThread&&!c||(this.lastThread=a),this.threadsReady&&this.updateThreadRootEvents(a,i,!1),this.emit(_.ThreadEvent.New,a,i),a}processLiveEvent(e){this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e);if(!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId)for(const t in this.txnToEvent){if(this.txnToEvent[t].getId()===e.getId()){p.logger.debug("processLiveEvent: found sent event without txn ID: ",t,e.getId());const r=e.getUnsigned();r.transaction_id=t,e.setUnsigned(r);break}}}addLiveEvent(e,t){const{duplicateStrategy:r,timelineWasEmpty:i,fromCache:n}=t;for(const t of this.timelineSets)t.addLiveEvent(e,{duplicateStrategy:r,fromCache:n,timelineWasEmpty:i});e.sender&&e.getType()!==g.EventType.RoomRedaction&&this.addReceipt((0,M.synthesizeReceipt)(e.sender.userId,e,S.ReceiptType.Read),!0)}addPendingEvent(e,t){if(e.status!==h.EventStatus.SENDING&&e.status!==h.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(a.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(a.EventTimeline.FORWARDS),!1),this.txnToEvent[t]=e,this.pendingEventList){if(this.pendingEventList.some((e=>e.status===h.EventStatus.NOT_SENT))&&(p.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(h.EventStatus.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let r=this.pendingEventList.find((e=>e.getId()===t));!r&&t&&(r=this.findEventById(t)),r&&(r.markLocallyRedacted(e),this.emit(A.Redaction,e,this))}}else for(const t of this.timelineSets)t.getFilter()?t.getFilter().filterRoomTimeline([e]).length&&t.addEventToTimeline(e,t.getLiveTimeline(),{toStartOfTimeline:!1}):t.addEventToTimeline(e,t.getLiveTimeline(),{toStartOfTimeline:!1});this.emit(A.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){const e=this.pendingEventList.map((e=>k(k({},e.event),{},{txn_id:e.getTxnId()}))).filter((e=>{const t=e.type===g.EventType.RoomMessageEncrypted,r=this.client.isRoomEncrypted(this.roomId);return t||!r}));this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent[e]}handleRemoteEcho(e,t){const r=t.getId(),i=e.getId(),n=t.status;p.logger.debug(`Got remote echo for event ${r} -> ${i} old status ${n}`),delete this.txnToEvent[e.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(r),t.handleRemoteEcho(e.event);const{shouldLiveInRoom:o,threadId:s}=this.eventShouldLiveIn(e),a=s?this.getThread(s):null;if(null==a||a.timelineSet.handleRemoteEcho(t,r,i),o)for(const e of this.timelineSets)e.handleRemoteEcho(t,r,i);this.emit(A.LocalEchoUpdated,t,this,r,n)}updatePendingEvent(e,t,r){if(p.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${r}`),t==h.EventStatus.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==h.EventStatus.SENT){if(this.getTimelineForEvent(r)){const t=this.findEventById(r);if(!(null==t?void 0:t.getUnsigned().transaction_id)&&t){const r=t.getUnsigned();r.transaction_id=e.getTxnId(),t.setUnsigned(r),this.removeEvent(t.getId()),this.handleRemoteEcho(t,e)}return}}const i=e.status,n=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const o=L[i];if(null==o||!o.includes(t))throw new Error(`Invalid EventStatus transition ${i}->${t}`);if(e.setStatus(t),t==h.EventStatus.SENT){e.replaceLocalEventId(r);const{shouldLiveInRoom:t,threadId:i}=this.eventShouldLiveIn(e),o=i?this.getThread(i):void 0;if(null==o||o.timelineSet.replaceEventId(n,r),t)for(const e of this.timelineSets)e.replaceEventId(n,r)}else if(t==h.EventStatus.CANCELLED){if(this.pendingEventList){const e=this.getPendingEvent(n);this.removePendingEvent(n),null!=e&&e.isRedaction()&&this.revertRedactionLocalEcho(e)}this.removeEvent(n)}this.savePendingEvents(),this.emit(A.LocalEchoUpdated,e,this,n,i)}revertRedactionLocalEcho(e){const t=e.event.redacts;if(!t)return;const r=this.getUnfilteredTimelineSet().findEventById(t);r&&(r.unmarkLocallyRedacted(),this.emit(A.RedactionCancelled,e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}addLiveEvents(e,t,r=!1){let i=t,n=!1;if("object"==typeof t?({duplicateStrategy:i,fromCache:r=!1,timelineWasEmpty:n}=t):void 0!==t&&p.logger.warn("Overload deprecated: `Room.addLiveEvents(events, duplicateStrategy?, fromCache?)` is deprecated in favor of the overload with `Room.addLiveEvents(events, IAddLiveEventOptions)`"),i&&-1===["replace","ignore"].indexOf(i))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(let e=0;e<this.timelineSets.length;e++){const t=this.timelineSets[e].getLiveTimeline();if(t.getPaginationToken(a.EventTimeline.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+t.getPaginationToken(a.EventTimeline.FORWARDS)+")");if(t.getNeighbouringTimeline(a.EventTimeline.FORWARDS))throw new Error(`live timeline ${e} is no longer live - it has a neighbouring timeline`)}const o=this.findThreadRoots(e),s={},c={duplicateStrategy:i,fromCache:r,timelineWasEmpty:n};for(const t of e){var l;if(this.processLiveEvent(t),t.getUnsigned().transaction_id){const e=this.txnToEvent[t.getUnsigned().transaction_id];if(e){this.handleRemoteEcho(t,e);continue}}const{shouldLiveInRoom:r,shouldLiveInThread:i,threadId:n}=this.eventShouldLiveIn(t,e,o);i&&!s[null!=n?n:""]&&(s[null!=n?n:""]=[]),null===(l=s[null!=n?n:""])||void 0===l||l.push(t),r&&this.addLiveEvent(t,c)}Object.entries(s).forEach((([e,t])=>{this.addThreadedEvents(e,t,!1)}))}partitionThreadedEvents(e){if(this.client.supportsThreads()){const t=this.findThreadRoots(e);return e.reduce(((r,i)=>{const{shouldLiveInRoom:n,shouldLiveInThread:o,threadId:s}=this.eventShouldLiveIn(i,e,t);return n&&r[0].push(i),o&&(i.setThreadId(null!=s?s:""),r[1].push(i)),r}),[[],[]])}return[e,[]]}findThreadRoots(e){const t=new Set;for(const i of e)if(i.isRelation(_.THREAD_RELATION_TYPE.name)){var r;t.add(null!==(r=i.relationEventId)&&void 0!==r?r:"")}return t}addReceipt(e,t=!1){const r=e.getContent();Object.keys(r).forEach((e=>{Object.keys(r[e]).forEach((i=>{Object.keys(r[e][i]).forEach((n=>{var o,s,a;const c=r[e][i][n],l=!c.thread_id||c.thread_id===S.MAIN_ROOM_TIMELINE,u=l?this:this.threads.get(null!==(o=c.thread_id)&&void 0!==o?o:"");var h;u?u.addReceiptToStructure(e,i,n,c,t):this.cachedThreadReadReceipts.set(c.thread_id,[...null!==(h=this.cachedThreadReadReceipts.get(c.thread_id))&&void 0!==h?h:[],{eventId:e,receiptType:i,userId:n,receipt:c,synthetic:t}]);n===this.client.getUserId()&&!l&&c.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=c.ts),!c.thread_id&&c.ts>(null!==(s=null===(a=this.unthreadedReceipts.get(n))||void 0===a?void 0:a.ts)&&void 0!==s?s:0)&&this.unthreadedReceipts.set(n,c)}))}))})),this.emit(A.Receipt,e,this)}addEphemeralEvents(e){for(const t of e)t.getType()===g.EventType.Typing?this.currentState.setTypingEvent(t):t.getType()===g.EventType.Receipt&&this.addReceipt(t)}removeEvents(e){for(const t of e)this.removeEvent(t)}removeEvent(e){let t=!1;for(const r of this.timelineSets){const i=r.removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),t=!0)}return t}recalculate(){const e=this.currentState.getStateEvents(g.EventType.RoomMember,this.myUserId);if(e){const t=e.getContent().membership;if(this.updateMyMembership(t),"invite"===t){(e.getUnsigned().invite_room_state||[]).forEach((e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new u.MatrixEvent({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,user_id:this.myUserId})])}))}}const t=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,l.normalize)(this.name),this.summary=new f.RoomSummary(this.roomId,{title:this.name}),t!==this.name&&this.emit(A.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(A.Tags,e,this)}addAccountData(e){for(const t of e){"m.tag"===t.getType()&&this.addTags(t);const e=this.accountData[t.getType()];this.accountData[t.getType()]=t,this.emit(A.AccountData,t,this,e)}}getAccountData(e){return this.accountData[e]}maySendMessage(){return"join"===this.getMyMembership()&&(this.client.isRoomEncrypted(this.roomId)?this.currentState.maySendEvent(g.EventType.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(g.EventType.RoomMessage,this.myUserId))}canInvite(e){let t="join"===this.getMyMembership();const r=this.currentState.getStateEvents(g.EventType.RoomPowerLevels,""),i=r&&r.getContent(),n=this.getMember(e);return i&&n&&i.invite>n.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){const e=this.currentState.getStateEvents(g.EventType.RoomCreate,"");if(e)return e.getContent()[g.RoomCreateTypeField];this.getTypeWarning||(p.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===g.RoomType.Space}isCallRoom(){return this.getType()===g.RoomType.UnstableCall}isElementVideoRoom(){return this.getType()===g.RoomType.ElementVideo}findPredecessor(e=!1){const t=this.getLiveTimeline().getState(a.EventTimeline.FORWARDS);return t?t.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){const t=this.client.roomNameGenerator(this.roomId,e);if(null!==t)return t}switch(e.type){case U.Actual:return e.name;case U.Generated:return"Inviting"===e.subtype?`Inviting ${j(e.names,e.count)}`:j(e.names,e.count);case U.EmptyRoom:return e.oldName?`Empty room (was ${e.oldName})`:"Empty room"}}calculateRoomName(e,t=!1){if(!t){const e=this.currentState.getStateEvents(g.EventType.RoomName,"");if(null!=e&&e.getContent().name)return this.roomNameGenerator({type:U.Actual,name:e.getContent().name})}const r=this.getCanonicalAlias();if(r)return this.roomNameGenerator({type:U.Actual,name:r});let i=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,n=[];const o=this.currentState.getStateEvents(g.UNSTABLE_ELEMENT_FUNCTIONAL_USERS.name,"");Array.isArray(null==o?void 0:o.getContent().service_members)&&(n=o.getContent().service_members);let s=[];if(this.summaryHeroes)this.summaryHeroes.forEach((e=>{if(n.includes(e))return void i--;const t=this.getMember(e);s.push(t?t.name:e)}));else{let t=this.currentState.getMembers().filter((t=>t.userId!==e&&("invite"===t.membership||"join"===t.membership)));t=t.filter((({userId:e})=>!n.includes(e)||(i--,!1))),t.sort(((e,t)=>l.compare(e.userId,t.userId))),t=t.slice(0,5),s=t.map((e=>e.name))}if(i)return this.roomNameGenerator({type:U.Generated,names:s,count:i});if("join"==this.getMyMembership()){const e=this.currentState.getStateEvents(g.EventType.RoomThirdPartyInvite);if(null!=e&&e.length){const t=e.map((e=>e.getContent().display_name));return this.roomNameGenerator({type:U.Generated,subtype:"Inviting",names:t,count:t.length+1})}}let a,c=s;return c.length||(c=this.currentState.getMembers().filter((t=>t.userId!==e&&"invite"!==t.membership&&"join"!==t.membership)).map((e=>e.name))),c.length&&(a=this.roomNameGenerator({type:U.Generated,names:c,count:c.length+1})),this.roomNameGenerator({type:U.EmptyRoom,oldName:a})}applyNewVisibilityEvent(e){const t=e.asVisibilityChange();if(!t)return;const r=e.getSender();if(!r)return;if(!(g.EVENT_VISIBILITY_CHANGE_TYPE.name&&this.currentState.maySendStateEvent(g.EVENT_VISIBILITY_CHANGE_TYPE.name,r)||g.EVENT_VISIBILITY_CHANGE_TYPE.altName&&this.currentState.maySendStateEvent(g.EVENT_VISIBILITY_CHANGE_TYPE.altName,r)))return;const i=this.visibilityEvents.get(t.eventId);if(i){let t=i.length-1;const r=Math.max(0,i.length-30);for(;t>=r;--t){if(i[t].getTs()<e.getTs())break}-1===t?i.unshift(e):i.splice(t+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);const n=this.findEventById(t.eventId);n&&n.applyVisibilityEvent(t)}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");const t=e.getRelation(),r=null==t?void 0:t.event_id,i=this.visibilityEvents.get(r);if(!i)return;const n=i.findIndex((t=>t.getId()===e.getId()));if(-1!==n&&(i.splice(n,1),n===i.length)){const e=this.findEventById(r);if(!e)return;if(0===n)this.visibilityEvents.delete(r),e.applyVisibilityEvent();else{const t=i[i.length-1].asVisibilityChange();if(!t)throw new Error("at this stage, visibility changes should be well-formed");e.applyVisibilityEvent(t)}}}applyPendingVisibilityEvents(e){const t=this.visibilityEvents.get(e.getId());if(!t||0==t.length)return;const r=t[t.length-1],i=r.asVisibilityChange();i&&(i.visible,r.getTs()<e.getTs()||e.applyVisibilityEvent(i))}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}}e.exports.Room=D;const L={[h.EventStatus.ENCRYPTING]:[h.EventStatus.SENDING,h.EventStatus.NOT_SENT,h.EventStatus.CANCELLED],[h.EventStatus.SENDING]:[h.EventStatus.ENCRYPTING,h.EventStatus.QUEUED,h.EventStatus.NOT_SENT,h.EventStatus.SENT],[h.EventStatus.QUEUED]:[h.EventStatus.SENDING,h.EventStatus.CANCELLED],[h.EventStatus.SENT]:[],[h.EventStatus.NOT_SENT]:[h.EventStatus.SENDING,h.EventStatus.QUEUED,h.EventStatus.CANCELLED],[h.EventStatus.CANCELLED]:[]};let U;var N;function j(e,t){const r=t-1;if(e.length){if(1===e.length&&r<=1)return e[0];if(2===e.length&&r<=2)return`${e[0]} and ${e[1]}`;return r>1?`${e[0]} and ${r} others`:`${e[0]} and 1 other`}return"Empty room"}e.exports.RoomNameType=U,(N=U||(e.exports.RoomNameType=U={}))[N.EmptyRoom=0]="EmptyRoom",N[N.Generated=1]="Generated",N[N.Actual=2]="Actual"})),i.register("d1gZy",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventTimelineSet=e.exports.DuplicateStrategy=void 0;var n=r(i("3EUCw")),o=i("jxKcy"),s=i("gEWrD"),a=i("846Vo"),c=i("75Qdj"),l=i("95VbJ");let u,h;var d;u=s.logger.log.bind(s.logger),e.exports.DuplicateStrategy=h,(d=h||(e.exports.DuplicateStrategy=h={})).Ignore="ignore",d.Replace="replace";class f extends c.TypedEventEmitter{constructor(e,t={},r,i,s=null){var a,c,u;super(),this.room=e,this.thread=i,this.threadListType=s,(0,n.default)(this,"relations",void 0),(0,n.default)(this,"timelineSupport",void 0),(0,n.default)(this,"displayPendingEvents",void 0),(0,n.default)(this,"liveTimeline",void 0),(0,n.default)(this,"timelines",void 0),(0,n.default)(this,"_eventIdToTimeline",new Map),(0,n.default)(this,"filter",void 0),this.timelineSupport=Boolean(t.timelineSupport),this.liveTimeline=new o.EventTimeline(this),this.displayPendingEvents=!1!==t.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=t.filter,this.relations=null!==(a=null===(c=this.room)||void 0===c?void 0:c.relations)&&void 0!==a?a:new l.RelationsContainer(null!==(u=null==e?void 0:e.client)&&void 0!==u?u:r)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,t){const r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,r))}resetLiveTimeline(e,t){const r=!this.timelineSupport||!t,i=this.liveTimeline,n=r?i.forkLive(o.EventTimeline.FORWARDS):i.fork(o.EventTimeline.FORWARDS);r?(this.timelines=[n],this._eventIdToTimeline=new Map):this.timelines.push(n),t&&i.setPaginationToken(t,o.EventTimeline.FORWARDS),n.setPaginationToken(null!=e?e:null,o.EventTimeline.BACKWARDS),this.liveTimeline=n,this.emit(a.RoomEvent.TimelineReset,this.room,this,r)}getTimelineForEvent(e){if(null==e)return null;const t=this._eventIdToTimeline.get(e);return void 0===t?null:t}findEventById(e){const t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new o.EventTimeline(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,r,i){if(!r)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&r==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&!(e=this.filter.filterRoomTimeline(e)).length)return;const n=t?o.EventTimeline.BACKWARDS:o.EventTimeline.FORWARDS,a=t?o.EventTimeline.FORWARDS:o.EventTimeline.BACKWARDS;let c=!1,l=!1;for(const i of e){const e=i.getId(),h=this._eventIdToTimeline.get(e);if(!h){this.addEventToTimeline(i,r,{toStartOfTimeline:t}),l=!0,c=!0;continue}if(l=!1,h==r){u("Event "+e+" already in timeline "+r);continue}const d=r.getNeighbouringTimeline(n);if(d){u(h==d?"Event "+e+" in neighbouring timeline - switching to "+h:"Event "+e+" already in a different timeline "+h),r=h;continue}s.logger.info("Already have timeline for "+e+" - joining timeline "+r+" to "+h);const f=h===this.liveTimeline,p=r===this.liveTimeline,m=n===o.EventTimeline.BACKWARDS&&f,g=n===o.EventTimeline.FORWARDS&&p;m||g?(m&&s.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+h+")"),g&&s.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+r+")")):(r.setNeighbouringTimeline(h,n),h.setNeighbouringTimeline(r,a),r=h,c=!0)}if(l||!c){if(n===o.EventTimeline.FORWARDS&&r===this.liveTimeline)return s.logger.warn({lastEventWasNew:l,didUpdate:c}),void s.logger.warn(`Refusing to set forwards pagination token of live timeline ${r} to ${i}`);r.setPaginationToken(null!=i?i:null,n)}}addLiveEvent(e,t,r=!1,i){let n,a=t||h.Ignore;if("object"==typeof t?({duplicateStrategy:a=h.Ignore,fromCache:r=!1,roomState:i,timelineWasEmpty:n}=t):void 0!==t&&s.logger.warn("Overload deprecated: `EventTimelineSet.addLiveEvent(event, duplicateStrategy?, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addLiveEvent(event, IAddLiveEventOptions)`"),this.filter){if(!this.filter.filterRoomTimeline([e]).length)return}const c=this._eventIdToTimeline.get(e.getId());if(c)if(a===h.Replace){u("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=c.getEvents();for(let r=0;r<t.length;r++)if(t[r].getId()===e.getId()){i||(i=c.getState(o.EventTimeline.FORWARDS)),o.EventTimeline.setEventMetadata(e,i,!1),t[r]=e;break}}else u("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:r,roomState:i,timelineWasEmpty:n})}addEventToTimeline(e,t,r,i=!1,n){let o,c=!!r;var l;if("object"==typeof r?({toStartOfTimeline:c,fromCache:i=!1,roomState:n,timelineWasEmpty:o}=r):void 0!==r&&s.logger.warn("Overload deprecated: `EventTimelineSet.addEventToTimeline(event, timeline, toStartOfTimeline, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addEventToTimeline(event, timeline, IAddEventToTimelineOptions)`"),t.getTimelineSet()!==this)throw new Error(`EventTimelineSet.addEventToTimeline: Timeline=${t.toString()} does not belong " +\n                "in timelineSet(threadId=${null===(l=this.thread)||void 0===l?void 0:l.id})`);if(this.room&&!this.canContain(e)){var u;let r=`event=${e.getId()}`;return e.threadRootId&&(r+=`(belongs to thread=${e.threadRootId})`),void s.logger.warn(`EventTimelineSet.addEventToTimeline: Ignoring ${r} that does not belong in timeline=${t.toString()} timelineSet(threadId=${null===(u=this.thread)||void 0===u?void 0:u.id})`)}const h=e.getId();t.addEvent(e,{toStartOfTimeline:c,roomState:n,timelineWasEmpty:o}),this._eventIdToTimeline.set(h,t),this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this);const d={timeline:t,liveEvent:!c&&t==this.liveTimeline&&!i};this.emit(a.RoomEvent.Timeline,e,this.room,Boolean(c),!1,d)}handleRemoteEcho(e,t,r){const i=this._eventIdToTimeline.get(t);i?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(r,i)):this.filter&&!this.filter.filterRoomTimeline([e]).length||this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1})}removeEvent(e){const t=this._eventIdToTimeline.get(e);if(!t)return null;const r=t.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);const i={timeline:t};this.emit(a.RoomEvent.Timeline,r,this.room,void 0,!0,i)}return r}compareEventOrdering(e,t){if(e==t)return 0;const r=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(t);if(void 0===r)return null;if(void 0===i)return null;if(r===i){let i,n;const o=r.getEvents();for(let r=0;r<o.length&&(void 0===i||void 0===n);r++){const s=o[r].getId();s==e&&(i=r),s==t&&(n=r)}return i-n}let n=r;for(;n;){if(n===i)return-1;n=n.getNeighbouringTimeline(o.EventTimeline.FORWARDS)}for(n=r;n;){if(n===i)return 1;n=n.getNeighbouringTimeline(o.EventTimeline.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");const{threadId:t,shouldLiveInRoom:r}=this.room.eventShouldLiveIn(e);return this.thread?this.thread.id===t:r}}e.exports.EventTimelineSet=f})),i.register("jxKcy",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventTimeline=e.exports.Direction=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("l2mJP"),a=i("ldT3p");let c;var l;e.exports.Direction=c,(l=c||(e.exports.Direction=c={})).Backward="b",l.Forward="f";class u{static setEventMetadata(e,t,r){var i,n,o,s;null!==(i=e.sender)&&void 0!==i&&null!==(n=i.events)&&void 0!==n&&n.member||(e.sender=t.getSentinelMember(e.getSender())),null!==(o=e.target)&&void 0!==o&&null!==(s=o.events)&&void 0!==s&&s.member||e.getType()!==a.EventType.RoomMember||(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&r&&(e.forwardLooking=!1)}constructor(e){var t,r;this.eventTimelineSet=e,(0,n.default)(this,"roomId",void 0),(0,n.default)(this,"name",void 0),(0,n.default)(this,"events",[]),(0,n.default)(this,"baseIndex",0),(0,n.default)(this,"startState",void 0),(0,n.default)(this,"endState",void 0),(0,n.default)(this,"startToken",null),(0,n.default)(this,"endToken",null),(0,n.default)(this,"prevTimeline",null),(0,n.default)(this,"nextTimeline",null),(0,n.default)(this,"paginationRequests",{[c.Backward]:null,[c.Forward]:null}),this.roomId=null!==(t=null===(r=e.room)||void 0===r?void 0:r.roomId)&&void 0!==t?t:null,this.roomId&&(this.startState=new s.RoomState(this.roomId),this.endState=new s.RoomState(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e,{timelineWasEmpty:t}={}){var r,i;if(this.events.length>0)throw new Error("Cannot initialise state after events are added");null===(r=this.startState)||void 0===r||r.setStateEvents(e,{timelineWasEmpty:t}),null===(i=this.endState)||void 0===i||i.setStateEvents(e,{timelineWasEmpty:t})}forkLive(e){const t=this.getState(e),r=new u(this.eventTimelineSet);return r.startState=null==t?void 0:t.clone(),r.endState=t,this.endState=null==t?void 0:t.clone(),r}fork(e){const t=this.getState(e),r=new u(this.eventTimelineSet);return r.startState=null==t?void 0:t.clone(),r.endState=null==t?void 0:t.clone(),r}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==u.BACKWARDS)return this.startState;if(e==u.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===c.Backward?this.startToken:this.endToken}setPaginationToken(e,t){this.roomId?this.getState(t).paginationToken=e:t===c.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==u.BACKWARDS)return this.prevTimeline;if(e==u.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==u.BACKWARDS)this.prevTimeline=e;else{if(t!=u.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t,r){let i,n=!!t;"object"==typeof t?({toStartOfTimeline:n,roomState:r,timelineWasEmpty:i}=t):void 0!==t&&o.logger.warn("Overload deprecated: `EventTimeline.addEvent(event, toStartOfTimeline, roomState?)` is deprecated in favor of the overload with `EventTimeline.addEvent(event, IAddEventOptions)`"),r||(r=n?this.startState:this.endState);const s=this.getTimelineSet();var c;s.room&&(u.setEventMetadata(e,r,n),e.isState()&&s.room.getUnfilteredTimelineSet()===s&&(null===(c=r)||void 0===c||c.setStateEvents([e],{timelineWasEmpty:i}),e.sender&&(e.getType()!==a.EventType.RoomMember||n)||u.setEventMetadata(e,r,n)));let l;l=n?0:this.events.length,this.events.splice(l,0,e),n&&this.baseIndex++}removeEvent(e){for(let t=this.events.length-1;t>=0;t--){const r=this.events[t];if(r.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,r}return null}toString(){return this.name}}e.exports.EventTimeline=u,(0,n.default)(u,"BACKWARDS",c.Backward),(0,n.default)(u,"FORWARDS",c.Forward)})),i.register("95VbJ",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RelationsContainer=void 0;var n=r(i("3EUCw")),o=i("9sRLa"),s=i("7BSj1");e.exports.RelationsContainer=class{constructor(e,t){this.client=e,this.room=t,(0,n.default)(this,"relations",new Map)}getChildEventsForEvent(e,t,r){var i,n;return null===(i=this.relations.get(e))||void 0===i||null===(n=i.get(t))||void 0===n?void 0:n.get(r)}getAllChildEventsForEvent(e){var t;const r=null!==(t=this.relations.get(e))&&void 0!==t?t:new Map,i=[];for(const e of r.values())for(const t of e.values())i.push(...t.getRelations());return i}aggregateParentEvent(e){const t=this.relations.get(e.getId());if(t)for(const r of t.values())for(const t of r.values())t.setTargetEvent(e)}aggregateChildEvent(e,t){if(e.isRedacted()||e.status===s.EventStatus.CANCELLED)return;const r=e.getRelation();if(!r)return;const i=()=>{e.isDecryptionFailure()?e.once(s.MatrixEventEvent.Decrypted,i):this.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once(s.MatrixEventEvent.Decrypted,i);const{event_id:n,rel_type:a}=r,c=e.getType();let l=this.relations.get(n);l||(l=new Map,this.relations.set(n,l));let u=l.get(a);u||(u=new Map,l.set(a,u));let h=u.get(c);if(!h){var d,f,p;h=new o.Relations(a,c,this.client),u.set(c,h);const e=null!==(d=this.room)&&void 0!==d?d:null==t?void 0:t.room,r=null!==(f=null!==(p=null==t?void 0:t.findEventById(n))&&void 0!==p?p:null==e?void 0:e.findEventById(n))&&void 0!==f?f:null==e?void 0:e.getPendingEvent(n);r&&h.setTargetEvent(r)}h.addEvent(e)}}})),i.register("9sRLa",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RelationsEvent=e.exports.Relations=void 0;var n=r(i("3EUCw")),o=i("7BSj1"),s=i("gEWrD"),a=i("ldT3p"),c=i("75Qdj"),l=i("846Vo");let u;var h;e.exports.RelationsEvent=u,(h=u||(e.exports.RelationsEvent=u={})).Add="Relations.add",h.Remove="Relations.remove",h.Redaction="Relations.redaction";class d extends c.TypedEventEmitter{constructor(e,t,r,i){super(),this.relationType=e,this.eventType=t,this.altEventTypes=i,(0,n.default)(this,"relationEventIds",new Set),(0,n.default)(this,"relations",new Set),(0,n.default)(this,"annotationsByKey",{}),(0,n.default)(this,"annotationsBySender",{}),(0,n.default)(this,"sortedAnnotationsByKey",[]),(0,n.default)(this,"targetEvent",null),(0,n.default)(this,"creationEmitted",!1),(0,n.default)(this,"client",void 0),(0,n.default)(this,"onEventStatus",((e,t)=>{e.isSending()?t===o.EventStatus.CANCELLED&&(e.removeListener(o.MatrixEventEvent.Status,this.onEventStatus),this.removeEvent(e)):e.removeListener(o.MatrixEventEvent.Status,this.onEventStatus)})),(0,n.default)(this,"onBeforeRedaction",(async e=>{if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===a.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===a.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.removeListener(o.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.emit(u.Redaction,e)}})),this.client=r instanceof l.Room?r.client:r}async addEvent(e){if(this.relationEventIds.has(e.getId()))return;const t=e.getRelation();if(!t)return void s.logger.error("Event must have relation info");const r=t.rel_type,i=e.getType();if(this.relationType===r&&((e,t,r=[])=>[t,...r].includes(e))(i,this.eventType,this.altEventTypes)){if(e.isSending()&&e.on(o.MatrixEventEvent.Status,this.onEventStatus),this.relations.add(e),this.relationEventIds.add(e.getId()),this.relationType===a.RelationType.Annotation)this.addAnnotationToAggregation(e);else if(this.relationType===a.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.on(o.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),this.emit(u.Add,e),this.maybeEmitCreated()}else s.logger.error("Event relation info doesn't match this container")}async removeEvent(e){if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===a.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===a.RelationType.Replace&&this.targetEvent&&!this.targetEvent.isState()){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}this.emit(u.Remove,e)}}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var t;const{key:r}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(!r)return;let i=this.annotationsByKey[r];i||(i=this.annotationsByKey[r]=new Set,this.sortedAnnotationsByKey.push([r,i])),i.add(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const r=e[1];return t[1].size-r.size}));const n=e.getSender();let o=this.annotationsBySender[n];o||(o=this.annotationsBySender[n]=new Set),o.add(e)}removeAnnotationFromAggregation(e){var t;const{key:r}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(!r)return;const i=this.annotationsByKey[r];i&&(i.delete(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const r=e[1];return t[1].size-r.size})));const n=e.getSender(),o=this.annotationsBySender[n];o&&o.delete(e)}getSortedAnnotationsByKey(){return this.relationType!==a.RelationType.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==a.RelationType.Annotation?null:this.annotationsBySender}async getLastReplacement(){if(this.relationType!==a.RelationType.Replace)return null;if(!this.targetEvent)return null;const e=this.targetEvent.getServerAggregatedRelation(a.RelationType.Replace),t=null==e?void 0:e.origin_server_ts,r=this.getRelations().reduce(((e,r)=>r.getSender()!==this.targetEvent.getSender()||t&&t>r.getTs()||e&&e.getTs()>r.getTs()?e:r),null);return null!=r&&r.shouldAttemptDecryption()&&this.client.isCryptoEnabled()?await r.attemptDecryption(this.client.crypto):null!=r&&r.isBeingDecrypted()&&await r.getDecryptionPromise(),r}async setTargetEvent(e){if(!this.targetEvent){if(this.targetEvent=e,this.relationType===a.RelationType.Replace&&!this.targetEvent.isState()){const e=await this.getLastReplacement();e&&this.targetEvent.makeReplaced(e)}this.maybeEmitCreated()}}maybeEmitCreated(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit(o.MatrixEventEvent.RelationsCreated,this.relationType,this.eventType))}}e.exports.Relations=d})),i.register("hGOrY",(function(e,t){let r;var i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventStatus=void 0,e.exports.EventStatus=r,(i=r||(e.exports.EventStatus=r={})).NOT_SENT="not_sent",i.ENCRYPTING="encrypting",i.SENDING="sending",i.QUEUED="queued",i.SENT="sent",i.CANCELLED="cancelled"})),i.register("eOWig",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomSummary=void 0;e.exports.RoomSummary=class{constructor(e,t){this.roomId=e}}})),i.register("eu84r",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TypedReEmitter=e.exports.ReEmitter=void 0;var n=r(i("3EUCw"));class o{constructor(e){this.target=e,(0,n.default)(this,"reEmitters",new Map)}reEmit(e,t){let r=this.reEmitters.get(e);r||(r=new Map,this.reEmitters.set(e,r));for(const i of t){const t=(...t)=>{"error"===i&&0===this.target.listenerCount("error")||this.target.emit(i,...t,e)};e.on(i,t),r.set(i,t)}}stopReEmitting(e,t){const r=this.reEmitters.get(e);if(r){for(const i of t)e.off(i,r.get(i)),r.delete(i);0===r.size&&this.reEmitters.delete(e)}}}e.exports.ReEmitter=o;e.exports.TypedReEmitter=class extends o{constructor(e){super(e)}reEmit(e,t){super.reEmit(e,t)}stopReEmitting(e,t){super.stopReEmitting(e,t)}}})),i.register("l2QFk",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Filter=void 0;var n=r(i("3EUCw")),o=i("aYGbo"),s=i("kkulx");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){const i=t.split(".");let n=e;for(let e=0;e<i.length-1;e++)n[i[e]]||(n[i[e]]={}),n=n[i[e]];n[i[i.length-1]]=r}class u{static fromJson(e,t,r){const i=new u(e,t);return i.setDefinition(r),i}constructor(e,t){this.userId=e,this.filterId=t,(0,n.default)(this,"definition",{}),(0,n.default)(this,"roomFilter",void 0),(0,n.default)(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;const t=e.room,r={};t&&(t.rooms&&(r.rooms=t.rooms),t.rooms&&(r.not_rooms=t.not_rooms)),this.roomFilter=new s.FilterComponent(r,this.userId),this.roomTimelineFilter=new s.FilterComponent((null==t?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){l(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var t,r,i;this.definition=c(c({},this.definition),{},{room:c(c({},null===(t=this.definition)||void 0===t?void 0:t.room),{},{timeline:c(c({},null===(r=this.definition)||void 0===r||null===(i=r.room)||void 0===i?void 0:i.timeline),{},{[o.UNREAD_THREAD_NOTIFICATIONS.name]:e})})})}setLazyLoadMembers(e){l(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){l(this.definition,"room.include_leave",e)}}e.exports.Filter=u,(0,n.default)(u,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})})),i.register("aYGbo",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UNREAD_THREAD_NOTIFICATIONS=void 0;const r=new(i("1c8ok").ServerControlledNamespacedValue)("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");e.exports.UNREAD_THREAD_NOTIFICATIONS=r})),i.register("kkulx",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.FilterComponent=void 0;var r=i("etzbv");e.exports.FilterComponent=class{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var t,i;const n=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},o=Object.keys(n),s=[];return this.userId&&null!=n&&null!==(i=n[r.THREAD_RELATION_TYPE.name])&&void 0!==i&&i.current_user_participated&&s.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,o,s)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[r.FILTER_RELATED_BY_SENDERS.name]:this.filterJson[r.FILTER_RELATED_BY_SENDERS.name]||[],[r.FILTER_RELATED_BY_REL_TYPES.name]:this.filterJson[r.FILTER_RELATED_BY_REL_TYPES.name]||[]}}checkFields(e,t,i,n,o,s){const a={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const r=t.slice(0,-1);return e.slice(0,r.length)===r}return e===t}(i,e)}};for(const e in a){const t=a[e],r="not_"+e,i=this.filterJson[r];if(null!=i&&i.some(t))return!1;const n=this.filterJson[e];if(n&&!n.some(t))return!1}const c=this.filterJson.contains_url;if(void 0!==c&&c!==n)return!1;const l=this.filterJson[r.FILTER_RELATED_BY_REL_TYPES.name];if(void 0!==l&&!this.arrayMatchesFilter(l,o))return!1;const u=this.filterJson[r.FILTER_RELATED_BY_SENDERS.name];return!(void 0!==u&&!this.arrayMatchesFilter(u,s))}arrayMatchesFilter(e,t){return t.length>0&&e.every((e=>t.includes(e)))}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}})),i.register("6cjco",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isTimestampInDuration=e.exports.getBeaconInfoIdentifier=e.exports.BeaconEvent=e.exports.Beacon=void 0;var n=r(i("3EUCw")),o=i("aVwsu"),s=i("gjhRv"),a=i("75Qdj");let c;var l;e.exports.BeaconEvent=c,(l=c||(e.exports.BeaconEvent=c={})).New="Beacon.new",l.Update="Beacon.update",l.LivenessChange="Beacon.LivenessChange",l.Destroy="Beacon.Destroy",l.LocationUpdate="Beacon.LocationUpdate";const u=(e,t,r)=>r>=e&&e+t>=r;e.exports.isTimestampInDuration=u;const h=e=>`${e.getRoomId()}_${e.getStateKey()}`;e.exports.getBeaconInfoIdentifier=h;class d extends a.TypedEventEmitter{constructor(e){super(),this.rootEvent=e,(0,n.default)(this,"roomId",void 0),(0,n.default)(this,"_beaconInfo",void 0),(0,n.default)(this,"_isLive",void 0),(0,n.default)(this,"livenessWatchTimeout",void 0),(0,n.default)(this,"_latestLocationEvent",void 0),(0,n.default)(this,"clearLatestLocation",(()=>{this._latestLocationEvent=void 0,this.emit(c.LocationUpdate,this.latestLocationState)})),this.setBeaconInfo(this.rootEvent),this.roomId=this.rootEvent.getRoomId()}get isLive(){return!!this._isLive}get identifier(){return h(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&(0,o.parseBeaconContent)(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(h(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(c.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(c.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.beaconInfo)if(this.isLive){const e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),this.beaconInfo.timestamp-Date.now()))}addLocations(e){var t;if(!this.isLive)return;const r=null===(t=e.filter((e=>{const t=e.getContent(),r=(0,o.parseBeaconContent)(t);if(!r.uri||!r.timestamp)return!1;const{timestamp:i}=r;return this._beaconInfo.timestamp&&u(this._beaconInfo.timestamp,this._beaconInfo.timeout,i)&&(!this.latestLocationState||i>this.latestLocationState.timestamp)})).sort(s.sortEventsByLatestContentTimestamp))||void 0===t?void 0:t[0];r&&(this._latestLocationEvent=r,this.emit(c.LocationUpdate,this.latestLocationState))}setBeaconInfo(e){this._beaconInfo=(0,o.parseBeaconInfoContent)(e.getContent()),this.checkLiveness()}checkLiveness(){var e,t;const r=this.isLive;if(!this.beaconInfo)return;const i=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!(null===(e=this._beaconInfo)||void 0===e||!e.live)&&!!i&&u(i,null===(t=this._beaconInfo)||void 0===t?void 0:t.timeout,Date.now()),r!==this.isLive&&this.emit(c.LivenessChange,this.isLive,this)}}e.exports.Beacon=d})),i.register("aVwsu",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.makeBeaconInfoContent=e.exports.makeBeaconContent=e.exports.getTextForLocationEvent=void 0,e.exports.makeEmoteMessage=function(e){return{msgtype:o.MsgType.Emote,body:e}},e.exports.makeHtmlEmote=function(e,t){return{msgtype:o.MsgType.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}},e.exports.makeHtmlMessage=function(e,t){return{msgtype:o.MsgType.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}},e.exports.makeHtmlNotice=function(e,t){return{msgtype:o.MsgType.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}},e.exports.makeLocationContent=void 0,e.exports.makeNotice=function(e){return{msgtype:o.MsgType.Notice,body:e}},e.exports.makeTextMessage=function(e){return{msgtype:o.MsgType.Text,body:e}},e.exports.parseTopicContent=e.exports.parseLocationEvent=e.exports.parseBeaconInfoContent=e.exports.parseBeaconContent=e.exports.makeTopicContent=void 0;var n=r(i("3EUCw")),o=i("ldT3p"),s=i("hNnnH"),a=i("cn4jF"),c=i("1HWgt"),l=i("cUFZT");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}const h=(e,t,r,i)=>{const n=`at ${new Date(r).toISOString()}`;return[t===c.LocationAssetType.Self?"User":void 0,"Location",i?`"${i}"`:void 0,e,n].filter(Boolean).join(" ")};e.exports.getTextForLocationEvent=h;const d=(e,t,r,i,a)=>{const l=null!=e?e:h(t,a||c.LocationAssetType.Self,r,i),d=r?{[c.M_TIMESTAMP.name]:r}:{};return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({msgtype:o.MsgType.Location,body:l,geo_uri:t,[c.M_LOCATION.name]:{description:i,uri:t},[c.M_ASSET.name]:{type:a||c.LocationAssetType.Self},[s.M_TEXT.name]:l},d)};e.exports.makeLocationContent=d;e.exports.parseLocationEvent=e=>{var t,r;const i=c.M_LOCATION.findIn(e),n=c.M_ASSET.findIn(e),o=c.M_TIMESTAMP.findIn(e),a=s.M_TEXT.findIn(e),l=null!==(t=null==i?void 0:i.uri)&&void 0!==t?t:null==e?void 0:e.geo_uri,u=null==i?void 0:i.description,h=null!==(r=null==n?void 0:n.type)&&void 0!==r?r:c.LocationAssetType.Self,f=null!=a?a:e.body;return d(f,l,null!=o?o:void 0,u,h)};e.exports.makeTopicContent=(e,t)=>{const r=[{body:e,mimetype:"text/plain"}];return(0,a.isProvided)(t)&&r.push({body:t,mimetype:"text/html"}),{topic:e,[l.M_TOPIC.name]:r}};e.exports.parseTopicContent=e=>{var t,r,i;const n=l.M_TOPIC.findIn(e);return{text:null!==(t=null==n||null===(r=n.find((e=>!(0,a.isProvided)(e.mimetype)||"text/plain"===e.mimetype)))||void 0===r?void 0:r.body)&&void 0!==t?t:e.topic,html:null==n||null===(i=n.find((e=>"text/html"===e.mimetype)))||void 0===i?void 0:i.body}};e.exports.makeBeaconInfoContent=(e,t,r,i,n)=>({description:r,timeout:e,live:t,[c.M_TIMESTAMP.name]:n||Date.now(),[c.M_ASSET.name]:{type:null!=i?i:c.LocationAssetType.Self}});e.exports.parseBeaconInfoContent=e=>{var t;const{description:r,timeout:i,live:n}=e,o=null!==(t=c.M_TIMESTAMP.findIn(e))&&void 0!==t?t:void 0,s=c.M_ASSET.findIn(e);return{description:r,timeout:i,live:n,assetType:null==s?void 0:s.type,timestamp:o}};e.exports.makeBeaconContent=(e,t,r,i)=>({[c.M_LOCATION.name]:{description:i,uri:e},[c.M_TIMESTAMP.name]:t,"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:r}});e.exports.parseBeaconContent=e=>{var t;const r=c.M_LOCATION.findIn(e),i=null!==(t=c.M_TIMESTAMP.findIn(e))&&void 0!==t?t:void 0;return{description:null==r?void 0:r.description,uri:null==r?void 0:r.uri,timestamp:i}}})),i.register("cUFZT",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_TOPIC=void 0;const r=new(i("1c8ok").UnstableValue)("m.topic","org.matrix.msc3765.topic");e.exports.M_TOPIC=r})),i.register("auLUJ",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ReadReceipt=void 0,e.exports.synthesizeReceipt=h;var n=r(i("3EUCw")),o=i("cXHgq"),s=i("75Qdj"),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),c=i("7BSj1"),l=i("ldT3p");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function h(e,t,r){var i;return new c.MatrixEvent({content:{[t.getId()]:{[r]:{[e]:{ts:t.getTs(),thread_id:null!==(i=t.threadRootId)&&void 0!==i?i:o.MAIN_ROOM_TIMELINE}}}},type:l.EventType.Receipt,room_id:t.getRoomId()})}class d extends s.TypedEventEmitter{constructor(...e){super(...e),(0,n.default)(this,"receipts",{}),(0,n.default)(this,"receiptCacheByEventId",{}),(0,n.default)(this,"timeline",void 0)}getReadReceiptForUserId(e,t=!1,r=o.ReceiptType.Read){var i,n;const[s,a]=null!==(i=null===(n=this.receipts[r])||void 0===n?void 0:n[e])&&void 0!==i?i:[];return t?s:null!=a?a:s}getEventReadUpTo(e,t=!1){var r,i,n,s,a;const c=this.getUnfilteredTimelineSet(),l=this.getReadReceiptForUserId(e,t,o.ReceiptType.Read),u=this.getReadReceiptForUserId(e,t,o.ReceiptType.ReadPrivate);let h;var d,f;(null!=l&&l.eventId&&null!=u&&u.eventId&&(h=c.compareEventOrdering(null==l?void 0:l.eventId,null==u?void 0:u.eventId)),!h&&null!=l&&null!==(r=l.data)&&void 0!==r&&r.ts&&null!=u&&null!==(i=u.data)&&void 0!==i&&i.ts)&&(h=(null==l||null===(d=l.data)||void 0===d?void 0:d.ts)-(null==u||null===(f=u.data)||void 0===f?void 0:f.ts));return h?null!==(a=h<0?null==u?void 0:u.eventId:null==l?void 0:l.eventId)&&void 0!==a?a:null:null!==(n=null!==(s=null==u?void 0:u.eventId)&&void 0!==s?s:null==l?void 0:l.eventId)&&void 0!==n?n:null}addReceiptToStructure(e,t,r,i,n){var o,s;this.receipts[t]||(this.receipts[t]={}),this.receipts[t][r]||(this.receipts[t][r]=[null,null]);const a=this.receipts[t][r];let c=a[0];var l;n&&(c=null!==(l=a[1])&&void 0!==l?l:a[0]);if(c){const t=this.getUnfilteredTimelineSet().compareEventOrdering(c.eventId,e);if(null!==t&&t>=0)return}const u={eventId:e,data:i},h=n?a[0]:u,d=n?u:a[1];let f=null;h&&d&&(f=this.getUnfilteredTimelineSet().compareEventOrdering(h.eventId,d.eventId));const p=null===f||f<0,m=null!==(o=a[1])&&void 0!==o?o:a[0];n&&p?a[1]=u:n||(a[0]=u,p||(a[1]=null));if(m!==(null!==(s=a[1])&&void 0!==s?s:a[0])){if(m&&this.receiptCacheByEventId[m.eventId]){const e=m.eventId;this.receiptCacheByEventId[e]=this.receiptCacheByEventId[e].filter((e=>e.type!==t||e.userId!==r)),this.receiptCacheByEventId[e].length<1&&delete this.receiptCacheByEventId[e]}this.receiptCacheByEventId[e]||(this.receiptCacheByEventId[e]=[]),this.receiptCacheByEventId[e].push({userId:r,type:t,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId[e.getId()]||[]}addLocalEchoReceipt(e,t,r){this.addReceipt(h(e,t,r),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter((function(e){return a.isSupportedReceiptType(e.type)})).map((function(e){return e.userId}))}hasUserReadEvent(e,t){var r;const i=this.getEventReadUpTo(e,!1);if(i===t)return!0;if(null!==(r=this.timeline)&&void 0!==r&&r.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=(null===(n=this.timeline)||void 0===n?void 0:n.length)-1;e>=0;--e){var n;const r=this.timeline[e];if(r.getId()===t)return!1;if(r.getId()===i)return!0}return!1}}e.exports.ReadReceipt=d})),i.register("3yMwy",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PollEvent=e.exports.Poll=void 0;var n=r(i("3EUCw")),o=i("1hY5V"),s=i("9sRLa"),a=i("75Qdj");let c;var l;e.exports.PollEvent=c,(l=c||(e.exports.PollEvent=c={})).New="Poll.new",l.End="Poll.end",l.Update="Poll.update",l.Responses="Poll.Responses",l.Destroy="Poll.Destroy";const u=(e,t)=>({responseEvents:e.filter((e=>{if(!e.isDecryptionFailure())return o.M_POLL_RESPONSE.matches(e.getType())&&e.getTs()<=t}))});class h extends a.TypedEventEmitter{constructor(e,t,r){if(super(),this.rootEvent=e,this.matrixClient=t,this.room=r,(0,n.default)(this,"roomId",void 0),(0,n.default)(this,"pollEvent",void 0),(0,n.default)(this,"_isFetchingResponses",!1),(0,n.default)(this,"relationsNextBatch",void 0),(0,n.default)(this,"responses",null),(0,n.default)(this,"endEvent",void 0),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}async getResponses(){return this.responses||this.isFetchingResponses||await this.fetchResponses(),this.responses}onNewRelation(e){var t;if(o.M_POLL_END.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(c.End)),!this.responses)return;const r=(null===(t=this.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:i}=u([e],r);i.length&&(i.forEach((e=>{this.responses.addEvent(e)})),this.emit(c.Responses,this.responses))}async fetchResponses(){var e,t;this._isFetchingResponses=!0;const r=await this.matrixClient.relations(this.roomId,this.rootEvent.getId(),"m.reference",void 0,{from:this.relationsNextBatch||void 0}),i=this.responses||new s.Relations("m.reference",o.M_POLL_RESPONSE.name,this.matrixClient,[o.M_POLL_RESPONSE.altName]),n=r.events.find((e=>o.M_POLL_END.matches(e.getType())));this.validateEndEvent(n)&&(this.endEvent=n,this.refilterResponsesOnEnd(),this.emit(c.End));const a=(null===(e=this.endEvent)||void 0===e?void 0:e.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:l}=u(r.events,a);l.forEach((e=>{i.addEvent(e)})),this.relationsNextBatch=null!==(t=r.nextBatch)&&void 0!==t?t:void 0,this.responses=i,this.relationsNextBatch?this.fetchResponses():this._isFetchingResponses=!1,this.emit(c.Responses,this.responses)}refilterResponsesOnEnd(){var e;if(!this.responses)return;const t=(null===(e=this.endEvent)||void 0===e?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach((e=>{var r;e.getTs()>t&&(null===(r=this.responses)||void 0===r||r.removeEvent(e))})),this.emit(c.Responses,this.responses)}validateEndEvent(e){if(!e)return!1;if(this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;const t=this.room.currentState,r=e.getSender();return!!r&&(r===this.rootEvent.getSender()||t.maySendRedactionForEvent(this.rootEvent,r))}}e.exports.Poll=h})),i.register("1hY5V",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_POLL_START=e.exports.M_POLL_RESPONSE=e.exports.M_POLL_KIND_UNDISCLOSED=e.exports.M_POLL_KIND_DISCLOSED=e.exports.M_POLL_END=void 0;var r=i("e0VXi");const n=new r.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");e.exports.M_POLL_KIND_DISCLOSED=n;const o=new r.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");e.exports.M_POLL_KIND_UNDISCLOSED=o;const s=new r.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");e.exports.M_POLL_START=s;const a=new r.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");e.exports.M_POLL_RESPONSE=a;const c=new r.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");e.exports.M_POLL_END=c})),i.register("dpNo2",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PushProcessor=void 0;var n=r(i("3EUCw")),o=i("gjhRv"),s=i("gEWrD"),a=i("avVpE"),c=i("ldT3p");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const h=[a.PushRuleKind.Override,a.PushRuleKind.ContentSpecific,a.PushRuleKind.RoomSpecific,a.PushRuleKind.SenderSpecific,a.PushRuleKind.Underride],d=[{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:"m.reaction"}],actions:[a.PushRuleActionName.DontNotify]},{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:c.EventType.RoomServerAcl},{kind:a.ConditionKind.EventMatch,key:"state_key",pattern:""}],actions:[]}],f=[{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:a.ConditionKind.CallStarted}],actions:[a.PushRuleActionName.Notify,{set_tweak:a.TweakName.Sound,value:"default"}]}];class p{constructor(e){this.client=e}static actionListToActionsObject(e){const t={notify:!1,tweaks:{}};for(const r of e)r===a.PushRuleActionName.Notify?t.notify=!0:"object"==typeof r&&(void 0===r.value&&(r.value=!0),t.tweaks[r.set_tweak]=r.value);return t}static rewriteDefaultRules(e){var t;let r=JSON.parse(JSON.stringify(e));r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.override||(r.global.underride=[]);const i=r.global.override;for(const e of d){const t=i.find((t=>t.rule_id===e.rule_id));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;s.logger.warn(`Adding default global override for ${t}`),i.push(e)}}const n=null!==(t=r.global.underride)&&void 0!==t?t:[];for(const e of f){const t=n.find((t=>t.rule_id===e.rule_id));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;s.logger.warn(`Adding default global underride for ${t}`),n.push(e)}}return r}matchingRuleFromKindSet(e,t){for(const r of h){const i=t[r];if(i)for(const t of i){if(!t.enabled)continue;const i=this.templateRuleToRaw(r,t);if(i&&this.ruleMatchesEvent(i,e))return u(u({},t),{},{kind:r})}}return null}templateRuleToRaw(e,t){const r={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case a.PushRuleKind.Underride:case a.PushRuleKind.Override:r.conditions=t.conditions;break;case a.PushRuleKind.RoomSpecific:if(!t.rule_id)return null;r.conditions.push({kind:a.ConditionKind.EventMatch,key:"room_id",value:t.rule_id});break;case a.PushRuleKind.SenderSpecific:if(!t.rule_id)return null;r.conditions.push({kind:a.ConditionKind.EventMatch,key:"user_id",value:t.rule_id});break;case a.PushRuleKind.ContentSpecific:if(!t.pattern)return null;r.conditions.push({kind:a.ConditionKind.EventMatch,key:"content.body",pattern:t.pattern})}return r}eventFulfillsCondition(e,t){switch(e.kind){case a.ConditionKind.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case a.ConditionKind.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case a.ConditionKind.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case a.ConditionKind.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t);case a.ConditionKind.CallStarted:case a.ConditionKind.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){const r=e.key;if(!r)return!1;const i=this.client.getRoom(t.getRoomId());return!(null==i||!i.currentState)&&i.currentState.mayTriggerNotifOfType(r,t.getSender())}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;const r=this.client.getRoom(t.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;const i=r.currentState.getJoinedMemberCount(),n=e.is.match(/^([=<>]*)(\d*)$/);if(!n)return!1;const o=n[1],s=parseInt(n[2]);if(isNaN(s))return!1;switch(o){case"":case"==":return i==s;case"<":return i<s;case">":return i>s;case"<=":return i<=s;case">=":return i>=s;default:return!1}}eventFulfillsDisplayNameCondition(e,t){var r;let i=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(i=t.getClearContent()),!i||!i.body||"string"!=typeof i.body)return!1;const n=this.client.getRoom(t.getRoomId()),s=null==n||null===(r=n.currentState)||void 0===r?void 0:r.getMember(this.client.credentials.userId);if(!s)return!1;const a=s.name,c=new RegExp("(^|\\W)"+(0,o.escapeRegExp)(a)+"(\\W|$)","i");return i.body.search(c)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;const r=this.valueForDottedKey(e.key,t);if("string"!=typeof r)return!1;if(e.value)return e.value===r;if("string"!=typeof e.pattern)return!1;const i="content.body"===e.key?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$");return!!r.match(i)}eventFulfillsCallStartedCondition(e,t){return["m.ring","m.prompt"].includes(t.getContent()["m.intent"])&&!("m.terminated"in t.getContent())&&(t.getPrevContent()["m.terminated"]!==t.getContent()["m.terminated"]||(0,o.deepCompare)(t.getPrevContent(),{}))}createCachedRegex(e,t,r){return p.cachedGlobToRegex[t]||(p.cachedGlobToRegex[t]=new RegExp(e+(0,o.globToRegexp)(t)+r,"i")),p.cachedGlobToRegex[t]}valueForDottedKey(e,t){const r=e.split(".");let i;const n=r[0];for("content"===n?(i=t.getContent(),r.shift()):"type"===n?(i=t.getType(),r.shift()):i=t.event;r.length>0;){const e=r.shift();if((0,o.isNullOrUndefined)(i[e]))return null;i=i[e]}return i}matchingRuleForEventWithRulesets(e,t){return t?e.getSender()===this.client.credentials.userId?null:this.matchingRuleFromKindSet(e,t.global):null}pushActionsForEventAndRulesets(e,t){const r=this.matchingRuleForEventWithRulesets(e,t);if(!r)return{};const i=p.actionListToActionsObject(r.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight=r.kind==a.PushRuleKind.ContentSpecific),i}ruleMatchesEvent(e,t){var r;return!(null!==(r=e.conditions)&&void 0!==r&&r.some((e=>!this.eventFulfillsCondition(e,t))))}actionsForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){for(const r of["global"]){var t;if(void 0!==(null===(t=this.client.pushRules)||void 0===t?void 0:t[r]))for(const t of h)if(void 0!==this.client.pushRules[r][t])for(const i of this.client.pushRules[r][t])if(i.rule_id===e)return i}return null}}e.exports.PushProcessor=p,(0,n.default)(p,"cachedGlobToRegex",{})})),i.register("avVpE",(function(e,t){let r;var i;let n;var o;let s;var a;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TweakName=e.exports.RuleId=e.exports.PushRuleKind=e.exports.PushRuleActionName=e.exports.DMMemberCountCondition=e.exports.ConditionOperator=e.exports.ConditionKind=void 0,e.exports.isDmMemberCountCondition=function(e){return"==2"===e||"2"===e},e.exports.PushRuleActionName=r,(i=r||(e.exports.PushRuleActionName=r={})).DontNotify="dont_notify",i.Notify="notify",i.Coalesce="coalesce",e.exports.TweakName=n,(o=n||(e.exports.TweakName=n={})).Highlight="highlight",o.Sound="sound",e.exports.ConditionOperator=s,(a=s||(e.exports.ConditionOperator=s={})).ExactEquals="==",a.LessThan="<",a.GreaterThan=">",a.GreaterThanOrEqual=">=",a.LessThanOrEqual="<=";let c;var l;let u;var h;let d;var f;e.exports.DMMemberCountCondition="2",e.exports.ConditionKind=c,(l=c||(e.exports.ConditionKind=c={})).EventMatch="event_match",l.ContainsDisplayName="contains_display_name",l.RoomMemberCount="room_member_count",l.SenderNotificationPermission="sender_notification_permission",l.CallStarted="call_started",l.CallStartedPrefix="org.matrix.msc3914.call_started",e.exports.PushRuleKind=u,(h=u||(e.exports.PushRuleKind=u={})).Override="override",h.ContentSpecific="content",h.RoomSpecific="room",h.SenderSpecific="sender",h.Underride="underride",e.exports.RuleId=d,(f=d||(e.exports.RuleId=d={})).Master=".m.rule.master",f.ContainsDisplayName=".m.rule.contains_display_name",f.ContainsUserName=".m.rule.contains_user_name",f.AtRoomNotification=".m.rule.roomnotif",f.DM=".m.rule.room_one_to_one",f.EncryptedDM=".m.rule.encrypted_room_one_to_one",f.Message=".m.rule.message",f.EncryptedMessage=".m.rule.encrypted",f.InviteToSelf=".m.rule.invite_for_me",f.MemberEvent=".m.rule.member_event",f.IncomingCall=".m.rule.call",f.SuppressNotices=".m.rule.suppress_notices",f.Tombstone=".m.rule.tombstone"})),i.register("dsM0i",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.KeySignatureUploadError=e.exports.InvalidStoreState=e.exports.InvalidStoreError=e.exports.InvalidCryptoStoreState=e.exports.InvalidCryptoStoreError=void 0;var n=r(i("3EUCw"));let o;var s;e.exports.InvalidStoreState=o,(s=o||(e.exports.InvalidStoreState=o={}))[s.ToggledLazyLoading=0]="ToggledLazyLoading";class a extends Error{constructor(e,t){super(`Store is invalid because ${e}, please stop the client, delete all data and start the client again`),this.reason=e,this.value=t,this.name="InvalidStoreError"}}let c;e.exports.InvalidStoreError=a,(0,n.default)(a,"TOGGLED_LAZY_LOADING",o.ToggledLazyLoading),e.exports.InvalidCryptoStoreState=c,(c||(e.exports.InvalidCryptoStoreState=c={})).TooNew="TOO_NEW";class l extends Error{constructor(e){super(`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`),this.reason=e,this.name="InvalidCryptoStoreError"}}e.exports.InvalidCryptoStoreError=l,(0,n.default)(l,"TOO_NEW",c.TooNew);class u extends Error{constructor(e,t){super(e),this.value=t}}e.exports.KeySignatureUploadError=u})),i.register("cH9or",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0});var o={MatrixHttpApi:!0};e.exports.MatrixHttpApi=void 0;var s=n(i("3EUCw")),a=i("lYsHZ"),c=i("9vYt4");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(o,t)||t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var l=g(i("gjhRv")),u=g(i("wlKjn")),h=i("lEyuf");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(o,t)||t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var d=i("2396X");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(o,t)||t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=i("j8kD3");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(o,t)||t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var p=i("bJF8s");function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(o,t)||t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));class v extends a.FetchHttpApi{constructor(...e){super(...e),(0,s.default)(this,"uploads",[])}uploadContent(e,t={}){var i,n,o,s,a;const p=null===(i=t.includeFilename)||void 0===i||i,m=null!==(n=t.abortController)&&void 0!==n?n:new AbortController,g=null!==(o=null!==(s=t.type)&&void 0!==s?s:e.type)&&void 0!==o?o:"application/octet-stream",v=null!==(a=t.name)&&void 0!==a?a:e.name,y={loaded:0,total:0,abortController:m},b=l.defer();if(r.XMLHttpRequest){const i=new r.XMLHttpRequest,n=function(){i.abort(),b.reject(new Error("Timeout"))};let o=u.setTimeout(n,3e4);i.onreadystatechange=function(){if(i.readyState===r.XMLHttpRequest.DONE){u.clearTimeout(o);try{if(0===i.status)throw new DOMException(i.statusText,"AbortError");if(!i.responseText)throw new Error("No response body.");i.status>=400?b.reject((0,f.parseErrorResponse)(i,i.responseText)):b.resolve(JSON.parse(i.responseText))}catch(e){if("AbortError"===e.name)return void b.reject(e);b.reject(new d.ConnectionError("request failed",e))}}},i.upload.onprogress=e=>{var r;u.clearTimeout(o),y.loaded=e.loaded,y.total=e.total,o=u.setTimeout(n,3e4),null===(r=t.progressHandler)||void 0===r||r.call(t,{loaded:e.loaded,total:e.total})};const s=this.getUrl("/upload",void 0,c.MediaPrefix.R0);p&&v&&s.searchParams.set("filename",encodeURIComponent(v)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&s.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),i.open(h.Method.Post,s.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&i.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),i.setRequestHeader("Content-Type",g),i.send(e),m.signal.addEventListener("abort",(()=>{i.abort()}))}else{const t={};p&&v&&(t.filename=v);const r={"Content-Type":g};this.authedRequest(h.Method.Post,"/upload",t,e,{prefix:c.MediaPrefix.R0,headers:r,abortSignal:m.signal}).then((e=>this.opts.onlyData?e:e.json())).then(b.resolve,b.reject)}return y.promise=b.promise.finally((()=>{l.removeElement(this.uploads,(e=>e===y))})),m.signal.addEventListener("abort",(()=>{l.removeElement(this.uploads,(e=>e===y)),b.reject(new DOMException("Aborted","AbortError"))})),this.uploads.push(y),y.promise}cancelUpload(e){const t=this.uploads.find((t=>t.promise===e));return!!t&&(t.abortController.abort(),!0)}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:c.MediaPrefix.R0+"/upload",params:{access_token:this.opts.accessToken}}}}e.exports.MatrixHttpApi=v})),i.register("lYsHZ",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.FetchHttpApi=void 0;var o=n(i("3EUCw")),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),a=i("lEyuf"),c=i("2396X"),l=i("bJF8s"),u=i("j8kD3");function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}e.exports.FetchHttpApi=class{constructor(e,t){var r;this.eventEmitter=e,this.opts=t,(0,o.default)(this,"abortController",new AbortController),s.checkObjectHasKeys(t,["baseUrl","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=null===(r=t.useAuthorizationHeader)||void 0===r||r}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,t){return this.opts.fetchFn?this.opts.fetchFn(e,t):r.fetch(e,t)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,t,r,i,n){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");let o,s;e===a.Method.Get?o=r:s=r;const c=this.getUrl(t,o,i,this.opts.idBaseUrl),l={json:!0,headers:{}};return n&&(l.headers.Authorization=`Bearer ${n}`),this.requestOtherUrl(e,c,s,l)}authedRequest(e,t,r,i,n={}){r||(r={}),this.opts.accessToken&&(this.opts.useAuthorizationHeader?(n.headers||(n.headers={}),n.headers.Authorization||(n.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken));const o=this.request(e,t,r,i,n);return o.catch((e=>{"M_UNKNOWN_TOKEN"!=e.errcode||null!=n&&n.inhibitLogoutEmit?"M_CONSENT_NOT_GIVEN"==e.errcode&&this.eventEmitter.emit(l.HttpApiEvent.NoConsent,e.message,e.data.consent_uri):this.eventEmitter.emit(l.HttpApiEvent.SessionLoggedOut,e)})),o}request(e,t,r,i,n){const o=this.getUrl(t,r,null==n?void 0:n.prefix,null==n?void 0:n.baseUrl);return this.requestOtherUrl(e,o,i,n)}async requestOtherUrl(e,t,r,i={}){var n,o,s,a;const l=Object.assign({},i.headers||{}),h=null===(n=i.json)||void 0===n||n,d=h&&(null==r||null===(o=r.constructor)||void 0===o?void 0:o.name)===Object.name;h&&(d&&!l["Content-Type"]&&(l["Content-Type"]="application/json"),l.Accept||(l.Accept="application/json"));const f=null!==(s=i.localTimeoutMs)&&void 0!==s?s:this.opts.localTimeoutMs,p=null!==(a=i.keepAlive)&&void 0!==a&&a,m=[this.abortController.signal];let g;void 0!==f&&m.push((0,u.timeoutSignal)(f)),i.abortSignal&&m.push(i.abortSignal),g=d?JSON.stringify(r):r;const{signal:v,cleanup:y}=(0,u.anySignal)(m);let b;try{b=await this.fetch(t,{signal:v,method:e,body:g,headers:l,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:p})}catch(e){if("AbortError"===e.name)throw e;throw new c.ConnectionError("fetch failed",e)}finally{y()}if(!b.ok)throw(0,u.parseErrorResponse)(b,await b.text());return this.opts.onlyData?h?b.json():b.text():b}getUrl(e,t,r,i){const n=new URL((null!=i?i:this.opts.baseUrl)+(null!=r?r:this.opts.prefix)+e);return t&&s.encodeParams(t,n.searchParams),n}}})),i.register("lEyuf",(function(e,t){let r;var i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Method=void 0,e.exports.Method=r,(i=r||(e.exports.Method=r={})).Get="GET",i.Put="PUT",i.Post="POST",i.Delete="DELETE"})),i.register("2396X",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixError=e.exports.HTTPError=e.exports.ConnectionError=void 0;var n=r(i("3EUCw"));class o extends Error{constructor(e,t){super(e),this.httpStatus=t}}e.exports.HTTPError=o;e.exports.MatrixError=class extends o{constructor(e={},t,r,i){let o=e.error||"Unknown message";t&&(o=`[${t}] ${o}`),r&&(o=`${o} (${r})`),super(`MatrixError: ${o}`,t),this.httpStatus=t,this.url=r,this.event=i,(0,n.default)(this,"errcode",void 0),(0,n.default)(this,"data",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}};class s extends Error{constructor(e,t){super(e+(t?`: ${t.message}`:""))}get name(){return"ConnectionError"}}e.exports.ConnectionError=s})),i.register("bJF8s",(function(e,t){let r;var i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.HttpApiEvent=void 0,e.exports.HttpApiEvent=r,(i=r||(e.exports.HttpApiEvent=r={})).SessionLoggedOut="Session.logged_out",i.NoConsent="no_consent"})),i.register("j8kD3",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.anySignal=function(e){const t=new AbortController;function r(){for(const t of e)t.removeEventListener("abort",i)}function i(){t.abort(),r()}for(const t of e){if(t.aborted){i();break}t.addEventListener("abort",i)}return{signal:t.signal,cleanup:r}},e.exports.parseErrorResponse=function(e,t){var i,n;let o;try{o=function(e){let t;t=a(e)?e.getResponseHeader("Content-Type"):e.headers.get("Content-Type");if(!t)return null;try{return(0,r.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e)}catch(e){return e}return"application/json"===(null===(i=o)||void 0===i?void 0:i.type)&&t?new s.MatrixError(JSON.parse(t),e.status,a(e)?e.responseURL:e.url):"text/plain"===(null===(n=o)||void 0===n?void 0:n.type)?new s.HTTPError(`Server returned ${e.status} error: ${t}`,e.status):new s.HTTPError(`Server returned ${e.status} error`,e.status)},e.exports.retryNetworkOperation=async function(e,t){let r=0,i=null;for(;r<e;)try{if(r>0){const e=1e3*Math.pow(2,r);n.logger.log(`network operation failed ${r} times, retrying in ${e}ms...`),await(0,o.sleep)(e)}return await t()}catch(e){if(!(e instanceof s.ConnectionError))throw e;r+=1,i=e}throw i},e.exports.timeoutSignal=function(e){const t=new AbortController;return setTimeout((()=>{t.abort()}),e),t.signal};var r=i("863fV"),n=i("gEWrD"),o=i("gjhRv"),s=i("2396X");function a(e){return"getResponseHeader"in e}})),i.register("863fV",(function(t,r){
/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
var i;e(t.exports,"parse",(()=>i),(e=>i=e));var n=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,o=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,s=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,a=/\\([\u000b\u0020-\u00ff])/g,c=/([\\"])/g,l=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function u(e){var t=String(e);if(s.test(t))return t;if(t.length>0&&!o.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(c,"\\$1")+'"'}function h(e){this.parameters=Object.create(null),this.type=e}i=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;"function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var r=t.indexOf(";"),i=-1!==r?t.slice(0,r).trim():t.trim();if(!l.test(i))throw new TypeError("invalid media type");var o=new h(i.toLowerCase());if(-1!==r){var s,c,u;for(n.lastIndex=r;c=n.exec(t);){if(c.index!==r)throw new TypeError("invalid parameter format");r+=c[0].length,s=c[1].toLowerCase(),34===(u=c[2]).charCodeAt(0)&&-1!==(u=u.slice(1,-1)).indexOf("\\")&&(u=u.replace(a,"$1")),o.parameters[s]=u}if(r!==t.length)throw new TypeError("invalid parameter format")}return o}})),i.register("9vYt4",(function(e,t){let r;var i;let n;let o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MediaPrefix=e.exports.IdentityPrefix=e.exports.ClientPrefix=void 0,e.exports.ClientPrefix=r,(i=r||(e.exports.ClientPrefix=r={})).R0="/_matrix/client/r0",i.V1="/_matrix/client/v1",i.V3="/_matrix/client/v3",i.Unstable="/_matrix/client/unstable",e.exports.IdentityPrefix=n,(n||(e.exports.IdentityPrefix=n={})).V2="/_matrix/identity/v2",e.exports.MediaPrefix=o,(o||(e.exports.MediaPrefix=o={})).R0="/_matrix/media/r0"})),i.register("wlKjn",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.clearTimeout=function(e){if(0===c.length)return;let t;for(t=0;t<c.length;t++){if(c[t].key==e){c.splice(t,1);break}}0===t&&u()},e.exports.setTimeout=function(e,t,...r){(t=t||0)<0&&(t=0);const i=Date.now()+t,n=a++;l("setTimeout: scheduling cb",n,"at",i,"(delay",t,")");const o={runAt:i,func:e,params:r,key:n},s=function(e,t){let r=0,i=e.length;for(;r<i;){const n=r+i>>1;t(e[n])>0?i=n:r=n+1}return r}(c,(function(e){return e.runAt-i}));return c.splice(s,0,o),u(),n};var n=i("gEWrD");const o=1e3;let s,a=0;const c=[],l=function(...e){};function u(){s&&r.clearTimeout(s);const e=c[0];if(!e)return void l("scheduleRealCallback: no more callbacks, not rescheduling");const t=Date.now(),i=Math.min(e.runAt-t,o);l("scheduleRealCallback: now:",t,"delay:",i),s=r.setTimeout(h,i)}function h(){const e=Date.now();l("runCallbacks: now:",e);const t=[];for(;;){const r=c[0];if(!r||r.runAt>e)break;const i=c.shift();l("runCallbacks: popping",i.key),t.push(i)}u();for(const e of t)try{e.func.apply(r,e.params)}catch(e){n.logger.error("Uncaught exception in callback function",e)}}})),i.register("gw07V",(function(e,t){let r;var i;let n;var o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ServerSupport=e.exports.Feature=void 0,e.exports.buildFeatureSupportMap=async function(e){const t=new Map;for(const[c,l]of Object.entries(s)){var i,n,o,a;const s=null!==(i=null===(n=e.versions)||void 0===n?void 0:n.includes(l.matrixVersion||""))&&void 0!==i&&i,u=null!==(o=null===(a=l.unstablePrefixes)||void 0===a?void 0:a.every((t=>{var r;return!0===(null===(r=e.unstable_features)||void 0===r?void 0:r[t])})))&&void 0!==o&&o;s?t.set(c,r.Stable):u?t.set(c,r.Unstable):t.set(c,r.Unsupported)}return t},e.exports.ServerSupport=r,(i=r||(e.exports.ServerSupport=r={}))[i.Stable=0]="Stable",i[i.Unstable=1]="Unstable",i[i.Unsupported=2]="Unsupported",e.exports.Feature=n,(o=n||(e.exports.Feature=n={})).Thread="Thread",o.ThreadUnreadNotifications="ThreadUnreadNotifications",o.LoginTokenRequest="LoginTokenRequest",o.RelationBasedRedactions="RelationBasedRedactions",o.AccountDataDeletion="AccountDataDeletion";const s={[n.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[n.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[n.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[n.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[n.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]}}})),i.register("geh4X",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.StubStore=void 0;var n=r(i("3EUCw"));e.exports.StubStore=class{constructor(){(0,n.default)(this,"accountData",{}),(0,n.default)(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}storeEvents(e,t,r,i){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}async getPendingEvents(e){return[]}setPendingEvents(e,t){return Promise.resolve()}async saveToDeviceBatches(e){return Promise.resolve()}getOldestToDeviceBatch(){return Promise.resolve(null)}async removeToDeviceBatch(e){return Promise.resolve()}}})),i.register("7L16h",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixCall=e.exports.CallType=e.exports.CallState=e.exports.CallParty=e.exports.CallEvent=e.exports.CallErrorCode=e.exports.CallError=e.exports.CallDirection=void 0,e.exports.createNewMatrixCall=function(e,t,r){if(!K())return null;const i=!!r&&r.forceTURN,n={client:e,roomId:t,invitee:null==r?void 0:r.invitee,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||i,opponentDeviceId:null==r?void 0:r.opponentDeviceId,opponentSessionId:null==r?void 0:r.opponentSessionId,groupCallId:null==r?void 0:r.groupCallId},o=new B(n);return e.reEmitter.reEmit(o,Object.values(O)),o},e.exports.genCallID=U,e.exports.setTracksEnabled=F,e.exports.supportsMatrixCall=K;var n,o,s,a=r(i("3EUCw")),c=i("73W4W"),l=i("aMgXf"),u=i("gEWrD"),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=w(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),d=i("ldT3p"),f=i("863Vm"),p=i("bR689"),m=i("bM1pu"),g=i("75Qdj"),v=i("iN8Ss"),y=i("hadDF"),b=i("cH9or");function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(w=function(e){return e?r:t})(e)}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let E;var M;let C;var I;let T;var k;let R;var x;let O;var A;let P;var D;(o=n||(n={})).AUDIO="audio",o.VIDEO="video",(s||(s={})).OPUS="opus",e.exports.CallState=E,(M=E||(e.exports.CallState=E={})).Fledgling="fledgling",M.InviteSent="invite_sent",M.WaitLocalMedia="wait_local_media",M.CreateOffer="create_offer",M.CreateAnswer="create_answer",M.Connecting="connecting",M.Connected="connected",M.Ringing="ringing",M.Ended="ended",e.exports.CallType=C,(I=C||(e.exports.CallType=C={})).Voice="voice",I.Video="video",e.exports.CallDirection=T,(k=T||(e.exports.CallDirection=T={})).Inbound="inbound",k.Outbound="outbound",e.exports.CallParty=R,(x=R||(e.exports.CallParty=R={})).Local="local",x.Remote="remote",e.exports.CallEvent=O,(A=O||(e.exports.CallEvent=O={})).Hangup="hangup",A.State="state",A.Error="error",A.Replaced="replaced",A.LocalHoldUnhold="local_hold_unhold",A.RemoteHoldUnhold="remote_hold_unhold",A.HoldUnhold="hold_unhold",A.FeedsChanged="feeds_changed",A.AssertedIdentityChanged="asserted_identity_changed",A.LengthChanged="length_changed",A.DataChannel="datachannel",A.SendVoipEvent="send_voip_event",e.exports.CallErrorCode=P,(D=P||(e.exports.CallErrorCode=P={})).UserHangup="user_hangup",D.LocalOfferFailed="local_offer_failed",D.NoUserMedia="no_user_media",D.UnknownDevices="unknown_devices",D.SendInvite="send_invite",D.CreateAnswer="create_answer",D.CreateOffer="create_offer",D.SendAnswer="send_answer",D.SetRemoteDescription="set_remote_description",D.SetLocalDescription="set_local_description",D.AnsweredElsewhere="answered_elsewhere",D.IceFailed="ice_failed",D.InviteTimeout="invite_timeout",D.Replaced="replaced",D.SignallingFailed="signalling_timeout",D.UserBusy="user_busy",D.Transferred="transferred",D.NewSession="new_session";class L extends Error{constructor(e,t,r){super(t+": "+r),(0,a.default)(this,"code",void 0),this.code=e}}function U(){return Date.now().toString()+(0,f.randomString)(16)}function N(e){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:e?12e3:void 0}]}function j(e,t){return e+":"+t}e.exports.CallError=L;class B extends g.TypedEventEmitter{constructor(e){var t;if(super(),(0,a.default)(this,"roomId",void 0),(0,a.default)(this,"callId",void 0),(0,a.default)(this,"invitee",void 0),(0,a.default)(this,"hangupParty",void 0),(0,a.default)(this,"hangupReason",void 0),(0,a.default)(this,"direction",void 0),(0,a.default)(this,"ourPartyId",void 0),(0,a.default)(this,"peerConn",void 0),(0,a.default)(this,"toDeviceSeq",0),(0,a.default)(this,"isPtt",!1),(0,a.default)(this,"_state",E.Fledgling),(0,a.default)(this,"client",void 0),(0,a.default)(this,"forceTURN",void 0),(0,a.default)(this,"turnServers",void 0),(0,a.default)(this,"candidateSendQueue",[]),(0,a.default)(this,"candidateSendTries",0),(0,a.default)(this,"candidatesEnded",!1),(0,a.default)(this,"feeds",[]),(0,a.default)(this,"transceivers",new Map),(0,a.default)(this,"inviteOrAnswerSent",!1),(0,a.default)(this,"waitForLocalAVStream",!1),(0,a.default)(this,"successor",void 0),(0,a.default)(this,"opponentMember",void 0),(0,a.default)(this,"opponentVersion",void 0),(0,a.default)(this,"opponentPartyId",void 0),(0,a.default)(this,"opponentCaps",void 0),(0,a.default)(this,"iceDisconnectedTimeout",void 0),(0,a.default)(this,"inviteTimeout",void 0),(0,a.default)(this,"removeTrackListeners",new Map),(0,a.default)(this,"remoteOnHold",!1),(0,a.default)(this,"callStatsAtEnd",void 0),(0,a.default)(this,"makingOffer",!1),(0,a.default)(this,"ignoreOffer",!1),(0,a.default)(this,"responsePromiseChain",void 0),(0,a.default)(this,"remoteCandidateBuffer",new Map),(0,a.default)(this,"remoteAssertedIdentity",void 0),(0,a.default)(this,"remoteSDPStreamMetadata",void 0),(0,a.default)(this,"callLengthInterval",void 0),(0,a.default)(this,"callStartTime",void 0),(0,a.default)(this,"opponentDeviceId",void 0),(0,a.default)(this,"opponentDeviceInfo",void 0),(0,a.default)(this,"opponentSessionId",void 0),(0,a.default)(this,"groupCallId",void 0),(0,a.default)(this,"stopVideoTrackTimer",void 0),(0,a.default)(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(this.candidatesEnded)return void u.logger.warn("Got candidate after candidates have ended - ignoring!");if(u.logger.debug("Call "+this.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate?this.queueCandidate(null):this.queueCandidate(e.candidate)}})),(0,a.default)(this,"onIceGatheringStateChange",(e=>{var t;u.logger.debug(`Call ${this.callId} ice gathering state changed to  ${this.peerConn.iceGatheringState}`),"complete"===(null===(t=this.peerConn)||void 0===t?void 0:t.iceGatheringState)&&this.queueCandidate(null)})),(0,a.default)(this,"getLocalOfferFailed",(e=>{u.logger.error(`Call ${this.callId} Failed to get local offer`,e),this.emit(O.Error,new L(P.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(R.Local,P.LocalOfferFailed,!1)})),(0,a.default)(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(u.logger.warn(`Failed to get user media - ending call ${this.callId}`,e),this.emit(O.Error,new L(P.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(R.Local,P.NoUserMedia,!1))})),(0,a.default)(this,"onIceConnectionStateChanged",(()=>{var e,t,r,i,n;if(!this.callHasEnded()){if(u.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState)),["connected","completed"].includes(null!==(t=null===(r=this.peerConn)||void 0===r?void 0:r.iceConnectionState)&&void 0!==t?t:""))clearTimeout(this.iceDisconnectedTimeout),this.state=E.Connected,this.callLengthInterval||this.callStartTime||(this.callStartTime=Date.now(),this.callLengthInterval=setInterval((()=>{this.emit(O.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3))}),1e3));else if("failed"==(null===(i=this.peerConn)||void 0===i?void 0:i.iceConnectionState)){var o;null!==(o=this.peerConn)&&void 0!==o&&o.restartIce?(this.candidatesEnded=!1,this.peerConn.restartIce()):(u.logger.info(`Hanging up call ${this.callId} (ICE failed and no ICE restart method)`),this.hangup(P.IceFailed,!1))}else"disconnected"==(null===(n=this.peerConn)||void 0===n?void 0:n.iceConnectionState)&&(this.iceDisconnectedTimeout=setTimeout((()=>{u.logger.info(`Hanging up call ${this.callId} (ICE disconnected for too long)`),this.hangup(P.IceFailed,!1)}),3e4),this.state=E.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(const e of this.getRemoteFeeds())e.setAudioVideoMuted(!0,!0)}})),(0,a.default)(this,"onSignallingStateChanged",(()=>{var e;u.logger.debug(`call ${this.callId}: Signalling state changed to: ${null===(e=this.peerConn)||void 0===e?void 0:e.signalingState}`)})),(0,a.default)(this,"onTrack",(e=>{if(0===e.streams.length)return void u.logger.warn(`Call ${this.callId} Streamless ${e.track.kind} found: ignoring.`);const t=e.streams[0];if(this.pushRemoteFeed(t),!this.removeTrackListeners.has(t)){const e=()=>{0===t.getTracks().length&&(u.logger.info(`Call ${this.callId} removing track streamId: ${t.id}`),this.deleteFeedByStream(t),t.removeEventListener("removetrack",e),this.removeTrackListeners.delete(t))};t.addEventListener("removetrack",e),this.removeTrackListeners.set(t,e)}})),(0,a.default)(this,"onDataChannel",(e=>{this.emit(O.DataChannel,e.channel)})),(0,a.default)(this,"onNegotiationNeeded",(async()=>{u.logger.info(`Call ${this.callId} Negotiation is needed!`),this.state===E.CreateOffer||0!==this.opponentVersion?this.queueGotLocalOffer():u.logger.info(`Call ${this.callId} Opponent does not support renegotiation: ignoring negotiationneeded event`)})),(0,a.default)(this,"onHangupReceived",(e=>{u.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===E.Ringing?this.terminate(R.Remote,e.reason||P.UserHangup,!0):u.logger.info(`Call ${this.callId} Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)})),(0,a.default)(this,"onRejectReceived",(e=>{u.logger.debug("Reject received for call ID "+this.callId);[E.InviteSent,E.Ringing].includes(this.state)||this.state===E.Fledgling&&this.direction===T.Inbound?this.terminate(R.Remote,e.reason||P.UserHangup,!0):u.logger.debug(`Call ${this.callId} is in state: ${this.state}: ignoring reject`)})),(0,a.default)(this,"onAnsweredElsewhere",(e=>{u.logger.debug("Call "+this.callId+" answered elsewhere"),this.terminate(R.Remote,P.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=null!==(t=e.forceTURN)&&void 0!==t&&t,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const e of this.turnServers)h.checkObjectHasKeys(e,["urls"]);this.callId=U()}async placeVoiceCall(){await this.placeCall(!0,!1)}async placeVideoCall(){await this.placeCall(!0,!0)}createDataChannel(e,t){const r=this.peerConn.createDataChannel(e,t);return this.emit(O.DataChannel,r),r}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(O.State,e,t)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?C.Video:C.Voice}get hasLocalUserMediaVideoTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some((e=>{var t;return e.purpose===p.SDPStreamMetadataPurpose.Usermedia&&(null===(t=e.stream)||void 0===t?void 0:t.getVideoTracks().length)}))}get hasLocalUserMediaAudioTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some((e=>{var t;return e.purpose===p.SDPStreamMetadataPurpose.Usermedia&&!(null===(t=e.stream)||void 0===t||!t.getAudioTracks().length)}))}get hasUserMediaAudioSender(){var e;return Boolean(null===(e=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Usermedia,"audio")))||void 0===e?void 0:e.sender)}get hasUserMediaVideoSender(){var e;return Boolean(null===(e=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===e?void 0:e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find((e=>e.purpose===p.SDPStreamMetadataPurpose.Usermedia))}get localScreensharingFeed(){return this.getLocalFeeds().find((e=>e.purpose===p.SDPStreamMetadataPurpose.Screenshare))}get localUsermediaStream(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}get localScreensharingStream(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find((e=>e.purpose===p.SDPStreamMetadataPurpose.Usermedia))}get remoteScreensharingFeed(){return this.getRemoteFeeds().find((e=>e.purpose===p.SDPStreamMetadataPurpose.Screenshare))}get remoteUsermediaStream(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}get remoteScreensharingStream(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find((t=>t.stream.id===e))}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter((e=>e.isLocal()))}getRemoteFeeds(){return this.feeds.filter((e=>!e.isLocal()))}async initOpponentCrypto(){var e;if(!this.opponentDeviceId)return;if(!this.client.getUseE2eForGroupCall())return;if(!this.client.isCryptoEnabled())return void(this.opponentDeviceInfo=new v.DeviceInfo(this.opponentDeviceId));if(!this.client.crypto)throw new Error("Crypto is not initialised.");const t=this.invitee||(null===(e=this.getOpponentMember())||void 0===e?void 0:e.userId);if(!t)throw new Error("Couldn't find opponent user ID to init crypto");const r=await this.client.crypto.deviceList.downloadKeys([t],!1);if(this.opponentDeviceInfo=r[t][this.opponentDeviceId],void 0===this.opponentDeviceInfo)throw new y.GroupCallUnknownDeviceError(t)}getLocalSDPStreamMetadata(e=!1){const t={};for(const r of this.getLocalFeeds())e&&(r.sdpMetadataStreamId=r.stream.id),t[r.sdpMetadataStreamId]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()};return t}noIncomingFeeds(){return!this.feeds.some((e=>!e.isLocal()))}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata())return void this.pushRemoteFeedWithoutMetadata(e);const t=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,n=this.remoteSDPStreamMetadata[e.id].video_muted;r?this.getFeedByStreamId(e.id)?u.logger.warn(`Ignoring stream with id ${e.id} because we already have a feed for it`):(this.feeds.push(new m.CallFeed({client:this.client,call:this,roomId:this.roomId,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:i,videoMuted:n})),this.emit(O.FeedsChanged,this.feeds),u.logger.info(`Call ${this.callId} pushed remote stream (id="${e.id}", active="${e.active}", purpose=${r})`)):u.logger.warn(`Call ${this.callId} Ignoring stream with id ${e.id} because we didn't get any metadata about it`)}pushRemoteFeedWithoutMetadata(e){var t;const r=this.getOpponentMember().userId,i=p.SDPStreamMetadataPurpose.Usermedia,n=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;n&&e.id!==n.id?u.logger.warn(`Call ${this.callId} Ignoring new stream ID ${e.id}: we already have stream ID ${n.id}`):this.getFeedByStreamId(e.id)?u.logger.warn(`Ignoring stream with id ${e.id} because we already have a feed for it`):(this.feeds.push(new m.CallFeed({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:i})),this.emit(O.FeedsChanged,this.feeds),u.logger.info(`Call ${this.callId} pushed remote stream (id="${e.id}", active="${e.active}")`))}pushNewLocalFeed(e,t,r=!0){const i=this.client.getUserId();F(e.getAudioTracks(),!0),F(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)?u.logger.warn(`Ignoring stream with id ${e.id} because we already have a feed for it`):this.pushLocalFeed(new m.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,deviceId:this.getOpponentDeviceId(),stream:e,purpose:t}),r)}pushLocalFeed(e,t=!0){if(this.feeds.some((t=>e.stream.id===t.stream.id)))u.logger.info(`Ignoring duplicate local stream ${e.stream.id} in call ${this.callId}`);else{if(this.feeds.push(e),t)for(const t of e.stream.getTracks()){u.logger.info(`Call ${this.callId} Adding track (id="${t.id}", kind="${t.kind}", streamId="${e.stream.id}", streamPurpose="${e.purpose}", enabled=${t.enabled}) to peer connection`);const r=j(e.purpose,t.kind);if(this.transceivers.has(r)){const i=this.transceivers.get(r);i.sender.setStreams&&i.sender.setStreams(e.stream),i.sender.replaceTrack(t),i.direction="inactive"===i.direction?"sendonly":"sendrecv"}else{const i=this.peerConn.addTrack(t,e.stream),n=this.peerConn.getTransceivers().find((e=>e.sender===i));n?this.transceivers.set(r,n):u.logger.warn("Didn't find a matching transceiver after adding track!")}}u.logger.info(`Call ${this.callId} Pushed local stream (id="${e.stream.id}", active="${e.stream.active}", purpose="${e.purpose}")`),this.emit(O.FeedsChanged,this.feeds)}}removeLocalFeed(e){const t=j(e.purpose,"audio"),r=j(e.purpose,"video");for(const e of[t,r])if(this.transceivers.has(e)){const t=this.transceivers.get(e);t.sender&&this.peerConn.removeTrack(t.sender)}e.purpose===p.SDPStreamMetadataPurpose.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(const e of this.feeds)e.isLocal()&&this.groupCallId||e.dispose();this.feeds=[],this.emit(O.FeedsChanged,this.feeds)}deleteFeedByStream(e){const t=this.getFeedByStreamId(e.id);t?this.deleteFeed(t):u.logger.warn(`Call ${this.callId} Didn't find the feed with stream id ${e.id} to delete`)}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(O.FeedsChanged,this.feeds)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];return e.forEach((e=>{t.push(e)})),t}async initWithInvite(e){var t;const r=e.getContent();this.direction=T.Inbound;await this.client.checkTurnServers()||u.logger.warn(`Call ${this.callId} Failed to get TURN credentials! Proceeding with call anyway...`);const i=r[p.SDPStreamMetadataKey];i?this.updateRemoteSDPStreamMetadata(i):u.logger.debug(`Call ${this.callId} did not get any SDPStreamMetadata! Can not send/receive multiple streams`),this.peerConn=this.createPeerConnection(),this.chooseOpponent(e),await this.initOpponentCrypto();try{await this.peerConn.setRemoteDescription(r.offer),await this.addBufferedIceCandidates()}catch(e){return u.logger.debug(`Call ${this.callId} failed to set remote description`,e),void this.terminate(R.Local,P.SetRemoteDescription,!1)}const n=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;if(!n||0===n.getTracks().length)return u.logger.error(`Call ${this.callId} no remote stream or no tracks after setting remote description!`),void this.terminate(R.Local,P.SetRemoteDescription,!1);if(this.state=E.Ringing,e.getLocalAge()){const t=setTimeout((()=>{this.state==E.Ringing&&(u.logger.debug(`Call ${this.callId} invite has expired. Hanging up.`),this.hangupParty=R.Remote,this.state=E.Ended,this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(O.Hangup,this))}),r.lifetime-e.getLocalAge()),i=e=>{e!==E.Ringing&&(clearTimeout(t),this.off(O.State,i))};this.on(O.State,i)}}initWithHangup(e){this.state=E.Ended}shouldAnswerWithMediaType(e,t,r){return e&&!t?(u.logger.warn(`Call ${this.callId} Unable to answer with ${r} because the other side isn't sending it either.`),!1):h.isNullOrUndefined(e)||e===t||this.opponentSupportsSDPStreamMetadata()?null!=e?e:t:(u.logger.warn(`Call ${this.callId} Unable to answer with ${r}=${e} because the other side doesn't support it. Answering with ${r}=${t}.`),t)}async answer(e,t){if(!this.inviteOrAnswerSent){if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(this.localUsermediaStream||this.waitForLocalAVStream)this.waitForLocalAVStream&&(this.state=E.WaitLocalMedia);else{const i=this.state,n=this.shouldAnswerWithMediaType(e,this.hasRemoteUserMediaAudioTrack,"audio"),o=this.shouldAnswerWithMediaType(t,this.hasRemoteUserMediaVideoTrack,"video");this.state=E.WaitLocalMedia,this.waitForLocalAVStream=!0;try{var r;const e=await this.client.getMediaHandler().getUserMediaStream(n,o);this.waitForLocalAVStream=!1;const t=[new m.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:null!==(r=this.client.getDeviceId())&&void 0!==r?r:void 0,stream:e,purpose:p.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1})];this.localScreensharingFeed&&t.push(this.localScreensharingFeed),this.answerWithCallFeeds(t)}catch(e){if(!o)return void this.getUserMediaFailed(e);u.logger.warn(`Call ${this.callId} Failed to getUserMedia(), trying to getUserMedia() without video`),this.state=i,this.waitForLocalAVStream=!1,await this.answer(n,!1)}}}}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){u.logger.debug(`Call ${this.callId} replaced by ${e.callId}`),this.state===E.WaitLocalMedia?(u.logger.debug(`Call ${this.callId} telling new call ${e.callId} to wait for local media`),e.waitForLocalAVStream=!0):[E.CreateOffer,E.InviteSent].includes(this.state)&&(e.direction===T.Outbound?e.queueGotCallFeedsForAnswer([]):(u.logger.debug(`Call ${this.callId} handing local stream to new call ${e.callId}`),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map((e=>e.clone()))))),this.successor=e,this.emit(O.Replaced,e),this.hangup(P.Replaced,!0)}hangup(e,t){if(this.callHasEnded())return;if(u.logger.debug(`Ending call ${this.callId} with reason ${e}`),this.terminate(R.Local,e,!t),[E.Fledgling,E.WaitLocalMedia].includes(this.state))return;const r={};(this.opponentVersion&&0!==this.opponentVersion||e!==P.UserHangup)&&(r.reason=e),this.sendVoipEvent(d.EventType.CallHangup,r)}reject(){if(this.state!==E.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return u.logger.info(`Call ${this.callId} Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(P.UserHangup,!0);u.logger.debug("Rejecting call: "+this.callId),this.terminate(R.Local,P.UserHangup,!0),this.sendVoipEvent(d.EventType.CallReject,{})}async upgradeCall(e,t){if((e||t)&&this.opponentSupportsSDPStreamMetadata())try{u.logger.debug(`Upgrading call ${this.callId}: audio?=${e} video?=${t}`);const r=e||this.hasLocalUserMediaAudioTrack,i=t||this.hasLocalUserMediaVideoTrack,n=await this.client.getMediaHandler().getUserMediaStream(r,i,!1);await this.updateLocalUsermediaStream(n,e,t)}catch(e){u.logger.error(`Call ${this.callId} Failed to upgrade the call`,e),this.emit(O.Error,new L(P.NoUserMedia,"Failed to get camera access: ",e))}}opponentSupportsSDPStreamMetadata(){return Boolean(this.remoteSDPStreamMetadata)}isScreensharing(){return Boolean(this.localScreensharingStream)}async setScreensharingEnabled(e,t){if(e&&this.isScreensharing())return u.logger.warn(`Call ${this.callId} There is already a screensharing stream - there is nothing to do!`),!0;if(!e&&!this.isScreensharing())return u.logger.warn(`Call ${this.callId} There already isn't a screensharing stream - there is nothing to do!`),!1;if(!this.opponentSupportsSDPStreamMetadata())return this.setScreensharingEnabledWithoutMetadataSupport(e,t);if(u.logger.debug(`Call ${this.callId} set screensharing enabled? ${e}`),!e){const e=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Screenshare,"audio")),t=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Screenshare,"video"));for(const r of[e,t])r&&r.sender&&this.peerConn.removeTrack(r.sender);return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const e=await this.client.getMediaHandler().getScreensharingStream(t);return!!e&&(this.pushNewLocalFeed(e,p.SDPStreamMetadataPurpose.Screenshare),!0)}catch(e){return u.logger.error(`Call ${this.callId} Failed to get screen-sharing stream:`,e),!1}}async setScreensharingEnabledWithoutMetadataSupport(e,t){if(u.logger.debug(`Call ${this.callId} Set screensharing enabled? ${e} using replaceTrack()`),!e){var r,i;const e=null===(r=this.localUsermediaStream)||void 0===r?void 0:r.getTracks().find((e=>"video"===e.kind)),t=null===(i=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===i?void 0:i.sender;return null==t||t.replaceTrack(null!=e?e:null),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{var n;const e=await this.client.getMediaHandler().getScreensharingStream(t);if(!e)return!1;const r=e.getTracks().find((e=>"video"===e.kind)),i=null===(n=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Usermedia,"video")))||void 0===n?void 0:n.sender;return null==i||i.replaceTrack(null!=r?r:null),this.pushNewLocalFeed(e,p.SDPStreamMetadataPurpose.Screenshare,!1),!0}catch(e){return u.logger.error(`Call ${this.callId} Failed to get screen-sharing stream:`,e),!1}}async updateLocalUsermediaStream(e,t=!1,r=!1){const i=this.localUsermediaFeed,n=t||!i.isAudioMuted()&&!this.remoteOnHold,o=r||!i.isVideoMuted()&&!this.remoteOnHold;u.logger.log(`call ${this.callId} updateLocalUsermediaStream stream ${e.id} audioEnabled ${n} videoEnabled ${o}`),F(e.getAudioTracks(),n),F(e.getVideoTracks(),o);for(const e of this.localUsermediaStream.getTracks())this.localUsermediaStream.removeTrack(e),e.stop();for(const t of e.getTracks())this.localUsermediaStream.addTrack(t);for(const t of e.getTracks()){const r=j(p.SDPStreamMetadataPurpose.Usermedia,t.kind),n=this.transceivers.get(r),o=null==n?void 0:n.sender;let s=!1;if(o)try{u.logger.info(`Call ${this.callId} Replacing track (id="${t.id}", kind="${t.kind}", streamId="${e.id}", streamPurpose="${i.purpose}") to peer connection`),await o.replaceTrack(t),n.direction="inactive"===n.direction?"sendonly":"sendrecv",s=!0}catch(e){u.logger.warn("replaceTrack failed: adding new transceiver instead",e)}if(!s){u.logger.info(`Call ${this.callId} Adding track (id="${t.id}", kind="${t.kind}", streamId="${e.id}", streamPurpose="${i.purpose}") to peer connection`);const n=this.peerConn.addTrack(t,this.localUsermediaStream),o=this.peerConn.getTransceivers().find((e=>e.sender===n));o?this.transceivers.set(r,o):u.logger.warn("Couldn't find matching transceiver for newly added track!")}}}async setLocalVideoMuted(e){var t;if(u.logger.log(`call ${this.callId} setLocalVideoMuted ${e}`),e||void 0===this.stopVideoTrackTimer||(clearTimeout(this.stopVideoTrackTimer),this.stopVideoTrackTimer=void 0),!await this.client.getMediaHandler().hasVideoDevice())return this.isLocalVideoMuted();if(!this.hasUserMediaVideoSender&&!e)return await this.upgradeCall(!1,!0),this.isLocalVideoMuted();if(!e&&0===this.localUsermediaStream.getVideoTracks().length){const e=await this.client.getMediaHandler().getUserMediaStream(!0,!0);await this.updateLocalUsermediaStream(e)}return null===(t=this.localUsermediaFeed)||void 0===t||t.setAudioVideoMuted(null,e),this.updateMuteStatus(),await this.sendMetadataUpdate(),e&&(this.stopVideoTrackTimer=setTimeout((()=>{for(const e of this.localUsermediaStream.getVideoTracks())e.stop(),this.localUsermediaStream.removeTrack(e)}),120)),this.isLocalVideoMuted()}isLocalVideoMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())&&void 0!==e&&e}async setMicrophoneMuted(e){var t;return u.logger.log(`call ${this.callId} setMicrophoneMuted ${e}`),await this.client.getMediaHandler().hasAudioDevice()?e||this.hasUserMediaAudioSender&&this.hasLocalUserMediaAudioTrack?(null===(t=this.localUsermediaFeed)||void 0===t||t.setAudioVideoMuted(e,null),this.updateMuteStatus(),await this.sendMetadataUpdate(),this.isMicrophoneMuted()):(await this.upgradeCall(!0,!1),this.isMicrophoneMuted()):this.isMicrophoneMuted()}isMicrophoneMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isAudioMuted())&&void 0!==e&&e}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(const t of this.peerConn.getTransceivers())t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(O.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==E.Connected)return!1;let e=!0;for(const t of this.peerConn.getTransceivers()){["inactive","recvonly"].includes(t.currentDirection)||(e=!1)}return e}sendDtmfDigit(e){for(const r of this.peerConn.getSenders()){var t;if("audio"===(null===(t=r.track)||void 0===t?void 0:t.kind)&&r.dtmf)return void r.dtmf.insertDTMF(e)}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){const e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;u.logger.log(`call ${this.callId} updateMuteStatus stream ${this.localUsermediaStream.id} micShouldBeMuted ${e} vidShouldBeMuted ${t}`),F(this.localUsermediaStream.getAudioTracks(),!e),F(this.localUsermediaStream.getVideoTracks(),!t)}async sendMetadataUpdate(){await this.sendVoipEvent(d.EventType.CallSDPStreamMetadataChangedPrefix,{[p.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()})}gotCallFeedsForInvite(e,t=!1){if(this.successor)this.successor.queueGotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{for(const t of e)this.pushLocalFeed(t);t&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=E.CreateOffer,u.logger.debug(`Call ${this.callId} gotUserMediaForInvite`)}}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type},[p.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata(!0)};e.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1};const t=this.discardDuplicateCandidates();u.logger.info(`Call ${this.callId} Discarding ${t} candidates that will be sent in answer`);try{await this.sendVoipEvent(d.EventType.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(e){this.state=E.Ringing,e instanceof b.MatrixError&&e.event&&this.client.cancelPendingEvent(e.event);let t=P.SendAnswer,r="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=P.UnknownDevices,r="Unknown devices present in the room"),this.emit(O.Error,new L(t,r,e)),e}this.sendCandidateQueue()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((()=>this.gotCallFeedsForAnswer(e))):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,t){const r=(0,l.parse)(e.sdp);r.media.forEach((e=>{const r=new Map,i=new Map;for(const t of e.rtp)r.set(t.payload,t.codec),i.set(t.codec,t.payload);for(const n of t){if(n.mediaType!==e.type)continue;if(!i.has(n.codec)){u.logger.info(`Ignoring SDP modifications for ${n.codec} as it's not present.`);continue}const t=[];void 0!==n.enableDtx&&t.push("usedtx="+(n.enableDtx?"1":"0")),void 0!==n.maxAverageBitrate&&t.push(`maxaveragebitrate=${n.maxAverageBitrate}`);let o=!1;for(const i of e.fmtp)r.get(i.payload)===n.codec&&(o=!0,i.config+=";"+t.join(";"));o||e.fmtp.push({payload:i.get(n.codec),config:t.join(";")})}})),e.sdp=(0,l.write)(r)}async createOffer(){const e=await this.peerConn.createOffer();return this.mungeSdp(e,N(this.isPtt)),e}async createAnswer(){const e=await this.peerConn.createAnswer();return this.mungeSdp(e,N(this.isPtt)),e}async gotCallFeedsForAnswer(e){if(this.callHasEnded())return;this.waitForLocalAVStream=!1;for(const t of e)this.pushLocalFeed(t);let t;this.state=E.CreateAnswer;try{this.getRidOfRTXCodecs(),t=await this.createAnswer()}catch(e){return u.logger.debug(`Call ${this.callId} Failed to create answer: `,e),void this.terminate(R.Local,P.CreateAnswer,!0)}try{if(await this.peerConn.setLocalDescription(t),this.callHasEnded())return;if(this.state=E.Connecting,await new Promise((e=>{setTimeout(e,200)})),this.callHasEnded())return;this.sendAnswer()}catch(e){return u.logger.debug(`Call ${this.callId} Error setting local description!`,e),void this.terminate(R.Local,P.SetLocalDescription,!0)}}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent(),r=t.candidates;if(!r)return void u.logger.info(`Call ${this.callId} Ignoring candidates event with no candidates!`);const i=0===t.version?null:t.party_id||null;if(void 0!==this.opponentPartyId)this.partyIdMatches(t)?await this.addIceCandidates(r):u.logger.info(`Call ${this.callId} Ignoring candidates from party ID ${t.party_id}: we have chosen party ID ${this.opponentPartyId}`);else if(i){u.logger.info(`Call ${this.callId} Buffering ${r.length} candidates until we pick an opponent`);const e=this.remoteCandidateBuffer.get(i)||[];e.push(...r),this.remoteCandidateBuffer.set(i,e)}}async onAnswerReceived(e){const t=e.getContent();if(u.logger.debug(`Got answer for call ID ${this.callId} from party ID ${t.party_id}`),this.callHasEnded())return void u.logger.debug(`Ignoring answer because call ID ${this.callId} has ended`);if(void 0!==this.opponentPartyId)return void u.logger.info(`Call ${this.callId} Ignoring answer from party ID ${t.party_id}: we already have an answer/reject from ${this.opponentPartyId}`);this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.state=E.Connecting;const r=t[p.SDPStreamMetadataKey];r?this.updateRemoteSDPStreamMetadata(r):u.logger.warn(`Call ${this.callId} Did not get any SDPStreamMetadata! Can not send/receive multiple streams`);try{await this.peerConn.setRemoteDescription(t.answer)}catch(e){return u.logger.debug(`Call ${this.callId} Failed to set remote description`,e),void this.terminate(R.Local,P.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{await this.sendVoipEvent(d.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(e){u.logger.warn(`Call ${this.callId} Failed to send select_answer event`,e)}}async onSelectAnswerReceived(e){if(this.direction!==T.Inbound)return void u.logger.warn(`Call ${this.callId} Got select_answer for an outbound call: ignoring`);const t=e.getContent().selected_party_id;null!=t?t!==this.ourPartyId&&(u.logger.info(`Call ${this.callId} Got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),await this.terminate(R.Remote,P.AnsweredElsewhere,!0)):u.logger.warn(`Call ${this.callId} Got nonsensical select_answer with null/undefined selected_party_id: ignoring`)}async onNegotiateReceived(e){const t=e.getContent(),r=t.description;if(!r||!r.sdp||!r.type)return void u.logger.info(`Call ${this.callId} Ignoring invalid m.call.negotiate event`);const i=this.direction===T.Inbound,n="offer"===r.type&&(this.makingOffer||"stable"!==this.peerConn.signalingState);if(this.ignoreOffer=!i&&n,this.ignoreOffer)return void u.logger.info(`Call ${this.callId} Ignoring colliding negotiate event because we're impolite`);const o=this.isLocalOnHold(),s=t[p.SDPStreamMetadataKey];s?this.updateRemoteSDPStreamMetadata(s):u.logger.warn(`Call ${this.callId} Received negotiation event without SDPStreamMetadata!`);try{if(await this.peerConn.setRemoteDescription(r),"offer"===r.type){var a;let e;try{this.getRidOfRTXCodecs(),e=await this.createAnswer()}catch(e){return u.logger.debug(`Call ${this.callId} Failed to create answer: `,e),void this.terminate(R.Local,P.CreateAnswer,!0)}await this.peerConn.setLocalDescription(e),this.sendVoipEvent(d.EventType.CallNegotiate,{description:null===(a=this.peerConn.localDescription)||void 0===a?void 0:a.toJSON(),[p.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata(!0)})}}catch(e){u.logger.warn(`Call ${this.callId} Failed to complete negotiation`,e)}const c=this.isLocalOnHold();o!==c&&(this.emit(O.LocalHoldUnhold,c),this.emit(O.HoldUnhold,c))}updateRemoteSDPStreamMetadata(e){this.remoteSDPStreamMetadata=h.recursivelyAssign(this.remoteSDPStreamMetadata||{},e,!0);for(const e of this.getRemoteFeeds()){var t;const r=e.stream.id,i=this.remoteSDPStreamMetadata[r];e.setAudioVideoMuted(null==i?void 0:i.audio_muted,null==i?void 0:i.video_muted),e.purpose=null===(t=this.remoteSDPStreamMetadata[r])||void 0===t?void 0:t.purpose}}onSDPStreamMetadataChangedReceived(e){const t=e.getContent()[p.SDPStreamMetadataKey];this.updateRemoteSDPStreamMetadata(t)}async onAssertedIdentityReceived(e){const t=e.getContent();t.asserted_identity&&(this.remoteAssertedIdentity={id:t.asserted_identity.id,displayName:t.asserted_identity.display_name},this.emit(O.AssertedIdentityChanged))}callHasEnded(){return this.state===E.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((()=>this.wrappedGotLocalOffer())):this.responsePromiseChain=this.wrappedGotLocalOffer()}async wrappedGotLocalOffer(){this.makingOffer=!0;try{await this.gotLocalOffer()}catch(e){return void this.getLocalOfferFailed(e)}finally{this.makingOffer=!1}}async gotLocalOffer(){if(u.logger.debug(`Call ${this.callId} Setting local description`),this.callHasEnded())return void u.logger.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");let e;try{this.getRidOfRTXCodecs(),e=await this.createOffer()}catch(e){return u.logger.debug(`Call ${this.callId} Failed to create offer: `,e),void this.terminate(R.Local,P.CreateOffer,!0)}try{await this.peerConn.setLocalDescription(e)}catch(e){return u.logger.debug(`Call ${this.callId} Error setting local description!`,e),void this.terminate(R.Local,P.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&await new Promise((e=>{setTimeout(e,200)})),this.callHasEnded())return;const t=this.state===E.CreateOffer?d.EventType.CallInvite:d.EventType.CallNegotiate,r={lifetime:6e4};var i,n;(t===d.EventType.CallInvite&&this.invitee&&(r.invitee=this.invitee),this.state===E.CreateOffer)?r.offer=null===(i=this.peerConn.localDescription)||void 0===i?void 0:i.toJSON():r.description=null===(n=this.peerConn.localDescription)||void 0===n?void 0:n.toJSON();r.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},r[p.SDPStreamMetadataKey]=this.getLocalSDPStreamMetadata(!0);const o=this.discardDuplicateCandidates();u.logger.info(`Call ${this.callId} Discarding ${o} candidates that will be sent in offer`);try{await this.sendVoipEvent(t,r)}catch(e){u.logger.error(`Call ${this.callId} Failed to send invite`,e),e instanceof b.MatrixError&&e.event&&this.client.cancelPendingEvent(e.event);let t=P.SignallingFailed,r="Signalling failed";return this.state===E.CreateOffer&&(t=P.SendInvite,r="Failed to send invite"),"UnknownDeviceError"==e.name&&(t=P.UnknownDevices,r="Unknown devices present in the room"),this.emit(O.Error,new L(t,r,e)),void this.terminate(R.Local,t,!1)}this.sendCandidateQueue(),this.state===E.CreateOffer&&(this.inviteOrAnswerSent=!0,this.state=E.InviteSent,this.inviteTimeout=setTimeout((()=>{this.inviteTimeout=void 0,this.state===E.InviteSent&&this.hangup(P.InviteTimeout,!1)}),6e4))}getRidOfRTXCodecs(){if(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)return;const e=RTCRtpReceiver.getCapabilities("video").codecs,t=[...RTCRtpSender.getCapabilities("video").codecs,...e];for(const e of t)if("video/rtx"===e.mimeType){const r=t.indexOf(e);t.splice(r,1)}const r=this.transceivers.get(j(p.SDPStreamMetadataPurpose.Screenshare,"video"));r&&r.setCodecPreferences(t)}async sendVoipEvent(e,t){const r=Object.assign({},t,{version:"1",call_id:this.callId,party_id:this.ourPartyId,conf_id:this.groupCallId});if(this.opponentDeviceId){var i;const t=this.toDeviceSeq++,n=S(S({},r),{},{device_id:this.client.deviceId,sender_session_id:this.client.getSessionId(),dest_session_id:this.opponentSessionId,seq:t,[d.ToDeviceMessageId]:(0,c.default)()});this.emit(O.SendVoipEvent,{type:"toDevice",eventType:e,userId:this.invitee||(null===(i=this.getOpponentMember())||void 0===i?void 0:i.userId),opponentDeviceId:this.opponentDeviceId,content:n});const o=this.invitee||this.getOpponentMember().userId;if(this.client.getUseE2eForGroupCall()){if(!this.opponentDeviceInfo)return void u.logger.warn(`Call ${this.callId} sendVoipEvent() failed: we do not have opponentDeviceInfo`);await this.client.encryptAndSendToDevices([{userId:o,deviceInfo:this.opponentDeviceInfo}],{type:e,content:n})}else await this.client.sendToDevice(e,{[o]:{[this.opponentDeviceId]:n}})}else{var n;this.emit(O.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:this.roomId,content:r,userId:this.invitee||(null===(n=this.getOpponentMember())||void 0===n?void 0:n.userId)}),await this.client.sendEvent(this.roomId,e,r)}}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state===E.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===T.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}discardDuplicateCandidates(){let e=0;const t=[];for(let r=0;r<this.candidateSendQueue.length;r++){const i=this.candidateSendQueue[r];""===i.candidate?t.push(i):e++}return this.candidateSendQueue=t,e}async transfer(e){const t=await this.client.getProfileInfo(e),r=U(),i={replacement_id:U(),target_user:{id:e,display_name:t.displayname,avatar_url:t.avatar_url},create_call:r};await this.sendVoipEvent(d.EventType.CallReplaces,i),await this.terminate(R.Local,P.Transferred,!0)}async transferToCall(e){var t,r;const i=null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId,n=i?await this.client.getProfileInfo(i):void 0,o=null===(r=this.getOpponentMember())||void 0===r?void 0:r.userId,s=o?await this.client.getProfileInfo(o):void 0,a=U(),c={replacement_id:U(),target_user:{id:o,display_name:null==s?void 0:s.displayname,avatar_url:null==s?void 0:s.avatar_url},await_call:a};await e.sendVoipEvent(d.EventType.CallReplaces,c);const l={replacement_id:U(),target_user:{id:i,display_name:null==n?void 0:n.displayname,avatar_url:null==n?void 0:n.avatar_url},create_call:a};await this.sendVoipEvent(d.EventType.CallReplaces,l),await this.terminate(R.Local,P.Transferred,!0),await e.terminate(R.Local,P.Transferred,!0)}async terminate(e,t,r){if(!this.callHasEnded()){this.hangupParty=e,this.hangupReason=t,this.state=E.Ended,this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=void 0),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=void 0),void 0!==this.stopVideoTrackTimer&&(clearTimeout(this.stopVideoTrackTimer),this.stopVideoTrackTimer=void 0);for(const[e,t]of this.removeTrackListeners)e.removeEventListener("removetrack",t);this.removeTrackListeners.clear(),this.callStatsAtEnd=await this.collectCallStats(),this.stopAllMedia(),this.deleteAllFeeds(),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),r&&this.emit(O.Hangup,this),this.client.callEventHandler.calls.delete(this.callId)}}stopAllMedia(){u.logger.debug(`Call ${this.callId} stopping all media`);for(const e of this.feeds)if(e.isLocal()&&e.purpose===p.SDPStreamMetadataPurpose.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===p.SDPStreamMetadataPurpose.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal()){u.logger.debug("Stopping remote stream",e.stream.id);for(const t of e.stream.getTracks())t.stop()}}checkForErrorListener(){if(0===this.listeners(g.EventEmitterEvents.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(0===this.candidateSendQueue.length||this.callHasEnded())return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e.map((e=>e.toJSON()))};this.candidatesEnded&&t.candidates.push({candidate:""}),u.logger.debug(`Call ${this.callId} attempting to send ${e.length} candidates`);try{await this.sendVoipEvent(d.EventType.CallCandidates,t),this.candidateSendTries=0,this.sendCandidateQueue()}catch(t){if(t instanceof b.MatrixError&&t.event&&this.client.cancelPendingEvent(t.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){u.logger.debug(`Call ${this.callId} failed to send candidates on attempt ${this.candidateSendTries}. Giving up on this call.`,t);const e=P.SignallingFailed,r="Signalling failed";return this.emit(O.Error,new L(e,r,t)),void this.hangup(e,!1)}const r=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,u.logger.debug(`Call ${this.callId} failed to send candidates. Retrying in ${r}ms`,t),setTimeout((()=>{this.sendCandidateQueue()}),r)}}async placeCall(e,t){if(!e)throw new Error("You CANNOT start a call without audio");this.state=E.WaitLocalMedia;try{var r;const i=await this.client.getMediaHandler().getUserMediaStream(e,t);F(i.getAudioTracks(),!0),F(i.getVideoTracks(),!0);const n=new m.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:null!==(r=this.client.getDeviceId())&&void 0!==r?r:void 0,stream:i,purpose:p.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1});await this.placeCallWithCallFeeds([n])}catch(e){return void this.getUserMediaFailed(e)}}async placeCallWithCallFeeds(e,t=!1){this.checkForErrorListener(),this.direction=T.Outbound,await this.initOpponentCrypto(),this.client.callEventHandler.calls.set(this.callId,this);await this.client.checkTurnServers()||u.logger.warn(`Call ${this.callId} Failed to get TURN credentials! Proceeding with call anyway...`),this.peerConn=this.createPeerConnection(),this.gotCallFeedsForInvite(e,t)}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel),e}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){var t;const r=e.getContent();u.logger.debug(`Call ${this.callId} choosing opponent party ID ${r.party_id}`),this.opponentVersion=r.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=null!==(t=this.client.getRoom(this.roomId).getMember(e.getSender()))&&void 0!==t?t:void 0}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(u.logger.info(`Call ${this.callId} Adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer.clear()}async addIceCandidates(e){for(const t of e){null!==t.sdpMid&&void 0!==t.sdpMid||null!==t.sdpMLineIndex&&void 0!==t.sdpMLineIndex?u.logger.debug(`Call ${this.callId} got remote ICE ${t.sdpMid} candidate: ${t.candidate}`):u.logger.debug(`Call ${this.callId} got remote ICE end-of-candidates`);try{await this.peerConn.addIceCandidate(t)}catch(e){this.ignoreOffer||u.logger.info(`Call ${this.callId} failed to add remote ICE candidate`,e)}}}get hasPeerConnection(){return Boolean(this.peerConn)}}function F(e,t){for(const r of e)r.enabled=t}function K(){if("undefined"==typeof window||"undefined"==typeof document)return!1;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return u.logger.error("WebRTC is not supported in this browser / environment"),!1}catch(e){return u.logger.error("Exception thrown when trying to access WebRTC",e),!1}return!0}e.exports.MatrixCall=B})),i.register("73W4W",(function(t,r){e(t.exports,"default",(()=>a));var n=i("d3qaP"),o=i("eFqSf"),s=i("5DHxf");var a=function(e,t,r){if(n.default.randomUUID&&!t&&!e)return n.default.randomUUID();const i=(e=e||{}).random||(e.rng||o.default)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return(0,s.unsafeStringify)(i)}})),i.register("d3qaP",(function(t,r){e(t.exports,"default",(()=>i));var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}})),i.register("eFqSf",(function(t,r){let i;e(t.exports,"default",(()=>o));const n=new Uint8Array(16);function o(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)}})),i.register("5DHxf",(function(t,r){e(t.exports,"unsafeStringify",(()=>o));i("iF3BK");const n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function o(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}})),i.register("iF3BK",(function(t,r){e(t.exports,"default",(()=>o));var n=i("irwvd");var o=function(e){return"string"==typeof e&&n.default.test(e)}})),i.register("irwvd",(function(t,r){e(t.exports,"default",(()=>i));var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i})),i.register("aMgXf",(function(t,r){var n,o;e(t.exports,"write",(()=>n),(e=>n=e)),e(t.exports,"parse",(()=>o),(e=>o=e));var s=i("gfTRt"),a=i("SgRgx");n=a,o=s.parse,s.parseParams,s.parseFmtpConfig,s.parsePayloads,s.parseRemoteCandidates,s.parseImageAttributes,s.parseSimulcastStreamList})),i.register("gfTRt",(function(t,r){var n,o,s,a,c,l,u;e(t.exports,"parse",(()=>n),(e=>n=e)),e(t.exports,"parseParams",(()=>o),(e=>o=e)),e(t.exports,"parseFmtpConfig",(()=>s),(e=>s=e)),e(t.exports,"parsePayloads",(()=>a),(e=>a=e)),e(t.exports,"parseRemoteCandidates",(()=>c),(e=>c=e)),e(t.exports,"parseImageAttributes",(()=>l),(e=>l=e)),e(t.exports,"parseSimulcastStreamList",(()=>u),(e=>u=e));var h=function(e){return String(Number(e))===e?Number(e):e},d=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var n=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=h(e[1]);else for(var n=0;n<r.length;n+=1)null!=e[n+1]&&(t[r[n]]=h(e[n+1]))}(r.match(e.reg),n,e.names,e.name),e.push&&t[e.push].push(n)},f=i("aA8jw"),p=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n=function(e){var t={},r=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(p).forEach((function(e){var t=e[0],n=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),i=r[r.length-1]);for(var o=0;o<(f[t]||[]).length;o+=1){var s=f[t][o];if(s.reg.test(n))return d(s,i,n)}})),t.media=r,t};var m=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=h(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};s=o=function(e){return e.split(/;\s?/).reduce(m,{})},a=function(e){return e.toString().split(" ").map(Number)},c=function(e){for(var t=[],r=e.split(" ").map(h),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},l=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(m,{})}))},u=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=h(e):(t=h(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}})),i.register("aA8jw",(function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),i.register("SgRgx",(function(e,t){var r=i("aA8jw"),n=/%[sdv%]/g,o=function(e){var t=1,r=arguments,i=r.length;return e.replace(n,(function(e){if(t>=i)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},s=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var s=t.names[n];t.name?i.push(r[t.name][s]):i.push(r[t.names[n]])}else i.push(r[t.name]);return o.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var i=t.outerOrder||a,n=t.innerOrder||c,o=[];return i.forEach((function(t){r[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(s(t,r,e))}))}))})),e.media.forEach((function(e){o.push(s("m",r.m[0],e)),n.forEach((function(t){r[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(s(t,r,e))}))}))}))})),o.join("\r\n")+"\r\n"}})),i.register("863Vm",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.randomLowercaseString=function(e){return o(e,r)},e.exports.randomString=function(e){return o(e,i+r+n)},e.exports.randomUppercaseString=function(e){return o(e,i)};const r="abcdefghijklmnopqrstuvwxyz",i="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n="0123456789";function o(e,t){let r="";for(let i=0;i<e;++i)r+=t.charAt(Math.floor(Math.random()*t.length));return r}})),i.register("bR689",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SDPStreamMetadataPurpose=e.exports.SDPStreamMetadataKey=void 0;let r;var i;e.exports.SDPStreamMetadataKey="org.matrix.msc3077.sdp_stream_metadata",e.exports.SDPStreamMetadataPurpose=r,(i=r||(e.exports.SDPStreamMetadataPurpose=r={})).Usermedia="m.usermedia",i.Screenshare="m.screenshare"})),i.register("bM1pu",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SPEAKING_THRESHOLD=e.exports.CallFeedEvent=e.exports.CallFeed=void 0;var n=r(i("3EUCw")),o=i("bR689"),s=i("gPzVG"),a=i("gEWrD"),c=i("75Qdj"),l=i("7L16h");e.exports.SPEAKING_THRESHOLD=-60;let u;var h;e.exports.CallFeedEvent=u,(h=u||(e.exports.CallFeedEvent=u={})).NewStream="new_stream",h.MuteStateChanged="mute_state_changed",h.LocalVolumeChanged="local_volume_changed",h.VolumeChanged="volume_changed",h.ConnectedChanged="connected_changed",h.Speaking="speaking",h.Disposed="disposed";class d extends c.TypedEventEmitter{constructor(e){super(),(0,n.default)(this,"stream",void 0),(0,n.default)(this,"sdpMetadataStreamId",void 0),(0,n.default)(this,"userId",void 0),(0,n.default)(this,"deviceId",void 0),(0,n.default)(this,"purpose",void 0),(0,n.default)(this,"speakingVolumeSamples",void 0),(0,n.default)(this,"client",void 0),(0,n.default)(this,"call",void 0),(0,n.default)(this,"roomId",void 0),(0,n.default)(this,"audioMuted",void 0),(0,n.default)(this,"videoMuted",void 0),(0,n.default)(this,"localVolume",1),(0,n.default)(this,"measuringVolumeActivity",!1),(0,n.default)(this,"audioContext",void 0),(0,n.default)(this,"analyser",void 0),(0,n.default)(this,"frequencyBinCount",void 0),(0,n.default)(this,"speakingThreshold",-60),(0,n.default)(this,"speaking",!1),(0,n.default)(this,"volumeLooperTimeout",void 0),(0,n.default)(this,"_disposed",!1),(0,n.default)(this,"_connected",!1),(0,n.default)(this,"onAddTrack",(()=>{this.emit(u.NewStream,this.stream)})),(0,n.default)(this,"onCallState",(e=>{e===l.CallState.Connected?this.connected=!0:e===l.CallState.Connecting&&(this.connected=!1)})),(0,n.default)(this,"volumeLooper",(()=>{if(!this.analyser)return;if(!this.measuringVolumeActivity)return;this.analyser.getFloatFrequencyData(this.frequencyBinCount);let e=-1/0;for(const t of this.frequencyBinCount)t>e&&(e=t);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(e),this.emit(u.VolumeChanged,e);let t=!1;for(const e of this.speakingVolumeSamples)if(e>this.speakingThreshold){t=!0;break}this.speaking!==t&&(this.speaking=t,this.emit(u.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,200)})),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(8).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(l.CallEvent.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(u.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){t!==e&&(e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?this.initVolumeMeasuring():this.measureVolumeActivity(!1),this.emit(u.NewStream,this.stream))}initVolumeMeasuring(){if(!this.hasAudioTrack)return;this.audioContext||(this.audioContext=(0,s.acquireContext)()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1;this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount)}getMember(){var e;const t=this.client.getRoom(this.roomId);return null!==(e=null==t?void 0:t.getMember(this.userId))&&void 0!==e?e:null}isLocal(){return this.userId===this.client.getUserId()&&(void 0===this.deviceId||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,t){null!==e&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),null!==t&&(this.videoMuted=t),this.emit(u.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(u.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){const e=this.client.getMediaHandler(),t=this.stream.clone();return a.logger.log(`callFeed cloning stream ${this.stream.id} newStream ${t.id}`),this.purpose===o.SDPStreamMetadataPurpose.Usermedia?e.userMediaStreams.push(t):e.screensharingStreams.push(t),new d({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:t,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,t;clearTimeout(this.volumeLooperTimeout),null===(e=this.stream)||void 0===e||e.removeEventListener("addtrack",this.onAddTrack),null===(t=this.call)||void 0===t||t.removeListener(l.CallEvent.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,(0,s.releaseContext)()),this._disposed=!0,this.emit(u.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(u.LocalVolumeChanged,e)}}e.exports.CallFeed=d})),i.register("gPzVG",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.releaseContext=e.exports.acquireContext=void 0;let r=null,i=0;e.exports.acquireContext=()=>(null===r&&(r=new AudioContext),i++,r);e.exports.releaseContext=()=>{var e;(i--,0===i)&&(null===(e=r)||void 0===e||e.close(),r=null)}})),i.register("iN8Ss",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DeviceInfo=void 0;var n,o,s=r(i("3EUCw"));(o=n||(n={}))[o.Blocked=-1]="Blocked",o[o.Unverified=0]="Unverified",o[o.Verified=1]="Verified";class a{static fromStorage(e,t){const r=new a(t);for(const t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}constructor(e){this.deviceId=e,(0,s.default)(this,"algorithms",[]),(0,s.default)(this,"keys",{}),(0,s.default)(this,"verified",n.Unverified),(0,s.default)(this,"known",!1),(0,s.default)(this,"unsigned",{}),(0,s.default)(this,"signatures",{})}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==n.Blocked}isVerified(){return this.verified==n.Verified}isUnverified(){return this.verified==n.Unverified}isKnown(){return!0===this.known}}e.exports.DeviceInfo=a,(0,s.default)(a,"DeviceVerification",{VERIFIED:n.Verified,UNVERIFIED:n.Unverified,BLOCKED:n.Blocked})})),i.register("hadDF",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.OtherUserSpeakingError=e.exports.GroupCallUnknownDeviceError=e.exports.GroupCallType=e.exports.GroupCallTerminationReason=e.exports.GroupCallState=e.exports.GroupCallIntent=e.exports.GroupCallEvent=e.exports.GroupCallErrorCode=e.exports.GroupCallError=e.exports.GroupCall=void 0;var n=r(i("3EUCw")),o=i("75Qdj"),s=i("bM1pu"),a=i("7L16h"),c=i("l2mJP"),l=i("gEWrD"),u=i("eu84r"),h=i("bR689"),d=i("ldT3p"),f=i("3Aotm"),p=i("gokP2"),m=i("gjhRv");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let y;var b;let w;var _;let S;let E;var M;let C;var I;e.exports.GroupCallIntent=y,(b=y||(e.exports.GroupCallIntent=y={})).Ring="m.ring",b.Prompt="m.prompt",b.Room="m.room",e.exports.GroupCallType=w,(_=w||(e.exports.GroupCallType=w={})).Video="m.video",_.Voice="m.voice",e.exports.GroupCallTerminationReason=S,(S||(e.exports.GroupCallTerminationReason=S={})).CallEnded="call_ended",e.exports.GroupCallEvent=E,(M=E||(e.exports.GroupCallEvent=E={})).GroupCallStateChanged="group_call_state_changed",M.ActiveSpeakerChanged="active_speaker_changed",M.CallsChanged="calls_changed",M.UserMediaFeedsChanged="user_media_feeds_changed",M.ScreenshareFeedsChanged="screenshare_feeds_changed",M.LocalScreenshareStateChanged="local_screenshare_state_changed",M.LocalMuteStateChanged="local_mute_state_changed",M.ParticipantsChanged="participants_changed",M.Error="error",e.exports.GroupCallErrorCode=C,(I=C||(e.exports.GroupCallErrorCode=C={})).NoUserMedia="no_user_media",I.UnknownDevice="unknown_device",I.PlaceCallFailed="place_call_failed";class T extends Error{constructor(e,t,r){r?(super(t+": "+r),(0,n.default)(this,"code",void 0)):(super(t),(0,n.default)(this,"code",void 0)),this.code=e}}e.exports.GroupCallError=T;e.exports.GroupCallUnknownDeviceError=class extends T{constructor(e){super(C.UnknownDevice,"No device found for "+e),this.userId=e}};class k extends Error{constructor(){super("Cannot unmute: another user is speaking")}}let R;var x;e.exports.OtherUserSpeakingError=k,e.exports.GroupCallState=R,(x=R||(e.exports.GroupCallState=R={})).LocalCallFeedUninitialized="local_call_feed_uninitialized",x.InitializingLocalCallFeed="initializing_local_call_feed",x.LocalCallFeedInitialized="local_call_feed_initialized",x.Entered="entered",x.Ended="ended";const O=36e5;function A(e){var t;return(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId)||e.invitee||null}class P extends o.TypedEventEmitter{constructor(e,t,r,i,o,h,f,p){var m,g;super(),this.client=e,this.room=t,this.type=r,this.isPtt=i,this.intent=o,this.dataChannelsEnabled=f,this.dataChannelOptions=p,(0,n.default)(this,"activeSpeakerInterval",1e3),(0,n.default)(this,"retryCallInterval",5e3),(0,n.default)(this,"participantTimeout",15e3),(0,n.default)(this,"pttMaxTransmitTime",2e4),(0,n.default)(this,"activeSpeaker",void 0),(0,n.default)(this,"localCallFeed",void 0),(0,n.default)(this,"localScreenshareFeed",void 0),(0,n.default)(this,"localDesktopCapturerSourceId",void 0),(0,n.default)(this,"userMediaFeeds",[]),(0,n.default)(this,"screenshareFeeds",[]),(0,n.default)(this,"groupCallId",void 0),(0,n.default)(this,"calls",new Map),(0,n.default)(this,"callHandlers",new Map),(0,n.default)(this,"activeSpeakerLoopInterval",void 0),(0,n.default)(this,"retryCallLoopInterval",void 0),(0,n.default)(this,"retryCallCounts",new Map),(0,n.default)(this,"reEmitter",void 0),(0,n.default)(this,"transmitTimer",null),(0,n.default)(this,"participantsExpirationTimer",null),(0,n.default)(this,"resendMemberStateTimer",null),(0,n.default)(this,"initWithAudioMuted",!1),(0,n.default)(this,"initWithVideoMuted",!1),(0,n.default)(this,"initCallFeedPromise",void 0),(0,n.default)(this,"_state",R.LocalCallFeedUninitialized),(0,n.default)(this,"_participants",new Map),(0,n.default)(this,"_creationTs",null),(0,n.default)(this,"_enteredViaAnotherSession",!1),(0,n.default)(this,"onIncomingCall",(e=>{var t,r;if(e.roomId!==this.room.roomId)return;if(e.state!==a.CallState.Ringing)return void l.logger.warn("Incoming call no longer in ringing state. Ignoring.");if(!e.groupCallId||e.groupCallId!==this.groupCallId)return l.logger.log(`Incoming call with groupCallId ${e.groupCallId} ignored because it doesn't match the current group call`),void e.reject();const i=null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId;if(void 0===i)return void l.logger.warn("Incoming call with no member. Ignoring.");const n=null!==(r=this.calls.get(i))&&void 0!==r?r:new Map,o=n.get(e.getOpponentDeviceId());(null==o?void 0:o.callId)!==e.callId&&(l.logger.log(`GroupCall: incoming call from ${i} with ID ${e.callId}`),o&&this.disposeCall(o,a.CallErrorCode.Replaced),this.initCall(e),e.answerWithCallFeeds(this.getLocalFeeds().map((e=>e.clone()))),n.set(e.getOpponentDeviceId(),e),this.calls.set(i,n),this.emit(E.CallsChanged,this.calls))})),(0,n.default)(this,"onRetryCallLoop",(()=>{let e=!1;for(const[{userId:i},n]of this.participants){const o=this.calls.get(i);let s=this.retryCallCounts.get(i);for(const[a,c]of n){var t,r;const n=null==o?void 0:o.get(a),l=null!==(t=null===(r=s)||void 0===r?void 0:r.get(a))&&void 0!==t?t:0;(null==n?void 0:n.getOpponentSessionId())!==c.sessionId&&this.wantsOutgoingCall(i,a)&&l<3&&(void 0===s&&(s=new Map,this.retryCallCounts.set(i,s)),s.set(a,l+1),e=!0)}}e&&this.placeOutgoingCalls()})),(0,n.default)(this,"onCallFeedsChanged",(e=>{const t=A(e),r=e.getOpponentDeviceId();if(!t)throw new Error("Cannot change call feeds without user id");const i=this.getUserMediaFeed(t,r),n=e.remoteUsermediaFeed;n!==i&&(!i&&n?this.addUserMediaFeed(n):i&&n?this.replaceUserMediaFeed(i,n):i&&!n&&this.removeUserMediaFeed(i));const o=this.getScreenshareFeed(t,r),s=e.remoteScreensharingFeed;s!==o&&(!o&&s?this.addScreenshareFeed(s):o&&s?this.replaceScreenshareFeed(o,s):o&&!s&&this.removeScreenshareFeed(o))})),(0,n.default)(this,"onCallStateChanged",((e,t,r)=>{var i;const n=this.localCallFeed.isAudioMuted();e.localUsermediaStream&&e.isMicrophoneMuted()!==n&&e.setMicrophoneMuted(n);const o=this.localCallFeed.isVideoMuted();e.localUsermediaStream&&e.isLocalVideoMuted()!==o&&e.setLocalVideoMuted(o);const s=null===(i=e.getOpponentMember())||void 0===i?void 0:i.userId;if(t===a.CallState.Connected&&s){const t=this.retryCallCounts.get(s);null==t||t.delete(e.getOpponentDeviceId()),0===(null==t?void 0:t.size)&&this.retryCallCounts.delete(s)}})),(0,n.default)(this,"onCallHangup",(e=>{var t,r;if(e.hangupReason===a.CallErrorCode.Replaced)return;const i=null!==(t=null===(r=e.getOpponentMember())||void 0===r?void 0:r.userId)&&void 0!==t?t:this.room.getMember(e.invitee).userId,n=this.calls.get(i);(null==n?void 0:n.get(e.getOpponentDeviceId()))===e&&(this.disposeCall(e,e.hangupReason),n.delete(e.getOpponentDeviceId()),0===n.size&&this.calls.delete(i),this.emit(E.CallsChanged,this.calls))})),(0,n.default)(this,"onCallReplaced",((e,t)=>{const r=e.getOpponentMember().userId;let i=this.calls.get(r);void 0===i&&(i=new Map,this.calls.set(r,i)),this.disposeCall(e,a.CallErrorCode.Replaced),this.initCall(t),i.set(e.getOpponentDeviceId(),t),this.emit(E.CallsChanged,this.calls)})),(0,n.default)(this,"onActiveSpeakerLoop",(()=>{let e,t;for(const r of this.userMediaFeeds){if(r.isLocal()&&this.userMediaFeeds.length>1)continue;const i=r.speakingVolumeSamples.reduce(((e,t)=>e+Math.max(t,s.SPEAKING_THRESHOLD)))/r.speakingVolumeSamples.length;(!e||i>e)&&(e=i,t=r)}t&&this.activeSpeaker!==t&&e&&e>s.SPEAKING_THRESHOLD&&(this.activeSpeaker=t,this.emit(E.ActiveSpeakerChanged,this.activeSpeaker))})),(0,n.default)(this,"onRoomState",(()=>this.updateParticipants())),(0,n.default)(this,"onParticipantsChanged",(()=>{this.state===R.Entered&&this.placeOutgoingCalls()})),(0,n.default)(this,"onStateChanged",((e,t)=>{e!==R.Entered&&t!==R.Entered&&e!==R.Ended||(this.updateParticipants(),this.updateMemberState().catch((e=>l.logger.error("Failed to update member state devices",e))))})),(0,n.default)(this,"onLocalFeedsChanged",(()=>{this.state===R.Entered&&this.updateMemberState().catch((e=>l.logger.error("Failed to update member state feeds",e)))})),this.reEmitter=new u.ReEmitter(this),this.groupCallId=null!=h?h:(0,a.genCallID)(),this.creationTs=null!==(m=null===(g=t.currentState.getStateEvents(d.EventType.GroupCallPrefix,this.groupCallId))||void 0===g?void 0:g.getTs())&&void 0!==m?m:null,this.updateParticipants(),t.on(c.RoomStateEvent.Update,this.onRoomState),this.on(E.ParticipantsChanged,this.onParticipantsChanged),this.on(E.GroupCallStateChanged,this.onStateChanged),this.on(E.LocalScreenshareStateChanged,this.onLocalFeedsChanged)}async create(){this.creationTs=Date.now(),this.client.groupCallEventHandler.groupCalls.set(this.room.roomId,this),this.client.emit(p.GroupCallEventHandlerEvent.Outgoing,this);const e={"m.intent":this.intent,"m.type":this.type,"io.element.ptt":this.isPtt,dataChannelsEnabled:this.dataChannelsEnabled,dataChannelOptions:this.dataChannelsEnabled?this.dataChannelOptions:void 0};return await this.client.sendStateEvent(this.room.roomId,d.EventType.GroupCallPrefix,e,this.groupCallId),this}get state(){return this._state}set state(e){const t=this._state;e!==t&&(this._state=e,this.emit(E.GroupCallStateChanged,e,t))}get participants(){return this._participants}set participants(e){const t=this._participants,r=(e,t)=>e.sessionId===t.sessionId&&e.screensharing===t.screensharing;(0,m.mapsEqual)(e,t,((e,t)=>(0,m.mapsEqual)(e,t,r)))||(this._participants=e,this.emit(E.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(const t of this.calls.values())for(const r of t.values())e(r)}getLocalFeeds(){const e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,t;return null!==(e=null===(t=this.participants.get(this.room.getMember(this.client.getUserId())))||void 0===t?void 0:t.has(this.client.getDeviceId()))&&void 0!==e&&e}async initLocalCallFeed(){if(this.state!==R.LocalCallFeedUninitialized)throw new Error(`Cannot initialize local call feed in the "${this.state}" state.`);if(this.state=R.InitializingLocalCallFeed,this.initCallFeedPromise)return this.initCallFeedPromise;try{this.initCallFeedPromise=this.initLocalCallFeedInternal(),await this.initCallFeedPromise}finally{this.initCallFeedPromise=void 0}}async initLocalCallFeedInternal(){let e;l.logger.log(`groupCall ${this.groupCallId} initLocalCallFeed`);try{e=await this.client.getMediaHandler().getUserMediaStream(!0,this.type===w.Video)}catch(e){throw this.state=R.LocalCallFeedUninitialized,e}if(this._state!==R.InitializingLocalCallFeed)throw this.client.getMediaHandler().stopUserMediaStream(e),new Error("Group call disposed while gathering media stream");const t=new s.CallFeed({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:e,purpose:h.SDPStreamMetadataPurpose.Usermedia,audioMuted:this.initWithAudioMuted||0===e.getAudioTracks().length||this.isPtt,videoMuted:this.initWithVideoMuted||0===e.getVideoTracks().length});(0,a.setTracksEnabled)(e.getAudioTracks(),!t.isAudioMuted()),(0,a.setTracksEnabled)(e.getVideoTracks(),!t.isVideoMuted()),this.localCallFeed=t,this.addUserMediaFeed(t),this.state=R.LocalCallFeedInitialized}async updateLocalUsermediaStream(e){if(this.localCallFeed){const t=this.localCallFeed.stream;this.localCallFeed.setNewStream(e);const r=this.localCallFeed.isAudioMuted(),i=this.localCallFeed.isVideoMuted();l.logger.log(`groupCall ${this.groupCallId} updateLocalUsermediaStream oldStream ${t.id} newStream ${e.id} micShouldBeMuted ${r} vidShouldBeMuted ${i}`),(0,a.setTracksEnabled)(e.getAudioTracks(),!r),(0,a.setTracksEnabled)(e.getVideoTracks(),!i),this.client.getMediaHandler().stopUserMediaStream(t)}}async enter(){if(this.state===R.LocalCallFeedUninitialized)await this.initLocalCallFeed();else if(this.state!==R.LocalCallFeedInitialized)throw new Error(`Cannot enter call in the "${this.state}" state`);l.logger.log(`Entered group call ${this.groupCallId}`),this.state=R.Entered,this.client.on(f.CallEventHandlerEvent.Incoming,this.onIncomingCall);for(const e of this.client.callEventHandler.calls.values())this.onIncomingCall(e);this.retryCallLoopInterval=setInterval(this.onRetryCallLoop,this.retryCallInterval),this.activeSpeaker=void 0,this.onActiveSpeakerLoop(),this.activeSpeakerLoopInterval=setInterval(this.onActiveSpeakerLoop,this.activeSpeakerInterval)}dispose(){this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),null!==this.transmitTimer&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),void 0!==this.retryCallLoopInterval&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.state===R.Entered&&(this.forEachCall((e=>this.disposeCall(e,a.CallErrorCode.UserHangup))),this.calls.clear(),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(f.CallEventHandlerEvent.Incoming,this.onIncomingCall))}leave(){this.dispose(),this.state=R.LocalCallFeedUninitialized}async terminate(e=!0){if(this.dispose(),this.room.off(c.RoomStateEvent.Update,this.onRoomState),this.client.groupCallEventHandler.groupCalls.delete(this.room.roomId),this.client.emit(p.GroupCallEventHandlerEvent.Ended,this),this.state=R.Ended,e){const e=this.room.currentState.getStateEvents(d.EventType.GroupCallPrefix,this.groupCallId);await this.client.sendStateEvent(this.room.roomId,d.EventType.GroupCallPrefix,v(v({},e.getContent()),{},{"m.terminated":S.CallEnded}),this.groupCallId)}}isLocalVideoMuted(){return!this.localCallFeed||this.localCallFeed.isVideoMuted()}isMicrophoneMuted(){return!this.localCallFeed||this.localCallFeed.isAudioMuted()}async setMicrophoneMuted(e){if(!e&&!await this.client.getMediaHandler().hasAudioDevice())return!1;const t=!e&&this.isPtt;this.isPtt&&(!e&&this.isMicrophoneMuted()?this.transmitTimer=setTimeout((()=>{this.setMicrophoneMuted(!0)}),this.pttMaxTransmitTime):e&&!this.isMicrophoneMuted()&&(null!==this.transmitTimer&&clearTimeout(this.transmitTimer),this.transmitTimer=null)),this.forEachCall((t=>{var r;return null===(r=t.localUsermediaFeed)||void 0===r?void 0:r.setAudioVideoMuted(e,null)}));const r=async()=>{const e=[];this.forEachCall((t=>e.push(t.sendMetadataUpdate()))),await Promise.all(e).catch((e=>l.logger.info("Failed to send some metadata updates",e)))};return t&&await r(),this.localCallFeed?(l.logger.log(`groupCall ${this.groupCallId} setMicrophoneMuted stream ${this.localCallFeed.stream.id} muted ${e}`),this.localCallFeed.setAudioVideoMuted(e,null),(0,a.setTracksEnabled)(this.localCallFeed.stream.getAudioTracks(),!e)):(l.logger.log(`groupCall ${this.groupCallId} setMicrophoneMuted no stream muted ${e}`),this.initWithAudioMuted=e),this.forEachCall((t=>(0,a.setTracksEnabled)(t.localUsermediaFeed.stream.getAudioTracks(),!e))),this.emit(E.LocalMuteStateChanged,e,this.isLocalVideoMuted()),t||await r(),!0}async setLocalVideoMuted(e){if(!e&&!await this.client.getMediaHandler().hasVideoDevice())return!1;if(this.localCallFeed){l.logger.log(`groupCall ${this.groupCallId} setLocalVideoMuted stream ${this.localCallFeed.stream.id} muted ${e}`);const t=await this.client.getMediaHandler().getUserMediaStream(!0,!e);await this.updateLocalUsermediaStream(t),this.localCallFeed.setAudioVideoMuted(null,e),(0,a.setTracksEnabled)(this.localCallFeed.stream.getVideoTracks(),!e)}else l.logger.log(`groupCall ${this.groupCallId} setLocalVideoMuted no stream muted ${e}`),this.initWithVideoMuted=e;const t=[];return this.forEachCall((r=>t.push(r.setLocalVideoMuted(e)))),await Promise.all(t),this.emit(E.LocalMuteStateChanged,this.isMicrophoneMuted(),e),!0}async setScreensharingEnabled(e,t={}){if(e===this.isScreensharing())return e;if(!e)return this.forEachCall((e=>{e.localScreensharingFeed&&e.removeLocalFeed(e.localScreensharingFeed)})),this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0,this.emit(E.LocalScreenshareStateChanged,!1,void 0,void 0),!1;try{l.logger.log("Asking for screensharing permissions...");const e=await this.client.getMediaHandler().getScreensharingStream(t);for(const t of e.getTracks()){const e=()=>{this.setScreensharingEnabled(!1),t.removeEventListener("ended",e)};t.addEventListener("ended",e)}return l.logger.log("Screensharing permissions granted. Setting screensharing enabled on all calls"),this.localDesktopCapturerSourceId=t.desktopCapturerSourceId,this.localScreenshareFeed=new s.CallFeed({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:e,purpose:h.SDPStreamMetadataPurpose.Screenshare,audioMuted:!1,videoMuted:!1}),this.addScreenshareFeed(this.localScreenshareFeed),this.emit(E.LocalScreenshareStateChanged,!0,this.localScreenshareFeed,this.localDesktopCapturerSourceId),this.forEachCall((e=>e.pushLocalFeed(this.localScreenshareFeed.clone()))),!0}catch(e){if(t.throwOnFail)throw e;return l.logger.error("Enabling screensharing error",e),this.emit(E.Error,new T(C.NoUserMedia,"Failed to get screen-sharing stream: ",e)),!1}}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,t){const r=this.client.getUserId(),i=this.client.getDeviceId();return e>=r&&(e!==r||t>i)}placeOutgoingCalls(){let e=!1;for(const[{userId:r},i]of this.participants){var t;const n=null!==(t=this.calls.get(r))&&void 0!==t?t:new Map;for(const[t,o]of i){const i=n.get(t);if((null==i?void 0:i.getOpponentSessionId())!==o.sessionId&&this.wantsOutgoingCall(r,t)){e=!0,void 0!==i&&(l.logger.debug(`Replacing call ${i.callId} to ${r} ${t}`),this.disposeCall(i,a.CallErrorCode.NewSession));const s=(0,a.createNewMatrixCall)(this.client,this.room.roomId,{invitee:r,opponentDeviceId:t,opponentSessionId:o.sessionId,groupCallId:this.groupCallId});null===s?(l.logger.error(`Failed to create call with ${r} ${t}`),n.delete(t)):(this.initCall(s),n.set(t,s),l.logger.debug(`Placing call to ${r} ${t} (session ${o.sessionId})`),s.placeCallWithCallFeeds(this.getLocalFeeds().map((e=>e.clone())),o.screensharing).then((()=>{this.dataChannelsEnabled&&s.createDataChannel("datachannel",this.dataChannelOptions)})).catch((e=>{l.logger.warn(`Failed to place call to ${r}`,e),e instanceof a.CallError&&e.code===C.UnknownDevice?this.emit(E.Error,e):this.emit(E.Error,new T(C.PlaceCallFailed,`Failed to place call to ${r}`)),this.disposeCall(s,a.CallErrorCode.SignallingFailed),n.get(t)===s&&n.delete(t)})))}}n.size>0?this.calls.set(r,n):this.calls.delete(r)}e&&this.emit(E.CallsChanged,this.calls)}getMemberStateEvents(e){return void 0===e?this.room.currentState.getStateEvents(d.EventType.GroupCallMemberPrefix):this.room.currentState.getStateEvents(d.EventType.GroupCallMemberPrefix,e)}initCall(e){const t=A(e);if(!t)throw new Error("Cannot init call without user id");const r=()=>this.onCallFeedsChanged(e),i=(t,r)=>this.onCallStateChanged(e,t,r),n=this.onCallHangup,o=t=>this.onCallReplaced(e,t);let s=this.callHandlers.get(t);void 0===s&&(s=new Map,this.callHandlers.set(t,s)),s.set(e.getOpponentDeviceId(),{onCallFeedsChanged:r,onCallStateChanged:i,onCallHangup:n,onCallReplaced:o}),e.on(a.CallEvent.FeedsChanged,r),e.on(a.CallEvent.State,i),e.on(a.CallEvent.Hangup,n),e.on(a.CallEvent.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(a.CallEvent)),r()}disposeCall(e,t){const r=A(e),i=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");const n=this.callHandlers.get(r),{onCallFeedsChanged:o,onCallStateChanged:s,onCallHangup:c,onCallReplaced:l}=n.get(i);if(e.removeListener(a.CallEvent.FeedsChanged,o),e.removeListener(a.CallEvent.State,s),e.removeListener(a.CallEvent.Hangup,c),e.removeListener(a.CallEvent.Replaced,l),n.delete(r),0===n.size&&this.callHandlers.delete(r),e.hangupReason===a.CallErrorCode.Replaced)return;e.state!==a.CallState.Ended&&e.hangup(t,!1);const u=this.getUserMediaFeed(r,i);u&&this.removeUserMediaFeed(u);const h=this.getScreenshareFeed(r,i);h&&this.removeScreenshareFeed(h)}getUserMediaFeed(e,t){return this.userMediaFeeds.find((r=>r.userId===e&&r.deviceId===t))}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(E.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,t){const r=this.userMediaFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===r)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,t),e.dispose(),t.measureVolumeActivity(!0),this.emit(E.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){const t=this.userMediaFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===t)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(t,1),e.dispose(),this.emit(E.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(E.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,t){return this.screenshareFeeds.find((r=>r.userId===e&&r.deviceId===t))}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit(E.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,t){const r=this.screenshareFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===r)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,t),e.dispose(),this.emit(E.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){const t=this.screenshareFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===t)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(t,1),e.dispose(),this.emit(E.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){const e=this.room.getMember(this.client.getUserId());if(!e)return void l.logger.warn("Tried to update participants before local room member is available");if(null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===R.Ended)return void(this.participants=new Map);const t=new Map,r=Date.now(),i=this.state===R.Entered||this.enteredViaAnotherSession;let n=1/0;for(const e of this.getMemberStateEvents()){const o=this.room.getMember(e.getStateKey()),s=e.getContent(),a=(Array.isArray(s["m.calls"])?s["m.calls"]:[]).find((e=>e["m.call_id"]===this.groupCallId));let c=(Array.isArray(null==a?void 0:a["m.devices"])?a["m.devices"]:[]).filter((e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>r&&Array.isArray(e.feeds)));if(i||(null==o?void 0:o.userId)!==this.client.getUserId()||(c=c.filter((e=>e.device_id!==this.client.getDeviceId()))),c.length>0&&"join"===(null==o?void 0:o.membership)){const e=new Map;t.set(o,e);for(const t of c)e.set(t.device_id,{sessionId:t.session_id,screensharing:t.feeds.some((e=>e.purpose===h.SDPStreamMetadataPurpose.Screenshare))}),t.expires_ts<n&&(n=t.expires_ts)}}if(i){let r=t.get(e);void 0===r&&(r=new Map,t.set(e,r)),r.has(this.client.getDeviceId())||r.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some((e=>e.purpose===h.SDPStreamMetadataPurpose.Screenshare))})}this.participants=t,n<1/0&&(this.participantsExpirationTimer=setTimeout((()=>this.updateParticipants()),n-r))}async updateDevices(e,t=!1){var r;const i=Date.now(),n=this.client.getUserId(),o=this.getMemberStateEvents(n),s=null!==(r=null==o?void 0:o.getContent())&&void 0!==r?r:{},a=Array.isArray(s["m.calls"])?s["m.calls"]:[];let c=null;const l=[];for(const e of a)e["m.call_id"]===this.groupCallId?c=e:l.push(e);null===c&&(c={});const u=e((Array.isArray(c["m.devices"])?c["m.devices"]:[]).filter((e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>i&&Array.isArray(e.feeds))));if(null===u)return;const h=[...l];u.length>0&&h.push(v(v({},c),{},{"m.call_id":this.groupCallId,"m.devices":u}));const f={"m.calls":h};await this.client.sendStateEvent(this.room.roomId,d.EventType.GroupCallMemberPrefix,f,n,{keepAlive:t})}async addDeviceToMemberState(){await this.updateDevices((e=>[...e.filter((e=>e.device_id!==this.client.getDeviceId())),{device_id:this.client.getDeviceId(),session_id:this.client.getSessionId(),expires_ts:Date.now()+O,feeds:this.getLocalFeeds().map((e=>({purpose:e.purpose})))}]))}async updateMemberState(){null!==this.resendMemberStateTimer&&(clearInterval(this.resendMemberStateTimer),this.resendMemberStateTimer=null),this.state===R.Entered?(await this.addDeviceToMemberState(),this.resendMemberStateTimer=setInterval((async()=>{l.logger.log("Resending call member state");try{await this.addDeviceToMemberState()}catch(e){l.logger.error("Failed to resend call member state",e)}}),27e5)):await this.updateDevices((e=>e.filter((e=>e.device_id!==this.client.getDeviceId()))),!0)}async cleanMemberState(){const{devices:e}=await this.client.getDevices(),t=new Map(e.map((e=>[e.device_id,e])));await this.updateDevices((e=>{const r=e.filter((e=>{const r=t.get(e.device_id);return void 0!==(null==r?void 0:r.last_seen_ts)&&!(e.device_id===this.client.getDeviceId()&&this.state!==R.Entered&&!this.enteredViaAnotherSession)}));return r.length===e.length?null:r}))}}e.exports.GroupCall=P})),i.register("3Aotm",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.CallEventHandlerEvent=e.exports.CallEventHandler=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("7L16h"),a=i("ldT3p"),c=i("5pxqF"),l=i("hadDF"),u=i("846Vo");let h;e.exports.CallEventHandlerEvent=h,(h||(e.exports.CallEventHandlerEvent=h={})).Incoming="Call.incoming";e.exports.CallEventHandler=class{constructor(e){(0,n.default)(this,"calls",void 0),(0,n.default)(this,"callEventBuffer",void 0),(0,n.default)(this,"nextSeqByCall",new Map),(0,n.default)(this,"toDeviceEventBuffers",new Map),(0,n.default)(this,"client",void 0),(0,n.default)(this,"candidateEventsByCall",void 0),(0,n.default)(this,"eventBufferPromiseChain",void 0),(0,n.default)(this,"onSync",(()=>{const e=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then((()=>this.evaluateEventBuffer(e))):this.eventBufferPromiseChain=this.evaluateEventBuffer(e)})),(0,n.default)(this,"onRoomTimeline",(e=>{this.callEventBuffer.push(e)})),(0,n.default)(this,"onToDeviceEvent",(e=>{const t=e.getContent();if(!t.call_id)return void this.callEventBuffer.push(e);if(this.nextSeqByCall.has(t.call_id)||this.nextSeqByCall.set(t.call_id,0),void 0===t.seq)return void this.callEventBuffer.push(e);const r=this.nextSeqByCall.get(t.call_id)||0;if(t.seq!==r){this.toDeviceEventBuffers.has(t.call_id)||this.toDeviceEventBuffers.set(t.call_id,[]);const r=this.toDeviceEventBuffers.get(t.call_id),i=r.findIndex((e=>e.getContent().seq>t.seq));-1===i?r.push(e):r.splice(i,0,e)}else{const r=t.call_id;this.callEventBuffer.push(e),this.nextSeqByCall.set(r,t.seq+1);const i=this.toDeviceEventBuffers.get(r);let n=i&&i.shift();for(;n&&n.getContent().seq===this.nextSeqByCall.get(r);)this.callEventBuffer.push(n),this.nextSeqByCall.set(r,n.getContent().seq+1),n=i.shift()}})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(c.ClientEvent.Sync,this.onSync),this.client.on(u.RoomEvent.Timeline,this.onRoomTimeline),this.client.on(c.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(c.ClientEvent.Sync,this.onSync),this.client.removeListener(u.RoomEvent.Timeline,this.onRoomTimeline),this.client.removeListener(c.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)}async evaluateEventBuffer(e){await Promise.all(e.map((e=>this.client.decryptEventIfNeeded(e))));const t=e.filter((e=>{const t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")})),r=new Set;for(const e of t){const t=e.getType();t!==a.EventType.CallAnswer&&t!==a.EventType.CallHangup||r.add(e.getContent().call_id)}for(const e of t){const t=e.getType(),i=e.getContent().call_id;if(t!==a.EventType.CallInvite||!r.has(i))try{await this.handleCallEvent(e)}catch(e){o.logger.error("Caught exception handling call event",e)}}}async handleCallEvent(e){var t,r;this.client.emit(c.ClientEvent.ReceivedVoipEvent,e);const i=e.getContent(),n=e.getRoomId()||(null===(t=this.client.groupCallEventHandler.getGroupCallById(i.conf_id))||void 0===t||null===(r=t.room)||void 0===r?void 0:r.roomId),u=i.conf_id,d=e.getType(),f=e.getSender();let p,m,g=i.call_id?this.calls.get(i.call_id):void 0;if(u){if(m=this.client.groupCallEventHandler.getGroupCallById(u),!m)return void o.logger.warn(`Cannot find a group call ${u} for event ${d}. Ignoring event.`);if(p=i.device_id,!p)return o.logger.warn(`Cannot find a device id for ${f}. Ignoring event.`),void m.emit(l.GroupCallEvent.Error,new l.GroupCallUnknownDeviceError(f));if(i.dest_session_id!==this.client.getSessionId())return void o.logger.warn("Call event does not match current session id, ignoring.")}const v=f===this.client.credentials.userId&&(void 0===p||p===this.client.getDeviceId());if(n)if(d!==a.EventType.CallInvite)if(d!==a.EventType.CallCandidates){var y;if([a.EventType.CallHangup,a.EventType.CallReject].includes(d))g?g.state!==s.CallState.Ended&&(d===a.EventType.CallHangup?g.onHangupReceived(i):g.onRejectReceived(i),g.state===s.CallState.Ended&&this.calls.delete(i.call_id)):(g=null!==(y=(0,s.createNewMatrixCall)(this.client,n,{opponentDeviceId:p,opponentSessionId:i.sender_session_id}))&&void 0!==y?y:void 0,g&&(g.callId=i.call_id,g.initWithHangup(e),this.calls.set(i.call_id,g)));else if(g&&g.hasPeerConnection){if(e.getContent().party_id!==g.ourPartyId)switch(d){case a.EventType.CallAnswer:v?g.state===s.CallState.Ringing&&g.onAnsweredElsewhere(i):g.onAnswerReceived(e);break;case a.EventType.CallSelectAnswer:g.onSelectAnswerReceived(e);break;case a.EventType.CallNegotiate:g.onNegotiateReceived(e);break;case a.EventType.CallAssertedIdentity:case a.EventType.CallAssertedIdentityPrefix:g.onAssertedIdentityReceived(e);break;case a.EventType.CallSDPStreamMetadataChanged:case a.EventType.CallSDPStreamMetadataChangedPrefix:g.onSDPStreamMetadataChangedReceived(e)}}else o.logger.info(`Discarding possible call event ${e.getId()} as we don't have a call/peerConn`,d)}else{if(v)return;g?g.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(i.call_id)||this.candidateEventsByCall.set(i.call_id,[]),this.candidateEventsByCall.get(i.call_id).push(e))}else{var b,w;if(v)return;if(e.getLocalAge()>i.lifetime-3e3)return;if(g&&g.state===s.CallState.Ended)return;if(g&&o.logger.log(`WARN: Already have a MatrixCall with id ${i.call_id} but got an invite. Clobbering.`),i.invitee&&i.invitee!==this.client.getUserId())return;const t=(null!==(b=this.client.getTurnServersExpiry())&&void 0!==b?b:0)-Date.now();if(o.logger.info("Current turn creds expire in "+t+" ms"),g=null!==(w=(0,s.createNewMatrixCall)(this.client,n,{forceTURN:this.client.forceTURN,opponentDeviceId:p,groupCallId:u,opponentSessionId:i.sender_session_id}))&&void 0!==w?w:void 0,!g)return void o.logger.log("Incoming call ID "+i.call_id+" but this client doesn't support WebRTC");g.callId=i.call_id;try{await g.initWithInvite(e)}catch(e){var _;if(e instanceof s.CallError)if(e.code===l.GroupCallErrorCode.UnknownDevice)null===(_=m)||void 0===_||_.emit(l.GroupCallEvent.Error,e);else o.logger.error(e)}if(this.calls.set(g.callId,g),this.candidateEventsByCall.get(g.callId))for(const e of this.candidateEventsByCall.get(g.callId))g.onRemoteIceCandidatesReceived(e);let r;for(const e of this.calls.values()){var S;const t=[s.CallState.WaitLocalMedia,s.CallState.CreateOffer,s.CallState.InviteSent].includes(e.state);if(g.roomId===e.roomId&&e.direction===s.CallDirection.Outbound&&(null===(S=g.getOpponentMember())||void 0===S?void 0:S.userId)===e.invitee&&t){r=e;break}}r?r.callId>g.callId?(o.logger.log("Glare detected: answering incoming call "+g.callId+" and canceling outgoing call "+r.callId),r.replacedBy(g)):(o.logger.log("Glare detected: rejecting incoming call "+g.callId+" and keeping outgoing call "+r.callId),g.hangup(s.CallErrorCode.Replaced,!0)):this.client.emit(h.Incoming,g)}}}})),i.register("gokP2",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.GroupCallEventHandlerEvent=e.exports.GroupCallEventHandler=void 0;var n=r(i("3EUCw")),o=i("5pxqF"),s=i("hadDF"),a=i("l2mJP"),c=i("gEWrD"),l=i("ldT3p"),u=i("1dCYQ");let h;var d;e.exports.GroupCallEventHandlerEvent=h,(d=h||(e.exports.GroupCallEventHandlerEvent=h={})).Incoming="GroupCall.incoming",d.Outgoing="GroupCall.outgoing",d.Ended="GroupCall.ended",d.Participants="GroupCall.participants";e.exports.GroupCallEventHandler=class{constructor(e){this.client=e,(0,n.default)(this,"groupCalls",new Map),(0,n.default)(this,"roomDeferreds",new Map),(0,n.default)(this,"onRoomsChanged",(e=>{this.createGroupCallForRoom(e)})),(0,n.default)(this,"onRoomStateChanged",((e,t)=>{if(e.getType()===l.EventType.GroupCallPrefix){const r=e.getStateKey(),i=e.getContent(),n=this.groupCalls.get(t.roomId);n||i["m.terminated"]?n&&n.groupCallId===r?i["m.terminated"]?n.terminate(!1):i["m.type"]!==n.type&&c.logger.warn(`The group call type changed for room: ${t.roomId}. Changing the group call type is currently unsupported.`):n&&n.groupCallId!==r&&c.logger.warn(`Multiple group calls detected for room: ${t.roomId}. Multiple group calls are currently unsupported.`):this.createGroupCallFromRoomStateEvent(e)}}))}async start(){this.client.getSyncState()!==u.SyncState.Syncing&&(c.logger.debug("Waiting for client to start syncing..."),await new Promise((e=>{const t=()=>{if(this.client.getSyncState()===u.SyncState.Syncing)return this.client.off(o.ClientEvent.Sync,t),e()};this.client.on(o.ClientEvent.Sync,t)})));const e=this.client.getRooms();for(const t of e)this.createGroupCallForRoom(t);this.client.on(o.ClientEvent.Room,this.onRoomsChanged),this.client.on(a.RoomStateEvent.Events,this.onRoomStateChanged)}stop(){this.client.removeListener(a.RoomStateEvent.Events,this.onRoomStateChanged)}getRoomDeferred(e){let t=this.roomDeferreds.get(e);if(void 0===t){let r;t={prom:new Promise((e=>{r=e}))},t.resolve=r,this.roomDeferreds.set(e,t)}return t}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find((t=>t.groupCallId===e))}createGroupCallForRoom(e){const t=e.currentState.getStateEvents(l.EventType.GroupCallPrefix),r=t.sort(((e,t)=>t.getTs()-e.getTs()));for(const i of r){if(!i.getContent()["m.terminated"]){c.logger.debug(`Choosing group call ${i.getStateKey()} with TS ${i.getTs()} for room ${e.roomId} from ${t.length} possible calls.`),this.createGroupCallFromRoomStateEvent(i);break}}c.logger.info("Group call event handler processed room",e.roomId),this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){const t=e.getRoomId(),r=e.getContent(),i=this.client.getRoom(t);if(!i)return void c.logger.warn(`Couldn't find room ${t} for GroupCall`);const n=e.getStateKey(),o=r["m.type"];if(!Object.values(s.GroupCallType).includes(o))return void c.logger.warn(`Received invalid group call type ${o} for room ${t}.`);const a=r["m.intent"];if(!Object.values(s.GroupCallIntent).includes(a))return void c.logger.warn(`Received invalid group call intent ${o} for room ${t}.`);const l=Boolean(r["io.element.ptt"]);let u;if(null!=r&&r.dataChannelsEnabled&&null!=r&&r.dataChannelOptions){const{ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n}=r.dataChannelOptions;u={ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n}}const d=new s.GroupCall(this.client,i,o,l,a,n,null==r?void 0:r.dataChannelsEnabled,u);return this.groupCalls.set(i.roomId,d),this.client.emit(h.Incoming,d),d}}})),i.register("fIT1M",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.AutoDiscoveryAction=e.exports.AutoDiscovery=void 0;var o=n(i("3EUCw")),s=i("gEWrD"),a=i("cH9or");let c;var l,u,h;e.exports.AutoDiscoveryAction=c,(l=c||(e.exports.AutoDiscoveryAction=c={})).SUCCESS="SUCCESS",l.IGNORE="IGNORE",l.PROMPT="PROMPT",l.FAIL_PROMPT="FAIL_PROMPT",l.FAIL_ERROR="FAIL_ERROR",(h=u||(u={})).Invalid="Invalid homeserver discovery response",h.GenericFailure="Failed to get autodiscovery configuration from server",h.InvalidHsBaseUrl="Invalid base_url for m.homeserver",h.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",h.InvalidIsBaseUrl="Invalid base_url for m.identity_server",h.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",h.InvalidIs="Invalid identity server discovery response",h.MissingWellknown="No .well-known JSON file found",h.InvalidJson="Invalid JSON";class d{static async fromDiscoveryConfig(e){var t;const r={"m.homeserver":{state:d.FAIL_ERROR,error:d.ERROR_INVALID,base_url:null},"m.identity_server":{state:d.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return s.logger.error("No m.homeserver key in config"),r["m.homeserver"].state=d.FAIL_PROMPT,r["m.homeserver"].error=d.ERROR_INVALID,Promise.resolve(r);if(!e["m.homeserver"].base_url)return s.logger.error("No m.homeserver base_url in config"),r["m.homeserver"].state=d.FAIL_PROMPT,r["m.homeserver"].error=d.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);const i=this.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!i)return s.logger.error("Invalid base_url for m.homeserver"),r["m.homeserver"].error=d.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);const n=await this.fetchWellKnownObject(`${i}/_matrix/client/versions`);if(!n||null===(t=n.raw)||void 0===t||!t.versions)return s.logger.error("Invalid /versions response"),r["m.homeserver"].error=d.ERROR_INVALID_HOMESERVER,r["m.homeserver"].base_url=i,Promise.resolve(r);r["m.homeserver"]={state:d.SUCCESS,error:null,base_url:i};let o="";if(e["m.identity_server"]){const t={"m.homeserver":r["m.homeserver"],"m.identity_server":{state:d.FAIL_PROMPT,error:d.ERROR_INVALID_IS,base_url:null}};if(o=this.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!o)return s.logger.error("Invalid base_url for m.identity_server"),t["m.identity_server"].error=d.ERROR_INVALID_IS_BASE_URL,Promise.resolve(t);const i=await this.fetchWellKnownObject(`${o}/_matrix/identity/v2`);if(null==i||!i.raw||i.action!==c.SUCCESS)return s.logger.error("Invalid /v2 response"),t["m.identity_server"].error=d.ERROR_INVALID_IDENTITY_SERVER,t["m.identity_server"].base_url=o,Promise.resolve(t)}return o&&o.toString().length>0&&(r["m.identity_server"]={state:d.SUCCESS,error:null,base_url:o}),Object.keys(e).forEach((t=>{if("m.homeserver"===t||"m.identity_server"===t){const i=["error","state","base_url"];for(const n of Object.keys(e[t]))i.includes(n)||(r[t][n]=e[t][n])}else r[t]=e[t]})),Promise.resolve(r)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:d.FAIL_ERROR,error:d.ERROR_INVALID,base_url:null},"m.identity_server":{state:d.PROMPT,error:null,base_url:null}},r=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return r&&r.action===c.SUCCESS?d.fromDiscoveryConfig(r.raw):(s.logger.error("No response or error when parsing .well-known"),r.reason&&s.logger.error(r.reason),r.action===c.IGNORE?t["m.homeserver"]={state:d.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=d.FAIL_PROMPT,t["m.homeserver"].error=d.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var t;let r;try{r=new URL(e)}catch(e){s.logger.error("Could not parse url",e)}if(null===(t=r)||void 0===t||!t.hostname)return!1;if("http:"!==r.protocol&&"https:"!==r.protocol)return!1;const i=r.port?`:${r.port}`:"",n=r.pathname?r.pathname:"";let o=`${r.protocol}//${r.hostname}${i}${n}`;return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(e){return s.logger.error(e),!1}}static fetch(e,t){return this.fetchFn?this.fetchFn(e,t):r.fetch(e,t)}static setFetchFn(e){d.fetchFn=e}static async fetchWellKnownObject(e){let t;try{if(t=await d.fetch(e,{method:a.Method.Get,signal:(0,a.timeoutSignal)(5e3)}),404===t.status)return{raw:{},action:c.IGNORE,reason:d.ERROR_MISSING_WELLKNOWN};if(!t.ok)return{raw:{},action:c.FAIL_PROMPT,reason:"General failure"}}catch(e){const t=e;let r="";return"object"==typeof t&&(r=null==t?void 0:t.message),{error:t,raw:{},action:c.FAIL_PROMPT,reason:r||"General failure"}}try{return{raw:await t.json(),action:c.SUCCESS}}catch(e){const t=e;return{error:t,raw:{},action:c.FAIL_PROMPT,reason:"SyntaxError"===(null==t?void 0:t.name)?d.ERROR_INVALID_JSON:d.ERROR_INVALID}}}}e.exports.AutoDiscovery=d,(0,o.default)(d,"ERROR_INVALID",u.Invalid),(0,o.default)(d,"ERROR_GENERIC_FAILURE",u.GenericFailure),(0,o.default)(d,"ERROR_INVALID_HS_BASE_URL",u.InvalidHsBaseUrl),(0,o.default)(d,"ERROR_INVALID_HOMESERVER",u.InvalidHomeserver),(0,o.default)(d,"ERROR_INVALID_IS_BASE_URL",u.InvalidIsBaseUrl),(0,o.default)(d,"ERROR_INVALID_IDENTITY_SERVER",u.InvalidIdentityServer),(0,o.default)(d,"ERROR_INVALID_IS",u.InvalidIs),(0,o.default)(d,"ERROR_MISSING_WELLKNOWN",u.MissingWellknown),(0,o.default)(d,"ERROR_INVALID_JSON",u.InvalidJson),(0,o.default)(d,"ALL_ERRORS",Object.keys(u)),(0,o.default)(d,"FAIL_ERROR",c.FAIL_ERROR),(0,o.default)(d,"FAIL_PROMPT",c.FAIL_PROMPT),(0,o.default)(d,"PROMPT",c.PROMPT),(0,o.default)(d,"SUCCESS",c.SUCCESS),(0,o.default)(d,"fetchFn",void 0)})),i.register("dvbGC",(function(e,t){var n=i("awmEs").Buffer,o=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.OLM_ALGORITHM=e.exports.MEGOLM_BACKUP_ALGORITHM=e.exports.MEGOLM_ALGORITHM=void 0,e.exports.decodeBase64=function(e){return n.from(e,"base64")},e.exports.encodeBase64=y,e.exports.encodeUnpaddedBase64=function(e){return y(e).replace(/=+$/g,"")},e.exports.encryptMessageForDevice=async function(e,t,r,i,n,o,s){const a=o.getIdentityKey(),l=await i.getSessionIdForDevice(a);if(null===l)return void u.logger.log(`[olmlib.encryptMessageForDevice] Unable to find Olm session for device ${n}:${o.deviceId}`);u.logger.log(`[olmlib.encryptMessageForDevice] Using Olm session ${l} for device ${n}:${o.deviceId}`);const h=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({sender:t,sender_device:r,keys:{ed25519:i.deviceEd25519Key},recipient:n,recipient_keys:{ed25519:o.getFingerprint()}},s);e[a]=await i.encryptMessage(a,l,JSON.stringify(h))},e.exports.ensureOlmSessionsForDevices=async function(e,t,r,i=!1,n,o,s=u.logger){const a=[],c={},l={};for(const[,t]of Object.entries(r))for(const r of t){const t=r.getIdentityKey();t!==e.deviceCurve25519Key&&(e.sessionsInProgress[t]||(e.sessionsInProgress[t]=new Promise((r=>{l[t]=i=>{delete e.sessionsInProgress[t],r(i)}}))))}for(const[t,n]of Object.entries(r)){c[t]={};for(const r of n){const n=r.deviceId,o=r.getIdentityKey();if(o===e.deviceCurve25519Key){s.info("Attempted to start session with ourself! Ignoring"),c[t][n]={device:r,sessionId:null};continue}const u=`for ${o} (${t}:${n})`,h=await e.getSessionIdForDevice(o,!!l[o],s);null!==h&&l[o]&&l[o](),(null===h||i)&&(i?s.info(`Forcing new Olm session ${u}`):s.info(`Making new Olm session ${u}`),a.push([t,n])),c[t][n]={device:r,sessionId:h}}}if(0===a.length)return c;const h="signed_curve25519";let d,f=`one-time keys for ${a.length} devices`;try{s.debug(`Claiming ${f}`),d=await t.claimOneTimeKeys(a,h,n),s.debug(`Claimed ${f}`)}catch(e){for(const e of Object.values(l))e();throw s.log(`Failed to claim ${f}`,e,a),e}o&&"failures"in d&&o.push(...Object.keys(d.failures));const p=d.one_time_keys||{},m=[];for(const[t,n]of Object.entries(r)){const r=p[t]||{};for(const o of n){const n=o.deviceId,a=o.getIdentityKey();if(a===e.deviceCurve25519Key)continue;if(c[t][n].sessionId&&!i)continue;const u=r[n]||{};let d=null;for(const e in u)0===e.indexOf(h+":")&&(d=u[e]);d?m.push(g(e,d,t,o).then((e=>{l[a]&&l[a](null!=e?e:void 0),c[t][n].sessionId=e}),(e=>{throw l[a]&&l[a](),e}))):(s.warn(`No one-time keys (alg=${h}) for device ${t}:${n}`),l[a]&&l[a]())}}return f=`Olm sessions for ${m.length} devices`,s.debug(`Starting ${f}`),await Promise.all(m),s.debug(`Started ${f}`),c},e.exports.getExistingOlmSessions=async function(e,t,r){const i={},n={},o=[];for(const[t,s]of Object.entries(r))for(const r of s){const s=r.deviceId,a=r.getIdentityKey();o.push((async()=>{const o=await e.getSessionIdForDevice(a,!0);null===o?(i[t]=i[t]||[],i[t].push(r)):(n[t]=n[t]||{},n[t][s]={device:r,sessionId:o})})())}return await Promise.all(o),[i,n]},e.exports.isOlmEncrypted=function(e){if(!e.getSenderKey())return u.logger.error("Event has no sender key (not encrypted?)"),!1;if(e.getWireType()!==h.EventType.RoomMessageEncrypted||!["m.olm.v1.curve25519-aes-sha2"].includes(e.getWireContent().algorithm))return u.logger.error("Event was not encrypted using an appropriate algorithm"),!1;return!0},e.exports.pkSign=function(e,t,i,n){let o=!1;if(t instanceof Uint8Array){const e=new r.Olm.PkSigning;n=e.init_with_seed(t),t=e,o=!0}const s=e.signatures||{};delete e.signatures;const a=e.unsigned;e.unsigned&&delete e.unsigned;try{const r=s[i]||{};return s[i]=r,r["ed25519:"+n]=t.sign(l.default.stringify(e))}finally{e.signatures=s,a&&(e.unsigned=a),o&&t.free()}},e.exports.pkVerify=function(e,t,i){const n="ed25519:"+t;if(!(e.signatures&&e.signatures[i]&&e.signatures[i][n]))throw new Error("No signature");const o=e.signatures[i][n],s=new r.Olm.Utility,a=e.signatures;delete e.signatures;const c=e.unsigned;e.unsigned&&delete e.unsigned;try{s.ed25519_verify(t,l.default.stringify(e),o)}finally{e.signatures=a,c&&(e.unsigned=c),s.free()}},e.exports.verifySignature=v;var s,a,c=o(i("3EUCw")),l=o(i("1nB6h")),u=i("gEWrD"),h=i("ldT3p");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}(a=s||(s={})).Olm="m.olm.v1.curve25519-aes-sha2",a.Megolm="m.megolm.v1.aes-sha2",a.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2";const f=s.Olm;e.exports.OLM_ALGORITHM=f;const p=s.Megolm;e.exports.MEGOLM_ALGORITHM=p;const m=s.MegolmBackup;async function g(e,t,r,i){const n=i.deviceId;try{await v(e,t,r,n,i.getFingerprint())}catch(e){return u.logger.error("Unable to verify signature on one-time key for device "+r+":"+n+":",e),null}let o;try{o=await e.createOutboundSession(i.getIdentityKey(),t.key)}catch(e){return u.logger.error("Error starting olm session with device "+r+":"+n+": "+e),null}return u.logger.log("Started new olm sessionid "+o+" for device "+r+":"+n),o}async function v(e,t,r,i,n){const o="ed25519:"+i,s=((t.signatures||{})[r]||{})[o];if(!s)throw Error("No signature");const a=Object.assign({},t);"unsigned"in a&&delete a.unsigned,delete a.signatures;const c=l.default.stringify(a);e.verifySignature(n,c,s)}function y(e){return n.from(e).toString("base64")}e.exports.MEGOLM_BACKUP_ALGORITHM=m})),i.register("hT5WU",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomList=void 0;var n=r(i("3EUCw")),o=i("gH6iW");e.exports.RoomList=class{constructor(e){this.cryptoStore=e,(0,n.default)(this,"roomEncryption",{})}async init(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ROOMS],(e=>{this.cryptoStore.getEndToEndRooms(e,(e=>{this.roomEncryption=e}))}))}getRoomEncryption(e){return this.roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this.roomEncryption[e]=t,await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ROOMS],(r=>{this.cryptoStore.storeEndToEndRoom(e,t,r)}))}}})),i.register("gH6iW",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IndexedDBCryptoStore=void 0;var o=n(i("3EUCw")),s=i("gEWrD"),a=i("hOgOK"),c=i("8WTLW"),l=f(i("jInKI")),u=i("dsM0i"),h=f(i("iQAad"));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}class p{static exists(e,t){return h.exists(e,t)}constructor(e,t){this.indexedDB=e,this.dbName=t,(0,o.default)(this,"backendPromise",void 0),(0,o.default)(this,"backend",void 0)}startup(){return this.backendPromise||(this.backendPromise=new Promise(((e,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));s.logger.log(`connecting to indexeddb ${this.dbName}`);const r=this.indexedDB.open(this.dbName,l.VERSION);r.onupgradeneeded=e=>{const t=r.result,i=e.oldVersion;l.upgradeDatabase(t,i)},r.onblocked=()=>{s.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=e=>{s.logger.log("Error connecting to indexeddb",e),t(r.error)},r.onsuccess=()=>{const t=r.result;s.logger.log(`connected to indexeddb ${this.dbName}`),e(new l.Backend(t))}})).then((e=>e.doTxn("readonly",[p.STORE_INBOUND_GROUP_SESSIONS,p.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw s.logger.warn("Crypto DB is too new for us to use!",e),new u.InvalidCryptoStoreError(u.InvalidCryptoStoreState.TooNew);s.logger.warn(`unable to connect to indexeddb ${this.dbName}: falling back to localStorage store: ${e}`);try{return new a.LocalStorageCryptoStore(r.localStorage)}catch(e){return s.logger.warn(`unable to open localStorage: falling back to in-memory store: ${e}`),new c.MemoryCryptoStore}})).then((e=>(this.backend=e,e)))),this.backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));s.logger.log(`Removing indexeddb instance: ${this.dbName}`);const r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{s.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=e=>{s.logger.log("Error deleting data from indexeddb",e),t(r.error)},r.onsuccess=()=>{s.logger.log(`Removed indexeddb instance: ${this.dbName}`),e()}})).catch((e=>{s.logger.warn(`unable to delete IndexedDBCryptoStore: ${e}`)}))}getOrAddOutgoingRoomKeyRequest(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this.backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,r){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,t,r)}updateOutgoingRoomKeyRequest(e,t,r){return this.backend.updateOutgoingRoomKeyRequest(e,t,r)}deleteOutgoingRoomKeyRequest(e,t){return this.backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,r){this.backend.getSecretStorePrivateKey(e,t,r)}storeCrossSigningKeys(e,t){this.backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,r){this.backend.storeSecretStorePrivateKey(e,t,r)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,r,i){this.backend.getEndToEndSession(e,t,r,i)}getEndToEndSessions(e,t,r){this.backend.getEndToEndSessions(e,t,r)}getAllEndToEndSessions(e,t){this.backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,r,i){this.backend.storeEndToEndSession(e,t,r,i)}storeEndToEndSessionProblem(e,t,r){return this.backend.storeEndToEndSessionProblem(e,t,r)}getEndToEndSessionProblem(e,t){return this.backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,r,i){this.backend.getEndToEndInboundGroupSession(e,t,r,i)}getAllEndToEndInboundGroupSessions(e,t){this.backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,r,i){this.backend.addEndToEndInboundGroupSession(e,t,r,i)}storeEndToEndInboundGroupSession(e,t,r,i){this.backend.storeEndToEndInboundGroupSession(e,t,r,i)}storeEndToEndInboundGroupSessionWithheld(e,t,r,i){this.backend.storeEndToEndInboundGroupSessionWithheld(e,t,r,i)}storeEndToEndDeviceData(e,t){this.backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this.backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,r){this.backend.storeEndToEndRoom(e,t,r)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this.backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this.backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this.backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,r,i){this.backend.addSharedHistoryInboundGroupSession(e,t,r,i)}getSharedHistoryInboundGroupSessions(e,t){return this.backend.getSharedHistoryInboundGroupSessions(e,t)}addParkedSharedHistory(e,t,r){this.backend.addParkedSharedHistory(e,t,r)}takeParkedSharedHistory(e,t){return this.backend.takeParkedSharedHistory(e,t)}doTxn(e,t,r,i){return this.backend.doTxn(e,t,r,i)}}e.exports.IndexedDBCryptoStore=p,(0,o.default)(p,"STORE_ACCOUNT","account"),(0,o.default)(p,"STORE_SESSIONS","sessions"),(0,o.default)(p,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),(0,o.default)(p,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),(0,o.default)(p,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),(0,o.default)(p,"STORE_PARKED_SHARED_HISTORY","parked_shared_history"),(0,o.default)(p,"STORE_DEVICE_DATA","device_data"),(0,o.default)(p,"STORE_ROOMS","rooms"),(0,o.default)(p,"STORE_BACKUP","sessions_needing_backup")})),i.register("hOgOK",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LocalStorageCryptoStore=void 0;var r=i("gEWrD"),n=i("8WTLW");const o="crypto.",s=o+"account",a=o+"cross_signing_keys",c=o+"notified_error_devices",l=o+"device_data",u=o+"inboundgroupsessions/",h=o+"inboundgroupsessions.withheld/",d=o+"rooms/",f=o+"sessionsneedingbackup";function p(e){return o+"sessions/"+e}function m(e){return o+"session.problems/"+e}function g(e,t){return u+e+"/"+t}function v(e,t){return h+e+"/"+t}function y(e){return d+e}class b extends n.MemoryCryptoStore{static exists(e){const t=e.length;for(let i=0;i<t;i++){var r;if(null!==(r=e.key(i))&&void 0!==r&&r.startsWith(o))return!0}return!1}constructor(e){super(),this.store=e}countEndToEndSessions(e,t){let r=0;for(let e=0;e<this.store.length;++e){var i;null!==(i=this.store.key(e))&&void 0!==i&&i.startsWith(p(""))&&++r}t(r)}_getEndToEndSessions(e){const t=w(this.store,p(e)),r={};for(const[e,i]of Object.entries(t||{}))r[e]="string"==typeof i?{session:i}:i;return r}getEndToEndSession(e,t,r,i){i(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,r){r(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e){var r;if(null!==(r=this.store.key(e))&&void 0!==r&&r.startsWith(p(""))){const r=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(r)))t(e)}}}storeEndToEndSession(e,t,r,i){const n=this._getEndToEndSessions(e)||{};n[t]=r,_(this.store,p(e),n)}async storeEndToEndSessionProblem(e,t,r){const i=m(e),n=w(this.store,i)||[];n.push({type:t,fixed:r,time:Date.now()}),n.sort(((e,t)=>e.time-t.time)),_(this.store,i,n)}async getEndToEndSessionProblem(e,t){const r=m(e),i=w(this.store,r)||[];if(!i.length)return null;const n=i[i.length-1];for(const e of i)if(e.time>t)return Object.assign({},e,{fixed:n.fixed});return n.fixed?null:n}async filterOutNotifiedErrorDevices(e){const t=w(this.store,c)||{},r=[];for(const i of e){const{userId:e,deviceInfo:n}=i;e in t?n.deviceId in t[e]||(r.push(i),t[e][n.deviceId]=!0):(r.push(i),t[e]={[n.deviceId]:!0})}return _(this.store,c,t),r}getEndToEndInboundGroupSession(e,t,r,i){i(w(this.store,g(e,t)),w(this.store,v(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const r=this.store.key(e);null!=r&&r.startsWith(u)&&t({senderKey:r.slice(u.length,u.length+43),sessionId:r.slice(u.length+44),sessionData:w(this.store,r)})}t(null)}addEndToEndInboundGroupSession(e,t,r,i){w(this.store,g(e,t))||this.storeEndToEndInboundGroupSession(e,t,r,i)}storeEndToEndInboundGroupSession(e,t,r,i){_(this.store,g(e,t),r)}storeEndToEndInboundGroupSessionWithheld(e,t,r,i){_(this.store,v(e,t),r)}getEndToEndDeviceData(e,t){t(w(this.store,l))}storeEndToEndDeviceData(e,t){_(this.store,l,e)}storeEndToEndRoom(e,t,r){_(this.store,y(e),t)}getEndToEndRooms(e,t){const r={},i=y("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);if(null!=t&&t.startsWith(i)){r[t.slice(i.length)]=w(this.store,t)}}t(r)}getSessionsNeedingBackup(e){const t=w(this.store,f)||{},r=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const t=i.slice(0,43),n=i.slice(44);if(this.getEndToEndInboundGroupSession(t,n,null,(e=>{r.push({senderKey:t,sessionId:n,sessionData:e})})),e&&r.length>=e)break}return Promise.resolve(r)}countSessionsNeedingBackup(){const e=w(this.store,f)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=w(this.store,f)||{};for(const r of e)delete t[r.senderKey+"/"+r.sessionId];return _(this.store,f,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=w(this.store,f)||{};for(const r of e)t[r.senderKey+"/"+r.sessionId]=!0;return _(this.store,f,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(s),Promise.resolve()}getAccount(e,t){t(w(this.store,s))}storeAccount(e,t){_(this.store,s,t)}getCrossSigningKeys(e,t){t(w(this.store,a))}getSecretStorePrivateKey(e,t,r){t(w(this.store,o+`ssss_cache.${r}`))}storeCrossSigningKeys(e,t){_(this.store,a,t)}storeSecretStorePrivateKey(e,t,r){_(this.store,o+`ssss_cache.${t}`,r)}doTxn(e,t,r){return Promise.resolve(r(null))}}function w(e,t){try{return JSON.parse(e.getItem(t))}catch(e){r.logger.log("Error: Failed to get key %s: %s",t,e.message),r.logger.log(e.stack)}return null}function _(e,t,r){e.setItem(t,JSON.stringify(r))}e.exports.LocalStorageCryptoStore=b})),i.register("jInKI",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VERSION=e.exports.Backend=void 0,e.exports.upgradeDatabase=function(e,t){o.logger.log(`Upgrading IndexedDBCryptoStore from version ${t} to ${l}`),c.forEach(((r,i)=>{t<=i&&r(e)}))};var n=r(i("3EUCw")),o=i("gEWrD"),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}e.exports.Backend=class{constructor(e){this.db=e,(0,n.default)(this,"nextTxnId",0),e.onversionchange=()=>{o.logger.log(`versionchange for indexeddb ${this.db.name}: closing`),e.close()}}async startup(){return this}async deleteAllData(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise(((r,i)=>{const n=this.db.transaction("outgoingRoomKeyRequests","readwrite");n.onerror=i,this._getOutgoingRoomKeyRequest(n,t,(i=>{if(i)return o.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void r(i);o.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),n.oncomplete=()=>{r(e)};n.objectStore("outgoingRoomKeyRequests").add(e)}))}))}getOutgoingRoomKeyRequest(e){return new Promise(((t,r)=>{const i=this.db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=r,this._getOutgoingRoomKeyRequest(i,e,(e=>{t(e)}))}))}_getOutgoingRoomKeyRequest(e,t,r){const i=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]);i.onsuccess=()=>{const e=i.result;if(!e)return void r(null);const n=e.value;s.deepCompare(n.requestBody,t)?r(n):e.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,r=0;const i=this.db.transaction("outgoingRoomKeyRequests","readonly"),n=i.objectStore("outgoingRoomKeyRequests"),o=e[r];return n.index("state").openCursor(o).onsuccess=function i(){const n=this.result;if(n)return void(t=n.value);if(r++,r>=e.length)return;const o=e[r];this.source.openCursor(o).onsuccess=i},h(i).then((()=>t))}getAllOutgoingRoomKeyRequestsByState(e){return new Promise(((t,r)=>{const i=this.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);i.onsuccess=()=>t(i.result),i.onerror=()=>r(i.error)}))}getOutgoingRoomKeyRequestsByTarget(e,t,r){let i=0;const n=[];const o=this.db.transaction("outgoingRoomKeyRequests","readonly"),s=o.objectStore("outgoingRoomKeyRequests"),a=r[i];return s.index("state").openCursor(a).onsuccess=function o(){const s=this.result;if(s){const r=s.value;r.recipients.some((r=>r.userId===e&&r.deviceId===t))&&n.push(r),s.continue()}else{if(i++,i>=r.length)return;const e=r[i];this.source.openCursor(e).onsuccess=o}},h(o).then((()=>n))}updateOutgoingRoomKeyRequest(e,t,r){let i=null;const n=this.db.transaction("outgoingRoomKeyRequests","readwrite");return n.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(){const e=this.result;if(!e)return;const n=e.value;n.state==t?(Object.assign(n,r),e.update(n),i=n):o.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${n.state}`)},h(n).then((()=>i))}deleteOutgoingRoomKeyRequest(e,t){const r=this.db.transaction("outgoingRoomKeyRequests","readwrite"),i=r.objectStore("outgoingRoomKeyRequests").openCursor(e);return i.onsuccess=()=>{const e=i.result;if(!e)return;const r=e.value;r.state==t?e.delete():o.logger.warn(`Cannot delete room key request in state ${r.state} (expected ${t})`)},h(r)}getAccount(e,t){const r=e.objectStore("account").get("-");r.onsuccess=function(){try{t(r.result||null)}catch(t){u(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const r=e.objectStore("account").get("crossSigningKeys");r.onsuccess=function(){try{t(r.result||null)}catch(t){u(e,t)}}}getSecretStorePrivateKey(e,t,r){const i=e.objectStore("account").get(`ssss_cache:${r}`);i.onsuccess=function(){try{t(i.result||null)}catch(t){u(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,r){e.objectStore("account").put(r,`ssss_cache:${t}`)}countEndToEndSessions(e,t){const r=e.objectStore("sessions").count();r.onsuccess=function(){try{t(r.result)}catch(t){u(e,t)}}}getEndToEndSessions(e,t,r){const i=t.objectStore("sessions").index("deviceKey").openCursor(e),n={};i.onsuccess=function(){const e=i.result;if(e)n[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{r(n)}catch(e){u(t,e)}}}getEndToEndSession(e,t,r,i){const n=r.objectStore("sessions").get([e,t]);n.onsuccess=function(){try{n.result?i({session:n.result.session,lastReceivedMessageTs:n.result.lastReceivedMessageTs}):i(null)}catch(e){u(r,e)}}}getAllEndToEndSessions(e,t){const r=e.objectStore("sessions").openCursor();r.onsuccess=function(){try{const e=r.result;e?(t(e.value),e.continue()):t(null)}catch(t){u(e,t)}}}storeEndToEndSession(e,t,r,i){i.objectStore("sessions").put({deviceKey:e,sessionId:t,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,r){const i=this.db.transaction("session_problems","readwrite");i.objectStore("session_problems").put({deviceKey:e,type:t,fixed:r,time:Date.now()}),await h(i)}async getEndToEndSessionProblem(e,t){let r=null;const i=this.db.transaction("session_problems","readwrite"),n=i.objectStore("session_problems").index("deviceKey").getAll(e);return n.onsuccess=()=>{const e=n.result;if(!e.length)return void(r=null);e.sort(((e,t)=>e.time-t.time));const i=e[e.length-1];for(const n of e)if(n.time>t)return void(r=Object.assign({},n,{fixed:i.fixed}));r=i.fixed?null:i},await h(i),r}async filterOutNotifiedErrorDevices(e){const t=this.db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),r=[];return await Promise.all(e.map((e=>new Promise((i=>{const{userId:n,deviceInfo:o}=e,s=t.get([n,o.deviceId]);s.onsuccess=function(){s.result||(t.put({userId:n,deviceId:o.deviceId}),r.push(e)),i()}}))))),r}getEndToEndInboundGroupSession(e,t,r,i){let n=!1,o=!1;const s=r.objectStore("inbound_group_sessions").get([e,t]);s.onsuccess=function(){try{n=s.result?s.result.session:null,!1!==o&&i(n,o)}catch(e){u(r,e)}};const a=r.objectStore("inbound_group_sessions_withheld").get([e,t]);a.onsuccess=function(){try{o=a.result?a.result.session:null,!1!==n&&i(n,o)}catch(e){u(r,e)}}}getAllEndToEndInboundGroupSessions(e,t){const r=e.objectStore("inbound_group_sessions").openCursor();r.onsuccess=function(){const i=r.result;if(i){try{t({senderKey:i.value.senderCurve25519Key,sessionId:i.value.sessionId,sessionData:i.value.session})}catch(t){u(e,t)}i.continue()}else try{t(null)}catch(t){u(e,t)}}}addEndToEndInboundGroupSession(e,t,r,i){const n=i.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:r});n.onerror=r=>{var s;"ConstraintError"===(null===(s=n.error)||void 0===s?void 0:s.name)?(r.stopPropagation(),r.preventDefault(),o.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):u(i,new Error("Failed to add inbound group session: "+n.error))}}storeEndToEndInboundGroupSession(e,t,r,i){i.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:r})}storeEndToEndInboundGroupSessionWithheld(e,t,r,i){i.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:r})}getEndToEndDeviceData(e,t){const r=e.objectStore("device_data").get("-");r.onsuccess=function(){try{t(r.result||null)}catch(t){u(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,r){r.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const r={},i=e.objectStore("rooms").openCursor();i.onsuccess=function(){const n=i.result;if(n)r[n.key]=n.value,n.continue();else try{t(r)}catch(t){u(e,t)}}}getSessionsNeedingBackup(e){return new Promise(((t,r)=>{const i=[],n=this.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");n.onerror=r,n.oncomplete=function(){t(i)};const o=n.objectStore("sessions_needing_backup"),s=n.objectStore("inbound_group_sessions"),a=o.openCursor();a.onsuccess=function(){const t=a.result;if(t){const r=s.get(t.key);r.onsuccess=function(){i.push({senderKey:r.result.senderCurve25519Key,sessionId:r.result.sessionId,sessionData:r.result.session})},(!e||i.length<e)&&t.continue()}}}))}countSessionsNeedingBackup(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise(((e,r)=>{const i=t.count();i.onerror=r,i.onsuccess=()=>e(i.result)}))}async unmarkSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const r=t.objectStore("sessions_needing_backup");await Promise.all(e.map((e=>new Promise(((t,i)=>{const n=r.delete([e.senderKey,e.sessionId]);n.onsuccess=t,n.onerror=i})))))}async markSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const r=t.objectStore("sessions_needing_backup");await Promise.all(e.map((e=>new Promise(((t,i)=>{const n=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});n.onsuccess=t,n.onerror=i})))))}addSharedHistoryInboundGroupSession(e,t,r,i){i||(i=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));const n=i.objectStore("shared_history_inbound_group_sessions"),o=n.get([e]);o.onsuccess=()=>{const{sessions:i}=o.result||{sessions:[]};i.push([t,r]),n.put({roomId:e,sessions:i})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this.db.transaction("shared_history_inbound_group_sessions","readonly"));const r=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise(((e,t)=>{r.onsuccess=()=>{const{sessions:t}=r.result||{sessions:[]};e(t)},r.onerror=t}))}addParkedSharedHistory(e,t,r){r||(r=this.db.transaction("parked_shared_history","readwrite"));const i=r.objectStore("parked_shared_history"),n=i.get([e]);n.onsuccess=()=>{const{parked:r}=n.result||{parked:[]};r.push(t),i.put({roomId:e,parked:r})}}takeParkedSharedHistory(e,t){t||(t=this.db.transaction("parked_shared_history","readwrite"));const r=t.objectStore("parked_shared_history").openCursor(e);return new Promise(((e,t)=>{r.onsuccess=()=>{const t=r.result;if(!t)return void e([]);const i=t.value;t.delete(),e(i)},r.onerror=t}))}doTxn(e,t,r,i=o.logger){const n=this.db.transaction(t,e),s=h(n),a=r(n);return s.then((()=>a))}};const c=[e=>{!function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e)},e=>{e.createObjectStore("account")},e=>{e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},e=>{e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("device_data")},e=>{e.createObjectStore("rooms")},e=>{e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},e=>{e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},e=>{e.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],l=c.length;function u(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function h(e){return new Promise(((t,r)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&r(e._mx_abortexception),t(null)},e.onerror=t=>{void 0!==e._mx_abortexception?r(e._mx_abortexception):(o.logger.log("Error performing indexeddb txn",t),r(e.error))},e.onabort=t=>{void 0!==e._mx_abortexception?r(e._mx_abortexception):(o.logger.log("Error performing indexeddb txn",t),r(e.error))}}))}e.exports.VERSION=l})),i.register("iQAad",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.exists=function(e,t){return new Promise(((r,i)=>{let n=!0;const o=e.open(t);o.onupgradeneeded=()=>{n=!1},o.onblocked=()=>i(o.error),o.onsuccess=()=>{o.result.close(),n||e.deleteDatabase(t),r(n)},o.onerror=()=>i(o.error)}))}})),i.register("8Sn18",(function(e,t){let r;var i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SERVICE_TYPES=void 0,e.exports.SERVICE_TYPES=r,(i=r||(e.exports.SERVICE_TYPES=r={})).IS="SERVICE_TYPE_IS",i.IM="SERVICE_TYPE_IM"})),i.register("l5WvI",(function(e,t){var n=i("awmEs").Buffer,o=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IncomingRoomKeyRequest=e.exports.CryptoEvent=e.exports.Crypto=void 0,e.exports.fixBackupKey=Y,e.exports.isCryptoAvailable=function(){return Boolean(r.Olm)},e.exports.verificationMethods=void 0;var s=o(i("3EUCw")),a=o(i("1nB6h")),c=i("73W4W"),l=i("ldT3p"),u=i("eu84r"),h=i("gEWrD"),d=i("hUfPM"),f=K(i("dvbGC")),p=i("gSVCd"),m=i("iN8Ss"),g=K(i("8iY8t")),v=i("hclBt"),y=i("91Av2"),b=i("kf0mM"),w=i("dBHOk"),_=i("gH6iW"),S=i("iAFc0"),E=i("4nm41"),M=i("1AObg"),C=i("iyAPZ"),I=i("jcrlZ"),T=i("hflHR"),k=i("aAiXZ"),R=i("rPjr2"),x=i("dsM0i"),O=i("cCj6D"),A=i("ctOxk"),P=i("bdffL"),D=i("846Vo"),L=i("6koSf"),U=i("7BSj1"),N=i("5pxqF"),j=i("75Qdj"),B=i("l2mJP");function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(F=function(e){return e?r:t})(e)}function K(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=F(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}const $=m.DeviceInfo.DeviceVerification,W={[S.ReciprocateQRCode.NAME]:S.ReciprocateQRCode,[E.SAS.NAME]:E.SAS,[S.SHOW_QR_CODE_METHOD]:R.IllegalMethod,[S.SCAN_QR_CODE_METHOD]:R.IllegalMethod},V={RECIPROCATE_QR_CODE:S.ReciprocateQRCode.NAME,SAS:E.SAS.NAME};e.exports.verificationMethods=V;let H;var G;e.exports.CryptoEvent=H,(G=H||(e.exports.CryptoEvent=H={})).DeviceVerificationChanged="deviceVerificationChanged",G.UserTrustStatusChanged="userTrustStatusChanged",G.UserCrossSigningUpdated="userCrossSigningUpdated",G.RoomKeyRequest="crypto.roomKeyRequest",G.RoomKeyRequestCancellation="crypto.roomKeyRequestCancellation",G.KeyBackupStatus="crypto.keyBackupStatus",G.KeyBackupFailed="crypto.keyBackupFailed",G.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",G.KeySignatureUploadFailure="crypto.keySignatureUploadFailure",G.VerificationRequest="crypto.verification.request",G.Warning="crypto.warning",G.WillUpdateDevices="crypto.willUpdateDevices",G.DevicesUpdated="crypto.devicesUpdated",G.KeysChanged="crossSigning.keysChanged";class z extends j.TypedEventEmitter{static getOlmVersion(){return d.OlmDevice.getOlmVersion()}constructor(e,t,r,i,n,o,a){if(super(),this.baseApis=e,this.userId=t,this.deviceId=r,this.clientStore=i,this.cryptoStore=n,this.roomList=o,(0,s.default)(this,"backupManager",void 0),(0,s.default)(this,"crossSigningInfo",void 0),(0,s.default)(this,"olmDevice",void 0),(0,s.default)(this,"deviceList",void 0),(0,s.default)(this,"dehydrationManager",void 0),(0,s.default)(this,"secretStorage",void 0),(0,s.default)(this,"reEmitter",void 0),(0,s.default)(this,"verificationMethods",void 0),(0,s.default)(this,"supportedAlgorithms",void 0),(0,s.default)(this,"outgoingRoomKeyRequestManager",void 0),(0,s.default)(this,"toDeviceVerificationRequests",void 0),(0,s.default)(this,"inRoomVerificationRequests",void 0),(0,s.default)(this,"trustCrossSignedDevices",!0),(0,s.default)(this,"lastOneTimeKeyCheck",null),(0,s.default)(this,"oneTimeKeyCheckInProgress",!1),(0,s.default)(this,"roomEncryptors",new Map),(0,s.default)(this,"roomDecryptors",new Map),(0,s.default)(this,"deviceKeys",{}),(0,s.default)(this,"globalBlacklistUnverifiedDevices",!1),(0,s.default)(this,"globalErrorOnUnknownDevices",!0),(0,s.default)(this,"receivedRoomKeyRequests",[]),(0,s.default)(this,"receivedRoomKeyRequestCancellations",[]),(0,s.default)(this,"processingRoomKeyRequests",!1),(0,s.default)(this,"lazyLoadMembers",!1),(0,s.default)(this,"roomDeviceTrackingState",{}),(0,s.default)(this,"lastNewSessionForced",{}),(0,s.default)(this,"sendKeyRequestsImmediately",!1),(0,s.default)(this,"oneTimeKeyCount",void 0),(0,s.default)(this,"needsNewFallback",void 0),(0,s.default)(this,"fallbackCleanup",void 0),(0,s.default)(this,"onDeviceListUserCrossSigningUpdated",(async e=>{if(e===this.userId){const t=this.deviceList.getStoredCrossSigningForUser(e),r=t?t.getId():null,i=this.crossSigningInfo.getId();i&&r&&!(i!==r)?await this.checkOwnCrossSigningTrust():(this.storeTrustedSelfKeys(null),this.emit(H.KeysChanged,{}),this.emit(H.UserTrustStatusChanged,this.userId,this.checkUserTrust(e)))}else{await this.checkDeviceVerifications(e);const t=this.deviceList.getStoredCrossSigningForUser(e);t&&(t.updateCrossSigningVerifiedBefore(this.checkUserTrust(e).isCrossSigningVerified()),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage())),this.emit(H.UserTrustStatusChanged,e,this.checkUserTrust(e))}})),(0,s.default)(this,"onMembership",((e,t,r)=>{try{this.onRoomMembership(e,t,r)}catch(e){h.logger.error("Error handling membership change:",e)}})),(0,s.default)(this,"onToDeviceEvent",(e=>{try{h.logger.log(`received to-device ${e.getType()} from: ${e.getSender()} id: ${e.getContent()[l.ToDeviceMessageId]}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?this.secretStorage.onSecretReceived(e):"m.room_key.withheld"===e.getType()?this.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(this),e.once(U.MatrixEventEvent.Decrypted,(e=>{this.onToDeviceEvent(e)})))}catch(e){h.logger.error("Error handling toDeviceEvent:",e)}})),(0,s.default)(this,"onTimelineEvent",((e,t,r,i,{liveEvent:n=!0}={})=>{if(!T.InRoomChannel.validateEvent(e,this.baseApis))return;this.handleVerificationEvent(e,this.inRoomVerificationRequests,(e=>{const t=new T.InRoomChannel(this.baseApis,e.getRoomId());return new I.VerificationRequest(t,this.verificationMethods,this.baseApis)}),n)})),this.reEmitter=new u.TypedReEmitter(this),a){this.verificationMethods=new Map;for(const e of a)"string"==typeof e?W[e]&&this.verificationMethods.set(e,W[e]):e.NAME?this.verificationMethods.set(e.NAME,e):h.logger.warn(`Excluding unknown verification method ${e}`)}else this.verificationMethods=new Map(Object.entries(W));this.backupManager=new P.BackupManager(e,(async()=>{const e=await this.getSessionBackupPrivateKey();if(e)return e;const t=await this.getSecret("m.megolm_backup.v1");if(t){const e=Y(t);if(e){const t=await this.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",e,[t[0]])}return f.decodeBase64(e||t)}if(this.baseApis.cryptoCallbacks&&this.baseApis.cryptoCallbacks.getBackupKey)return this.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")})),this.olmDevice=new d.OlmDevice(n),this.deviceList=new p.DeviceList(e,n,this.olmDevice),this.deviceList.on(H.UserCrossSigningUpdated,this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,[H.DevicesUpdated,H.WillUpdateDevices]),this.supportedAlgorithms=Array.from(g.DECRYPTION_CLASSES.keys()),this.outgoingRoomKeyRequestManager=new w.OutgoingRoomKeyRequestManager(e,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new k.ToDeviceRequests,this.inRoomVerificationRequests=new T.InRoomRequests;const c=this.baseApis.cryptoCallbacks||{},m=(0,v.createCryptoStoreCacheCallbacks)(n,this.olmDevice);this.crossSigningInfo=new v.CrossSigningInfo(t,c,m),this.secretStorage=new b.SecretStorage(e,c,e),this.dehydrationManager=new A.DehydrationManager(this),!c.getCrossSigningKey&&c.getSecretStorageKey&&(c.getCrossSigningKey=async e=>v.CrossSigningInfo.getFromSecretStorage(e,this.secretStorage))}async init({exportedOlmDevice:e,pickleKey:t}={}){h.logger.log("Crypto: initialising Olm..."),await r.Olm.init(),h.logger.log(e?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this.olmDevice.init({fromExportedDevice:e,pickleKey:t}),h.logger.log("Crypto: loading device list..."),await this.deviceList.load(),this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,h.logger.log("Crypto: fetching own devices...");let i=this.deviceList.getRawStoredDevicesForUser(this.userId);if(i||(i={}),!i[this.deviceId]){h.logger.log("Crypto: adding this device to the store...");const e={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:$.VERIFIED,known:!0};i[this.deviceId]=e,this.deviceList.storeDevicesForUser(this.userId,i),this.deviceList.saveIfDirty()}await this.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.getCrossSigningKeys(e,(e=>{e&&0!==Object.keys(e).length&&(h.logger.log("Loaded cross-signing public keys from crypto store"),this.crossSigningInfo.setKeys(e))}))})),this.deviceList.startTrackingDeviceList(this.userId),h.logger.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart()}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setCryptoTrustCrossSignedDevices(e){this.trustCrossSignedDevices=e;for(const e of this.deviceList.getKnownUserIds()){const t=this.deviceList.getRawStoredDevicesForUser(e);for(const r of Object.keys(t)){const t=this.checkDeviceTrust(e,r);if(!t.isLocallyVerified()&&t.isCrossSigningVerified()){const t=this.deviceList.getStoredDevice(e,r);this.emit(H.DeviceVerificationChanged,e,r,t)}}}}async createRecoveryKeyFromPassphrase(e){const t=new r.Olm.PkDecryption;try{const r={};if(e){const i=await(0,M.keyFromPassphrase)(e);r.passphrase={algorithm:"m.pbkdf2",iterations:i.iterations,salt:i.salt},r.pubkey=t.init_with_private_key(i.key)}else r.pubkey=t.generate_key();const i=t.get_private_key();return{keyInfo:r,encodedPrivateKey:(0,C.encodeRecoveryKey)(i),privateKey:i}}finally{null==t||t.free()}}async userHasCrossSigningKeys(){return await this.downloadKeys([this.userId]),null!==this.deviceList.getStoredCrossSigningForUser(this.userId)}async isCrossSigningReady(){const e=this.crossSigningInfo.getId(),t=await this.crossSigningInfo.isStoredInKeyCache()||await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);return!(!e||!t)}async isSecretStorageReady(){const e=await this.secretStorage.hasKey(),t=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),r=!this.backupManager.getKeyBackupEnabled()||await this.baseApis.isKeyBackupKeyStored();return!!(e&&t&&r)}async bootstrapCrossSigning({authUploadDeviceSigningKeys:e,setupNewCrossSigning:t}={}){h.logger.log("Bootstrapping cross-signing");const r=this.baseApis.cryptoCallbacks,i=new y.EncryptionSetupBuilder(this.baseApis.store.accountData,r),n=new v.CrossSigningInfo(this.userId,i.crossSigningCallbacks,i.crossSigningCallbacks),o=async()=>{n.resetKeys(),await this.signObject(n.keys.master),i.addCrossSigningKeys(e,n.keys);const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),r=await n.signDevice(this.userId,t);i.addKeySignature(this.userId,this.deviceId,r),this.backupManager.backupInfo&&(await n.signObject(this.backupManager.backupInfo.auth_data,"master"),i.addSessionBackup(this.backupManager.backupInfo))},s=this.crossSigningInfo.getId(),a=await this.crossSigningInfo.isStoredInKeyCache(),c=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),l=a||c;h.logger.log({setupNewCrossSigning:t,publicKeysOnDevice:s,privateKeysInCache:a,privateKeysInStorage:c,privateKeysExistSomewhere:l}),!l||t?(h.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await o()):s&&a?h.logger.log("Cross-signing public keys trusted and private keys found locally"):c&&(h.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const u=i.crossSigningCallbacks.privateKeys;if(u.size&&!this.baseApis.cryptoCallbacks.saveCrossSigningKeys){const e=new b.SecretStorage(i.accountDataClientAdapter,i.ssssCryptoCallbacks,void 0);await e.hasKey()&&(h.logger.log("Storing new cross-signing private keys in secret storage"),await v.CrossSigningInfo.storeInSecretStorage(u,e))}const d=i.buildOperation();await d.apply(this),await i.persist(this),h.logger.log("Cross-signing ready")}async bootstrapSecretStorage({createSecretStorageKey:e=(async()=>({})),keyBackupInfo:t,setupNewKeyBackup:r,setupNewSecretStorage:i,getKeyBackupPassphrase:n}={}){h.logger.log("Bootstrapping Secure Secret Storage");const o=this.baseApis.cryptoCallbacks,s=new y.EncryptionSetupBuilder(this.baseApis.store.accountData,o),a=new b.SecretStorage(s.accountDataClientAdapter,s.ssssCryptoCallbacks,void 0);let c=null;const l=async(e,t)=>{t&&(e.key=t);const{keyId:r,keyInfo:i}=await a.addKey(b.SECRET_STORAGE_ALGORITHM_V1_AES,e);return t&&s.ssssCryptoCallbacks.addPrivateKey(r,i,t),await a.setDefaultKeyId(r),r},u=async(e,t)=>{if(!t.mac){var r,i;const n=await(null===(r=(i=this.baseApis.cryptoCallbacks).getSecretStorageKey)||void 0===r?void 0:r.call(i,{keys:{[e]:t}},""));if(n){const r=n[1];s.ssssCryptoCallbacks.addPrivateKey(e,t,r);const{iv:i,mac:o}=await(0,O.calculateKeyCheck)(r);t.iv=i,t.mac=o,await s.setAccountData(`m.secret_storage.key.${e}`,t)}}},d=async e=>{if(this.crossSigningInfo.getId()&&await this.crossSigningInfo.isStoredInKeyCache("master"))try{h.logger.log("Adding cross-signing signature to key backup"),await this.crossSigningInfo.signObject(e,"master")}catch(e){h.logger.error("Signing key backup with cross-signing keys failed",e)}else h.logger.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.getSecretStorageKey(),[m,g]=p||[null,null],w=!i&&g&&g.algorithm===b.SECRET_STORAGE_ALGORITHM_V1_AES;if(h.logger.log({keyBackupInfo:t,setupNewKeyBackup:r,setupNewSecretStorage:i,storageExists:w,oldKeyInfo:g}),w||t)if(!w&&t){h.logger.log("Secret storage does not exist, using key backup key");const e=await this.getSessionBackupPrivateKey()||await(null==n?void 0:n()),r={};t.auth_data.private_key_salt&&t.auth_data.private_key_iterations&&(r.passphrase={algorithm:"m.pbkdf2",iterations:t.auth_data.private_key_iterations,salt:t.auth_data.private_key_salt,bits:256}),c=await l(r,e),await a.store("m.megolm_backup.v1",f.encodeBase64(e),[c]),await d(t.auth_data),s.addSessionBackup(t)}else h.logger.log("Secret storage exists"),g&&g.algorithm===b.SECRET_STORAGE_ALGORITHM_V1_AES&&await u(m,g);else{h.logger.log("Secret storage does not exist, creating new storage key");const{keyInfo:t={},privateKey:r}=await e();c=await l(t,r)}if(!this.baseApis.cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(c||!await this.crossSigningInfo.isStoredInSecretStorage(a))){h.logger.log("Copying cross-signing private keys from cache to secret storage");const e=await this.crossSigningInfo.getCrossSigningKeysFromCache();await v.CrossSigningInfo.storeInSecretStorage(e,a)}if(r&&!t){h.logger.log("Creating new message key backup version");const e=await this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),t=(0,C.decodeRecoveryKey)(e.recovery_key);await a.store("m.megolm_backup.v1",f.encodeBase64(t));const r={algorithm:e.algorithm,auth_data:e.auth_data};await d(r.auth_data),await this.signObject(r.auth_data),s.addSessionBackup(r)}const _=await a.get("m.megolm_backup.v1");if(_){h.logger.info("Got session backup key from secret storage: caching");const e=Y(_);if(e){const t=c||m;await a.store("m.megolm_backup.v1",e,t?[t]:null)}const t=new Uint8Array(f.decodeBase64(e||_));s.addSessionBackupPrivateKeyToCache(t)}else if(this.backupManager.getKeyBackupEnabled()){const e=await this.getSessionBackupPrivateKey()||await(null==n?void 0:n());if(!e)return void h.logger.error("Key backup is enabled but couldn't get key backup key!");h.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),await a.store("m.megolm_backup.v1",f.encodeBase64(e))}const S=s.buildOperation();await S.apply(this),await s.persist(this),h.logger.log("Secure Secret Storage ready")}addSecretStorageKey(e,t,r){return this.secretStorage.addKey(e,t,r)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}getSecretStorageKey(e){return this.secretStorage.getKey(e)}storeSecret(e,t,r){return this.secretStorage.store(e,t,r)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e){return this.secretStorage.isStored(e)}requestSecret(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStorageKey(e,t){return this.secretStorage.checkKey(e,t)}checkSecretStoragePrivateKey(e,t){let i=null;try{i=new r.Olm.PkDecryption;return i.init_with_private_key(e)===t}finally{var n;null===(n=i)||void 0===n||n.free()}}async getSessionBackupPrivateKey(){let e=await new Promise((e=>{this.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));if(e&&"string"==typeof e&&(e=new Uint8Array(f.decodeBase64(Y(e)||e)),await this.storeSessionBackupPrivateKey(e)),e&&e.ciphertext){const t=n.from(this.olmDevice.pickleKey),r=await(0,O.decryptAES)(e,t,"m.megolm_backup.v1");e=f.decodeBase64(r)}return e}async storeSessionBackupPrivateKey(e){if(!(e instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${e}`);const t=n.from(this.olmDevice.pickleKey),r=await(0,O.encryptAES)(f.encodeBase64(e),t,"m.megolm_backup.v1");return this.cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",r)}))}checkCrossSigningPrivateKey(e,t){let i=null;try{i=new r.Olm.PkSigning;return i.init_with_seed(e)===t}finally{var n;null===(n=i)||void 0===n||n.free()}}async afterCrossSigningLocalKeyChange(){h.logger.info("Starting cross-signing key change post-processing");const e=this.deviceList.getStoredDevice(this.userId,this.deviceId),t=await this.crossSigningInfo.signDevice(this.userId,e);h.logger.info(`Starting background key sig upload for ${this.deviceId}`);const r=({shouldEmit:e=!1})=>this.baseApis.uploadKeySignatures({[this.userId]:{[this.deviceId]:t}}).then((t=>{const{failures:i}=t||{};if(Object.keys(i||[]).length>0)throw e&&this.baseApis.emit(H.KeySignatureUploadFailure,i,"afterCrossSigningLocalKeyChange",r),new x.KeySignatureUploadError("Key upload failed",{failures:i});h.logger.info(`Finished background key sig upload for ${this.deviceId}`)})).catch((e=>{h.logger.error(`Error during background key sig upload for ${this.deviceId}`,e)}));r({shouldEmit:!0});const i=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(i){h.logger.info("Starting device verification upgrade");const e={};for(const[t,r]of Object.entries(this.deviceList.crossSigningInfo)){const i=await this.checkForDeviceVerificationUpgrade(t,v.CrossSigningInfo.fromStorage(r,t));i&&(e[t]=i)}if(Object.keys(e).length>0){h.logger.info(`Found ${Object.keys(e).length} verif users to upgrade`);try{const t=await i({users:e});if(t)for(const r of t)r in e&&await this.baseApis.setDeviceVerified(r,e[r].crossSigningInfo.getId())}catch(e){h.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}h.logger.info("Finished device verification upgrade")}h.logger.info("Finished cross-signing key change post-processing")}async checkForDeviceVerificationUpgrade(e,t){const r=this.crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!r.isVerified()){const r=this.deviceList.getRawStoredDevicesForUser(e),i=await this.checkForValidDeviceSignature(e,t.keys.master,r);if(i.length)return{devices:i.map((e=>m.DeviceInfo.fromStorage(r[e],e))),crossSigningInfo:t}}}async checkForValidDeviceSignature(e,t,r){const i=[];if(r&&t.signatures&&t.signatures[e])for(const n of Object.keys(t.signatures[e])){const[,o]=n.split(":",2);if(o in r&&r[o].verified===$.VERIFIED)try{await f.verifySignature(this.olmDevice,t,e,o,r[o].keys[n]),i.push(o)}catch(e){}}return i}getCrossSigningId(e){return this.crossSigningInfo.getId(e)}getStoredCrossSigningForUser(e){return this.deviceList.getStoredCrossSigningForUser(e)}checkUserTrust(e){const t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new v.UserTrustLevel(!1,!1,!1)}checkDeviceTrust(e,t){const r=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,r)}checkDeviceInfoTrust(e,t){const r=!(null==t||!t.isVerified()),i=this.deviceList.getStoredCrossSigningForUser(e);if(t&&i){const n=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(i,t,r,n)}return new v.DeviceTrustLevel(!1,!1,r,!1)}checkIfOwnDeviceCrossSigned(e){var t;const r=this.deviceList.getStoredDevice(this.userId,e);if(!r)return!1;const i=this.deviceList.getStoredCrossSigningForUser(this.userId);return null!==(t=null==i?void 0:i.checkDeviceTrust(i,r,!1,!0).isCrossSigningVerified())&&void 0!==t&&t}async checkOwnCrossSigningTrust({allowPrivateKeyRequests:e=!1}={}){const t=this.userId;await this.downloadKeys([this.userId]);const r=await this.crossSigningInfo.getCrossSigningKeysFromCache(),i=this.deviceList.getStoredCrossSigningForUser(t);if(!i)return void h.logger.error("Got cross-signing update event for user "+t+" but no new cross-signing information found!");const n=i.getId(),o=this.crossSigningInfo.getId()!==n,s=i.getId()&&!r.has("master");if(o&&h.logger.info("Got new master public key",n),e&&(o||s)){h.logger.info("Attempting to retrieve cross-signing master private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("master",n))[1],h.logger.info("Got cross-signing master private key")}finally{var a;null===(a=e)||void 0===a||a.free()}}const c=this.crossSigningInfo.getId("self_signing"),l=this.crossSigningInfo.getId("user_signing");this.storeTrustedSelfKeys(i.keys);const u=c!==i.getId("self_signing"),d=l!==i.getId("user_signing"),f=i.getId("self_signing")&&!r.has("self_signing"),p=i.getId("user_signing")&&!r.has("user_signing"),m={};if(u&&h.logger.info("Got new self-signing key",i.getId("self_signing")),e&&(u||f)){h.logger.info("Attempting to retrieve cross-signing self-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("self_signing",i.getId("self_signing")))[1],h.logger.info("Got cross-signing self-signing private key")}finally{var g;null===(g=e)||void 0===g||g.free()}const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),r=await this.crossSigningInfo.signDevice(this.userId,t);m[this.deviceId]=r}if(d&&h.logger.info("Got new user-signing key",i.getId("user_signing")),e&&(d||p)){h.logger.info("Attempting to retrieve cross-signing user-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("user_signing",i.getId("user_signing")))[1],h.logger.info("Got cross-signing user-signing private key")}finally{var v;null===(v=e)||void 0===v||v.free()}}if(o){const e=this.crossSigningInfo.keys.master;await this.signObject(e);const t=e.signatures[this.userId]["ed25519:"+this.deviceId];m[this.crossSigningInfo.getId()]=Object.assign({},e,{signatures:{[this.userId]:{["ed25519:"+this.deviceId]:t}}})}const y=Object.keys(m);if(y.length){const e=({shouldEmit:t=!1})=>(h.logger.info(`Starting background key sig upload for ${y}`),this.baseApis.uploadKeySignatures({[this.userId]:m}).then((r=>{const{failures:i}=r||{};if(h.logger.info(`Finished background key sig upload for ${y}`),Object.keys(i||[]).length>0)throw t&&this.baseApis.emit(H.KeySignatureUploadFailure,i,"checkOwnCrossSigningTrust",e),new x.KeySignatureUploadError("Key upload failed",{failures:i})})).catch((e=>{h.logger.error(`Error during background key sig upload for ${y}`,e)})));e({shouldEmit:!0})}this.emit(H.UserTrustStatusChanged,t,this.checkUserTrust(t)),o&&(this.emit(H.KeysChanged,{}),await this.afterCrossSigningLocalKeyChange()),await this.backupManager.checkKeyBackup()}async storeTrustedSelfKeys(e){e?this.crossSigningInfo.setKeys(e):this.crossSigningInfo.clearKeys(),await this.cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeCrossSigningKeys(e,this.crossSigningInfo.keys)}))}async checkDeviceVerifications(e){const t=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(t){if(h.logger.info(`Starting device verification upgrade for ${e}`),this.crossSigningInfo.keys.user_signing){const r=this.deviceList.getStoredCrossSigningForUser(e);if(r){const i=await this.checkForDeviceVerificationUpgrade(e,r);if(i){(await t({users:{[e]:i}})).includes(e)&&await this.baseApis.setDeviceVerified(e,r.getId())}}}h.logger.info(`Finished device verification upgrade for ${e}`)}}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(e){e.on(L.RoomMemberEvent.Membership,this.onMembership),e.on(N.ClientEvent.ToDeviceEvent,this.onToDeviceEvent),e.on(D.RoomEvent.Timeline,this.onTimelineEvent),e.on(U.MatrixEventEvent.Decrypted,this.onTimelineEvent)}start(){h.logger.warn("MatrixClient.crypto.start() is deprecated")}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}setGlobalBlacklistUnverifiedDevices(e){this.globalBlacklistUnverifiedDevices=e}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}uploadDeviceKeys(){const e={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(e).then((()=>this.baseApis.uploadKeysRequest({device_keys:e})))}updateOneTimeKeyCount(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}setNeedsNewFallback(e){this.needsNewFallback=e}getNeedsNewFallback(){return!!this.needsNewFallback}maybeUploadOneTimeKeys(){if(this.oneTimeKeyCheckInProgress)return;const e=Date.now();if(null!==this.lastOneTimeKeyCheck&&e-this.lastOneTimeKeyCheck<6e4)return;this.lastOneTimeKeyCheck=e;const t=this.olmDevice.maxNumberOfOneTimeKeys(),r=Math.floor(t/2),i=async e=>{for(;r>e||this.getNeedsNewFallback();){if(r>e){h.logger.info("generating oneTimeKeys");const t=Math.min(r-e,5);await this.olmDevice.generateOneTimeKeys(t)}if(this.getNeedsNewFallback()){const e=await this.olmDevice.getFallbackKey();e.curve25519&&0!=Object.keys(e.curve25519).length||(h.logger.info("generating fallback key"),this.fallbackCleanup&&(clearTimeout(this.fallbackCleanup),delete this.fallbackCleanup),await this.olmDevice.generateFallbackKey())}h.logger.info("calling uploadOneTimeKeys");const t=await this.uploadOneTimeKeys();if(!t.one_time_key_counts||!t.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");e=t.one_time_key_counts.signed_curve25519}};this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((()=>void 0!==this.oneTimeKeyCount?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then((e=>e.one_time_key_counts.signed_curve25519||0)))).then((e=>i(e))).catch((e=>{h.logger.error("Error uploading one-time keys",e.stack||e)})).finally((()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1}))}async uploadOneTimeKeys(){const e=[];let t;if(this.getNeedsNewFallback()){t={};const r=await this.olmDevice.getFallbackKey();for(const[i,n]of Object.entries(r.curve25519)){const r={key:n,fallback:!0};t["signed_curve25519:"+i]=r,e.push(this.signObject(r))}this.setNeedsNewFallback(!1)}const r=await this.olmDevice.getOneTimeKeys(),i={};for(const t in r.curve25519)if(r.curve25519.hasOwnProperty(t)){const n={key:r.curve25519[t]};i["signed_curve25519:"+t]=n,e.push(this.signObject(n))}await Promise.all(e);const n={one_time_keys:i};t&&(n["org.matrix.msc2732.fallback_keys"]=t,n.fallback_keys=t);const o=await this.baseApis.uploadKeysRequest(n);return t&&(this.fallbackCleanup=setTimeout((()=>{delete this.fallbackCleanup,this.olmDevice.forgetOldFallbackKey()}),36e5)),await this.olmDevice.markKeysAsPublished(),o}downloadKeys(e,t){return this.deviceList.downloadKeys(e,!!t)}getStoredDevicesForUser(e){return this.deviceList.getStoredDevicesForUser(e)}getStoredDevice(e,t){return this.deviceList.getStoredDevice(e,t)}saveDeviceList(e){return this.deviceList.saveIfDirty(e)}async setDeviceVerification(e,t,r=null,i=null,n=null,o){const s=this.deviceList.getStoredCrossSigningForUser(e);if(s&&s.getId()===t){if(null!==i||null!==n)throw new Error("Cannot set blocked or known for a cross-signing key");if(!r)throw new Error("Cannot set a cross-signing key as unverified");const a=o?Object.values(o)[0]:null;if(o&&(1!==Object.values(o).length||a!==s.getId()))throw new Error(`Key did not match expected value: expected ${s.getId()}, got ${a}`);if(this.crossSigningInfo.getId()||e!==this.crossSigningInfo.userId||(this.storeTrustedSelfKeys(s.keys),this.emit(H.UserTrustStatusChanged,this.userId,this.checkUserTrust(e))),e!==this.userId){h.logger.info("Master key "+s.getId()+" for "+e+" marked verified. Signing...");const r=await this.crossSigningInfo.signUser(s);if(r){const i=async({shouldEmit:n=!1})=>{h.logger.info("Uploading signature for "+e+"...");const o=await this.baseApis.uploadKeySignatures({[e]:{[t]:r}}),{failures:s}=o||{};if(Object.keys(s||[]).length>0)throw n&&this.baseApis.emit(H.KeySignatureUploadFailure,s,"setDeviceVerification",i),new x.KeySignatureUploadError("Key upload failed",{failures:s})};await i({shouldEmit:!0})}return r}return s}const a=this.deviceList.getRawStoredDevicesForUser(e);if(!a||!a[t])throw new Error("Unknown device "+e+":"+t);const c=a[t];let l=c.verified;if(r){if(o)for(const[e,t]of Object.entries(o))if(c.keys[e]!==t)throw new Error(`Key did not match expected value: expected ${t}, got ${c.keys[e]}`);l=$.VERIFIED}else null!==r&&l==$.VERIFIED&&(l=$.UNVERIFIED);i?l=$.BLOCKED:null!==i&&l==$.BLOCKED&&(l=$.UNVERIFIED);let u=c.known;if(null!==n&&(u=n),c.verified===l&&c.known===u||(c.verified=l,c.known=u,this.deviceList.storeDevicesForUser(e,a),this.deviceList.saveIfDirty()),r&&e===this.userId){let r;h.logger.info("Own device "+t+" marked verified: signing");if(this.checkDeviceTrust(e,t).isCrossSigningVerified()?h.logger.log(`Own device ${t} already cross-signing verified`):r=await this.crossSigningInfo.signDevice(e,m.DeviceInfo.fromStorage(c,t)),r){const i=async({shouldEmit:n=!1})=>{h.logger.info("Uploading signature for "+t);const o=await this.baseApis.uploadKeySignatures({[e]:{[t]:r}}),{failures:s}=o||{};if(Object.keys(s||[]).length>0)throw n&&this.baseApis.emit(H.KeySignatureUploadFailure,s,"setDeviceVerification",i),new x.KeySignatureUploadError("Key upload failed",{failures:s})};await i({shouldEmit:!0})}}const d=m.DeviceInfo.fromStorage(c,t);return this.emit(H.DeviceVerificationChanged,e,t,d),d}findVerificationRequestDMInProgress(e){return this.inRoomVerificationRequests.findRequestInProgress(e)}getVerificationRequestsToDeviceInProgress(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}requestVerificationDM(e,t){const r=this.inRoomVerificationRequests.findRequestInProgress(t);if(r)return Promise.resolve(r);const i=new T.InRoomChannel(this.baseApis,t,e);return this.requestVerificationWithChannel(e,i,this.inRoomVerificationRequests)}requestVerification(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));const r=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(r)return Promise.resolve(r);const i=new k.ToDeviceChannel(this.baseApis,e,t,k.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(e,i,this.toDeviceVerificationRequests)}async requestVerificationWithChannel(e,t,r){let i=new I.VerificationRequest(t,this.verificationMethods,this.baseApis);t.transactionId&&r.setRequestByChannel(t,i),await i.sendRequest();const n=r.getRequestByChannel(t);return n?i=n:(h.logger.log(`Crypto: adding new request to requestsByTxnId with id ${t.transactionId} ${t.roomId}`),r.setRequestByChannel(t,i)),i}beginKeyVerification(e,t,r,i=null){let n;if(i){if(n=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,i),!n)throw new Error(`No request found for user ${t} with transactionId ${i}`)}else{i=k.ToDeviceChannel.makeTransactionId();const e=new k.ToDeviceChannel(this.baseApis,t,[r],i,r);n=new I.VerificationRequest(e,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,n)}return n.beginKeyVerification(e,{userId:t,deviceId:r})}async legacyDeviceVerification(e,t,r){const i=k.ToDeviceChannel.makeTransactionId(),n=new k.ToDeviceChannel(this.baseApis,e,[t],i,t),o=new I.VerificationRequest(n,this.verificationMethods,this.baseApis);this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,i,o);const s=o.beginKeyVerification(r,{userId:e,deviceId:t});return await Promise.race([s.verify(),o.waitFor((e=>e.started))]),o}async getOlmSessionsForUser(e){const t=this.getStoredDevicesForUser(e)||[],r={};for(const e of t){const t=e.getIdentityKey(),i=await this.olmDevice.getSessionInfoForDevice(t);r[e.deviceId]={deviceIdKey:t,sessions:i}}return r}getEventSenderDeviceInfo(e){const t=e.getSenderKey(),r=e.getWireContent().algorithm;if(!t||!r)return null;if(e.isKeySourceUntrusted())return null;const i=this.deviceList.getDeviceByIdentityKey(r,t);if(null===i)return null;const n=e.getClaimedEd25519Key();return n?n!==i.getFingerprint()?(h.logger.warn("Event "+e.getId()+" claims ed25519 key "+n+" but sender device has key "+i.getFingerprint()),null):i:(h.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(e){var t,r;const i={};if(i.senderKey=null!==(t=e.getSenderKey())&&void 0!==t?t:void 0,i.algorithm=e.getWireContent().algorithm,!i.senderKey||!i.algorithm)return i.encrypted=!1,i;i.encrypted=!0,e.isKeySourceUntrusted()?i.authenticated=!1:i.authenticated=!0,i.sender=null!==(r=this.deviceList.getDeviceByIdentityKey(i.algorithm,i.senderKey))&&void 0!==r?r:void 0;const n=e.getClaimedEd25519Key();return n||(h.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),i.mismatchedSender=!0),i.sender&&n!==i.sender.getFingerprint()&&(h.logger.warn("Event "+e.getId()+" claims ed25519 key "+n+"but sender device has key "+i.sender.getFingerprint()),i.mismatchedSender=!0),i}forceDiscardSession(e){const t=this.roomEncryptors.get(e);if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()}async setRoomEncryption(e,t,r){const i=this.clientStore.getRoom(e);if(!i)throw new Error(`Unable to enable encryption tracking devices in unknown room ${e}`);await this.setRoomEncryptionImpl(i,t),this.lazyLoadMembers||r||this.deviceList.refreshOutdatedDeviceLists()}async setRoomEncryptionImpl(e,t){const r=e.roomId;if(!t.algorithm)return void h.logger.log("Ignoring setRoomEncryption with no algorithm");const i=this.roomList.getRoomEncryption(r);if(i&&JSON.stringify(i)!=JSON.stringify(t))return void h.logger.error("Ignoring m.room.encryption event which requests a change of config in "+r);if(this.roomEncryptors.get(r))return;let n=null;i||(n=this.roomList.setRoomEncryption(r,t));const o=g.ENCRYPTION_CLASSES.get(t.algorithm);if(!o)throw new Error("Unable to encrypt with "+t.algorithm);const s=new o({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:r,config:t});if(this.roomEncryptors.set(r,s),n&&await n,h.logger.log(`Enabling encryption in ${r}`),e.membersLoaded())await this.trackRoomDevicesImpl(e);else{const t=i=>{e.off(B.RoomStateEvent.Update,t),e.membersLoaded()&&this.trackRoomDevicesImpl(e).catch((e=>{h.logger.error(`Error enabling device tracking in ${r}`,e)}))};e.on(B.RoomStateEvent.Update,t)}}trackRoomDevices(e){const t=this.clientStore.getRoom(e);if(!t)throw new Error(`Unable to start tracking devices in unknown room ${e}`);return this.trackRoomDevicesImpl(t)}trackRoomDevicesImpl(e){const t=e.roomId,r=async()=>{if(!this.roomEncryptors.has(t))return;h.logger.log(`Starting to track devices for room ${t} ...`);(await e.getEncryptionTargetMembers()).forEach((e=>{this.deviceList.startTrackingDeviceList(e.userId)}))};let i=this.roomDeviceTrackingState[t];return i||(i=r(),this.roomDeviceTrackingState[t]=i.catch((e=>{throw delete this.roomDeviceTrackingState[t],e}))),i}ensureOlmSessionsForUsers(e,t){const r={};for(const t of e){r[t]=[];const e=this.getStoredDevicesForUser(t)||[];for(const i of e){i.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(i.verified!=$.BLOCKED&&r[t].push(i))}}return f.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,r,t)}async exportRoomKeys(){const e=[];return await this.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(t=>{this.cryptoStore.getAllEndToEndInboundGroupSessions(t,(t=>{if(null===t)return;const r=this.olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete r.first_known_index,r.algorithm=f.MEGOLM_ALGORITHM,e.push(r)}))})),e}importRoomKeys(e,t={}){let r=0,i=0;const n=e.length;function o(){var e;null===(e=t.progressCallback)||void 0===e||e.call(t,{stage:"load_keys",successes:r,failures:i,total:n})}return Promise.all(e.map((e=>{if(!e.room_id||!e.algorithm)return h.logger.warn("ignoring room key entry with missing fields",e),i++,t.progressCallback&&o(),null;return this.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((()=>{r++,t.progressCallback&&o()}))}))).then()}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(e){const t=this.roomEncryptors.get(e.roomId);t&&t.prepareToEncrypt(e)}async encryptEvent(e,t){const r=e.getRoomId(),i=this.roomEncryptors.get(r);if(!i)throw new Error("Room "+r+" was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");await this.trackRoomDevicesImpl(t);let n=e.getContent();const o=n["m.relates_to"];o&&(n=Object.assign({},n),delete n["m.relates_to"]);const s=n["io.element.performance_metrics"];s&&(n=Object.assign({},n),delete n["io.element.performance_metrics"]);const a=await i.encryptMessage(t,e.getType(),n);o&&(a["m.relates_to"]=o),s&&(a["io.element.performance_metrics"]=s),e.makeEncrypted("m.room.encrypted",a,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key)}async decryptEvent(e){if(e.isRedacted()){const t=new U.MatrixEvent(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({room_id:e.getRoomId()},e.getUnsigned().redacted_because));let r=e.getUnsigned().redacted_because;if(t.isEncrypted())try{r=(await this.decryptEvent(t)).clearEvent}catch(e){h.logger.warn("Decryption of redaction failed. Falling back to unencrypted event.",e)}return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:r}}}}{const t=e.getWireContent();return this.getRoomDecryptor(e.getRoomId(),t.algorithm).decryptEvent(e)}}async handleDeviceListChanges(e,t){e.oldSyncToken&&await this.evalDeviceListChanges(t)}requestRoomKey(e,t,r=!1){return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,r).then((()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((e=>{h.logger.error("Error requesting key for event",e)}))}cancelRoomKeyRequest(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((e=>{h.logger.warn("Error clearing pending room key requests",e)}))}async cancelAndResendAllOutgoingKeyRequests(){await this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()}async onCryptoEvent(e,t){const r=t.getContent();await this.setRoomEncryptionImpl(e,r)}async onSyncWillProcess(e){e.oldSyncToken||(h.logger.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1}async onSyncCompleted(e){var t;this.deviceList.setSyncToken(null!==(t=e.nextSyncToken)&&void 0!==t?t:null),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0)}async evalDeviceListChanges(e){if(Array.isArray(null==e?void 0:e.changed)&&e.changed.forEach((e=>{this.deviceList.invalidateUserDeviceList(e)})),Array.isArray(null==e?void 0:e.left)&&e.left.length){const t=new Set(await this.getTrackedE2eUsers());e.left.forEach((e=>{t.has(e)||this.deviceList.stopTrackingDeviceList(e)}))}}async getTrackedE2eUsers(){const e=[];for(const t of this.getTrackedE2eRooms()){const r=await t.getEncryptionTargetMembers();for(const t of r)e.push(t.userId)}return e}getTrackedE2eRooms(){return this.clientStore.getRooms().filter((e=>{if(!this.roomEncryptors.get(e.roomId))return!1;if(!this.roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t}))}async encryptAndSendToDevices(e,t){const r={eventType:l.EventType.RoomMessageEncrypted,batch:[]};try{await Promise.all(e.map((async({userId:e,deviceInfo:i})=>{const n=i.deviceId,o={algorithm:f.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[l.ToDeviceMessageId]:(0,c.default)()};r.batch.push({userId:e,deviceId:n,payload:o}),await f.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[e]:[i]}),await f.encryptMessageForDevice(o.ciphertext,this.userId,this.deviceId,this.olmDevice,e,i,t)}))),r.batch=r.batch.filter((e=>Object.keys(e.payload.ciphertext).length>0||(h.logger.log(`No ciphertext for device ${e.userId}:${e.deviceId}: pruning`),!1)));try{await this.baseApis.queueToDevice(r)}catch(e){throw h.logger.error("sendToDevice failed",e),e}}catch(e){throw h.logger.error("encryptAndSendToDevices promises failed",e),e}}async preprocessToDeviceMessages(e){return e.filter((e=>{var t;return!(e.type===l.EventType.RoomMessageEncrypted&&!["m.olm.v1.curve25519-aes-sha2"].includes(null===(t=e.content)||void 0===t?void 0:t.algorithm))||(h.logger.log("Ignoring invalid encrypted to-device event from "+e.sender),!1)}))}onRoomKeyEvent(e){const t=e.getContent();if(!t.room_id||!t.algorithm)return void h.logger.error("key event is missing fields");this.backupManager.checkedForBackup||this.backupManager.checkAndStart();this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)}onRoomKeyWithheldEvent(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void h.logger.error("key withheld event is missing fields");h.logger.info(`Got room key withheld event from ${e.getSender()} for ${t.algorithm} session ${t.sender_key}|${t.session_id} in room ${t.room_id} with code ${t.code} (${t.reason})`);const r=this.getRoomDecryptor(t.room_id,t.algorithm);if(r.onRoomKeyWithheldEvent&&r.onRoomKeyWithheldEvent(e),!t.room_id){const e=this.getRoomDecryptors(t.algorithm);for(const r of e)r.retryDecryptionFromSender(t.sender_key)}}onKeyVerificationMessage(e){if(!k.ToDeviceChannel.validateEvent(e,this.baseApis))return;this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(e=>{if(!k.ToDeviceChannel.canCreateRequest(k.ToDeviceChannel.getEventType(e)))return;const t=e.getContent(),r=t&&t.from_device;if(!r)return;const i=e.getSender(),n=new k.ToDeviceChannel(this.baseApis,i,[r]);return new I.VerificationRequest(n,this.verificationMethods,this.baseApis)}))}async handleVerificationEvent(e,t,r,i=!0){if(e.isSending()&&e.status!=U.EventStatus.SENT){let t,r;try{await new Promise(((i,n)=>{t=i,r=()=>{e.status==U.EventStatus.CANCELLED&&n(new Error("Event status set to CANCELLED."))},e.once(U.MatrixEventEvent.LocalEventIdReplaced,t),e.on(U.MatrixEventEvent.Status,r)}))}catch(e){return void h.logger.error("error while waiting for the verification event to be sent: ",e)}finally{e.removeListener(U.MatrixEventEvent.LocalEventIdReplaced,t),e.removeListener(U.MatrixEventEvent.Status,r)}}let n=t.getRequest(e),o=!1;if(!n){if(n=r(e),!n)return void h.logger.log(`Crypto: could not find VerificationRequest for ${e.getType()}, and could not create one, so ignoring.`);o=!0,t.setRequest(e,n)}e.setVerificationRequest(n);try{await n.channel.handleEvent(e,n,i)}catch(e){h.logger.error("error while handling verification event",e)}o&&!n.initiatedByMe&&!n.invalid&&!n.observeOnly&&this.baseApis.emit(H.VerificationRequest,n)}async onToDeviceBadEncrypted(e){const t=e.getWireContent(),r=e.getSender(),i=t.algorithm,n=t.sender_key;this.baseApis.emit(N.ClientEvent.UndecryptableToDeviceEvent,e);const o=()=>{const e=this.getRoomDecryptors(f.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(n)};if(void 0===r||void 0===n||void 0===n)return;this.lastNewSessionForced[r]=this.lastNewSessionForced[r]||{};const s=this.lastNewSessionForced[r][n]||0;if(s+36e5>Date.now())return h.logger.debug("New session already forced with device "+r+":"+n+" at "+s+": not forcing another"),await this.olmDevice.recordSessionProblem(n,"wedged",!0),void o();let a=this.deviceList.getDeviceByIdentityKey(i,n);if(!a&&(await this.downloadKeys([r],!1),a=this.deviceList.getDeviceByIdentityKey(i,n),!a))return h.logger.info("Couldn't find device for identity key "+n+": not re-establishing session"),await this.olmDevice.recordSessionProblem(n,"wedged",!1),void o();const u={};u[r]=[a],await f.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,u,!0),this.lastNewSessionForced[r][n]=Date.now();const d={algorithm:f.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[l.ToDeviceMessageId]:(0,c.default)()};await f.encryptMessageForDevice(d.ciphertext,this.userId,this.deviceId,this.olmDevice,r,a,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(n,"wedged",!0),o(),await this.baseApis.sendToDevice("m.room.encrypted",{[r]:{[a.deviceId]:d}});const p=await this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(r,a.deviceId);for(const e of p)this.requestRoomKey(e.requestBody,e.recipients,!0)}onRoomMembership(e,t,r){const i=t.roomId,n=this.roomEncryptors.get(i);if(n){var o;if(i in this.roomDeviceTrackingState)"join"==t.membership?(h.logger.log("Join event for "+t.userId+" in "+i),this.deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&null!==(o=this.clientStore.getRoom(i))&&void 0!==o&&o.shouldEncryptForInvitedMembers()&&(h.logger.log("Invite event for "+t.userId+" in "+i),this.deviceList.startTrackingDeviceList(t.userId));n.onRoomMembership(e,t,r)}}onRoomKeyRequestEvent(e){const t=e.getContent();if("request"===t.action){const t=new J(e);this.receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new Z(e);this.receivedRoomKeyRequestCancellations.push(t)}}async processReceivedRoomKeyRequests(){if(!this.processingRoomKeyRequests){this.processingRoomKeyRequests=!0;try{const e=this.receivedRoomKeyRequests;this.receivedRoomKeyRequests=[];const t=this.receivedRoomKeyRequestCancellations;this.receivedRoomKeyRequestCancellations=[],await Promise.all(e.map((e=>this.processReceivedRoomKeyRequest(e)))),await Promise.all(t.map((e=>this.processReceivedRoomKeyRequestCancellation(e))))}catch(e){h.logger.error(`Error processing room key requsts: ${e}`)}finally{this.processingRoomKeyRequests=!1}}}async processReceivedRoomKeyRequest(e){const t=e.userId,r=e.deviceId,i=e.requestBody,n=i.room_id,o=i.algorithm;if(h.logger.log(`m.room_key_request from ${t}:${r} for ${n} / ${i.session_id} (id ${e.requestId})`),t!==this.userId){if(!this.roomEncryptors.get(n))return void h.logger.debug(`room key request for unencrypted room ${n}`);const e=this.roomEncryptors.get(n),o=this.deviceList.getStoredDevice(t,r);if(!o)return void h.logger.debug(`Ignoring keyshare for unknown device ${t}:${r}`);try{await e.reshareKeyWithDevice(i.sender_key,i.session_id,t,o)}catch(e){h.logger.warn("Failed to re-share keys for session "+i.session_id+" with device "+t+":"+o.deviceId,e)}return}if(r===this.deviceId)return void h.logger.log("Ignoring room key request from ourselves");if(!this.roomDecryptors.has(n))return void h.logger.log(`room key request for unencrypted room ${n}`);const s=this.roomDecryptors.get(n).get(o);if(s)if(await s.hasKeysForKeyRequest(e)){if(e.share=()=>{s.shareKeysWithDevice(e)},this.checkDeviceTrust(t,r).isVerified())return h.logger.log("device is already verified: sharing keys"),void e.share();this.emit(H.RoomKeyRequest,e)}else h.logger.log(`room key request for unknown session ${n} / `+i.session_id);else h.logger.log(`room key request for unknown alg ${o} in room ${n}`)}async processReceivedRoomKeyRequestCancellation(e){h.logger.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit(H.RoomKeyRequestCancellation,e)}getRoomDecryptor(e,t){let r,i;if(e&&(r=this.roomDecryptors.get(e),r||(r=new Map,this.roomDecryptors.set(e,r)),i=r.get(t),i))return i;const n=g.DECRYPTION_CLASSES.get(t);if(!n)throw new g.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return i=new n({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:null!=e?e:void 0}),r&&r.set(t,i),i}getRoomDecryptors(e){const t=[];for(const r of this.roomDecryptors.values())r.has(e)&&t.push(r.get(e));return t}async signObject(e){const t=e.signatures||{},r=e.unsigned;delete e.signatures,delete e.unsigned,t[this.userId]=t[this.userId]||{},t[this.userId]["ed25519:"+this.deviceId]=await this.olmDevice.sign(a.default.stringify(e)),e.signatures=t,void 0!==r&&(e.unsigned=r)}}function Y(e){if("string"!=typeof e||e.indexOf(",")<0)return null;const t=Uint8Array.from(e.split(","),(e=>parseInt(e)));return f.encodeBase64(t)}e.exports.Crypto=z;class J{constructor(e){(0,s.default)(this,"userId",void 0),(0,s.default)(this,"deviceId",void 0),(0,s.default)(this,"requestId",void 0),(0,s.default)(this,"requestBody",void 0),(0,s.default)(this,"share",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}e.exports.IncomingRoomKeyRequest=J;class Z{constructor(e){(0,s.default)(this,"userId",void 0),(0,s.default)(this,"deviceId",void 0),(0,s.default)(this,"requestId",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}})),i.register("hUfPM",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WITHHELD_MESSAGES=e.exports.PayloadTooLargeError=e.exports.OlmDevice=void 0;var o=n(i("3EUCw")),s=i("gEWrD"),a=i("gH6iW"),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("8iY8t"));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}const u=49152;class h extends Error{constructor(...e){super(...e),(0,o.default)(this,"data",{errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"})}}function d(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>u)throw new h(`Message too long (${e.length} bytes). The maximum for an encrypted message is ${u} bytes.`)}e.exports.PayloadTooLargeError=h;e.exports.OlmDevice=class{constructor(e){this.cryptoStore=e,(0,o.default)(this,"pickleKey","DEFAULT_KEY"),(0,o.default)(this,"deviceCurve25519Key",null),(0,o.default)(this,"deviceEd25519Key",null),(0,o.default)(this,"maxOneTimeKeys",null),(0,o.default)(this,"outboundGroupSessionStore",{}),(0,o.default)(this,"inboundGroupSessionMessageIndexes",{}),(0,o.default)(this,"sessionsInProgress",{}),(0,o.default)(this,"olmPrekeyPromise",Promise.resolve())}static getOlmVersion(){return r.Olm.get_library_version()}async init({pickleKey:e,fromExportedDevice:t}={}){let i;const n=new r.Olm.Account;try{t?(e&&s.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this.pickleKey=t.pickleKey,await this.initialiseFromExportedDevice(t,n)):(e&&(this.pickleKey=e),await this.initialiseAccount(n)),i=JSON.parse(n.identity_keys()),this.maxOneTimeKeys=n.max_number_of_one_time_keys()}finally{n.free()}this.deviceCurve25519Key=i.curve25519,this.deviceEd25519Key=i.ed25519}async initialiseFromExportedDevice(e,t){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT,a.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.storeAccount(t,e.pickledAccount),e.sessions.forEach((e=>{const{deviceKey:r,sessionId:i}=e,n={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};this.cryptoStore.storeEndToEndSession(r,i,n,t)}))})),t.unpickle(this.pickleKey,e.pickledAccount)}async initialiseAccount(e){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getAccount(t,(r=>{null!==r?e.unpickle(this.pickleKey,r):(e.create(),r=e.pickle(this.pickleKey),this.cryptoStore.storeAccount(t,r))}))}))}getAccount(e,t){this.cryptoStore.getAccount(e,(e=>{const i=new r.Olm.Account;try{i.unpickle(this.pickleKey,e),t(i)}finally{i.free()}}))}storeAccount(e,t){this.cryptoStore.storeAccount(e,t.pickle(this.pickleKey))}async export(){const e={pickleKey:this.pickleKey};return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT,a.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getAccount(t,(t=>{e.pickledAccount=t})),e.sessions=[],this.cryptoStore.getAllEndToEndSessions(t,(t=>{e.sessions.push(t)}))})),e}getSession(e,t,r,i){this.cryptoStore.getEndToEndSession(e,t,r,(e=>{this.unpickleSession(e,i)}))}unpickleSession(e,t){const i=new r.Olm.Session;try{i.unpickle(this.pickleKey,e.session);t(Object.assign({},e,{session:i}))}finally{i.free()}}saveSession(e,t,r){const i=t.session.session_id();s.logger.debug(`Saving Olm session ${i} with device ${e}: ${t.session.describe()}`);const n=Object.assign(t,{session:t.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,i,n,r)}getUtility(e){const t=new r.Olm.Utility;try{return e(t)}finally{t.free()}}async sign(e){let t;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(r=>{this.getAccount(r,(r=>{t=r.sign(e)}))})),t}async getOneTimeKeys(){let e;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(t=>{e=JSON.parse(t.one_time_keys())}))})),e}maxNumberOfOneTimeKeys(){var e;return null!==(e=this.maxOneTimeKeys)&&void 0!==e?e:-1}async markKeysAsPublished(){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.mark_keys_as_published(),this.storeAccount(e,t)}))}))}generateOneTimeKeys(e){return this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(r=>{r.generate_one_time_keys(e),this.storeAccount(t,r)}))}))}async generateFallbackKey(){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.generate_fallback_key(),this.storeAccount(e,t)}))}))}async getFallbackKey(){let e;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(t=>{e=JSON.parse(t.unpublished_fallback_key())}))})),e}async forgetOldFallbackKey(){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.forget_old_fallback_key(),this.storeAccount(e,t)}))}))}async createOutboundSession(e,t){let i;return await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT,a.IndexedDBCryptoStore.STORE_SESSIONS],(n=>{this.getAccount(n,(o=>{const s=new r.Olm.Session;try{s.create_outbound(o,e,t),i=s.session_id(),this.storeAccount(n,o);const r={session:s,lastReceivedMessageTs:Date.now()};this.saveSession(e,r,n)}finally{s.free()}}))}),s.logger.withPrefix("[createOutboundSession]")),i}async createInboundSession(e,t,i){if(0!==t)throw new Error("Need messageType == 0 to create inbound session");let n;return await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT,a.IndexedDBCryptoStore.STORE_SESSIONS],(o=>{this.getAccount(o,(s=>{const a=new r.Olm.Session;try{a.create_inbound_from(s,e,i),s.remove_one_time_keys(a),this.storeAccount(o,s);const r=a.decrypt(t,i),c={session:a,lastReceivedMessageTs:Date.now()};this.saveSession(e,c,o),n={payload:r,session_id:a.session_id()}}finally{a.free()}}))}),s.logger.withPrefix("[createInboundSession]")),n}async getSessionIdsForDevice(e){const t=s.logger.withPrefix("[getSessionIdsForDevice]");if(e in this.sessionsInProgress){t.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch(e){}}let r;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getEndToEndSessions(e,t,(e=>{r=Object.keys(e)}))}),t),r}async getSessionIdForDevice(e,t=!1,r){const i=await this.getSessionInfoForDevice(e,t,r);if(0===i.length)return null;let n=0;for(let e=1;e<i.length;e++){const t=i[e],r=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,o=i[n],s=void 0===o.lastReceivedMessageTs?0:o.lastReceivedMessageTs;(r>s||r===s&&t.sessionId<o.sessionId)&&(n=e)}return i[n].sessionId}async getSessionInfoForDevice(e,t=!1,r=s.logger){if(r=r.withPrefix("[getSessionInfoForDevice]"),e in this.sessionsInProgress&&!t){r.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch(e){}}const i=[];return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getEndToEndSessions(e,t,(e=>{const t=Object.keys(e).sort();for(const r of t)this.unpickleSession(e[r],(e=>{i.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:r})}))}))}),r),i}async encryptMessage(e,t,r){let i;return d(r),await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_SESSIONS],(n=>{this.getSession(e,t,n,(o=>{const a=o.session.describe();s.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+a),i=o.session.encrypt(r),this.saveSession(e,o,n)}))}),s.logger.withPrefix("[encryptMessage]")),i}async decryptMessage(e,t,r,i){let n;return await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_SESSIONS],(o=>{this.getSession(e,t,o,(a=>{const c=a.session.describe();s.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+c),n=a.session.decrypt(r,i),a.lastReceivedMessageTs=Date.now(),this.saveSession(e,a,o)}))}),s.logger.withPrefix("[decryptMessage]")),n}async matchesSession(e,t,r,i){if(0!==r)return!1;let n;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{this.getSession(e,t,r,(e=>{n=e.session.matches_inbound(i)}))}),s.logger.withPrefix("[matchesSession]")),n}async recordSessionProblem(e,t,r){s.logger.info(`Recording problem on olm session with ${e} of type ${t}. Recreating: ${r}`),await this.cryptoStore.storeEndToEndSessionProblem(e,t,r)}sessionMayHaveProblems(e,t){return this.cryptoStore.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.cryptoStore.filterOutNotifiedErrorDevices(e)}saveOutboundGroupSession(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}getOutboundGroupSession(e,t){const i=this.outboundGroupSessionStore[e];if(void 0===i)throw new Error("Unknown outbound group session "+e);const n=new r.Olm.OutboundGroupSession;try{return n.unpickle(this.pickleKey,i),t(n)}finally{n.free()}}createOutboundGroupSession(){const e=new r.Olm.OutboundGroupSession;try{return e.create(),this.saveOutboundGroupSession(e),e.session_id()}finally{e.free()}}encryptGroupMessage(e,t){return s.logger.log(`encrypting msg with megolm session ${e}`),d(t),this.getOutboundGroupSession(e,(e=>{const r=e.encrypt(t);return this.saveOutboundGroupSession(e),r}))}getOutboundGroupSessionKey(e){return this.getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))}unpickleInboundGroupSession(e,t){const i=new r.Olm.InboundGroupSession;try{return i.unpickle(this.pickleKey,e.session),t(i)}finally{i.free()}}getInboundGroupSession(e,t,r,i,n){this.cryptoStore.getEndToEndInboundGroupSession(t,r,i,((t,r)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this.unpickleInboundGroupSession(t,(e=>{n(e,t,r)}))}else n(null,null,r)}))}async addInboundGroupSession(e,t,i,n,o,c,l,u={}){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,a.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(a=>{this.getInboundGroupSession(e,t,n,a,((h,d)=>{const f=new r.Olm.InboundGroupSession;try{if(l?f.import_session(o):f.create(o),n!=f.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(h&&(s.logger.log(`Update for megolm session ${t}|${n}`),h.first_known_index()<=f.first_known_index())){if(!d.untrusted||u.untrusted)return void s.logger.log(`Keeping existing megolm session ${t}|${n}`);if(h.first_known_index()<f.first_known_index())return void(h.export_session(f.first_known_index())===f.export_session(f.first_known_index())?(s.logger.info(`Upgrading trust of existing megolm session ${t}|${n} based on newly-received trusted session`),d.untrusted=!1,this.cryptoStore.storeEndToEndInboundGroupSession(t,n,d,a)):s.logger.warn(`Newly-received megolm session ${t}|$sessionId} does not match existing session! Keeping existing session`))}s.logger.info(`Storing megolm session ${t}|${n} with first index `+f.first_known_index());const r=Object.assign({},u,{room_id:e,session:f.pickle(this.pickleKey),keysClaimed:c,forwardingCurve25519KeyChain:i});this.cryptoStore.storeEndToEndInboundGroupSession(t,n,r,a),!h&&u.sharedHistory&&this.cryptoStore.addSharedHistoryInboundGroupSession(e,t,n,a)}finally{f.free()}}))}),s.logger.withPrefix("[addInboundGroupSession]"))}async addInboundGroupSessionWithheld(e,t,r,i,n){await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(o=>{this.cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,r,{room_id:e,code:i,reason:n},o)}))}async decryptGroupMessage(e,t,r,i,n,o){let l,u=null;if(await this.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.getInboundGroupSession(e,t,r,s,((e,a,h)=>{if(null===e||null===a)return h&&(l=new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",p(h),{session:t+"|"+r})),void(u=null);let d;try{d=e.decrypt(i)}catch(e){return void(l="OLM.UNKNOWN_MESSAGE_INDEX"===(null==e?void 0:e.message)&&h?new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",p(h),{session:t+"|"+r}):e)}let f=d.plaintext;if(void 0===f)f=d;else{const e=t+"|"+r+"|"+d.message_index;if(e in this.inboundGroupSessionMessageIndexes){const t=this.inboundGroupSessionMessageIndexes[e];if(t.id!==n||t.timestamp!==o)return void(l=new Error("Duplicate message index, possible replay attack: "+e))}this.inboundGroupSessionMessageIndexes[e]={id:n,timestamp:o}}a.session=e.pickle(this.pickleKey),this.cryptoStore.storeEndToEndInboundGroupSession(t,r,a,s),u={result:f,keysClaimed:a.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:a.forwardingCurve25519KeyChain||[],untrusted:!!a.untrusted}}))}),s.logger.withPrefix("[decryptGroupMessage]")),l)throw l;return u}async hasInboundSessionKeys(e,t,r){let i;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(n=>{this.cryptoStore.getEndToEndInboundGroupSession(t,r,n,(n=>{null!==n?e!==n.room_id?(s.logger.warn(`requested keys for inbound group session ${t}|${r}, with incorrect room_id (expected ${n.room_id}, was ${e})`),i=!1):i=!0:i=!1}))}),s.logger.withPrefix("[hasInboundSessionKeys]")),i}async getInboundGroupSessionKey(e,t,r,i){let n=null;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,a.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(o=>{this.getInboundGroupSession(e,t,r,o,((e,t)=>{if(null===e||null===t)return void(n=null);void 0===i&&(i=e.first_known_index());const r=e.export_session(i),o=(t.keysClaimed||{}).ed25519||null,s=t.forwardingCurve25519KeyChain||[],a="untrusted"in t?t.untrusted:s.length>0;n={chain_index:i,key:r,forwarding_curve25519_key_chain:s,sender_claimed_ed25519_key:o,shared_history:t.sharedHistory||!1,untrusted:a}}))}),s.logger.withPrefix("[getInboundGroupSessionKey]")),n}exportInboundGroupSession(e,t,r){return this.unpickleInboundGroupSession(r,(i=>{const n=i.first_known_index();return{sender_key:e,sender_claimed_keys:r.keysClaimed,room_id:r.room_id,session_id:t,session_key:i.export_session(n),forwarding_curve25519_key_chain:r.forwardingCurve25519KeyChain||[],first_known_index:i.first_known_index(),"org.matrix.msc3061.shared_history":r.sharedHistory||!1}}))}async getSharedHistoryInboundGroupSessions(e){let t;return await this.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(r=>{t=this.cryptoStore.getSharedHistoryInboundGroupSessions(e,r)}),s.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]")),t}verifySignature(e,t,r){this.getUtility((function(i){i.ed25519_verify(e,t,r)}))}};const f={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function p(e){return e.code&&e.code in f?f[e.code]:e.reason?e.reason:"decryption key withheld"}e.exports.WITHHELD_MESSAGES=f})),i.register("8iY8t",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),i("48E4y"),i("bTMh7");var r=i("bKFi9");Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===r[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return r[t]}}))}))})),i.register("48E4y",(function(e,t){var r=i("lHCw5")(i("3EUCw")),n=i("gEWrD"),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("dvbGC")),s=i("iN8Ss"),a=i("bKFi9");function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}const l=s.DeviceInfo.DeviceVerification;class u extends a.EncryptionAlgorithm{constructor(...e){super(...e),(0,r.default)(this,"sessionPrepared",!1),(0,r.default)(this,"prepPromise",null)}ensureSession(e){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((()=>this.crypto.ensureOlmSessionsForUsers(e))).then((()=>{this.sessionPrepared=!0})).finally((()=>{this.prepPromise=null})),this.prepPromise)}async encryptMessage(e,t,r){const i=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));await this.ensureSession(i);const n={room_id:e.roomId,type:t,content:r},s={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},a=[];for(const e of i){const t=this.crypto.getStoredDevicesForUser(e)||[];for(const r of t){r.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(r.verified!=l.BLOCKED&&a.push(o.encryptMessageForDevice(s.ciphertext,this.userId,this.deviceId,this.olmDevice,e,r,n)))}}return Promise.all(a).then((()=>s))}}class h extends a.DecryptionAlgorithm{async decryptEvent(e){const t=e.getWireContent(),r=t.sender_key,i=t.ciphertext;if(!i)throw new a.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this.olmDevice.deviceCurve25519Key in i))throw new a.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const n=i[this.olmDevice.deviceCurve25519Key];let s;try{s=await this.decryptMessage(r,n)}catch(e){throw new a.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:r,err:e})}const c=JSON.parse(s);if(c.recipient!=this.userId)throw new a.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+c.recipient);if(c.recipient_keys.ed25519!=this.olmDevice.deviceEd25519Key)throw new a.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:c.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});await this.crypto.deviceList.downloadKeys([e.getSender()],!1);const l=this.crypto.deviceList.getUserByIdentityKey(o.OLM_ALGORITHM,r);if(l!==e.getSender()&&null!=l)throw new a.DecryptionError("OLM_BAD_SENDER","Message claimed to be from "+e.getSender(),{real_sender:l});if(c.sender!=e.getSender())throw new a.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+c.sender,{reported_sender:e.getSender()});if(c.room_id!==e.getRoomId())throw new a.DecryptionError("OLM_BAD_ROOM","Message intended for room "+c.room_id,{reported_room:e.getRoomId()||"ROOM_ID_UNDEFINED"});return{clearEvent:c,senderCurve25519Key:r,claimedEd25519Key:(c.keys||{}).ed25519||null}}decryptMessage(e,t){if(0!==t.type)return this.reallyDecryptMessage(e,t);{const r=this.olmDevice.olmPrekeyPromise.then((()=>this.reallyDecryptMessage(e,t)));return this.olmDevice.olmPrekeyPromise=r.catch((()=>{})),r}}async reallyDecryptMessage(e,t){const r=await this.olmDevice.getSessionIdsForDevice(e),i={};for(const o of r)try{const r=await this.olmDevice.decryptMessage(e,o,t.type,t.body);return n.logger.log("Decrypted Olm message from "+e+" with session "+o),r}catch(r){if(await this.olmDevice.matchesSession(e,o,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+r.message);i[o]=r.message}if(0!==t.type){if(0===r.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(i))}let o;try{o=await this.olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw i["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(i))}return n.logger.log("created new inbound Olm session ID "+o.session_id+" with "+e),o.payload}}(0,a.registerAlgorithm)(o.OLM_ALGORITHM,u,h)})),i.register("bKFi9",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnknownDeviceError=e.exports.EncryptionAlgorithm=e.exports.ENCRYPTION_CLASSES=e.exports.DecryptionError=e.exports.DecryptionAlgorithm=e.exports.DECRYPTION_CLASSES=void 0,e.exports.registerAlgorithm=function(e,t,r){o.set(e,t),s.set(e,r)};var n=r(i("3EUCw"));const o=new Map;e.exports.ENCRYPTION_CLASSES=o;const s=new Map;e.exports.DECRYPTION_CLASSES=s;e.exports.EncryptionAlgorithm=class{constructor(e){(0,n.default)(this,"userId",void 0),(0,n.default)(this,"deviceId",void 0),(0,n.default)(this,"crypto",void 0),(0,n.default)(this,"olmDevice",void 0),(0,n.default)(this,"baseApis",void 0),(0,n.default)(this,"roomId",void 0),this.userId=e.userId,this.deviceId=e.deviceId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}prepareToEncrypt(e){}onRoomMembership(e,t,r){}};e.exports.DecryptionAlgorithm=class{constructor(e){(0,n.default)(this,"userId",void 0),(0,n.default)(this,"crypto",void 0),(0,n.default)(this,"olmDevice",void 0),(0,n.default)(this,"baseApis",void 0),(0,n.default)(this,"roomId",void 0),this.userId=e.userId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}async onRoomKeyEvent(e){}async importRoomKey(e,t){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){return!1}};class a extends Error{constructor(e,t,r){super(t),this.code=e,(0,n.default)(this,"detailedString",void 0),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let r=e.name+"[msg: "+e.message;t&&(r+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", "));return r+="]",r}(this,r)}}e.exports.DecryptionError=a;class c extends Error{constructor(e,t,r){super(e),this.devices=t,this.event=r,this.name="UnknownDeviceError",this.devices=t}}e.exports.UnknownDeviceError=c})),i.register("bTMh7",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MegolmEncryption=e.exports.MegolmDecryption=void 0,e.exports.isRoomSharedHistory=g;var n=r(i("3EUCw")),o=i("73W4W"),s=i("gEWrD"),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("dvbGC")),c=i("bKFi9"),l=i("hUfPM"),u=i("ldT3p"),h=i("dBHOk"),d=i("gjhRv");function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e){var t,r;const i=null==e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),n=null==i||null===(r=i.getContent())||void 0===r?void 0:r.history_visibility;return["world_readable","shared"].includes(n)}class v{constructor(e,t=!1){this.sessionId=e,this.sharedHistory=t,(0,n.default)(this,"useCount",0),(0,n.default)(this,"creationTime",void 0),(0,n.default)(this,"sharedWithDevices",{}),(0,n.default)(this,"blockedDevicesNotified",{}),this.creationTime=(new Date).getTime()}needsRotation(e,t){const r=(new Date).getTime()-this.creationTime;return(this.useCount>=e||r>=t)&&(s.logger.log("Rotating megolm session after "+this.useCount+" messages, "+r+"ms"),!0)}markSharedWithDevice(e,t,r,i){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]={deviceKey:r,messageIndex:i}}markNotifiedBlockedDevice(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0}sharedWithTooManyDevices(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return s.logger.log("Starting new megolm session because we shared with "+t),!0;for(const r in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(r)&&!e[t].hasOwnProperty(r))return s.logger.log("Starting new megolm session because we shared with "+t+":"+r),!0}return!1}}class y extends c.EncryptionAlgorithm{constructor(e){var t,r,i,o;super(e),(0,n.default)(this,"setupPromise",Promise.resolve(null)),(0,n.default)(this,"outboundSessions",{}),(0,n.default)(this,"sessionRotationPeriodMsgs",void 0),(0,n.default)(this,"sessionRotationPeriodMs",void 0),(0,n.default)(this,"encryptionPreparation",void 0),(0,n.default)(this,"roomId",void 0),(0,n.default)(this,"prefixedLogger",void 0),this.roomId=e.roomId,this.prefixedLogger=s.logger.withPrefix(`[${this.roomId} encryption]`),this.sessionRotationPeriodMsgs=null!==(t=null===(r=e.config)||void 0===r?void 0:r.rotation_period_msgs)&&void 0!==t?t:100,this.sessionRotationPeriodMs=null!==(i=null===(o=e.config)||void 0===o?void 0:o.rotation_period_ms)&&void 0!==i?i:6048e5}async ensureOutboundSession(e,t,r,i=!1){const n=this.setupPromise.then((async n=>{const o=g(e),s=await this.prepareSession(t,o,n);return await this.shareSession(t,o,i,r,s),s}));return this.setupPromise=n.catch((e=>(this.prefixedLogger.error("Failed to setup outbound session",e),null))),n}async prepareSession(e,t,r){var i,n;return r&&t!==r.sharedHistory&&(r=null),null!==(i=r)&&void 0!==i&&i.needsRotation(this.sessionRotationPeriodMsgs,this.sessionRotationPeriodMs)&&(this.prefixedLogger.log("Starting new megolm session because we need to rotate."),r=null),null!==(n=r)&&void 0!==n&&n.sharedWithTooManyDevices(e)&&(r=null),r||(this.prefixedLogger.log("Starting new megolm session"),r=await this.prepareNewSession(t),this.prefixedLogger.log(`Started new megolm session ${r.sessionId}`),this.outboundSessions[r.sessionId]=r),r}async shareSession(e,t,r,i,n){const o={};for(const[t,r]of Object.entries(e))for(const[e,i]of Object.entries(r)){i.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(n.sharedWithDevices[t]&&void 0!==n.sharedWithDevices[t][e]||(o[t]=o[t]||[],o[t].push(i)))}const s=this.olmDevice.getOutboundGroupSessionKey(n.sessionId),c={type:"m.room_key",content:{algorithm:a.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:n.sessionId,session_key:s.key,chain_index:s.chain_index,"org.matrix.msc3061.shared_history":t}},[l,u]=await a.getExistingOlmSessions(this.olmDevice,this.baseApis,o);await Promise.all([(async()=>{const e=Object.entries(u).map((([e,t])=>Object.entries(t).map((([t,r])=>`${e}/${t}: ${r.sessionId}`)))).flat(1);this.prefixedLogger.debug("Sharing keys with devices with existing Olm sessions:",e),await this.shareKeyWithOlmSessions(n,s,c,u),this.prefixedLogger.debug("Shared keys with existing Olm sessions")})(),(async()=>{const e=Object.entries(l).map((([e,t])=>t.map((t=>`${e}/${t.deviceId}`)))).flat(1);this.prefixedLogger.debug("Sharing keys (start phase 1) with devices without existing Olm sessions:",e);const t=[],i=Date.now(),o=[];await this.shareKeyWithDevices(n,s,c,l,t,r?1e4:2e3,o),this.prefixedLogger.debug("Shared keys (end phase 1) with devices without existing Olm sessions"),!r&&Date.now()-i<1e4?(async()=>{const e={},r=new Set;for(const e of o)r.add(e);const i=[];for(const{userId:n,deviceInfo:o}of t){const t=n.slice(n.indexOf(":")+1);r.has(t)?(e[n]=e[n]||[],e[n].push(o)):i.push({userId:n,deviceInfo:o})}const a=Object.entries(e).map((([e,t])=>t.map((t=>`${e}/${t.deviceId}`)))).flat(1);a.length>0&&(this.prefixedLogger.debug("Sharing keys (start phase 2) with devices without existing Olm sessions:",a),await this.shareKeyWithDevices(n,s,c,e,i,3e4),this.prefixedLogger.debug("Shared keys (end phase 2) with devices without existing Olm sessions")),await this.notifyFailedOlmDevices(n,s,i)})():await this.notifyFailedOlmDevices(n,s,t)})(),(async()=>{this.prefixedLogger.debug(`There are ${Object.entries(i).length} blocked devices:`,Object.entries(i).map((([e,t])=>Object.entries(t).map((([t,r])=>`${e}/${t}`)))).flat(1));const e={};let t=0;for(const[r,o]of Object.entries(i))for(const[i,s]of Object.entries(o))n.blockedDevicesNotified[r]&&void 0!==n.blockedDevicesNotified[r][i]||(e[r]=e[r]||{},e[r][i]={device:s},t++);t&&(this.prefixedLogger.debug(`Notifying ${t} newly blocked devices:`,Object.entries(e).map((([e,t])=>Object.entries(t).map((([t,r])=>`${e}/${t}`)))).flat(1)),await this.notifyBlockedDevices(n,e),this.prefixedLogger.debug(`Notified ${t} newly blocked devices`))})()])}async prepareNewSession(e){const t=this.olmDevice.createOutboundGroupSession(),r=this.olmDevice.getOutboundGroupSessionKey(t);return await this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],t,r.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,t),new v(t,e)}getDevicesWithoutSessions(e,t,r=[]){for(const[i,n]of Object.entries(t)){const t=e[i];for(const e of n){const n=e.deviceId;t[n].sessionId||(r.push({userId:i,deviceInfo:e}),delete t[n])}}return r}splitDevices(e){let t=[];const r=[t];for(const[i,n]of Object.entries(e)){for(const e of Object.values(n))t.push({userId:i,deviceInfo:e.device});t.length>20&&(t=[],r.push(t))}return 0===t.length&&r.pop(),r}encryptAndSendKeysToDevices(e,t,r,i){return this.crypto.encryptAndSendToDevices(r,i).then((()=>{for(const i of r)e.markSharedWithDevice(i.userId,i.deviceInfo.deviceId,i.deviceInfo.getIdentityKey(),t)})).catch((e=>{throw this.prefixedLogger.error("failed to encryptAndSendToDevices",e),e}))}async sendBlockedNotificationsToDevices(e,t,r){const i={};for(const e of t){const t=e.userId,n=e.deviceInfo,s=n.deviceInfo.deviceId,a=m(m({},r),{},{code:n.code,reason:n.reason,[u.ToDeviceMessageId]:(0,o.default)()});"m.no_olm"===a.code&&(delete a.room_id,delete a.session_id),i[t]||(i[t]={}),i[t][s]=a}await this.baseApis.sendToDevice("m.room_key.withheld",i);for(const t of Object.keys(i))for(const r of Object.keys(i[t]))e.markNotifiedBlockedDevice(t,r)}async reshareKeyWithDevice(e,t,r,i){const n=this.outboundSessions[t];if(!n)return void this.prefixedLogger.debug(`megolm session ${e}|${t} not found: not re-sharing keys`);if(void 0===n.sharedWithDevices[r])return void this.prefixedLogger.debug(`megolm session ${e}|${t} never shared with user ${r}`);const s=n.sharedWithDevices[r][i.deviceId];if(void 0===s)return void this.prefixedLogger.debug(`megolm session ${e}|${t} never shared with device ${r}:${i.deviceId}`);if(s.deviceKey!==i.getIdentityKey())return void this.prefixedLogger.warn(`Megolm session ${e}|${t} has been shared with device ${i.deviceId} but with identity key ${s.deviceKey}. Key is now ${i.getIdentityKey()}!`);const c=await this.olmDevice.getInboundGroupSessionKey(this.roomId,e,t,s.messageIndex);if(!c)return void this.prefixedLogger.warn(`No inbound session key found for megolm session ${e}|${t}: not re-sharing keys`);await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[r]:[i]});const l={type:"m.forwarded_room_key",content:{algorithm:a.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:t,session_key:c.key,chain_index:c.chain_index,sender_key:e,sender_claimed_ed25519_key:c.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:c.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":c.shared_history||!1}},h={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[u.ToDeviceMessageId]:(0,o.default)()};await a.encryptMessageForDevice(h.ciphertext,this.userId,this.deviceId,this.olmDevice,r,i,l),await this.baseApis.sendToDevice("m.room.encrypted",{[r]:{[i.deviceId]:h}}),this.prefixedLogger.debug(`Re-shared key for megolm session ${e}|${t} with ${r}:${i.deviceId}`)}async shareKeyWithDevices(e,t,r,i,n,o,s){const c=await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,i,!1,o,s,this.prefixedLogger);this.getDevicesWithoutSessions(c,i,n),await this.shareKeyWithOlmSessions(e,t,r,c)}async shareKeyWithOlmSessions(e,t,r,i){const n=this.splitDevices(i);for(let i=0;i<n.length;i++){const o=`megolm keys for ${e.sessionId} (slice ${i+1}/${n.length})`;try{this.prefixedLogger.debug(`Sharing ${o}`,n[i].map((e=>`${e.userId}/${e.deviceInfo.deviceId}`))),await this.encryptAndSendKeysToDevices(e,t.chain_index,n[i],r),this.prefixedLogger.debug(`Shared ${o}`)}catch(e){throw this.prefixedLogger.error(`Failed to share ${o}`),e}}}async notifyFailedOlmDevices(e,t,r){this.prefixedLogger.debug(`Notifying ${r.length} devices we failed to create Olm sessions`);for(const{userId:i,deviceInfo:n}of r){const r=n.deviceId;e.markSharedWithDevice(i,r,n.getIdentityKey(),t.chain_index)}const i=await this.olmDevice.filterOutNotifiedErrorDevices(r);this.prefixedLogger.debug(`Need to notify ${i.length} failed devices which haven't been notified before`);const n={};for(const{userId:e,deviceInfo:t}of i)n[e]=n[e]||{},n[e][t.deviceId]={device:{code:"m.no_olm",reason:l.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:t}};await this.notifyBlockedDevices(e,n),this.prefixedLogger.debug(`Notified ${i.length} devices we failed to create Olm sessions`)}async notifyBlockedDevices(e,t){const r={room_id:this.roomId,session_id:e.sessionId,algorithm:a.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key},i=this.splitDevices(t);for(let t=0;t<i.length;t++)try{await this.sendBlockedNotificationsToDevices(e,i[t],r),this.prefixedLogger.log(`Completed blacklist notification for ${e.sessionId} (slice ${t+1}/${i.length})`)}catch(r){throw this.prefixedLogger.log(`blacklist notification for ${e.sessionId} (slice ${t+1}/${i.length}) failed`),r}}prepareToEncrypt(e){if(e.roomId!==this.roomId)throw new Error("MegolmEncryption.prepareToEncrypt called on unexpected room");if(null!=this.encryptionPreparation){const e=Date.now()-this.encryptionPreparation.startTime;return this.prefixedLogger.debug(`Already started preparing to encrypt for this room ${e}ms ago, skipping`),this.encryptionPreparation.cancel}this.prefixedLogger.debug("Preparing to encrypt events");let t=!1;const r=()=>t;return this.encryptionPreparation={startTime:Date.now(),promise:(async()=>{try{const t=await this.getDevicesInRoom(e,!1,r);if(null===t)return;const[i,n]=t;this.crypto.globalErrorOnUnknownDevices&&this.removeUnknownDevices(i),this.prefixedLogger.debug("Ensuring outbound megolm session"),await this.ensureOutboundSession(e,i,n,!0),this.prefixedLogger.debug("Ready to encrypt events")}catch(e){this.prefixedLogger.error("Failed to prepare to encrypt events",e)}finally{delete this.encryptionPreparation}})(),cancel:()=>{t=!0,delete this.encryptionPreparation}},this.encryptionPreparation.cancel}async encryptMessage(e,t,r){if(this.prefixedLogger.log("Starting to encrypt event"),null!=this.encryptionPreparation)try{await this.encryptionPreparation.promise}catch(e){}const i=this.isVerificationEvent(t,r),[n,o]=await this.getDevicesInRoom(e,i);this.crypto.globalErrorOnUnknownDevices&&this.checkForUnknownDevices(n);const s=await this.ensureOutboundSession(e,n,o),c={room_id:this.roomId,type:t,content:r},l=this.olmDevice.encryptGroupMessage(s.sessionId,JSON.stringify(c)),u={algorithm:a.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:l,session_id:s.sessionId,device_id:this.deviceId};return s.useCount++,u}isVerificationEvent(e,t){switch(e){case u.EventType.KeyVerificationCancel:case u.EventType.KeyVerificationDone:case u.EventType.KeyVerificationMac:case u.EventType.KeyVerificationStart:case u.EventType.KeyVerificationKey:case u.EventType.KeyVerificationReady:case u.EventType.KeyVerificationAccept:return!0;case u.EventType.RoomMessage:return t.msgtype===u.MsgType.KeyVerificationRequest;default:return!1}}forceDiscardSession(){this.setupPromise=this.setupPromise.then((()=>null))}checkForUnknownDevices(e){const t={};if(Object.keys(e).forEach((r=>{Object.keys(e[r]).forEach((i=>{const n=e[r][i];n.isUnverified()&&!n.isKnown()&&(t[r]||(t[r]={}),t[r][i]=n)}))})),Object.keys(t).length)throw new c.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}removeUnknownDevices(e){for(const[t,r]of Object.entries(e)){for(const[e,t]of Object.entries(r))t.isUnverified()&&!t.isKnown()&&delete r[e];0===Object.keys(r).length&&delete e[t]}}async getDevicesInRoom(e,t=!1,r){const i=await e.getEncryptionTargetMembers();this.prefixedLogger.debug(`Encrypting for users (shouldEncryptForInvitedMembers: ${e.shouldEncryptForInvitedMembers()}):`,i.map((e=>`${e.userId} (${e.membership})`)));const n=i.map((function(e){return e.userId}));let o=this.crypto.globalBlacklistUnverifiedDevices;const s=e.getBlacklistUnverifiedDevices();"boolean"==typeof s&&(o=s);const a=await this.crypto.downloadKeys(n,!1),c={};if(!0===(null==r?void 0:r()))return null;for(const e in a){if(!a.hasOwnProperty(e))continue;const i=a[e];for(const n in i){if(!i.hasOwnProperty(n))continue;if(void 0!==r&&await(0,d.immediate)(),!0===(null==r?void 0:r()))return null;const s=this.crypto.checkDeviceTrust(e,n);if(i[n].isBlocked()||!s.isVerified()&&o&&!t){c[e]||(c[e]={});const t=i[n].isBlocked();c[e][n]={code:t?"m.blacklisted":"m.unverified",reason:l.WITHHELD_MESSAGES[t?"m.blacklisted":"m.unverified"],deviceInfo:i[n]},delete i[n]}}}return[a,c]}}e.exports.MegolmEncryption=y;class b extends c.DecryptionAlgorithm{constructor(e){super(e),(0,n.default)(this,"pendingEvents",new Map),(0,n.default)(this,"olmlib",a),(0,n.default)(this,"roomId",void 0),(0,n.default)(this,"prefixedLogger",void 0),this.roomId=e.roomId,this.prefixedLogger=s.logger.withPrefix(`[${this.roomId} decryption]`)}async decryptEvent(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new c.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let r;this.addEventToPendingList(e);try{r=await this.olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(r){if("DecryptionError"===r.name)throw r;let i="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw"OLM.UNKNOWN_MESSAGE_INDEX"===(null==r?void 0:r.message)&&(this.requestKeysForEvent(e),i="OLM_UNKNOWN_MESSAGE_INDEX"),new c.DecryptionError(i,r instanceof Error?r.message:"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===r){this.crypto.backupManager.queryKeyBackupRateLimited(e.getRoomId(),t.session_id).catch((()=>{})),this.requestKeysForEvent(e);const r=await this.olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(r){this.prefixedLogger.info(`When handling UISI from ${e.getSender()} (sender key ${t.sender_key}): recent session problem with that sender:`,r);let i=w[r.type]||w.unknown;throw r.fixed&&(i+=" Trying to create a new secure channel and re-requesting the keys."),new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",i,{session:t.sender_key+"|"+t.session_id})}throw new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}r.untrusted||this.removeEventFromPendingList(e);const i=JSON.parse(r.result);if(i.room_id!==e.getRoomId())throw new c.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+i.room_id);return{clearEvent:i,senderCurve25519Key:r.senderKey,claimedEd25519Key:r.keysClaimed.ed25519,forwardingCurve25519KeyChain:r.forwardingCurve25519KeyChain,untrusted:r.untrusted}}requestKeysForEvent(e){const t=e.getWireContent(),r=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},r)}addEventToPendingList(e){var t;const r=e.getWireContent(),i=r.sender_key,n=r.session_id;this.pendingEvents.has(i)||this.pendingEvents.set(i,new Map);const o=this.pendingEvents.get(i);o.has(n)||o.set(n,new Set),null===(t=o.get(n))||void 0===t||t.add(e)}removeEventFromPendingList(e){const t=e.getWireContent(),r=t.sender_key,i=t.session_id,n=this.pendingEvents.get(r),o=null==n?void 0:n.get(i);o&&(o.delete(e),0===o.size&&n.delete(i),0===n.size&&this.pendingEvents.delete(r))}async onRoomKeyEvent(e){const t=e.getContent();let r,i=e.getSenderKey(),n=[],o=!1;const s={};if(t.room_id&&t.session_key&&t.session_id&&t.algorithm)if(a.isOlmEncrypted(e)){if(t["org.matrix.msc3061.shared_history"]&&(s.sharedHistory=!0),"m.forwarded_room_key"==e.getType()){var c,l,u,d;const f=this.crypto.deviceList.getDeviceByIdentityKey(a.OLM_ALGORITHM,i);if(this.baseApis.crypto.deviceList.getUserByIdentityKey(a.OLM_ALGORITHM,i)!==e.getSender())return void this.prefixedLogger.error("sending device does not belong to the user it claims to be from");const p=(f?await this.crypto.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e.getSender(),f.deviceId,[h.RoomKeyRequestState.Sent]):[]).some((e=>e.requestBody.room_id===t.room_id&&e.requestBody.session_id===t.session_id)),m=this.baseApis.getRoom(t.room_id),g=null==m||null===(c=m.getMember(this.userId))||void 0===c?void 0:c.events.member,v=(null==g?void 0:g.getSender())===e.getSender()||(null==g||null===(l=g.getUnsigned())||void 0===l?void 0:l.prev_sender)===e.getSender()&&"invite"===(null==g||null===(u=g.getPrevContent())||void 0===u?void 0:u.membership),y=e.getSender()===this.baseApis.getUserId();if(!p&&!y){if(!s.sharedHistory)return void this.prefixedLogger.log("forwarded key not shared history - ignoring");if(m&&!v)return void this.prefixedLogger.log("forwarded key not from inviter or from us - ignoring")}if(o=!0,n=Array.isArray(t.forwarding_curve25519_key_chain)?t.forwarding_curve25519_key_chain:[],n=n.slice(),n.push(i),!t.sender_key)return void this.prefixedLogger.error("forwarded_room_key event is missing sender_key field");const b=t.sender_claimed_ed25519_key;if(!b)return void this.prefixedLogger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");if(r={ed25519:b},!m){const i={senderId:e.getSender(),senderKey:t.sender_key,sessionId:t.session_id,sessionKey:t.session_key,keysClaimed:r,forwardingCurve25519KeyChain:n};return void await this.crypto.cryptoStore.doTxn("readwrite",["parked_shared_history"],(e=>this.crypto.cryptoStore.addParkedSharedHistory(t.room_id,i,e)),this.prefixedLogger.withPrefix("[addParkedSharedHistory]"))}const w=null!==(d=this.crypto.deviceList.getDeviceByIdentityKey(a.OLM_ALGORITHM,i))&&void 0!==d?d:void 0,_=this.crypto.checkDeviceInfoTrust(e.getSender(),w);if(y&&!_.isVerified())return;s.untrusted=!0,i=t.sender_key}else r=e.getKeysClaimed();t["org.matrix.msc3061.shared_history"]&&(s.sharedHistory=!0);try{await this.olmDevice.addInboundGroupSession(t.room_id,i,n,t.session_id,t.session_key,r,o,s),await this.retryDecryption(i,t.session_id,!s.untrusted)&&this.crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:i}),await this.crypto.backupManager.backupGroupSession(i,t.session_id)}catch(e){this.prefixedLogger.error(`Error handling m.room_key_event: ${e}`)}}else this.prefixedLogger.error("key event not properly encrypted");else this.prefixedLogger.error("key event is missing fields")}async onRoomKeyWithheldEvent(e){const t=e.getContent(),r=t.sender_key;"m.no_olm"===t.code?await this.onNoOlmWithheldEvent(e):"m.unavailable"===t.code||await this.olmDevice.addInboundGroupSessionWithheld(t.room_id,r,t.session_id,t.code,t.reason),t.session_id?await this.retryDecryption(r,t.session_id):await this.retryDecryptionFromSender(r)}async onNoOlmWithheldEvent(e){const t=e.getContent(),r=t.sender_key,i=e.getSender();if(this.prefixedLogger.warn(`${i}:${r} was unable to establish an olm session with us`),await this.olmDevice.getSessionIdForDevice(r))return this.prefixedLogger.debug("New session already created.  Not creating a new one."),void await this.olmDevice.recordSessionProblem(r,"no_olm",!0);let n=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,r);if(!n&&(await this.crypto.downloadKeys([i],!1),n=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,r),!n))return this.prefixedLogger.info("Couldn't find device for identity key "+r+": not establishing session"),void await this.olmDevice.recordSessionProblem(r,"no_olm",!1);await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[i]:[n]},!1);const s={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[u.ToDeviceMessageId]:(0,o.default)()};await a.encryptMessageForDevice(s.ciphertext,this.userId,void 0,this.olmDevice,i,n,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(r,"no_olm",!0),await this.baseApis.sendToDevice("m.room.encrypted",{[i]:{[n.deviceId]:s}})}hasKeysForKeyRequest(e){const t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}shareKeysWithDevice(e){const t=e.userId,r=e.deviceId,i=this.crypto.getStoredDevice(t,r),n=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[t]:[i]}).then((e=>e[t][r].sessionId?(this.prefixedLogger.log("sharing keys for session "+n.sender_key+"|"+n.session_id+" with device "+t+":"+r),this.buildKeyForwardingMessage(n.room_id,n.sender_key,n.session_id)):null)).then((e=>{const n={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[u.ToDeviceMessageId]:(0,o.default)()};return this.olmlib.encryptMessageForDevice(n.ciphertext,this.userId,void 0,this.olmDevice,t,i,e).then((()=>{const e={[t]:{[r]:n}};return this.baseApis.sendToDevice("m.room.encrypted",e)}))}))}async buildKeyForwardingMessage(e,t,r){const i=await this.olmDevice.getInboundGroupSessionKey(e,t,r);return{type:"m.forwarded_room_key",content:{algorithm:a.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:i.sender_claimed_ed25519_key,session_id:r,session_key:i.key,chain_index:i.chain_index,forwarding_curve25519_key_chain:i.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":i.shared_history||!1}}}importRoomKey(e,{untrusted:t,source:r}={}){const i={};return(t||e.untrusted)&&(i.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(i.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,i).then((()=>{"backup"!==r&&this.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((e=>{this.prefixedLogger.log("Failed to back up megolm session",e)})),this.retryDecryption(e.sender_key,e.session_id,!i.untrusted)}))}async retryDecryption(e,t,r){var i;const n=this.pendingEvents.get(e);if(!n)return!0;const o=n.get(t);if(!o)return!0;const s=[...o];return this.prefixedLogger.debug("Retrying decryption on events:",s.map((e=>`${e.getId()}`))),await Promise.all(s.map((async e=>{try{await e.attemptDecryption(this.crypto,{isRetry:!0,forceRedecryptIfUntrusted:r})}catch(e){}}))),!(null!==(i=this.pendingEvents.get(e))&&void 0!==i&&i.has(t))}async retryDecryptionFromSender(e){const t=this.pendingEvents.get(e);return!t||(this.pendingEvents.delete(e),await Promise.all([...t].map((async([e,t])=>{await Promise.all([...t].map((async e=>{try{await e.attemptDecryption(this.crypto)}catch(e){}})))}))),!this.pendingEvents.has(e))}async sendSharedHistoryInboundSessions(e){await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,e);const t=await this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);this.prefixedLogger.log(`Sharing history in with users ${Object.keys(e)}`,t.map((([e,t])=>`${e}|${t}`)));for(const[r,i]of t){const t=await this.buildKeyForwardingMessage(this.roomId,r,i),n=[],s={};for(const[r,i]of Object.entries(e)){s[r]={};for(const e of i){const i={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[u.ToDeviceMessageId]:(0,o.default)()};s[r][e.deviceId]=i,n.push(a.encryptMessageForDevice(i.ciphertext,this.userId,void 0,this.olmDevice,r,e,t))}}await Promise.all(n);for(const e of Object.keys(s)){for(const t of Object.keys(s[e]))0===Object.keys(s[e][t].ciphertext).length&&(this.prefixedLogger.log("No ciphertext for device "+e+":"+t+": pruning"),delete s[e][t]);0===Object.keys(s[e]).length&&(this.prefixedLogger.log("Pruned all devices for user "+e),delete s[e])}if(0===Object.keys(s).length)return void this.prefixedLogger.log("No users left to send to: aborting");await this.baseApis.sendToDevice("m.room.encrypted",s)}}}e.exports.MegolmDecryption=b;const w={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,c.registerAlgorithm)(a.MEGOLM_ALGORITHM,y,b)})),i.register("dBHOk",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomKeyRequestState=e.exports.OutgoingRoomKeyRequestManager=void 0;var n=r(i("3EUCw")),o=i("73W4W"),s=i("gEWrD"),a=i("ldT3p");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let u;var h;e.exports.RoomKeyRequestState=u,(h=u||(e.exports.RoomKeyRequestState=u={}))[h.Unsent=0]="Unsent",h[h.Sent=1]="Sent",h[h.CancellationPending=2]="CancellationPending",h[h.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend";function d(e){return e.room_id+" / "+e.session_id}function f(e){return`[${e.map((e=>`${e.userId}:${e.deviceId}`)).join(",")}]`}e.exports.OutgoingRoomKeyRequestManager=class{constructor(e,t,r){this.baseApis=e,this.deviceId=t,this.cryptoStore=r,(0,n.default)(this,"sendOutgoingRoomKeyRequestsTimer",void 0),(0,n.default)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,n.default)(this,"clientRunning",!0)}stop(){s.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}async queueRoomKeyRequest(e,t,r=!1){const i=await this.cryptoStore.getOutgoingRoomKeyRequest(e);if(i)switch(i.state){case u.CancellationPendingAndWillResend:case u.Unsent:return;case u.CancellationPending:{const e=r?u.CancellationPendingAndWillResend:u.Sent;await this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,u.CancellationPending,{state:e,cancellationTxnId:this.baseApis.makeTxnId()});break}case u.Sent:if(r){const n=u.CancellationPendingAndWillResend,o=await this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,u.Sent,{state:n,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});if(!o)return this.queueRoomKeyRequest(e,t,r);try{await this.sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(e){s.logger.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+i.state)}else await this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this.baseApis.makeTxnId(),state:u.Unsent})}cancelRoomKeyRequest(e){return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((t=>{if(t)switch(t.state){case u.CancellationPending:case u.CancellationPendingAndWillResend:return;case u.Unsent:return s.logger.log("deleting unnecessary room key request for "+d(e)),this.cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,u.Unsent);case u.Sent:return this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,u.Sent,{state:u.CancellationPending,cancellationTxnId:this.baseApis.makeTxnId()}).then((t=>{t?this.sendOutgoingRoomKeyRequestCancellation(t).catch((e=>{s.logger.error("Error sending room key request cancellation; will retry later.",e),this.startTimer()})):s.logger.log("Tried to cancel room key request for "+d(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+t.state)}}))}getOutgoingSentRoomKeyRequest(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[u.Sent])}async cancelAndResendAllOutgoingRequests(){const e=await this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(u.Sent);return Promise.all(e.map((({requestBody:e,recipients:t})=>this.queueRoomKeyRequest(e,t,!0))))}startTimer(){if(this.sendOutgoingRoomKeyRequestsTimer)return;this.sendOutgoingRoomKeyRequestsTimer=setTimeout((()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally((()=>{this.sendOutgoingRoomKeyRequestsRunning=!1})).catch((e=>{s.logger.warn(`error in OutgoingRoomKeyRequestManager: ${e}`)}))}),500)}async sendOutgoingRoomKeyRequests(){if(!this.clientRunning)return void(this.sendOutgoingRoomKeyRequestsTimer=void 0);const e=await this.cryptoStore.getOutgoingRoomKeyRequestByState([u.CancellationPending,u.CancellationPendingAndWillResend,u.Unsent]);if(e)try{switch(e.state){case u.Unsent:await this.sendOutgoingRoomKeyRequest(e);break;case u.CancellationPending:await this.sendOutgoingRoomKeyRequestCancellation(e);break;case u.CancellationPendingAndWillResend:await this.sendOutgoingRoomKeyRequestCancellation(e,!0)}return this.sendOutgoingRoomKeyRequests()}catch(e){s.logger.error("Error sending room key request; will retry later.",e),this.sendOutgoingRoomKeyRequestsTimer=void 0}else this.sendOutgoingRoomKeyRequestsTimer=void 0}sendOutgoingRoomKeyRequest(e){s.logger.log(`Requesting keys for ${d(e.requestBody)} from ${f(e.recipients)}(id ${e.requestId})`);const t={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then((()=>this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,u.Unsent,{state:u.Sent})))}sendOutgoingRoomKeyRequestCancellation(e,t=!1){s.logger.log(`Sending cancellation for key request for ${d(e.requestBody)} to ${f(e.recipients)} (cancellation id ${e.cancellationTxnId})`);const r={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(r,e.recipients,e.cancellationTxnId).then((()=>t?this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,u.CancellationPendingAndWillResend,{state:u.Unsent}):this.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,u.CancellationPending)))}sendMessageToDevices(e,t,r){const i={};for(const r of t)i[r.userId]||(i[r.userId]={}),i[r.userId][r.deviceId]=l(l({},e),{},{[a.ToDeviceMessageId]:(0,o.default)()});return this.baseApis.sendToDevice(a.EventType.RoomKeyRequest,i,r)}}})),i.register("gSVCd",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TrackingStatus=e.exports.DeviceList=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("iN8Ss"),a=i("hclBt"),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("dvbGC")),l=i("gH6iW"),u=i("gjhRv"),h=i("75Qdj"),d=i("l5WvI");function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}let p;var m;e.exports.TrackingStatus=p,(m=p||(e.exports.TrackingStatus=p={}))[m.NotTracked=0]="NotTracked",m[m.PendingDownload=1]="PendingDownload",m[m.DownloadInProgress=2]="DownloadInProgress",m[m.UpToDate=3]="UpToDate";class g extends h.TypedEventEmitter{constructor(e,t,r,i=250){super(),this.cryptoStore=t,this.keyDownloadChunkSize=i,(0,n.default)(this,"devices",{}),(0,n.default)(this,"crossSigningInfo",{}),(0,n.default)(this,"userByIdentityKey",{}),(0,n.default)(this,"deviceTrackingStatus",{}),(0,n.default)(this,"syncToken",null),(0,n.default)(this,"keyDownloadsInProgressByUser",new Map),(0,n.default)(this,"dirty",!1),(0,n.default)(this,"savePromise",null),(0,n.default)(this,"resolveSavePromise",null),(0,n.default)(this,"savePromiseTime",null),(0,n.default)(this,"saveTimer",null),(0,n.default)(this,"hasFetched",null),(0,n.default)(this,"serialiser",void 0),this.serialiser=new v(e,r,this)}async load(){await this.cryptoStore.doTxn("readonly",[l.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.getEndToEndDeviceData(e,(e=>{var t;this.hasFetched=Boolean(e&&e.devices),this.devices=e?e.devices:{},this.crossSigningInfo=e&&e.crossSigningInfo||{},this.deviceTrackingStatus=e?e.trackingStatus:{},this.syncToken=null!==(t=null==e?void 0:e.syncToken)&&void 0!==t?t:null,this.userByIdentityKey={};for(const e of Object.keys(this.devices)){const t=this.devices[e];for(const r of Object.keys(t)){const i=t[r].keys["curve25519:"+r];void 0!==i&&(this.userByIdentityKey[i]=e)}}}))}));for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]==p.DownloadInProgress&&(this.deviceTrackingStatus[e]=p.PendingDownload)}stop(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}async saveIfDirty(e=500){if(!this.dirty)return Promise.resolve(!1);const t=Date.now()+e;this.savePromiseTime&&t<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null);let r=this.savePromise;if(null===r&&(r=new Promise((e=>{this.resolveSavePromise=e})),this.savePromise=r),null===this.saveTimer){const r=this.resolveSavePromise;this.savePromiseTime=t,this.saveTimer=setTimeout((()=>{o.logger.log("Saving device tracking data",this.syncToken),this.savePromiseTime=null,this.saveTimer=null,this.savePromise=null,this.resolveSavePromise=null,this.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{var t;this.cryptoStore.storeEndToEndDeviceData({devices:this.devices,crossSigningInfo:this.crossSigningInfo,trackingStatus:this.deviceTrackingStatus,syncToken:null!==(t=this.syncToken)&&void 0!==t?t:void 0},e)})).then((()=>{this.dirty=!1,null==r||r(!0)}),(e=>{o.logger.error("Failed to save device tracking data",this.syncToken),o.logger.error(e)}))}),e)}return r}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,t){const r=[],i=[];if(e.forEach((e=>{const n=this.deviceTrackingStatus[e];this.keyDownloadsInProgressByUser.has(e)?(o.logger.log(`downloadKeys: already have a download in progress for ${e}: awaiting its result`),i.push(this.keyDownloadsInProgressByUser.get(e))):(t||n!=p.UpToDate)&&r.push(e)})),0!=r.length){o.logger.log("downloadKeys: downloading for",r);const e=this.doKeyDownload(r);i.push(e)}return 0===i.length&&o.logger.log("downloadKeys: already have all necessary keys"),Promise.all(i).then((()=>this.getDevicesFromStore(e)))}getDevicesFromStore(e){const t={};return e.forEach((e=>{t[e]={};(this.getStoredDevicesForUser(e)||[]).forEach((function(r){t[e][r.deviceId]=r}))})),t}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){const t=this.devices[e];if(!t)return null;const r=[];for(const e in t)t.hasOwnProperty(e)&&r.push(s.DeviceInfo.fromStorage(t[e],e));return r}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?a.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}getStoredDevice(e,t){const r=this.devices[e];if(null!=r&&r[t])return s.DeviceInfo.fromStorage(r[t],t)}getUserByIdentityKey(e,t){return e!==c.OLM_ALGORITHM&&e!==c.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}getDeviceByIdentityKey(e,t){const r=this.getUserByIdentityKey(e,t);if(!r)return null;const i=this.devices[r];if(!i)return null;for(const e in i){if(!i.hasOwnProperty(e))continue;const r=i[e];for(const i in r.keys){if(!r.keys.hasOwnProperty(i))continue;if(0!==i.indexOf("curve25519:"))continue;if(r.keys[i]==t)return s.DeviceInfo.fromStorage(r,e)}}return null}storeDevicesForUser(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(o.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=p.PendingDownload,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(o.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=p.NotTracked,this.dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=p.NotTracked;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(o.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=p.PendingDownload,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this.deviceTrackingStatus)){this.deviceTrackingStatus[t]==p.PendingDownload&&e.push(t)}return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,t){if(void 0!==this.devices[e])for(const[t,r]of Object.entries(this.devices[e])){const e=r.keys["curve25519:"+t];delete this.userByIdentityKey[e]}this.devices[e]=t;for(const[r,i]of Object.entries(t)){const t=i.keys["curve25519:"+r];this.userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this.crossSigningInfo[e]=t}doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((()=>{r(!0)}),(t=>{throw o.logger.error("Error downloading keys for "+e+":",t),r(!1),t}));e.forEach((e=>{this.keyDownloadsInProgressByUser.set(e,t);this.deviceTrackingStatus[e]==p.PendingDownload&&(this.deviceTrackingStatus[e]=p.DownloadInProgress)}));const r=r=>{this.emit(d.CryptoEvent.WillUpdateDevices,e,!this.hasFetched),e.forEach((e=>{if(this.dirty=!0,this.keyDownloadsInProgressByUser.get(e)!==t)return void o.logger.log("Another update in the queue for",e,"- not marking up-to-date");this.keyDownloadsInProgressByUser.delete(e);this.deviceTrackingStatus[e]==p.DownloadInProgress&&(r?(this.deviceTrackingStatus[e]=p.UpToDate,o.logger.log("Device list for",e,"now up to date")):this.deviceTrackingStatus[e]=p.PendingDownload)})),this.saveIfDirty(),this.emit(d.CryptoEvent.DevicesUpdated,e,!this.hasFetched),this.hasFetched=!0};return t}}e.exports.DeviceList=g;class v{constructor(e,t,r){this.baseApis=e,this.olmDevice=t,this.deviceList=r,(0,n.default)(this,"downloadInProgress",!1),(0,n.default)(this,"keyDownloadsQueuedByUser",{}),(0,n.default)(this,"queuedQueryDeferred",void 0),(0,n.default)(this,"syncToken",void 0)}updateDevicesForUsers(e,t){return e.forEach((e=>{this.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,u.defer)()),this.syncToken=t,this.downloadInProgress?(o.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");const e=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};const t=this.queuedQueryDeferred;this.queuedQueryDeferred=void 0,o.logger.log("Starting key download for",e),this.downloadInProgress=!0;const r={};this.syncToken&&(r.token=this.syncToken);const i=[];for(let t=0;t<e.length;t+=this.deviceList.keyDownloadChunkSize){const n=e.slice(t,t+this.deviceList.keyDownloadChunkSize);i.push((()=>this.baseApis.downloadKeysForUsers(n,r)))}return(0,u.chunkPromises)(i,3).then((async t=>{const r=Object.assign({},...t.map((e=>e.device_keys||{}))),i=Object.assign({},...t.map((e=>e.master_keys||{}))),n=Object.assign({},...t.map((e=>e.self_signing_keys||{}))),s=Object.assign({},...t.map((e=>e.user_signing_keys||{})));for(const t of e){await(0,u.sleep)(5);try{await this.processQueryResponseForUser(t,r[t],{master:null==i?void 0:i[t],self_signing:null==n?void 0:n[t],user_signing:null==s?void 0:s[t]})}catch(e){o.logger.error(`Error processing keys for ${t}:`,e)}}})).then((()=>{o.logger.log("Completed key download for "+e),this.downloadInProgress=!1,null==t||t.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()}),(r=>{o.logger.warn("Error downloading keys for "+e+":",r),this.downloadInProgress=!1,null==t||t.reject(r)})),t.promise}async processQueryResponseForUser(e,t,r){o.logger.log("got device keys for "+e+":",t),o.logger.log("got cross-signing keys for "+e+":",r);{const r={},i=this.deviceList.getRawStoredDevicesForUser(e);i&&Object.keys(i).forEach((e=>{const t=s.DeviceInfo.fromStorage(i[e],e);r[e]=t})),await async function(e,t,r,i,n,s){let a=!1;for(const e in r)if(r.hasOwnProperty(e)&&!(e in i)){if(t===n&&e===s){o.logger.warn(`Local device ${e} missing from sync, skipping removal`);continue}o.logger.log("Device "+t+":"+e+" has been removed"),delete r[e],a=!0}for(const n in i){if(!i.hasOwnProperty(n))continue;const s=i[n];s.user_id===t?s.device_id===n?await y(e,r,s)&&(a=!0):o.logger.warn("Mismatched device_id "+s.device_id+" in keys from "+t+":"+n):o.logger.warn("Mismatched user_id "+s.user_id+" in keys from "+t+":"+n)}return a}(this.olmDevice,e,r,t||{},this.baseApis.getUserId(),this.baseApis.deviceId);const n={};Object.keys(r).forEach((e=>{n[e]=r[e].toStorage()})),this.deviceList.setRawStoredDevicesForUser(e,n)}if(r&&(r.master||r.self_signing||r.user_signing)){const t=this.deviceList.getStoredCrossSigningForUser(e)||new a.CrossSigningInfo(e);t.setKeys(r),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this.deviceList.emit(d.CryptoEvent.UserCrossSigningUpdated,e)}}}async function y(e,t,r){if(!r.keys)return!1;const i=r.device_id,n=r.user_id,a="ed25519:"+i,l=r.keys[a];if(!l)return o.logger.warn("Device "+n+":"+i+" has no ed25519 key"),!1;const u=r.unsigned||{},h=r.signatures||{};try{await c.verifySignature(e,r,n,i,l)}catch(e){return o.logger.warn("Unable to verify signature on device "+n+":"+i+":"+e),!1}let d;if(i in t){if(d=t[i],d.getFingerprint()!=l)return o.logger.warn("Ed25519 key for device "+n+":"+i+" has changed"),!1}else t[i]=d=new s.DeviceInfo(i);return d.keys=r.keys||{},d.algorithms=r.algorithms||[],d.unsigned=u,d.signatures=h,!0}})),i.register("hclBt",(function(e,t){var n=i("awmEs").Buffer,o=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UserTrustLevel=e.exports.DeviceTrustLevel=e.exports.CrossSigningLevel=e.exports.CrossSigningInfo=void 0,e.exports.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:async function(r,i){const o=await new Promise((t=>e.doTxn("readonly",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(i=>{e.getSecretStorePrivateKey(i,t,r)}))));if(o&&o.ciphertext){const e=n.from(t.pickleKey),i=await(0,u.decryptAES)(o,e,r);return(0,a.decodeBase64)(i)}return o},storeCrossSigningKeyCache:async function(r,i){if(!(i instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${i}`);const o=n.from(t.pickleKey),s=await(0,u.encryptAES)((0,a.encodeBase64)(i),o,r);return e.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.storeSecretStorePrivateKey(t,r,s)}))}}},e.exports.requestKeysDuringVerification=async function(e,t,r){if(e.getUserId()!==t)return;return c.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise(((t,i)=>{const n=e,o=n.crypto.crossSigningInfo,s=new f(o.userId,{getCrossSigningKey:async e=>{c.logger.debug("Cross-signing: requesting secret",e,r);const{promise:t}=n.requestSecret(`m.cross_signing.${e}`,[r]),i=await t,o=(0,a.decodeBase64)(i);return Uint8Array.from(o)}},o.getCacheCallbacks());s.keys=o.keys;const l=new Promise((e=>{setTimeout(e,h,new Error("Timeout"))})),u=(async()=>{if(!await n.crypto.getSessionBackupPrivateKey()){c.logger.info("No cached backup key found. Requesting...");const e=n.requestSecret("m.megolm_backup.v1",[r]),t=await e.promise;c.logger.info("Got key backup key, decoding...");const i=(0,a.decodeBase64)(t);c.logger.info("Decoded backup key, storing..."),await n.crypto.storeSessionBackupPrivateKey(Uint8Array.from(i)),c.logger.info("Backup key stored. Starting backup restore...");const o=await n.getKeyBackupVersion();n.restoreKeyBackupWithCache(void 0,void 0,o).then((()=>{c.logger.info("Backup restored.")}))}})();return Promise.race([Promise.all([s.getCrossSigningKey("master"),s.getCrossSigningKey("self_signing"),s.getCrossSigningKey("user_signing"),u]),l]).then(t,i)})).catch((e=>{c.logger.warn("Cross-signing: failure while requesting keys:",e)}))};var s=o(i("3EUCw")),a=i("dvbGC"),c=i("gEWrD"),l=i("gH6iW"),u=i("cCj6D");const h=6e4;function d(e){return Object.values(e.keys)[0]}class f{constructor(e,t={},r={}){this.userId=e,this.callbacks=t,this.cacheCallbacks=r,(0,s.default)(this,"keys",{}),(0,s.default)(this,"firstUse",!0),(0,s.default)(this,"crossSigningVerifiedBefore",!1)}static fromStorage(e,t){const r=new f(t);for(const t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(e,t){const i=["master","self_signing","user_signing"].indexOf(e)>=0;if(!this.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function n(e){if(!e)return;const i=new r.Olm.PkSigning,n=i.init_with_seed(e);if(n===t)return[n,i];i.free()}void 0===t&&(t=this.getId(e));let o=null;this.cacheCallbacks.getCrossSigningKeyCache&&i&&(o=await this.cacheCallbacks.getCrossSigningKeyCache(e,t));const s=n(o);if(s)return s;o=await this.callbacks.getCrossSigningKey(e,t);const a=n(o);if(a)return this.cacheCallbacks.storeCrossSigningKeyCache&&i&&await this.cacheCallbacks.storeCrossSigningKeyCache(e,o),a;if(!o)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}async isStoredInSecretStorage(e){const t=await e.isStored("m.cross_signing.master")||{};function r(e){for(const r of Object.keys(t))e[r]||delete t[r]}for(const t of["self_signing","user_signing"])r(await e.isStored(`m.cross_signing.${t}`)||{});return Object.keys(t).length?t:null}static async storeInSecretStorage(e,t){for(const[r,i]of e){const e=(0,a.encodeBase64)(i);await t.store(`m.cross_signing.${r}`,e)}}static async getFromSecretStorage(e,t){const r=await t.get(`m.cross_signing.${e}`);return r?(0,a.decodeBase64)(r):null}async isStoredInKeyCache(e){const t=this.cacheCallbacks;if(!t)return!1;const r=e?[e]:["master","self_signing","user_signing"];for(const e of r){var i;if(!await(null===(i=t.getCrossSigningKeyCache)||void 0===i?void 0:i.call(t,e)))return!1}return!0}async getCrossSigningKeysFromCache(){const e=new Map,t=this.cacheCallbacks;if(!t)return e;for(const i of["master","self_signing","user_signing"]){var r;const n=await(null===(r=t.getCrossSigningKeyCache)||void 0===r?void 0:r.call(t,i));n&&e.set(i,n)}return e}getId(e="master"){if(!this.keys[e])return null;return d(this.keys[e])}async resetKeys(e){if(!this.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&p.MASTER||!this.keys.master)e=p.MASTER|p.USER_SIGNING|p.SELF_SIGNING;else if(0===e)return;const t={},i={};let n,o;try{if(e&p.MASTER?(n=new r.Olm.PkSigning,t.master=n.generate_seed(),o=n.init_with_seed(t.master),i.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+o]:o}}):[o,n]=await this.getCrossSigningKey("master"),e&p.SELF_SIGNING){const e=new r.Olm.PkSigning;try{t.self_signing=e.generate_seed();const r=e.init_with_seed(t.self_signing);i.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+r]:r}},(0,a.pkSign)(i.self_signing,n,this.userId,o)}finally{e.free()}}if(e&p.USER_SIGNING){const e=new r.Olm.PkSigning;try{t.user_signing=e.generate_seed();const r=e.init_with_seed(t.user_signing);i.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+r]:r}},(0,a.pkSign)(i.user_signing,n,this.userId,o)}finally{e.free()}}Object.assign(this.keys,i),this.callbacks.saveCrossSigningKeys(t)}finally{n&&n.free()}}clearKeys(){this.keys={}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw c.logger.error(t),new Error(t)}this.keys.master?d(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const r=d(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw c.logger.error(t),new Error(t)}try{(0,a.pkVerify)(e.user_signing,r,this.userId)}catch(e){throw c.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw c.logger.error(t),new Error(t)}try{(0,a.pkVerify)(e.self_signing,r,this.userId)}catch(e){throw c.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,delete this.keys.self_signing,delete this.keys.user_signing),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[r,i]=await this.getCrossSigningKey(t);try{return(0,a.pkSign)(e,i,this.userId,r),e}finally{i.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing");c.logger.info("No user signing key: not signing user")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");c.logger.info("No self signing key: not signing device")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new g(!0,!0,this.firstUse);if(!this.keys.user_signing)return new g(!1,!1,e.firstUse);let t;const r=e.keys.master,i=this.getId("user_signing");try{(0,a.pkVerify)(r,i,this.userId),t=!0}catch(e){t=!1}return new g(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,r,i){const n=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new v(!1,!1,r,i);const s=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,a.pkVerify)(o,e.getId(),e.userId),(0,a.pkVerify)(s,d(o),e.userId),v.fromUserTrustLevel(n,r,i)}catch(e){return new v(!1,!1,r,i)}}getCacheCallbacks(){return this.cacheCallbacks}}let p;var m;e.exports.CrossSigningInfo=f,e.exports.CrossSigningLevel=p,(m=p||(e.exports.CrossSigningLevel=p={}))[m.MASTER=4]="MASTER",m[m.USER_SIGNING=2]="USER_SIGNING",m[m.SELF_SIGNING=1]="SELF_SIGNING";class g{constructor(e,t,r){this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=r}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}e.exports.UserTrustLevel=g;class v{constructor(e,t,r,i){this.crossSigningVerified=e,this.tofu=t,this.localVerified=r,this.trustCrossSignedDevices=i}static fromUserTrustLevel(e,t,r){return new v(e.isCrossSigningVerified(),e.isTofu(),t,r)}isVerified(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}e.exports.DeviceTrustLevel=v})),i.register("cCj6D",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.calculateKeyCheck=function(e,t){return s(c,e,"",t)},e.exports.decryptAES=async function(e,t,i){const[o,s]=await a(t,i),c=(0,r.decodeBase64)(e.ciphertext);if(!await n.subtleCrypto.verify({name:"HMAC"},s,(0,r.decodeBase64)(e.mac),c))throw new Error(`Error decrypting secret ${i}: bad MAC`);const l=await n.subtleCrypto.decrypt({name:"AES-CTR",counter:(0,r.decodeBase64)(e.iv),length:64},o,c);return(new TextDecoder).decode(new Uint8Array(l))},e.exports.encryptAES=s;var r=i("dvbGC"),n=i("cNkid");const o=new Uint8Array(8);async function s(e,t,i,o){let s;o?s=(0,r.decodeBase64)(o):(s=new Uint8Array(16),n.crypto.getRandomValues(s),s[8]&=127);const[c,l]=await a(t,i),u=(new n.TextEncoder).encode(e),h=await n.subtleCrypto.encrypt({name:"AES-CTR",counter:s,length:64},c,u),d=await n.subtleCrypto.sign({name:"HMAC"},l,h);return{iv:(0,r.encodeBase64)(s),ciphertext:(0,r.encodeBase64)(h),mac:(0,r.encodeBase64)(d)}}async function a(e,t){const r=await n.subtleCrypto.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),i=await n.subtleCrypto.deriveBits({name:"HKDF",salt:o,info:(new n.TextEncoder).encode(t),hash:"SHA-256"},r,512),s=i.slice(0,32),a=i.slice(32),c=n.subtleCrypto.importKey("raw",s,{name:"AES-CTR"},!1,["encrypt","decrypt"]),l=n.subtleCrypto.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([c,l])}const c="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"})),i.register("cNkid",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.crypto=e.exports.TextEncoder=void 0,e.exports.setCrypto=function(t){var r;e.exports.crypto=d=t,e.exports.subtleCrypto=f=null!==(r=t.subtle)&&void 0!==r?r:t.webkitSubtle},e.exports.setTextEncoder=function(t){e.exports.TextEncoder=p=t},e.exports.subtleCrypto=void 0;var n,o,s,a,c,l,u,h=i("gEWrD");let d=null===(n=r.window)||void 0===n?void 0:n.crypto;e.exports.crypto=d;let f=null!==(o=null===(s=r.window)||void 0===s||null===(a=s.crypto)||void 0===a?void 0:a.subtle)&&void 0!==o?o:null===(c=r.window)||void 0===c||null===(l=c.crypto)||void 0===l?void 0:l.webkitSubtle;e.exports.subtleCrypto=f;let p=null===(u=r.window)||void 0===u?void 0:u.TextEncoder;if(e.exports.TextEncoder=p,!d)try{e.exports.crypto=d=i("a5hY7").webcrypto}catch(e){h.logger.error("Failed to load webcrypto",e)}var m;f||(e.exports.subtleCrypto=f=null===(m=d)||void 0===m?void 0:m.subtle);if(!p)try{e.exports.TextEncoder=p=i("gOtyk").TextEncoder}catch(e){h.logger.error("Failed to load TextEncoder util",e)}})),i.register("a5hY7",(function(e,t){i("1oa4b"),i("eRLLs"),i("9SGAM");var r=i("jxFqc"),n=Object.keys(r),o=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(n);var s=i("wQ7R3");s.pbkdf2,s.pbkdf2Sync;var a=i("hHzFD");a.Cipher,a.createCipher,a.Cipheriv,a.createCipheriv,a.Decipher,a.createDecipher,a.Decipheriv,a.createDecipheriv,a.getCiphers,a.listCiphers;var c=i("ePdJQ");c.DiffieHellmanGroup,c.createDiffieHellmanGroup,c.getDiffieHellman,c.createDiffieHellman,c.DiffieHellman;var l=i("aUuNJ");l.createSign,l.Sign,l.createVerify,l.Verify,i("1R43x");var u=i("8oudU");u.publicEncrypt,u.privateEncrypt,u.publicDecrypt,u.privateDecrypt;var h=i("bxyoK");h.randomFill,h.randomFillSync})),i.register("1oa4b",(function(e,t){var n=i("9Mq5w"),o=65536,s=4294967295;var a=i("k0Rto").Buffer,c=r.crypto||r.msCrypto;c&&c.getRandomValues?e.exports=function(e,t){if(e>s)throw new RangeError("requested too many random bytes");var r=a.allocUnsafe(e);if(e>0)if(e>o)for(var i=0;i<e;i+=o)c.getRandomValues(r.slice(i,i+o));else c.getRandomValues(r);return"function"==typeof t?n.nextTick((function(){t(null,r)})):r}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}})),i.register("k0Rto",(function(e,t){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=i("awmEs"),n=r.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(o(r,e.exports),e.exports.Buffer=s),s.prototype=Object.create(n.prototype),o(n,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=n(e);return void 0!==t?"string"==typeof r?i.fill(t,r):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}})),i.register("eRLLs",(function(e,t){var r=i("6cuMU"),n=i("liMpH"),o=i("D6ODP"),s=i("9iz0U"),a=i("eYksn");function c(e){a.call(this,"digest"),this._hash=e}r(c,a),c.prototype._update=function(e){this._hash.update(e)},c.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return"md5"===(e=e.toLowerCase())?new n:"rmd160"===e||"ripemd160"===e?new o:new c(s(e))}})),i.register("6cuMU",(function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}})),i.register("liMpH",(function(e,t){var r=i("6cuMU"),n=i("ikMd7"),o=i("k0Rto").Buffer,s=new Array(16);function a(){n.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function c(e,t){return e<<t|e>>>32-t}function l(e,t,r,i,n,o,s){return c(e+(t&r|~t&i)+n+o|0,s)+t|0}function u(e,t,r,i,n,o,s){return c(e+(t&i|r&~i)+n+o|0,s)+t|0}function h(e,t,r,i,n,o,s){return c(e+(t^r^i)+n+o|0,s)+t|0}function d(e,t,r,i,n,o,s){return c(e+(r^(t|~i))+n+o|0,s)+t|0}r(a,n),a.prototype._update=function(){for(var e=s,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var r=this._a,i=this._b,n=this._c,o=this._d;r=l(r,i,n,o,e[0],3614090360,7),o=l(o,r,i,n,e[1],3905402710,12),n=l(n,o,r,i,e[2],606105819,17),i=l(i,n,o,r,e[3],3250441966,22),r=l(r,i,n,o,e[4],4118548399,7),o=l(o,r,i,n,e[5],1200080426,12),n=l(n,o,r,i,e[6],2821735955,17),i=l(i,n,o,r,e[7],4249261313,22),r=l(r,i,n,o,e[8],1770035416,7),o=l(o,r,i,n,e[9],2336552879,12),n=l(n,o,r,i,e[10],4294925233,17),i=l(i,n,o,r,e[11],2304563134,22),r=l(r,i,n,o,e[12],1804603682,7),o=l(o,r,i,n,e[13],4254626195,12),n=l(n,o,r,i,e[14],2792965006,17),r=u(r,i=l(i,n,o,r,e[15],1236535329,22),n,o,e[1],4129170786,5),o=u(o,r,i,n,e[6],3225465664,9),n=u(n,o,r,i,e[11],643717713,14),i=u(i,n,o,r,e[0],3921069994,20),r=u(r,i,n,o,e[5],3593408605,5),o=u(o,r,i,n,e[10],38016083,9),n=u(n,o,r,i,e[15],3634488961,14),i=u(i,n,o,r,e[4],3889429448,20),r=u(r,i,n,o,e[9],568446438,5),o=u(o,r,i,n,e[14],3275163606,9),n=u(n,o,r,i,e[3],4107603335,14),i=u(i,n,o,r,e[8],1163531501,20),r=u(r,i,n,o,e[13],2850285829,5),o=u(o,r,i,n,e[2],4243563512,9),n=u(n,o,r,i,e[7],1735328473,14),r=h(r,i=u(i,n,o,r,e[12],2368359562,20),n,o,e[5],4294588738,4),o=h(o,r,i,n,e[8],2272392833,11),n=h(n,o,r,i,e[11],1839030562,16),i=h(i,n,o,r,e[14],4259657740,23),r=h(r,i,n,o,e[1],2763975236,4),o=h(o,r,i,n,e[4],1272893353,11),n=h(n,o,r,i,e[7],4139469664,16),i=h(i,n,o,r,e[10],3200236656,23),r=h(r,i,n,o,e[13],681279174,4),o=h(o,r,i,n,e[0],3936430074,11),n=h(n,o,r,i,e[3],3572445317,16),i=h(i,n,o,r,e[6],76029189,23),r=h(r,i,n,o,e[9],3654602809,4),o=h(o,r,i,n,e[12],3873151461,11),n=h(n,o,r,i,e[15],530742520,16),r=d(r,i=h(i,n,o,r,e[2],3299628645,23),n,o,e[0],4096336452,6),o=d(o,r,i,n,e[7],1126891415,10),n=d(n,o,r,i,e[14],2878612391,15),i=d(i,n,o,r,e[5],4237533241,21),r=d(r,i,n,o,e[12],1700485571,6),o=d(o,r,i,n,e[3],2399980690,10),n=d(n,o,r,i,e[10],4293915773,15),i=d(i,n,o,r,e[1],2240044497,21),r=d(r,i,n,o,e[8],1873313359,6),o=d(o,r,i,n,e[15],4264355552,10),n=d(n,o,r,i,e[6],2734768916,15),i=d(i,n,o,r,e[13],1309151649,21),r=d(r,i,n,o,e[4],4149444226,6),o=d(o,r,i,n,e[11],3174756917,10),n=d(n,o,r,i,e[2],718787259,15),i=d(i,n,o,r,e[9],3951481745,21),this._a=this._a+r|0,this._b=this._b+i|0,this._c=this._c+n|0,this._d=this._d+o|0},a.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=o.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=a})),i.register("ikMd7",(function(e,t){var r=i("k0Rto").Buffer,n=i("l8KM5").Transform;function o(e){n.call(this),this._block=r.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}i("6cuMU")(o,n),o.prototype._transform=function(e,t,r){var i=null;try{this.update(e,t)}catch(e){i=e}r(i)},o.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},o.prototype.update=function(e,t){if(function(e,t){if(!r.isBuffer(e)&&"string"!=typeof e)throw new TypeError(t+" must be a string or a buffer")}(e,"Data"),this._finalized)throw new Error("Digest already called");r.isBuffer(e)||(e=r.from(e,t));for(var i=this._block,n=0;this._blockOffset+e.length-n>=this._blockSize;){for(var o=this._blockOffset;o<this._blockSize;)i[o++]=e[n++];this._update(),this._blockOffset=0}for(;n<e.length;)i[this._blockOffset++]=e[n++];for(var s=0,a=8*e.length;a>0;++s)this._length[s]+=a,(a=this._length[s]/4294967296|0)>0&&(this._length[s]-=4294967296*a);return this},o.prototype._update=function(){throw new Error("_update is not implemented")},o.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var r=0;r<4;++r)this._length[r]=0;return t},o.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=o})),i.register("l8KM5",(function(e,t){(t=e.exports=i("340fO")).Stream=t,t.Readable=t,t.Writable=i("lWtyM"),t.Duplex=i("1SlAW"),t.Transform=i("f7L7V"),t.PassThrough=i("dX7Dt"),t.finished=i("f6xbQ"),t.pipeline=i("2mqHM")})),i.register("340fO",(function(e,t){var n,o=i("9Mq5w");e.exports=I,I.ReadableState=C;i("k4yOc").EventEmitter;var s=function(e,t){return e.listeners(t).length},a=i("4HDlr"),c=i("awmEs").Buffer,l=r.Uint8Array||function(){};var u,h=i("4AFFV");u=h&&h.debuglog?h.debuglog("stream"):function(){};var d,f,p,m=i("3QRBN"),g=i("5CW71"),v=i("71wq3").getHighWaterMark,y=i("kdLmP").codes,b=y.ERR_INVALID_ARG_TYPE,w=y.ERR_STREAM_PUSH_AFTER_EOF,_=y.ERR_METHOD_NOT_IMPLEMENTED,S=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i("6cuMU")(I,a);var E=g.errorOrDestroy,M=["error","close","destroy","pause","resume"];function C(e,t,r){n=n||i("1SlAW"),e=e||{},"boolean"!=typeof r&&(r=t instanceof n),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=v(this,e,"readableHighWaterMark",r),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=i("bWgSm").StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function I(e){if(n=n||i("1SlAW"),!(this instanceof I))return new I(e);var t=this instanceof n;this._readableState=new C(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function T(e,t,r,i,n){u("readableAddChunk",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(u("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}(e,s);else if(n||(o=function(e,t){var r;i=t,c.isBuffer(i)||i instanceof l||"string"==typeof t||void 0===t||e.objectMode||(r=new b("chunk",["string","Buffer","Uint8Array"],t));var i;return r}(s,t)),o)E(e,o);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),i)s.endEmitted?E(e,new S):k(e,s,t,!0);else if(s.ended)E(e,new w);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?k(e,s,t,!1):P(e,s)):k(e,s,t,!1)}else i||(s.reading=!1,P(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function k(e,t,r,i){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&O(e)),P(e,t)}Object.defineProperty(I.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),I.prototype.destroy=g.destroy,I.prototype._undestroy=g.undestroy,I.prototype._destroy=function(e,t){t(e)},I.prototype.push=function(e,t){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=c.from(e,t),t=""),r=!0),T(this,e,t,!1,r)},I.prototype.unshift=function(e){return T(this,e,null,!0,!1)},I.prototype.isPaused=function(){return!1===this._readableState.flowing},I.prototype.setEncoding=function(e){d||(d=i("bWgSm").StringDecoder);var t=new d(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var R=1073741824;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=R?e=R:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function O(e){var t=e._readableState;u("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(u("emitReadable",t.flowing),t.emittedReadable=!0,o.nextTick(A,e))}function A(e){var t=e._readableState;u("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,j(e)}function P(e,t){t.readingMore||(t.readingMore=!0,o.nextTick(D,e,t))}function D(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(u("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function U(e){u("readable nexttick read 0"),e.read(0)}function N(e,t){u("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),j(e),t.flowing&&!t.reading&&e.read(0)}function j(e){var t=e._readableState;for(u("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function F(e){var t=e._readableState;u("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,o.nextTick(K,t,e))}function K(e,t){if(u("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function q(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}I.prototype.read=function(e){u("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return u("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):O(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&F(this),null;var i,n=t.needReadable;return u("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&u("length less than watermark",n=!0),t.ended||t.reading?u("reading or ended",n=!1):n&&(u("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(r,t))),null===(i=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&F(this)),null!==i&&this.emit("data",i),i},I.prototype._read=function(e){E(this,new _("_read()"))},I.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,u("pipe count=%d opts=%j",i.pipesCount,t);var n=(!t||!1!==t.end)&&e!==o.stdout&&e!==o.stderr?c:g;function a(t,n){u("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,u("cleanup"),e.removeListener("close",p),e.removeListener("finish",m),e.removeListener("drain",l),e.removeListener("error",f),e.removeListener("unpipe",a),r.removeListener("end",c),r.removeListener("end",g),r.removeListener("data",d),h=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function c(){u("onend"),e.end()}i.endEmitted?o.nextTick(n):r.once("end",n),e.on("unpipe",a);var l=function(e){return function(){var t=e._readableState;u("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,j(e))}}(r);e.on("drain",l);var h=!1;function d(t){u("ondata");var n=e.write(t);u("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==q(i.pipes,e))&&!h&&(u("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function f(t){u("onerror",t),g(),e.removeListener("error",f),0===s(e,"error")&&E(e,t)}function p(){e.removeListener("finish",m),g()}function m(){u("onfinish"),e.removeListener("close",p),g()}function g(){u("unpipe"),r.unpipe(e)}return r.on("data",d),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",f),e.once("close",p),e.once("finish",m),e.emit("pipe",r),i.flowing||(u("pipe resume"),r.resume()),e},I.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<n;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=q(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},I.prototype.on=function(e,t){var r=a.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,u("on readable",i.length,i.reading),i.length?O(this):i.reading||o.nextTick(U,this))),r},I.prototype.addListener=I.prototype.on,I.prototype.removeListener=function(e,t){var r=a.prototype.removeListener.call(this,e,t);return"readable"===e&&o.nextTick(L,this),r},I.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||o.nextTick(L,this),t},I.prototype.resume=function(){var e=this._readableState;return e.flowing||(u("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,o.nextTick(N,e,t))}(this,e)),e.paused=!1,this},I.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},I.prototype.wrap=function(e){var t=this,r=this._readableState,i=!1;for(var n in e.on("end",(function(){if(u("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(n){(u("wrapped data"),r.decoder&&(n=r.decoder.write(n)),r.objectMode&&null==n)||(r.objectMode||n&&n.length)&&(t.push(n)||(i=!0,e.pause()))})),e)void 0===this[n]&&"function"==typeof e[n]&&(this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n));for(var o=0;o<M.length;o++)e.on(M[o],this.emit.bind(this,M[o]));return this._read=function(t){u("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"==typeof Symbol&&(I.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=i("Mkrm6")),f(this)}),Object.defineProperty(I.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(I.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(I.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),I._fromList=B,Object.defineProperty(I.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(I.from=function(e,t){return void 0===p&&(p=i("7UlCx")),p(I,e,t)})})),i.register("4HDlr",(function(e,t){e.exports=i("k4yOc").EventEmitter})),i.register("4AFFV",(function(e,t){})),i.register("3QRBN",(function(e,t){function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=i("awmEs").Buffer,a=i("4AFFV").inspect,c=a&&a.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,i,l;return t=e,i=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,r,i,n=s.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,r=n,i=a,s.prototype.copy.call(t,r,i),a+=o.data.length,o=o.next;return n}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,i=t.data;for(e-=i.length;t=t.next;){var n=t.data,o=e>n.length?n.length:e;if(o===n.length?i+=n:i+=n.slice(0,e),0==(e-=o)){o===n.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=n.slice(o));break}++r}return this.length-=r,i}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),r=this.head,i=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var n=r.data,o=e>n.length?n.length:e;if(n.copy(t,t.length-e,0,o),0==(e-=o)){o===n.length?(++i,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=n.slice(o));break}++i}return this.length-=i,t}},{key:c,value:function(e,t){return a(this,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],i&&o(t.prototype,i),l&&o(t,l),e}()})),i.register("5CW71",(function(e,t){var r=i("9Mq5w");function n(e,t){s(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var i=this,a=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return a||c?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(s,this,e)):r.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?i._writableState?i._writableState.errorEmitted?r.nextTick(o,i):(i._writableState.errorEmitted=!0,r.nextTick(n,i,e)):r.nextTick(n,i,e):t?(r.nextTick(o,i),t(e)):r.nextTick(o,i)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,i=e._writableState;r&&r.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}}})),i.register("71wq3",(function(e,t){var r=i("kdLmP").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,i,n){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,n,i);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(n?i:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}})),i.register("kdLmP",(function(t,r){var i;e(t.exports,"codes",(()=>i),(e=>i=e));var n={};function o(e,t,r){r||(r=Error);var i=function(e){var r,i;function n(r,i,n){return e.call(this,function(e,r,i){return"string"==typeof t?t:t(e,r,i)}(r,i,n))||this}return i=e,(r=n).prototype=Object.create(i.prototype),r.prototype.constructor=r,r.__proto__=i,n}(r);i.prototype.name=r.name,i.prototype.code=e,n[e]=i}function s(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}o("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),o("ERR_INVALID_ARG_TYPE",(function(e,t,r){var i,n,o,a;if("string"==typeof t&&(n="not ",t.substr(!o||o<0?0:+o,n.length)===n)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))a="The ".concat(e," ").concat(i," ").concat(s(t,"type"));else{var c=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";a='The "'.concat(e,'" ').concat(c," ").concat(i," ").concat(s(t,"type"))}return a+=". Received type ".concat(typeof r)}),TypeError),o("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),o("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),o("ERR_STREAM_PREMATURE_CLOSE","Premature close"),o("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),o("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),o("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),o("ERR_STREAM_WRITE_AFTER_END","write after end"),o("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),o("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),o("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),i=n})),i.register("1SlAW",(function(e,t){var r=i("9Mq5w"),n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=u;var o=i("340fO"),s=i("lWtyM");i("6cuMU")(u,o);for(var a=n(s.prototype),c=0;c<a.length;c++){var l=a[c];u.prototype[l]||(u.prototype[l]=s.prototype[l])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})})),i.register("lWtyM",(function(e,t){var n,o=i("9Mq5w");function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var i=e.entry;e.entry=null;for(;i;){var n=i.callback;t.pendingcb--,n(r),i=i.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=I,I.WritableState=C;var a={deprecate:i("bmKAk")},c=i("4HDlr"),l=i("awmEs").Buffer,u=r.Uint8Array||function(){};var h,d=i("5CW71"),f=i("71wq3").getHighWaterMark,p=i("kdLmP").codes,m=p.ERR_INVALID_ARG_TYPE,g=p.ERR_METHOD_NOT_IMPLEMENTED,v=p.ERR_MULTIPLE_CALLBACK,y=p.ERR_STREAM_CANNOT_PIPE,b=p.ERR_STREAM_DESTROYED,w=p.ERR_STREAM_NULL_VALUES,_=p.ERR_STREAM_WRITE_AFTER_END,S=p.ERR_UNKNOWN_ENCODING,E=d.errorOrDestroy;function M(){}function C(e,t,r){n=n||i("1SlAW"),e=e||{},"boolean"!=typeof r&&(r=t instanceof n),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=f(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if("function"!=typeof n)throw new v;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,n){--t.pendingcb,r?(o.nextTick(n,i),o.nextTick(A,e,t),e._writableState.errorEmitted=!0,E(e,i)):(n(i),e._writableState.errorEmitted=!0,E(e,i),A(e,t))}(e,r,i,t,n);else{var s=x(r)||e.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||R(e,r),i?o.nextTick(k,e,r,s,n):k(e,r,s,n)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function I(e){var t=this instanceof(n=n||i("1SlAW"));if(!t&&!h.call(I,this))return new I(e);this._writableState=new C(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function T(e,t,r,i,n,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):r?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function k(e,t,r,i){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),A(e,t)}function R(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),o=t.corkedRequestsFree;o.entry=r;for(var a=0,c=!0;r;)n[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;n.allBuffers=c,T(e,t,!0,t.length,n,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,h=r.callback;if(T(e,t,!1,t.objectMode?1:l.length,l,u,h),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function x(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(r){t.pendingcb--,r&&E(e,r),t.prefinished=!0,e.emit("prefinish"),A(e,t)}))}function A(e,t){var r=x(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,o.nextTick(O,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return r}i("6cuMU")(I,c),C.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(C.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(h=Function.prototype[Symbol.hasInstance],Object.defineProperty(I,Symbol.hasInstance,{value:function(e){return!!h.call(this,e)||this===I&&(e&&e._writableState instanceof C)}})):h=function(e){return e instanceof this},I.prototype.pipe=function(){E(this,new y)},I.prototype.write=function(e,t,r){var i,n=this._writableState,s=!1,a=!n.objectMode&&(i=e,l.isBuffer(i)||i instanceof u);return a&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=M),n.ending?function(e,t){var r=new _;E(e,r),o.nextTick(t,r)}(this,r):(a||function(e,t,r,i){var n;return null===r?n=new w:"string"==typeof r||t.objectMode||(n=new m("chunk",["string","Buffer"],r)),!n||(E(e,n),o.nextTick(i,n),!1)}(this,n,e,r))&&(n.pendingcb++,s=function(e,t,r,i,n,o){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,r));return t}(t,i,n);i!==s&&(r=!0,n="buffer",i=s)}var a=t.objectMode?1:i.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,a,i,n,o);return c}(this,n,a,e,t,r)),s},I.prototype.cork=function(){this._writableState.corked++},I.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||R(this,e))},I.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(I.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(I.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),I.prototype._write=function(e,t,r){r(new g("_write()"))},I.prototype._writev=null,I.prototype.end=function(e,t,r){var i=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,r){t.ending=!0,A(e,t),r&&(t.finished?o.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,i,r),this},Object.defineProperty(I.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(I.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),I.prototype.destroy=d.destroy,I.prototype._undestroy=d.undestroy,I.prototype._destroy=function(e,t){t(e)}})),i.register("bmKAk",(function(e,t){function i(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}})),i.register("bWgSm",(function(t,r){var n;e(t.exports,"StringDecoder",(()=>n),(e=>n=e));var o=i("k0Rto").Buffer,s=o.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(o.isEncoding===s||!s(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=h,t=4;break;case"utf8":this.fillLast=l,t=4;break;case"base64":this.text=d,this.end=f,t=3;break;default:return this.write=p,void(this.end=m)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(t)}function c(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function l(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function h(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function d(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function m(e){return e&&e.length?this.write(e):""}n=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var r=function(e,t,r){var i=t.length-1;if(i<r)return 0;var n=c(t[i]);if(n>=0)return n>0&&(e.lastNeed=n-1),n;if(--i<r||-2===n)return 0;if(n=c(t[i]),n>=0)return n>0&&(e.lastNeed=n-2),n;if(--i<r||-2===n)return 0;if(n=c(t[i]),n>=0)return n>0&&(2===n?n=0:e.lastNeed=n-3),n;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var i=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}})),i.register("Mkrm6",(function(e,t){var r,n=i("9Mq5w");function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=i("f6xbQ"),a=Symbol("lastResolve"),c=Symbol("lastReject"),l=Symbol("error"),u=Symbol("ended"),h=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[a];if(null!==t){var r=e[f].read();null!==r&&(e[h]=null,e[a]=null,e[c]=null,t(p(r,!1)))}}function g(e){n.nextTick(m,e)}var v=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((o(r={get stream(){return this[f]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(t,r){n.nextTick((function(){e[l]?r(e[l]):t(p(void 0,!0))}))}));var r,i=this[h];if(i)r=new Promise(function(e,t){return function(r,i){e.then((function(){t[u]?r(p(void 0,!0)):t[d](r,i)}),i)}}(i,this));else{var o=this[f].read();if(null!==o)return Promise.resolve(p(o,!1));r=new Promise(this[d])}return this[h]=r,r}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,r){e[f].destroy(null,(function(e){e?r(e):t(p(void 0,!0))}))}))})),r),v);e.exports=function(e){var t,r=Object.create(y,(o(t={},f,{value:e,writable:!0}),o(t,a,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,l,{value:null,writable:!0}),o(t,u,{value:e._readableState.endEmitted,writable:!0}),o(t,d,{value:function(e,t){var i=r[f].read();i?(r[h]=null,r[a]=null,r[c]=null,e(p(i,!1))):(r[a]=e,r[c]=t)},writable:!0}),t));return r[h]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[c];return null!==t&&(r[h]=null,r[a]=null,r[c]=null,t(e)),void(r[l]=e)}var i=r[a];null!==i&&(r[h]=null,r[a]=null,r[c]=null,i(p(void 0,!0))),r[u]=!0})),e.on("readable",g.bind(null,r)),r}})),i.register("f6xbQ",(function(e,t){var r=i("kdLmP").codes.ERR_STREAM_PREMATURE_CLOSE;function n(){}e.exports=function e(t,i,o){if("function"==typeof i)return e(t,null,i);i||(i={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];e.apply(this,i)}}}(o||n);var s=i.readable||!1!==i.readable&&t.readable,a=i.writable||!1!==i.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){a=!1,l=!0,s||o.call(t)},h=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,h=!0,a||o.call(t)},f=function(e){o.call(t,e)},p=function(){var e;return s&&!h?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):a&&!l?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?a&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",p),t.req?m():t.on("request",m)),t.on("end",d),t.on("finish",u),!1!==i.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",u),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",d),t.removeListener("error",f),t.removeListener("close",p)}}})),i.register("7UlCx",(function(e,t){e.exports=function(){throw new Error("Readable.from is not available in the browser")}})),i.register("f7L7V",(function(e,t){e.exports=u;var r=i("kdLmP").codes,n=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,c=i("1SlAW");function l(e,t){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(null===i)return this.emit("error",new o);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),i(e);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function h(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,r){d(e,t,r)}))}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}i("6cuMU")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,r){r(new n("_transform()"))},u.prototype._write=function(e,t,r){var i=this._transformState;if(i.writecb=r,i.writechunk=e,i.writeencoding=t,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}})),i.register("dX7Dt",(function(e,t){e.exports=n;var r=i("f7L7V");function n(e){if(!(this instanceof n))return new n(e);r.call(this,e)}i("6cuMU")(n,r),n.prototype._transform=function(e,t,r){r(null,e)}})),i.register("2mqHM",(function(e,t){var r;var n=i("kdLmP").codes,o=n.ERR_MISSING_ARGS,s=n.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var u,h=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var d=t.map((function(e,n){var o=n<t.length-1;return function(e,t,n,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===r&&(r=i("f6xbQ")),r(e,{readable:t,writable:n},(function(e){if(e)return o(e);a=!0,o()}));var c=!1;return function(t){if(!a&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new s("pipe"))}}(e,o,n>0,(function(e){u||(u=e),e&&d.forEach(c),o||(d.forEach(c),h(u))}))}));return t.reduce(l)}})),i.register("D6ODP",(function(e,t){var r=i("awmEs").Buffer,n=i("6cuMU"),o=i("ikMd7"),s=new Array(16),a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],c=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],l=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],u=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],h=[0,1518500249,1859775393,2400959708,2840853838],d=[1352829926,1548603684,1836072691,2053994217,0];function f(){o.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(e,t){return e<<t|e>>>32-t}function m(e,t,r,i,n,o,s,a){return p(e+(t^r^i)+o+s|0,a)+n|0}function g(e,t,r,i,n,o,s,a){return p(e+(t&r|~t&i)+o+s|0,a)+n|0}function v(e,t,r,i,n,o,s,a){return p(e+((t|~r)^i)+o+s|0,a)+n|0}function y(e,t,r,i,n,o,s,a){return p(e+(t&i|r&~i)+o+s|0,a)+n|0}function b(e,t,r,i,n,o,s,a){return p(e+(t^(r|~i))+o+s|0,a)+n|0}n(f,o),f.prototype._update=function(){for(var e=s,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var r=0|this._a,i=0|this._b,n=0|this._c,o=0|this._d,f=0|this._e,w=0|this._a,_=0|this._b,S=0|this._c,E=0|this._d,M=0|this._e,C=0;C<80;C+=1){var I,T;C<16?(I=m(r,i,n,o,f,e[a[C]],h[0],l[C]),T=b(w,_,S,E,M,e[c[C]],d[0],u[C])):C<32?(I=g(r,i,n,o,f,e[a[C]],h[1],l[C]),T=y(w,_,S,E,M,e[c[C]],d[1],u[C])):C<48?(I=v(r,i,n,o,f,e[a[C]],h[2],l[C]),T=v(w,_,S,E,M,e[c[C]],d[2],u[C])):C<64?(I=y(r,i,n,o,f,e[a[C]],h[3],l[C]),T=g(w,_,S,E,M,e[c[C]],d[3],u[C])):(I=b(r,i,n,o,f,e[a[C]],h[4],l[C]),T=m(w,_,S,E,M,e[c[C]],d[4],u[C])),r=f,f=o,o=p(n,10),n=i,i=I,w=M,M=E,E=p(S,10),S=_,_=T}var k=this._b+n+E|0;this._b=this._c+o+M|0,this._c=this._d+f+w|0,this._d=this._e+r+_|0,this._e=this._a+i+S|0,this._a=k},f.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=r.alloc?r.alloc(20):new r(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=f})),i.register("9iz0U",(function(e,t){var r=e.exports=function(e){e=e.toLowerCase();var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};r.sha=i("3v0U2"),r.sha1=i("iajBv"),r.sha224=i("hRKrB"),r.sha256=i("gzhVs"),r.sha384=i("WtwGf"),r.sha512=i("kyS4u")})),i.register("3v0U2",(function(e,t){var r=i("6cuMU"),n=i("gsfFS"),o=i("k0Rto").Buffer,s=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function c(){this.init(),this._w=a,n.call(this,64,56)}function l(e){return e<<30|e>>>2}function u(e,t,r,i){return 0===e?t&r|~t&i:2===e?t&r|t&i|r&i:t^r^i}r(c,n),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,r=this._w,i=0|this._a,n=0|this._b,o=0|this._c,a=0|this._d,c=0|this._e,h=0;h<16;++h)r[h]=e.readInt32BE(4*h);for(;h<80;++h)r[h]=r[h-3]^r[h-8]^r[h-14]^r[h-16];for(var d=0;d<80;++d){var f=~~(d/20),p=0|((t=i)<<5|t>>>27)+u(f,n,o,a)+c+r[d]+s[f];c=a,a=o,o=l(n),n=i,i=p}this._a=i+this._a|0,this._b=n+this._b|0,this._c=o+this._c|0,this._d=a+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c})),i.register("gsfFS",(function(e,t){var r=i("k0Rto").Buffer;function n(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}n.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var i=this._block,n=this._blockSize,o=e.length,s=this._len,a=0;a<o;){for(var c=s%n,l=Math.min(o-a,n-c),u=0;u<l;u++)i[c+u]=e[a+u];a+=l,(s+=l)%n==0&&this._update(i)}return this._len+=o,this},n.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var r=8*this._len;if(r<=4294967295)this._block.writeUInt32BE(r,this._blockSize-4);else{var i=(4294967295&r)>>>0,n=(r-i)/4294967296;this._block.writeUInt32BE(n,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var o=this._hash();return e?o.toString(e):o},n.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=n})),i.register("iajBv",(function(e,t){var r=i("6cuMU"),n=i("gsfFS"),o=i("k0Rto").Buffer,s=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function c(){this.init(),this._w=a,n.call(this,64,56)}function l(e){return e<<5|e>>>27}function u(e){return e<<30|e>>>2}function h(e,t,r,i){return 0===e?t&r|~t&i:2===e?t&r|t&i|r&i:t^r^i}r(c,n),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,r=this._w,i=0|this._a,n=0|this._b,o=0|this._c,a=0|this._d,c=0|this._e,d=0;d<16;++d)r[d]=e.readInt32BE(4*d);for(;d<80;++d)r[d]=(t=r[d-3]^r[d-8]^r[d-14]^r[d-16])<<1|t>>>31;for(var f=0;f<80;++f){var p=~~(f/20),m=l(i)+h(p,n,o,a)+c+r[f]+s[p]|0;c=a,a=o,o=u(n),n=i,i=m}this._a=i+this._a|0,this._b=n+this._b|0,this._c=o+this._c|0,this._d=a+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c})),i.register("hRKrB",(function(e,t){var r=i("6cuMU"),n=i("gzhVs"),o=i("gsfFS"),s=i("k0Rto").Buffer,a=new Array(64);function c(){this.init(),this._w=a,o.call(this,64,56)}r(c,n),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=s.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c})),i.register("gzhVs",(function(e,t){var r=i("6cuMU"),n=i("gsfFS"),o=i("k0Rto").Buffer,s=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function c(){this.init(),this._w=a,n.call(this,64,56)}function l(e,t,r){return r^e&(t^r)}function u(e,t,r){return e&t|r&(e|t)}function h(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function d(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(c,n),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t,r=this._w,i=0|this._a,n=0|this._b,o=0|this._c,a=0|this._d,c=0|this._e,p=0|this._f,m=0|this._g,g=0|this._h,v=0;v<16;++v)r[v]=e.readInt32BE(4*v);for(;v<64;++v)r[v]=0|(((t=r[v-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+r[v-7]+f(r[v-15])+r[v-16];for(var y=0;y<64;++y){var b=g+d(c)+l(c,p,m)+s[y]+r[y]|0,w=h(i)+u(i,n,o)|0;g=m,m=p,p=c,c=a+b|0,a=o,o=n,n=i,i=b+w|0}this._a=i+this._a|0,this._b=n+this._b|0,this._c=o+this._c|0,this._d=a+this._d|0,this._e=c+this._e|0,this._f=p+this._f|0,this._g=m+this._g|0,this._h=g+this._h|0},c.prototype._hash=function(){var e=o.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c})),i.register("WtwGf",(function(e,t){var r=i("6cuMU"),n=i("kyS4u"),o=i("gsfFS"),s=i("k0Rto").Buffer,a=new Array(160);function c(){this.init(),this._w=a,o.call(this,128,112)}r(c,n),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=s.allocUnsafe(48);function t(t,r,i){e.writeInt32BE(t,i),e.writeInt32BE(r,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c})),i.register("kyS4u",(function(e,t){var r=i("6cuMU"),n=i("gsfFS"),o=i("k0Rto").Buffer,s=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function c(){this.init(),this._w=a,n.call(this,128,112)}function l(e,t,r){return r^e&(t^r)}function u(e,t,r){return e&t|r&(e|t)}function h(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function d(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function g(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function v(e,t){return e>>>0<t>>>0?1:0}r(c,n),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,r=0|this._ah,i=0|this._bh,n=0|this._ch,o=0|this._dh,a=0|this._eh,c=0|this._fh,y=0|this._gh,b=0|this._hh,w=0|this._al,_=0|this._bl,S=0|this._cl,E=0|this._dl,M=0|this._el,C=0|this._fl,I=0|this._gl,T=0|this._hl,k=0;k<32;k+=2)t[k]=e.readInt32BE(4*k),t[k+1]=e.readInt32BE(4*k+4);for(;k<160;k+=2){var R=t[k-30],x=t[k-30+1],O=f(R,x),A=p(x,R),P=m(R=t[k-4],x=t[k-4+1]),D=g(x,R),L=t[k-14],U=t[k-14+1],N=t[k-32],j=t[k-32+1],B=A+U|0,F=O+L+v(B,A)|0;F=(F=F+P+v(B=B+D|0,D)|0)+N+v(B=B+j|0,j)|0,t[k]=F,t[k+1]=B}for(var K=0;K<160;K+=2){F=t[K],B=t[K+1];var q=u(r,i,n),$=u(w,_,S),W=h(r,w),V=h(w,r),H=d(a,M),G=d(M,a),z=s[K],Y=s[K+1],J=l(a,c,y),Z=l(M,C,I),Q=T+G|0,X=b+H+v(Q,T)|0;X=(X=(X=X+J+v(Q=Q+Z|0,Z)|0)+z+v(Q=Q+Y|0,Y)|0)+F+v(Q=Q+B|0,B)|0;var ee=V+$|0,te=W+q+v(ee,V)|0;b=y,T=I,y=c,I=C,c=a,C=M,a=o+X+v(M=E+Q|0,E)|0,o=n,E=S,n=i,S=_,i=r,_=w,r=X+te+v(w=Q+ee|0,Q)|0}this._al=this._al+w|0,this._bl=this._bl+_|0,this._cl=this._cl+S|0,this._dl=this._dl+E|0,this._el=this._el+M|0,this._fl=this._fl+C|0,this._gl=this._gl+I|0,this._hl=this._hl+T|0,this._ah=this._ah+r+v(this._al,w)|0,this._bh=this._bh+i+v(this._bl,_)|0,this._ch=this._ch+n+v(this._cl,S)|0,this._dh=this._dh+o+v(this._dl,E)|0,this._eh=this._eh+a+v(this._el,M)|0,this._fh=this._fh+c+v(this._fl,C)|0,this._gh=this._gh+y+v(this._gl,I)|0,this._hh=this._hh+b+v(this._hl,T)|0},c.prototype._hash=function(){var e=o.allocUnsafe(64);function t(t,r,i){e.writeInt32BE(t,i),e.writeInt32BE(r,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c})),i.register("eYksn",(function(e,t){var r=i("k0Rto").Buffer,n=i("5o6YA").Transform,o=i("bWgSm").StringDecoder;function s(e){n.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}i("6cuMU")(s,n),s.prototype.update=function(e,t,i){"string"==typeof e&&(e=r.from(e,t));var n=this._update(e);return this.hashMode?this:(i&&(n=this._toString(n,i)),n)},s.prototype.setAutoPadding=function(){},s.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},s.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},s.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},s.prototype._transform=function(e,t,r){var i;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){i=e}finally{r(i)}},s.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},s.prototype._finalOrDigest=function(e){var t=this.__final()||r.alloc(0);return e&&(t=this._toString(t,e,!0)),t},s.prototype._toString=function(e,t,r){if(this._decoder||(this._decoder=new o(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var i=this._decoder.write(e);return r&&(i+=this._decoder.end()),i},e.exports=s})),i.register("5o6YA",(function(e,t){e.exports=n;var r=i("k4yOc").EventEmitter;function n(){r.call(this)}i("6cuMU")(n,r),n.Readable=i("340fO"),n.Writable=i("lWtyM"),n.Duplex=i("1SlAW"),n.Transform=i("f7L7V"),n.PassThrough=i("dX7Dt"),n.finished=i("f6xbQ"),n.pipeline=i("2mqHM"),n.Stream=n,n.prototype.pipe=function(e,t){var i=this;function n(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function o(){i.readable&&i.resume&&i.resume()}i.on("data",n),e.on("drain",o),e._isStdio||t&&!1===t.end||(i.on("end",a),i.on("close",c));var s=!1;function a(){s||(s=!0,e.end())}function c(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(u(),0===r.listenerCount(this,"error"))throw e}function u(){i.removeListener("data",n),e.removeListener("drain",o),i.removeListener("end",a),i.removeListener("close",c),i.removeListener("error",l),e.removeListener("error",l),i.removeListener("end",u),i.removeListener("close",u),e.removeListener("close",u)}return i.on("error",l),e.on("error",l),i.on("end",u),i.on("close",u),e.on("close",u),e.emit("pipe",i),e}})),i.register("9SGAM",(function(e,t){var r=i("6cuMU"),n=i("1cJxa"),o=i("eYksn"),s=i("k0Rto").Buffer,a=i("bbr5c"),c=i("D6ODP"),l=i("9iz0U"),u=s.alloc(128);function h(e,t){o.call(this,"digest"),"string"==typeof t&&(t=s.from(t));var r="sha512"===e||"sha384"===e?128:64;(this._alg=e,this._key=t,t.length>r)?t=("rmd160"===e?new c:l(e)).update(t).digest():t.length<r&&(t=s.concat([t,u],r));for(var i=this._ipad=s.allocUnsafe(r),n=this._opad=s.allocUnsafe(r),a=0;a<r;a++)i[a]=54^t[a],n[a]=92^t[a];this._hash="rmd160"===e?new c:l(e),this._hash.update(i)}r(h,o),h.prototype._update=function(e){this._hash.update(e)},h.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new c:l(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return"rmd160"===(e=e.toLowerCase())||"ripemd160"===e?new h("rmd160",t):"md5"===e?new n(a,t):new h(e,t)}})),i.register("1cJxa",(function(e,t){var r=i("6cuMU"),n=i("k0Rto").Buffer,o=i("eYksn"),s=n.alloc(128),a=64;function c(e,t){o.call(this,"digest"),"string"==typeof t&&(t=n.from(t)),this._alg=e,this._key=t,t.length>a?t=e(t):t.length<a&&(t=n.concat([t,s],a));for(var r=this._ipad=n.allocUnsafe(a),i=this._opad=n.allocUnsafe(a),c=0;c<a;c++)r[c]=54^t[c],i[c]=92^t[c];this._hash=[r]}r(c,o),c.prototype._update=function(e){this._hash.push(e)},c.prototype._final=function(){var e=this._alg(n.concat(this._hash));return this._alg(n.concat([this._opad,e]))},e.exports=c})),i.register("bbr5c",(function(e,t){var r=i("liMpH");e.exports=function(e){return(new r).update(e).digest()}})),i.register("jxFqc",(function(e,t){e.exports=i("b526X")})),i.register("b526X",(function(e,t){e.exports=JSON.parse('{"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}')})),i.register("wQ7R3",(function(t,r){var n,o;e(t.exports,"pbkdf2",(()=>n),(e=>n=e)),e(t.exports,"pbkdf2Sync",(()=>o),(e=>o=e)),n=i("ltUlK"),o=i("83DTm")})),i.register("ltUlK",(function(e,t){var n,o,s=i("k0Rto").Buffer,a=i("9Eo3k"),c=i("lTVtk"),l=i("83DTm"),u=i("fzmE1"),h=r.crypto&&r.crypto.subtle,d={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},f=[];function p(){return o||(o=r.process&&r.process.nextTick?r.process.nextTick:r.queueMicrotask?r.queueMicrotask:r.setImmediate?r.setImmediate:r.setTimeout)}function m(e,t,r,i,n){return h.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then((function(e){return h.deriveBits({name:"PBKDF2",salt:t,iterations:r,hash:{name:n}},e,i<<3)})).then((function(e){return s.from(e)}))}e.exports=function(e,t,i,o,g,v){"function"==typeof g&&(v=g,g=void 0);var y=d[(g=g||"sha1").toLowerCase()];if(y&&"function"==typeof r.Promise){if(a(i,o),e=u(e,c,"Password"),t=u(t,c,"Salt"),"function"!=typeof v)throw new Error("No callback provided to pbkdf2");!function(e,t){e.then((function(e){p()((function(){t(null,e)}))}),(function(e){p()((function(){t(e)}))}))}(function(e){if(r.process&&!r.process.browser)return Promise.resolve(!1);if(!h||!h.importKey||!h.deriveBits)return Promise.resolve(!1);if(void 0!==f[e])return f[e];var t=m(n=n||s.alloc(8),n,10,128,e).then((function(){return!0})).catch((function(){return!1}));return f[e]=t,t}(y).then((function(r){return r?m(e,t,i,o,y):l(e,t,i,o,g)})),v)}else p()((function(){var r;try{r=l(e,t,i,o,g)}catch(e){return v(e)}v(null,r)}))}})),i.register("9Eo3k",(function(e,t){var r=Math.pow(2,30)-1;e.exports=function(e,t){if("number"!=typeof e)throw new TypeError("Iterations not a number");if(e<0)throw new TypeError("Bad iterations");if("number"!=typeof t)throw new TypeError("Key length not a number");if(t<0||t>r||t!=t)throw new TypeError("Bad key length")}})),i.register("lTVtk",(function(e,t){var n,o=i("9Mq5w");if(r.process&&r.process.browser)n="utf-8";else if(r.process&&r.process.version){n=parseInt(o.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary"}else n="utf-8";e.exports=n})),i.register("83DTm",(function(e,t){var r=i("bbr5c"),n=i("D6ODP"),o=i("9iz0U"),s=i("k0Rto").Buffer,a=i("9Eo3k"),c=i("lTVtk"),l=i("fzmE1"),u=s.alloc(128),h={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function d(e,t,i){var a=function(e){function t(t){return o(e).update(t).digest()}function i(e){return(new n).update(e).digest()}return"rmd160"===e||"ripemd160"===e?i:"md5"===e?r:t}(e),c="sha512"===e||"sha384"===e?128:64;t.length>c?t=a(t):t.length<c&&(t=s.concat([t,u],c));for(var l=s.allocUnsafe(c+h[e]),d=s.allocUnsafe(c+h[e]),f=0;f<c;f++)l[f]=54^t[f],d[f]=92^t[f];var p=s.allocUnsafe(c+i+4);l.copy(p,0,0,c),this.ipad1=p,this.ipad2=l,this.opad=d,this.alg=e,this.blocksize=c,this.hash=a,this.size=h[e]}d.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(e,t,r,i,n){a(r,i);var o=new d(n=n||"sha1",e=l(e,c,"Password"),(t=l(t,c,"Salt")).length),u=s.allocUnsafe(i),f=s.allocUnsafe(t.length+4);t.copy(f,0,0,t.length);for(var p=0,m=h[n],g=Math.ceil(i/m),v=1;v<=g;v++){f.writeUInt32BE(v,t.length);for(var y=o.run(f,o.ipad1),b=y,w=1;w<r;w++){b=o.run(b,o.ipad2);for(var _=0;_<m;_++)y[_]^=b[_]}y.copy(u,p),p+=m}return u}})),i.register("fzmE1",(function(e,t){var r=i("k0Rto").Buffer;e.exports=function(e,t,i){if(r.isBuffer(e))return e;if("string"==typeof e)return r.from(e,t);if(ArrayBuffer.isView(e))return r.from(e.buffer);throw new TypeError(i+" must be a string, a Buffer, a typed array or a DataView")}})),i.register("hHzFD",(function(t,r){var n,o,s,a,c,l,u,h,d,f;e(t.exports,"createCipher",(()=>n),(e=>n=e)),e(t.exports,"Cipher",(()=>o),(e=>o=e)),e(t.exports,"createCipheriv",(()=>s),(e=>s=e)),e(t.exports,"Cipheriv",(()=>a),(e=>a=e)),e(t.exports,"createDecipher",(()=>c),(e=>c=e)),e(t.exports,"Decipher",(()=>l),(e=>l=e)),e(t.exports,"createDecipheriv",(()=>u),(e=>u=e)),e(t.exports,"Decipheriv",(()=>h),(e=>h=e)),e(t.exports,"listCiphers",(()=>d),(e=>d=e)),e(t.exports,"getCiphers",(()=>f),(e=>f=e));var p=i("7A32q"),m=i("enuUj"),g=i("jSo6L"),v=i("eNVM2"),y=i("afScy");function b(e,t,r){if(e=e.toLowerCase(),g[e])return m.createCipheriv(e,t,r);if(v[e])return new p({key:t,iv:r,mode:e});throw new TypeError("invalid suite type")}function w(e,t,r){if(e=e.toLowerCase(),g[e])return m.createDecipheriv(e,t,r);if(v[e])return new p({key:t,iv:r,mode:e,decrypt:!0});throw new TypeError("invalid suite type")}n=o=function(e,t){var r,i;if(e=e.toLowerCase(),g[e])r=g[e].key,i=g[e].iv;else{if(!v[e])throw new TypeError("invalid suite type");r=8*v[e].key,i=v[e].iv}var n=y(t,!1,r,i);return b(e,n.key,n.iv)},s=a=b,c=l=function(e,t){var r,i;if(e=e.toLowerCase(),g[e])r=g[e].key,i=g[e].iv;else{if(!v[e])throw new TypeError("invalid suite type");r=8*v[e].key,i=v[e].iv}var n=y(t,!1,r,i);return w(e,n.key,n.iv)},u=h=w,d=f=function(){return Object.keys(v).concat(m.getCiphers())}})),i.register("7A32q",(function(e,t){var r=i("eYksn"),n=i("56EVK"),o=i("6cuMU"),s=i("k0Rto").Buffer,a={"des-ede3-cbc":n.CBC.instantiate(n.EDE),"des-ede3":n.EDE,"des-ede-cbc":n.CBC.instantiate(n.EDE),"des-ede":n.EDE,"des-cbc":n.CBC.instantiate(n.DES),"des-ecb":n.DES};function c(e){r.call(this);var t,i=e.mode.toLowerCase(),n=a[i];t=e.decrypt?"decrypt":"encrypt";var o=e.key;s.isBuffer(o)||(o=s.from(o)),"des-ede"!==i&&"des-ede-cbc"!==i||(o=s.concat([o,o.slice(0,8)]));var c=e.iv;s.isBuffer(c)||(c=s.from(c)),this._des=n.create({key:o,iv:c,type:t})}a.des=a["des-cbc"],a.des3=a["des-ede3-cbc"],e.exports=c,o(c,r),c.prototype._update=function(e){return s.from(this._des.update(e))},c.prototype._final=function(){return s.from(this._des.final())}})),i.register("56EVK",(function(t,r){var n,o,s;e(t.exports,"DES",(()=>n),(e=>n=e)),e(t.exports,"CBC",(()=>o),(e=>o=e)),e(t.exports,"EDE",(()=>s),(e=>s=e)),i("dosmQ"),i("9qjtF"),n=i("1jTyK"),o=i("l1oFj"),s=i("1Hvfl")})),i.register("dosmQ",(function(t,r){var i,n,o,s,a,c,l,u,h,d,f;e(t.exports,"readUInt32BE",(()=>i),(e=>i=e)),e(t.exports,"writeUInt32BE",(()=>n),(e=>n=e)),e(t.exports,"ip",(()=>o),(e=>o=e)),e(t.exports,"rip",(()=>s),(e=>s=e)),e(t.exports,"pc1",(()=>a),(e=>a=e)),e(t.exports,"r28shl",(()=>c),(e=>c=e)),e(t.exports,"pc2",(()=>l),(e=>l=e)),e(t.exports,"expand",(()=>u),(e=>u=e)),e(t.exports,"substitute",(()=>h),(e=>h=e)),e(t.exports,"permute",(()=>d),(e=>d=e)),e(t.exports,"padSplit",(()=>f),(e=>f=e)),i=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},n=function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},o=function(e,t,r,i){for(var n=0,o=0,s=6;s>=0;s-=2){for(var a=0;a<=24;a+=8)n<<=1,n|=t>>>a+s&1;for(a=0;a<=24;a+=8)n<<=1,n|=e>>>a+s&1}for(s=6;s>=0;s-=2){for(a=1;a<=25;a+=8)o<<=1,o|=t>>>a+s&1;for(a=1;a<=25;a+=8)o<<=1,o|=e>>>a+s&1}r[i+0]=n>>>0,r[i+1]=o>>>0},s=function(e,t,r,i){for(var n=0,o=0,s=0;s<4;s++)for(var a=24;a>=0;a-=8)n<<=1,n|=t>>>a+s&1,n<<=1,n|=e>>>a+s&1;for(s=4;s<8;s++)for(a=24;a>=0;a-=8)o<<=1,o|=t>>>a+s&1,o<<=1,o|=e>>>a+s&1;r[i+0]=n>>>0,r[i+1]=o>>>0},a=function(e,t,r,i){for(var n=0,o=0,s=7;s>=5;s--){for(var a=0;a<=24;a+=8)n<<=1,n|=t>>a+s&1;for(a=0;a<=24;a+=8)n<<=1,n|=e>>a+s&1}for(a=0;a<=24;a+=8)n<<=1,n|=t>>a+s&1;for(s=1;s<=3;s++){for(a=0;a<=24;a+=8)o<<=1,o|=t>>a+s&1;for(a=0;a<=24;a+=8)o<<=1,o|=e>>a+s&1}for(a=0;a<=24;a+=8)o<<=1,o|=e>>a+s&1;r[i+0]=n>>>0,r[i+1]=o>>>0},c=function(e,t){return e<<t&268435455|e>>>28-t};var p=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];l=function(e,t,r,i){for(var n=0,o=0,s=p.length>>>1,a=0;a<s;a++)n<<=1,n|=e>>>p[a]&1;for(a=s;a<p.length;a++)o<<=1,o|=t>>>p[a]&1;r[i+0]=n>>>0,r[i+1]=o>>>0},u=function(e,t,r){var i=0,n=0;i=(1&e)<<5|e>>>27;for(var o=23;o>=15;o-=4)i<<=6,i|=e>>>o&63;for(o=11;o>=3;o-=4)n|=e>>>o&63,n<<=6;n|=(31&e)<<1|e>>>31,t[r+0]=i>>>0,t[r+1]=n>>>0};var m=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];h=function(e,t){for(var r=0,i=0;i<4;i++){r<<=4,r|=m[64*i+(e>>>18-6*i&63)]}for(i=0;i<4;i++){r<<=4,r|=m[256+64*i+(t>>>18-6*i&63)]}return r>>>0};var g=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];d=function(e){for(var t=0,r=0;r<g.length;r++)t<<=1,t|=e>>>g[r]&1;return t>>>0},f=function(e,t,r){for(var i=e.toString(2);i.length<t;)i="0"+i;for(var n=[],o=0;o<t;o+=r)n.push(i.slice(o,o+r));return n.join(" ")}})),i.register("9qjtF",(function(e,t){var r=i("7xO1L");function n(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}e.exports=n,n.prototype._init=function(){},n.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},n.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),i=0;i<r;i++)this.buffer[this.bufferOff+i]=e[t+i];return this.bufferOff+=r,r},n.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},n.prototype._updateEncrypt=function(e){var t=0,r=0,i=(this.bufferOff+e.length)/this.blockSize|0,n=new Array(i*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(n,r)));for(var o=e.length-(e.length-t)%this.blockSize;t<o;t+=this.blockSize)this._update(e,t,n,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return n},n.prototype._updateDecrypt=function(e){for(var t=0,r=0,i=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,n=new Array(i*this.blockSize);i>0;i--)t+=this._buffer(e,t),r+=this._flushBuffer(n,r);return t+=this._buffer(e,t),n},n.prototype.final=function(e){var t,r;return e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(r):r},n.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},n.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},n.prototype._unpad=function(e){return e},n.prototype._finalDecrypt=function(){r.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}})),i.register("7xO1L",(function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=r,r.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)}})),i.register("1jTyK",(function(e,t){var r=i("7xO1L"),n=i("6cuMU"),o=i("dosmQ"),s=i("9qjtF");function a(){this.tmp=new Array(2),this.keys=null}function c(e){s.call(this,e);var t=new a;this._desState=t,this.deriveKeys(t,e.key)}n(c,s),e.exports=c,c.create=function(e){return new c(e)};var l=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];c.prototype.deriveKeys=function(e,t){e.keys=new Array(32),r.equal(t.length,this.blockSize,"Invalid key length");var i=o.readUInt32BE(t,0),n=o.readUInt32BE(t,4);o.pc1(i,n,e.tmp,0),i=e.tmp[0],n=e.tmp[1];for(var s=0;s<e.keys.length;s+=2){var a=l[s>>>1];i=o.r28shl(i,a),n=o.r28shl(n,a),o.pc2(i,n,e.keys,s)}},c.prototype._update=function(e,t,r,i){var n=this._desState,s=o.readUInt32BE(e,t),a=o.readUInt32BE(e,t+4);o.ip(s,a,n.tmp,0),s=n.tmp[0],a=n.tmp[1],"encrypt"===this.type?this._encrypt(n,s,a,n.tmp,0):this._decrypt(n,s,a,n.tmp,0),s=n.tmp[0],a=n.tmp[1],o.writeUInt32BE(r,s,i),o.writeUInt32BE(r,a,i+4)},c.prototype._pad=function(e,t){for(var r=e.length-t,i=t;i<e.length;i++)e[i]=r;return!0},c.prototype._unpad=function(e){for(var t=e[e.length-1],i=e.length-t;i<e.length;i++)r.equal(e[i],t);return e.slice(0,e.length-t)},c.prototype._encrypt=function(e,t,r,i,n){for(var s=t,a=r,c=0;c<e.keys.length;c+=2){var l=e.keys[c],u=e.keys[c+1];o.expand(a,e.tmp,0),l^=e.tmp[0],u^=e.tmp[1];var h=o.substitute(l,u),d=a;a=(s^o.permute(h))>>>0,s=d}o.rip(a,s,i,n)},c.prototype._decrypt=function(e,t,r,i,n){for(var s=r,a=t,c=e.keys.length-2;c>=0;c-=2){var l=e.keys[c],u=e.keys[c+1];o.expand(s,e.tmp,0),l^=e.tmp[0],u^=e.tmp[1];var h=o.substitute(l,u),d=s;s=(a^o.permute(h))>>>0,a=d}o.rip(s,a,i,n)}})),i.register("l1oFj",(function(t,r){var n;e(t.exports,"instantiate",(()=>n),(e=>n=e));var o=i("7xO1L"),s=i("6cuMU"),a={};function c(e){o.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}n=function(e){function t(t){e.call(this,t),this._cbcInit()}s(t,e);for(var r=Object.keys(a),i=0;i<r.length;i++){var n=r[i];t.prototype[n]=a[n]}return t.create=function(e){return new t(e)},t},a._cbcInit=function(){var e=new c(this.options.iv);this._cbcState=e},a._update=function(e,t,r,i){var n=this._cbcState,o=this.constructor.super_.prototype,s=n.iv;if("encrypt"===this.type){for(var a=0;a<this.blockSize;a++)s[a]^=e[t+a];o._update.call(this,s,0,r,i);for(a=0;a<this.blockSize;a++)s[a]=r[i+a]}else{o._update.call(this,e,t,r,i);for(a=0;a<this.blockSize;a++)r[i+a]^=s[a];for(a=0;a<this.blockSize;a++)s[a]=e[t+a]}}})),i.register("1Hvfl",(function(e,t){var r=i("7xO1L"),n=i("6cuMU"),o=i("9qjtF"),s=i("1jTyK");function a(e,t){r.equal(t.length,24,"Invalid key length");var i=t.slice(0,8),n=t.slice(8,16),o=t.slice(16,24);this.ciphers="encrypt"===e?[s.create({type:"encrypt",key:i}),s.create({type:"decrypt",key:n}),s.create({type:"encrypt",key:o})]:[s.create({type:"decrypt",key:o}),s.create({type:"encrypt",key:n}),s.create({type:"decrypt",key:i})]}function c(e){o.call(this,e);var t=new a(this.type,this.options.key);this._edeState=t}n(c,o),e.exports=c,c.create=function(e){return new c(e)},c.prototype._update=function(e,t,r,i){var n=this._edeState;n.ciphers[0]._update(e,t,r,i),n.ciphers[1]._update(r,i,r,i),n.ciphers[2]._update(r,i,r,i)},c.prototype._pad=s.prototype._pad,c.prototype._unpad=s.prototype._unpad})),i.register("enuUj",(function(t,r){var n,o,s;e(t.exports,"createCipheriv",(()=>n),(e=>n=e)),e(t.exports,"createDecipheriv",(()=>o),(e=>o=e)),e(t.exports,"getCiphers",(()=>s),(e=>s=e));var a=i("6zcOF"),c=i("elNiL"),l=i("9hPv9");a.createCipher,n=a.createCipheriv,c.createDecipher,o=c.createDecipheriv,s=function(){return Object.keys(l)}})),i.register("6zcOF",(function(t,r){var n,o;e(t.exports,"createCipheriv",(()=>n),(e=>n=e)),e(t.exports,"createCipher",(()=>o),(e=>o=e));var s=i("jSo6L"),a=i("kf2vr"),c=i("k0Rto").Buffer,l=i("iO2jP"),u=i("eYksn"),h=i("21xbU"),d=i("afScy");function f(e,t,r){u.call(this),this._cache=new m,this._cipher=new h.AES(t),this._prev=c.from(r),this._mode=e,this._autopadding=!0}i("6cuMU")(f,u),f.prototype._update=function(e){var t,r;this._cache.add(e);for(var i=[];t=this._cache.get();)r=this._mode.encrypt(this,t),i.push(r);return c.concat(i)};var p=c.alloc(16,16);function m(){this.cache=c.allocUnsafe(0)}function g(e,t,r){var i=s[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");if("string"==typeof t&&(t=c.from(t)),t.length!==i.key/8)throw new TypeError("invalid key length "+t.length);if("string"==typeof r&&(r=c.from(r)),"GCM"!==i.mode&&r.length!==i.iv)throw new TypeError("invalid iv length "+r.length);return"stream"===i.type?new l(i.module,t,r):"auth"===i.type?new a(i.module,t,r):new f(i.module,t,r)}f.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(p))throw this._cipher.scrub(),new Error("data not multiple of block length")},f.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},m.prototype.add=function(e){this.cache=c.concat([this.cache,e])},m.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},m.prototype.flush=function(){for(var e=16-this.cache.length,t=c.allocUnsafe(e),r=-1;++r<e;)t.writeUInt8(e,r);return c.concat([this.cache,t])},n=g,o=function(e,t){var r=s[e.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var i=d(t,!1,r.key,r.iv);return g(e,i.key,i.iv)}})),i.register("jSo6L",(function(e,t){var r={ECB:i("4zu5S"),CBC:i("kSfHW"),CFB:i("7tgje"),CFB8:i("aYXGv"),CFB1:i("kG0Tc"),OFB:i("jveiQ"),CTR:i("d6z7x"),GCM:i("d6z7x")},n=i("9hPv9");for(var o in n)n[o].module=r[n[o].mode];e.exports=n})),i.register("4zu5S",(function(t,r){var i,n;e(t.exports,"encrypt",(()=>i),(e=>i=e)),e(t.exports,"decrypt",(()=>n),(e=>n=e)),i=function(e,t){return e._cipher.encryptBlock(t)},n=function(e,t){return e._cipher.decryptBlock(t)}})),i.register("kSfHW",(function(t,r){var n,o;e(t.exports,"encrypt",(()=>n),(e=>n=e)),e(t.exports,"decrypt",(()=>o),(e=>o=e));var s=i("k7re5");n=function(e,t){var r=s(t,e._prev);return e._prev=e._cipher.encryptBlock(r),e._prev},o=function(e,t){var r=e._prev;e._prev=t;var i=e._cipher.decryptBlock(t);return s(i,r)}})),i.register("k7re5",(function(e,t){var r=i("awmEs").Buffer;e.exports=function(e,t){for(var i=Math.min(e.length,t.length),n=new r(i),o=0;o<i;++o)n[o]=e[o]^t[o];return n}})),i.register("7tgje",(function(t,r){var n;e(t.exports,"encrypt",(()=>n),(e=>n=e));var o=i("k0Rto").Buffer,s=i("k7re5");function a(e,t,r){var i=t.length,n=s(t,e._cache);return e._cache=e._cache.slice(i),e._prev=o.concat([e._prev,r?t:n]),n}n=function(e,t,r){for(var i,n=o.allocUnsafe(0);t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=o.allocUnsafe(0)),!(e._cache.length<=t.length)){n=o.concat([n,a(e,t,r)]);break}i=e._cache.length,n=o.concat([n,a(e,t.slice(0,i),r)]),t=t.slice(i)}return n}})),i.register("aYXGv",(function(t,r){var n;e(t.exports,"encrypt",(()=>n),(e=>n=e));var o=i("k0Rto").Buffer;function s(e,t,r){var i=e._cipher.encryptBlock(e._prev)[0]^t;return e._prev=o.concat([e._prev.slice(1),o.from([r?t:i])]),i}n=function(e,t,r){for(var i=t.length,n=o.allocUnsafe(i),a=-1;++a<i;)n[a]=s(e,t[a],r);return n}})),i.register("kG0Tc",(function(t,r){var n;e(t.exports,"encrypt",(()=>n),(e=>n=e));var o=i("k0Rto").Buffer;function s(e,t,r){for(var i,n,o=-1,s=0;++o<8;)i=t&1<<7-o?128:0,s+=(128&(n=e._cipher.encryptBlock(e._prev)[0]^i))>>o%8,e._prev=a(e._prev,r?i:n);return s}function a(e,t){var r=e.length,i=-1,n=o.allocUnsafe(e.length);for(e=o.concat([e,o.from([t])]);++i<r;)n[i]=e[i]<<1|e[i+1]>>7;return n}n=function(e,t,r){for(var i=t.length,n=o.allocUnsafe(i),a=-1;++a<i;)n[a]=s(e,t[a],r);return n}})),i.register("jveiQ",(function(t,r){var n;e(t.exports,"encrypt",(()=>n),(e=>n=e));var o=i("awmEs").Buffer,s=i("k7re5");function a(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}n=function(e,t){for(;e._cache.length<t.length;)e._cache=o.concat([e._cache,a(e)]);var r=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),s(t,r)}})),i.register("d6z7x",(function(t,r){var n;e(t.exports,"encrypt",(()=>n),(e=>n=e));var o=i("k7re5"),s=i("k0Rto").Buffer,a=i("iEbfO");function c(e){var t=e._cipher.encryptBlockRaw(e._prev);return a(e._prev),t}n=function(e,t){var r=Math.ceil(t.length/16),i=e._cache.length;e._cache=s.concat([e._cache,s.allocUnsafe(16*r)]);for(var n=0;n<r;n++){var a=c(e),l=i+16*n;e._cache.writeUInt32BE(a[0],l+0),e._cache.writeUInt32BE(a[1],l+4),e._cache.writeUInt32BE(a[2],l+8),e._cache.writeUInt32BE(a[3],l+12)}var u=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),o(t,u)}})),i.register("iEbfO",(function(e,t){e.exports=function(e){for(var t,r=e.length;r--;){if(255!==(t=e.readUInt8(r))){t++,e.writeUInt8(t,r);break}e.writeUInt8(0,r)}}})),i.register("9hPv9",(function(e,t){e.exports=JSON.parse('{"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}')})),i.register("kf2vr",(function(e,t){var r=i("21xbU"),n=i("k0Rto").Buffer,o=i("eYksn"),s=i("6cuMU"),a=i("huQ30"),c=i("k7re5"),l=i("iEbfO");function u(e,t,i,s){o.call(this);var c=n.alloc(4,0);this._cipher=new r.AES(t);var u=this._cipher.encryptBlock(c);this._ghash=new a(u),i=function(e,t,r){if(12===t.length)return e._finID=n.concat([t,n.from([0,0,0,1])]),n.concat([t,n.from([0,0,0,2])]);var i=new a(r),o=t.length,s=o%16;i.update(t),s&&(s=16-s,i.update(n.alloc(s,0))),i.update(n.alloc(8,0));var c=8*o,u=n.alloc(8);u.writeUIntBE(c,0,8),i.update(u),e._finID=i.state;var h=n.from(e._finID);return l(h),h}(this,i,u),this._prev=n.from(i),this._cache=n.allocUnsafe(0),this._secCache=n.allocUnsafe(0),this._decrypt=s,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}s(u,o),u.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=n.alloc(t,0),this._ghash.update(t))}this._called=!0;var r=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(r),this._len+=e.length,r},u.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=c(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(e,t){var r=0;e.length!==t.length&&r++;for(var i=Math.min(e.length,t.length),n=0;n<i;++n)r+=e[n]^t[n];return r}(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},u.prototype.getAuthTag=function(){if(this._decrypt||!n.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},u.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},u.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=u})),i.register("21xbU",(function(t,r){var n;e(t.exports,"AES",(()=>n),(e=>n=e));var o=i("k0Rto").Buffer;function s(e){o.isBuffer(e)||(e=o.from(e));for(var t=e.length/4|0,r=new Array(t),i=0;i<t;i++)r[i]=e.readUInt32BE(4*i);return r}function a(e){for(;0<e.length;e++)e[0]=0}function c(e,t,r,i,n){for(var o,s,a,c,l=r[0],u=r[1],h=r[2],d=r[3],f=e[0]^t[0],p=e[1]^t[1],m=e[2]^t[2],g=e[3]^t[3],v=4,y=1;y<n;y++)o=l[f>>>24]^u[p>>>16&255]^h[m>>>8&255]^d[255&g]^t[v++],s=l[p>>>24]^u[m>>>16&255]^h[g>>>8&255]^d[255&f]^t[v++],a=l[m>>>24]^u[g>>>16&255]^h[f>>>8&255]^d[255&p]^t[v++],c=l[g>>>24]^u[f>>>16&255]^h[p>>>8&255]^d[255&m]^t[v++],f=o,p=s,m=a,g=c;return o=(i[f>>>24]<<24|i[p>>>16&255]<<16|i[m>>>8&255]<<8|i[255&g])^t[v++],s=(i[p>>>24]<<24|i[m>>>16&255]<<16|i[g>>>8&255]<<8|i[255&f])^t[v++],a=(i[m>>>24]<<24|i[g>>>16&255]<<16|i[f>>>8&255]<<8|i[255&p])^t[v++],c=(i[g>>>24]<<24|i[f>>>16&255]<<16|i[p>>>8&255]<<8|i[255&m])^t[v++],[o>>>=0,s>>>=0,a>>>=0,c>>>=0]}var l=[0,1,2,4,8,16,32,64,128,27,54],u=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var r=[],i=[],n=[[],[],[],[]],o=[[],[],[],[]],s=0,a=0,c=0;c<256;++c){var l=a^a<<1^a<<2^a<<3^a<<4;l=l>>>8^255&l^99,r[s]=l,i[l]=s;var u=e[s],h=e[u],d=e[h],f=257*e[l]^16843008*l;n[0][s]=f<<24|f>>>8,n[1][s]=f<<16|f>>>16,n[2][s]=f<<8|f>>>24,n[3][s]=f,f=16843009*d^65537*h^257*u^16843008*s,o[0][l]=f<<24|f>>>8,o[1][l]=f<<16|f>>>16,o[2][l]=f<<8|f>>>24,o[3][l]=f,0===s?s=a=1:(s=u^e[e[e[d^u]]],a^=e[e[a]])}return{SBOX:r,INV_SBOX:i,SUB_MIX:n,INV_SUB_MIX:o}}();function h(e){this._key=s(e),this._reset()}h.blockSize=16,h.keySize=32,h.prototype.blockSize=h.blockSize,h.prototype.keySize=h.keySize,h.prototype._reset=function(){for(var e=this._key,t=e.length,r=t+6,i=4*(r+1),n=[],o=0;o<t;o++)n[o]=e[o];for(o=t;o<i;o++){var s=n[o-1];o%t==0?(s=s<<8|s>>>24,s=u.SBOX[s>>>24]<<24|u.SBOX[s>>>16&255]<<16|u.SBOX[s>>>8&255]<<8|u.SBOX[255&s],s^=l[o/t|0]<<24):t>6&&o%t==4&&(s=u.SBOX[s>>>24]<<24|u.SBOX[s>>>16&255]<<16|u.SBOX[s>>>8&255]<<8|u.SBOX[255&s]),n[o]=n[o-t]^s}for(var a=[],c=0;c<i;c++){var h=i-c,d=n[h-(c%4?0:4)];a[c]=c<4||h<=4?d:u.INV_SUB_MIX[0][u.SBOX[d>>>24]]^u.INV_SUB_MIX[1][u.SBOX[d>>>16&255]]^u.INV_SUB_MIX[2][u.SBOX[d>>>8&255]]^u.INV_SUB_MIX[3][u.SBOX[255&d]]}this._nRounds=r,this._keySchedule=n,this._invKeySchedule=a},h.prototype.encryptBlockRaw=function(e){return c(e=s(e),this._keySchedule,u.SUB_MIX,u.SBOX,this._nRounds)},h.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),r=o.allocUnsafe(16);return r.writeUInt32BE(t[0],0),r.writeUInt32BE(t[1],4),r.writeUInt32BE(t[2],8),r.writeUInt32BE(t[3],12),r},h.prototype.decryptBlock=function(e){var t=(e=s(e))[1];e[1]=e[3],e[3]=t;var r=c(e,this._invKeySchedule,u.INV_SUB_MIX,u.INV_SBOX,this._nRounds),i=o.allocUnsafe(16);return i.writeUInt32BE(r[0],0),i.writeUInt32BE(r[3],4),i.writeUInt32BE(r[2],8),i.writeUInt32BE(r[1],12),i},h.prototype.scrub=function(){a(this._keySchedule),a(this._invKeySchedule),a(this._key)},n=h})),i.register("huQ30",(function(e,t){var r=i("k0Rto").Buffer,n=r.alloc(16,0);function o(e){var t=r.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function s(e){this.h=e,this.state=r.alloc(16,0),this.cache=r.allocUnsafe(0)}s.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},s.prototype._multiply=function(){for(var e,t,r,i=[(e=this.h).readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)],n=[0,0,0,0],s=-1;++s<128;){for(0!=(this.state[~~(s/8)]&1<<7-s%8)&&(n[0]^=i[0],n[1]^=i[1],n[2]^=i[2],n[3]^=i[3]),r=0!=(1&i[3]),t=3;t>0;t--)i[t]=i[t]>>>1|(1&i[t-1])<<31;i[0]=i[0]>>>1,r&&(i[0]=-520093696^i[0])}this.state=o(n)},s.prototype.update=function(e){var t;for(this.cache=r.concat([this.cache,e]);this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},s.prototype.final=function(e,t){return this.cache.length&&this.ghash(r.concat([this.cache,n],16)),this.ghash(o([0,e,0,t])),this.state},e.exports=s})),i.register("iO2jP",(function(e,t){var r=i("21xbU"),n=i("k0Rto").Buffer,o=i("eYksn");function s(e,t,i,s){o.call(this),this._cipher=new r.AES(t),this._prev=n.from(i),this._cache=n.allocUnsafe(0),this._secCache=n.allocUnsafe(0),this._decrypt=s,this._mode=e}i("6cuMU")(s,o),s.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},s.prototype._final=function(){this._cipher.scrub()},e.exports=s})),i.register("afScy",(function(e,t){var r=i("k0Rto").Buffer,n=i("liMpH");e.exports=function(e,t,i,o){if(r.isBuffer(e)||(e=r.from(e,"binary")),t&&(r.isBuffer(t)||(t=r.from(t,"binary")),8!==t.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var s=i/8,a=r.alloc(s),c=r.alloc(o||0),l=r.alloc(0);s>0||o>0;){var u=new n;u.update(l),u.update(e),t&&u.update(t),l=u.digest();var h=0;if(s>0){var d=a.length-s;h=Math.min(s,l.length),l.copy(a,d,0,h),s-=h}if(h<l.length&&o>0){var f=c.length-o,p=Math.min(o,l.length-h);l.copy(c,f,h,h+p),o-=p}}return l.fill(0),{key:a,iv:c}}})),i.register("elNiL",(function(t,r){var n,o;e(t.exports,"createDecipher",(()=>n),(e=>n=e)),e(t.exports,"createDecipheriv",(()=>o),(e=>o=e));var s=i("kf2vr"),a=i("k0Rto").Buffer,c=i("jSo6L"),l=i("iO2jP"),u=i("eYksn"),h=i("21xbU"),d=i("afScy");function f(e,t,r){u.call(this),this._cache=new p,this._last=void 0,this._cipher=new h.AES(t),this._prev=a.from(r),this._mode=e,this._autopadding=!0}function p(){this.cache=a.allocUnsafe(0)}function m(e,t,r){var i=c[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");if("string"==typeof r&&(r=a.from(r)),"GCM"!==i.mode&&r.length!==i.iv)throw new TypeError("invalid iv length "+r.length);if("string"==typeof t&&(t=a.from(t)),t.length!==i.key/8)throw new TypeError("invalid key length "+t.length);return"stream"===i.type?new l(i.module,t,r,!0):"auth"===i.type?new s(i.module,t,r,!0):new f(i.module,t,r)}i("6cuMU")(f,u),f.prototype._update=function(e){var t,r;this._cache.add(e);for(var i=[];t=this._cache.get(this._autopadding);)r=this._mode.decrypt(this,t),i.push(r);return a.concat(i)},f.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return function(e){var t=e[15];if(t<1||t>16)throw new Error("unable to decrypt data");var r=-1;for(;++r<t;)if(e[r+(16-t)]!==t)throw new Error("unable to decrypt data");if(16===t)return;return e.slice(0,16-t)}(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},f.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},p.prototype.add=function(e){this.cache=a.concat([this.cache,e])},p.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},p.prototype.flush=function(){if(this.cache.length)return this.cache},n=function(e,t){var r=c[e.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var i=d(t,!1,r.key,r.iv);return m(e,i.key,i.iv)},o=m})),i.register("eNVM2",(function(t,r){var i,n,o,s,a,c,l,u;e(t.exports,"des-ecb",(()=>i),(e=>i=e)),e(t.exports,"des-cbc",(()=>n),(e=>n=e)),e(t.exports,"des",(()=>o),(e=>o=e)),e(t.exports,"des-ede3-cbc",(()=>s),(e=>s=e)),e(t.exports,"des3",(()=>a),(e=>a=e)),e(t.exports,"des-ede3",(()=>c),(e=>c=e)),e(t.exports,"des-ede-cbc",(()=>l),(e=>l=e)),e(t.exports,"des-ede",(()=>u),(e=>u=e)),i={key:8,iv:0},n=o={key:8,iv:8},s=a={key:24,iv:8},c={key:24,iv:0},l={key:16,iv:8},u={key:16,iv:0}})),i.register("ePdJQ",(function(t,r){var n,o,s,a,c;e(t.exports,"DiffieHellmanGroup",(()=>n),(e=>n=e)),e(t.exports,"createDiffieHellmanGroup",(()=>o),(e=>o=e)),e(t.exports,"getDiffieHellman",(()=>s),(e=>s=e)),e(t.exports,"createDiffieHellman",(()=>a),(e=>a=e)),e(t.exports,"DiffieHellman",(()=>c),(e=>c=e));var l=i("awmEs").Buffer,u=i("2iTIX"),h=i("85YpT"),d=i("7EVbB");var f={binary:!0,hex:!0,base64:!0};n=o=s=function(e){var t=new l(h[e].prime,"hex"),r=new l(h[e].gen,"hex");return new d(t,r)},a=c=function e(t,r,i,n){return l.isBuffer(r)||void 0===f[r]?e(t,"binary",r,i):(r=r||"binary",n=n||"binary",i=i||new l([2]),l.isBuffer(i)||(i=new l(i,n)),"number"==typeof t?new d(u(t,i),i,!0):(l.isBuffer(t)||(t=new l(t,r)),new d(t,i,!0)))}})),i.register("2iTIX",(function(e,t){var r=i("1oa4b");e.exports=v,v.simpleSieve=m,v.fermatTest=g;var n=i("g244U"),o=new n(24),s=new(i("e3f0s")),a=new n(1),c=new n(2),l=new n(5),u=(new n(16),new n(8),new n(10)),h=new n(3),d=(new n(7),new n(11)),f=new n(4),p=(new n(12),null);function m(e){for(var t=function(){if(null!==p)return p;var e=[];e[0]=2;for(var t=1,r=3;r<1048576;r+=2){for(var i=Math.ceil(Math.sqrt(r)),n=0;n<t&&e[n]<=i&&r%e[n]!=0;n++);t!==n&&e[n]<=i||(e[t++]=r)}return p=e,e}(),r=0;r<t.length;r++)if(0===e.modn(t[r]))return 0===e.cmpn(t[r]);return!0}function g(e){var t=n.mont(e);return 0===c.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function v(e,t){if(e<16)return new n(2===t||5===t?[140,123]:[140,39]);var i,p;for(t=new n(t);;){for(i=new n(r(Math.ceil(e/8)));i.bitLength()>e;)i.ishrn(1);if(i.isEven()&&i.iadd(a),i.testn(1)||i.iadd(c),t.cmp(c)){if(!t.cmp(l))for(;i.mod(u).cmp(h);)i.iadd(f)}else for(;i.mod(o).cmp(d);)i.iadd(f);if(m(p=i.shrn(1))&&m(i)&&g(p)&&g(i)&&s.test(p)&&s.test(i))return i}}})),i.register("g244U",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,r,i){for(var n=0,o=Math.min(e.length,r),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r.strip()}o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);i=0!==(o=a>>>24-n&16777215)||s!==this.length-1?u[6-c.length]+c+i:c+i,(n+=2)>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],f=d[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:u[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,c="le"===t,l=new e(o),u=this.clone();if(c){for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[a]=s;for(;a<o;a++)l[a]=0}else{for(a=0;a<o-n;a++)l[a]=0;for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[o-a-1]=s}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),o.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r.strip()}(this,e,t):m(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},g.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},g.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},g.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},g.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),m(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function _(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function M(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(_,y),n(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new _;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return v[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new M(e)},n(M,E),M.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},M.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},M.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("e3f0s",(function(e,t){var r=i("eUBR6"),n=i("laKaL");function o(e){this.rand=e||new n.Rand}e.exports=o,o.create=function(e){return new o(e)},o.prototype._randbelow=function(e){var t=e.bitLength(),i=Math.ceil(t/8);do{var n=new r(this.rand.generate(i))}while(n.cmp(e)>=0);return n},o.prototype._randrange=function(e,t){var r=t.sub(e);return e.add(this._randbelow(r))},o.prototype.test=function(e,t,i){var n=e.bitLength(),o=r.mont(e),s=new r(1).toRed(o);t||(t=Math.max(1,n/48|0));for(var a=e.subn(1),c=0;!a.testn(c);c++);for(var l=e.shrn(c),u=a.toRed(o);t>0;t--){var h=this._randrange(new r(2),a);i&&i(h);var d=h.toRed(o).redPow(l);if(0!==d.cmp(s)&&0!==d.cmp(u)){for(var f=1;f<c;f++){if(0===(d=d.redSqr()).cmp(s))return!1;if(0===d.cmp(u))break}if(f===c)return!1}}return!0},o.prototype.getDivisor=function(e,t){var i=e.bitLength(),n=r.mont(e),o=new r(1).toRed(n);t||(t=Math.max(1,i/48|0));for(var s=e.subn(1),a=0;!s.testn(a);a++);for(var c=e.shrn(a),l=s.toRed(n);t>0;t--){var u=this._randrange(new r(2),s),h=e.gcd(u);if(0!==h.cmpn(1))return h;var d=u.toRed(n).redPow(c);if(0!==d.cmp(o)&&0!==d.cmp(l)){for(var f=1;f<a;f++){if(0===(d=d.redSqr()).cmp(o))return d.fromRed().subn(1).gcd(e);if(0===d.cmp(l))break}if(f===a)return(d=d.redSqr()).fromRed().subn(1).gcd(e)}}return!1}})),i.register("eUBR6",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,r,i){for(var n=0,o=Math.min(e.length,r),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r.strip()}o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);i=0!==(o=a>>>24-n&16777215)||s!==this.length-1?u[6-c.length]+c+i:c+i,(n+=2)>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],f=d[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:u[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,c="le"===t,l=new e(o),u=this.clone();if(c){for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[a]=s;for(;a<o;a++)l[a]=0}else{for(a=0;a<o-n;a++)l[a]=0;for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[o-a-1]=s}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),o.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r.strip()}(this,e,t):m(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},g.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},g.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},g.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},g.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),m(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function _(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function M(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(_,y),n(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new _;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return v[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new M(e)},n(M,E),M.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},M.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},M.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("laKaL",(function(e,t){var r;function n(e){this.rand=e}if(e.exports=function(e){return r||(r=new n(null)),r.generate(e)},e.exports.Rand=n,n.prototype.generate=function(e){return this._rand(e)},n.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?n.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?n.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(n.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var o=i("4AFFV");if("function"!=typeof o.randomBytes)throw new Error("Not supported");n.prototype._rand=function(e){return o.randomBytes(e)}}catch(e){}})),i.register("85YpT",(function(e,t){e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')})),i.register("7EVbB",(function(e,t){var r=i("awmEs").Buffer,n=i("g244U"),o=new(i("e3f0s")),s=new n(24),a=new n(11),c=new n(10),l=new n(3),u=new n(7),h=i("2iTIX"),d=i("1oa4b");function f(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this._pub=new n(e),this}function p(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this._priv=new n(e),this}e.exports=g;var m={};function g(e,t,r){this.setGenerator(t),this.__prime=new n(e),this._prime=n.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,r?(this.setPublicKey=f,this.setPrivateKey=p):this._primeCode=8}function v(e,t){var i=new r(e.toArray());return t?i.toString(t):i}Object.defineProperty(g.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var r=t.toString("hex"),i=[r,e.toString(16)].join("_");if(i in m)return m[i];var n,d=0;if(e.isEven()||!h.simpleSieve||!h.fermatTest(e)||!o.test(e))return d+=1,d+="02"===r||"05"===r?8:4,m[i]=d,d;switch(o.test(e.shrn(1))||(d+=2),r){case"02":e.mod(s).cmp(a)&&(d+=8);break;case"05":(n=e.mod(c)).cmp(l)&&n.cmp(u)&&(d+=8);break;default:d+=4}return m[i]=d,d}(this.__prime,this.__gen)),this._primeCode}}),g.prototype.generateKeys=function(){return this._priv||(this._priv=new n(d(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},g.prototype.computeSecret=function(e){var t=(e=(e=new n(e)).toRed(this._prime)).redPow(this._priv).fromRed(),i=new r(t.toArray()),o=this.getPrime();if(i.length<o.length){var s=new r(o.length-i.length);s.fill(0),i=r.concat([s,i])}return i},g.prototype.getPublicKey=function(e){return v(this._pub,e)},g.prototype.getPrivateKey=function(e){return v(this._priv,e)},g.prototype.getPrime=function(e){return v(this.__prime,e)},g.prototype.getGenerator=function(e){return v(this._gen,e)},g.prototype.setGenerator=function(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this.__gen=e,this._gen=new n(e),this}})),i.register("aUuNJ",(function(e,t){var r=i("k0Rto").Buffer,n=i("eRLLs"),o=i("l8KM5"),s=i("6cuMU"),a=i("1YreY"),c=i("1O2UL"),l=i("b526X");function u(e){o.Writable.call(this);var t=l[e];if(!t)throw new Error("Unknown message digest");this._hashType=t.hash,this._hash=n(t.hash),this._tag=t.id,this._signType=t.sign}function h(e){o.Writable.call(this);var t=l[e];if(!t)throw new Error("Unknown message digest");this._hash=n(t.hash),this._tag=t.id,this._signType=t.sign}function d(e){return new u(e)}function f(e){return new h(e)}Object.keys(l).forEach((function(e){l[e].id=r.from(l[e].id,"hex"),l[e.toLowerCase()]=l[e]})),s(u,o.Writable),u.prototype._write=function(e,t,r){this._hash.update(e),r()},u.prototype.update=function(e,t){return"string"==typeof e&&(e=r.from(e,t)),this._hash.update(e),this},u.prototype.sign=function(e,t){this.end();var r=this._hash.digest(),i=a(r,e,this._hashType,this._signType,this._tag);return t?i.toString(t):i},s(h,o.Writable),h.prototype._write=function(e,t,r){this._hash.update(e),r()},h.prototype.update=function(e,t){return"string"==typeof e&&(e=r.from(e,t)),this._hash.update(e),this},h.prototype.verify=function(e,t,i){"string"==typeof t&&(t=r.from(t,i)),this.end();var n=this._hash.digest();return c(t,n,e,this._signType,this._tag)},e.exports={Sign:d,Verify:f,createSign:d,createVerify:f}})),i.register("1YreY",(function(e,t){var r=i("k0Rto").Buffer,n=i("9SGAM"),o=i("7wEKJ"),s=i("dEDF4").ec,a=i("g5rlv"),c=i("8sncL"),l=i("1zkIO");function u(e,t,i,o){if((e=r.from(e.toArray())).length<t.byteLength()){var s=r.alloc(t.byteLength()-e.length);e=r.concat([s,e])}var a=i.length,c=function(e,t){e=h(e,t),e=e.mod(t);var i=r.from(e.toArray());if(i.length<t.byteLength()){var n=r.alloc(t.byteLength()-i.length);i=r.concat([n,i])}return i}(i,t),l=r.alloc(a);l.fill(1);var u=r.alloc(a);return u=n(o,u).update(l).update(r.from([0])).update(e).update(c).digest(),l=n(o,u).update(l).digest(),{k:u=n(o,u).update(l).update(r.from([1])).update(e).update(c).digest(),v:l=n(o,u).update(l).digest()}}function h(e,t){var r=new a(e),i=(e.length<<3)-t.bitLength();return i>0&&r.ishrn(i),r}function d(e,t,i){var o,s;do{for(o=r.alloc(0);8*o.length<e.bitLength();)t.v=n(i,t.k).update(t.v).digest(),o=r.concat([o,t.v]);s=h(o,e),t.k=n(i,t.k).update(t.v).update(r.from([0])).digest(),t.v=n(i,t.k).update(t.v).digest()}while(-1!==s.cmp(e));return s}function f(e,t,r,i){return e.toRed(a.mont(r)).redPow(t).fromRed().mod(i)}e.exports=function(e,t,i,n,p){var m=c(t);if(m.curve){if("ecdsa"!==n&&"ecdsa/rsa"!==n)throw new Error("wrong private key type");return function(e,t){var i=l[t.curve.join(".")];if(!i)throw new Error("unknown curve "+t.curve.join("."));var n=new s(i).keyFromPrivate(t.privateKey),o=n.sign(e);return r.from(o.toDER())}(e,m)}if("dsa"===m.type){if("dsa"!==n)throw new Error("wrong private key type");return function(e,t,i){var n,o=t.params.priv_key,s=t.params.p,c=t.params.q,l=t.params.g,p=new a(0),m=h(e,c).mod(c),g=!1,v=u(o,c,e,i);for(;!1===g;)p=f(l,n=d(c,v,i),s,c),0===(g=n.invm(c).imul(m.add(o.mul(p))).mod(c)).cmpn(0)&&(g=!1,p=new a(0));return function(e,t){e=e.toArray(),t=t.toArray(),128&e[0]&&(e=[0].concat(e));128&t[0]&&(t=[0].concat(t));var i=e.length+t.length+4,n=[48,i,2,e.length];return n=n.concat(e,[2,t.length],t),r.from(n)}(p,g)}(e,m,i)}if("rsa"!==n&&"ecdsa/rsa"!==n)throw new Error("wrong private key type");e=r.concat([p,e]);for(var g=m.modulus.byteLength(),v=[0,1];e.length+v.length+1<g;)v.push(255);v.push(0);for(var y=-1;++y<e.length;)v.push(e[y]);return o(v,m)},e.exports.getKey=u,e.exports.makeKey=d})),i.register("7wEKJ",(function(e,t){var r=i("awmEs").Buffer,n=i("g5rlv"),o=i("1oa4b");function s(e){var t,r=e.modulus.byteLength();do{t=new n(o(r))}while(t.cmp(e.modulus)>=0||!t.umod(e.prime1)||!t.umod(e.prime2));return t}function a(e,t){var i=function(e){var t=s(e);return{blinder:t.toRed(n.mont(e.modulus)).redPow(new n(e.publicExponent)).fromRed(),unblinder:t.invm(e.modulus)}}(t),o=t.modulus.byteLength(),a=new n(e).mul(i.blinder).umod(t.modulus),c=a.toRed(n.mont(t.prime1)),l=a.toRed(n.mont(t.prime2)),u=t.coefficient,h=t.prime1,d=t.prime2,f=c.redPow(t.exponent1).fromRed(),p=l.redPow(t.exponent2).fromRed(),m=f.isub(p).imul(u).umod(h).imul(d);return p.iadd(m).imul(i.unblinder).umod(t.modulus).toArrayLike(r,"be",o)}a.getr=s,e.exports=a})),i.register("g5rlv",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var i=e.charCodeAt(t);return i>=48&&i<=57?i-48:i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:void r(!1,"Invalid character in "+e)}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,i,n){for(var o=0,s=0,a=Math.min(e.length,i),c=t;c<a;c++){var l=e.charCodeAt(c)-48;o*=n,s=l>=49?l-49+10:l>=17?l-17+10:l,r(l>=0&&s<n,"Invalid character"),o+=s}return o}function u(e,t){e.words=t.words,e.length=t.length,e.negative=t.negative,e.red=t.red}if(o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this._strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this._strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this._strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype._move=function(e){u(e,this)},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{o.prototype[Symbol.for("nodejs.util.inspect.custom")]=h}catch(e){o.prototype.inspect=h}else o.prototype.inspect=h;function h(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var d=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],f=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],p=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);o=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,s--),i=0!==o||s!==this.length-1?d[6-c.length]+c+i:c+i}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=f[e],u=p[e];i="";var h=this.clone();for(h.negative=0;!h.isZero();){var m=h.modrn(u).toString(e);i=(h=h.idivn(u)).isZero()?m+i:d[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16,2)},s&&(o.prototype.toBuffer=function(e,t){return this.toArrayLike(s,e,t)}),o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)};function m(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r._strip()}o.prototype.toArrayLike=function(e,t,i){this._strip();var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0");var s=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)}(e,o);return this["_toArrayLike"+("le"===t?"LE":"BE")](s,n),s},o.prototype._toArrayLikeLE=function(e,t){for(var r=0,i=0,n=0,o=0;n<this.length;n++){var s=this.words[n]<<o|i;e[r++]=255&s,r<e.length&&(e[r++]=s>>8&255),r<e.length&&(e[r++]=s>>16&255),6===o?(r<e.length&&(e[r++]=s>>24&255),i=0,o=0):(i=s>>>24,o+=2)}if(r<e.length)for(e[r++]=i;r<e.length;)e[r++]=0},o.prototype._toArrayLikeBE=function(e,t){for(var r=e.length-1,i=0,n=0,o=0;n<this.length;n++){var s=this.words[n]<<o|i;e[r--]=255&s,r>=0&&(e[r--]=s>>8&255),r>=0&&(e[r--]=s>>16&255),6===o?(r>=0&&(e[r--]=s>>24&255),i=0,o=0):(i=s>>>24,o+=2)}if(r>=0)for(e[r--]=i;r>=0;)e[r--]=0},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this._strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this._strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this._strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this._strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this._strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var g=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function v(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r._strip()}function y(e,t,r){return v(e,t,r)}function b(e,t){this.x=e,this.y=t}Math.imul||(g=m),o.prototype.mulTo=function(e,t){var r=this.length+e.length;return 10===this.length&&10===e.length?g(this,e,t):r<63?m(this,e,t):r<1024?v(this,e,t):y(this,e,t)},b.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},b.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},b.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},b.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},b.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},b.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},b.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},b.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},b.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},b.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r._strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),y(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){var t=e<0;t&&(e=-e),r("number"==typeof e),r(e<67108864);for(var i=0,n=0;n<this.length;n++){var o=(0|this.words[n])*e,s=(67108863&o)+(67108863&i);i>>=26,i+=o/67108864|0,i+=s>>>26,this.words[n]=67108863&s}return 0!==i&&(this.words[n]=i,this.length++),t?this.ineg():this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=e.words[i]>>>n&1}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this._strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this._strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this._strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this._strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this._strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a._strip(),i._strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modrn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modrn=function(e){var t=e<0;t&&(e=-e),r(e<=67108863);for(var i=67108864%e,n=0,o=this.length-1;o>=0;o--)n=(i*n+(0|this.words[o]))%e;return t?-n:n},o.prototype.modn=function(e){return this.modrn(e)},o.prototype.idivn=function(e){var t=e<0;t&&(e=-e),r(e<=67108863);for(var i=0,n=this.length-1;n>=0;n--){var o=(0|this.words[n])+67108864*i;this.words[n]=o/e|0,i=o%e}return this._strip(),t?this.ineg():this},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this._strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new I(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var w={k256:null,p224:null,p192:null,p25519:null};function _(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function S(){_.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function E(){_.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){_.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function C(){_.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function I(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function T(e){I.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}_.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},_.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},_.prototype.split=function(e,t){e.iushrn(this.n,0,t)},_.prototype.imulK=function(e){return e.imul(this.k)},n(S,_),S.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},S.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(E,_),n(M,_),n(C,_),C.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(w[e])return w[e];var t;if("k256"===e)t=new S;else if("p224"===e)t=new E;else if("p192"===e)t=new M;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new C}return w[e]=t,t},I.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},I.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},I.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(u(e,e.umod(this.m)._forceRed(this)),e)},I.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},I.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},I.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},I.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},I.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},I.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},I.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},I.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},I.prototype.isqr=function(e){return this.imul(e,e.clone())},I.prototype.sqr=function(e){return this.mul(e,e)},I.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},I.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},I.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},I.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},I.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new T(e)},n(T,I),T.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},T.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},T.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},T.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},T.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("dEDF4",(function(e,t){var r=e.exports;r.version=i("7RD96").version,r.utils=i("brS1t"),r.rand=i("laKaL"),r.curve=i("jSUNI"),r.curves=i("3sWIt"),r.ec=i("clHeT"),r.eddsa=i("jVnqQ")})),i.register("7RD96",(function(e,t){e.exports=JSON.parse('{"name":"elliptic","version":"6.5.4","description":"EC cryptography","main":"lib/elliptic.js","files":["lib"],"scripts":{"lint":"eslint lib test","lint:fix":"npm run lint -- --fix","unit":"istanbul test _mocha --reporter=spec test/index.js","test":"npm run lint && npm run unit","version":"grunt dist && git add dist/"},"repository":{"type":"git","url":"git@github.com:indutny/elliptic"},"keywords":["EC","Elliptic","curve","Cryptography"],"author":"Fedor Indutny <fedor@indutny.com>","license":"MIT","bugs":{"url":"https://github.com/indutny/elliptic/issues"},"homepage":"https://github.com/indutny/elliptic","devDependencies":{"brfs":"^2.0.2","coveralls":"^3.1.0","eslint":"^7.6.0","grunt":"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1","istanbul":"^0.4.5","mocha":"^8.0.1"},"dependencies":{"bn.js":"^4.11.9","brorand":"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1","inherits":"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"}}')})),i.register("brS1t",(function(e,t){var r=e.exports,n=i("kCPYN"),o=i("7xO1L"),s=i("jtggp");r.assert=o,r.toArray=s.toArray,r.zero2=s.zero2,r.toHex=s.toHex,r.encode=s.encode,r.getNAF=function(e,t,r){var i=new Array(Math.max(e.bitLength(),r)+1);i.fill(0);for(var n=1<<t+1,o=e.clone(),s=0;s<i.length;s++){var a,c=o.andln(n-1);o.isOdd()?(a=c>(n>>1)-1?(n>>1)-c:c,o.isubn(a)):a=0,i[s]=a,o.iushrn(1)}return i},r.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var i,n=0,o=0;e.cmpn(-n)>0||t.cmpn(-o)>0;){var s,a,c=e.andln(3)+n&3,l=t.andln(3)+o&3;3===c&&(c=-1),3===l&&(l=-1),s=0==(1&c)?0:3!==(i=e.andln(7)+n&7)&&5!==i||2!==l?c:-c,r[0].push(s),a=0==(1&l)?0:3!==(i=t.andln(7)+o&7)&&5!==i||2!==c?l:-l,r[1].push(a),2*n===s+1&&(n=1-n),2*o===a+1&&(o=1-o),e.iushrn(1),t.iushrn(1)}return r},r.cachedProperty=function(e,t,r){var i="_"+t;e.prototype[t]=function(){return void 0!==this[i]?this[i]:this[i]=r.call(this)}},r.parseBytes=function(e){return"string"==typeof e?r.toArray(e,"hex"):e},r.intFromLE=function(e){return new n(e,"hex","le")}})),i.register("kCPYN",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,r,i){for(var n=0,o=Math.min(e.length,r),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r.strip()}o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);i=0!==(o=a>>>24-n&16777215)||s!==this.length-1?u[6-c.length]+c+i:c+i,(n+=2)>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],f=d[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:u[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,c="le"===t,l=new e(o),u=this.clone();if(c){for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[a]=s;for(;a<o;a++)l[a]=0}else{for(a=0;a<o-n;a++)l[a]=0;for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[o-a-1]=s}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),o.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r.strip()}(this,e,t):m(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},g.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},g.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},g.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},g.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),m(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function _(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function M(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(_,y),n(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new _;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return v[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new M(e)},n(M,E),M.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},M.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},M.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("jtggp",(function(e,t){var r=e.exports;function i(e){return 1===e.length?"0"+e:e}function n(e){for(var t="",r=0;r<e.length;r++)t+=i(e[r].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var i=0;i<e.length;i++)r[i]=0|e[i];return r}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(i=0;i<e.length;i++){var n=e.charCodeAt(i),o=n>>8,s=255&n;o?r.push(o,s):r.push(s)}return r},r.zero2=i,r.toHex=n,r.encode=function(e,t){return"hex"===t?n(e):e}})),i.register("jSUNI",(function(e,t){var r=e.exports;r.base=i("gQuxP"),r.short=i("hSKW7"),r.mont=i("ilOO6"),r.edwards=i("a92lJ")})),i.register("gQuxP",(function(e,t){var r=i("kCPYN"),n=i("brS1t"),o=n.getNAF,s=n.getJSF,a=n.assert;function c(e,t){this.type=e,this.p=new r(t.p,16),this.red=t.prime?r.red(t.prime):r.mont(this.p),this.zero=new r(0).toRed(this.red),this.one=new r(1).toRed(this.red),this.two=new r(2).toRed(this.red),this.n=t.n&&new r(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var i=this.n&&this.p.div(this.n);!i||i.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function l(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=c,c.prototype.point=function(){throw new Error("Not implemented")},c.prototype.validate=function(){throw new Error("Not implemented")},c.prototype._fixedNafMul=function(e,t){a(e.precomputed);var r=e._getDoubles(),i=o(t,1,this._bitLength),n=(1<<r.step+1)-(r.step%2==0?2:1);n/=3;var s,c,l=[];for(s=0;s<i.length;s+=r.step){c=0;for(var u=s+r.step-1;u>=s;u--)c=(c<<1)+i[u];l.push(c)}for(var h=this.jpoint(null,null,null),d=this.jpoint(null,null,null),f=n;f>0;f--){for(s=0;s<l.length;s++)(c=l[s])===f?d=d.mixedAdd(r.points[s]):c===-f&&(d=d.mixedAdd(r.points[s].neg()));h=h.add(d)}return h.toP()},c.prototype._wnafMul=function(e,t){var r=4,i=e._getNAFPoints(r);r=i.wnd;for(var n=i.points,s=o(t,r,this._bitLength),c=this.jpoint(null,null,null),l=s.length-1;l>=0;l--){for(var u=0;l>=0&&0===s[l];l--)u++;if(l>=0&&u++,c=c.dblp(u),l<0)break;var h=s[l];a(0!==h),c="affine"===e.type?h>0?c.mixedAdd(n[h-1>>1]):c.mixedAdd(n[-h-1>>1].neg()):h>0?c.add(n[h-1>>1]):c.add(n[-h-1>>1].neg())}return"affine"===e.type?c.toP():c},c.prototype._wnafMulAdd=function(e,t,r,i,n){var a,c,l,u=this._wnafT1,h=this._wnafT2,d=this._wnafT3,f=0;for(a=0;a<i;a++){var p=(l=t[a])._getNAFPoints(e);u[a]=p.wnd,h[a]=p.points}for(a=i-1;a>=1;a-=2){var m=a-1,g=a;if(1===u[m]&&1===u[g]){var v=[t[m],null,null,t[g]];0===t[m].y.cmp(t[g].y)?(v[1]=t[m].add(t[g]),v[2]=t[m].toJ().mixedAdd(t[g].neg())):0===t[m].y.cmp(t[g].y.redNeg())?(v[1]=t[m].toJ().mixedAdd(t[g]),v[2]=t[m].add(t[g].neg())):(v[1]=t[m].toJ().mixedAdd(t[g]),v[2]=t[m].toJ().mixedAdd(t[g].neg()));var y=[-3,-1,-5,-7,0,7,5,1,3],b=s(r[m],r[g]);for(f=Math.max(b[0].length,f),d[m]=new Array(f),d[g]=new Array(f),c=0;c<f;c++){var w=0|b[0][c],_=0|b[1][c];d[m][c]=y[3*(w+1)+(_+1)],d[g][c]=0,h[m]=v}}else d[m]=o(r[m],u[m],this._bitLength),d[g]=o(r[g],u[g],this._bitLength),f=Math.max(d[m].length,f),f=Math.max(d[g].length,f)}var S=this.jpoint(null,null,null),E=this._wnafT4;for(a=f;a>=0;a--){for(var M=0;a>=0;){var C=!0;for(c=0;c<i;c++)E[c]=0|d[c][a],0!==E[c]&&(C=!1);if(!C)break;M++,a--}if(a>=0&&M++,S=S.dblp(M),a<0)break;for(c=0;c<i;c++){var I=E[c];0!==I&&(I>0?l=h[c][I-1>>1]:I<0&&(l=h[c][-I-1>>1].neg()),S="affine"===l.type?S.mixedAdd(l):S.add(l))}}for(a=0;a<i;a++)h[a]=null;return n?S:S.toP()},c.BasePoint=l,l.prototype.eq=function(){throw new Error("Not implemented")},l.prototype.validate=function(){return this.curve.validate(this)},c.prototype.decodePoint=function(e,t){e=n.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?a(e[e.length-1]%2==0):7===e[0]&&a(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},l.prototype.encodeCompressed=function(e){return this.encode(e,!0)},l.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},l.prototype.encode=function(e,t){return n.encode(this._encode(t),e)},l.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},l.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},l.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],i=this,n=0;n<t;n+=e){for(var o=0;o<e;o++)i=i.dbl();r.push(i)}return{step:e,points:r}},l.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,i=1===r?null:this.dbl(),n=1;n<r;n++)t[n]=t[n-1].add(i);return{wnd:e,points:t}},l.prototype._getBeta=function(){return null},l.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}})),i.register("hSKW7",(function(e,t){var r=i("brS1t"),n=i("kCPYN"),o=i("6cuMU"),s=i("gQuxP"),a=r.assert;function c(e){s.call(this,"short",e),this.a=new n(e.a,16).toRed(this.red),this.b=new n(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function l(e,t,r,i){s.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new n(t,16),this.y=new n(r,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function u(e,t,r,i){s.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===i?(this.x=this.curve.one,this.y=this.curve.one,this.z=new n(0)):(this.x=new n(t,16),this.y=new n(r,16),this.z=new n(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}o(c,s),e.exports=c,c.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,r;if(e.beta)t=new n(e.beta,16).toRed(this.red);else{var i=this._getEndoRoots(this.p);t=(t=i[0].cmp(i[1])<0?i[0]:i[1]).toRed(this.red)}if(e.lambda)r=new n(e.lambda,16);else{var o=this._getEndoRoots(this.n);0===this.g.mul(o[0]).x.cmp(this.g.x.redMul(t))?r=o[0]:(r=o[1],a(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:r,basis:e.basis?e.basis.map((function(e){return{a:new n(e.a,16),b:new n(e.b,16)}})):this._getEndoBasis(r)}}},c.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:n.mont(e),r=new n(2).toRed(t).redInvm(),i=r.redNeg(),o=new n(3).toRed(t).redNeg().redSqrt().redMul(r);return[i.redAdd(o).fromRed(),i.redSub(o).fromRed()]},c.prototype._getEndoBasis=function(e){for(var t,r,i,o,s,a,c,l,u,h=this.n.ushrn(Math.floor(this.n.bitLength()/2)),d=e,f=this.n.clone(),p=new n(1),m=new n(0),g=new n(0),v=new n(1),y=0;0!==d.cmpn(0);){var b=f.div(d);l=f.sub(b.mul(d)),u=g.sub(b.mul(p));var w=v.sub(b.mul(m));if(!i&&l.cmp(h)<0)t=c.neg(),r=p,i=l.neg(),o=u;else if(i&&2==++y)break;c=l,f=d,d=l,g=p,p=u,v=m,m=w}s=l.neg(),a=u;var _=i.sqr().add(o.sqr());return s.sqr().add(a.sqr()).cmp(_)>=0&&(s=t,a=r),i.negative&&(i=i.neg(),o=o.neg()),s.negative&&(s=s.neg(),a=a.neg()),[{a:i,b:o},{a:s,b:a}]},c.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],i=t[1],n=i.b.mul(e).divRound(this.n),o=r.b.neg().mul(e).divRound(this.n),s=n.mul(r.a),a=o.mul(i.a),c=n.mul(r.b),l=o.mul(i.b);return{k1:e.sub(s).sub(a),k2:c.add(l).neg()}},c.prototype.pointFromX=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),i=r.redSqrt();if(0!==i.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var o=i.fromRed().isOdd();return(t&&!o||!t&&o)&&(i=i.redNeg()),this.point(e,i)},c.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,i=this.a.redMul(t),n=t.redSqr().redMul(t).redIAdd(i).redIAdd(this.b);return 0===r.redSqr().redISub(n).cmpn(0)},c.prototype._endoWnafMulAdd=function(e,t,r){for(var i=this._endoWnafT1,n=this._endoWnafT2,o=0;o<e.length;o++){var s=this._endoSplit(t[o]),a=e[o],c=a._getBeta();s.k1.negative&&(s.k1.ineg(),a=a.neg(!0)),s.k2.negative&&(s.k2.ineg(),c=c.neg(!0)),i[2*o]=a,i[2*o+1]=c,n[2*o]=s.k1,n[2*o+1]=s.k2}for(var l=this._wnafMulAdd(1,i,n,2*o,r),u=0;u<2*o;u++)i[u]=null,n[u]=null;return l},o(l,s.BasePoint),c.prototype.point=function(e,t,r){return new l(this,e,t,r)},c.prototype.pointFromJSON=function(e,t){return l.fromJSON(this,e,t)},l.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,i=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(i)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(i)}}}return t}},l.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},l.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var i=e.point(t[0],t[1],r);if(!t[2])return i;function n(t){return e.point(t[0],t[1],r)}var o=t[2];return i.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[i].concat(o.doubles.points.map(n))},naf:o.naf&&{wnd:o.naf.wnd,points:[i].concat(o.naf.points.map(n))}},i},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return this.inf},l.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),i=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,i)},l.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),i=e.redInvm(),n=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(i),o=n.redSqr().redISub(this.x.redAdd(this.x)),s=n.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,s)},l.prototype.getX=function(){return this.x.fromRed()},l.prototype.getY=function(){return this.y.fromRed()},l.prototype.mul=function(e){return e=new n(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},l.prototype.mulAdd=function(e,t,r){var i=[this,t],n=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n):this.curve._wnafMulAdd(1,i,n,2)},l.prototype.jmulAdd=function(e,t,r){var i=[this,t],n=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n,!0):this.curve._wnafMulAdd(1,i,n,2,!0)},l.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},l.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,i=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(i)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(i)}}}return t},l.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},o(u,s.BasePoint),c.prototype.jpoint=function(e,t,r){return new u(this,e,t,r)},u.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),i=this.y.redMul(t).redMul(e);return this.curve.point(r,i)},u.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},u.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(t),n=e.x.redMul(r),o=this.y.redMul(t.redMul(e.z)),s=e.y.redMul(r.redMul(this.z)),a=i.redSub(n),c=o.redSub(s);if(0===a.cmpn(0))return 0!==c.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var l=a.redSqr(),u=l.redMul(a),h=i.redMul(l),d=c.redSqr().redIAdd(u).redISub(h).redISub(h),f=c.redMul(h.redISub(d)).redISub(o.redMul(u)),p=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(d,f,p)},u.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,i=e.x.redMul(t),n=this.y,o=e.y.redMul(t).redMul(this.z),s=r.redSub(i),a=n.redSub(o);if(0===s.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=s.redSqr(),l=c.redMul(s),u=r.redMul(c),h=a.redSqr().redIAdd(l).redISub(u).redISub(u),d=a.redMul(u.redISub(h)).redISub(n.redMul(l)),f=this.z.redMul(s);return this.curve.jpoint(h,d,f)},u.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var i=this.curve.a,n=this.curve.tinv,o=this.x,s=this.y,a=this.z,c=a.redSqr().redSqr(),l=s.redAdd(s);for(t=0;t<e;t++){var u=o.redSqr(),h=l.redSqr(),d=h.redSqr(),f=u.redAdd(u).redIAdd(u).redIAdd(i.redMul(c)),p=o.redMul(h),m=f.redSqr().redISub(p.redAdd(p)),g=p.redISub(m),v=f.redMul(g);v=v.redIAdd(v).redISub(d);var y=l.redMul(a);t+1<e&&(c=c.redMul(d)),o=m,a=y,l=v}return this.curve.jpoint(o,l.redMul(n),a)},u.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},u.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),o=n.redSqr(),s=this.x.redAdd(n).redSqr().redISub(i).redISub(o);s=s.redIAdd(s);var a=i.redAdd(i).redIAdd(i),c=a.redSqr().redISub(s).redISub(s),l=o.redIAdd(o);l=(l=l.redIAdd(l)).redIAdd(l),e=c,t=a.redMul(s.redISub(c)).redISub(l),r=this.y.redAdd(this.y)}else{var u=this.x.redSqr(),h=this.y.redSqr(),d=h.redSqr(),f=this.x.redAdd(h).redSqr().redISub(u).redISub(d);f=f.redIAdd(f);var p=u.redAdd(u).redIAdd(u),m=p.redSqr(),g=d.redIAdd(d);g=(g=g.redIAdd(g)).redIAdd(g),e=m.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(g),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},u.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),o=n.redSqr(),s=this.x.redAdd(n).redSqr().redISub(i).redISub(o);s=s.redIAdd(s);var a=i.redAdd(i).redIAdd(i).redIAdd(this.curve.a),c=a.redSqr().redISub(s).redISub(s);e=c;var l=o.redIAdd(o);l=(l=l.redIAdd(l)).redIAdd(l),t=a.redMul(s.redISub(c)).redISub(l),r=this.y.redAdd(this.y)}else{var u=this.z.redSqr(),h=this.y.redSqr(),d=this.x.redMul(h),f=this.x.redSub(u).redMul(this.x.redAdd(u));f=f.redAdd(f).redIAdd(f);var p=d.redIAdd(d),m=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(m),r=this.y.redAdd(this.z).redSqr().redISub(h).redISub(u);var g=h.redSqr();g=(g=(g=g.redIAdd(g)).redIAdd(g)).redIAdd(g),t=f.redMul(p.redISub(e)).redISub(g)}return this.curve.jpoint(e,t,r)},u.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,i=this.z,n=i.redSqr().redSqr(),o=t.redSqr(),s=r.redSqr(),a=o.redAdd(o).redIAdd(o).redIAdd(e.redMul(n)),c=t.redAdd(t),l=(c=c.redIAdd(c)).redMul(s),u=a.redSqr().redISub(l.redAdd(l)),h=l.redISub(u),d=s.redSqr();d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var f=a.redMul(h).redISub(d),p=r.redAdd(r).redMul(i);return this.curve.jpoint(u,f,p)},u.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),i=t.redSqr(),n=e.redAdd(e).redIAdd(e),o=n.redSqr(),s=this.x.redAdd(t).redSqr().redISub(e).redISub(i),a=(s=(s=(s=s.redIAdd(s)).redAdd(s).redIAdd(s)).redISub(o)).redSqr(),c=i.redIAdd(i);c=(c=(c=c.redIAdd(c)).redIAdd(c)).redIAdd(c);var l=n.redIAdd(s).redSqr().redISub(o).redISub(a).redISub(c),u=t.redMul(l);u=(u=u.redIAdd(u)).redIAdd(u);var h=this.x.redMul(a).redISub(u);h=(h=h.redIAdd(h)).redIAdd(h);var d=this.y.redMul(l.redMul(c.redISub(l)).redISub(s.redMul(a)));d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var f=this.z.redAdd(s).redSqr().redISub(r).redISub(a);return this.curve.jpoint(h,d,f)},u.prototype.mul=function(e,t){return e=new n(e,t),this.curve._wnafMul(this,e)},u.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var i=t.redMul(this.z),n=r.redMul(e.z);return 0===this.y.redMul(n).redISub(e.y.redMul(i)).cmpn(0)},u.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var i=e.clone(),n=this.curve.redN.redMul(t);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(n),0===this.x.cmp(r))return!0}},u.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}})),i.register("ilOO6",(function(e,t){var r=i("kCPYN"),n=i("6cuMU"),o=i("gQuxP"),s=i("brS1t");function a(e){o.call(this,"mont",e),this.a=new r(e.a,16).toRed(this.red),this.b=new r(e.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function c(e,t,i){o.BasePoint.call(this,e,"projective"),null===t&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(t,16),this.z=new r(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}n(a,o),e.exports=a,a.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),i=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===i.redSqrt().redSqr().cmp(i)},n(c,o.BasePoint),a.prototype.decodePoint=function(e,t){return this.point(s.toArray(e,t),1)},a.prototype.point=function(e,t){return new c(this,e,t)},a.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},c.prototype.precompute=function(){},c.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},c.fromJSON=function(e,t){return new c(e,t[0],t[1]||e.one)},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},c.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),i=e.redMul(t),n=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(i,n)},c.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),i=this.x.redSub(this.z),n=e.x.redAdd(e.z),o=e.x.redSub(e.z).redMul(r),s=n.redMul(i),a=t.z.redMul(o.redAdd(s).redSqr()),c=t.x.redMul(o.redISub(s).redSqr());return this.curve.point(a,c)},c.prototype.mul=function(e){for(var t=e.clone(),r=this,i=this.curve.point(null,null),n=[];0!==t.cmpn(0);t.iushrn(1))n.push(t.andln(1));for(var o=n.length-1;o>=0;o--)0===n[o]?(r=r.diffAdd(i,this),i=i.dbl()):(i=r.diffAdd(i,this),r=r.dbl());return i},c.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},c.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},c.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()}})),i.register("a92lJ",(function(e,t){var r=i("brS1t"),n=i("kCPYN"),o=i("6cuMU"),s=i("gQuxP"),a=r.assert;function c(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,s.call(this,"edwards",e),this.a=new n(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new n(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new n(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function l(e,t,r,i,o){s.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===i?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new n(t,16),this.y=new n(r,16),this.z=i?new n(i,16):this.curve.one,this.t=o&&new n(o,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}o(c,s),e.exports=c,c.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},c.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},c.prototype.jpoint=function(e,t,r,i){return this.point(e,t,r,i)},c.prototype.pointFromX=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),i=this.c2.redSub(this.a.redMul(r)),o=this.one.redSub(this.c2.redMul(this.d).redMul(r)),s=i.redMul(o.redInvm()),a=s.redSqrt();if(0!==a.redSqr().redSub(s).cmp(this.zero))throw new Error("invalid point");var c=a.fromRed().isOdd();return(t&&!c||!t&&c)&&(a=a.redNeg()),this.point(e,a)},c.prototype.pointFromY=function(e,t){(e=new n(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),i=r.redSub(this.c2),o=r.redMul(this.d).redMul(this.c2).redSub(this.a),s=i.redMul(o.redInvm());if(0===s.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var a=s.redSqrt();if(0!==a.redSqr().redSub(s).cmp(this.zero))throw new Error("invalid point");return a.fromRed().isOdd()!==t&&(a=a.redNeg()),this.point(a,e)},c.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),i=t.redMul(this.a).redAdd(r),n=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===i.cmp(n)},o(l,s.BasePoint),c.prototype.pointFromJSON=function(e){return l.fromJSON(this,e)},c.prototype.point=function(e,t,r,i){return new l(this,e,t,r,i)},l.fromJSON=function(e,t){return new l(e,t[0],t[1],t[2])},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},l.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var i=this.curve._mulA(e),n=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),o=i.redAdd(t),s=o.redSub(r),a=i.redSub(t),c=n.redMul(s),l=o.redMul(a),u=n.redMul(a),h=s.redMul(o);return this.curve.point(c,l,h,u)},l.prototype._projDbl=function(){var e,t,r,i,n,o,s=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),c=this.y.redSqr();if(this.curve.twisted){var l=(i=this.curve._mulA(a)).redAdd(c);this.zOne?(e=s.redSub(a).redSub(c).redMul(l.redSub(this.curve.two)),t=l.redMul(i.redSub(c)),r=l.redSqr().redSub(l).redSub(l)):(n=this.z.redSqr(),o=l.redSub(n).redISub(n),e=s.redSub(a).redISub(c).redMul(o),t=l.redMul(i.redSub(c)),r=l.redMul(o))}else i=a.redAdd(c),n=this.curve._mulC(this.z).redSqr(),o=i.redSub(n).redSub(n),e=this.curve._mulC(s.redISub(i)).redMul(o),t=this.curve._mulC(i).redMul(a.redISub(c)),r=i.redMul(o);return this.curve.point(e,t,r)},l.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},l.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),i=this.t.redMul(this.curve.dd).redMul(e.t),n=this.z.redMul(e.z.redAdd(e.z)),o=r.redSub(t),s=n.redSub(i),a=n.redAdd(i),c=r.redAdd(t),l=o.redMul(s),u=a.redMul(c),h=o.redMul(c),d=s.redMul(a);return this.curve.point(l,u,d,h)},l.prototype._projAdd=function(e){var t,r,i=this.z.redMul(e.z),n=i.redSqr(),o=this.x.redMul(e.x),s=this.y.redMul(e.y),a=this.curve.d.redMul(o).redMul(s),c=n.redSub(a),l=n.redAdd(a),u=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(o).redISub(s),h=i.redMul(c).redMul(u);return this.curve.twisted?(t=i.redMul(l).redMul(s.redSub(this.curve._mulA(o))),r=c.redMul(l)):(t=i.redMul(l).redMul(s.redSub(o)),r=this.curve._mulC(c).redMul(l)),this.curve.point(h,t,r)},l.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},l.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},l.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},l.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},l.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},l.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},l.prototype.getX=function(){return this.normalize(),this.x.fromRed()},l.prototype.getY=function(){return this.normalize(),this.y.fromRed()},l.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},l.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),i=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(i),0===this.x.cmp(t))return!0}},l.prototype.toP=l.prototype.normalize,l.prototype.mixedAdd=l.prototype.add})),i.register("3sWIt",(function(e,t){var r,n=e.exports,o=i("fSvQP"),s=i("jSUNI"),a=i("brS1t").assert;function c(e){"short"===e.type?this.curve=new s.short(e):"edwards"===e.type?this.curve=new s.edwards(e):this.curve=new s.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function l(e,t){Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:function(){var r=new c(t);return Object.defineProperty(n,e,{configurable:!0,enumerable:!0,value:r}),r}})}n.PresetCurve=c,l("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:o.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),l("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:o.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),l("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:o.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),l("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:o.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),l("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:o.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),l("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:o.sha256,gRed:!1,g:["9"]}),l("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:o.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{r=i("iG5mh")}catch(e){r=void 0}l("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:o.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",r]})})),i.register("fSvQP",(function(e,t){var r=e.exports;r.utils=i("332F3"),r.common=i("gWB3G"),r.sha=i("hQRHq"),r.ripemd=i("iFNMe"),r.hmac=i("eg6uK"),r.sha1=r.sha.sha1,r.sha256=r.sha.sha256,r.sha224=r.sha.sha224,r.sha384=r.sha.sha384,r.sha512=r.sha.sha512,r.ripemd160=r.ripemd.ripemd160})),i.register("332F3",(function(t,r){var n,o,s,a,c,l,u,h,d,f,p,m,g,v,y,b,w,_,S,E,M,C,I,T,k,R;e(t.exports,"inherits",(()=>n),(e=>n=e)),e(t.exports,"toArray",(()=>o),(e=>o=e)),e(t.exports,"toHex",(()=>s),(e=>s=e)),e(t.exports,"htonl",(()=>a),(e=>a=e)),e(t.exports,"toHex32",(()=>c),(e=>c=e)),e(t.exports,"zero2",(()=>l),(e=>l=e)),e(t.exports,"zero8",(()=>u),(e=>u=e)),e(t.exports,"join32",(()=>h),(e=>h=e)),e(t.exports,"split32",(()=>d),(e=>d=e)),e(t.exports,"rotr32",(()=>f),(e=>f=e)),e(t.exports,"rotl32",(()=>p),(e=>p=e)),e(t.exports,"sum32",(()=>m),(e=>m=e)),e(t.exports,"sum32_3",(()=>g),(e=>g=e)),e(t.exports,"sum32_4",(()=>v),(e=>v=e)),e(t.exports,"sum32_5",(()=>y),(e=>y=e)),e(t.exports,"sum64",(()=>b),(e=>b=e)),e(t.exports,"sum64_hi",(()=>w),(e=>w=e)),e(t.exports,"sum64_lo",(()=>_),(e=>_=e)),e(t.exports,"sum64_4_hi",(()=>S),(e=>S=e)),e(t.exports,"sum64_4_lo",(()=>E),(e=>E=e)),e(t.exports,"sum64_5_hi",(()=>M),(e=>M=e)),e(t.exports,"sum64_5_lo",(()=>C),(e=>C=e)),e(t.exports,"rotr64_hi",(()=>I),(e=>I=e)),e(t.exports,"rotr64_lo",(()=>T),(e=>T=e)),e(t.exports,"shr64_hi",(()=>k),(e=>k=e)),e(t.exports,"shr64_lo",(()=>R),(e=>R=e));var x=i("7xO1L"),O=i("6cuMU");function A(e,t){return 55296==(64512&e.charCodeAt(t))&&(!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1)))}function P(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function D(e){return 1===e.length?"0"+e:e}function L(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}n=O,o=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16))}else for(var i=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?r[i++]=o:o<2048?(r[i++]=o>>6|192,r[i++]=63&o|128):A(e,n)?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n)),r[i++]=o>>18|240,r[i++]=o>>12&63|128,r[i++]=o>>6&63|128,r[i++]=63&o|128):(r[i++]=o>>12|224,r[i++]=o>>6&63|128,r[i++]=63&o|128)}else for(n=0;n<e.length;n++)r[n]=0|e[n];return r},s=function(e){for(var t="",r=0;r<e.length;r++)t+=D(e[r].toString(16));return t},a=P,c=function(e,t){for(var r="",i=0;i<e.length;i++){var n=e[i];"little"===t&&(n=P(n)),r+=L(n.toString(16))}return r},l=D,u=L,h=function(e,t,r,i){var n=r-t;x(n%4==0);for(var o=new Array(n/4),s=0,a=t;s<o.length;s++,a+=4){var c;c="big"===i?e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3]:e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a],o[s]=c>>>0}return o},d=function(e,t){for(var r=new Array(4*e.length),i=0,n=0;i<e.length;i++,n+=4){var o=e[i];"big"===t?(r[n]=o>>>24,r[n+1]=o>>>16&255,r[n+2]=o>>>8&255,r[n+3]=255&o):(r[n+3]=o>>>24,r[n+2]=o>>>16&255,r[n+1]=o>>>8&255,r[n]=255&o)}return r},f=function(e,t){return e>>>t|e<<32-t},p=function(e,t){return e<<t|e>>>32-t},m=function(e,t){return e+t>>>0},g=function(e,t,r){return e+t+r>>>0},v=function(e,t,r,i){return e+t+r+i>>>0},y=function(e,t,r,i,n){return e+t+r+i+n>>>0},b=function(e,t,r,i){var n=e[t],o=i+e[t+1]>>>0,s=(o<i?1:0)+r+n;e[t]=s>>>0,e[t+1]=o},w=function(e,t,r,i){return(t+i>>>0<t?1:0)+e+r>>>0},_=function(e,t,r,i){return t+i>>>0},S=function(e,t,r,i,n,o,s,a){var c=0,l=t;return c+=(l=l+i>>>0)<t?1:0,c+=(l=l+o>>>0)<o?1:0,e+r+n+s+(c+=(l=l+a>>>0)<a?1:0)>>>0},E=function(e,t,r,i,n,o,s,a){return t+i+o+a>>>0},M=function(e,t,r,i,n,o,s,a,c,l){var u=0,h=t;return u+=(h=h+i>>>0)<t?1:0,u+=(h=h+o>>>0)<o?1:0,u+=(h=h+a>>>0)<a?1:0,e+r+n+s+c+(u+=(h=h+l>>>0)<l?1:0)>>>0},C=function(e,t,r,i,n,o,s,a,c,l){return t+i+o+a+l>>>0},I=function(e,t,r){return(t<<32-r|e>>>r)>>>0},T=function(e,t,r){return(e<<32-r|t>>>r)>>>0},k=function(e,t,r){return e>>>r},R=function(e,t,r){return(e<<32-r|t>>>r)>>>0}})),i.register("gWB3G",(function(t,r){var n;e(t.exports,"BlockHash",(()=>n),(e=>n=e));var o=i("332F3"),s=i("7xO1L");function a(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}n=a,a.prototype.update=function(e,t){if(e=o.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=o.join32(e,0,e.length-r,this.endian);for(var i=0;i<e.length;i+=this._delta32)this._update(e,i,i+this._delta32)}return this},a.prototype.digest=function(e){return this.update(this._pad()),s(null===this.pending),this._digest(e)},a.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,i=new Array(r+this.padLength);i[0]=128;for(var n=1;n<r;n++)i[n]=0;if(e<<=3,"big"===this.endian){for(var o=8;o<this.padLength;o++)i[n++]=0;i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=e>>>24&255,i[n++]=e>>>16&255,i[n++]=e>>>8&255,i[n++]=255&e}else for(i[n++]=255&e,i[n++]=e>>>8&255,i[n++]=e>>>16&255,i[n++]=e>>>24&255,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,o=8;o<this.padLength;o++)i[n++]=0;return i}})),i.register("hQRHq",(function(t,r){var n,o,s,a,c;e(t.exports,"sha1",(()=>n),(e=>n=e)),e(t.exports,"sha224",(()=>o),(e=>o=e)),e(t.exports,"sha256",(()=>s),(e=>s=e)),e(t.exports,"sha384",(()=>a),(e=>a=e)),e(t.exports,"sha512",(()=>c),(e=>c=e)),n=i("eBOUY"),o=i("9Jq2d"),s=i("gMHmU"),a=i("kKCiD"),c=i("96rhG")})),i.register("eBOUY",(function(e,t){var r=i("332F3"),n=i("gWB3G"),o=i("gQHsq"),s=r.rotl32,a=r.sum32,c=r.sum32_5,l=o.ft_1,u=n.BlockHash,h=[1518500249,1859775393,2400959708,3395469782];function d(){if(!(this instanceof d))return new d;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}r.inherits(d,u),e.exports=d,d.blockSize=512,d.outSize=160,d.hmacStrength=80,d.padLength=64,d.prototype._update=function(e,t){for(var r=this.W,i=0;i<16;i++)r[i]=e[t+i];for(;i<r.length;i++)r[i]=s(r[i-3]^r[i-8]^r[i-14]^r[i-16],1);var n=this.h[0],o=this.h[1],u=this.h[2],d=this.h[3],f=this.h[4];for(i=0;i<r.length;i++){var p=~~(i/20),m=c(s(n,5),l(p,o,u,d),f,r[i],h[p]);f=d,d=u,u=s(o,30),o=n,n=m}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],o),this.h[2]=a(this.h[2],u),this.h[3]=a(this.h[3],d),this.h[4]=a(this.h[4],f)},d.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}})),i.register("gQHsq",(function(t,r){var n,o,s,a,c,l,u;e(t.exports,"ft_1",(()=>n),(e=>n=e)),e(t.exports,"ch32",(()=>o),(e=>o=e)),e(t.exports,"maj32",(()=>s),(e=>s=e)),e(t.exports,"s0_256",(()=>a),(e=>a=e)),e(t.exports,"s1_256",(()=>c),(e=>c=e)),e(t.exports,"g0_256",(()=>l),(e=>l=e)),e(t.exports,"g1_256",(()=>u),(e=>u=e));var h=i("332F3").rotr32;function d(e,t,r){return e&t^~e&r}function f(e,t,r){return e&t^e&r^t&r}function p(e,t,r){return e^t^r}n=function(e,t,r,i){return 0===e?d(t,r,i):1===e||3===e?p(t,r,i):2===e?f(t,r,i):void 0},o=d,s=f,a=function(e){return h(e,2)^h(e,13)^h(e,22)},c=function(e){return h(e,6)^h(e,11)^h(e,25)},l=function(e){return h(e,7)^h(e,18)^e>>>3},u=function(e){return h(e,17)^h(e,19)^e>>>10}})),i.register("9Jq2d",(function(e,t){var r=i("332F3"),n=i("gMHmU");function o(){if(!(this instanceof o))return new o;n.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}r.inherits(o,n),e.exports=o,o.blockSize=512,o.outSize=224,o.hmacStrength=192,o.padLength=64,o.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h.slice(0,7),"big"):r.split32(this.h.slice(0,7),"big")}})),i.register("gMHmU",(function(e,t){var r=i("332F3"),n=i("gWB3G"),o=i("gQHsq"),s=i("7xO1L"),a=r.sum32,c=r.sum32_4,l=r.sum32_5,u=o.ch32,h=o.maj32,d=o.s0_256,f=o.s1_256,p=o.g0_256,m=o.g1_256,g=n.BlockHash,v=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function y(){if(!(this instanceof y))return new y;g.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=v,this.W=new Array(64)}r.inherits(y,g),e.exports=y,y.blockSize=512,y.outSize=256,y.hmacStrength=192,y.padLength=64,y.prototype._update=function(e,t){for(var r=this.W,i=0;i<16;i++)r[i]=e[t+i];for(;i<r.length;i++)r[i]=c(m(r[i-2]),r[i-7],p(r[i-15]),r[i-16]);var n=this.h[0],o=this.h[1],g=this.h[2],v=this.h[3],y=this.h[4],b=this.h[5],w=this.h[6],_=this.h[7];for(s(this.k.length===r.length),i=0;i<r.length;i++){var S=l(_,f(y),u(y,b,w),this.k[i],r[i]),E=a(d(n),h(n,o,g));_=w,w=b,b=y,y=a(v,S),v=g,g=o,o=n,n=a(S,E)}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],o),this.h[2]=a(this.h[2],g),this.h[3]=a(this.h[3],v),this.h[4]=a(this.h[4],y),this.h[5]=a(this.h[5],b),this.h[6]=a(this.h[6],w),this.h[7]=a(this.h[7],_)},y.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}})),i.register("kKCiD",(function(e,t){var r=i("332F3"),n=i("96rhG");function o(){if(!(this instanceof o))return new o;n.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}r.inherits(o,n),e.exports=o,o.blockSize=1024,o.outSize=384,o.hmacStrength=192,o.padLength=128,o.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h.slice(0,12),"big"):r.split32(this.h.slice(0,12),"big")}})),i.register("96rhG",(function(e,t){var r=i("332F3"),n=i("gWB3G"),o=i("7xO1L"),s=r.rotr64_hi,a=r.rotr64_lo,c=r.shr64_hi,l=r.shr64_lo,u=r.sum64,h=r.sum64_hi,d=r.sum64_lo,f=r.sum64_4_hi,p=r.sum64_4_lo,m=r.sum64_5_hi,g=r.sum64_5_lo,v=n.BlockHash,y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function b(){if(!(this instanceof b))return new b;v.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=y,this.W=new Array(160)}function w(e,t,r,i,n){var o=e&r^~e&n;return o<0&&(o+=4294967296),o}function _(e,t,r,i,n,o){var s=t&i^~t&o;return s<0&&(s+=4294967296),s}function S(e,t,r,i,n){var o=e&r^e&n^r&n;return o<0&&(o+=4294967296),o}function E(e,t,r,i,n,o){var s=t&i^t&o^i&o;return s<0&&(s+=4294967296),s}function M(e,t){var r=s(e,t,28)^s(t,e,2)^s(t,e,7);return r<0&&(r+=4294967296),r}function C(e,t){var r=a(e,t,28)^a(t,e,2)^a(t,e,7);return r<0&&(r+=4294967296),r}function I(e,t){var r=s(e,t,14)^s(e,t,18)^s(t,e,9);return r<0&&(r+=4294967296),r}function T(e,t){var r=a(e,t,14)^a(e,t,18)^a(t,e,9);return r<0&&(r+=4294967296),r}function k(e,t){var r=s(e,t,1)^s(e,t,8)^c(e,t,7);return r<0&&(r+=4294967296),r}function R(e,t){var r=a(e,t,1)^a(e,t,8)^l(e,t,7);return r<0&&(r+=4294967296),r}function x(e,t){var r=s(e,t,19)^s(t,e,29)^c(e,t,6);return r<0&&(r+=4294967296),r}function O(e,t){var r=a(e,t,19)^a(t,e,29)^l(e,t,6);return r<0&&(r+=4294967296),r}r.inherits(b,v),e.exports=b,b.blockSize=1024,b.outSize=512,b.hmacStrength=192,b.padLength=128,b.prototype._prepareBlock=function(e,t){for(var r=this.W,i=0;i<32;i++)r[i]=e[t+i];for(;i<r.length;i+=2){var n=x(r[i-4],r[i-3]),o=O(r[i-4],r[i-3]),s=r[i-14],a=r[i-13],c=k(r[i-30],r[i-29]),l=R(r[i-30],r[i-29]),u=r[i-32],h=r[i-31];r[i]=f(n,o,s,a,c,l,u,h),r[i+1]=p(n,o,s,a,c,l,u,h)}},b.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,i=this.h[0],n=this.h[1],s=this.h[2],a=this.h[3],c=this.h[4],l=this.h[5],f=this.h[6],p=this.h[7],v=this.h[8],y=this.h[9],b=this.h[10],k=this.h[11],R=this.h[12],x=this.h[13],O=this.h[14],A=this.h[15];o(this.k.length===r.length);for(var P=0;P<r.length;P+=2){var D=O,L=A,U=I(v,y),N=T(v,y),j=w(v,y,b,k,R),B=_(v,y,b,k,R,x),F=this.k[P],K=this.k[P+1],q=r[P],$=r[P+1],W=m(D,L,U,N,j,B,F,K,q,$),V=g(D,L,U,N,j,B,F,K,q,$);D=M(i,n),L=C(i,n),U=S(i,n,s,a,c),N=E(i,n,s,a,c,l);var H=h(D,L,U,N),G=d(D,L,U,N);O=R,A=x,R=b,x=k,b=v,k=y,v=h(f,p,W,V),y=d(p,p,W,V),f=c,p=l,c=s,l=a,s=i,a=n,i=h(W,V,H,G),n=d(W,V,H,G)}u(this.h,0,i,n),u(this.h,2,s,a),u(this.h,4,c,l),u(this.h,6,f,p),u(this.h,8,v,y),u(this.h,10,b,k),u(this.h,12,R,x),u(this.h,14,O,A)},b.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}})),i.register("iFNMe",(function(t,r){var n;e(t.exports,"ripemd160",(()=>n),(e=>n=e));var o=i("332F3"),s=i("gWB3G"),a=o.rotl32,c=o.sum32,l=o.sum32_3,u=o.sum32_4,h=s.BlockHash;function d(){if(!(this instanceof d))return new d;h.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function f(e,t,r,i){return e<=15?t^r^i:e<=31?t&r|~t&i:e<=47?(t|~r)^i:e<=63?t&i|r&~i:t^(r|~i)}function p(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function m(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}o.inherits(d,h),n=d,d.blockSize=512,d.outSize=160,d.hmacStrength=192,d.padLength=64,d.prototype._update=function(e,t){for(var r=this.h[0],i=this.h[1],n=this.h[2],o=this.h[3],s=this.h[4],h=r,d=i,w=n,_=o,S=s,E=0;E<80;E++){var M=c(a(u(r,f(E,i,n,o),e[g[E]+t],p(E)),y[E]),s);r=s,s=o,o=a(n,10),n=i,i=M,M=c(a(u(h,f(79-E,d,w,_),e[v[E]+t],m(E)),b[E]),S),h=S,S=_,_=a(w,10),w=d,d=M}M=l(this.h[1],n,_),this.h[1]=l(this.h[2],o,S),this.h[2]=l(this.h[3],s,h),this.h[3]=l(this.h[4],r,d),this.h[4]=l(this.h[0],i,w),this.h[0]=M},d.prototype._digest=function(e){return"hex"===e?o.toHex32(this.h,"little"):o.split32(this.h,"little")};var g=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],v=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],y=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],b=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]})),i.register("eg6uK",(function(e,t){var r=i("332F3"),n=i("7xO1L");function o(e,t,i){if(!(this instanceof o))return new o(e,t,i);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(r.toArray(t,i))}e.exports=o,o.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),n(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},o.prototype.update=function(e,t){return this.inner.update(e,t),this},o.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}})),i.register("iG5mh",(function(e,t){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}})),i.register("clHeT",(function(e,t){var r=i("kCPYN"),n=i("6Ai7O"),o=i("brS1t"),s=i("3sWIt"),a=i("laKaL"),c=o.assert,l=i("dpPlI"),u=i("lUF90");function h(e){if(!(this instanceof h))return new h(e);"string"==typeof e&&(c(Object.prototype.hasOwnProperty.call(s,e),"Unknown curve "+e),e=s[e]),e instanceof s.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=h,h.prototype.keyPair=function(e){return new l(this,e)},h.prototype.keyFromPrivate=function(e,t){return l.fromPrivate(this,e,t)},h.prototype.keyFromPublic=function(e,t){return l.fromPublic(this,e,t)},h.prototype.genKeyPair=function(e){e||(e={});for(var t=new n({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||a(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),o=this.n.sub(new r(2));;){var s=new r(t.generate(i));if(!(s.cmp(o)>0))return s.iaddn(1),this.keyFromPrivate(s)}},h.prototype._truncateToN=function(e,t){var r=8*e.byteLength()-this.n.bitLength();return r>0&&(e=e.ushrn(r)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},h.prototype.sign=function(e,t,i,o){"object"==typeof i&&(o=i,i=null),o||(o={}),t=this.keyFromPrivate(t,i),e=this._truncateToN(new r(e,16));for(var s=this.n.byteLength(),a=t.getPrivate().toArray("be",s),c=e.toArray("be",s),l=new n({hash:this.hash,entropy:a,nonce:c,pers:o.pers,persEnc:o.persEnc||"utf8"}),h=this.n.sub(new r(1)),d=0;;d++){var f=o.k?o.k(d):new r(l.generate(this.n.byteLength()));if(!((f=this._truncateToN(f,!0)).cmpn(1)<=0||f.cmp(h)>=0)){var p=this.g.mul(f);if(!p.isInfinity()){var m=p.getX(),g=m.umod(this.n);if(0!==g.cmpn(0)){var v=f.invm(this.n).mul(g.mul(t.getPrivate()).iadd(e));if(0!==(v=v.umod(this.n)).cmpn(0)){var y=(p.getY().isOdd()?1:0)|(0!==m.cmp(g)?2:0);return o.canonical&&v.cmp(this.nh)>0&&(v=this.n.sub(v),y^=1),new u({r:g,s:v,recoveryParam:y})}}}}}},h.prototype.verify=function(e,t,i,n){e=this._truncateToN(new r(e,16)),i=this.keyFromPublic(i,n);var o=(t=new u(t,"hex")).r,s=t.s;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;var a,c=s.invm(this.n),l=c.mul(e).umod(this.n),h=c.mul(o).umod(this.n);return this.curve._maxwellTrick?!(a=this.g.jmulAdd(l,i.getPublic(),h)).isInfinity()&&a.eqXToP(o):!(a=this.g.mulAdd(l,i.getPublic(),h)).isInfinity()&&0===a.getX().umod(this.n).cmp(o)},h.prototype.recoverPubKey=function(e,t,i,n){c((3&i)===i,"The recovery param is more than two bits"),t=new u(t,n);var o=this.n,s=new r(e),a=t.r,l=t.s,h=1&i,d=i>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&d)throw new Error("Unable to find sencond key candinate");a=d?this.curve.pointFromX(a.add(this.curve.n),h):this.curve.pointFromX(a,h);var f=t.r.invm(o),p=o.sub(s).mul(f).umod(o),m=l.mul(f).umod(o);return this.g.mulAdd(p,a,m)},h.prototype.getKeyRecoveryParam=function(e,t,r,i){if(null!==(t=new u(t,i)).recoveryParam)return t.recoveryParam;for(var n=0;n<4;n++){var o;try{o=this.recoverPubKey(e,t,n)}catch(e){continue}if(o.eq(r))return n}throw new Error("Unable to find valid recovery factor")}})),i.register("6Ai7O",(function(e,t){var r=i("fSvQP"),n=i("jtggp"),o=i("7xO1L");function s(e){if(!(this instanceof s))return new s(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=n.toArray(e.entropy,e.entropyEnc||"hex"),r=n.toArray(e.nonce,e.nonceEnc||"hex"),i=n.toArray(e.pers,e.persEnc||"hex");o(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,i)}e.exports=s,s.prototype._init=function(e,t,r){var i=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var n=0;n<this.V.length;n++)this.K[n]=0,this.V[n]=1;this._update(i),this._reseed=1,this.reseedInterval=281474976710656},s.prototype._hmac=function(){return new r.hmac(this.hash,this.K)},s.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},s.prototype.reseed=function(e,t,r,i){"string"!=typeof t&&(i=r,r=t,t=null),e=n.toArray(e,t),r=n.toArray(r,i),o(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},s.prototype.generate=function(e,t,r,i){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(i=r,r=t,t=null),r&&(r=n.toArray(r,i||"hex"),this._update(r));for(var o=[];o.length<e;)this.V=this._hmac().update(this.V).digest(),o=o.concat(this.V);var s=o.slice(0,e);return this._update(r),this._reseed++,n.encode(s,t)}})),i.register("dpPlI",(function(e,t){var r=i("kCPYN"),n=i("brS1t").assert;function o(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=o,o.fromPublic=function(e,t,r){return t instanceof o?t:new o(e,{pub:t,pubEnc:r})},o.fromPrivate=function(e,t,r){return t instanceof o?t:new o(e,{priv:t,privEnc:r})},o.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},o.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},o.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},o.prototype._importPrivate=function(e,t){this.priv=new r(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},o.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?n(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||n(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},o.prototype.derive=function(e){return e.validate()||n(e.validate(),"public point not validated"),e.mul(this.priv).getX()},o.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},o.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},o.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}})),i.register("lUF90",(function(e,t){var r=i("kCPYN"),n=i("brS1t"),o=n.assert;function s(e,t){if(e instanceof s)return e;this._importDER(e,t)||(o(e.r&&e.s,"Signature without r or s"),this.r=new r(e.r,16),this.s=new r(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function a(){this.place=0}function c(e,t){var r=e[t.place++];if(!(128&r))return r;var i=15&r;if(0===i||i>4)return!1;for(var n=0,o=0,s=t.place;o<i;o++,s++)n<<=8,n|=e[s],n>>>=0;return!(n<=127)&&(t.place=s,n)}function l(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function u(e,t){if(t<128)e.push(t);else{var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}}e.exports=s,s.prototype._importDER=function(e,t){e=n.toArray(e,t);var i=new a;if(48!==e[i.place++])return!1;var o=c(e,i);if(!1===o)return!1;if(o+i.place!==e.length)return!1;if(2!==e[i.place++])return!1;var s=c(e,i);if(!1===s)return!1;var l=e.slice(i.place,s+i.place);if(i.place+=s,2!==e[i.place++])return!1;var u=c(e,i);if(!1===u)return!1;if(e.length!==u+i.place)return!1;var h=e.slice(i.place,u+i.place);if(0===l[0]){if(!(128&l[1]))return!1;l=l.slice(1)}if(0===h[0]){if(!(128&h[1]))return!1;h=h.slice(1)}return this.r=new r(l),this.s=new r(h),this.recoveryParam=null,!0},s.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=l(t),r=l(r);!(r[0]||128&r[1]);)r=r.slice(1);var i=[2];u(i,t.length),(i=i.concat(t)).push(2),u(i,r.length);var o=i.concat(r),s=[48];return u(s,o.length),s=s.concat(o),n.encode(s,e)}})),i.register("jVnqQ",(function(e,t){var r=i("fSvQP"),n=i("3sWIt"),o=i("brS1t"),s=o.assert,a=o.parseBytes,c=i("evNSJ"),l=i("9o1wZ");function u(e){if(s("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof u))return new u(e);e=n[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=r.sha512}e.exports=u,u.prototype.sign=function(e,t){e=a(e);var r=this.keyFromSecret(t),i=this.hashInt(r.messagePrefix(),e),n=this.g.mul(i),o=this.encodePoint(n),s=this.hashInt(o,r.pubBytes(),e).mul(r.priv()),c=i.add(s).umod(this.curve.n);return this.makeSignature({R:n,S:c,Rencoded:o})},u.prototype.verify=function(e,t,r){e=a(e),t=this.makeSignature(t);var i=this.keyFromPublic(r),n=this.hashInt(t.Rencoded(),i.pubBytes(),e),o=this.g.mul(t.S());return t.R().add(i.pub().mul(n)).eq(o)},u.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return o.intFromLE(e.digest()).umod(this.curve.n)},u.prototype.keyFromPublic=function(e){return c.fromPublic(this,e)},u.prototype.keyFromSecret=function(e){return c.fromSecret(this,e)},u.prototype.makeSignature=function(e){return e instanceof l?e:new l(this,e)},u.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},u.prototype.decodePoint=function(e){var t=(e=o.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),i=0!=(128&e[t]),n=o.intFromLE(r);return this.curve.pointFromY(n,i)},u.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},u.prototype.decodeInt=function(e){return o.intFromLE(e)},u.prototype.isPoint=function(e){return e instanceof this.pointClass}})),i.register("evNSJ",(function(e,t){var r=i("brS1t"),n=r.assert,o=r.parseBytes,s=r.cachedProperty;function a(e,t){this.eddsa=e,this._secret=o(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=o(t.pub)}a.fromPublic=function(e,t){return t instanceof a?t:new a(e,{pub:t})},a.fromSecret=function(e,t){return t instanceof a?t:new a(e,{secret:t})},a.prototype.secret=function(){return this._secret},s(a,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),s(a,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),s(a,"privBytes",(function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,i=t.slice(0,e.encodingLength);return i[0]&=248,i[r]&=127,i[r]|=64,i})),s(a,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),s(a,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),s(a,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),a.prototype.sign=function(e){return n(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},a.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},a.prototype.getSecret=function(e){return n(this._secret,"KeyPair is public only"),r.encode(this.secret(),e)},a.prototype.getPublic=function(e){return r.encode(this.pubBytes(),e)},e.exports=a})),i.register("9o1wZ",(function(e,t){var r=i("kCPYN"),n=i("brS1t"),o=n.assert,s=n.cachedProperty,a=n.parseBytes;function c(e,t){this.eddsa=e,"object"!=typeof t&&(t=a(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),o(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof r&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}s(c,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),s(c,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),s(c,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),s(c,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),c.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},c.prototype.toHex=function(){return n.encode(this.toBytes(),"hex").toUpperCase()},e.exports=c})),i.register("8sncL",(function(e,t){var r=i("6vNa5"),n=i("bbc25"),o=i("4Uusr"),s=i("enuUj"),a=i("wQ7R3"),c=i("k0Rto").Buffer;function l(e){var t;"object"!=typeof e||c.isBuffer(e)||(t=e.passphrase,e=e.key),"string"==typeof e&&(e=c.from(e));var i,l,u=o(e,t),h=u.tag,d=u.data;switch(h){case"CERTIFICATE":l=r.certificate.decode(d,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(l||(l=r.PublicKey.decode(d,"der")),i=l.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return r.RSAPublicKey.decode(l.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return l.subjectPrivateKey=l.subjectPublicKey,{type:"ec",data:l};case"1.2.840.10040.4.1":return l.algorithm.params.pub_key=r.DSAparam.decode(l.subjectPublicKey.data,"der"),{type:"dsa",data:l.algorithm.params};default:throw new Error("unknown key id "+i)}case"ENCRYPTED PRIVATE KEY":d=function(e,t){var r=e.algorithm.decrypt.kde.kdeparams.salt,i=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),o=n[e.algorithm.decrypt.cipher.algo.join(".")],l=e.algorithm.decrypt.cipher.iv,u=e.subjectPrivateKey,h=parseInt(o.split("-")[1],10)/8,d=a.pbkdf2Sync(t,r,i,h,"sha1"),f=s.createDecipheriv(o,d,l),p=[];return p.push(f.update(u)),p.push(f.final()),c.concat(p)}(d=r.EncryptedPrivateKey.decode(d,"der"),t);case"PRIVATE KEY":switch(i=(l=r.PrivateKey.decode(d,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return r.RSAPrivateKey.decode(l.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:l.algorithm.curve,privateKey:r.ECPrivateKey.decode(l.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return l.algorithm.params.priv_key=r.DSAparam.decode(l.subjectPrivateKey,"der"),{type:"dsa",params:l.algorithm.params};default:throw new Error("unknown key id "+i)}case"RSA PUBLIC KEY":return r.RSAPublicKey.decode(d,"der");case"RSA PRIVATE KEY":return r.RSAPrivateKey.decode(d,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:r.DSAPrivateKey.decode(d,"der")};case"EC PRIVATE KEY":return{curve:(d=r.ECPrivateKey.decode(d,"der")).parameters.value,privateKey:d.privateKey};default:throw new Error("unknown key type "+h)}}e.exports=l,l.signature=r.signature})),i.register("6vNa5",(function(t,r){var n,o,s,a,c,l,u,h,d,f;e(t.exports,"certificate",(()=>n),(e=>n=e)),e(t.exports,"RSAPrivateKey",(()=>o),(e=>o=e)),e(t.exports,"RSAPublicKey",(()=>s),(e=>s=e)),e(t.exports,"PublicKey",(()=>a),(e=>a=e)),e(t.exports,"PrivateKey",(()=>c),(e=>c=e)),e(t.exports,"EncryptedPrivateKey",(()=>l),(e=>l=e)),e(t.exports,"DSAPrivateKey",(()=>u),(e=>u=e)),e(t.exports,"DSAparam",(()=>h),(e=>h=e)),e(t.exports,"ECPrivateKey",(()=>d),(e=>d=e)),e(t.exports,"signature",(()=>f),(e=>f=e));var p=i("f6ATU");n=i("8mCBH");var m=p.define("RSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}));o=m;var g=p.define("RSAPublicKey",(function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}));s=g;var v=p.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(y),this.key("subjectPublicKey").bitstr())}));a=v;var y=p.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())})),b=p.define("PrivateKeyInfo",(function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(y),this.key("subjectPrivateKey").octstr())}));c=b;var w=p.define("EncryptedPrivateKeyInfo",(function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}));l=w;var _=p.define("DSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}));u=_,h=p.define("DSAparam",(function(){this.int()}));var S=p.define("ECPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(E),this.key("publicKey").optional().explicit(1).bitstr())}));d=S;var E=p.define("ECParameters",(function(){this.choice({namedCurve:this.objid()})}));f=p.define("signature",(function(){this.seq().obj(this.key("r").int(),this.key("s").int())}))})),i.register("f6ATU",(function(e,t){const r=e.exports;r.bignum=i("cptwS"),r.define=i("bzTok").define,r.base=i("50MJM"),r.constants=i("eOu52"),r.decoders=i("185bd"),r.encoders=i("2FRn8")})),i.register("cptwS",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,r,i){for(var n=0,o=Math.min(e.length,r),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r.strip()}o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);i=0!==(o=a>>>24-n&16777215)||s!==this.length-1?u[6-c.length]+c+i:c+i,(n+=2)>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],f=d[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:u[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,c="le"===t,l=new e(o),u=this.clone();if(c){for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[a]=s;for(;a<o;a++)l[a]=0}else{for(a=0;a<o-n;a++)l[a]=0;for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[o-a-1]=s}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),o.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r.strip()}(this,e,t):m(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},g.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},g.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},g.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},g.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),m(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function _(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function M(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(_,y),n(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new _;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return v[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new M(e)},n(M,E),M.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},M.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},M.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("bzTok",(function(e,t){var r=i("2FRn8"),n=i("185bd"),o=i("6cuMU");function s(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}e.exports.define=function(e,t){return new s(e,t)},s.prototype._createNamed=function(e){const t=this.name;function r(e){this._initNamed(e,t)}return o(r,e),r.prototype._initNamed=function(t,r){e.call(this,t,r)},new r(this)},s.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(n[e])),this.decoders[e]},s.prototype.decode=function(e,t,r){return this._getDecoder(t).decode(e,r)},s.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(r[e])),this.encoders[e]},s.prototype.encode=function(e,t,r){return this._getEncoder(t).encode(e,r)}})),i.register("2FRn8",(function(e,t){const r=e.exports;r.der=i("g9EHu"),r.pem=i("b1Fvj")})),i.register("g9EHu",(function(e,t){var r=i("6cuMU"),n=i("eoLdT").Buffer,o=i("kNfRa"),s=i("5L1HU");function a(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){o.call(this,"der",e)}function l(e){return e<10?"0"+e:e}e.exports=a,a.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},r(c,o),c.prototype._encodeComposite=function(e,t,r,i){const o=function(e,t,r,i){let n;"seqof"===e?e="seq":"setof"===e&&(e="set");if(s.tagByName.hasOwnProperty(e))n=s.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return i.error("Unknown tag: "+e);n=e}if(n>=31)return i.error("Multi-octet tag encoding unsupported");t||(n|=32);return n|=s.tagClassByName[r||"universal"]<<6,n}(e,t,r,this.reporter);if(i.length<128){const e=n.alloc(2);return e[0]=o,e[1]=i.length,this._createEncoderBuffer([e,i])}let a=1;for(let e=i.length;e>=256;e>>=8)a++;const c=n.alloc(2+a);c[0]=o,c[1]=128|a;for(let e=1+a,t=i.length;t>0;e--,t>>=8)c[e]=255&t;return this._createEncoderBuffer([c,i])},c.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){const t=n.alloc(2*e.length);for(let r=0;r<e.length;r++)t.writeUInt16BE(e.charCodeAt(r),2*r);return this._createEncoderBuffer(t)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)||"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},c.prototype._encodeObjid=function(e,t,r){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s.]+/g);for(let t=0;t<e.length;t++)e[t]|=0}else if(Array.isArray(e)){e=e.slice();for(let t=0;t<e.length;t++)e[t]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!r){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}let i=0;for(let t=0;t<e.length;t++){let r=e[t];for(i++;r>=128;r>>=7)i++}const o=n.alloc(i);let s=o.length-1;for(let t=e.length-1;t>=0;t--){let r=e[t];for(o[s--]=127&r;(r>>=7)>0;)o[s--]=128|127&r}return this._createEncoderBuffer(o)},c.prototype._encodeTime=function(e,t){let r;const i=new Date(e);return"gentime"===t?r=[l(i.getUTCFullYear()),l(i.getUTCMonth()+1),l(i.getUTCDate()),l(i.getUTCHours()),l(i.getUTCMinutes()),l(i.getUTCSeconds()),"Z"].join(""):"utctime"===t?r=[l(i.getUTCFullYear()%100),l(i.getUTCMonth()+1),l(i.getUTCDate()),l(i.getUTCHours()),l(i.getUTCMinutes()),l(i.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(r,"octstr")},c.prototype._encodeNull=function(){return this._createEncoderBuffer("")},c.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!n.isBuffer(e)){const t=e.toArray();!e.sign&&128&t[0]&&t.unshift(0),e=n.from(t)}if(n.isBuffer(e)){let t=e.length;0===e.length&&t++;const r=n.alloc(t);return e.copy(r),0===e.length&&(r[0]=0),this._createEncoderBuffer(r)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);let r=1;for(let t=e;t>=256;t>>=8)r++;const i=new Array(r);for(let t=i.length-1;t>=0;t--)i[t]=255&e,e>>=8;return 128&i[0]&&i.unshift(0),this._createEncoderBuffer(n.from(i))},c.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},c.prototype._skipDefault=function(e,t,r){const i=this._baseState;let n;if(null===i.default)return!1;const o=e.join();if(void 0===i.defaultBuffer&&(i.defaultBuffer=this._encodeValue(i.default,t,r).join()),o.length!==i.defaultBuffer.length)return!1;for(n=0;n<o.length;n++)if(o[n]!==i.defaultBuffer[n])return!1;return!0}})),i.register("eoLdT",(function(e,t){var r,n=i("9Mq5w"),o=i("awmEs"),s=o.Buffer,a={};for(r in o)o.hasOwnProperty(r)&&"SlowBuffer"!==r&&"Buffer"!==r&&(a[r]=o[r]);var c=a.Buffer={};for(r in s)s.hasOwnProperty(r)&&"allocUnsafe"!==r&&"allocUnsafeSlow"!==r&&(c[r]=s[r]);if(a.Buffer.prototype=s.prototype,c.from&&c.from!==Uint8Array.from||(c.from=function(e,t,r){if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof e);if(e&&void 0===e.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);return s(e,t,r)}),c.alloc||(c.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError('The "size" argument must be of type number. Received type '+typeof e);if(e<0||e>=2147483648)throw new RangeError('The value "'+e+'" is invalid for option "size"');var i=s(e);return t&&0!==t.length?"string"==typeof r?i.fill(t,r):i.fill(t):i.fill(0),i}),!a.kStringMaxLength)try{a.kStringMaxLength=n.binding("buffer").kStringMaxLength}catch(e){}a.constants||(a.constants={MAX_LENGTH:a.kMaxLength},a.kStringMaxLength&&(a.constants.MAX_STRING_LENGTH=a.kStringMaxLength)),e.exports=a})),i.register("kNfRa",(function(e,t){var r=i("9DVK2").Reporter,n=i("iVkdG").EncoderBuffer,o=i("iVkdG").DecoderBuffer,s=i("7xO1L");const a=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],c=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(a);function l(e,t,r){const i={};this._baseState=i,i.name=r,i.enc=e,i.parent=t||null,i.children=null,i.tag=null,i.args=null,i.reverseArgs=null,i.choice=null,i.optional=!1,i.any=!1,i.obj=!1,i.use=null,i.useDecoder=null,i.key=null,i.default=null,i.explicit=null,i.implicit=null,i.contains=null,i.parent||(i.children=[],this._wrap())}e.exports=l;const u=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];l.prototype.clone=function(){const e=this._baseState,t={};u.forEach((function(r){t[r]=e[r]}));const r=new this.constructor(t.parent);return r._baseState=t,r},l.prototype._wrap=function(){const e=this._baseState;c.forEach((function(t){this[t]=function(){const r=new this.constructor(this);return e.children.push(r),r[t].apply(r,arguments)}}),this)},l.prototype._init=function(e){const t=this._baseState;s(null===t.parent),e.call(this),t.children=t.children.filter((function(e){return e._baseState.parent===this}),this),s.equal(t.children.length,1,"Root node can have only one child")},l.prototype._useArgs=function(e){const t=this._baseState,r=e.filter((function(e){return e instanceof this.constructor}),this);e=e.filter((function(e){return!(e instanceof this.constructor)}),this),0!==r.length&&(s(null===t.children),t.children=r,r.forEach((function(e){e._baseState.parent=this}),this)),0!==e.length&&(s(null===t.args),t.args=e,t.reverseArgs=e.map((function(e){if("object"!=typeof e||e.constructor!==Object)return e;const t={};return Object.keys(e).forEach((function(r){r==(0|r)&&(r|=0);const i=e[r];t[i]=r})),t})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(e){l.prototype[e]=function(){const t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}})),a.forEach((function(e){l.prototype[e]=function(){const t=this._baseState,r=Array.prototype.slice.call(arguments);return s(null===t.tag),t.tag=e,this._useArgs(r),this}})),l.prototype.use=function(e){s(e);const t=this._baseState;return s(null===t.use),t.use=e,this},l.prototype.optional=function(){return this._baseState.optional=!0,this},l.prototype.def=function(e){const t=this._baseState;return s(null===t.default),t.default=e,t.optional=!0,this},l.prototype.explicit=function(e){const t=this._baseState;return s(null===t.explicit&&null===t.implicit),t.explicit=e,this},l.prototype.implicit=function(e){const t=this._baseState;return s(null===t.explicit&&null===t.implicit),t.implicit=e,this},l.prototype.obj=function(){const e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},l.prototype.key=function(e){const t=this._baseState;return s(null===t.key),t.key=e,this},l.prototype.any=function(){return this._baseState.any=!0,this},l.prototype.choice=function(e){const t=this._baseState;return s(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map((function(t){return e[t]}))),this},l.prototype.contains=function(e){const t=this._baseState;return s(null===t.use),t.contains=e,this},l.prototype._decode=function(e,t){const r=this._baseState;if(null===r.parent)return e.wrapResult(r.children[0]._decode(e,t));let i,n=r.default,s=!0,a=null;if(null!==r.key&&(a=e.enterKey(r.key)),r.optional){let i=null;if(null!==r.explicit?i=r.explicit:null!==r.implicit?i=r.implicit:null!==r.tag&&(i=r.tag),null!==i||r.any){if(s=this._peekTag(e,i,r.any),e.isError(s))return s}else{const i=e.save();try{null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t),s=!0}catch(e){s=!1}e.restore(i)}}if(r.obj&&s&&(i=e.enterObject()),s){if(null!==r.explicit){const t=this._decodeTag(e,r.explicit);if(e.isError(t))return t;e=t}const i=e.offset;if(null===r.use&&null===r.choice){let t;r.any&&(t=e.save());const i=this._decodeTag(e,null!==r.implicit?r.implicit:r.tag,r.any);if(e.isError(i))return i;r.any?n=e.raw(t):e=i}if(t&&t.track&&null!==r.tag&&t.track(e.path(),i,e.length,"tagged"),t&&t.track&&null!==r.tag&&t.track(e.path(),e.offset,e.length,"content"),r.any||(n=null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t)),e.isError(n))return n;if(r.any||null!==r.choice||null===r.children||r.children.forEach((function(r){r._decode(e,t)})),r.contains&&("octstr"===r.tag||"bitstr"===r.tag)){const i=new o(n);n=this._getUse(r.contains,e._reporterState.obj)._decode(i,t)}}return r.obj&&s&&(n=e.leaveObject(i)),null===r.key||null===n&&!0!==s?null!==a&&e.exitKey(a):e.leaveKey(a,r.key,n),n},l.prototype._decodeGeneric=function(e,t,r){const i=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,i.args[0],r):/str$/.test(e)?this._decodeStr(t,e,r):"objid"===e&&i.args?this._decodeObjid(t,i.args[0],i.args[1],r):"objid"===e?this._decodeObjid(t,null,null,r):"gentime"===e||"utctime"===e?this._decodeTime(t,e,r):"null_"===e?this._decodeNull(t,r):"bool"===e?this._decodeBool(t,r):"objDesc"===e?this._decodeStr(t,e,r):"int"===e||"enum"===e?this._decodeInt(t,i.args&&i.args[0],r):null!==i.use?this._getUse(i.use,t._reporterState.obj)._decode(t,r):t.error("unknown tag: "+e)},l.prototype._getUse=function(e,t){const r=this._baseState;return r.useDecoder=this._use(e,t),s(null===r.useDecoder._baseState.parent),r.useDecoder=r.useDecoder._baseState.children[0],r.implicit!==r.useDecoder._baseState.implicit&&(r.useDecoder=r.useDecoder.clone(),r.useDecoder._baseState.implicit=r.implicit),r.useDecoder},l.prototype._decodeChoice=function(e,t){const r=this._baseState;let i=null,n=!1;return Object.keys(r.choice).some((function(o){const s=e.save(),a=r.choice[o];try{const r=a._decode(e,t);if(e.isError(r))return!1;i={type:o,value:r},n=!0}catch(t){return e.restore(s),!1}return!0}),this),n?i:e.error("Choice not matched")},l.prototype._createEncoderBuffer=function(e){return new n(e,this.reporter)},l.prototype._encode=function(e,t,r){const i=this._baseState;if(null!==i.default&&i.default===e)return;const n=this._encodeValue(e,t,r);return void 0===n||this._skipDefault(n,t,r)?void 0:n},l.prototype._encodeValue=function(e,t,i){const n=this._baseState;if(null===n.parent)return n.children[0]._encode(e,t||new r);let o=null;if(this.reporter=t,n.optional&&void 0===e){if(null===n.default)return;e=n.default}let s=null,a=!1;if(n.any)o=this._createEncoderBuffer(e);else if(n.choice)o=this._encodeChoice(e,t);else if(n.contains)s=this._getUse(n.contains,i)._encode(e,t),a=!0;else if(n.children)s=n.children.map((function(r){if("null_"===r._baseState.tag)return r._encode(null,t,e);if(null===r._baseState.key)return t.error("Child should have a key");const i=t.enterKey(r._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");const n=r._encode(e[r._baseState.key],t,e);return t.leaveKey(i),n}),this).filter((function(e){return e})),s=this._createEncoderBuffer(s);else if("seqof"===n.tag||"setof"===n.tag){if(!n.args||1!==n.args.length)return t.error("Too many args for : "+n.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");const r=this.clone();r._baseState.implicit=null,s=this._createEncoderBuffer(e.map((function(r){const i=this._baseState;return this._getUse(i.args[0],e)._encode(r,t)}),r))}else null!==n.use?o=this._getUse(n.use,i)._encode(e,t):(s=this._encodePrimitive(n.tag,e),a=!0);if(!n.any&&null===n.choice){const e=null!==n.implicit?n.implicit:n.tag,r=null===n.implicit?"universal":"context";null===e?null===n.use&&t.error("Tag could be omitted only for .use()"):null===n.use&&(o=this._encodeComposite(e,a,r,s))}return null!==n.explicit&&(o=this._encodeComposite(n.explicit,!1,"context",o)),o},l.prototype._encodeChoice=function(e,t){const r=this._baseState,i=r.choice[e.type];return i||s(!1,e.type+" not found in "+JSON.stringify(Object.keys(r.choice))),i._encode(e.value,t)},l.prototype._encodePrimitive=function(e,t){const r=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&r.args)return this._encodeObjid(t,r.reverseArgs[0],r.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,r.args&&r.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},l.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},l.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(e)}})),i.register("9DVK2",(function(t,r){var n;e(t.exports,"Reporter",(()=>n),(e=>n=e));var o=i("6cuMU");function s(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function a(e,t){this.path=e,this.rethrow(t)}n=s,s.prototype.isError=function(e){return e instanceof a},s.prototype.save=function(){const e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},s.prototype.restore=function(e){const t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},s.prototype.enterKey=function(e){return this._reporterState.path.push(e)},s.prototype.exitKey=function(e){const t=this._reporterState;t.path=t.path.slice(0,e-1)},s.prototype.leaveKey=function(e,t,r){const i=this._reporterState;this.exitKey(e),null!==i.obj&&(i.obj[t]=r)},s.prototype.path=function(){return this._reporterState.path.join("/")},s.prototype.enterObject=function(){const e=this._reporterState,t=e.obj;return e.obj={},t},s.prototype.leaveObject=function(e){const t=this._reporterState,r=t.obj;return t.obj=e,r},s.prototype.error=function(e){let t;const r=this._reporterState,i=e instanceof a;if(t=i?e:new a(r.path.map((function(e){return"["+JSON.stringify(e)+"]"})).join(""),e.message||e,e.stack),!r.options.partial)throw t;return i||r.errors.push(t),t},s.prototype.wrapResult=function(e){const t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},o(a,Error),a.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,a),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}})),i.register("iVkdG",(function(t,r){var n,o;e(t.exports,"DecoderBuffer",(()=>n),(e=>n=e)),e(t.exports,"EncoderBuffer",(()=>o),(e=>o=e));var s=i("6cuMU"),a=i("9DVK2").Reporter,c=i("eoLdT").Buffer;function l(e,t){a.call(this,t),c.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function u(e,t){if(Array.isArray(e))this.length=0,this.value=e.map((function(e){return u.isEncoderBuffer(e)||(e=new u(e,t)),this.length+=e.length,e}),this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=c.byteLength(e);else{if(!c.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}s(l,a),n=l,l.isDecoderBuffer=function(e){if(e instanceof l)return!0;return"object"==typeof e&&c.isBuffer(e.base)&&"DecoderBuffer"===e.constructor.name&&"number"==typeof e.offset&&"number"==typeof e.length&&"function"==typeof e.save&&"function"==typeof e.restore&&"function"==typeof e.isEmpty&&"function"==typeof e.readUInt8&&"function"==typeof e.skip&&"function"==typeof e.raw},l.prototype.save=function(){return{offset:this.offset,reporter:a.prototype.save.call(this)}},l.prototype.restore=function(e){const t=new l(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,a.prototype.restore.call(this,e.reporter),t},l.prototype.isEmpty=function(){return this.offset===this.length},l.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},l.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");const r=new l(this.base);return r._reporterState=this._reporterState,r.offset=this.offset,r.length=this.offset+e,this.offset+=e,r},l.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},o=u,u.isEncoderBuffer=function(e){if(e instanceof u)return!0;return"object"==typeof e&&"EncoderBuffer"===e.constructor.name&&"number"==typeof e.length&&"function"==typeof e.join},u.prototype.join=function(e,t){return e||(e=c.alloc(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach((function(r){r.join(e,t),t+=r.length})):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):c.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}})),i.register("5L1HU",(function(t,r){var i,n,o,s;function a(e){const t={};return Object.keys(e).forEach((function(r){(0|r)==r&&(r|=0);const i=e[r];t[i]=r})),t}e(t.exports,"tagClass",(()=>i),(e=>i=e)),e(t.exports,"tagClassByName",(()=>n),(e=>n=e)),e(t.exports,"tag",(()=>o),(e=>o=e)),e(t.exports,"tagByName",(()=>s),(e=>s=e)),n=a(i={0:"universal",1:"application",2:"context",3:"private"}),s=a(o={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"})})),i.register("b1Fvj",(function(e,t){var r=i("6cuMU"),n=i("g9EHu");function o(e){n.call(this,e),this.enc="pem"}r(o,n),e.exports=o,o.prototype.encode=function(e,t){const r=n.prototype.encode.call(this,e).toString("base64"),i=["-----BEGIN "+t.label+"-----"];for(let e=0;e<r.length;e+=64)i.push(r.slice(e,e+64));return i.push("-----END "+t.label+"-----"),i.join("\n")}})),i.register("185bd",(function(e,t){const r=e.exports;r.der=i("kEqVM"),r.pem=i("jSQYT")})),i.register("kEqVM",(function(e,t){var r=i("6cuMU"),n=i("cptwS"),o=i("iVkdG").DecoderBuffer,s=i("kNfRa"),a=i("5L1HU");function c(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new l,this.tree._init(e.body)}function l(e){s.call(this,"der",e)}function u(e,t){let r=e.readUInt8(t);if(e.isError(r))return r;const i=a.tagClass[r>>6],n=0==(32&r);if(31==(31&r)){let i=r;for(r=0;128==(128&i);){if(i=e.readUInt8(t),e.isError(i))return i;r<<=7,r|=127&i}}else r&=31;return{cls:i,primitive:n,tag:r,tagStr:a.tag[r]}}function h(e,t,r){let i=e.readUInt8(r);if(e.isError(i))return i;if(!t&&128===i)return null;if(0==(128&i))return i;const n=127&i;if(n>4)return e.error("length octect is too long");i=0;for(let t=0;t<n;t++){i<<=8;const t=e.readUInt8(r);if(e.isError(t))return t;i|=t}return i}e.exports=c,c.prototype.decode=function(e,t){return o.isDecoderBuffer(e)||(e=new o(e,t)),this.tree._decode(e,t)},r(l,s),l.prototype._peekTag=function(e,t,r){if(e.isEmpty())return!1;const i=e.save(),n=u(e,'Failed to peek tag: "'+t+'"');return e.isError(n)?n:(e.restore(i),n.tag===t||n.tagStr===t||n.tagStr+"of"===t||r)},l.prototype._decodeTag=function(e,t,r){const i=u(e,'Failed to decode tag of "'+t+'"');if(e.isError(i))return i;let n=h(e,i.primitive,'Failed to get length of "'+t+'"');if(e.isError(n))return n;if(!r&&i.tag!==t&&i.tagStr!==t&&i.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(i.primitive||null!==n)return e.skip(n,'Failed to match body of: "'+t+'"');const o=e.save(),s=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(s)?s:(n=e.offset-o.offset,e.restore(o),e.skip(n,'Failed to match body of: "'+t+'"'))},l.prototype._skipUntilEnd=function(e,t){for(;;){const r=u(e,t);if(e.isError(r))return r;const i=h(e,r.primitive,t);if(e.isError(i))return i;let n;if(n=r.primitive||null!==i?e.skip(i):this._skipUntilEnd(e,t),e.isError(n))return n;if("end"===r.tagStr)break}},l.prototype._decodeList=function(e,t,r,i){const n=[];for(;!e.isEmpty();){const t=this._peekTag(e,"end");if(e.isError(t))return t;const o=r.decode(e,"der",i);if(e.isError(o)&&t)break;n.push(o)}return n},l.prototype._decodeStr=function(e,t){if("bitstr"===t){const t=e.readUInt8();return e.isError(t)?t:{unused:t,data:e.raw()}}if("bmpstr"===t){const t=e.raw();if(t.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");let r="";for(let e=0;e<t.length/2;e++)r+=String.fromCharCode(t.readUInt16BE(2*e));return r}if("numstr"===t){const t=e.raw().toString("ascii");return this._isNumstr(t)?t:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){const t=e.raw().toString("ascii");return this._isPrintstr(t)?t:e.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},l.prototype._decodeObjid=function(e,t,r){let i;const n=[];let o=0,s=0;for(;!e.isEmpty();)s=e.readUInt8(),o<<=7,o|=127&s,0==(128&s)&&(n.push(o),o=0);128&s&&n.push(o);const a=n[0]/40|0,c=n[0]%40;if(i=r?n:[a,c].concat(n.slice(1)),t){let e=t[i.join(" ")];void 0===e&&(e=t[i.join(".")]),void 0!==e&&(i=e)}return i},l.prototype._decodeTime=function(e,t){const r=e.raw().toString();let i,n,o,s,a,c;if("gentime"===t)i=0|r.slice(0,4),n=0|r.slice(4,6),o=0|r.slice(6,8),s=0|r.slice(8,10),a=0|r.slice(10,12),c=0|r.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");i=0|r.slice(0,2),n=0|r.slice(2,4),o=0|r.slice(4,6),s=0|r.slice(6,8),a=0|r.slice(8,10),c=0|r.slice(10,12),i=i<70?2e3+i:1900+i}return Date.UTC(i,n-1,o,s,a,c,0)},l.prototype._decodeNull=function(){return null},l.prototype._decodeBool=function(e){const t=e.readUInt8();return e.isError(t)?t:0!==t},l.prototype._decodeInt=function(e,t){const r=e.raw();let i=new n(r);return t&&(i=t[i.toString(10)]||i),i},l.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}})),i.register("jSQYT",(function(e,t){var r=i("6cuMU"),n=i("eoLdT").Buffer,o=i("kEqVM");function s(e){o.call(this,e),this.enc="pem"}r(s,o),e.exports=s,s.prototype.decode=function(e,t){const r=e.toString().split(/[\r\n]+/g),i=t.label.toUpperCase(),s=/^-----(BEGIN|END) ([^-]+)-----$/;let a=-1,c=-1;for(let e=0;e<r.length;e++){const t=r[e].match(s);if(null!==t&&t[2]===i){if(-1!==a){if("END"!==t[1])break;c=e;break}if("BEGIN"!==t[1])break;a=e}}if(-1===a||-1===c)throw new Error("PEM section not found for: "+i);const l=r.slice(a+1,c).join("");l.replace(/[^a-z0-9+/=]+/gi,"");const u=n.from(l,"base64");return o.prototype.decode.call(this,u,t)}})),i.register("50MJM",(function(e,t){const r=e.exports;r.Reporter=i("9DVK2").Reporter,r.DecoderBuffer=i("iVkdG").DecoderBuffer,r.EncoderBuffer=i("iVkdG").EncoderBuffer,r.Node=i("kNfRa")})),i.register("eOu52",(function(e,t){const r=e.exports;r._reverse=function(e){const t={};return Object.keys(e).forEach((function(r){(0|r)==r&&(r|=0);const i=e[r];t[i]=r})),t},r.der=i("5L1HU")})),i.register("8mCBH",(function(e,t){var r=i("f6ATU"),n=r.define("Time",(function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})),o=r.define("AttributeTypeValue",(function(){this.seq().obj(this.key("type").objid(),this.key("value").any())})),s=r.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())})),a=r.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(s),this.key("subjectPublicKey").bitstr())})),c=r.define("RelativeDistinguishedName",(function(){this.setof(o)})),l=r.define("RDNSequence",(function(){this.seqof(c)})),u=r.define("Name",(function(){this.choice({rdnSequence:this.use(l)})})),h=r.define("Validity",(function(){this.seq().obj(this.key("notBefore").use(n),this.key("notAfter").use(n))})),d=r.define("Extension",(function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())})),f=r.define("TBSCertificate",(function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(s),this.key("issuer").use(u),this.key("validity").use(h),this.key("subject").use(u),this.key("subjectPublicKeyInfo").use(a),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(d).optional())})),p=r.define("X509Certificate",(function(){this.seq().obj(this.key("tbsCertificate").use(f),this.key("signatureAlgorithm").use(s),this.key("signatureValue").bitstr())}));e.exports=p})),i.register("bbc25",(function(e,t){e.exports=JSON.parse('{"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}')})),i.register("4Uusr",(function(e,t){var r=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,n=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,o=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,s=i("afScy"),a=i("enuUj"),c=i("k0Rto").Buffer;e.exports=function(e,t){var i,l=e.toString(),u=l.match(r);if(u){var h="aes"+u[1],d=c.from(u[2],"hex"),f=c.from(u[3].replace(/[\r\n]/g,""),"base64"),p=s(t,d.slice(0,8),parseInt(u[1],10)).key,m=[],g=a.createDecipheriv(h,p,d);m.push(g.update(f)),m.push(g.final()),i=c.concat(m)}else{var v=l.match(o);i=c.from(v[2].replace(/[\r\n]/g,""),"base64")}return{tag:l.match(n)[1],data:i}}})),i.register("1zkIO",(function(e,t){e.exports=JSON.parse('{"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}')})),i.register("1O2UL",(function(e,t){var r=i("k0Rto").Buffer,n=i("g5rlv"),o=i("dEDF4").ec,s=i("8sncL"),a=i("1zkIO");function c(e,t){if(e.cmpn(0)<=0)throw new Error("invalid sig");if(e.cmp(t)>=t)throw new Error("invalid sig")}e.exports=function(e,t,i,l,u){var h=s(i);if("ec"===h.type){if("ecdsa"!==l&&"ecdsa/rsa"!==l)throw new Error("wrong public key type");return function(e,t,r){var i=a[r.data.algorithm.curve.join(".")];if(!i)throw new Error("unknown curve "+r.data.algorithm.curve.join("."));var n=new o(i),s=r.data.subjectPrivateKey.data;return n.verify(t,e,s)}(e,t,h)}if("dsa"===h.type){if("dsa"!==l)throw new Error("wrong public key type");return function(e,t,r){var i=r.data.p,o=r.data.q,a=r.data.g,l=r.data.pub_key,u=s.signature.decode(e,"der"),h=u.s,d=u.r;c(h,o),c(d,o);var f=n.mont(i),p=h.invm(o),m=a.toRed(f).redPow(new n(t).mul(p).mod(o)).fromRed().mul(l.toRed(f).redPow(d.mul(p).mod(o)).fromRed()).mod(i).mod(o);return 0===m.cmp(d)}(e,t,h)}if("rsa"!==l&&"ecdsa/rsa"!==l)throw new Error("wrong public key type");t=r.concat([u,t]);for(var d=h.modulus.byteLength(),f=[1],p=0;t.length+f.length+2<d;)f.push(255),p++;f.push(0);for(var m=-1;++m<t.length;)f.push(t[m]);f=r.from(f);var g=n.mont(h.modulus);e=(e=new n(e).toRed(g)).redPow(new n(h.publicExponent)),e=r.from(e.fromRed().toArray());var v=p<8?1:0;for(d=Math.min(e.length,f.length),e.length!==f.length&&(v=1),m=-1;++m<d;)v|=e[m]^f[m];return 0===v}})),i.register("1R43x",(function(e,t){var r=i("awmEs").Buffer,n=i("dEDF4"),o=i("9s1Tb");e.exports=function(e){return new a(e)};var s={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function a(e){this.curveType=s[e],this.curveType||(this.curveType={name:e}),this.curve=new n.ec(this.curveType.name),this.keys=void 0}function c(e,t,i){Array.isArray(e)||(e=e.toArray());var n=new r(e);if(i&&n.length<i){var o=new r(i-n.length);o.fill(0),n=r.concat([o,n])}return t?n.toString(t):n}s.p224=s.secp224r1,s.p256=s.secp256r1=s.prime256v1,s.p192=s.secp192r1=s.prime192v1,s.p384=s.secp384r1,s.p521=s.secp521r1,a.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},a.prototype.computeSecret=function(e,t,i){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),c(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),i,this.curveType.byteLength)},a.prototype.getPublicKey=function(e,t){var r=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(r[r.length-1]%2?r[0]=7:r[0]=6),c(r,e)},a.prototype.getPrivateKey=function(e){return c(this.keys.getPrivate(),e)},a.prototype.setPublicKey=function(e,t){return t=t||"utf8",r.isBuffer(e)||(e=new r(e,t)),this.keys._importPublic(e),this},a.prototype.setPrivateKey=function(e,t){t=t||"utf8",r.isBuffer(e)||(e=new r(e,t));var i=new o(e);return i=i.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(i),this}})),i.register("9s1Tb",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,r,i){for(var n=0,o=Math.min(e.length,r),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r.strip()}o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);i=0!==(o=a>>>24-n&16777215)||s!==this.length-1?u[6-c.length]+c+i:c+i,(n+=2)>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],f=d[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:u[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,c="le"===t,l=new e(o),u=this.clone();if(c){for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[a]=s;for(;a<o;a++)l[a]=0}else{for(a=0;a<o-n;a++)l[a]=0;for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[o-a-1]=s}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),o.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r.strip()}(this,e,t):m(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},g.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},g.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},g.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},g.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),m(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function _(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function M(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(_,y),n(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new _;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return v[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new M(e)},n(M,E),M.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},M.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},M.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("8oudU",(function(t,r){var n,o,s,a;e(t.exports,"publicEncrypt",(()=>n),(e=>n=e)),e(t.exports,"privateDecrypt",(()=>o),(e=>o=e)),e(t.exports,"privateEncrypt",(()=>s),(e=>s=e)),e(t.exports,"publicDecrypt",(()=>a),(e=>a=e)),n=i("8czDH"),o=i("dyX7s"),s=function(e,t){return n(e,t,!0)},a=function(e,t){return o(e,t,!0)}})),i.register("8czDH",(function(e,t){var r=i("8sncL"),n=i("1oa4b"),o=i("eRLLs"),s=i("gd7QM"),a=i("ehVLm"),c=i("lE0OB"),l=i("3ppIS"),u=i("7wEKJ"),h=i("k0Rto").Buffer;e.exports=function(e,t,i){var d;d=e.padding?e.padding:i?1:4;var f,p=r(e);if(4===d)f=function(e,t){var r=e.modulus.byteLength(),i=t.length,l=o("sha1").update(h.alloc(0)).digest(),u=l.length,d=2*u;if(i>r-d-2)throw new Error("message too long");var f=h.alloc(r-i-d-2),p=r-u-1,m=n(u),g=a(h.concat([l,f,h.alloc(1,1),t],p),s(m,p)),v=a(m,s(g,u));return new c(h.concat([h.alloc(1),v,g],r))}(p,t);else if(1===d)f=function(e,t,r){var i,o=t.length,s=e.modulus.byteLength();if(o>s-11)throw new Error("message too long");i=r?h.alloc(s-o-3,255):function(e){var t,r=h.allocUnsafe(e),i=0,o=n(2*e),s=0;for(;i<e;)s===o.length&&(o=n(2*e),s=0),(t=o[s++])&&(r[i++]=t);return r}(s-o-3);return new c(h.concat([h.from([0,r?1:2]),i,h.alloc(1),t],s))}(p,t,i);else{if(3!==d)throw new Error("unknown padding");if((f=new c(t)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return i?u(f,p):l(f,p)}})),i.register("gd7QM",(function(e,t){var r=i("eRLLs"),n=i("k0Rto").Buffer;function o(e){var t=n.allocUnsafe(4);return t.writeUInt32BE(e,0),t}e.exports=function(e,t){for(var i,s=n.alloc(0),a=0;s.length<t;)i=o(a++),s=n.concat([s,r("sha1").update(e).update(i).digest()]);return s.slice(0,t)}})),i.register("ehVLm",(function(e,t){e.exports=function(e,t){for(var r=e.length,i=-1;++i<r;)e[i]^=t[i];return e}})),i.register("lE0OB",(function(e,t){!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function o(e,t,r){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i("4AFFV").Buffer}catch(e){}function a(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function c(e,t,r){var i=a(e,r);return r-1>=t&&(i|=a(e,r-1)<<4),i}function l(e,t,r,i){for(var n=0,o=Math.min(e.length,r),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var n=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<e.length&&(16===t?this._parseHex(e,n,i):(this._parseBase(e,t,n),"le"===i&&this._initArray(this.toArray(),t,i)))},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,o=0,s=0;if("be"===r)for(i=e.length-1;i>=t;i-=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)n=c(e,t,i)<<o,this.words[s]|=67108863&n,o>=18?(o-=18,s+=1,this.words[s]|=n>>>26):o+=8;this.strip()},o.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=t)i++;i--,n=n/t|0;for(var o=e.length-r,s=o%i,a=Math.min(o,o-s)+r,c=0,u=r;u<a;u+=i)c=l(e,u,u+i,t),this.imuln(n),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,r){r.negative=t.negative^e.negative;var i=e.length+t.length|0;r.length=i,i=i-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,c=s/67108864|0;r.words[0]=a;for(var l=1;l<i;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),f=Math.max(0,l-e.length+1);f<=d;f++){var p=l-f|0;u+=(s=(n=0|e.words[p])*(o=0|t.words[f])+h)/67108864|0,h=67108863&s}r.words[l]=0|h,c=0|u}return 0!==c?r.words[l]=0|c:r.length--,r.strip()}o.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],c=(16777215&(a<<n|o)).toString(16);i=0!==(o=a>>>24-n&16777215)||s!==this.length-1?u[6-c.length]+c+i:c+i,(n+=2)>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=h[e],f=d[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:u[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,c="le"===t,l=new e(o),u=this.clone();if(c){for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[a]=s;for(;a<o;a++)l[a]=0}else{for(a=0;a<o-n;a++)l[a]=0;for(a=0;!u.isZero();a++)s=u.andln(255),u.iushrn(8),l[o-a-1]=s}return l},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var i=0;i<r.length;i++)this.words[i]=t.words[i]^r.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t,r,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,i=e):(r=e,i=this);for(var n=0,o=0;o<i.length;o++)t=(0|r.words[o])+(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<r.length;o++)t=(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,i,n=this.cmp(e);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=e):(r=e,i=this);for(var o=0,s=0;s<i.length;s++)o=(t=(0|r.words[s])-(0|i.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)o=(t=(0|r.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var i,n,o,s=e.words,a=t.words,c=r.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,f=0|s[1],p=8191&f,m=f>>>13,g=0|s[2],v=8191&g,y=g>>>13,b=0|s[3],w=8191&b,_=b>>>13,S=0|s[4],E=8191&S,M=S>>>13,C=0|s[5],I=8191&C,T=C>>>13,k=0|s[6],R=8191&k,x=k>>>13,O=0|s[7],A=8191&O,P=O>>>13,D=0|s[8],L=8191&D,U=D>>>13,N=0|s[9],j=8191&N,B=N>>>13,F=0|a[0],K=8191&F,q=F>>>13,$=0|a[1],W=8191&$,V=$>>>13,H=0|a[2],G=8191&H,z=H>>>13,Y=0|a[3],J=8191&Y,Z=Y>>>13,Q=0|a[4],X=8191&Q,ee=Q>>>13,te=0|a[5],re=8191&te,ie=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],ce=8191&ae,le=ae>>>13,ue=0|a[8],he=8191&ue,de=ue>>>13,fe=0|a[9],pe=8191&fe,me=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(l+(i=Math.imul(h,K))|0)+((8191&(n=(n=Math.imul(h,q))+Math.imul(d,K)|0))<<13)|0;l=((o=Math.imul(d,q))+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(p,K),n=(n=Math.imul(p,q))+Math.imul(m,K)|0,o=Math.imul(m,q);var ve=(l+(i=i+Math.imul(h,W)|0)|0)+((8191&(n=(n=n+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((o=o+Math.imul(d,V)|0)+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(v,K),n=(n=Math.imul(v,q))+Math.imul(y,K)|0,o=Math.imul(y,q),i=i+Math.imul(p,W)|0,n=(n=n+Math.imul(p,V)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,V)|0;var ye=(l+(i=i+Math.imul(h,G)|0)|0)+((8191&(n=(n=n+Math.imul(h,z)|0)+Math.imul(d,G)|0))<<13)|0;l=((o=o+Math.imul(d,z)|0)+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(w,K),n=(n=Math.imul(w,q))+Math.imul(_,K)|0,o=Math.imul(_,q),i=i+Math.imul(v,W)|0,n=(n=n+Math.imul(v,V)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,V)|0,i=i+Math.imul(p,G)|0,n=(n=n+Math.imul(p,z)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,z)|0;var be=(l+(i=i+Math.imul(h,J)|0)|0)+((8191&(n=(n=n+Math.imul(h,Z)|0)+Math.imul(d,J)|0))<<13)|0;l=((o=o+Math.imul(d,Z)|0)+(n>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(E,K),n=(n=Math.imul(E,q))+Math.imul(M,K)|0,o=Math.imul(M,q),i=i+Math.imul(w,W)|0,n=(n=n+Math.imul(w,V)|0)+Math.imul(_,W)|0,o=o+Math.imul(_,V)|0,i=i+Math.imul(v,G)|0,n=(n=n+Math.imul(v,z)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,z)|0,i=i+Math.imul(p,J)|0,n=(n=n+Math.imul(p,Z)|0)+Math.imul(m,J)|0,o=o+Math.imul(m,Z)|0;var we=(l+(i=i+Math.imul(h,X)|0)|0)+((8191&(n=(n=n+Math.imul(h,ee)|0)+Math.imul(d,X)|0))<<13)|0;l=((o=o+Math.imul(d,ee)|0)+(n>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(I,K),n=(n=Math.imul(I,q))+Math.imul(T,K)|0,o=Math.imul(T,q),i=i+Math.imul(E,W)|0,n=(n=n+Math.imul(E,V)|0)+Math.imul(M,W)|0,o=o+Math.imul(M,V)|0,i=i+Math.imul(w,G)|0,n=(n=n+Math.imul(w,z)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,z)|0,i=i+Math.imul(v,J)|0,n=(n=n+Math.imul(v,Z)|0)+Math.imul(y,J)|0,o=o+Math.imul(y,Z)|0,i=i+Math.imul(p,X)|0,n=(n=n+Math.imul(p,ee)|0)+Math.imul(m,X)|0,o=o+Math.imul(m,ee)|0;var _e=(l+(i=i+Math.imul(h,re)|0)|0)+((8191&(n=(n=n+Math.imul(h,ie)|0)+Math.imul(d,re)|0))<<13)|0;l=((o=o+Math.imul(d,ie)|0)+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(R,K),n=(n=Math.imul(R,q))+Math.imul(x,K)|0,o=Math.imul(x,q),i=i+Math.imul(I,W)|0,n=(n=n+Math.imul(I,V)|0)+Math.imul(T,W)|0,o=o+Math.imul(T,V)|0,i=i+Math.imul(E,G)|0,n=(n=n+Math.imul(E,z)|0)+Math.imul(M,G)|0,o=o+Math.imul(M,z)|0,i=i+Math.imul(w,J)|0,n=(n=n+Math.imul(w,Z)|0)+Math.imul(_,J)|0,o=o+Math.imul(_,Z)|0,i=i+Math.imul(v,X)|0,n=(n=n+Math.imul(v,ee)|0)+Math.imul(y,X)|0,o=o+Math.imul(y,ee)|0,i=i+Math.imul(p,re)|0,n=(n=n+Math.imul(p,ie)|0)+Math.imul(m,re)|0,o=o+Math.imul(m,ie)|0;var Se=(l+(i=i+Math.imul(h,oe)|0)|0)+((8191&(n=(n=n+Math.imul(h,se)|0)+Math.imul(d,oe)|0))<<13)|0;l=((o=o+Math.imul(d,se)|0)+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul(A,K),n=(n=Math.imul(A,q))+Math.imul(P,K)|0,o=Math.imul(P,q),i=i+Math.imul(R,W)|0,n=(n=n+Math.imul(R,V)|0)+Math.imul(x,W)|0,o=o+Math.imul(x,V)|0,i=i+Math.imul(I,G)|0,n=(n=n+Math.imul(I,z)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,z)|0,i=i+Math.imul(E,J)|0,n=(n=n+Math.imul(E,Z)|0)+Math.imul(M,J)|0,o=o+Math.imul(M,Z)|0,i=i+Math.imul(w,X)|0,n=(n=n+Math.imul(w,ee)|0)+Math.imul(_,X)|0,o=o+Math.imul(_,ee)|0,i=i+Math.imul(v,re)|0,n=(n=n+Math.imul(v,ie)|0)+Math.imul(y,re)|0,o=o+Math.imul(y,ie)|0,i=i+Math.imul(p,oe)|0,n=(n=n+Math.imul(p,se)|0)+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0;var Ee=(l+(i=i+Math.imul(h,ce)|0)|0)+((8191&(n=(n=n+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((o=o+Math.imul(d,le)|0)+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(L,K),n=(n=Math.imul(L,q))+Math.imul(U,K)|0,o=Math.imul(U,q),i=i+Math.imul(A,W)|0,n=(n=n+Math.imul(A,V)|0)+Math.imul(P,W)|0,o=o+Math.imul(P,V)|0,i=i+Math.imul(R,G)|0,n=(n=n+Math.imul(R,z)|0)+Math.imul(x,G)|0,o=o+Math.imul(x,z)|0,i=i+Math.imul(I,J)|0,n=(n=n+Math.imul(I,Z)|0)+Math.imul(T,J)|0,o=o+Math.imul(T,Z)|0,i=i+Math.imul(E,X)|0,n=(n=n+Math.imul(E,ee)|0)+Math.imul(M,X)|0,o=o+Math.imul(M,ee)|0,i=i+Math.imul(w,re)|0,n=(n=n+Math.imul(w,ie)|0)+Math.imul(_,re)|0,o=o+Math.imul(_,ie)|0,i=i+Math.imul(v,oe)|0,n=(n=n+Math.imul(v,se)|0)+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,i=i+Math.imul(p,ce)|0,n=(n=n+Math.imul(p,le)|0)+Math.imul(m,ce)|0,o=o+Math.imul(m,le)|0;var Me=(l+(i=i+Math.imul(h,he)|0)|0)+((8191&(n=(n=n+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((o=o+Math.imul(d,de)|0)+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul(j,K),n=(n=Math.imul(j,q))+Math.imul(B,K)|0,o=Math.imul(B,q),i=i+Math.imul(L,W)|0,n=(n=n+Math.imul(L,V)|0)+Math.imul(U,W)|0,o=o+Math.imul(U,V)|0,i=i+Math.imul(A,G)|0,n=(n=n+Math.imul(A,z)|0)+Math.imul(P,G)|0,o=o+Math.imul(P,z)|0,i=i+Math.imul(R,J)|0,n=(n=n+Math.imul(R,Z)|0)+Math.imul(x,J)|0,o=o+Math.imul(x,Z)|0,i=i+Math.imul(I,X)|0,n=(n=n+Math.imul(I,ee)|0)+Math.imul(T,X)|0,o=o+Math.imul(T,ee)|0,i=i+Math.imul(E,re)|0,n=(n=n+Math.imul(E,ie)|0)+Math.imul(M,re)|0,o=o+Math.imul(M,ie)|0,i=i+Math.imul(w,oe)|0,n=(n=n+Math.imul(w,se)|0)+Math.imul(_,oe)|0,o=o+Math.imul(_,se)|0,i=i+Math.imul(v,ce)|0,n=(n=n+Math.imul(v,le)|0)+Math.imul(y,ce)|0,o=o+Math.imul(y,le)|0,i=i+Math.imul(p,he)|0,n=(n=n+Math.imul(p,de)|0)+Math.imul(m,he)|0,o=o+Math.imul(m,de)|0;var Ce=(l+(i=i+Math.imul(h,pe)|0)|0)+((8191&(n=(n=n+Math.imul(h,me)|0)+Math.imul(d,pe)|0))<<13)|0;l=((o=o+Math.imul(d,me)|0)+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul(j,W),n=(n=Math.imul(j,V))+Math.imul(B,W)|0,o=Math.imul(B,V),i=i+Math.imul(L,G)|0,n=(n=n+Math.imul(L,z)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,z)|0,i=i+Math.imul(A,J)|0,n=(n=n+Math.imul(A,Z)|0)+Math.imul(P,J)|0,o=o+Math.imul(P,Z)|0,i=i+Math.imul(R,X)|0,n=(n=n+Math.imul(R,ee)|0)+Math.imul(x,X)|0,o=o+Math.imul(x,ee)|0,i=i+Math.imul(I,re)|0,n=(n=n+Math.imul(I,ie)|0)+Math.imul(T,re)|0,o=o+Math.imul(T,ie)|0,i=i+Math.imul(E,oe)|0,n=(n=n+Math.imul(E,se)|0)+Math.imul(M,oe)|0,o=o+Math.imul(M,se)|0,i=i+Math.imul(w,ce)|0,n=(n=n+Math.imul(w,le)|0)+Math.imul(_,ce)|0,o=o+Math.imul(_,le)|0,i=i+Math.imul(v,he)|0,n=(n=n+Math.imul(v,de)|0)+Math.imul(y,he)|0,o=o+Math.imul(y,de)|0;var Ie=(l+(i=i+Math.imul(p,pe)|0)|0)+((8191&(n=(n=n+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;l=((o=o+Math.imul(m,me)|0)+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,i=Math.imul(j,G),n=(n=Math.imul(j,z))+Math.imul(B,G)|0,o=Math.imul(B,z),i=i+Math.imul(L,J)|0,n=(n=n+Math.imul(L,Z)|0)+Math.imul(U,J)|0,o=o+Math.imul(U,Z)|0,i=i+Math.imul(A,X)|0,n=(n=n+Math.imul(A,ee)|0)+Math.imul(P,X)|0,o=o+Math.imul(P,ee)|0,i=i+Math.imul(R,re)|0,n=(n=n+Math.imul(R,ie)|0)+Math.imul(x,re)|0,o=o+Math.imul(x,ie)|0,i=i+Math.imul(I,oe)|0,n=(n=n+Math.imul(I,se)|0)+Math.imul(T,oe)|0,o=o+Math.imul(T,se)|0,i=i+Math.imul(E,ce)|0,n=(n=n+Math.imul(E,le)|0)+Math.imul(M,ce)|0,o=o+Math.imul(M,le)|0,i=i+Math.imul(w,he)|0,n=(n=n+Math.imul(w,de)|0)+Math.imul(_,he)|0,o=o+Math.imul(_,de)|0;var Te=(l+(i=i+Math.imul(v,pe)|0)|0)+((8191&(n=(n=n+Math.imul(v,me)|0)+Math.imul(y,pe)|0))<<13)|0;l=((o=o+Math.imul(y,me)|0)+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(j,J),n=(n=Math.imul(j,Z))+Math.imul(B,J)|0,o=Math.imul(B,Z),i=i+Math.imul(L,X)|0,n=(n=n+Math.imul(L,ee)|0)+Math.imul(U,X)|0,o=o+Math.imul(U,ee)|0,i=i+Math.imul(A,re)|0,n=(n=n+Math.imul(A,ie)|0)+Math.imul(P,re)|0,o=o+Math.imul(P,ie)|0,i=i+Math.imul(R,oe)|0,n=(n=n+Math.imul(R,se)|0)+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,i=i+Math.imul(I,ce)|0,n=(n=n+Math.imul(I,le)|0)+Math.imul(T,ce)|0,o=o+Math.imul(T,le)|0,i=i+Math.imul(E,he)|0,n=(n=n+Math.imul(E,de)|0)+Math.imul(M,he)|0,o=o+Math.imul(M,de)|0;var ke=(l+(i=i+Math.imul(w,pe)|0)|0)+((8191&(n=(n=n+Math.imul(w,me)|0)+Math.imul(_,pe)|0))<<13)|0;l=((o=o+Math.imul(_,me)|0)+(n>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul(j,X),n=(n=Math.imul(j,ee))+Math.imul(B,X)|0,o=Math.imul(B,ee),i=i+Math.imul(L,re)|0,n=(n=n+Math.imul(L,ie)|0)+Math.imul(U,re)|0,o=o+Math.imul(U,ie)|0,i=i+Math.imul(A,oe)|0,n=(n=n+Math.imul(A,se)|0)+Math.imul(P,oe)|0,o=o+Math.imul(P,se)|0,i=i+Math.imul(R,ce)|0,n=(n=n+Math.imul(R,le)|0)+Math.imul(x,ce)|0,o=o+Math.imul(x,le)|0,i=i+Math.imul(I,he)|0,n=(n=n+Math.imul(I,de)|0)+Math.imul(T,he)|0,o=o+Math.imul(T,de)|0;var Re=(l+(i=i+Math.imul(E,pe)|0)|0)+((8191&(n=(n=n+Math.imul(E,me)|0)+Math.imul(M,pe)|0))<<13)|0;l=((o=o+Math.imul(M,me)|0)+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul(j,re),n=(n=Math.imul(j,ie))+Math.imul(B,re)|0,o=Math.imul(B,ie),i=i+Math.imul(L,oe)|0,n=(n=n+Math.imul(L,se)|0)+Math.imul(U,oe)|0,o=o+Math.imul(U,se)|0,i=i+Math.imul(A,ce)|0,n=(n=n+Math.imul(A,le)|0)+Math.imul(P,ce)|0,o=o+Math.imul(P,le)|0,i=i+Math.imul(R,he)|0,n=(n=n+Math.imul(R,de)|0)+Math.imul(x,he)|0,o=o+Math.imul(x,de)|0;var xe=(l+(i=i+Math.imul(I,pe)|0)|0)+((8191&(n=(n=n+Math.imul(I,me)|0)+Math.imul(T,pe)|0))<<13)|0;l=((o=o+Math.imul(T,me)|0)+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul(j,oe),n=(n=Math.imul(j,se))+Math.imul(B,oe)|0,o=Math.imul(B,se),i=i+Math.imul(L,ce)|0,n=(n=n+Math.imul(L,le)|0)+Math.imul(U,ce)|0,o=o+Math.imul(U,le)|0,i=i+Math.imul(A,he)|0,n=(n=n+Math.imul(A,de)|0)+Math.imul(P,he)|0,o=o+Math.imul(P,de)|0;var Oe=(l+(i=i+Math.imul(R,pe)|0)|0)+((8191&(n=(n=n+Math.imul(R,me)|0)+Math.imul(x,pe)|0))<<13)|0;l=((o=o+Math.imul(x,me)|0)+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul(j,ce),n=(n=Math.imul(j,le))+Math.imul(B,ce)|0,o=Math.imul(B,le),i=i+Math.imul(L,he)|0,n=(n=n+Math.imul(L,de)|0)+Math.imul(U,he)|0,o=o+Math.imul(U,de)|0;var Ae=(l+(i=i+Math.imul(A,pe)|0)|0)+((8191&(n=(n=n+Math.imul(A,me)|0)+Math.imul(P,pe)|0))<<13)|0;l=((o=o+Math.imul(P,me)|0)+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul(j,he),n=(n=Math.imul(j,de))+Math.imul(B,he)|0,o=Math.imul(B,de);var Pe=(l+(i=i+Math.imul(L,pe)|0)|0)+((8191&(n=(n=n+Math.imul(L,me)|0)+Math.imul(U,pe)|0))<<13)|0;l=((o=o+Math.imul(U,me)|0)+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var De=(l+(i=Math.imul(j,pe))|0)+((8191&(n=(n=Math.imul(j,me))+Math.imul(B,pe)|0))<<13)|0;return l=((o=Math.imul(B,me))+(n>>>13)|0)+(De>>>26)|0,De&=67108863,c[0]=ge,c[1]=ve,c[2]=ye,c[3]=be,c[4]=we,c[5]=_e,c[6]=Se,c[7]=Ee,c[8]=Me,c[9]=Ce,c[10]=Ie,c[11]=Te,c[12]=ke,c[13]=Re,c[14]=xe,c[15]=Oe,c[16]=Ae,c[17]=Pe,c[18]=De,0!==l&&(c[19]=l,r.length++),r};function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),o.prototype.mulTo=function(e,t){var r,i=this.length+e.length;return r=10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var i=0,n=0,o=0;o<r.length-1;o++){var s=n;n=0;for(var a=67108863&i,c=Math.min(o,t.length-1),l=Math.max(0,o-e.length+1);l<=c;l++){var u=o-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;a=67108863&(d=d+a|0),n+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}r.words[o]=a,i=s,s=n}return 0!==i?r.words[o]=i:r.length--,r.strip()}(this,e,t):m(this,e,t),r},g.prototype.makeRBT=function(e){for(var t=new Array(e),r=o.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var i=0,n=0;n<t;n++)i|=(1&e)<<t-n-1,e>>=1;return i},g.prototype.permute=function(e,t,r,i,n,o){for(var s=0;s<o;s++)i[s]=t[e[s]],n[s]=r[e[s]]},g.prototype.transform=function(e,t,r,i,n,o){this.permute(o,e,t,r,i,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,c=Math.cos(2*Math.PI/a),l=Math.sin(2*Math.PI/a),u=0;u<n;u+=a)for(var h=c,d=l,f=0;f<s;f++){var p=r[u+f],m=i[u+f],g=r[u+f+s],v=i[u+f+s],y=h*g-d*v;v=h*v+d*g,g=y,r[u+f]=p+g,i[u+f]=m+v,r[u+f+s]=p-g,i[u+f+s]=m-v,f!==a&&(y=c*h-l*d,d=c*d+l*h,h=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=e[i];e[i]=e[r-i-1],e[r-i-1]=n,n=t[i],t[i]=-t[r-i-1],t[r-i-1]=-n}},g.prototype.normalize13b=function(e,t){for(var r=0,i=0;i<t/2;i++){var n=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+r;e[i]=67108863&n,r=n<67108864?0:n/67108864|0}return e},g.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},g.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var i=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(i),o=this.stub(i),s=new Array(i),a=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),h=new Array(i),d=r.words;d.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,o,a,c,i,n),this.transform(l,o,u,h,i,n);for(var f=0;f<i;f++){var p=a[f]*u[f]-c[f]*h[f];c[f]=a[f]*h[f]+c[f]*u[f],a[f]=p}return this.conjugate(a,c,i),this.transform(a,c,d,o,i,n),this.conjugate(d,o,i),this.normalize13b(d,i),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),m(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var i=r/26|0,n=r%26;t[r]=(e.words[i]&1<<n)>>>n}return t}(e);if(0===t.length)return new o(1);for(var r=this,i=0;i<t.length&&0===t[i];i++,r=r.sqr());if(++i<t.length)for(var n=r.sqr();i<t.length;i++,n=n.sqr())0!==t[i]&&(r=r.mul(n));return r},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,c=(0|this.words[t])-a<<i;this.words[t]=c|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){var n;r("number"==typeof e&&e>=0),n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,c=i;if(n-=s,n=Math.max(0,n),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=n);l--){var h=0|this.words[l];this.words[l]=u<<26-o|h>>>o,u=h&a}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o,s=e.length+i;this._expand(s);var a=0;for(n=0;n<e.length;n++){o=(0|this.words[n+i])+a;var c=(0|e.words[n])*t;a=((o-=67108863&c)>>26)-(c/67108864|0),this.words[n+i]=67108863&o}for(;n<this.length-i;n++)a=(o=(0|this.words[n+i])+a)>>26,this.words[n+i]=67108863&o;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)a=(o=-(0|this.words[n])+a)>>26,this.words[n]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var r=(this.length,e.length),i=this.clone(),n=e,s=0|n.words[n.length-1];0!==(r=26-this._countBits(s))&&(n=n.ushln(r),i.iushln(r),s=0|n.words[n.length-1]);var a,c=i.length-n.length;if("mod"!==t){(a=new o(null)).length=c+1,a.words=new Array(a.length);for(var l=0;l<a.length;l++)a.words[l]=0}var u=i.clone()._ishlnsubmul(n,1,c);0===u.negative&&(i=u,a&&(a.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|i.words[n.length+h])+(0|i.words[n.length+h-1]);for(d=Math.min(d/s|0,67108863),i._ishlnsubmul(n,d,h);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,h),i.isZero()||(i.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),i.strip(),"div"!==t&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},o.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t);var n,s,a},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),n=e.andln(1),o=r.cmp(i);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=67108864%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),c=new o(1),l=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++l;for(var u=i.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(u),s.isub(h)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(u),c.isub(h)),a.iushrn(1),c.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(c)):(i.isub(t),a.isub(n),c.isub(s))}return{a:a,b:c,gcd:i.iushln(l)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n,s=new o(1),a=new o(0),c=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(i.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(i.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(a)):(i.isub(t),a.isub(s))}return(n=0===t.cmpn(1)?s:a).cmpn(0)<0&&n.iadd(e),n},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var i=0;t.isEven()&&r.isEven();i++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=t.cmp(r);if(n<0){var o=t;t=r,r=o}else if(0===n||0===r.cmpn(1))break;t.isub(r)}return r.iushln(i)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];t=n===e?0:n<e?-1:1}return 0!==this.negative?0|-t:t},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|e.words[r];if(i!==n){i<n?t=-1:i>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new E(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function _(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function E(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function M(e){E.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},n(b,y),b.prototype.split=function(e,t){for(var r=4194303,i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var o=e.words[9];for(t.words[t.length++]=o&r,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(s&r)<<4|o>>>22,o=s}o>>>=22,e.words[n-10]=o,0===o&&e.length>10?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var i=0|e.words[r];t+=977*i,e.words[r]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(w,y),n(_,y),n(S,y),S.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var i=19*(0|e.words[r])+t,n=67108863&i;i>>>=26,e.words[r]=n,t=i}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new w;else if("p192"===e)t=new _;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return v[e]=t,t},E.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},E.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},E.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},E.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},E.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},E.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},E.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},E.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},E.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},E.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},E.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},E.prototype.isqr=function(e){return this.imul(e,e.clone())},E.prototype.sqr=function(e){return this.mul(e,e)},E.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),c=a.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new o(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,n),d=this.pow(e,n.addn(1).iushrn(1)),f=this.pow(e,n),p=s;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(h,new o(1).iushln(p-g-1));d=d.redMul(v),h=v.redSqr(),f=f.redMul(h),p=g}return d},E.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},E.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=e;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],e);var n=r[0],s=0,a=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var h=l>>u&1;n!==r[0]&&(n=this.sqr(n)),0!==h||0!==s?(s<<=1,s|=h,(4===++a||0===i&&0===u)&&(n=this.mul(n,r[s]),a=0,s=0)):a=0}c=26}return n},E.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},E.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new M(e)},n(M,E),M.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},M.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},M.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var r=e.mul(t),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)})),i.register("3ppIS",(function(e,t){var r=i("lE0OB"),n=i("k0Rto").Buffer;e.exports=function(e,t){return n.from(e.toRed(r.mont(t.modulus)).redPow(new r(t.publicExponent)).fromRed().toArray())}})),i.register("dyX7s",(function(e,t){var r=i("8sncL"),n=i("gd7QM"),o=i("ehVLm"),s=i("lE0OB"),a=i("7wEKJ"),c=i("eRLLs"),l=i("3ppIS"),u=i("k0Rto").Buffer;e.exports=function(e,t,i){var h;h=e.padding?e.padding:i?1:4;var d,f=r(e),p=f.modulus.byteLength();if(t.length>p||new s(t).cmp(f.modulus)>=0)throw new Error("decryption error");d=i?l(new s(t),f):a(t,f);var m=u.alloc(p-d.length);if(d=u.concat([m,d],p),4===h)return function(e,t){var r=e.modulus.byteLength(),i=c("sha1").update(u.alloc(0)).digest(),s=i.length;if(0!==t[0])throw new Error("decryption error");var a=t.slice(1,s+1),l=t.slice(s+1),h=o(a,n(l,s)),d=o(l,n(h,r-s-1));if(function(e,t){e=u.from(e),t=u.from(t);var r=0,i=e.length;e.length!==t.length&&(r++,i=Math.min(e.length,t.length));var n=-1;for(;++n<i;)r+=e[n]^t[n];return r}(i,d.slice(0,s)))throw new Error("decryption error");var f=s;for(;0===d[f];)f++;if(1!==d[f++])throw new Error("decryption error");return d.slice(f)}(f,d);if(1===h)return function(e,t,r){var i=t.slice(0,2),n=2,o=0;for(;0!==t[n++];)if(n>=t.length){o++;break}var s=t.slice(2,n-1);("0002"!==i.toString("hex")&&!r||"0001"!==i.toString("hex")&&r)&&o++;s.length<8&&o++;if(o)throw new Error("decryption error");return t.slice(n)}(0,d,i);if(3===h)return d;throw new Error("unknown padding")}})),i.register("bxyoK",(function(t,n){var o,s;e(t.exports,"randomFill",(()=>o),(e=>o=e)),e(t.exports,"randomFillSync",(()=>s),(e=>s=e));var a=i("9Mq5w");function c(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var l=i("k0Rto"),u=(i("1oa4b"),l.Buffer),h=l.kMaxLength,d=r.crypto||r.msCrypto,f=Math.pow(2,32)-1;function p(e,t){if("number"!=typeof e||e!=e)throw new TypeError("offset must be a number");if(e>f||e<0)throw new TypeError("offset must be a uint32");if(e>h||e>t)throw new RangeError("offset out of range")}function m(e,t,r){if("number"!=typeof e||e!=e)throw new TypeError("size must be a number");if(e>f||e<0)throw new TypeError("size must be a uint32");if(e+t>r||e>h)throw new RangeError("buffer too small")}function g(e,t,r,i){var n=e.buffer,o=new Uint8Array(n,t,r);if(d.getRandomValues(o),!i)return e;a.nextTick((function(){i(null,e)}))}d&&d.getRandomValues?(o=function(e,t,i,n){if(!(u.isBuffer(e)||e instanceof r.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof t)n=t,t=0,i=e.length;else if("function"==typeof i)n=i,i=e.length-t;else if("function"!=typeof n)throw new TypeError('"cb" argument must be a function');return p(t,e.length),m(i,t,e.length),g(e,t,i,n)},s=function(e,t,i){void 0===t&&(t=0);if(!(u.isBuffer(e)||e instanceof r.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');p(t,e.length),void 0===i&&(i=e.length-t);return m(i,t,e.length),g(e,t,i)}):(o=c,s=c)})),i.register("gOtyk",(function(e,t){var r=i("9Mq5w"),n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},i=0;i<t.length;i++)r[t[i]]=Object.getOwnPropertyDescriptor(e,t[i]);return r},o=/%[sdj%]/g;e.exports.format=function(e){if(!y(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}r=1;for(var i=arguments,n=i.length,s=String(e).replace(o,(function(e){if("%%"===e)return"%";if(r>=n)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}})),a=i[r];r<n;a=i[++r])g(a)||!_(a)?s+=" "+a:s+=" "+c(a);return s},e.exports.deprecate=function(t,i){if(void 0!==r&&!0===r.noDeprecation)return t;if(void 0===r)return function(){return e.exports.deprecate(t,i).apply(this,arguments)};var n=!1;return function(){if(!n){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),n=!0}return t.apply(this,arguments)}};var s={},a=/^$/;function c(t,r){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),m(r)?i.showHidden=r:r&&e.exports._extend(i,r),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),h(i,t,i.depth)}function l(e,t){var r=c.styles[t];return r?"["+c.colors[r][0]+"m"+e+"["+c.colors[r][1]+"m":e}function u(e,t){return e}function h(t,r,i){if(t.customInspect&&r&&M(r.inspect)&&r.inspect!==e.exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(i,t);return y(n)||(n=h(t,n,i)),n}var o=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(y(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(v(t))return e.stylize(""+t,"number");if(m(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(t,r);if(o)return o;var s=Object.keys(r),a=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(r)),E(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(r);if(0===s.length){if(M(r)){var c=r.name?": "+r.name:"";return t.stylize("[Function"+c+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(S(r))return t.stylize(Date.prototype.toString.call(r),"date");if(E(r))return d(r)}var l,u="",_=!1,C=["{","}"];(p(r)&&(_=!0,C=["[","]"]),M(r))&&(u=" [Function"+(r.name?": "+r.name:"")+"]");return w(r)&&(u=" "+RegExp.prototype.toString.call(r)),S(r)&&(u=" "+Date.prototype.toUTCString.call(r)),E(r)&&(u=" "+d(r)),0!==s.length||_&&0!=r.length?i<0?w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=_?function(e,t,r,i,n){for(var o=[],s=0,a=t.length;s<a;++s)k(t,String(s))?o.push(f(e,t,r,i,String(s),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(f(e,t,r,i,n,!0))})),o}(t,r,i,a,s):s.map((function(e){return f(t,r,i,a,e,_)})),t.seen.pop(),function(e,t,r){var i=e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return i>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(l,u,C)):C[0]+u+C[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,i,n,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),k(i,n)||(s="["+n+"]"),a||(e.seen.indexOf(c.value)<0?(a=g(r)?h(e,c.value,null):h(e,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").slice(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),b(s)){if(o&&n.match(/^\d+$/))return a;(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.slice(1,-1),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return void 0===e}function w(e){return _(e)&&"[object RegExp]"===C(e)}function _(e){return"object"==typeof e&&null!==e}function S(e){return _(e)&&"[object Date]"===C(e)}function E(e){return _(e)&&("[object Error]"===C(e)||e instanceof Error)}function M(e){return"function"==typeof e}function C(e){return Object.prototype.toString.call(e)}function I(e){return e<10?"0"+e.toString(10):e.toString(10)}e.exports.debuglog=function(t){if(t=t.toUpperCase(),!s[t])if(a.test(t)){var i=r.pid;s[t]=function(){var r=e.exports.format.apply(e.exports,arguments);console.error("%s %d: %s",t,i,r)}}else s[t]=function(){};return s[t]},e.exports.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.exports.types=i("aBLNt"),e.exports.isArray=p,e.exports.isBoolean=m,e.exports.isNull=g,e.exports.isNullOrUndefined=function(e){return null==e},e.exports.isNumber=v,e.exports.isString=y,e.exports.isSymbol=function(e){return"symbol"==typeof e},e.exports.isUndefined=b,e.exports.isRegExp=w,e.exports.types.isRegExp=w,e.exports.isObject=_,e.exports.isDate=S,e.exports.types.isDate=S,e.exports.isError=E,e.exports.types.isNativeError=E,e.exports.isFunction=M,e.exports.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},e.exports.isBuffer=i("90FXD");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports.log=function(){var t,r;console.log("%s - %s",(t=new Date,r=[I(t.getHours()),I(t.getMinutes()),I(t.getSeconds())].join(":"),[t.getDate(),T[t.getMonth()],r].join(" ")),e.exports.format.apply(e.exports,arguments))},e.exports.inherits=i("6cuMU"),e.exports._extend=function(e,t){if(!t||!_(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function x(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}e.exports.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(R&&e[R]){var t;if("function"!=typeof(t=e[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,i=new Promise((function(e,i){t=e,r=i})),n=[],o=0;o<arguments.length;o++)n.push(arguments[o]);n.push((function(e,i){e?r(e):t(i)}));try{e.apply(this,n)}catch(e){r(e)}return i}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),R&&Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},e.exports.promisify.custom=R,e.exports.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i]);var n=t.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var o=this,s=function(){return n.apply(o,arguments)};e.apply(this,t).then((function(e){r.nextTick(s.bind(null,null,e))}),(function(e){r.nextTick(x.bind(null,e,s))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,n(e)),t}})),i.register("aBLNt",(function(e,t){var r=i("jeAAD"),n=i("605Ic"),o=i("5x9jo"),s=i("dYVlV");function a(e){return e.call.bind(e)}var c="undefined"!=typeof BigInt,l="undefined"!=typeof Symbol,u=a(Object.prototype.toString),h=a(Number.prototype.valueOf),d=a(String.prototype.valueOf),f=a(Boolean.prototype.valueOf);if(c)var p=a(BigInt.prototype.valueOf);if(l)var m=a(Symbol.prototype.valueOf);function g(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function v(e){return"[object Map]"===u(e)}function y(e){return"[object Set]"===u(e)}function b(e){return"[object WeakMap]"===u(e)}function w(e){return"[object WeakSet]"===u(e)}function _(e){return"[object ArrayBuffer]"===u(e)}function S(e){return"undefined"!=typeof ArrayBuffer&&(_.working?_(e):e instanceof ArrayBuffer)}function E(e){return"[object DataView]"===u(e)}function M(e){return"undefined"!=typeof DataView&&(E.working?E(e):e instanceof DataView)}e.exports.isArgumentsObject=r,e.exports.isGeneratorFunction=n,e.exports.isTypedArray=s,e.exports.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},e.exports.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):s(e)||M(e)},e.exports.isUint8Array=function(e){return"Uint8Array"===o(e)},e.exports.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===o(e)},e.exports.isUint16Array=function(e){return"Uint16Array"===o(e)},e.exports.isUint32Array=function(e){return"Uint32Array"===o(e)},e.exports.isInt8Array=function(e){return"Int8Array"===o(e)},e.exports.isInt16Array=function(e){return"Int16Array"===o(e)},e.exports.isInt32Array=function(e){return"Int32Array"===o(e)},e.exports.isFloat32Array=function(e){return"Float32Array"===o(e)},e.exports.isFloat64Array=function(e){return"Float64Array"===o(e)},e.exports.isBigInt64Array=function(e){return"BigInt64Array"===o(e)},e.exports.isBigUint64Array=function(e){return"BigUint64Array"===o(e)},v.working="undefined"!=typeof Map&&v(new Map),e.exports.isMap=function(e){return"undefined"!=typeof Map&&(v.working?v(e):e instanceof Map)},y.working="undefined"!=typeof Set&&y(new Set),e.exports.isSet=function(e){return"undefined"!=typeof Set&&(y.working?y(e):e instanceof Set)},b.working="undefined"!=typeof WeakMap&&b(new WeakMap),e.exports.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(b.working?b(e):e instanceof WeakMap)},w.working="undefined"!=typeof WeakSet&&w(new WeakSet),e.exports.isWeakSet=function(e){return w(e)},_.working="undefined"!=typeof ArrayBuffer&&_(new ArrayBuffer),e.exports.isArrayBuffer=S,E.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&E(new DataView(new ArrayBuffer(1),0,1)),e.exports.isDataView=M;var C="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function I(e){return"[object SharedArrayBuffer]"===u(e)}function T(e){return void 0!==C&&(void 0===I.working&&(I.working=I(new C)),I.working?I(e):e instanceof C)}function k(e){return g(e,h)}function R(e){return g(e,d)}function x(e){return g(e,f)}function O(e){return c&&g(e,p)}function A(e){return l&&g(e,m)}e.exports.isSharedArrayBuffer=T,e.exports.isAsyncFunction=function(e){return"[object AsyncFunction]"===u(e)},e.exports.isMapIterator=function(e){return"[object Map Iterator]"===u(e)},e.exports.isSetIterator=function(e){return"[object Set Iterator]"===u(e)},e.exports.isGeneratorObject=function(e){return"[object Generator]"===u(e)},e.exports.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===u(e)},e.exports.isNumberObject=k,e.exports.isStringObject=R,e.exports.isBooleanObject=x,e.exports.isBigIntObject=O,e.exports.isSymbolObject=A,e.exports.isBoxedPrimitive=function(e){return k(e)||R(e)||x(e)||O(e)||A(e)},e.exports.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(S(e)||T(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(t){Object.defineProperty(e.exports,t,{enumerable:!1,value:function(){throw new Error(t+" is not supported in userland")}})}))})),i.register("jeAAD",(function(e,t){var r=i("62xi1")(),n=i("bh6VG")("Object.prototype.toString"),o=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===n(e)},s=function(e){return!!o(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==n(e)&&"[object Function]"===n(e.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=s,e.exports=a?o:s})),i.register("62xi1",(function(e,t){var r=i("lrNgj");e.exports=function(){return r()&&!!Symbol.toStringTag}})),i.register("lrNgj",(function(e,t){e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(e,t);if(42!==n.value||!0!==n.enumerable)return!1}return!0}})),i.register("bh6VG",(function(e,t){var r=i("k0uab"),n=i("ah9HS"),o=n(r("String.prototype.indexOf"));e.exports=function(e,t){var i=r(e,!!t);return"function"==typeof i&&o(e,".prototype.")>-1?n(i):i}})),i.register("k0uab",(function(e,t){var r,n=SyntaxError,o=Function,s=TypeError,a=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new s},u=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,h=i("1tMgc")(),d=Object.getPrototypeOf||function(e){return e.__proto__},f={},p="undefined"==typeof Uint8Array?r:d(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h?d([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?d(d([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?d((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?d((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?d(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":n,"%ThrowTypeError%":u,"%TypedArray%":p,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};try{null.error}catch(e){var g=d(d(e));m["%Error.prototype%"]=g}var v=function e(t){var r;if("%AsyncFunction%"===t)r=a("async function () {}");else if("%GeneratorFunction%"===t)r=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=a("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var n=e("%AsyncGenerator%");n&&(r=d(n.prototype))}return m[t]=r,r},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i("6gIY6"),w=i("4ebPq"),_=b.call(Function.call,Array.prototype.concat),S=b.call(Function.apply,Array.prototype.splice),E=b.call(Function.call,String.prototype.replace),M=b.call(Function.call,String.prototype.slice),C=b.call(Function.call,RegExp.prototype.exec),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,k=function(e){var t=M(e,0,1),r=M(e,-1);if("%"===t&&"%"!==r)throw new n("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new n("invalid intrinsic syntax, expected opening `%`");var i=[];return E(e,I,(function(e,t,r,n){i[i.length]=r?E(n,T,"$1"):t||e})),i},R=function(e,t){var r,i=e;if(w(y,i)&&(i="%"+(r=y[i])[0]+"%"),w(m,i)){var o=m[i];if(o===f&&(o=v(i)),void 0===o&&!t)throw new s("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:o}}throw new n("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new s('"allowMissing" argument must be a boolean');if(null===C(/^%?[^%]*%?$/,e))throw new n("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=k(e),i=r.length>0?r[0]:"",o=R("%"+i+"%",t),a=o.name,l=o.value,u=!1,h=o.alias;h&&(i=h[0],S(r,_([0,1],h)));for(var d=1,f=!0;d<r.length;d+=1){var p=r[d],g=M(p,0,1),v=M(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===v||"'"===v||"`"===v)&&g!==v)throw new n("property names with quotes must have matching quotes");if("constructor"!==p&&f||(u=!0),w(m,a="%"+(i+="."+p)+"%"))l=m[a];else if(null!=l){if(!(p in l)){if(!t)throw new s("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&d+1>=r.length){var y=c(l,p);l=(f=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[p]}else f=w(l,p),l=l[p];f&&!u&&(m[a]=l)}}return l}})),i.register("1tMgc",(function(e,t){var r="undefined"!=typeof Symbol&&Symbol,n=i("lrNgj");e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&n())))}})),i.register("6gIY6",(function(e,t){var r=i("5q2Au");e.exports=Function.prototype.bind||r})),i.register("5q2Au",(function(e,t){var r="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,n=Object.prototype.toString,o="[object Function]";e.exports=function(e){var t=this;if("function"!=typeof t||n.call(t)!==o)throw new TypeError(r+t);for(var s,a=i.call(arguments,1),c=Math.max(0,t.length-a.length),l=[],u=0;u<c;u++)l.push("$"+u);if(s=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var r=t.apply(this,a.concat(i.call(arguments)));return Object(r)===r?r:this}return t.apply(e,a.concat(i.call(arguments)))})),t.prototype){var h=function(){};h.prototype=t.prototype,s.prototype=new h,h.prototype=null}return s}})),i.register("4ebPq",(function(e,t){var r=i("6gIY6");e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)})),i.register("ah9HS",(function(e,t){var r=i("6gIY6"),n=i("k0uab"),o=n("%Function.prototype.apply%"),s=n("%Function.prototype.call%"),a=n("%Reflect.apply%",!0)||r.call(s,o),c=n("%Object.getOwnPropertyDescriptor%",!0),l=n("%Object.defineProperty%",!0),u=n("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=a(r,s,arguments);c&&l&&(c(t,"length").configurable&&l(t,"length",{value:1+u(0,e.length-(arguments.length-1))}));return t};var h=function(){return a(r,o,arguments)};l?l(e.exports,"apply",{value:h}):e.exports.apply=h})),i.register("605Ic",(function(e,t){var r,n=Object.prototype.toString,o=Function.prototype.toString,s=/^\s*(?:function)?\*/,a=i("62xi1")(),c=Object.getPrototypeOf;e.exports=function(e){if("function"!=typeof e)return!1;if(s.test(o.call(e)))return!0;if(!a)return"[object GeneratorFunction]"===n.call(e);if(!c)return!1;if(void 0===r){var t=function(){if(!a)return!1;try{return Function("return function*() {}")()}catch(e){}}();r=!!t&&c(t)}return c(e)===r}})),i.register("5x9jo",(function(e,t){var n=i("6Y9zB"),o=i("bfDOD"),s=i("bh6VG"),a=i("8Wg0p"),c=s("Object.prototype.toString"),l=i("62xi1")(),u="undefined"==typeof globalThis?r:globalThis,h=o(),d=s("String.prototype.slice"),f={},p=Object.getPrototypeOf;l&&a&&p&&n(h,(function(e){if("function"==typeof u[e]){var t=new u[e];if(Symbol.toStringTag in t){var r=p(t),i=a(r,Symbol.toStringTag);if(!i){var n=p(r);i=a(n,Symbol.toStringTag)}f[e]=i.get}}}));var m=i("dYVlV");e.exports=function(e){return!!m(e)&&(l&&Symbol.toStringTag in e?function(e){var t=!1;return n(f,(function(r,i){if(!t)try{var n=r.call(e);n===i&&(t=n)}catch(e){}})),t}(e):d(c(e),8,-1))}})),i.register("6Y9zB",(function(e,t){var r=i("fSmyv"),n=Object.prototype.toString,o=Object.prototype.hasOwnProperty,s=function(e,t,r){for(var i=0,n=e.length;i<n;i++)o.call(e,i)&&(null==r?t(e[i],i,e):t.call(r,e[i],i,e))},a=function(e,t,r){for(var i=0,n=e.length;i<n;i++)null==r?t(e.charAt(i),i,e):t.call(r,e.charAt(i),i,e)},c=function(e,t,r){for(var i in e)o.call(e,i)&&(null==r?t(e[i],i,e):t.call(r,e[i],i,e))};e.exports=function(e,t,i){if(!r(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=i),"[object Array]"===n.call(e)?s(e,t,o):"string"==typeof e?a(e,t,o):c(e,t,o)}})),i.register("fSmyv",(function(e,t){var r,i,n=Function.prototype.toString,o="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof o&&"function"==typeof Object.defineProperty)try{r=Object.defineProperty({},"length",{get:function(){throw i}}),i={},o((function(){throw 42}),null,r)}catch(e){e!==i&&(o=null)}else o=null;var s=/^\s*class\b/,a=function(e){try{var t=n.call(e);return s.test(t)}catch(e){return!1}},c=function(e){try{return!a(e)&&(n.call(e),!0)}catch(e){return!1}},l=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,h=!(0 in[,]),d=function(){return!1};if("object"==typeof document){var f=document.all;l.call(f)===l.call(document.all)&&(d=function(e){if((h||!e)&&(void 0===e||"object"==typeof e))try{var t=l.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}e.exports=o?function(e){if(d(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{o(e,null,r)}catch(e){if(e!==i)return!1}return!a(e)&&c(e)}:function(e){if(d(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(u)return c(e);if(a(e))return!1;var t=l.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&c(e)}})),i.register("bfDOD",(function(e,t){var i=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],n="undefined"==typeof globalThis?r:globalThis;e.exports=function(){for(var e=[],t=0;t<i.length;t++)"function"==typeof n[i[t]]&&(e[e.length]=i[t]);return e}})),i.register("8Wg0p",(function(e,t){var r=i("k0uab")("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r})),i.register("dYVlV",(function(e,t){var n=i("6Y9zB"),o=i("bfDOD"),s=i("bh6VG"),a=s("Object.prototype.toString"),c=i("62xi1")(),l=i("8Wg0p"),u="undefined"==typeof globalThis?r:globalThis,h=o(),d=s("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return-1},f=s("String.prototype.slice"),p={},m=Object.getPrototypeOf;c&&l&&m&&n(h,(function(e){var t=new u[e];if(Symbol.toStringTag in t){var r=m(t),i=l(r,Symbol.toStringTag);if(!i){var n=m(r);i=l(n,Symbol.toStringTag)}p[e]=i.get}}));e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!c||!(Symbol.toStringTag in e)){var t=f(a(e),8,-1);return d(h,t)>-1}return!!l&&function(e){var t=!1;return n(p,(function(r,i){if(!t)try{t=r.call(e)===i}catch(e){}})),t}(e)}})),i.register("90FXD",(function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}})),i.register("91Av2",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EncryptionSetupOperation=e.exports.EncryptionSetupBuilder=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("7BSj1"),a=i("hclBt"),c=i("gH6iW"),l=i("cH9or"),u=i("5pxqF"),h=i("75Qdj");e.exports.EncryptionSetupBuilder=class{constructor(e,t){(0,n.default)(this,"accountDataClientAdapter",void 0),(0,n.default)(this,"crossSigningCallbacks",void 0),(0,n.default)(this,"ssssCryptoCallbacks",void 0),(0,n.default)(this,"crossSigningKeys",void 0),(0,n.default)(this,"keySignatures",void 0),(0,n.default)(this,"keyBackupInfo",void 0),(0,n.default)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new f(e),this.crossSigningCallbacks=new p,this.ssssCryptoCallbacks=new m(t)}addCrossSigningKeys(e,t){this.crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this.keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this.sessionBackupPrivateKey=e}addKeySignature(e,t,r){this.keySignatures||(this.keySignatures={});const i=this.keySignatures[e]||{};this.keySignatures[e]=i,i[t]=r}async setAccountData(e,t){await this.accountDataClientAdapter.setAccountData(e,t)}buildOperation(){const e=this.accountDataClientAdapter.values;return new d(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}async persist(e){if(this.crossSigningKeys){const r=(0,a.createCryptoStoreCacheCallbacks)(e.cryptoStore,e.olmDevice);for(const e of["master","self_signing","user_signing"]){var t;o.logger.log(`Cache ${e} cross-signing private key locally`);const i=this.crossSigningCallbacks.privateKeys.get(e);await(null===(t=r.storeCrossSigningKeyCache)||void 0===t?void 0:t.call(r,e,i))}await e.cryptoStore.doTxn("readwrite",[c.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.cryptoStore.storeCrossSigningKeys(t,this.crossSigningKeys.keys)}))}this.sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey)}};class d{constructor(e,t,r,i){this.accountData=e,this.crossSigningKeys=t,this.keyBackupInfo=r,this.keySignatures=i}async apply(e){const t=e.baseApis;if(this.crossSigningKeys){var r,i;const n={};for(const[e,t]of Object.entries(this.crossSigningKeys.keys))n[e+"_key"]=t;await(null===(r=(i=this.crossSigningKeys).authUpload)||void 0===r?void 0:r.call(i,(e=>t.uploadDeviceSigningKeys(e,n)))),e.crossSigningInfo.setKeys(this.crossSigningKeys.keys)}if(this.accountData)for(const[e,r]of this.accountData)await t.setAccountData(e,r);this.keySignatures&&await t.uploadKeySignatures(this.keySignatures),this.keyBackupInfo&&(this.keyBackupInfo.version?await t.http.authedRequest(l.Method.Put,"/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:l.ClientPrefix.V3}):await t.http.authedRequest(l.Method.Post,"/room_keys/version",void 0,this.keyBackupInfo,{prefix:l.ClientPrefix.V3}))}}e.exports.EncryptionSetupOperation=d;class f extends h.TypedEventEmitter{constructor(e){super(),this.existingValues=e,(0,n.default)(this,"values",new Map)}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const t=this.values.get(e);if(t)return t;const r=this.existingValues[e];return r?r.getContent():null}setAccountData(e,t){const r=this.values.get(e);return this.values.set(e,t),Promise.resolve().then((()=>{const i=new s.MatrixEvent({type:e,content:t});return this.emit(u.ClientEvent.AccountData,i,r),{}}))}}class p{constructor(){(0,n.default)(this,"privateKeys",new Map)}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){var r;return Promise.resolve(null!==(r=this.privateKeys.get(e))&&void 0!==r?r:null)}saveCrossSigningKeys(e){for(const[t,r]of Object.entries(e))this.privateKeys.set(t,r)}}class m{constructor(e){this.delegateCryptoCallbacks=e,(0,n.default)(this,"privateKeys",new Map)}async getSecretStorageKey({keys:e},t){var r;for(const t of Object.keys(e)){const e=this.privateKeys.get(t);if(e)return[t,e]}if(null!=this&&null!==(r=this.delegateCryptoCallbacks)&&void 0!==r&&r.getSecretStorageKey){const r=await this.delegateCryptoCallbacks.getSecretStorageKey({keys:e},t);if(r){const[e,t]=r;this.privateKeys.set(e,t)}return r}return null}addPrivateKey(e,t,r){var i,n;this.privateKeys.set(e,r),null===(i=this.delegateCryptoCallbacks)||void 0===i||null===(n=i.cacheSecretStorageKey)||void 0===n||n.call(i,e,t,r)}}})),i.register("kf0mM",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SecretStorage=e.exports.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var n=r(i("3EUCw")),o=i("73W4W"),s=i("gEWrD"),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("dvbGC")),c=i("863Vm"),l=i("cCj6D"),u=i("5pxqF"),h=i("gjhRv"),d=i("ldT3p");function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}const p="m.secret_storage.v1.aes-hmac-sha2";e.exports.SECRET_STORAGE_ALGORITHM_V1_AES=p;e.exports.SecretStorage=class{constructor(e,t,r){this.accountDataAdapter=e,this.cryptoCallbacks=t,this.baseApis=r,(0,n.default)(this,"requests",new Map)}async getDefaultKeyId(){const e=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise(((t,r)=>{const i=r=>{"m.secret_storage.default_key"===r.getType()&&r.getContent().key===e&&(this.accountDataAdapter.removeListener(u.ClientEvent.AccountData,i),t())};this.accountDataAdapter.on(u.ClientEvent.AccountData,i),this.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch((e=>{this.accountDataAdapter.removeListener(u.ClientEvent.AccountData,i),r(e)}))}))}async addKey(e,t={},r){const i={algorithm:e};if(t.name&&(i.name=t.name),e!==p)throw new Error(`Unknown key algorithm ${e}`);if(t.passphrase&&(i.passphrase=t.passphrase),t.key){const{iv:e,mac:r}=await(0,l.calculateKeyCheck)(t.key);i.iv=e,i.mac=r}if(!r)do{r=(0,c.randomString)(32)}while(await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${r}`));return await this.accountDataAdapter.setAccountData(`m.secret_storage.key.${r}`,i),{keyId:r,keyInfo:i}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);return t?[e,t]:null}async hasKey(e){return Boolean(await this.getKey(e))}async checkKey(e,t){if(t.algorithm===p){if(t.mac){const{mac:r}=await(0,l.calculateKeyCheck)(e,t.iv);return t.mac.replace(/=+$/g,"")===r.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")}async store(e,t,r){const i={};if(!r){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");r=[e]}if(0===r.length)throw new Error("Zero keys given to encrypt with!");for(const n of r){const r=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+n);if(!r)throw new Error("Unknown key: "+n);if(r.algorithm===p){const o={[n]:r},[,s]=await this.getSecretStorageKey(o,e);i[n]=await s.encrypt(t)}else s.logger.warn("unknown algorithm for secret storage key "+n+": "+r.algorithm)}await this.accountDataAdapter.setAccountData(e,{encrypted:i})}async get(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted)throw new Error("Content is not encrypted!");const r={};for(const e of Object.keys(t.encrypted)){const i=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e),n=t.encrypted[e];i.algorithm===p&&n.iv&&n.ciphertext&&n.mac&&(r[e]=i)}if(0===Object.keys(r).length)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);const[i,n]=await this.getSecretStorageKey(r,e),o=t.encrypted[i];return n.decrypt(o)}async isStored(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(null==t||!t.encrypted)return null;const r={};for(const e of Object.keys(t.encrypted)){const i=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);if(!i)continue;const n=t.encrypted[e];i.algorithm===p&&n.iv&&n.ciphertext&&n.mac&&(r[e]=i)}return Object.keys(r).length?r:null}request(e,t){const r=this.baseApis.makeTxnId(),i=(0,h.defer)();this.requests.set(r,{name:e,devices:t,deferred:i});const n={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:r,[d.ToDeviceMessageId]:(0,o.default)()},a={};for(const e of t)a[e]=n;return s.logger.info(`Request secret ${e} from ${t}, id ${r}`),this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:a}),{requestId:r,promise:i.promise,cancel:e=>{const n={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:r},o={};for(const e of t)o[e]=n;this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:o}),i.reject(new Error(e||"Cancelled"))}}}async onRequestReceived(e){const t=e.getSender(),r=e.getContent();if(t!==this.baseApis.getUserId()||!(r.name&&r.action&&r.requesting_device_id&&r.request_id))return;const i=r.requesting_device_id;if("request_cancellation"===r.action);else if("request"===r.action){if(i===this.baseApis.deviceId)return;if(s.logger.info("received request for secret ("+t+", "+i+", "+r.request_id+")"),!this.cryptoCallbacks.onSecretRequested)return;const e=await this.cryptoCallbacks.onSecretRequested(t,i,r.request_id,r.name,this.baseApis.checkDeviceTrust(t,i));if(e){s.logger.info(`Preparing ${r.name} secret for ${i}`);const n={type:"m.secret.send",content:{request_id:r.request_id,secret:e}},c={algorithm:a.OLM_ALGORITHM,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{},[d.ToDeviceMessageId]:(0,o.default)()};await a.ensureOlmSessionsForDevices(this.baseApis.crypto.olmDevice,this.baseApis,{[t]:[this.baseApis.getStoredDevice(t,i)]}),await a.encryptMessageForDevice(c.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,t,this.baseApis.getStoredDevice(t,i),n);const l={[t]:{[i]:c}};s.logger.info(`Sending ${r.name} secret for ${i}`),this.baseApis.sendToDevice("m.room.encrypted",l)}else s.logger.info(`Request denied for ${r.name} secret for ${i}`)}}onSecretReceived(e){if(e.getSender()!==this.baseApis.getUserId())return;if(!a.isOlmEncrypted(e))return void s.logger.error("secret event not properly encrypted");const t=e.getContent();if(this.baseApis.crypto.deviceList.getUserByIdentityKey(a.OLM_ALGORITHM,e.getSenderKey()||"")!==e.getSender())return void s.logger.error("sending device does not belong to the user it claims to be from");s.logger.log("got secret share for request",t.request_id);const r=this.requests.get(t.request_id);if(r){const i=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(a.OLM_ALGORITHM,e.getSenderKey());if(!i)return void s.logger.log("secret share from unknown device with key",e.getSenderKey());if(!r.devices.includes(i.deviceId))return void s.logger.log("unsolicited secret share from device",i.deviceId);if(!this.baseApis.crypto.checkDeviceInfoTrust(e.getSender(),i).isVerified())return void s.logger.log("secret share from unverified device");s.logger.log(`Successfully received secret ${r.name} from ${i.deviceId}`),r.deferred.resolve(t.secret)}}async getSecretStorageKey(e,t){if(!this.cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const r=await this.cryptoCallbacks.getSecretStorageKey({keys:e},t);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[i,n]=r;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===p){return[i,{encrypt:function(e){return(0,l.encryptAES)(e,n,t)},decrypt:function(e){return(0,l.decryptAES)(e,n,t)}}]}throw new Error("Unknown key type: "+e[i].algorithm)}}})),i.register("iAFc0",(function(e,t){var n=i("awmEs").Buffer,o=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SHOW_QR_CODE_METHOD=e.exports.SCAN_QR_CODE_METHOD=e.exports.ReciprocateQRCode=e.exports.QrCodeEvent=e.exports.QRCodeData=void 0;var s=o(i("3EUCw")),a=i("gPlsH"),c=i("4I0ot"),l=i("dvbGC"),u=i("gEWrD");e.exports.SHOW_QR_CODE_METHOD="m.qr_code.show.v1";let h;e.exports.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1",e.exports.QrCodeEvent=h,(h||(e.exports.QrCodeEvent=h={})).ShowReciprocateQr="show_reciprocate_qr";class d extends a.VerificationBase{constructor(...e){super(...e),(0,s.default)(this,"reciprocateQREvent",void 0),(0,s.default)(this,"doVerification",(async()=>{if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==(null==e?void 0:e.encodedSharedSecret))throw(0,c.newKeyMismatchError)();await new Promise(((e,t)=>{this.reciprocateQREvent={confirm:e,cancel:()=>t((0,c.newUserCancelledError)())},this.emit(h.ShowReciprocateQr,this.reciprocateQREvent)}));const t={};switch(null==e?void 0:e.mode){case f.VerifyOtherUser:{const r=e.otherUserMasterKey;t[`ed25519:${r}`]=r;break}case f.VerifySelfTrusted:{const r=this.request.targetDevice.deviceId;t[`ed25519:${r}`]=e.otherDeviceKey;break}case f.VerifySelfUntrusted:{const r=e.myMasterKey;t[`ed25519:${r}`]=r;break}}await this.verifyKeys(this.userId,t,((e,r,i)=>{const n=t[e];if(!n)throw(0,c.newKeyMismatchError)();if(i!==n)throw u.logger.error("key ID from key info does not match"),(0,c.newKeyMismatchError)();for(const e in r.keys){if(!e.startsWith("ed25519"))continue;const i=t[e];if(!i)throw(0,c.newKeyMismatchError)();if(r.keys[e]!==i)throw u.logger.error("master key does not match"),(0,c.newKeyMismatchError)()}}))}))}static factory(e,t,r,i,n,o){return new d(e,t,r,i,n,o)}static get NAME(){return"m.reciprocate.v1"}}e.exports.ReciprocateQRCode=d;var f,p;(p=f||(f={}))[p.VerifyOtherUser=0]="VerifyOtherUser",p[p.VerifySelfTrusted=1]="VerifySelfTrusted",p[p.VerifySelfUntrusted=2]="VerifySelfUntrusted";class m{constructor(e,t,r,i,n,o){this.mode=e,this.sharedSecret=t,this.otherUserMasterKey=r,this.otherDeviceKey=i,this.myMasterKey=n,this.buffer=o}static async create(e,t){const r=m.generateSharedSecret(),i=m.determineMode(e,t);let n=null,o=null,s=null;if(i===f.VerifyOtherUser){n=t.getStoredCrossSigningForUser(e.otherUserId).getId("master")}else if(i===f.VerifySelfTrusted)o=await m.getOtherDeviceKey(e,t);else if(i===f.VerifySelfUntrusted){const e=t.getUserId();s=t.getStoredCrossSigningForUser(e).getId("master")}const a=m.generateQrData(e,t,i,r,n,o,s),c=m.generateBuffer(a);return new m(i,r,n,o,s,c)}get encodedSharedSecret(){return this.sharedSecret}getBuffer(){return this.buffer}static generateSharedSecret(){const e=new Uint8Array(11);return r.crypto.getRandomValues(e),(0,l.encodeUnpaddedBase64)(e)}static async getOtherDeviceKey(e,t){const r=t.getUserId(),i=e.targetDevice,n=i.deviceId?t.getStoredDevice(r,i.deviceId):void 0;if(!n)throw new Error("could not find device "+(null==i?void 0:i.deviceId));return n.getFingerprint()}static determineMode(e,t){const r=t.getUserId(),i=e.otherUserId;let n=f.VerifyOtherUser;if(r===i){n=t.checkUserTrust(r).isCrossSigningVerified()?f.VerifySelfTrusted:f.VerifySelfUntrusted}return n}static generateQrData(e,t,r,i,n,o,s){const a=t.getUserId(),c={prefix:"MATRIX",version:2,mode:r,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:i},l=t.getStoredCrossSigningForUser(a);return r===f.VerifyOtherUser?(c.firstKeyB64=l.getId("master"),c.secondKeyB64=n):r===f.VerifySelfTrusted?(c.firstKeyB64=l.getId("master"),c.secondKeyB64=o):r===f.VerifySelfUntrusted&&(c.firstKeyB64=t.getDeviceEd25519Key(),c.secondKeyB64=s),c}static generateBuffer(e){let t=n.alloc(0);const r=e=>{const r=n.from([e]);t=n.concat([t,r])},i=(e,r,i=!0)=>{const o=n.from(e,r);i&&(e=>{const r=n.alloc(2);r.writeInt16BE(e,0),t=n.concat([t,r])})(o.byteLength),t=n.concat([t,o])},o=e=>{const r=(0,l.decodeBase64)(e),i=n.from(r);t=n.concat([t,i])};return i(e.prefix,"ascii",!1),r(e.version),r(e.mode),i(e.transactionId,"utf-8"),o(e.firstKeyB64),o(e.secondKeyB64),o(e.secretB64),t}}e.exports.QRCodeData=m})),i.register("gPlsH",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VerificationEvent=e.exports.VerificationBase=e.exports.SwitchStartEventError=void 0;var n=r(i("3EUCw")),o=i("7BSj1"),s=i("ldT3p"),a=i("gEWrD"),c=i("iN8Ss"),l=i("4I0ot"),u=i("hclBt"),h=i("75Qdj");const d=new Error("Verification timed out");class f extends Error{constructor(e){super(),this.startEvent=e}}let p;e.exports.SwitchStartEventError=f,e.exports.VerificationEvent=p,(p||(e.exports.VerificationEvent=p={})).Cancel="cancel";class m extends h.TypedEventEmitter{constructor(e,t,r,i,o,s){super(),this.channel=e,this.baseApis=t,this.userId=r,this.deviceId=i,this.startEvent=o,this.request=s,(0,n.default)(this,"cancelled",!1),(0,n.default)(this,"_done",!1),(0,n.default)(this,"promise",null),(0,n.default)(this,"transactionTimeoutTimer",null),(0,n.default)(this,"expectedEvent",void 0),(0,n.default)(this,"resolve",void 0),(0,n.default)(this,"reject",void 0),(0,n.default)(this,"resolveEvent",void 0),(0,n.default)(this,"rejectEvent",void 0),(0,n.default)(this,"started",void 0),(0,n.default)(this,"doVerification",void 0)}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this.baseApis.getUserId()&&t.from_device===this.baseApis.getDeviceId()}get hasBeenCancelled(){return this.cancelled}resetTimer(){a.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout((()=>{this._done||this.cancelled||(a.logger.info("Triggering verification timeout"),this.cancel(d))}),6e5)}endTimer(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}send(e,t){return this.channel.send(e,t)}waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this.expectedEvent=e,new Promise(((e,t)=>{this.resolveEvent=e,this.rejectEvent=t})))}canSwitchStartEvent(e){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(a.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){const t=this.rejectEvent;this.rejectEvent=void 0,t(new f(e))}else this.startEvent=e}handleEvent(e){var t;if(!this._done)if(e.getType()===this.expectedEvent)this.expectedEvent!==s.EventType.KeyVerificationDone&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),null===(t=this.resolveEvent)||void 0===t||t.call(this,e));else if(e.getType()===s.EventType.KeyVerificationCancel){const t=this.reject;if(this.reject=void 0,t){const r=e.getContent(),{reason:i,code:n}=r;t(new Error(`Other side cancelled verification because ${i} (${n})`))}}else if(this.expectedEvent){const t=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){const e=this.rejectEvent;this.rejectEvent=void 0,e(t)}this.cancel(t)}}async done(){var e;if(this.endTimer(),!this._done)return this.request.onVerifierFinished(),null===(e=this.resolve)||void 0===e||e.call(this),(0,u.requestKeysDuringVerification)(this.baseApis,this.userId,this.deviceId)}cancel(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===d){const e=(0,l.newTimeoutError)();this.send(e.getType(),e.getContent())}else if(e instanceof o.MatrixEvent){if(e.getSender()!==this.userId){const t=e.getContent();e.getType()===s.EventType.KeyVerificationCancel?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this.send(s.EventType.KeyVerificationCancel,t)):this.send(s.EventType.KeyVerificationCancel,{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this.send(s.EventType.KeyVerificationCancel,{code:"m.unknown",reason:e.toString()});null!==this.promise?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit(p.Cancel,e)}}verify(){return this.promise||(this.promise=new Promise(((e,t)=>{this.resolve=(...t)=>{this._done=!0,this.endTimer(),e(...t)},this.reject=e=>{this._done=!0,this.endTimer(),t(e)}})),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),new Promise(((e,t)=>{var r;(null===(r=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(this.userId))||void 0===r?void 0:r.getId())===this.deviceId&&t(new Error("Device ID is the same as the cross-signing ID")),e()})).then((()=>this.doVerification())).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}async verifyKeys(e,t,r){const i=[];for(const[n,o]of Object.entries(t)){const t=n.split(":",2)[1],s=this.baseApis.getStoredDevice(e,t);if(s)r(n,s,o),i.push([t,n,s.keys[n]]);else{const s=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e);s&&s.getId()===t?(r(n,c.DeviceInfo.fromStorage({keys:{[n]:t}},t),o),i.push([t,n,t])):a.logger.warn(`verification: Could not find device ${t} to verify`)}}if(!i.length)throw new Error("No devices could be verified");a.logger.info("Verification completed! Marking devices verified: ",i);for(const[t,r,n]of i)await this.baseApis.crypto.setDeviceVerification(e,t,!0,null,null,{[r]:n});e==this.baseApis.credentials.userId&&await this.baseApis.checkKeyBackup()}get events(){}}e.exports.VerificationBase=m})),i.register("4I0ot",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.errorFactory=s,e.exports.errorFromEvent=function(e){const t=e.getContent();if(t){const{code:e,reason:r}=t;return{code:e,reason:r}}return{code:"Unknown error",reason:"m.unknown"}},e.exports.newUserCancelledError=e.exports.newUnknownMethodError=e.exports.newUnexpectedMessageError=e.exports.newTimeoutError=e.exports.newKeyMismatchError=e.exports.newInvalidMessageError=void 0,e.exports.newVerificationError=o;var r=i("7BSj1"),n=i("ldT3p");function o(e,t,i){const o=Object.assign({},{code:e,reason:t},i);return new r.MatrixEvent({type:n.EventType.KeyVerificationCancel,content:o})}function s(e,t){return function(r){return o(e,t,r)}}const a=s("m.user","Cancelled by user");e.exports.newUserCancelledError=a;const c=s("m.timeout","Timed out");e.exports.newTimeoutError=c;const l=s("m.unknown_method","Unknown method");e.exports.newUnknownMethodError=l;const u=s("m.unexpected_message","Unexpected message");e.exports.newUnexpectedMessageError=u;const h=s("m.key_mismatch","Key mismatch");e.exports.newKeyMismatchError=h;const d=s("m.invalid_message","Invalid message");e.exports.newInvalidMessageError=d})),i.register("4nm41",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SasEvent=e.exports.SAS=void 0;var o=n(i("3EUCw")),s=n(i("1nB6h")),a=i("gPlsH"),c=i("4I0ot"),l=i("gEWrD"),u=i("dfi7S"),h=i("ldT3p");const d=h.EventType.KeyVerificationStart,f=[h.EventType.KeyVerificationAccept,h.EventType.KeyVerificationKey,h.EventType.KeyVerificationMac];let p;const m=(0,c.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),g=(0,c.errorFactory)("m.mismatched_commitment","Mismatched commitment"),v=[["🐶","dog"],["🐱","cat"],["🦁","lion"],["🐎","horse"],["🦄","unicorn"],["🐷","pig"],["🐘","elephant"],["🐰","rabbit"],["🐼","panda"],["🐓","rooster"],["🐧","penguin"],["🐢","turtle"],["🐟","fish"],["🐙","octopus"],["🦋","butterfly"],["🌷","flower"],["🌳","tree"],["🌵","cactus"],["🍄","mushroom"],["🌏","globe"],["🌙","moon"],["☁️","cloud"],["🔥","fire"],["🍌","banana"],["🍎","apple"],["🍓","strawberry"],["🌽","corn"],["🍕","pizza"],["🎂","cake"],["❤️","heart"],["🙂","smiley"],["🤖","robot"],["🎩","hat"],["👓","glasses"],["🔧","spanner"],["🎅","santa"],["👍","thumbs up"],["☂️","umbrella"],["⌛","hourglass"],["⏰","clock"],["🎁","gift"],["💡","light bulb"],["📕","book"],["✏️","pencil"],["📎","paperclip"],["✂️","scissors"],["🔒","lock"],["🔑","key"],["🔨","hammer"],["☎️","telephone"],["🏁","flag"],["🚂","train"],["🚲","bicycle"],["✈️","aeroplane"],["🚀","rocket"],["🏆","trophy"],["⚽","ball"],["🎸","guitar"],["🎺","trumpet"],["🔔","bell"],["⚓️","anchor"],["🎧","headphones"],["📁","folder"],["📌","pin"]];const y={decimal:u.generateDecimalSas,emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((e=>v[e]))}};function b(e,t){const r={};for(const i of t)i in y&&(r[i]=y[i](Array.from(e)));return r}const w={"hkdf-hmac-sha256":"calculate_mac","org.matrix.msc3783.hkdf-hmac-sha256":"calculate_mac_fixed_base64","hkdf-hmac-sha256.v2":"calculate_mac_fixed_base64","hmac-sha256":"calculate_mac_long_kdf"};function _(e,t){return function(r,i){const n=e[w[t]](r,i);return l.logger.log("SAS calculateMAC:",t,[r,i],n),n}}const S={"curve25519-hkdf-sha256":function(e,t,r){const i=`${e.baseApis.getUserId()}|${e.baseApis.deviceId}|${e.ourSASPubKey}|`,n=`${e.userId}|${e.deviceId}|${e.theirSASPubKey}|`,o="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?i+n:n+i)+e.channel.transactionId;return t.generate_bytes(o,r)},curve25519:function(e,t,r){const i=`${e.baseApis.getUserId()}${e.baseApis.deviceId}`,n=`${e.userId}${e.deviceId}`,o="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?i+n:n+i)+e.channel.transactionId;return t.generate_bytes(o,r)}},E=["curve25519-hkdf-sha256","curve25519"],M=["sha256"],C=["hkdf-hmac-sha256.v2","org.matrix.msc3783.hkdf-hmac-sha256","hkdf-hmac-sha256","hmac-sha256"],I=Object.keys(y),T=new Set(E),k=new Set(M),R=new Set(C),x=new Set(I);function O(e,t){return Array.isArray(e)?e.filter((e=>t.has(e))):[]}let A;e.exports.SasEvent=A,(A||(e.exports.SasEvent=A={})).ShowSas="show_sas";class P extends a.VerificationBase{constructor(...e){super(...e),(0,o.default)(this,"waitingForAccept",void 0),(0,o.default)(this,"ourSASPubKey",void 0),(0,o.default)(this,"theirSASPubKey",void 0),(0,o.default)(this,"sasEvent",void 0),(0,o.default)(this,"doVerification",(async()=>{await r.Olm.init(),p=p||new r.Olm.Utility,await this.baseApis.downloadKeys([this.userId]);let e=!1;do{try{return this.initiatedByMe?await this.doSendVerification():await this.doRespondVerification()}catch(t){if(!(t instanceof a.SwitchStartEventError))throw t;this.startEvent=t.startEvent,e=!0}}while(e)}))}static get NAME(){return"m.sas.v1"}get events(){return f}canSwitchStartEvent(e){if(e.getType()!==d)return!1;const t=e.getContent();return(null==t?void 0:t.method)===P.NAME&&!!this.waitingForAccept}async sendStart(){const e=this.channel.completeContent(d,{method:P.NAME,from_device:this.baseApis.deviceId,key_agreement_protocols:E,hashes:M,message_authentication_codes:C,short_authentication_string:I});return await this.channel.sendCompleted(d,e),e}async verifyAndCheckMAC(e,t,r,i){const n=S[e](this,r,6),o=new Promise(((e,o)=>{this.sasEvent={sas:b(n,t),confirm:async()=>{try{await this.sendMAC(r,i),e()}catch(e){o(e)}},cancel:()=>o((0,c.newUserCancelledError)()),mismatch:()=>o(m())},this.emit(A.ShowSas,this.sasEvent)})),[s]=await Promise.all([this.waitForEvent(h.EventType.KeyVerificationMac).then((e=>(this.expectedEvent=h.EventType.KeyVerificationDone,e))),o]),a=s.getContent();await this.checkMAC(r,a,i)}async doSendVerification(){let e,t;if(this.waitingForAccept=!0,e=this.startEvent?this.channel.completedContentFromEvent(this.startEvent):await this.sendStart(),!this.initiatedByMe)throw new a.SwitchStartEventError(this.startEvent);try{t=await this.waitForEvent(h.EventType.KeyVerificationAccept)}finally{this.waitingForAccept=!1}let i=t.getContent();const n=O(i.short_authentication_string,x);if(!(T.has(i.key_agreement_protocol)&&k.has(i.hash)&&R.has(i.message_authentication_code)&&n.length))throw(0,c.newUnknownMethodError)();if("string"!=typeof i.commitment)throw(0,c.newInvalidMessageError)();const o=i.key_agreement_protocol,l=i.message_authentication_code,u=i.commitment,d=new r.Olm.SAS;try{this.ourSASPubKey=d.get_pubkey(),await this.send(h.EventType.KeyVerificationKey,{key:this.ourSASPubKey}),t=await this.waitForEvent(h.EventType.KeyVerificationKey),i=t.getContent();const r=i.key+s.default.stringify(e);if(p.sha256(r)!==u)throw g();this.theirSASPubKey=i.key,d.set_their_key(i.key),await this.verifyAndCheckMAC(o,n,d,l)}finally{d.free()}}async doRespondVerification(){let e=this.channel.completedContentFromEvent(this.startEvent);const t=O(E,new Set(e.key_agreement_protocols))[0],i=O(M,new Set(e.hashes))[0],n=O(C,new Set(e.message_authentication_codes))[0],o=O(e.short_authentication_string,x);if(void 0===t||void 0===i||void 0===n||!o.length)throw(0,c.newUnknownMethodError)();const a=new r.Olm.SAS;try{const r=a.get_pubkey()+s.default.stringify(e);await this.send(h.EventType.KeyVerificationAccept,{key_agreement_protocol:t,hash:i,message_authentication_code:n,short_authentication_string:o,commitment:p.sha256(r)});e=(await this.waitForEvent(h.EventType.KeyVerificationKey)).getContent(),this.theirSASPubKey=e.key,a.set_their_key(e.key),this.ourSASPubKey=a.get_pubkey(),await this.send(h.EventType.KeyVerificationKey,{key:this.ourSASPubKey}),await this.verifyAndCheckMAC(t,o,a,n)}finally{a.free()}}sendMAC(e,t){const r={},i=[],n="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,o=`ed25519:${this.baseApis.deviceId}`;r[o]=_(e,t)(this.baseApis.getDeviceEd25519Key(),n+o),i.push(o);const s=this.baseApis.getCrossSigningId();if(s){const o=`ed25519:${s}`;r[o]=_(e,t)(s,n+o),i.push(o)}const a=_(e,t)(i.sort().join(","),n+"KEY_IDS");return this.send(h.EventType.KeyVerificationMac,{mac:r,keys:a})}async checkMAC(e,t,r){const i="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this.baseApis.getUserId()+this.baseApis.deviceId+this.channel.transactionId;if(t.keys!==_(e,r)(Object.keys(t.mac).sort().join(","),i+"KEY_IDS"))throw(0,c.newKeyMismatchError)();await this.verifyKeys(this.userId,t.mac,((t,n,o)=>{if(o!==_(e,r)(n.keys[t],i+t))throw(0,c.newKeyMismatchError)()}))}}e.exports.SAS=P})),i.register("dfi7S",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.generateDecimalSas=function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]}})),i.register("1AObg",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.deriveKey=c,e.exports.keyFromAuthData=function(e,t){if(!r.Olm)throw new Error("Olm is not available");if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return c(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits||a)},e.exports.keyFromPassphrase=async function(e){if(!r.Olm)throw new Error("Olm is not available");const t=(0,n.randomString)(32);return{key:await c(e,t,s,a),salt:t,iterations:s}};var n=i("863Vm"),o=i("cNkid");const s=5e5,a=256;async function c(e,t,r,i=a){if(!o.subtleCrypto||!o.TextEncoder)throw new Error("Password-based backup is not available on this platform");const n=await o.subtleCrypto.importKey("raw",(new o.TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits"]),s=await o.subtleCrypto.deriveBits({name:"PBKDF2",salt:(new o.TextEncoder).encode(t),iterations:r,hash:"SHA-512"},n,i);return new Uint8Array(s)}})),i.register("iyAPZ",(function(e,t){var n=i("awmEs").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.decodeRecoveryKey=function(e){const t=o.decode(e.replace(/ /g,""));let i=0;for(const e of t)i^=e;if(0!==i)throw new Error("Incorrect parity");for(let e=0;e<a.length;++e)if(t[e]!==a[e])throw new Error("Incorrect prefix");if(t.length!==a.length+r.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(a.length,a.length+r.Olm.PRIVATE_KEY_LENGTH))},e.exports.encodeRecoveryKey=function(e){var t;const r=n.alloc(a.length+e.length+1);r.set(a,0),r.set(e,a.length);let i=0;for(let e=0;e<r.length-1;++e)i^=r[e];r[r.length-1]=i;const s=o.encode(r);return null===(t=s.match(/.{1,4}/g))||void 0===t?void 0:t.join(" ")};var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("a1fZv"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}const a=[139,1]})),i.register("a1fZv",(function(e,t){var r=i("1QSt5");e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")})),i.register("1QSt5",(function(e,t){e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<e.length;i++){var n=e.charAt(i),o=n.charCodeAt(0);if(255!==t[o])throw new TypeError(n+" is ambiguous");t[o]=i}var s=e.length,a=e.charAt(0),c=Math.log(s)/Math.log(256),l=Math.log(256)/Math.log(s);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var r=0,i=0,n=0;e[r]===a;)i++,r++;for(var o=(e.length-r)*c+1>>>0,l=new Uint8Array(o);e[r];){var u=t[e.charCodeAt(r)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<n)&&-1!==d;d--,h++)u+=s*l[d]>>>0,l[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");n=h,r++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var p=new Uint8Array(i+(o-f)),m=i;f!==o;)p[m++]=l[f++];return p}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,n=0,o=t.length;n!==o&&0===t[n];)n++,r++;for(var c=(o-n)*l+1>>>0,u=new Uint8Array(c);n!==o;){for(var h=t[n],d=0,f=c-1;(0!==h||d<i)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");i=d,n++}for(var p=c-i;p!==c&&0===u[p];)p++;for(var m=a.repeat(r);p<c;++p)m+=e.charAt(u[p]);return m},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}})),i.register("jcrlZ",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VerificationRequestEvent=e.exports.VerificationRequest=e.exports.START_TYPE=e.exports.REQUEST_TYPE=e.exports.READY_TYPE=e.exports.Phase=e.exports.PHASE_UNSENT=e.exports.PHASE_STARTED=e.exports.PHASE_REQUESTED=e.exports.PHASE_READY=e.exports.PHASE_DONE=e.exports.PHASE_CANCELLED=e.exports.EVENT_PREFIX=e.exports.DONE_TYPE=e.exports.CANCEL_TYPE=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("4I0ot"),a=i("iAFc0"),c=i("ldT3p"),l=i("75Qdj");const u="m.key.verification.";e.exports.EVENT_PREFIX=u;const h=u+"request";e.exports.REQUEST_TYPE=h;const d=u+"start";e.exports.START_TYPE=d;const f=u+"cancel";e.exports.CANCEL_TYPE=f;const p=u+"done";e.exports.DONE_TYPE=p;const m=u+"ready";let g;var v;e.exports.READY_TYPE=m,e.exports.Phase=g,(v=g||(e.exports.Phase=g={}))[v.Unsent=1]="Unsent",v[v.Requested=2]="Requested",v[v.Ready=3]="Ready",v[v.Started=4]="Started",v[v.Cancelled=5]="Cancelled",v[v.Done=6]="Done";const y=g.Unsent;e.exports.PHASE_UNSENT=y;const b=g.Requested;e.exports.PHASE_REQUESTED=b;const w=g.Ready;e.exports.PHASE_READY=w;const _=g.Started;e.exports.PHASE_STARTED=_;const S=g.Cancelled;e.exports.PHASE_CANCELLED=S;const E=g.Done;let M;e.exports.PHASE_DONE=E,e.exports.VerificationRequestEvent=M,(M||(e.exports.VerificationRequestEvent=M={})).Change="change";class C extends l.TypedEventEmitter{constructor(e,t,r){super(),this.channel=e,this.verificationMethods=t,this.client=r,(0,n.default)(this,"eventsByUs",new Map),(0,n.default)(this,"eventsByThem",new Map),(0,n.default)(this,"_observeOnly",!1),(0,n.default)(this,"timeoutTimer",null),(0,n.default)(this,"_accepting",!1),(0,n.default)(this,"_declining",!1),(0,n.default)(this,"verifierHasFinished",!1),(0,n.default)(this,"_cancelled",!1),(0,n.default)(this,"_chosenMethod",null),(0,n.default)(this,"_qrCodeData",null),(0,n.default)(this,"requestReceivedAt",null),(0,n.default)(this,"commonMethods",[]),(0,n.default)(this,"_phase",void 0),(0,n.default)(this,"_cancellingUserId",void 0),(0,n.default)(this,"_verifier",void 0),(0,n.default)(this,"cancelOnTimeout",(async()=>{try{this.initiatedByMe?await this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):await this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){o.logger.error("Error while cancelling verification request",e)}})),this.channel.request=this,this.setPhase(y,!1)}static validateEvent(e,t,r){const i=t.getContent();return!(!e||!e.startsWith(u))&&(i?e!==h&&e!==m||Array.isArray(i.methods)?e!==h&&e!==m&&e!==d||"string"==typeof i.from_device&&0!==i.from_device.length||(o.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(o.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(o.logger.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return this.phase===y}get requested(){return this.phase===b}get cancelled(){return this.phase===S}get ready(){return this.phase===w}get started(){return this.phase===_}get done(){return this.phase===E}get methods(){return this.commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let t=this.channel.getTimestamp(e)+6e5;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=b){const e=this.requestReceivedAt+12e4;t=Math.min(t,e)}return Math.max(0,t-Date.now())}get timeout(){const e=this.getEventByEither(h);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this.getEventByEither(h)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<w&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==E&&this._phase!==S}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(e,t=!1){if(!t&&!this.ready&&!this.started)return!1;const r=this.eventsByThem.get(h)||this.eventsByThem.get(m);if(!r){if(this.started&&this.initiatedByMe){const t=this.eventsByUs.get(d),r=t&&t.getContent();return e==(r&&r.method)}return!1}const i=r.getContent();if(!i)return!1;const{methods:n}=i;return!!Array.isArray(n)&&n.includes(e)}get initiatedByMe(){const e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===y&&e)return!0;const t=this.eventsByUs.has(h),r=this.eventsByThem.has(h);if(t&&!r)return!0;if(!t&&r)return!1;const i=this.eventsByUs.has(d),n=this.eventsByThem.has(d);return!(!i||n)}get requestingUserId(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this.client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this.eventsByUs.get(f),t=this.eventsByThem.get(f);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){const e=this.getEventByEither(f);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=this.eventsByThem.get(h)||this.eventsByThem.get(m)||this.eventsByThem.get(d),t=null==e?void 0:e.getContent(),r=null==t?void 0:t.from_device;return{userId:this.otherUserId,deviceId:r}}beginKeyVerification(e,t=null){if(!this.observeOnly&&!this._verifier){if(this.phase===b||this.phase===w||this.phase===y&&this.channel.canCreateRequest(d)){if(this.commonMethods.length&&!this.commonMethods.includes(e))throw(0,s.newUnknownMethodError)();if(this._verifier=this.createVerifier(e,null,t),!this._verifier)throw(0,s.newUnknownMethodError)();this._chosenMethod=e}}return this._verifier}async sendRequest(){if(!this.observeOnly&&this._phase===y){const e=[...this.verificationMethods.keys()];await this.channel.send(h,{methods:e})}}async cancel({reason:e="User declined",code:t="m.user"}={}){if(!this.observeOnly&&this._phase!==S){if(this._declining=!0,this.emit(M.Change),this._verifier)return this._verifier.cancel((0,s.errorFactory)(t,e)());this._cancellingUserId=this.client.getUserId(),await this.channel.send(f,{code:t,reason:e})}}async accept(){if(!this.observeOnly&&this.phase===b&&!this.initiatedByMe){const e=[...this.verificationMethods.keys()];this._accepting=!0,this.emit(M.Change),await this.channel.send(m,{methods:e})}}waitFor(e){return new Promise(((t,r)=>{const i=()=>{let n=!1;return e(this)?(t(this),n=!0):this.cancelled&&(r(new Error("cancelled")),n=!0),n&&this.off(M.Change,i),n};i()||this.on(M.Change,i)}))}setPhase(e,t=!0){this._phase=e,t&&this.emit(M.Change)}getEventByEither(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}getEventBy(e,t=!1){return t?this.eventsByThem.get(e):this.eventsByUs.get(e)}calculatePhaseTransitions(){const e=[{phase:y}],t=()=>e[e.length-1].phase,r=this.eventsByThem.has(h),i=this.getEventBy(h,r);i&&e.push({phase:b,event:i});const n=i&&this.getEventBy(m,!r);let o;if(n&&t()===b&&e.push({phase:w,event:n}),n||!i){const e=this.eventsByThem.get(d),t=this.eventsByUs.get(d);o=e&&t?e.getSender()<t.getSender()?e:t:e||t}else o=this.getEventBy(d,!r);if(o){const r=t()===b&&(null==i?void 0:i.getSender())!==o.getSender(),n=t()===y&&this.channel.canCreateRequest(d);(r||t()===w||n)&&e.push({phase:_,event:o})}const s=this.eventsByUs.get(p);(this.verifierHasFinished||s&&t()===_)&&e.push({phase:E});const a=this.getEventByEither(f);return(this._cancelled||a)&&t()!==E?(e.push({phase:S,event:a}),e):e}transitionToPhase(e){const{phase:t,event:r}=e;if((t===b||t===w)&&!this.wasSentByOwnDevice(r)){const e=r.getContent();this.commonMethods=e.methods.filter((e=>this.verificationMethods.has(e)))}if(this.observeOnly||t!==b&&t!==_&&t!==w||this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(r)&&!this.wasSentByOwnDevice(r)&&(this._observeOnly=!0),t===_){const{method:e}=r.getContent();this._verifier||this.observeOnly||(this._verifier=this.createVerifier(e,r),this._verifier?this._chosenMethod=e:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${e}`}))}}applyPhaseTransitions(){const e=this.calculatePhaseTransitions(),t=e.findIndex((e=>e.phase===this.phase)),r=e.slice(t+1);for(const e of r)this.transitionToPhase(e);return r}isWinningStartRace(e){if(e.getType()!==d)return!1;const t=this._verifier.startEvent;let r,i;if(this.isSelfVerification)if(t){const e=t.getContent();r=e&&e.from_device}else r=this.client.getDeviceId();else r=t?t.getSender():this.client.getUserId();if(this.isSelfVerification){const t=e.getContent();i=t&&t.from_device}else i=e.getSender();return i<r}hasEventId(e){for(const t of this.eventsByUs.values())if(t.getId()===e)return!0;for(const t of this.eventsByThem.values())if(t.getId()===e)return!0;return!1}async handleEvent(e,t,r,i,n){if(this.done||this.cancelled)return;const s=this._observeOnly;if(this.adjustObserveOnly(t,r),!this.observeOnly&&!i&&await this.cancelOnError(e,t))return;if(n?this.eventsByUs.has(e):this.eventsByThem.has(e))return;const c=this.phase;this.addEvent(e,t,n);const l=this.applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const r=this.isWinningStartRace(t);if(this._verifier.canSwitchStartEvent(t)&&r)this._verifier.switchStartEvent(t);else if(!i){var u;(e===f||null!==(u=this._verifier.events)&&void 0!==u&&u.includes(e))&&this._verifier.handleEvent(t)}}if(l.length){if(r&&l.some((e=>e.phase===w))){this.otherPartySupportsMethod(a.SCAN_QR_CODE_METHOD,!0)&&(this._qrCodeData=await a.QRCodeData.create(this,this.client))}const e=l[l.length-1],{phase:t}=e;this.setupTimeout(t),this.setPhase(t)}else this._observeOnly!==s&&this.emit(M.Change)}finally{o.logger.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${t.getId()}, content:${JSON.stringify(t.getContent())} deviceId:${this.channel.deviceId}, sender:${t.getSender()}, isSentByUs:${n}, isLiveEvent:${r}, isRemoteEcho:${i}, phase:${c}=>${this.phase}, observeOnly:${s}=>${this._observeOnly}`)}}setupTimeout(e){if(!this.timeoutTimer&&!this.observeOnly&&e===b&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer){(e===_||e===w||e===E||e===S)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}}async cancelOnError(e,t){if(e===d){const e=t.getContent().method;if(!this.verificationMethods.has(e))return await this.cancel((0,s.errorFromEvent)((0,s.newUnknownMethodError)())),!0}const r=e===h&&this.phase!==y,i=e===m&&this.phase!==b&&this.phase!==_;if(this.phase!==y&&(r||i)){o.logger.warn(`Cancelling, unexpected ${e} verification event from ${t.getSender()}`);const r=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel((0,s.errorFromEvent)((0,s.newUnexpectedMessageError)({reason:r}))),!0}return!1}adjustObserveOnly(e,t=!1){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}addEvent(e,t,r=!1){if(r?this.eventsByUs.set(e,t):this.eventsByThem.set(e,t),e===h){for(const[e,t]of this.eventsByThem.entries())t.getSender()!==this.otherUserId&&this.eventsByThem.delete(e);this.requestReceivedAt=Date.now()}}createVerifier(e,t=null,r=null){r||(r=this.targetDevice);const{userId:i,deviceId:n}=r,s=this.verificationMethods.get(e);if(s)return new s(this.channel,this.client,i,n,t,this);o.logger.warn("could not find verifier constructor for method",e)}wasSentByOwnUser(e){return(null==e?void 0:e.getSender())===this.client.getUserId()}wasSentByOwnDevice(e){if(!this.wasSentByOwnUser(e))return!1;const t=e.getContent();return!(!t||t.from_device!==this.client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send(c.EventType.KeyVerificationDone,{}),this.verifierHasFinished=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this.eventsByThem.get(e)}}e.exports.VerificationRequest=C})),i.register("hflHR",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InRoomRequests=e.exports.InRoomChannel=void 0;var n=r(i("3EUCw")),o=i("jcrlZ"),s=i("gEWrD");const a=i("ldT3p").EventType.RoomMessage,c="m.reference",l="m.relates_to";class u{constructor(e,t,r){this.client=e,this.roomId=t,this.userId=r,(0,n.default)(this,"requestEventId",void 0)}get receiveStartFromOtherDevices(){return!0}get transactionId(){return this.requestEventId}static getOtherPartyUserId(e,t){if(u.getEventType(e)!==o.REQUEST_TYPE)return;const r=t.getUserId(),i=e.getSender(),n=e.getContent().to;return i===r?n:n===r?i:void 0}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===o.REQUEST_TYPE}canCreateRequest(e){return u.canCreateRequest(e)}static getTransactionId(e){if(u.getEventType(e)===o.REQUEST_TYPE)return e.getId();{const t=e.getRelation();if((null==t?void 0:t.rel_type)===c)return t.event_id}}static validateEvent(e,t){const r=u.getTransactionId(e);if("string"!=typeof r||0===r.length)return!1;const i=u.getEventType(e),n=e.getContent();if(i===o.REQUEST_TYPE){if(!n||"string"!=typeof n.to||!n.to.length)return s.logger.log("InRoomChannel: validateEvent: no valid to "+(n&&n.to)),!1;if(!u.getOtherPartyUserId(e,t))return s.logger.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${e.getSender()}, ${n&&n.to}`),!1}return o.VerificationRequest.validateEvent(i,e,t)}static getEventType(e){const t=e.getType();if(t===a){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===o.REQUEST_TYPE)return o.REQUEST_TYPE}}return t&&t!==o.REQUEST_TYPE?t:""}async handleEvent(e,t,r=!1){if(t.hasEventId(e.getId()))return;const i=u.getEventType(e);if(e.getRoomId()!==this.roomId)return;if(!this.userId){const t=u.getOtherPartyUserId(e,this.client);t&&(this.userId=t)}const n=this.client.getUserId(),o=e.getSender();if(this.userId&&o!==n&&o!==this.userId)return void s.logger.log(`InRoomChannel: ignoring verification event from non-participating sender ${o}`);this.requestEventId||(this.requestEventId=u.getTransactionId(e));const a=!!e.getUnsigned().transaction_id,c=e.getSender()===this.client.getUserId();return t.handleEvent(i,e,r,a,c)}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t[l]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==o.REQUEST_TYPE&&e!==o.READY_TYPE&&e!==o.START_TYPE||(t.from_device=this.client.getDeviceId()),e===o.REQUEST_TYPE?t={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:o.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[l]={rel_type:c,event_id:this.transactionId},t}send(e,t){const r=this.completeContent(e,t);return this.sendCompleted(e,r)}async sendCompleted(e,t){let r=e;e===o.REQUEST_TYPE&&(r=a);const i=await this.client.sendEvent(this.roomId,r,t);e===o.REQUEST_TYPE&&(this.requestEventId=i.event_id)}}e.exports.InRoomChannel=u;e.exports.InRoomRequests=class{constructor(){(0,n.default)(this,"requestsByRoomId",new Map)}getRequest(e){const t=e.getRoomId(),r=u.getTransactionId(e);return this.getRequestByTxnId(t,r)}getRequestByChannel(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}getRequestByTxnId(e,t){const r=this.requestsByRoomId.get(e);if(r)return r.get(t)}setRequest(e,t){this.doSetRequest(e.getRoomId(),u.getTransactionId(e),t)}setRequestByChannel(e,t){this.doSetRequest(e.roomId,e.transactionId,t)}doSetRequest(e,t,r){let i=this.requestsByRoomId.get(e);i||(i=new Map,this.requestsByRoomId.set(e,i)),i.set(t,r)}removeRequest(e){const t=e.getRoomId(),r=this.requestsByRoomId.get(t);r&&(r.delete(u.getTransactionId(e)),0===r.size&&this.requestsByRoomId.delete(t))}findRequestInProgress(e){const t=this.requestsByRoomId.get(e);if(t)for(const e of t.values())if(e.pending)return e}}})),i.register("aAiXZ",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ToDeviceRequests=e.exports.ToDeviceChannel=void 0;var n=r(i("3EUCw")),o=i("863Vm"),s=i("gEWrD"),a=i("jcrlZ"),c=i("4I0ot"),l=i("7BSj1");class u{constructor(e,t,r,i,o){this.client=e,this.userId=t,this.devices=r,this.transactionId=i,this.deviceId=o,(0,n.default)(this,"request",void 0)}isToDevices(e){if(e.length===this.devices.length){for(const t of e)if(!this.devices.includes(t))return!1;return!0}return!1}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===a.REQUEST_TYPE||e===a.START_TYPE}canCreateRequest(e){return u.canCreateRequest(e)}static validateEvent(e,t){if(e.isCancelled())return s.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;const r=e.getContent();if(!r)return s.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!r.transaction_id)return s.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const i=e.getType();if(i===a.REQUEST_TYPE){if(!Number.isFinite(r.timestamp))return s.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&r.from_device==t.getDeviceId())return s.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return a.VerificationRequest.validateEvent(i,e,t)}getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t,r=!1){const i=e.getType(),n=e.getContent();if(i===a.REQUEST_TYPE||i===a.READY_TYPE||i===a.START_TYPE){this.transactionId||(this.transactionId=n.transaction_id);const e=n.from_device;if(!this.deviceId&&this.devices.includes(e)&&(this.deviceId=e),!this.deviceId||this.deviceId!==e){const t=this.completeContent(a.CANCEL_TYPE,(0,c.errorFromEvent)((0,c.newUnexpectedMessageError)()));return this.sendToDevices(a.CANCEL_TYPE,t,[e])}}const o=t.phase===a.PHASE_STARTED||t.phase===a.PHASE_READY;await t.handleEvent(e.getType(),e,r,!1,!1);const s=t.phase===a.PHASE_STARTED||t.phase===a.PHASE_READY;if((i===a.START_TYPE||i===a.READY_TYPE)&&!o&&s&&this.deviceId){const e=this.devices.filter((e=>e!==this.deviceId&&e!==this.client.getDeviceId()));if(e.length){const t=this.completeContent(a.CANCEL_TYPE,{code:"m.accepted",reason:"Verification request accepted by another device"});await this.sendToDevices(a.CANCEL_TYPE,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==a.REQUEST_TYPE&&e!==a.READY_TYPE&&e!==a.START_TYPE||(t.from_device=this.client.getDeviceId()),e===a.REQUEST_TYPE&&(t.timestamp=Date.now()),t}send(e,t={}){e!==a.REQUEST_TYPE&&e!==a.START_TYPE||this.transactionId||(this.transactionId=u.makeTransactionId());const r=this.completeContent(e,t);return this.sendCompleted(e,r)}async sendCompleted(e,t){let r;r=e===a.REQUEST_TYPE||e===a.CANCEL_TYPE&&!this.deviceId?await this.sendToDevices(e,t,this.devices):await this.sendToDevices(e,t,[this.deviceId]);const i=new l.MatrixEvent({sender:this.client.getUserId(),content:t,type:e});return await this.request.handleEvent(e,i,!0,!0,!0),r}async sendToDevices(e,t,r){if(r.length){const i={};for(const e of r)i[e]=t;await this.client.sendToDevice(e,{[this.userId]:i})}}static makeTransactionId(){return(0,o.randomString)(32)}}e.exports.ToDeviceChannel=u;e.exports.ToDeviceRequests=class{constructor(){(0,n.default)(this,"requestsByUserId",new Map)}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),u.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){const r=this.requestsByUserId.get(e);if(r)return r.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),u.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,r){let i=this.requestsByUserId.get(e);i||(i=new Map,this.requestsByUserId.set(e,i)),i.set(t,r)}removeRequest(e){const t=e.getSender(),r=this.requestsByUserId.get(t);r&&(r.delete(u.getTransactionId(e)),0===r.size&&this.requestsByUserId.delete(t))}findRequestInProgress(e,t){const r=this.requestsByUserId.get(e);if(r)for(const e of r.values())if(e.pending&&e.channel.isToDevices(t))return e}getRequestsInProgress(e){const t=this.requestsByUserId.get(e);return t?Array.from(t.values()).filter((e=>e.pending)):[]}}})),i.register("rPjr2",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IllegalMethod=void 0;var n=r(i("3EUCw")),o=i("gPlsH");class s extends o.VerificationBase{constructor(...e){super(...e),(0,n.default)(this,"doVerification",(async()=>{throw new Error("Verification is not possible with this method")}))}static factory(e,t,r,i,n,o){return new s(e,t,r,i,n,o)}static get NAME(){return"org.matrix.illegal_method"}}e.exports.IllegalMethod=s})),i.register("ctOxk",(function(e,t){var n=i("awmEs").Buffer,o=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DehydrationManager=e.exports.DEHYDRATION_ALGORITHM=void 0;var s=o(i("3EUCw")),a=o(i("1nB6h")),c=i("dvbGC"),l=i("gH6iW"),u=i("cCj6D"),h=i("gEWrD"),d=i("cH9or");const f="org.matrix.msc2697.v1.olm.libolm_pickle";e.exports.DEHYDRATION_ALGORITHM=f;const p=6048e5;e.exports.DehydrationManager=class{constructor(e){this.crypto=e,(0,s.default)(this,"inProgress",!1),(0,s.default)(this,"timeoutId",void 0),(0,s.default)(this,"key",void 0),(0,s.default)(this,"keyInfo",void 0),(0,s.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}getDehydrationKeyFromCache(){return this.crypto.cryptoStore.doTxn("readonly",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.getSecretStorePrivateKey(e,(async e=>{if(e){const{key:t,keyInfo:i,deviceDisplayName:o,time:s}=e,a=n.from(this.crypto.olmDevice.pickleKey),l=await(0,u.decryptAES)(t,a,f);this.key=(0,c.decodeBase64)(l),this.keyInfo=i,this.deviceDisplayName=o;const h=Date.now(),d=Math.max(1,s+p-h);this.timeoutId=r.setTimeout(this.dehydrateDevice.bind(this),d)}}),"dehydration")}))}async setKeyAndQueueDehydration(e,t={},r){await this.setKey(e,t,r)||this.dehydrateDevice()}async setKey(e,t={},i){if(!e)return this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)})),this.key=void 0,void(this.keyInfo=void 0);let n=!!this.key&&e.length==this.key.length;for(let t=0;n&&t<e.length;t++)e[t]!=this.key[t]&&(n=!1);return n||(this.key=e,this.keyInfo=t,this.deviceDisplayName=i),n}async dehydrateDevice(){if(this.inProgress)h.logger.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const e=n.from(this.crypto.olmDevice.pickleKey),t=await(0,u.encryptAES)((0,c.encodeBase64)(this.key),e,f);await this.crypto.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:this.keyInfo,key:t,deviceDisplayName:this.deviceDisplayName,time:Date.now()})})),h.logger.log("Attempting to dehydrate device"),h.logger.log("Creating account");const i=new r.Olm.Account;i.create();const o=JSON.parse(i.identity_keys()),s=i.max_number_of_one_time_keys();i.generate_one_time_keys(s/2),i.generate_fallback_key();const m=JSON.parse(i.one_time_keys()),g=JSON.parse(i.fallback_key());i.mark_keys_as_published();const v=i.pickle(new Uint8Array(this.key)),y={algorithm:f,account:v};this.keyInfo.passphrase&&(y.passphrase=this.keyInfo.passphrase),h.logger.log("Uploading account to server");const b=(await this.crypto.baseApis.http.authedRequest(d.Method.Put,"/dehydrated_device",void 0,{device_data:y,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;h.logger.log("Preparing device keys",b);const w={algorithms:this.crypto.supportedAlgorithms,device_id:b,user_id:this.crypto.userId,keys:{[`ed25519:${b}`]:o.ed25519,[`curve25519:${b}`]:o.curve25519}},_=i.sign(a.default.stringify(w));w.signatures={[this.crypto.userId]:{[`ed25519:${b}`]:_}},this.crypto.crossSigningInfo.getId("self_signing")&&await this.crypto.crossSigningInfo.signObject(w,"self_signing"),h.logger.log("Preparing one-time keys");const S={};for(const[e,t]of Object.entries(m.curve25519)){const r={key:t},n=i.sign(a.default.stringify(r));r.signatures={[this.crypto.userId]:{[`ed25519:${b}`]:n}},S[`signed_curve25519:${e}`]=r}h.logger.log("Preparing fallback keys");const E={};for(const[e,t]of Object.entries(g.curve25519)){const r={key:t,fallback:!0},n=i.sign(a.default.stringify(r));r.signatures={[this.crypto.userId]:{[`ed25519:${b}`]:n}},E[`signed_curve25519:${e}`]=r}return h.logger.log("Uploading keys to server"),await this.crypto.baseApis.http.authedRequest(d.Method.Post,"/keys/upload/"+encodeURI(b),void 0,{device_keys:w,one_time_keys:S,"org.matrix.msc2732.fallback_keys":E}),h.logger.log("Done dehydrating"),this.timeoutId=r.setTimeout(this.dehydrateDevice.bind(this),p),b}finally{this.inProgress=!1}}}stop(){this.timeoutId&&(r.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}})),i.register("bdffL",(function(e,t){var n=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.algorithmsByName=e.exports.DefaultAlgorithm=e.exports.Curve25519=e.exports.BackupManager=e.exports.Aes256=void 0;var o=n(i("3EUCw")),s=i("5pxqF"),a=i("gEWrD"),c=i("dvbGC"),l=i("1AObg"),u=i("gjhRv"),h=i("gH6iW"),d=i("iyAPZ"),f=i("cCj6D"),p=i("1c8ok"),m=i("l5WvI"),g=i("cNkid"),v=i("cH9or");class y{constructor(e,t){this.baseApis=e,this.getKey=t,(0,o.default)(this,"algorithm",void 0),(0,o.default)(this,"backupInfo",void 0),(0,o.default)(this,"checkedForBackup",void 0),(0,o.default)(this,"sendingBackups",void 0),(0,o.default)(this,"sessionLastCheckAttemptedTime",{}),this.checkedForBackup=!1,this.sendingBackups=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(e){const t=S[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!=typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}static makeAlgorithm(e,t){const r=S[e.algorithm];if(!r)throw new Error("Unknown backup algorithm");return r.init(e.auth_data,t)}async enableKeyBackup(e){this.backupInfo=e,this.algorithm&&this.algorithm.free(),this.algorithm=await y.makeAlgorithm(e,this.getKey),this.baseApis.emit(m.CryptoEvent.KeyBackupStatus,!0),this.scheduleKeyBackupSend()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit(m.CryptoEvent.KeyBackupStatus,!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}async prepareKeyBackupVersion(e,t){const r=t?S[t]:E;if(!r)throw new Error("Unknown backup algorithm");const[i,n]=await r.prepare(e),o=(0,d.encodeRecoveryKey)(i);return{algorithm:r.algorithmName,auth_data:n,recovery_key:o,privateKey:i}}async createKeyBackupVersion(e){this.algorithm=await y.makeAlgorithm(e,this.getKey)}async checkAndStart(){if(a.logger.log("Checking key backup status..."),this.baseApis.isGuest())return a.logger.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let e;try{var t;e=null!==(t=await this.baseApis.getKeyBackupVersion())&&void 0!==t?t:void 0}catch(e){return a.logger.log("Error checking for active key backup",e),404===e.httpStatus&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const r=await this.isKeyBackupTrusted(e);return r.usable&&!this.backupInfo?(a.logger.log(`Found usable key backup v${e.version}: enabling key backups`),await this.enableKeyBackup(e)):!r.usable&&this.backupInfo?(a.logger.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):r.usable||this.backupInfo?r.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(a.logger.log(`On backup version ${this.backupInfo.version} but found version ${e.version}: switching.`),this.disableKeyBackup(),await this.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):a.logger.log(`Backup version ${e.version} still current`)):a.logger.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:r}}async checkKeyBackup(){return this.checkedForBackup=!1,this.checkAndStart()}async queryKeyBackupRateLimited(e,t){if(!this.backupInfo)return;const r=(new Date).getTime();(!this.sessionLastCheckAttemptedTime[t]||r-this.sessionLastCheckAttemptedTime[t]>5e3)&&(this.sessionLastCheckAttemptedTime[t]=r,await this.baseApis.restoreKeyBackupWithCache(e,t,this.backupInfo,{}))}async isKeyBackupTrusted(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.signatures))return a.logger.info("Key backup is absent or missing required data"),t;const r=this.baseApis.getUserId(),i=await this.baseApis.crypto.getSessionBackupPrivateKey();if(i){let r=null;try{r=await y.makeAlgorithm(e,(async()=>i)),await r.keyMatches(i)&&(a.logger.info("Backup is trusted locally"),t.trusted_locally=!0)}catch{}finally{var n;null===(n=r)||void 0===n||n.free()}}const o=e.auth_data.signatures[r]||{};for(const i of Object.keys(o)){const n=i.split(":");if("ed25519"!==n[0]){a.logger.log("Ignoring unknown signature type: "+n[0]);continue}const o={deviceId:n[1]},s=this.baseApis.crypto.crossSigningInfo.getId();if(s===o.deviceId){o.crossSigningId=!0;try{await(0,c.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,r,o.deviceId,s),o.valid=!0}catch(e){a.logger.warn("Bad signature from cross signing key "+s,e),o.valid=!1}t.sigs.push(o);continue}const l=this.baseApis.crypto.deviceList.getStoredDevice(r,o.deviceId);if(l){o.device=l,o.deviceTrust=this.baseApis.checkDeviceTrust(r,o.deviceId);try{await(0,c.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,r,l.deviceId,l.getFingerprint()),o.valid=!0}catch(t){a.logger.info("Bad signature from key ID "+i+" userID "+this.baseApis.getUserId()+" device ID "+l.deviceId+" fingerprint: "+l.getFingerprint(),e.auth_data,t),o.valid=!1}}else o.valid=null,a.logger.info("Ignoring signature from unknown key "+i);t.sigs.push(o)}return t.usable=t.sigs.some((e=>{var t;return e.valid&&(e.device&&(null===(t=e.deviceTrust)||void 0===t?void 0:t.isVerified())||e.crossSigningId)})),t}async scheduleKeyBackupSend(e=1e4){if(!this.sendingBackups){this.sendingBackups=!0;try{const t=Math.random()*e;await(0,u.sleep)(t);let r=0;for(;;){if(!this.algorithm)return;try{if(0===await this.backupPendingKeys(200))return;r=0}catch(e){if(r++,a.logger.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.baseApis.crypto.emit(m.CryptoEvent.KeyBackupFailed,e.data.errcode),e}r&&await(0,u.sleep)(1e3*Math.pow(2,Math.min(r-1,4)))}}finally{this.sendingBackups=!1}}}async backupPendingKeys(e){const t=await this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let r=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit(m.CryptoEvent.KeyBackupSessionsRemaining,r);const i={};for(const e of t){var n;const t=e.sessionData.room_id;void 0===i[t]&&(i[t]={sessions:{}});const r=this.baseApis.crypto.olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);r.algorithm=c.MEGOLM_ALGORITHM;const o=(r.forwarding_curve25519_key_chain||[]).length,s=this.baseApis.crypto.deviceList.getUserByIdentityKey(c.MEGOLM_ALGORITHM,e.senderKey),a=null!==(n=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(c.MEGOLM_ALGORITHM,e.senderKey))&&void 0!==n?n:void 0,l=this.baseApis.crypto.checkDeviceInfoTrust(s,a).isVerified();i[t].sessions[e.sessionId]={first_message_index:r.first_known_index,forwarded_count:o,is_verified:l,session_data:await this.algorithm.encryptSession(r)}}return await this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:i}),await this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(t),r=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit(m.CryptoEvent.KeyBackupSessionsRemaining,r),t.length}async backupGroupSession(e,t){await this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}]),this.backupInfo&&this.scheduleKeyBackupSend()}async scheduleAllGroupSessionsForBackup(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)}async flagAllGroupSessionsForBackup(){await this.baseApis.crypto.cryptoStore.doTxn("readwrite",[h.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,h.IndexedDBCryptoStore.STORE_BACKUP],(e=>{this.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(e,(t=>{null!==t&&this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([t],e)}))}));const e=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit(m.CryptoEvent.KeyBackupSessionsRemaining,e),e}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}e.exports.BackupManager=y;class b{constructor(e,t,r){this.authData=e,this.publicKey=t,this.getKey=r}static async init(e,t){if(!e||!("public_key"in e))throw new Error("auth_data missing required information");const i=new r.Olm.PkEncryption;return i.set_recipient_key(e.public_key),new b(e,i,t)}static async prepare(e){const t=new r.Olm.PkDecryption;try{const i={};if(e)if(e instanceof Uint8Array)i.public_key=t.init_with_private_key(e);else{const r=await(0,l.keyFromPassphrase)(e);i.private_key_salt=r.salt,i.private_key_iterations=r.iterations,i.public_key=t.init_with_private_key(r.key)}else i.public_key=t.generate_key();return(new r.Olm.PkEncryption).set_recipient_key(i.public_key),[t.get_private_key(),i]}finally{t.free()}}static checkBackupVersion(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,this.publicKey.encrypt(JSON.stringify(t))}async decryptSessions(e){const t=await this.getKey(),i=new r.Olm.PkDecryption;try{if(i.init_with_private_key(t)!==this.authData.public_key)throw new v.MatrixError({errcode:s.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY});const r=[];for(const[t,n]of Object.entries(e))try{const e=JSON.parse(i.decrypt(n.session_data.ephemeral,n.session_data.mac,n.session_data.ciphertext));e.session_id=t,r.push(e)}catch(e){a.logger.log("Failed to decrypt megolm session from backup",e,n)}return r}finally{i.free()}}async keyMatches(e){const t=new r.Olm.PkDecryption;let i;try{i=t.init_with_private_key(e)}finally{t.free()}return i===this.authData.public_key}free(){this.publicKey.free()}}e.exports.Curve25519=b,(0,o.default)(b,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");const w=new p.UnstableValue("m.megolm_backup.v1.aes-hmac-sha2","org.matrix.msc3270.v1.aes-hmac-sha2");class _{constructor(e,t){this.authData=e,this.key=t}static async init(e,t){if(!e)throw new Error("auth_data missing");const r=await t();if(e.mac){const{mac:t}=await(0,f.calculateKeyCheck)(r,e.iv);if(e.mac.replace(/=+$/g,"")!==t.replace(/=+/g,""))throw new Error("Key does not match")}return new _(e,r)}static async prepare(e){let t;const r={};if(e)if(e instanceof Uint8Array)t=new Uint8Array(e);else{const i=await(0,l.keyFromPassphrase)(e);r.private_key_salt=i.salt,r.private_key_iterations=i.iterations,t=i.key}else t=function(e){const t=new Uint8Array(e);return g.crypto.getRandomValues(t),t}(32);const{iv:i,mac:n}=await(0,f.calculateKeyCheck)(t);return r.iv=i,r.mac=n,[t,r]}static checkBackupVersion(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,(0,f.encryptAES)(JSON.stringify(t),this.key,e.session_id)}async decryptSessions(e){const t=[];for(const[r,i]of Object.entries(e))try{const e=JSON.parse(await(0,f.decryptAES)(i.session_data,this.key,r));e.session_id=r,t.push(e)}catch(e){a.logger.log("Failed to decrypt megolm session from backup",e,i)}return t}async keyMatches(e){if(this.authData.mac){const{mac:t}=await(0,f.calculateKeyCheck)(e,this.authData.iv);return this.authData.mac.replace(/=+$/g,"")===t.replace(/=+/g,"")}return!0}free(){this.key.fill(0)}}e.exports.Aes256=_,(0,o.default)(_,"algorithmName",w.name);const S={[b.algorithmName]:b,[_.algorithmName]:_};e.exports.algorithmsByName=S;const E=b;e.exports.DefaultAlgorithm=E})),i.register("4BsMv",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SearchResult=void 0;var r=i("kSVe7");class n{static fromJson(e,t){const i=e.context||{};let o=(i.events_before||[]).map(t),s=(i.events_after||[]).map(t);const a=new r.EventContext(t(e.result)),c=a.ourEvent.threadRootId;return o=o.filter((e=>e.threadRootId===c)),s=s.filter((e=>e.threadRootId===c)),a.setPaginateToken(i.start,!0),a.addEvents(o,!0),a.addEvents(s,!1),a.setPaginateToken(i.end,!1),new n(e.rank,a)}constructor(e,t){this.rank=e,this.context=t}}e.exports.SearchResult=n})),i.register("kSVe7",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.EventContext=void 0;var n=r(i("3EUCw")),o=i("jxKcy");e.exports.EventContext=class{constructor(e){this.ourEvent=e,(0,n.default)(this,"timeline",void 0),(0,n.default)(this,"ourEventIndex",0),(0,n.default)(this,"paginateTokens",{[o.Direction.Backward]:null,[o.Direction.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(e=!1){return this.paginateTokens[e?o.Direction.Backward:o.Direction.Forward]}setPaginateToken(e,t=!1){this.paginateTokens[t?o.Direction.Backward:o.Direction.Forward]=null!=e?e:null}addEvents(e,t=!1){t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}})),i.register("8ersy",(function(e,t){let r;var i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.CrossSigningKey=void 0,e.exports.CrossSigningKey=r,(i=r||(e.exports.CrossSigningKey=r={})).Master="master",i.SelfSigning="self_signing",i.UserSigning="user_signing"})),i.register("8JM9X",(function(e,t){let r;var i;let n;var o;let s;var a;let c;let l;var u;let h;var d;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Visibility=e.exports.RestrictedAllowType=e.exports.Preset=e.exports.JoinRule=e.exports.HistoryVisibility=e.exports.GuestAccess=void 0,e.exports.Visibility=r,(i=r||(e.exports.Visibility=r={})).Public="public",i.Private="private",e.exports.Preset=n,(o=n||(e.exports.Preset=n={})).PrivateChat="private_chat",o.TrustedPrivateChat="trusted_private_chat",o.PublicChat="public_chat",e.exports.JoinRule=s,(a=s||(e.exports.JoinRule=s={})).Public="public",a.Invite="invite",a.Private="private",a.Knock="knock",a.Restricted="restricted",e.exports.RestrictedAllowType=c,(c||(e.exports.RestrictedAllowType=c={})).RoomMembership="m.room_membership",e.exports.GuestAccess=l,(u=l||(e.exports.GuestAccess=l={})).CanJoin="can_join",u.Forbidden="forbidden",e.exports.HistoryVisibility=h,(d=h||(e.exports.HistoryVisibility=h={})).Invited="invited",d.Joined="joined",d.Shared="shared",d.WorldReadable="world_readable"})),i.register("2RTzj",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.eventMapperFor=function(e,t){let r=Boolean(t.preventReEmit);const i=!1!==t.decrypt;return function n(a){t.toDevice&&delete a.room_id;const l=e.getRoom(a.room_id);let u;l&&void 0===a.state_key&&(u=l.findEventById(a.event_id)),!u||u.status?u=new o.MatrixEvent(a):(u.setUnsigned(c(c({},u.getUnsigned()),a.unsigned)),r=!0);const h=u.getServerAggregatedRelation(s.RelationType.Replace);if(null!=h&&h.content){const e=n(h);u.makeReplaced(e)}const d=null==l?void 0:l.findThreadForEvent(u);return d&&u.setThread(d),u.isEncrypted()&&(r||e.reEmitter.reEmit(u,[o.MatrixEventEvent.Decrypted]),i&&e.decryptEventIfNeeded(u)),r||(e.reEmitter.reEmit(u,[o.MatrixEventEvent.Replaced,o.MatrixEventEvent.VisibilityChange]),null==l||l.reEmitter.reEmit(u,[o.MatrixEventEvent.BeforeRedaction])),u}};var n=r(i("3EUCw")),o=i("7BSj1"),s=i("ldT3p");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}})),i.register("ksd78",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TreePermissions=e.exports.MSC3089TreeSpace=e.exports.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;var n=r(i("3EUCw")),o=r(i("1q9CE")),s=i("ldT3p"),a=i("gEWrD"),c=i("gjhRv"),l=i("8L1dU"),u=i("bTMh7");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const f={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[s.EventType.RoomPowerLevels]:100,[s.EventType.RoomHistoryVisibility]:100,[s.EventType.RoomTombstone]:100,[s.EventType.RoomEncryption]:100,[s.EventType.RoomName]:50,[s.EventType.RoomMessage]:50,[s.EventType.RoomMessageEncrypted]:50,[s.EventType.Sticker]:50},users:{}};let p;var m;e.exports.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=f,e.exports.TreePermissions=p,(m=p||(e.exports.TreePermissions=p={})).Viewer="viewer",m.Editor="editor",m.Owner="owner";e.exports.MSC3089TreeSpace=class{constructor(e,t){if(this.client=e,this.roomId=t,(0,n.default)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const e=this.room.currentState.getStateEvents(s.EventType.SpaceParent);return null==e||!e.length||e.every((e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}async setName(e){await this.client.sendStateEvent(this.roomId,s.EventType.RoomName,{name:e},"")}async invite(e,t=!0,r=!0){const i=[this.retryInvite(e)];return t&&i.push(...this.getDirectories().map((i=>i.invite(e,t,r)))),Promise.all(i).then((()=>{r&&(0,u.isRoomSharedHistory)(this.room)&&this.client.sendSharedHistoryKeys(this.roomId,[e])}))}retryInvite(e){return(0,c.simpleRetryOperation)((async()=>{await this.client.invite(this.roomId,e).catch((e=>{if("M_FORBIDDEN"===(null==e?void 0:e.errcode))throw new o.default.AbortError(e);throw e}))}))}async setPermissions(e,t){var r;const i=this.room.currentState.getStateEvents(s.EventType.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");const n=(null==i?void 0:i.getContent())||{},o=n.users_default||0,a=n.events_default||50,c=(null===(r=n.events)||void 0===r?void 0:r[s.EventType.RoomPowerLevels])||100,l=n.users||{};switch(t){case p.Viewer:l[e]=o;break;case p.Editor:l[e]=a;break;case p.Owner:l[e]=c;break;default:throw new Error("Invalid role: "+t)}n.users=l,await this.client.sendStateEvent(this.roomId,s.EventType.RoomPowerLevels,n,"")}getPermissions(e){var t,r;const i=this.room.currentState.getStateEvents(s.EventType.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");const n=(null==i?void 0:i.getContent())||{},o=n.users_default||0,a=n.events_default||50,c=(null===(t=n.events)||void 0===t?void 0:t[s.EventType.RoomPowerLevels])||100,l=(null===(r=n.users)||void 0===r?void 0:r[e])||o;return l>=c?p.Owner:l>=a?p.Editor:p.Viewer}async createDirectory(e){const t=await this.client.unstableCreateFileTree(e);return await this.client.sendStateEvent(this.roomId,s.EventType.SpaceChild,{via:[this.client.getDomain()]},t.roomId),await this.client.sendStateEvent(t.roomId,s.EventType.SpaceParent,{via:[this.client.getDomain()]},this.roomId),t}getDirectories(){const e=[],t=this.room.currentState.getStateEvents(s.EventType.SpaceChild);for(const r of t)try{const t=r.getStateKey();if(t){const r=this.client.unstableGetFileTreeSpace(t);r&&e.push(r)}}catch(e){a.logger.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find((t=>t.roomId===e))}async delete(){const e=this.getDirectories();for(const t of e)await t.delete();const t=["invite","knock","join"],r=this.room.currentState.getStateEvents(s.EventType.RoomMember);for(const e of r){if(e.getStateKey()!==this.client.getUserId()&&t.includes(e.getContent().membership)){const t=e.getStateKey();if(!t)throw new Error("State key not found for branch");await this.client.kick(this.roomId,t,"Room deleted")}}await this.client.leave(this.roomId)}getOrderedChildren(e){const t=e.map((e=>({roomId:e.getStateKey(),order:e.getContent().order}))).filter((e=>e.roomId));return t.sort(((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return(0,c.lexicographicCompare)(e.order,t.order);{var r,i,n,o;const a=this.client.getRoom(e.roomId),l=this.client.getRoom(t.roomId);if(!a||!l)return(0,c.lexicographicCompare)(e.roomId,t.roomId);const u=null!==(r=null===(i=a.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===i?void 0:i.getTs())&&void 0!==r?r:0,h=null!==(n=null===(o=l.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===o?void 0:o.getTs())&&void 0!==n?n:0;return u===h?(0,c.lexicographicCompare)(e.roomId,t.roomId):u-h}})),t}getParentRoom(){const e=this.room.currentState.getStateEvents(s.EventType.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");const t=e.getStateKey();if(!t)throw new Error("No state key found for parent");const r=this.client.getRoom(t);if(!r)throw new Error("Unable to locate room for parent");return r}getOrder(){if(this.isTopLevel)return-1;const e=this.getParentRoom().currentState.getStateEvents(s.EventType.SpaceChild);return this.getOrderedChildren(e).findIndex((e=>e.roomId===this.roomId))}async setOrder(e){var t;if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const r=this.getParentRoom(),i=r.currentState.getStateEvents(s.EventType.SpaceChild),n=this.getOrderedChildren(i);e=Math.max(Math.min(e,n.length-1),0);const o=this.getOrder()<e;o&&e===n.length-1?e--:o||0!==e||e++;const a=n[o?e:e-1],l=n[o?e+1:e];let u=c.DEFAULT_ALPHABET[0],h=!1;if(a)if(e===n.length-1)null!=l&&l.order&&(u=(0,c.nextString)(l.order));else{const e=null==a?void 0:a.order,t=null==l?void 0:l.order;e&&t?u=e===t?(0,c.nextString)(e):(0,c.averageBetweenStrings)(e,t):e?u=(0,c.nextString)(e):t?u=(0,c.prevString)(t):h=!0}else null!=l&&l.order&&(u=(0,c.prevString)(l.order));if(h){let t;for(let i=0;i<=e;i++){const e=n[i];if(0===i&&(t=e.order),e.order)t=e.order;else{var f;t=t?(0,c.nextString)(t):c.DEFAULT_ALPHABET[0];const i=r.currentState.getStateEvents(s.EventType.SpaceChild,e.roomId),n=null!==(f=null==i?void 0:i.getContent())&&void 0!==f?f:{via:[this.client.getDomain()]};await this.client.sendStateEvent(r.roomId,s.EventType.SpaceChild,d(d({},n),{},{order:t}),e.roomId)}}t&&(u=(0,c.nextString)(t))}const p=r.currentState.getStateEvents(s.EventType.SpaceChild,this.roomId),m=null!==(t=null==p?void 0:p.getContent())&&void 0!==t?t:{via:[this.client.getDomain()]};await this.client.sendStateEvent(r.roomId,s.EventType.SpaceChild,d(d({},m),{},{order:u}),this.roomId)}async createFile(e,t,r,i){var n;const{content_uri:o}=await this.client.uploadContent(t,{includeFilename:!1});r.url=o;const a={msgtype:s.MsgType.File,body:e,url:o,file:r};(i=null!==(n=i)&&void 0!==n?n:{})["m.new_content"]&&(i["m.new_content"]=a);const c=await this.client.sendMessage(this.roomId,d(d(d({},i),a),{},{[s.UNSTABLE_MSC3089_LEAF.name]:{}}));return await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e},c.event_id),c}getFile(e){const t=this.room.currentState.getStateEvents(s.UNSTABLE_MSC3089_BRANCH.name,e);return t?new l.MSC3089Branch(this.client,t,this):null}listFiles(){return this.listAllFiles().filter((e=>e.isActive))}listAllFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(s.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==e?e:[]).map((e=>new l.MSC3089Branch(this.client,e,this)))}}})),i.register("8L1dU",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MSC3089Branch=void 0;var n=r(i("3EUCw")),o=i("ldT3p"),s=i("jxKcy");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.MSC3089Branch=class{constructor(e,t,r){this.client=e,this.indexEvent=t,this.directory=r}get id(){const e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}get roomId(){return this.indexEvent.getRoomId()}async delete(){await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,{},this.id),await this.client.redactEvent(this.roomId,this.id);const e=(await this.getVersionHistory())[1];e&&await e.delete()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}async setName(e){await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,c(c({},this.indexEvent.getContent()),{},{name:e}),this.id)}isLocked(){return this.indexEvent.getContent().locked||!1}async setLocked(e){await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,c(c({},this.indexEvent.getContent()),{},{locked:e}),this.id)}async getFileInfo(){const e=(await this.getFileEvent()).getOriginalContent().file,t=this.client.mxcUrlToHttp(e.url);if(!t)throw new Error(`No HTTP URL available for ${e.url}`);return{info:e,httpUrl:t}}async getFileEvent(){const e=this.client.getRoom(this.roomId);if(!e)throw new Error("Unknown room");let t=e.getUnfilteredTimelineSet().findEventById(this.id);for(;!t&&e.getLiveTimeline().getState(s.EventTimeline.BACKWARDS).paginationToken;)await this.client.scrollback(e,100),t=e.getUnfilteredTimelineSet().findEventById(this.id);if(!t)throw new Error("Failed to find event");return await this.client.decryptEventIfNeeded(t,{emit:!0,isRetry:!0}),t}async createNewVersion(e,t,r,i){const n=await this.directory.createFile(e,t,r,c(c({},null!=i?i:{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:o.RelationType.Replace,event_id:this.id}}));return await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e,version:this.version+1},n.event_id),await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,c(c({},this.indexEvent.getContent()),{},{active:!1}),this.id),n}async getVersionHistory(){const e=[];e.push(this);const t=this.client.getRoom(this.roomId);if(!t)throw new Error("Invalid or unknown room");const r=[...t.getLiveTimeline().getEvents()].reverse();let i,n=await this.getFileEvent();do{if(i=r.find((e=>e.replacingEventId()===n.getId())),i){const t=this.directory.getFile(i.getId());if(!t)break;e.push(t),n=i}}while(i);return e}}})),i.register("2jZ2n",(function(e,t){var r,i;let n;var o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SearchOrderBy=void 0,(i=r||(r={})).RoomId="room_id",i.Sender="sender",e.exports.SearchOrderBy=n,(o=n||(e.exports.SearchOrderBy=n={})).Recent="recent",o.Rank="rank"})),i.register("gF0zJ",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MediaHandlerEvent=e.exports.MediaHandler=void 0;var n=r(i("3EUCw")),o=i("75Qdj"),s=i("hadDF"),a=i("gEWrD");let c;e.exports.MediaHandlerEvent=c,(c||(e.exports.MediaHandlerEvent=c={})).LocalStreamsChanged="local_streams_changed";class l extends o.TypedEventEmitter{constructor(e){super(),this.client=e,(0,n.default)(this,"audioInput",void 0),(0,n.default)(this,"audioSettings",void 0),(0,n.default)(this,"videoInput",void 0),(0,n.default)(this,"localUserMediaStream",void 0),(0,n.default)(this,"userMediaStreams",[]),(0,n.default)(this,"screensharingStreams",[]),(0,n.default)(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,t){this.audioInput=e,this.videoInput=t}async setAudioInput(e){a.logger.info("Setting audio input to",e),this.audioInput!==e&&(this.audioInput=e,await this.updateLocalUsermediaStreams())}async setAudioSettings(e){a.logger.info("Setting audio settings to",e),this.audioSettings=Object.assign({},e),await this.updateLocalUsermediaStreams()}async setVideoInput(e){a.logger.info("Setting video input to",e),this.videoInput!==e&&(this.videoInput=e,await this.updateLocalUsermediaStreams())}async setMediaInputs(e,t){a.logger.log(`mediaHandler setMediaInputs audioInput: ${e} videoInput: ${t}`),this.audioInput=e,this.videoInput=t,await this.updateLocalUsermediaStreams()}async updateLocalUsermediaStreams(){if(0===this.userMediaStreams.length)return;const e=new Map;for(const t of this.client.callEventHandler.calls.values())e.set(t.callId,{audio:t.hasLocalUserMediaAudioTrack,video:t.hasLocalUserMediaVideoTrack});for(const e of this.userMediaStreams){a.logger.log(`mediaHandler stopping all tracks for stream ${e.id}`);for(const t of e.getTracks())t.stop()}this.userMediaStreams=[],this.localUserMediaStream=void 0;for(const t of this.client.callEventHandler.calls.values()){if(t.callHasEnded()||!e.has(t.callId))continue;const{audio:r,video:i}=e.get(t.callId);a.logger.log(`mediaHandler updateLocalUsermediaStreams getUserMediaStream call ${t.callId}`);const n=await this.getUserMediaStream(r,i);t.callHasEnded()||await t.updateLocalUsermediaStream(n)}for(const e of this.client.groupCallEventHandler.groupCalls.values()){if(!e.localCallFeed)continue;a.logger.log(`mediaHandler updateLocalUsermediaStreams getUserMediaStream groupCall ${e.groupCallId}`);const t=await this.getUserMediaStream(!0,e.type===s.GroupCallType.Video);e.state!==s.GroupCallState.Ended&&await e.updateLocalUsermediaStream(t)}this.emit(c.LocalStreamsChanged)}async hasAudioDevice(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)).length>0}async hasVideoDevice(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length>0}async getUserMediaStream(e,t,r=!0){return this.getMediaStreamPromise?this.getMediaStreamPromise=this.getMediaStreamPromise.then((()=>this.getUserMediaStreamInternal(e,t,r))):this.getMediaStreamPromise=this.getUserMediaStreamInternal(e,t,r),this.getMediaStreamPromise}async getUserMediaStreamInternal(e,t,r){const i=e&&await this.hasAudioDevice(),n=t&&await this.hasVideoDevice();let o,s=!0;var l,u,h,d;this.localUserMediaStream?(i!==this.localUserMediaStream.getAudioTracks().length>0&&(s=!1),n!==this.localUserMediaStream.getVideoTracks().length>0&&(s=!1),i&&(null===(l=this.localUserMediaStream.getAudioTracks()[0])||void 0===l||null===(u=l.getSettings())||void 0===u?void 0:u.deviceId)!==this.audioInput&&(s=!1),n&&(null===(h=this.localUserMediaStream.getVideoTracks()[0])||void 0===h||null===(d=h.getSettings())||void 0===d?void 0:d.deviceId)!==this.videoInput&&(s=!1)):s=!1;if(s){var f;if(o=this.localUserMediaStream.clone(),a.logger.log(`mediaHandler clone userMediaStream ${null===(f=this.localUserMediaStream)||void 0===f?void 0:f.id} new stream ${o.id} shouldRequestAudio ${i} shouldRequestVideo ${n}`),!i)for(const e of o.getAudioTracks())o.removeTrack(e);if(!n)for(const e of o.getVideoTracks())o.removeTrack(e)}else{const e=this.getUserMediaContraints(i,n);o=await navigator.mediaDevices.getUserMedia(e),a.logger.log(`mediaHandler getUserMediaStream streamId ${o.id} shouldRequestAudio ${i} shouldRequestVideo ${n}`,e);for(const e of o.getTracks()){const t=e.getSettings();"audio"===e.kind?this.audioInput=t.deviceId:"video"===e.kind&&(this.videoInput=t.deviceId)}r&&(this.localUserMediaStream=o)}return r&&this.userMediaStreams.push(o),this.emit(c.LocalStreamsChanged),o}stopUserMediaStream(e){a.logger.log(`mediaHandler stopUserMediaStream stopping stream ${e.id}`);for(const t of e.getTracks())t.stop();const t=this.userMediaStreams.indexOf(e);-1!==t&&(a.logger.debug("Splicing usermedia stream out stream array",e.id),this.userMediaStreams.splice(t,1)),this.emit(c.LocalStreamsChanged),this.localUserMediaStream===e&&(this.localUserMediaStream=void 0)}async getScreensharingStream(e={},t=!0){let r;if(0===this.screensharingStreams.length){const t=this.getScreenshareContraints(e);e.desktopCapturerSourceId?(a.logger.debug("Getting screensharing stream using getUserMedia()",e),r=await navigator.mediaDevices.getUserMedia(t)):(a.logger.debug("Getting screensharing stream using getDisplayMedia()",e),r=await navigator.mediaDevices.getDisplayMedia(t))}else{const e=this.screensharingStreams[this.screensharingStreams.length-1];a.logger.log("Cloning screensharing stream",e.id),r=e.clone()}return t&&this.screensharingStreams.push(r),this.emit(c.LocalStreamsChanged),r}stopScreensharingStream(e){a.logger.debug("Stopping screensharing stream",e.id);for(const t of e.getTracks())t.stop();const t=this.screensharingStreams.indexOf(e);-1!==t&&(a.logger.debug("Splicing screensharing stream out stream array",e.id),this.screensharingStreams.splice(t,1)),this.emit(c.LocalStreamsChanged)}stopAllStreams(){for(const e of this.userMediaStreams){a.logger.log(`mediaHandler stopAllStreams stopping stream ${e.id}`);for(const t of e.getTracks())t.stop()}for(const e of this.screensharingStreams)for(const t of e.getTracks())t.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(c.LocalStreamsChanged)}getUserMediaContraints(e,t){const r=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}}}getScreenshareContraints(e){const{desktopCapturerSourceId:t,audio:r}=e;return t?(a.logger.debug("Using desktop capturer source",t),{audio:null!=r&&r,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t}}}):(a.logger.debug("Not using desktop capturer source"),{audio:null!=r&&r,video:!0})}}e.exports.MediaHandler=l})),i.register("6nR3T",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SlidingSyncSdk=void 0;var n=r(i("3EUCw")),o=i("846Vo"),s=i("gEWrD"),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),c=i("jxKcy"),l=i("5pxqF"),u=i("1dCYQ"),h=i("cH9or"),d=i("e6r9x"),f=i("ldT3p"),p=i("dpNo2"),m=i("l2mJP"),g=i("6koSf");function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}class y{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return d.ExtensionState.PreProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){if(e.device_lists&&await this.crypto.handleDeviceListChanges({oldSyncToken:"yep"},e.device_lists),e.device_one_time_keys_count){const t=e.device_one_time_keys_count.signed_curve25519||0;this.crypto.updateOneTimeKeyCount(t)}if(e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]){const t=e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"];this.crypto.setNeedsNewFallback(Array.isArray(t)&&!t.includes("signed_curve25519"))}this.crypto.onSyncCompleted({})}}class b{constructor(e,t){this.client=e,this.cryptoCallbacks=t,(0,n.default)(this,"nextBatch",null)}name(){return"to_device"}when(){return d.ExtensionState.PreProcess}onRequest(e){const t={since:null!==this.nextBatch?this.nextBatch:void 0};return e&&(t.limit=100,t.enabled=!0),t}async onResponse(e){const t=[];let r=e.events||[];r.length>0&&this.cryptoCallbacks&&(r=await this.cryptoCallbacks.preprocessToDeviceMessages(r)),r.map(this.client.getEventMapper()).map((e=>{if("m.key.verification.cancel"===e.getType()){const r=e.getContent().transaction_id;r&&t.push(r)}return e})).forEach((e=>{const r=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=r.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){const i=r.transaction_id;t.includes(i)&&e.flagCancelled()}this.client.emit(l.ClientEvent.ToDeviceEvent,e)}else s.logger.log("Ignoring undecryptable to-device event from "+e.getSender())})),this.nextBatch=e.next_batch}}class w{constructor(e){this.client=e}name(){return"account_data"}when(){return d.ExtensionState.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){e.global&&e.global.length>0&&this.processGlobalAccountData(e.global);for(const t in e.rooms){const r=E(this.client,t,e.rooms[t]),i=this.client.getRoom(t);i?(i.addAccountData(r),r.forEach((e=>{this.client.emit(l.ClientEvent.Event,e)}))):s.logger.warn("got account data for room but room doesn't exist on client:",t)}}processGlobalAccountData(e){const t=E(this.client,void 0,e),r=t.reduce(((e,t)=>(e[t.getType()]=this.client.store.getAccountData(t.getType()),e)),{});this.client.store.storeAccountDataEvents(t),t.forEach((e=>{if(e.getType()===f.EventType.PushRules){const t=e.getContent();this.client.pushRules=p.PushProcessor.rewriteDefaultRules(t)}const t=r[e.getType()];return this.client.emit(l.ClientEvent.AccountData,e,t),e}))}}class _{constructor(e){this.client=e}name(){return"typing"}when(){return d.ExtensionState.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){if(null!=e&&e.rooms)for(const t in e.rooms)M(this.client,t,[e.rooms[t]])}}class S{constructor(e){this.client=e}name(){return"receipts"}when(){return d.ExtensionState.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){if(null!=e&&e.rooms)for(const t in e.rooms)M(this.client,t,[e.rooms[t]])}}function E(e,t,r,i=!0){const n=e.getEventMapper({decrypt:i});return r.map((function(e){return e.room_id=t,n(e)}))}function M(e,t,r){const i=E(e,t,r),n=e.getRoom(t);n?(n.addEphemeralEvents(i),i.forEach((t=>{e.emit(l.ClientEvent.Event,t)}))):s.logger.warn("got ephemeral events for room but room doesn't exist on client:",t)}e.exports.SlidingSyncSdk=class{constructor(e,t,r,i){this.slidingSync=e,this.client=t,(0,n.default)(this,"opts",void 0),(0,n.default)(this,"syncOpts",void 0),(0,n.default)(this,"syncState",null),(0,n.default)(this,"syncStateData",void 0),(0,n.default)(this,"lastPos",null),(0,n.default)(this,"failCount",0),(0,n.default)(this,"notifEvents",[]),this.opts=(0,u.defaultClientOpts)(r),this.syncOpts=(0,u.defaultSyncApiOpts)(i),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[o.RoomEvent.Timeline,o.RoomEvent.TimelineReset]),this.slidingSync.on(d.SlidingSyncEvent.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(d.SlidingSyncEvent.RoomData,this.onRoomData.bind(this));const s=[new b(this.client,this.syncOpts.cryptoCallbacks),new w(this.client),new _(this.client),new S(this.client)];this.syncOpts.crypto&&s.push(new y(this.syncOpts.crypto)),s.forEach((e=>{this.slidingSync.registerExtension(e)}))}onRoomData(e,t){let r=this.client.store.getRoom(e);if(!r){if(!t.initial)return void s.logger.debug("initial flag not set but no stored room exists for room ",e,t);r=(0,u._createAndReEmitRoom)(this.client,e,this.opts)}this.processRoomData(this.client,r,t)}onLifecycle(e,t,r){switch(r&&s.logger.debug("onLifecycle",e,r),e){case d.SlidingSyncState.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(u.SyncState.Prepared,{oldSyncToken:void 0,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(u.SyncState.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case d.SlidingSyncState.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>3?u.SyncState.Error:u.SyncState.Reconnecting,{error:new h.MatrixError(r)}),this.shouldAbortSync(new h.MatrixError(r)))return}else this.failCount=0}}async syncLeftRooms(){return[]}async peek(e){return null}stopPeeking(){}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}createRoom(e){const{timelineSupport:t}=this.client,r=new o.Room(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:t});return this.client.reEmitter.reEmit(r,[o.RoomEvent.Name,o.RoomEvent.Redaction,o.RoomEvent.RedactionCancelled,o.RoomEvent.Receipt,o.RoomEvent.Tags,o.RoomEvent.LocalEchoUpdated,o.RoomEvent.AccountData,o.RoomEvent.MyMembership,o.RoomEvent.Timeline,o.RoomEvent.TimelineReset]),this.registerStateListeners(r),r}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[m.RoomStateEvent.Events,m.RoomStateEvent.Members,m.RoomStateEvent.NewMember,m.RoomStateEvent.Update]),e.currentState.on(m.RoomStateEvent.NewMember,((e,t,r)=>{var i;r.user=null!==(i=this.client.getUser(r.userId))&&void 0!==i?i:void 0,this.client.reEmitter.reEmit(r,[g.RoomMemberEvent.Name,g.RoomMemberEvent.Typing,g.RoomMemberEvent.PowerLevel,g.RoomMemberEvent.Membership])}))}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(s.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(u.SyncState.Error,{error:e}),!0)}async processRoomData(e,t,r){r=function(e,t,r){if(!r.name)return r;for(const e of r.required_state)if(e.type===f.EventType.RoomName&&""===e.state_key)return e.content={name:r.name},r;return r.required_state.push({event_id:"$fake-sliding-sync-name-event-"+t,state_key:"",type:f.EventType.RoomName,content:{name:r.name},sender:e.getUserId(),origin_server_ts:(new Date).getTime()}),r}(e,t.roomId,r);const i=E(this.client,t.roomId,r.required_state);let n=E(this.client,t.roomId,r.timeline,!1);const s=[];if(r.initial){const e=new Set;t.getLiveTimeline().getEvents().forEach((t=>{e.add(t.getId())}));const i=[],o=[];let s=!1;for(let t=n.length-1;t>=0;t--){const r=n[t];e.has(r.getId())?s=!0:s?i.push(r):o.unshift(r)}n=o,i.length>0&&t.addEventsToTimeline(i,!0,t.getLiveTimeline(),r.prev_batch)}const u=this.client.isRoomEncrypted(t.roomId);if(null!=r.notification_count&&t.setUnreadNotificationCount(o.NotificationCountType.Total,r.notification_count),null!=r.highlight_count&&(!u||u&&t.getUnreadNotificationCount(o.NotificationCountType.Highlight)<=0)&&t.setUnreadNotificationCount(o.NotificationCountType.Highlight,r.highlight_count),Number.isInteger(r.invited_count)&&t.currentState.setInvitedMemberCount(r.invited_count),Number.isInteger(r.joined_count)&&t.currentState.setJoinedMemberCount(r.joined_count),r.invite_state){const e=E(this.client,t.roomId,r.invite_state);return this.injectRoomEvents(t,e),r.initial&&(t.recalculate(),this.client.store.storeRoom(t),this.client.emit(l.ClientEvent.Room,t)),e.forEach((e=>{this.client.emit(l.ClientEvent.Event,e)})),void t.updateMyMembership("invite")}var h;r.initial&&t.getLiveTimeline().setPaginationToken(null!==(h=r.prev_batch)&&void 0!==h?h:null,c.EventTimeline.BACKWARDS);this.injectRoomEvents(t,i,n,r.num_live),t.addEphemeralEvents(s),t.updateMyMembership("join"),t.recalculate(),r.initial&&(e.store.storeRoom(t),e.emit(l.ClientEvent.Room,t)),this.addNotifications(n);const d=async r=>{e.emit(l.ClientEvent.Event,r),r.isState()&&r.getType()==f.EventType.RoomEncryption&&this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.onCryptoEvent(t,r)};await a.promiseMapSeries(i,d),await a.promiseMapSeries(n,d),s.forEach((function(t){e.emit(l.ClientEvent.Event,t)})),t.decryptCriticalEvents()}injectRoomEvents(e,t,r,i){r=r||[],t=t||[],i=i||0;const n=e.getLiveTimeline(),o=0==n.getEvents().length;if(o){for(const e of t)this.client.getPushActionsForEvent(e);n.initialiseState(t)}o||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t));let s=[];i>0&&(s=r.slice(-1*i),r=r.slice(0,-1*s.length)),e.addLiveEvents(r,{fromCache:!0}),s.length>0&&e.addLiveEvents(s,{fromCache:!1}),e.recalculate(),this.resolveInvites(e)}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(r){if(r.requestedProfileInfo)return;r.requestedProfileInfo=!0;const i=t.getUser(r.userId);let n;n=i?Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):t.getProfileInfo(r.userId),n.then((function(t){const i=r.events.member;"invite"===i.getContent().membership&&(i.getContent().avatar_url=t.avatar_url,i.getContent().displayname=t.displayname,r.setMembershipEvent(i,e.currentState))}),(function(e){}))}))}retryImmediately(){return!0}async sync(){for(s.logger.debug("Sliding sync init loop");!this.client.isGuest();)try{s.logger.debug("Getting push rules...");const e=await this.client.getPushRules();s.logger.debug("Got push rules"),this.client.pushRules=e;break}catch(e){if(s.logger.error("Getting push rules failed",e),this.shouldAbortSync(e))return}await this.slidingSync.start()}stop(){s.logger.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,t){const r=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(l.ClientEvent.Sync,this.syncState,r,t)}addNotifications(e){if(this.client.getNotifTimelineSet())for(const t of e){const e=this.client.getPushActionsForEvent(t);e&&e.notify&&e.tweaks&&e.tweaks.highlight&&this.notifEvents.push(t)}}purgeNotifications(){this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((e=>{var t;null===(t=this.client.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e)})),this.notifEvents=[]}}})),i.register("e6r9x",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SlidingSyncState=e.exports.SlidingSyncEvent=e.exports.SlidingSync=e.exports.MSC3575_WILDCARD=e.exports.MSC3575_STATE_KEY_ME=e.exports.MSC3575_STATE_KEY_LAZY=e.exports.ExtensionState=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("75Qdj"),a=i("gjhRv");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.exports.MSC3575_WILDCARD="*";e.exports.MSC3575_STATE_KEY_ME="$ME";let u;var h;e.exports.MSC3575_STATE_KEY_LAZY="$LAZY",e.exports.SlidingSyncState=u,(h=u||(e.exports.SlidingSyncState=u={})).RequestFinished="FINISHED",h.Complete="COMPLETE";class d{constructor(e){(0,n.default)(this,"list",void 0),(0,n.default)(this,"isModified",void 0),(0,n.default)(this,"roomIndexToRoomId",{}),(0,n.default)(this,"joinedCount",0),this.replaceList(e)}setModified(e){this.isModified=e}updateListRange(e){this.list.ranges=JSON.parse(JSON.stringify(e))}replaceList(e){e.filters=e.filters||{},e.ranges=e.ranges||[],this.list=JSON.parse(JSON.stringify(e)),this.isModified=!0,this.roomIndexToRoomId={},this.joinedCount=0}getList(e){let t={ranges:JSON.parse(JSON.stringify(this.list.ranges))};return(this.isModified||e)&&(t=JSON.parse(JSON.stringify(this.list))),t}isIndexInRange(e){for(const t of this.list.ranges)if(t[0]<=e&&e<=t[1])return!0;return!1}}let f;var p;let m;var g;e.exports.ExtensionState=f,(p=f||(e.exports.ExtensionState=f={})).PreProcess="ExtState.PreProcess",p.PostProcess="ExtState.PostProcess",e.exports.SlidingSyncEvent=m,(g=m||(e.exports.SlidingSyncEvent=m={})).RoomData="SlidingSync.RoomData",g.Lifecycle="SlidingSync.Lifecycle",g.List="SlidingSync.List";class v extends s.TypedEventEmitter{constructor(e,t,r,i,o){super(),this.proxyBaseUrl=e,this.roomSubscriptionInfo=r,this.client=i,this.timeoutMS=o,(0,n.default)(this,"lists",void 0),(0,n.default)(this,"listModifiedCount",0),(0,n.default)(this,"terminated",!1),(0,n.default)(this,"needsResend",!1),(0,n.default)(this,"txnId",null),(0,n.default)(this,"txnIdDefers",[]),(0,n.default)(this,"extensions",{}),(0,n.default)(this,"desiredRoomSubscriptions",new Set),(0,n.default)(this,"confirmedRoomSubscriptions",new Set),(0,n.default)(this,"customSubscriptions",new Map),(0,n.default)(this,"roomIdToCustomSubscription",new Map),(0,n.default)(this,"pendingReq",void 0),(0,n.default)(this,"abortController",void 0),this.lists=new Map,t.forEach(((e,t)=>{this.lists.set(t,new d(e))}))}addCustomSubscription(e,t){this.customSubscriptions.has(e)?o.logger.warn(`addCustomSubscription: ${e} already exists as a custom subscription, ignoring.`):this.customSubscriptions.set(e,t)}useCustomSubscription(e,t){this.roomIdToCustomSubscription.get(e)!==t&&(this.roomIdToCustomSubscription.set(e,t),this.confirmedRoomSubscriptions.delete(e))}getListData(e){const t=this.lists.get(e);return t?{joinedCount:t.joinedCount,roomIndexToRoomId:Object.assign({},t.roomIndexToRoomId)}:null}getListParams(e){const t=this.lists.get(e);return t?t.getList(!0):null}setListRanges(e,t){const r=this.lists.get(e);return r?(r.updateListRange(t),this.resend()):Promise.reject(new Error("no list with key "+e))}setList(e,t){const r=this.lists.get(e);return r?(r.replaceList(t),this.lists.set(e,r)):this.lists.set(e,new d(t)),this.listModifiedCount+=1,this.resend()}getRoomSubscriptions(){return new Set(Array.from(this.desiredRoomSubscriptions))}modifyRoomSubscriptions(e){return this.desiredRoomSubscriptions=e,this.resend()}modifyRoomSubscriptionInfo(e){return this.roomSubscriptionInfo=e,this.confirmedRoomSubscriptions=new Set,this.resend()}registerExtension(e){if(this.extensions[e.name()])throw new Error(`registerExtension: ${e.name()} already exists as an extension`);this.extensions[e.name()]=e}getExtensionRequest(e){const t={};return Object.keys(this.extensions).forEach((r=>{t[r]=this.extensions[r].onRequest(e)})),t}onPreExtensionsResponse(e){Object.keys(e).forEach((t=>{this.extensions[t].when()==f.PreProcess&&this.extensions[t].onResponse(e[t])}))}onPostExtensionsResponse(e){Object.keys(e).forEach((t=>{this.extensions[t].when()==f.PostProcess&&this.extensions[t].onResponse(e[t])}))}invokeRoomDataListeners(e,t){t.required_state||(t.required_state=[]),t.timeline||(t.timeline=[]),this.emit(m.RoomData,e,t)}invokeLifecycleListeners(e,t,r){this.emit(m.Lifecycle,e,t,r)}shiftRight(e,t,r){const i=this.lists.get(e);if(i)for(let e=t;e>r;e--)i.isIndexInRange(e)&&(i.roomIndexToRoomId[e]=i.roomIndexToRoomId[e-1])}shiftLeft(e,t,r){const i=this.lists.get(e);if(i)for(let e=r;e<t;e++)i.isIndexInRange(e)&&(i.roomIndexToRoomId[e]=i.roomIndexToRoomId[e+1])}removeEntry(e,t){const r=this.lists.get(e);if(!r)return;let i=-1;for(const e in r.roomIndexToRoomId)Number(e)>i&&(i=Number(e));i<0||t>i||(this.shiftLeft(e,i,t),delete r.roomIndexToRoomId[i])}addEntry(e,t){const r=this.lists.get(e);if(!r)return;let i=-1;for(const e in r.roomIndexToRoomId)Number(e)>i&&(i=Number(e));i<0||t>i||this.shiftRight(e,i+1,t)}processListOps(e,t){let r=-1;const i=this.lists.get(t);i&&(e.ops.forEach((e=>{if(i)switch(e.op){case"DELETE":o.logger.debug("DELETE",t,e.index,";"),delete i.roomIndexToRoomId[e.index],-1!==r&&this.removeEntry(t,r),r=e.index;break;case"INSERT":o.logger.debug("INSERT",t,e.index,e.room_id,";"),i.roomIndexToRoomId[e.index]&&(r<0?this.addEntry(t,e.index):r>e.index?this.shiftRight(t,r,e.index):r<e.index&&this.shiftLeft(t,e.index,r)),r=-1,i.roomIndexToRoomId[e.index]=e.room_id;break;case"INVALIDATE":for(let t=e.range[0];t<=e.range[1];t++)delete i.roomIndexToRoomId[t];o.logger.debug("INVALIDATE",t,e.range[0],e.range[1],";");break;case"SYNC":{const r=e.range[0];for(let t=r;t<=e.range[1];t++){const n=e.room_ids[t-r];if(!n)break;i.roomIndexToRoomId[t]=n}o.logger.debug("SYNC",t,e.range[0],e.range[1],(e.room_ids||[]).join(" "),";");break}}})),-1!==r&&this.removeEntry(t,r))}resend(){var e;if(this.needsResend&&this.txnIdDefers.length>0)return this.txnIdDefers[this.txnIdDefers.length-1].promise;this.needsResend=!0,this.txnId=this.client.makeTxnId();const t=(0,a.defer)();return this.txnIdDefers.push(l(l({},t),{},{txnId:this.txnId})),null===(e=this.abortController)||void 0===e||e.abort(),this.abortController=new AbortController,t.promise}resolveTransactionDefers(e){if(!e)return;let t=-1;for(let r=0;r<this.txnIdDefers.length;r++)if(this.txnIdDefers[r].txnId===e){t=r;break}if(-1!==t){for(let e=0;e<t;e++)this.txnIdDefers[e].reject(this.txnIdDefers[e].txnId);this.txnIdDefers[t].resolve(e),this.txnIdDefers=this.txnIdDefers.slice(t+1)}else o.logger.warn(`resolveTransactionDefers: seen ${e} but it isn't a pending txn, ignoring.`)}stop(){var e;this.terminated=!0,null===(e=this.abortController)||void 0===e||e.abort(),this.removeAllListeners(m.Lifecycle),this.removeAllListeners(m.List),this.removeAllListeners(m.RoomData)}resetup(){var e;o.logger.warn("SlidingSync: resetting connection info"),this.txnIdDefers.forEach((e=>{e.reject(e.txnId)})),this.txnIdDefers=[],this.lists.forEach((e=>{e.setModified(!0)})),this.confirmedRoomSubscriptions=new Set,this.needsResend=!0,null===(e=this.abortController)||void 0===e||e.abort(),this.abortController=new AbortController}async start(){let e;for(this.abortController=new AbortController;!this.terminated;){this.needsResend=!1;let t,r=!1;try{const i=this.listModifiedCount,n={};this.lists.forEach(((e,t)=>{n[t]=e.getList(!1)}));const s={lists:n,pos:e,timeout:this.timeoutMS,clientTimeout:this.timeoutMS+1e4,extensions:this.getExtensionRequest(void 0===e)},a=y(this.desiredRoomSubscriptions,this.confirmedRoomSubscriptions),c=y(this.confirmedRoomSubscriptions,this.desiredRoomSubscriptions);if(c.size>0&&(s.unsubscribe_rooms=Array.from(c)),a.size>0){s.room_subscriptions={};for(const e of a){const t=this.roomIdToCustomSubscription.get(e);let r=this.roomSubscriptionInfo;t&&this.customSubscriptions.has(t)&&(r=this.customSubscriptions.get(t)),s.room_subscriptions[e]=r}}this.txnId&&(s.txn_id=this.txnId,this.txnId=null),this.pendingReq=this.client.slidingSync(s,this.proxyBaseUrl,this.abortController.signal),t=await this.pendingReq,e=t.pos;for(const e of a)this.confirmedRoomSubscriptions.add(e);for(const e of c)this.confirmedRoomSubscriptions.delete(e);i!==this.listModifiedCount&&(o.logger.debug("list modified during await call, not updating list"),r=!0),this.lists.forEach((e=>{e.setModified(!1)})),t.lists=t.lists||{},t.rooms=t.rooms||{},t.extensions=t.extensions||{},Object.keys(t.lists).forEach((e=>{const r=this.lists.get(e);r&&t&&(r.joinedCount=t.lists[e].count)})),this.invokeLifecycleListeners(u.RequestFinished,t)}catch(t){if(t.httpStatus){if(this.invokeLifecycleListeners(u.RequestFinished,null,t),400===t.httpStatus){this.resetup(),e=void 0,await(0,a.sleep)(50);continue}}else if(this.needsResend||"AbortError"===t.name)continue;o.logger.error(t),await(0,a.sleep)(5e3)}if(!t)continue;this.onPreExtensionsResponse(t.extensions),Object.keys(t.rooms).forEach((e=>{this.invokeRoomDataListeners(e,t.rooms[e])}));const i=new Set;if(!r)for(const[e,r]of Object.entries(t.lists))r.ops=r.ops||[],r.ops.length>0&&i.add(e),this.processListOps(r,e);this.invokeLifecycleListeners(u.Complete,t),this.onPostExtensionsResponse(t.extensions),i.forEach((e=>{const t=this.lists.get(e);t&&this.emit(m.List,e,t.joinedCount,Object.assign({},t.roomIndexToRoomId))})),this.resolveTransactionDefers(t.txn_id)}}}e.exports.SlidingSync=v;const y=(e,t)=>{const r=new Set(e);for(const e of t)r.delete(e);return r}})),i.register("iuO3m",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.M_BEACON_INFO=e.exports.M_BEACON=void 0;var r=i("1c8ok");const n=new r.UnstableValue("m.beacon_info","org.matrix.msc3672.beacon_info");e.exports.M_BEACON_INFO=n;const o=new r.UnstableValue("m.beacon","org.matrix.msc3672.beacon");e.exports.M_BEACON=o})),i.register("cr5BD",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ToDeviceMessageQueue=void 0;var n=r(i("3EUCw")),o=i("ldT3p"),s=i("gEWrD"),a=i("5pxqF"),c=i("laezH"),l=i("1dCYQ");e.exports.ToDeviceMessageQueue=class{constructor(e){this.client=e,(0,n.default)(this,"sending",!1),(0,n.default)(this,"running",!0),(0,n.default)(this,"retryTimeout",null),(0,n.default)(this,"retryAttempts",0),(0,n.default)(this,"sendQueue",(async()=>{if(null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.sending||!this.running)return;let e;s.logger.debug("Attempting to send queued to-device messages"),this.sending=!0;try{for(;this.running&&(e=await this.client.store.getOldestToDeviceBatch(),null!==e);)await this.sendBatch(e),await this.client.store.removeToDeviceBatch(e.id),this.retryAttempts=0;if(!this.running)return;s.logger.debug("All queued to-device messages sent")}catch(t){++this.retryAttempts;const r=c.MatrixScheduler.RETRY_BACKOFF_RATELIMIT(null,this.retryAttempts,t);if(-1===r)return void(4===Math.floor(t.httpStatus/100)?(s.logger.error("Fatal error when sending to-device message - dropping to-device batch!",t),await this.client.store.removeToDeviceBatch(e.id)):s.logger.info("Automatic retry limit reached for to-device messages."));s.logger.info(`Failed to send batch of to-device messages. Will retry in ${r}ms`,t),this.retryTimeout=setTimeout(this.sendQueue,r)}finally{this.sending=!1}})),(0,n.default)(this,"onResumedSync",((e,t)=>{e===l.SyncState.Syncing&&t!==l.SyncState.Syncing&&(s.logger.info("Resuming queue after resumed sync"),this.sendQueue())}))}start(){this.running=!0,this.sendQueue(),this.client.on(a.ClientEvent.Sync,this.onResumedSync)}stop(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(a.ClientEvent.Sync,this.onResumedSync)}async queueBatch(e){const t=[];for(let r=0;r<e.batch.length;r+=20){const i={eventType:e.eventType,batch:e.batch.slice(r,r+20),txnId:this.client.makeTxnId()};t.push(i);const n=i.batch.map((e=>`${e.userId}/${e.deviceId} (msgid ${e.payload[o.ToDeviceMessageId]})`));s.logger.info(`Enqueuing batch of to-device messages. type=${e.eventType} txnid=${i.txnId}`,n)}await this.client.store.saveToDeviceBatches(t),this.sendQueue()}async sendBatch(e){const t={};for(const r of e.batch)t[r.userId]||(t[r.userId]={}),t[r.userId][r.deviceId]=r.payload;s.logger.info(`Sending batch of ${e.batch.length} to-device messages with ID ${e.id} and txnId ${e.txnId}`),await this.client.sendToDevice(e.eventType,t,e.txnId)}}})),i.register("laezH",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixScheduler=void 0;var n=r(i("3EUCw")),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,r&&r.set(e,i);return i}(i("gjhRv")),s=i("gEWrD"),a=i("ldT3p"),c=i("cH9or");function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}const u=!1;class h{static RETRY_BACKOFF_RATELIMIT(e,t,r){if(400===r.httpStatus||403===r.httpStatus||401===r.httpStatus)return-1;if(r instanceof c.ConnectionError)return-1;if("M_TOO_LARGE"===r.name)return-1;if("M_LIMIT_EXCEEDED"===r.name){const e=r.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)}static QUEUE_MESSAGES(e){return e.getType()===a.EventType.RoomMessage||e.hasAssociation()?"message":null}constructor(e=h.RETRY_BACKOFF_RATELIMIT,t=h.QUEUE_MESSAGES){this.retryAlgorithm=e,this.queueAlgorithm=t,(0,n.default)(this,"queues",{}),(0,n.default)(this,"activeQueues",[]),(0,n.default)(this,"procFn",null),(0,n.default)(this,"processQueue",(e=>{const t=this.peekNextEvent(e);if(!t){const t=this.activeQueues.indexOf(e);return t>=0&&this.activeQueues.splice(t,1),void d("Stopping queue '%s' as it is now empty",e)}d("Queue '%s' has %s pending events",e,this.queues[e].length),Promise.resolve().then((()=>this.procFn(t.event))).then((r=>{this.removeNextEvent(e),d("Queue '%s' sent event %s",e,t.event.getId()),t.defer.resolve(r),this.processQueue(e)}),(r=>{t.attempts+=1;const i=this.retryAlgorithm(t.event,t.attempts,r);d("retry(%s) err=%s event_id=%s waitTime=%s",t.attempts,r,t.event.getId(),i),-1===i?(d("Queue '%s' giving up on event %s",e,t.event.getId()),this.removeNextEvent(e),t.defer.reject(r),this.processQueue(e)):setTimeout(this.processQueue,i,e)}))}))}getQueueForEvent(e){const t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}removeEventFromQueue(e){const t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;let r=!1;return o.removeElement(this.queues[t],(t=>t.event.getId()===e.getId()&&(r=!0,!0))),r}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){const t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);const r=o.defer();return this.queues[t].push({event:e,defer:r,attempts:0}),d("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),this.startProcessingQueues(),r.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter((e=>-1===this.activeQueues.indexOf(e)&&this.queues[e].length>0)).forEach((e=>{this.activeQueues.push(e),d("Spinning up queue: '%s'",e),this.processQueue(e)}))}peekNextEvent(e){const t=this.queues[e];if(Array.isArray(t))return t[0]}removeNextEvent(e){const t=this.queues[e];if(Array.isArray(t))return t.shift()}}function d(...e){u&&s.logger.log(...e)}e.exports.MatrixScheduler=h})),i.register("32gyR",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PolicyScope=e.exports.POLICIES_ACCOUNT_EVENT_TYPE=e.exports.IgnoredInvites=e.exports.IGNORE_INVITES_ACCOUNT_EVENT_KEY=void 0;var r=i("e0VXi"),n=i("jxKcy"),o=i("8JM9X"),s=i("gjhRv");const a=new r.UnstableValue("m.policies","org.matrix.msc3847.policies");e.exports.POLICIES_ACCOUNT_EVENT_TYPE=a;const c=new r.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites");var l;let u;var h;e.exports.IGNORE_INVITES_ACCOUNT_EVENT_KEY=c,(l||(l={})).Ban="m.ban",e.exports.PolicyScope=u,(h=u||(e.exports.PolicyScope=u={})).User="m.policy.user",h.Room="m.policy.room",h.Server="m.policy.server";e.exports.IgnoredInvites=class{constructor(e){this.client=e}async addRule(e,t,r){const i=await this.getOrCreateTargetRoom();return(await this.client.sendStateEvent(i.roomId,e,{entity:t,reason:r,recommendation:l.Ban})).event_id}async removeRule(e){await this.client.redactEvent(e.getRoomId(),e.getId())}async addSource(e){await this.client.joinRoom(e);const t=(await this.getOrCreateSourceRooms()).map((e=>e.roomId));return!t.includes(e)&&(t.push(e),await this.withIgnoreInvitesPolicies((e=>{e.sources=t})),!0)}async getRuleForInvite({sender:e,roomId:t}){const r=await this.getOrCreateSourceRooms(),i=e.split(":")[1],o=t.split(":")[1];for(const a of r){const r=a.getUnfilteredTimelineSet().getLiveTimeline().getState(n.EventTimeline.FORWARDS);for(const{scope:n,entities:a}of[{scope:u.Room,entities:[t]},{scope:u.User,entities:[e]},{scope:u.Server,entities:[i,o]}]){const e=r.getStateEvents(n);for(const t of e){const e=t.getContent();if((null==e?void 0:e.recommendation)!=l.Ban)continue;const r=null==e?void 0:e.entity;if(!r)continue;let i;try{i=new RegExp((0,s.globToRegexp)(r,!1))}catch(e){continue}for(const e of a)if(e&&i.test(e))return t}}}return null}async getOrCreateTargetRoom(){let e=this.getIgnoreInvitesPolicies().target;if("string"!=typeof e&&(e=null),e){const t=this.client.getRoom(e);if(t)return t;e=null}return e=(await this.client.createRoom({name:"Individual Policy Room",preset:o.Preset.PrivateChat})).room_id,await this.withIgnoreInvitesPolicies((t=>{t.target=e})),this.client.getRoom(e)}async getOrCreateSourceRooms(){let e=this.getIgnoreInvitesPolicies().sources,t=!1;Array.isArray(e)||(t=!0,e=[]);let r=e.filter((e=>"string"==typeof e)).map((e=>this.client.getRoom(e))).filter((e=>!!e));if(r.length!=e.length&&(t=!0),0==r.length){t=!0,r=[await this.getOrCreateTargetRoom()]}return t&&await this.withIgnoreInvitesPolicies((t=>{t.sources=e})),r}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}async withIgnoreInvitesPolicies(e){const{policies:t,ignoreInvitesPolicies:r}=this.getPoliciesAndIgnoreInvitesPolicies();e(r),t[c.name]=r,await this.client.setAccountData(a.name,t)}getPoliciesAndIgnoreInvitesPolicies(){let e={};for(const r of[a.name,a.altName]){var t;if(!r)continue;const i=null===(t=this.client.getAccountData(r))||void 0===t?void 0:t.getContent();if(i){e=i;break}}let r={},i=!1;for(const t of[c.name,c.altName]){if(!t)continue;const n=e[t];if(n&&"object"==typeof n){r=n,i=!0;break}}return i||(e[c.name]=r),{policies:e,ignoreInvitesPolicies:r}}}})),i.register("ekrRE",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RUST_SDK_STORE_PREFIX=void 0;e.exports.RUST_SDK_STORE_PREFIX="matrix-js-sdk"})),i.register("4F8Wb",(function(e,t){e.exports=import("./"+i("dRo73").resolve("kf7at")).then((()=>i("7wsIP")))})),i.register("1SWS1",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RoomWidgetClient=void 0;var n=r(i("3EUCw")),o=i("4v7cb"),s=i("7BSj1"),a=i("ldT3p"),c=i("gEWrD"),l=i("5pxqF"),u=i("1dCYQ"),h=i("6nR3T"),d=i("fLhqT");class f extends l.MatrixClient{constructor(e,t,r,i){var h,d,f,p,m,g,v,y,b,w;super(i),this.widgetApi=e,this.capabilities=t,this.roomId=r,(0,n.default)(this,"room",void 0),(0,n.default)(this,"widgetApiReady",new Promise((e=>this.widgetApi.once("ready",e)))),(0,n.default)(this,"lifecycle",void 0),(0,n.default)(this,"syncState",null),(0,n.default)(this,"onEvent",(async e=>{if(e.preventDefault(),e.detail.data.room_id===this.roomId){const t=new s.MatrixEvent(e.detail.data);await this.syncApi.injectRoomEvents(this.room,[],[t]),this.emit(l.ClientEvent.Event,t),this.setSyncState(u.SyncState.Syncing),c.logger.info(`Received event ${t.getId()} ${t.getType()} ${t.getStateKey()}`)}else{const{event_id:t,room_id:r}=e.detail.data;c.logger.info(`Received event ${t} for a different room ${r}; discarding`)}await this.ack(e)})),(0,n.default)(this,"onToDevice",(async e=>{e.preventDefault();const t=new s.MatrixEvent({type:e.detail.data.type,sender:e.detail.data.sender,content:e.detail.data.content});e.detail.data.encrypted&&t.makeEncrypted(a.EventType.RoomMessageEncrypted,{},"",""),this.emit(l.ClientEvent.ToDeviceEvent,t),this.setSyncState(u.SyncState.Syncing),await this.ack(e)})),(null!==(h=t.sendEvent)&&void 0!==h&&h.length||null!==(d=t.receiveEvent)&&void 0!==d&&d.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||!0===t.receiveMessage||Array.isArray(t.receiveMessage)&&t.receiveMessage.length||null!==(f=t.sendState)&&void 0!==f&&f.length||null!==(p=t.receiveState)&&void 0!==p&&p.length)&&e.requestCapabilityForRoomTimeline(r),null===(m=t.sendEvent)||void 0===m||m.forEach((t=>e.requestCapabilityToSendEvent(t))),null===(g=t.receiveEvent)||void 0===g||g.forEach((t=>e.requestCapabilityToReceiveEvent(t))),!0===t.sendMessage?e.requestCapabilityToSendMessage():Array.isArray(t.sendMessage)&&t.sendMessage.forEach((t=>e.requestCapabilityToSendMessage(t))),!0===t.receiveMessage?e.requestCapabilityToReceiveMessage():Array.isArray(t.receiveMessage)&&t.receiveMessage.forEach((t=>e.requestCapabilityToReceiveMessage(t))),null===(v=t.sendState)||void 0===v||v.forEach((({eventType:t,stateKey:r})=>e.requestCapabilityToSendState(t,r))),null===(y=t.receiveState)||void 0===y||y.forEach((({eventType:t,stateKey:r})=>e.requestCapabilityToReceiveState(t,r))),null===(b=t.sendToDevice)||void 0===b||b.forEach((t=>e.requestCapabilityToSendToDevice(t))),null===(w=t.receiveToDevice)||void 0===w||w.forEach((t=>e.requestCapabilityToReceiveToDevice(t))),t.turnServers&&e.requestCapability(o.MatrixCapabilities.MSC3846TurnServers),e.on(`action:${o.WidgetApiToWidgetAction.SendEvent}`,this.onEvent),e.on(`action:${o.WidgetApiToWidgetAction.SendToDevice}`,this.onToDevice),e.start()}async startClient(e={}){var t,r;this.lifecycle=new AbortController;const i=this.getUserId();i&&this.store.storeUser(new d.User(i)),e.slidingSync?this.syncApi=new h.SlidingSyncSdk(e.slidingSync,this,e,this.buildSyncApiOptions()):this.syncApi=new u.SyncApi(this,e,this.buildSyncApiOptions()),this.room=this.syncApi.createRoom(this.roomId),this.store.storeRoom(this.room),await this.widgetApiReady,await Promise.all(null!==(t=null===(r=this.capabilities.receiveState)||void 0===r?void 0:r.map((async({eventType:e,stateKey:t})=>{const r=(await this.widgetApi.readStateEvents(e,void 0,t,[this.roomId])).map((e=>new s.MatrixEvent(e)));await this.syncApi.injectRoomEvents(this.room,[],r),r.forEach((e=>{this.emit(l.ClientEvent.Event,e),c.logger.info(`Backfilled event ${e.getId()} ${e.getType()} ${e.getStateKey()}`)}))})))&&void 0!==t?t:[]),this.setSyncState(u.SyncState.Syncing),c.logger.info("Finished backfilling events"),this.capabilities.turnServers&&this.watchTurnServers()}stopClient(){this.widgetApi.off(`action:${o.WidgetApiToWidgetAction.SendEvent}`,this.onEvent),this.widgetApi.off(`action:${o.WidgetApiToWidgetAction.SendToDevice}`,this.onToDevice),super.stopClient(),this.lifecycle.abort()}async joinRoom(e){if(e===this.roomId)return this.room;throw new Error(`Unknown room: ${e}`)}async encryptAndSendEvent(e,t){let r;try{r=await this.widgetApi.sendRoomEvent(t.getType(),t.getContent(),e.roomId)}catch(r){throw this.updatePendingEventStatus(e,t,s.EventStatus.NOT_SENT),r}return e.updatePendingEvent(t,s.EventStatus.SENT,r.event_id),{event_id:r.event_id}}async sendStateEvent(e,t,r,i=""){return await this.widgetApi.sendStateEvent(t,i,r,e)}async sendToDevice(e,t){return await this.widgetApi.sendToDevice(e,!1,t),{}}async queueToDevice({eventType:e,batch:t}){const r={};for(const{userId:e,deviceId:i,payload:n}of t)r[e]||(r[e]={}),r[e][i]=n;await this.widgetApi.sendToDevice(e,!1,r)}async encryptAndSendToDevices(e,t){const r={};for(const{userId:i,deviceInfo:{deviceId:n}}of e)r[i]||(r[i]={}),r[i][n]=t;await this.widgetApi.sendToDevice(t.type,!0,r)}async checkTurnServers(){return this.turnServers.length>0}getSyncState(){return this.syncState}setSyncState(e){const t=this.syncState;this.syncState=e,this.emit(l.ClientEvent.Sync,e,t)}async ack(e){await this.widgetApi.transport.reply(e.detail,{})}async watchTurnServers(){const e=this.widgetApi.getTurnServers(),t=()=>{e.return(void 0)};this.lifecycle.signal.addEventListener("abort",t);try{for await(const t of e)this.turnServers=[{urls:t.uris,username:t.username,credential:t.password}],this.emit(l.ClientEvent.TurnServers,this.turnServers),c.logger.log(`Received TURN server: ${t.uris}`)}catch(e){c.logger.warn("Error watching TURN servers",e)}finally{this.lifecycle.signal.removeEventListener("abort",t)}}}e.exports.RoomWidgetClient=f})),i.register("4v7cb",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0});var r=i("bhwVu");Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===r[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return r[t]}}))}));var n=i("lJXQC");Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===n[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return n[t]}}))}));var o=i("bnjwE");Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===o[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return o[t]}}))}));var s=i("dMBQL");Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===s[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return s[t]}}))}));var a=i("5T5fN");Object.keys(a).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===a[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return a[t]}}))}));var c=i("78lsm");Object.keys(c).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===c[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return c[t]}}))}));var l=i("flXDn");Object.keys(l).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===l[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return l[t]}}))}));var u=i("cFSSq");Object.keys(u).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===u[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return u[t]}}))}));var h=i("kiABc");Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===h[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return h[t]}}))}));var d=i("1ZRkw");Object.keys(d).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===d[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return d[t]}}))}));var f=i("kopb9");Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===f[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return f[t]}}))}));var p=i("hAyjW");Object.keys(p).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===p[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return p[t]}}))}));var m=i("gywY8");Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===m[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return m[t]}}))}));var g=i("3A9SS");Object.keys(g).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===g[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return g[t]}}))}));var v=i("2AyV9");Object.keys(v).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===v[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return v[t]}}))}));var y=i("9PkAd");Object.keys(y).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===y[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return y[t]}}))}));var b=i("lbS8M");Object.keys(b).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===b[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return b[t]}}))}));var w=i("lVT8C");Object.keys(w).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===w[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return w[t]}}))}));var _=i("04Jjc");Object.keys(_).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===_[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return _[t]}}))}));var S=i("7jWzq");Object.keys(S).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===S[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return S[t]}}))}));var E=i("icKds");Object.keys(E).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===E[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return E[t]}}))}));var M=i("dXPj6");Object.keys(M).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===M[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return M[t]}}))}));var C=i("gh8nc");Object.keys(C).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===C[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return C[t]}}))}));var I=i("3qdML");Object.keys(I).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===I[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return I[t]}}))}));var T=i("b3Mni");Object.keys(T).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===T[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return T[t]}}))}));var k=i("jrx9O");Object.keys(k).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===k[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return k[t]}}))}));var R=i("krXmq");Object.keys(R).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===R[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return R[t]}}))}));var x=i("2NlfF");Object.keys(x).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===x[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return x[t]}}))}));var O=i("1vE1X");Object.keys(O).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===O[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return O[t]}}))}));var A=i("eQkL1");Object.keys(A).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===A[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return A[t]}}))}));var P=i("1Xklf");Object.keys(P).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===P[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return P[t]}}))}));var D=i("aLy2h");Object.keys(D).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===D[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return D[t]}}))}));var L=i("9FGnp");Object.keys(L).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===L[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return L[t]}}))}));var U=i("fTvYq");Object.keys(U).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===U[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return U[t]}}))}));var N=i("16UdW");Object.keys(N).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===N[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return N[t]}}))}));var j=i("7Q79V");Object.keys(j).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===j[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return j[t]}}))}));var B=i("er1KY");Object.keys(B).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===B[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return B[t]}}))}));var F=i("2SuYn");Object.keys(F).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===F[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return F[t]}}))}));var K=i("i72SR");Object.keys(K).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===K[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return K[t]}}))}));var q=i("abmZm");Object.keys(q).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===q[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return q[t]}}))}));var $=i("4twjR");Object.keys($).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===$[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return $[t]}}))}));var W=i("fc9gm");Object.keys(W).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===W[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return W[t]}}))}));var V=i("41QTn");Object.keys(V).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===V[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return V[t]}}))}));var H=i("dLdTB");Object.keys(H).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===H[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return H[t]}}))}));var G=i("e5mjp");Object.keys(G).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===G[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return G[t]}}))}));var z=i("4Ljtc");Object.keys(z).forEach((function(t){"default"!==t&&"__esModule"!==t&&(t in e.exports&&e.exports[t]===z[t]||Object.defineProperty(e.exports,t,{enumerable:!0,get:function(){return z[t]}}))}))})),i.register("bhwVu",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetApi=void 0;var n=i("k4yOc"),o=i("2AyV9"),s=i("9PkAd"),a=i("5T5fN"),c=i("3A9SS"),l=i("b3Mni"),u=i("1ZRkw"),h=i("1vE1X"),d=i("i72SR"),f=i("bnjwE");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
p=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,i){var n=t&&t.prototype instanceof d?t:d,o=Object.create(n.prototype),s=new C(i||[]);return o._invoke=function(e,t,r){var i="suspendedStart";return function(n,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw o;return T()}for(r.method=n,r.arg=o;;){var s=r.delegate;if(s){var a=S(s,r);if(a){if(a===h)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var c=u(e,t,r);if("normal"===c.type){if(i=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function d(){}function f(){}function m(){}var g={};c(g,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(I([])));y&&y!==t&&i.call(y,o)&&(g=y);var b=m.prototype=d.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(o,s,a,c){var l=u(e[o],e,s);if("throw"!==l.type){var h=l.arg,d=h.value;return d&&"object"==r(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(d).then((function(e){h.value=e,a(h)}),(function(e){return n("throw",e,a,c)}))}c(l.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var i=u(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m,c(b,"constructor",m),c(m,"constructor",f),f.displayName=c(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(_.prototype),c(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,i,n,o){void 0===o&&(o=Promise);var s=new _(l(t,r,i,n),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(b),c(b,a,"Generator"),c(b,o,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},e.values=I,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;M(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function m(e,t,r,i,n,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(i,n)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(i,n){var o=e.apply(t,r);function s(e){m(o,i,n,s,a,"next",e)}function a(e){m(o,i,n,s,a,"throw",e)}s(void 0)}))}}function v(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=_(e);if(t){var o=_(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return w(e)}(this,i)}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){return new C(e)}function M(e){var t,r;function i(t,r){try{var o=e[t](r),s=o.value,a=s instanceof C;Promise.resolve(a?s.wrapped:s).then((function(e){a?i("return"===t?"return":"next",e):n(o.done?"return":"normal",e)}),(function(e){i("throw",e)}))}catch(e){n("throw",e)}}function n(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise((function(o,s){var a={key:e,arg:n,resolve:o,reject:s,next:null};r?r=r.next=a:(t=r=a,i(e,n))}))},"function"!=typeof e.return&&(this.return=void 0)}function C(e){this.wrapped=e}M.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},M.prototype.next=function(e){return this._invoke("next",e)},M.prototype.throw=function(e){return this._invoke("throw",e)},M.prototype.return=function(e){return this._invoke("return",e)};var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(_,e);var t,r,i,n,m=b(_);function _(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),(e=m.call(this)).clientOrigin=r,S(w(e),"transport",void 0),S(w(e),"capabilitiesFinished",!1),S(w(e),"supportsMSC2974Renegotiate",!1),S(w(e),"requestedCapabilities",[]),S(w(e),"approvedCapabilities",void 0),S(w(e),"cachedClientVersions",void 0),S(w(e),"turnServerWatchers",0),!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");return e.transport=new a.PostmessageTransport(o.WidgetApiDirection.FromWidget,t,window.parent,window),e.transport.targetOrigin=r,e.transport.on("message",e.handleMessage.bind(w(e))),e}return t=_,r=[{key:"hasCapability",value:function(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}},{key:"requestCapability",value:function(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}},{key:"requestCapabilities",value:function(e){var t=this;e.forEach((function(e){return t.requestCapability(e)}))}},{key:"requestCapabilityForRoomTimeline",value:function(e){this.requestCapability("org.matrix.msc2762.timeline:".concat(e))}},{key:"requestCapabilityToSendState",value:function(e,t){this.requestCapability(d.WidgetEventCapability.forStateEvent(d.EventDirection.Send,e,t).raw)}},{key:"requestCapabilityToReceiveState",value:function(e,t){this.requestCapability(d.WidgetEventCapability.forStateEvent(d.EventDirection.Receive,e,t).raw)}},{key:"requestCapabilityToSendToDevice",value:function(e){this.requestCapability(d.WidgetEventCapability.forToDeviceEvent(d.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveToDevice",value:function(e){this.requestCapability(d.WidgetEventCapability.forToDeviceEvent(d.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToSendEvent",value:function(e){this.requestCapability(d.WidgetEventCapability.forRoomEvent(d.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveEvent",value:function(e){this.requestCapability(d.WidgetEventCapability.forRoomEvent(d.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToSendMessage",value:function(e){this.requestCapability(d.WidgetEventCapability.forRoomMessageEvent(d.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveMessage",value:function(e){this.requestCapability(d.WidgetEventCapability.forRoomMessageEvent(d.EventDirection.Receive,e).raw)}},{key:"requestOpenIDConnectToken",value:function(){var e=this;return new Promise((function(t,r){e.transport.sendComplete(c.WidgetApiFromWidgetAction.GetOpenIDCredentials,{}).then((function(i){var n=i.response;n.state===l.OpenIDRequestState.Allowed?t(n):n.state===l.OpenIDRequestState.Blocked?r(new Error("User declined to verify their identity")):n.state===l.OpenIDRequestState.PendingUserConfirmation?e.on("action:".concat(c.WidgetApiToWidgetAction.OpenIDCredentials),(function o(s){s.preventDefault();var a=s.detail;a.data.original_request_id===i.requestId&&(a.data.state===l.OpenIDRequestState.Allowed?(t(a.data),e.transport.reply(a,{})):a.data.state===l.OpenIDRequestState.Blocked?(r(new Error("User declined to verify their identity")),e.transport.reply(a,{})):(r(new Error("Invalid state on reply: "+n.state)),e.transport.reply(a,{error:{message:"Invalid state"}})),e.off("action:".concat(c.WidgetApiToWidgetAction.OpenIDCredentials),o))})):r(new Error("Invalid state: "+n.state))})).catch(r)}))}},{key:"updateRequestedCapabilities",value:function(){return this.transport.send(c.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}},{key:"sendContentLoaded",value:function(){return this.transport.send(c.WidgetApiFromWidgetAction.ContentLoaded,{}).then()}},{key:"sendSticker",value:function(e){return this.transport.send(c.WidgetApiFromWidgetAction.SendSticker,e).then()}},{key:"setAlwaysOnScreen",value:function(e){return this.transport.send(c.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen,{value:e}).then((function(e){return e.success}))}},{key:"openModalWidget",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.MatrixWidgetType.Custom;return this.transport.send(c.WidgetApiFromWidgetAction.OpenModalWidget,{type:n,url:e,name:t,buttons:r,data:i}).then()}},{key:"closeModalWidget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.transport.send(c.WidgetApiFromWidgetAction.CloseModalWidget,e).then()}},{key:"sendRoomEvent",value:function(e,t,r){return this.transport.send(c.WidgetApiFromWidgetAction.SendEvent,{type:e,content:t,room_id:r})}},{key:"sendStateEvent",value:function(e,t,r,i){return this.transport.send(c.WidgetApiFromWidgetAction.SendEvent,{type:e,content:r,state_key:t,room_id:i})}},{key:"sendToDevice",value:function(e,t,r){return this.transport.send(c.WidgetApiFromWidgetAction.SendToDevice,{type:e,encrypted:t,messages:r})}},{key:"readRoomEvents",value:function(e,t,r,i){var n={type:e,msgtype:r};return void 0!==t&&(n.limit=t),i&&(i.includes(f.Symbols.AnyRoom)?n.room_ids=f.Symbols.AnyRoom:n.room_ids=i),this.transport.send(c.WidgetApiFromWidgetAction.MSC2876ReadEvents,n).then((function(e){return e.events}))}},{key:"readEventRelations",value:(n=g(p().mark((function e(t,r,i,n,o,a,l,u){var h;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(s.UnstableApiVersion.MSC3869)){e.next=5;break}throw new Error("The read_relations action is not supported by the client.");case 5:return h={event_id:t,rel_type:i,event_type:n,room_id:r,to:l,from:a,limit:o,direction:u},e.abrupt("return",this.transport.send(c.WidgetApiFromWidgetAction.MSC3869ReadRelations,h));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i,o,s,a,c){return n.apply(this,arguments)})},{key:"readStateEvents",value:function(e,t,r,i){var n={type:e,state_key:void 0===r||r};return void 0!==t&&(n.limit=t),i&&(i.includes(f.Symbols.AnyRoom)?n.room_ids=f.Symbols.AnyRoom:n.room_ids=i),this.transport.send(c.WidgetApiFromWidgetAction.MSC2876ReadEvents,n).then((function(e){return e.events}))}},{key:"setModalButtonEnabled",value:function(e,t){if(e===h.BuiltInModalButtonID.Close)throw new Error("The close button cannot be disabled");return this.transport.send(c.WidgetApiFromWidgetAction.SetModalButtonEnabled,{button:e,enabled:t}).then()}},{key:"navigateTo",value:function(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(c.WidgetApiFromWidgetAction.MSC2931Navigate,{uri:e}).then()}},{key:"getTurnServers",value:function(){var e,t=this;return(e=p().mark((function e(){var r,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(){var e=g(p().mark((function e(i){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.preventDefault(),r(i.detail.data),e.next=4,t.transport.reply(i.detail,{});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.on("action:".concat(c.WidgetApiToWidgetAction.UpdateTurnServers),i),0!==t.turnServerWatchers){e.next=12;break}return e.prev=3,e.next=6,E(t.transport.send(c.WidgetApiFromWidgetAction.WatchTurnServers,{}));case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),t.off("action:".concat(c.WidgetApiToWidgetAction.UpdateTurnServers),i),e.t0;case 12:t.turnServerWatchers++,e.prev=13;case 14:return e.next=17,E(new Promise((function(e){return r=e})));case 17:return e.next=19,e.sent;case 19:e.next=14;break;case 21:if(e.prev=21,t.off("action:".concat(c.WidgetApiToWidgetAction.UpdateTurnServers),i),t.turnServerWatchers--,0!==t.turnServerWatchers){e.next=27;break}return e.next=27,E(t.transport.send(c.WidgetApiFromWidgetAction.UnwatchTurnServers,{}));case 27:return e.finish(21);case 28:case"end":return e.stop()}}),e,null,[[3,8],[13,,21,28]])})),function(){return new M(e.apply(this,arguments))})()}},{key:"start",value:function(){var e=this;this.transport.start(),this.getClientVersions().then((function(t){t.includes(s.UnstableApiVersion.MSC2974)&&(e.supportsMSC2974Renegotiate=!0)}))}},{key:"handleMessage",value:function(e){var t=new CustomEvent("action:".concat(e.detail.action),{detail:e.detail,cancelable:!0});if(this.emit("action:".concat(e.detail.action),t),!t.defaultPrevented)switch(e.detail.action){case c.WidgetApiToWidgetAction.SupportedApiVersions:return this.replyVersions(e.detail);case c.WidgetApiToWidgetAction.Capabilities:return this.handleCapabilities(e.detail);case c.WidgetApiToWidgetAction.UpdateVisibility:case c.WidgetApiToWidgetAction.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}},{key:"replyVersions",value:function(e){this.transport.reply(e,{supported_versions:s.CurrentApiVersions})}},{key:"getClientVersions",value:function(){var e=this;return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(c.WidgetApiFromWidgetAction.SupportedApiVersions,{}).then((function(t){return e.cachedClientVersions=t.supported_versions,t.supported_versions})).catch((function(e){return console.warn("non-fatal error getting supported client versions: ",e),[]}))}},{key:"handleCapabilities",value:function(e){var t=this;return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then((function(r){return r.includes(s.UnstableApiVersion.MSC2871)?t.once("action:".concat(c.WidgetApiToWidgetAction.NotifyCapabilities),(function(e){t.approvedCapabilities=e.detail.data.approved,t.emit("ready")})):t.emit("ready"),t.capabilitiesFinished=!0,t.transport.reply(e,{capabilities:t.requestedCapabilities})}))}}],r&&v(t.prototype,r),i&&v(t,i),Object.defineProperty(t,"prototype",{writable:!1}),_}(n.EventEmitter);e.exports.WidgetApi=I})),i.register("2AyV9",(function(e,t){var r,i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetApiDirection=void 0,e.exports.invertedDirection=function(e){if(e===r.ToWidget)return r.FromWidget;if(e===r.FromWidget)return r.ToWidget;throw new Error("Invalid direction")},e.exports.WidgetApiDirection=r,(i=r||(e.exports.WidgetApiDirection=r={})).ToWidget="toWidget",i.FromWidget="fromWidget"})),i.register("9PkAd",(function(e,t){var r,i,n,o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.UnstableApiVersion=e.exports.MatrixApiVersion=e.exports.CurrentApiVersions=void 0,e.exports.MatrixApiVersion=r,(i=r||(e.exports.MatrixApiVersion=r={})).Prerelease1="0.0.1",i.Prerelease2="0.0.2",e.exports.UnstableApiVersion=n,(o=n||(e.exports.UnstableApiVersion=n={})).MSC2762="org.matrix.msc2762",o.MSC2871="org.matrix.msc2871",o.MSC2931="org.matrix.msc2931",o.MSC2974="org.matrix.msc2974",o.MSC2876="org.matrix.msc2876",o.MSC3819="org.matrix.msc3819",o.MSC3846="town.robin.msc3846",o.MSC3869="org.matrix.msc3869";var s=[r.Prerelease1,r.Prerelease2,n.MSC2762,n.MSC2871,n.MSC2931,n.MSC2974,n.MSC2876,n.MSC3819,n.MSC3846,n.MSC3869];e.exports.CurrentApiVersions=s})),i.register("5T5fN",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PostmessageTransport=void 0;var n=i("k4yOc"),o=i("4v7cb");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=d(e);if(t){var o=d(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,i)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(s,e);var t,r,i,n=u(s);function s(e,t,r,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(o=n.call(this)).sendDirection=e,o.initialWidgetId=t,o.transportWindow=r,o.inboundWindow=i,f(h(o),"strictOriginCheck",void 0),f(h(o),"targetOrigin",void 0),f(h(o),"timeoutSeconds",10),f(h(o),"_ready",!1),f(h(o),"_widgetId",null),f(h(o),"outboundRequests",new Map),f(h(o),"stopController",new AbortController),o._widgetId=t,o}return t=s,(r=[{key:"ready",get:function(){return this._ready}},{key:"widgetId",get:function(){return this._widgetId||null}},{key:"nextRequestId",get:function(){for(var e="widgetapi-".concat(Date.now()),t=0,r=e;this.outboundRequests.has(r);)r="".concat(e,"-").concat(t++);return this.outboundRequests.set(r,null),r}},{key:"sendInternal",value:function(e){var t=this.targetOrigin||"*";console.log("[PostmessageTransport] Sending object to ".concat(t,": "),e),this.transportWindow.postMessage(e,t)}},{key:"reply",value:function(e,t){return this.sendInternal(a(a({},e),{},{response:t}))}},{key:"send",value:function(e,t){return this.sendComplete(e,t).then((function(e){return e.response}))}},{key:"sendComplete",value:function(e,t){var r=this;if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));var i={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:t};return e===o.WidgetApiToWidgetAction.UpdateVisibility&&(i.visible=t.visible),new Promise((function(e,t){var n=function(e){a(),t(e)},o=setTimeout((function(){return n(new Error("Request timed out"))}),1e3*(r.timeoutSeconds||1)),s=function(){return n(new Error("Transport stopped"))};r.stopController.signal.addEventListener("abort",s);var a=function(){r.outboundRequests.delete(i.requestId),clearTimeout(o),r.stopController.signal.removeEventListener("abort",s)};r.outboundRequests.set(i.requestId,{request:i,resolve:function(t){a(),e(t)},reject:n}),r.sendInternal(i)}))}},{key:"start",value:function(){var e=this;this.inboundWindow.addEventListener("message",(function(t){e.handleMessage(t)})),this._ready=!0}},{key:"stop",value:function(){this._ready=!1,this.stopController.abort()}},{key:"handleMessage",value:function(e){if(!this.stopController.signal.aborted&&e.data&&(!this.strictOriginCheck||e.origin===window.origin)){var t=e.data;if(t.action&&t.requestId&&t.widgetId)if(t.response){if(t.api!==this.sendDirection)return;this.handleResponse(t)}else{var r=t;if(r.api!==(0,o.invertedDirection)(this.sendDirection))return;this.handleRequest(r)}}}},{key:"handleRequest",value:function(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}},{key:"handleResponse",value:function(e){if(e.widgetId===this.widgetId){var t=this.outboundRequests.get(e.requestId);if(t)if((0,o.isErrorResponse)(e.response)){var r=e.response;t.reject(new Error(r.error.message))}else t.resolve(e)}}}])&&c(t.prototype,r),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),s}(n.EventEmitter);e.exports.PostmessageTransport=p})),i.register("3A9SS",(function(e,t){var r,i,n,o;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetApiToWidgetAction=e.exports.WidgetApiFromWidgetAction=void 0,e.exports.WidgetApiToWidgetAction=r,(i=r||(e.exports.WidgetApiToWidgetAction=r={})).SupportedApiVersions="supported_api_versions",i.Capabilities="capabilities",i.NotifyCapabilities="notify_capabilities",i.TakeScreenshot="screenshot",i.UpdateVisibility="visibility",i.OpenIDCredentials="openid_credentials",i.WidgetConfig="widget_config",i.CloseModalWidget="close_modal",i.ButtonClicked="button_clicked",i.SendEvent="send_event",i.SendToDevice="send_to_device",i.UpdateTurnServers="update_turn_servers",e.exports.WidgetApiFromWidgetAction=n,(o=n||(e.exports.WidgetApiFromWidgetAction=n={})).SupportedApiVersions="supported_api_versions",o.ContentLoaded="content_loaded",o.SendSticker="m.sticker",o.UpdateAlwaysOnScreen="set_always_on_screen",o.GetOpenIDCredentials="get_openid",o.CloseModalWidget="close_modal",o.OpenModalWidget="open_modal",o.SetModalButtonEnabled="set_button_enabled",o.SendEvent="send_event",o.SendToDevice="send_to_device",o.WatchTurnServers="watch_turn_servers",o.UnwatchTurnServers="unwatch_turn_servers",o.MSC2876ReadEvents="org.matrix.msc2876.read_events",o.MSC2931Navigate="org.matrix.msc2931.navigate",o.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",o.MSC3869ReadRelations="org.matrix.msc3869.read_relations"})),i.register("b3Mni",(function(e,t){var r,i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.OpenIDRequestState=void 0,e.exports.OpenIDRequestState=r,(i=r||(e.exports.OpenIDRequestState=r={})).Allowed="allowed",i.Blocked="blocked",i.PendingUserConfirmation="request"})),i.register("1ZRkw",(function(e,t){var r,i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MatrixWidgetType=void 0,e.exports.MatrixWidgetType=r,(i=r||(e.exports.MatrixWidgetType=r={})).Custom="m.custom",i.JitsiMeet="m.jitsi",i.Stickerpicker="m.stickerpicker"})),i.register("1vE1X",(function(e,t){var r;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.BuiltInModalButtonID=void 0,e.exports.BuiltInModalButtonID=r,(r||(e.exports.BuiltInModalButtonID=r={})).Close="m.close"})),i.register("i72SR",(function(e,t){function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o,s,a,c;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetEventCapability=e.exports.EventKind=e.exports.EventDirection=void 0,e.exports.EventKind=o,(s=o||(e.exports.EventKind=o={})).Event="event",s.State="state_event",s.ToDevice="to_device",e.exports.EventDirection=a,(c=a||(e.exports.EventDirection=a={})).Send="send",c.Receive="receive";var l=function(){function e(t,r,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.direction=t,this.eventType=r,this.kind=i,this.keyStr=n,this.raw=o}var t,i,s;return t=e,i=[{key:"matchesAsStateEvent",value:function(e,t,r){return this.kind===o.State&&this.direction===e&&this.eventType===t&&(null===this.keyStr||this.keyStr===r)}},{key:"matchesAsToDeviceEvent",value:function(e,t){return this.kind===o.ToDevice&&this.direction===e&&this.eventType===t}},{key:"matchesAsRoomEvent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.kind===o.Event&&this.direction===e&&this.eventType===t&&("m.room.message"!==this.eventType||null===this.keyStr||this.keyStr===r)}}],s=[{key:"forStateEvent",value:function(t,r,i){r=r.replace(/#/g,"\\#"),i=null!=i?"#".concat(i):"";var n="org.matrix.msc2762.".concat(t,".state_event:").concat(r).concat(i);return e.findEventCapabilities([n])[0]}},{key:"forToDeviceEvent",value:function(t,r){var i="org.matrix.msc3819.".concat(t,".to_device:").concat(r);return e.findEventCapabilities([i])[0]}},{key:"forRoomEvent",value:function(t,r){var i="org.matrix.msc2762.".concat(t,".event:").concat(r);return e.findEventCapabilities([i])[0]}},{key:"forRoomMessageEvent",value:function(t,r){r=null==r?"":r;var i="org.matrix.msc2762.".concat(t,".event:m.room.message#").concat(r);return e.findEventCapabilities([i])[0]}},{key:"findEventCapabilities",value:function(t){var i,n=[],s=r(t);try{for(s.s();!(i=s.n()).done;){var c=i.value,l=null,u=void 0,h=null;if(c.startsWith("org.matrix.msc2762.send.event:")?(l=a.Send,h=o.Event,u=c.substring(30)):c.startsWith("org.matrix.msc2762.send.state_event:")?(l=a.Send,h=o.State,u=c.substring(36)):c.startsWith("org.matrix.msc3819.send.to_device:")?(l=a.Send,h=o.ToDevice,u=c.substring(34)):c.startsWith("org.matrix.msc2762.receive.event:")?(l=a.Receive,h=o.Event,u=c.substring(33)):c.startsWith("org.matrix.msc2762.receive.state_event:")?(l=a.Receive,h=o.State,u=c.substring(39)):c.startsWith("org.matrix.msc3819.receive.to_device:")&&(l=a.Receive,h=o.ToDevice,u=c.substring(37)),null!==l&&null!==h){var d=u.startsWith("m.room.message#")||h===o.State,f=null;if(u.includes("#")&&d){var p=u.split("#"),m=p.findIndex((function(e){return!e.endsWith("\\")}));u=p.slice(0,m+1).map((function(e){return e.endsWith("\\")?e.substring(0,e.length-1):e})).join("#"),f=p.slice(m+1).join("#")}n.push(new e(l,u,h,f,c))}}}catch(e){s.e(e)}finally{s.f()}return n}}],i&&n(t.prototype,i),s&&n(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.WidgetEventCapability=l})),i.register("bnjwE",(function(e,t){var r;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Symbols=void 0,e.exports.Symbols=r,(r||(e.exports.Symbols=r={})).AnyRoom="*"})),i.register("lJXQC",(function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ClientWidgetApi=void 0;var n=i("k4yOc"),o=i("5T5fN"),s=i("2AyV9"),a=i("3A9SS"),c=i("lbS8M"),l=i("9PkAd"),u=i("i72SR"),h=i("b3Mni"),d=i("e5mjp"),f=i("bnjwE");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
p=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,i){var n=t&&t.prototype instanceof d?t:d,o=Object.create(n.prototype),s=new C(i||[]);return o._invoke=function(e,t,r){var i="suspendedStart";return function(n,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw o;return T()}for(r.method=n,r.arg=o;;){var s=r.delegate;if(s){var a=S(s,r);if(a){if(a===h)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var c=u(e,t,r);if("normal"===c.type){if(i=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function d(){}function f(){}function m(){}var g={};c(g,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(I([])));y&&y!==t&&i.call(y,o)&&(g=y);var b=m.prototype=d.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(o,s,a,c){var l=u(e[o],e,s);if("throw"!==l.type){var h=l.arg,d=h.value;return d&&"object"==r(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(d).then((function(e){h.value=e,a(h)}),(function(e){return n("throw",e,a,c)}))}c(l.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var i=u(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m,c(b,"constructor",m),c(m,"constructor",f),f.displayName=c(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(_.prototype),c(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,i,n,o){void 0===o&&(o=Promise);var s=new _(l(t,r,i,n),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(b),c(b,a,"Generator"),c(b,o,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},e.values=I,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;M(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function m(e,t,r,i,n,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(i,n)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(i,n){var o=e.apply(t,r);function s(e){m(o,i,n,s,a,"next",e)}function a(e){m(o,i,n,s,a,"throw",e)}s(void 0)}))}}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=C(e);if(t){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return M(e)}(this,i)}}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){var t,r,i,n=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);n--;){if(r&&null!=(t=e[r]))return t.call(e);if(i&&null!=(t=e[i]))return new k(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function k(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return k=function(e){this.s=e,this.n=e.next},k.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new k(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(O,e);var t,r,i,n,m,y,b,C,k,R,x=E(O);function O(e,t,r){var i;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,O),(i=x.call(this)).widget=e,i.iframe=t,i.driver=r,I(M(i),"transport",void 0),I(M(i),"contentLoadedActionSent",!1),I(M(i),"allowedCapabilities",new Set),I(M(i),"allowedEvents",[]),I(M(i),"isStopped",!1),I(M(i),"turnServers",null),null==t||!t.contentWindow)throw new Error("No iframe supplied");if(!e)throw new Error("Invalid widget");if(!r)throw new Error("Invalid driver");return i.transport=new o.PostmessageTransport(s.WidgetApiDirection.ToWidget,e.id,t.contentWindow,window),i.transport.targetOrigin=e.origin,i.transport.on("message",i.handleMessage.bind(M(i))),t.addEventListener("load",i.onIframeLoad.bind(M(i))),i.transport.start(),i}return t=O,r=[{key:"hasCapability",value:function(e){return this.allowedCapabilities.has(e)}},{key:"canUseRoomTimeline",value:function(e){return this.hasCapability("org.matrix.msc2762.timeline:".concat(f.Symbols.AnyRoom))||this.hasCapability("org.matrix.msc2762.timeline:".concat(e))}},{key:"canSendRoomEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some((function(r){return r.matchesAsRoomEvent(u.EventDirection.Send,e,t)}))}},{key:"canSendStateEvent",value:function(e,t){return this.allowedEvents.some((function(r){return r.matchesAsStateEvent(u.EventDirection.Send,e,t)}))}},{key:"canSendToDeviceEvent",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsToDeviceEvent(u.EventDirection.Send,e)}))}},{key:"canReceiveRoomEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some((function(r){return r.matchesAsRoomEvent(u.EventDirection.Receive,e,t)}))}},{key:"canReceiveStateEvent",value:function(e,t){return this.allowedEvents.some((function(r){return r.matchesAsStateEvent(u.EventDirection.Receive,e,t)}))}},{key:"canReceiveToDeviceEvent",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsToDeviceEvent(u.EventDirection.Receive,e)}))}},{key:"stop",value:function(){this.isStopped=!0,this.transport.stop()}},{key:"beginCapabilities",value:function(){var e,t=this;this.emit("preparing"),this.transport.send(a.WidgetApiToWidgetAction.Capabilities,{}).then((function(r){return e=r.capabilities,t.driver.validateCapabilities(new Set(r.capabilities))})).then((function(r){console.log("Widget ".concat(t.widget.id," is allowed capabilities:"),Array.from(r)),t.allowedCapabilities=r,t.allowedEvents=u.WidgetEventCapability.findEventCapabilities(r),t.notifyCapabilities(e),t.emit("ready")}))}},{key:"notifyCapabilities",value:function(e){var t=this;this.transport.send(a.WidgetApiToWidgetAction.NotifyCapabilities,{requested:e,approved:Array.from(this.allowedCapabilities)}).catch((function(e){console.warn("non-fatal error notifying widget of approved capabilities:",e)})).then((function(){t.emit("capabilitiesNotified")}))}},{key:"onIframeLoad",value:function(e){this.widget.waitForIframeLoad?this.beginCapabilities():this.contentLoadedActionSent=!1}},{key:"handleContentLoadedAction",value:function(e){if(this.contentLoadedActionSent)throw new Error("Improper sequence: ContentLoaded Action can only be send once after the widget loaded and should only be used if waitForIframeLoad is false (default=true)");this.widget.waitForIframeLoad?this.transport.reply(e,{error:{message:"Improper sequence: not expecting ContentLoaded event if waitForIframLoad is true (default=true)"}}):(this.transport.reply(e,{}),this.beginCapabilities()),this.contentLoadedActionSent=!0}},{key:"replyVersions",value:function(e){this.transport.reply(e,{supported_versions:l.CurrentApiVersions})}},{key:"handleCapabilitiesRenegotiate",value:function(e){var t,r=this;this.transport.reply(e,{});var i=(null===(t=e.data)||void 0===t?void 0:t.capabilities)||[],n=new Set(i.filter((function(e){return!r.hasCapability(e)})));if(0===n.size)return this.notifyCapabilities([]);this.driver.validateCapabilities(n).then((function(e){return e.forEach((function(e){return r.allowedCapabilities.add(e)})),u.WidgetEventCapability.findEventCapabilities(e).forEach((function(e){return r.allowedEvents.push(e)})),r.notifyCapabilities(Array.from(n))}))}},{key:"handleNavigate",value:function(e){var t,r,i=this;if(!this.hasCapability(c.MatrixCapabilities.MSC2931Navigate))return this.transport.reply(e,{error:{message:"Missing capability"}});if(null===(t=e.data)||void 0===t||!t.uri||null===(r=e.data)||void 0===r||!r.uri.toString().startsWith("https://matrix.to/#"))return this.transport.reply(e,{error:{message:"Invalid matrix.to URI"}});var n=function(t){return console.error("[ClientWidgetApi] Failed to handle navigation: ",t),i.transport.reply(e,{error:{message:"Error handling navigation"}})};try{this.driver.navigate(e.data.uri.toString()).catch((function(e){return n(e)})).then((function(){return i.transport.reply(e,{})}))}catch(e){return n(e)}}},{key:"handleOIDC",value:function(e){var t=this,r=1,i=function(i,n){return n=n||{},r>1?t.transport.send(a.WidgetApiToWidgetAction.OpenIDCredentials,w({state:i,original_request_id:e.requestId},n)):t.transport.reply(e,w({state:i},n))},n=function(n){return console.error("[ClientWidgetApi] Failed to handle OIDC: ",n),r>1?i(h.OpenIDRequestState.Blocked):t.transport.reply(e,{error:{message:n}})},o=new d.SimpleObservable((function(e){return e.state===h.OpenIDRequestState.PendingUserConfirmation&&r>1?(o.close(),n("client provided out-of-phase response to OIDC flow")):e.state===h.OpenIDRequestState.PendingUserConfirmation?(i(e.state),void r++):e.state!==h.OpenIDRequestState.Allowed||e.token?(e.state===h.OpenIDRequestState.Blocked&&(e.token=null),o.close(),i(e.state,e.token)):n("client provided invalid OIDC token for an allowed request")}));this.driver.askOpenID(o)}},{key:"handleReadEvents",value:function(e){var t=this;if(!e.data.type)return this.transport.reply(e,{error:{message:"Invalid request - missing event type"}});if(void 0!==e.data.limit&&(!e.data.limit||e.data.limit<0))return this.transport.reply(e,{error:{message:"Invalid request - limit out of range"}});var r=null;if(e.data.room_ids){r=e.data.room_ids,Array.isArray(r)||(r=[r]);var i,n=v(r);try{for(n.s();!(i=n.n()).done;){var o=i.value;if(!this.canUseRoomTimeline(o))return this.transport.reply(e,{error:{message:"Unable to access room timeline: ".concat(o)}})}}catch(e){n.e(e)}finally{n.f()}}var s=e.data.limit||0,a=Promise.resolve([]);if(void 0!==e.data.state_key){var c=!0===e.data.state_key?void 0:e.data.state_key.toString();if(!this.canReceiveStateEvent(e.data.type,c))return this.transport.reply(e,{error:{message:"Cannot read state events of this type"}});a=this.driver.readStateEvents(e.data.type,c,s,r)}else{if(!this.canReceiveRoomEvent(e.data.type,e.data.msgtype))return this.transport.reply(e,{error:{message:"Cannot read room events of this type"}});a=this.driver.readRoomEvents(e.data.type,e.data.msgtype,s,r)}return a.then((function(r){return t.transport.reply(e,{events:r})}))}},{key:"handleSendEvent",value:function(e){var t,r=this;if(!e.data.type)return this.transport.reply(e,{error:{message:"Invalid request - missing event type"}});if(e.data.room_id&&!this.canUseRoomTimeline(e.data.room_id))return this.transport.reply(e,{error:{message:"Unable to access room timeline: ".concat(e.data.room_id)}});if(null!==e.data.state_key&&void 0!==e.data.state_key){if(!this.canSendStateEvent(e.data.type,e.data.state_key))return this.transport.reply(e,{error:{message:"Cannot send state events of this type"}});t=this.driver.sendEvent(e.data.type,e.data.content||{},e.data.state_key,e.data.room_id)}else{var i=e.data.content||{},n=i.msgtype;if(!this.canSendRoomEvent(e.data.type,n))return this.transport.reply(e,{error:{message:"Cannot send room events of this type"}});t=this.driver.sendEvent(e.data.type,i,null,e.data.room_id)}t.then((function(t){return r.transport.reply(e,{room_id:t.roomId,event_id:t.eventId})})).catch((function(t){return console.error("error sending event: ",t),r.transport.reply(e,{error:{message:"Error sending event"}})}))}},{key:"handleSendToDevice",value:(R=g(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.type){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Invalid request - missing event type"}});case 3:case 8:case 13:case 18:case 25:e.next=32;break;case 5:if(t.data.messages){e.next=10;break}return e.next=8,this.transport.reply(t,{error:{message:"Invalid request - missing event contents"}});case 10:if("boolean"==typeof t.data.encrypted){e.next=15;break}return e.next=13,this.transport.reply(t,{error:{message:"Invalid request - missing encryption flag"}});case 15:if(this.canSendToDeviceEvent(t.data.type)){e.next=20;break}return e.next=18,this.transport.reply(t,{error:{message:"Cannot send to-device events of this type"}});case 20:return e.prev=20,e.next=23,this.driver.sendToDevice(t.data.type,t.data.encrypted,t.data.messages);case 23:return e.next=25,this.transport.reply(t,{});case 27:return e.prev=27,e.t0=e.catch(20),console.error("error sending to-device event",e.t0),e.next=32,this.transport.reply(t,{error:{message:"Error sending event"}});case 32:case"end":return e.stop()}}),e,this,[[20,27]])}))),function(e){return R.apply(this,arguments)})},{key:"pollTurnServers",value:(k=g(p().mark((function e(t,r){var i,n,o,s,c,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.transport.send(a.WidgetApiToWidgetAction.UpdateTurnServers,r);case 3:i=!1,n=!1,e.prev=5,s=T(t);case 7:return e.next=9,s.next();case 9:if(!(i=!(c=e.sent).done)){e.next=16;break}return l=c.value,e.next=13,this.transport.send(a.WidgetApiToWidgetAction.UpdateTurnServers,l);case 13:i=!1,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),n=!0,o=e.t0;case 22:if(e.prev=22,e.prev=23,!i||null==s.return){e.next=27;break}return e.next=27,s.return();case 27:if(e.prev=27,!n){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(22);case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),console.error("error polling for TURN servers",e.t1);case 37:case"end":return e.stop()}}),e,this,[[0,34],[5,18,22,32],[23,,27,31]])}))),function(e,t){return k.apply(this,arguments)})},{key:"handleWatchTurnServers",value:(C=g(p().mark((function e(t){var r,i,n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(c.MatrixCapabilities.MSC3846TurnServers)){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Missing capability"}});case 3:case 8:e.next=30;break;case 5:if(!this.turnServers){e.next=10;break}return e.next=8,this.transport.reply(t,{});case 10:return e.prev=10,r=this.driver.getTurnServers(),e.next=14,r.next();case 14:if(i=e.sent,n=i.done,o=i.value,!n){e.next=19;break}throw new Error("Client refuses to provide any TURN servers");case 19:return e.next=21,this.transport.reply(t,{});case 21:this.pollTurnServers(r,o),this.turnServers=r,e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(10),console.error("error getting first TURN server results",e.t0),e.next=30,this.transport.reply(t,{error:{message:"TURN servers not available"}});case 30:case"end":return e.stop()}}),e,this,[[10,25]])}))),function(e){return C.apply(this,arguments)})},{key:"handleUnwatchTurnServers",value:(b=g(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(c.MatrixCapabilities.MSC3846TurnServers)){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Missing capability"}});case 3:case 8:e.next=15;break;case 5:if(this.turnServers){e.next=10;break}return e.next=8,this.transport.reply(t,{});case 10:return e.next=12,this.turnServers.return(void 0);case 12:return this.turnServers=null,e.next=15,this.transport.reply(t,{});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"handleReadRelations",value:(y=g(p().mark((function e(t){var r,i,n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.event_id){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - missing event ID"}}));case 2:if(!(void 0!==t.data.limit&&t.data.limit<0)){e.next=4;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - limit out of range"}}));case 4:if(void 0===t.data.room_id||this.canUseRoomTimeline(t.data.room_id)){e.next=6;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Unable to access room timeline: ".concat(t.data.room_id)}}));case 6:return e.prev=6,e.next=9,this.driver.readEventRelations(t.data.event_id,t.data.room_id,t.data.rel_type,t.data.event_type,t.data.from,t.data.to,t.data.limit,t.data.direction);case 9:if(!(r=e.sent).originalEvent){e.next=18;break}if(void 0===r.originalEvent.state_key){e.next=16;break}if(this.canReceiveStateEvent(r.originalEvent.type,r.originalEvent.state_key)){e.next=14;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Cannot read state events of this type"}}));case 14:e.next=18;break;case 16:if(this.canReceiveRoomEvent(r.originalEvent.type,r.originalEvent.content.msgtype)){e.next=18;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Cannot read room events of this type"}}));case 18:return i=r.chunk.filter((function(e){return void 0!==e.state_key?n.canReceiveStateEvent(e.type,e.state_key):n.canReceiveRoomEvent(e.type,e.content.msgtype)})),e.abrupt("return",this.transport.reply(t,{original_event:r.originalEvent,chunk:i,prev_batch:r.prevBatch,next_batch:r.nextBatch}));case 22:return e.prev=22,e.t0=e.catch(6),console.error("error getting the relations",e.t0),e.next=27,this.transport.reply(t,{error:{message:"Unexpected error while reading relations"}});case 27:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(e){return y.apply(this,arguments)})},{key:"handleMessage",value:function(e){if(!this.isStopped){var t=new CustomEvent("action:".concat(e.detail.action),{detail:e.detail,cancelable:!0});if(this.emit("action:".concat(e.detail.action),t),!t.defaultPrevented)switch(e.detail.action){case a.WidgetApiFromWidgetAction.ContentLoaded:return this.handleContentLoadedAction(e.detail);case a.WidgetApiFromWidgetAction.SupportedApiVersions:return this.replyVersions(e.detail);case a.WidgetApiFromWidgetAction.SendEvent:return this.handleSendEvent(e.detail);case a.WidgetApiFromWidgetAction.SendToDevice:return this.handleSendToDevice(e.detail);case a.WidgetApiFromWidgetAction.GetOpenIDCredentials:return this.handleOIDC(e.detail);case a.WidgetApiFromWidgetAction.MSC2931Navigate:return this.handleNavigate(e.detail);case a.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities:return this.handleCapabilitiesRenegotiate(e.detail);case a.WidgetApiFromWidgetAction.MSC2876ReadEvents:return this.handleReadEvents(e.detail);case a.WidgetApiFromWidgetAction.WatchTurnServers:return this.handleWatchTurnServers(e.detail);case a.WidgetApiFromWidgetAction.UnwatchTurnServers:return this.handleUnwatchTurnServers(e.detail);case a.WidgetApiFromWidgetAction.MSC3869ReadRelations:return this.handleReadRelations(e.detail);default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}}},{key:"takeScreenshot",value:function(){return this.transport.send(a.WidgetApiToWidgetAction.TakeScreenshot,{})}},{key:"updateVisibility",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.UpdateVisibility,{visible:e})}},{key:"sendWidgetConfig",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.WidgetConfig,e).then()}},{key:"notifyModalWidgetButtonClicked",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.ButtonClicked,{id:e}).then()}},{key:"notifyModalWidgetClose",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.CloseModalWidget,e).then()}},{key:"feedEvent",value:(m=g(p().mark((function e(t,r){var i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.room_id===r||this.canUseRoomTimeline(t.room_id)){e.next=2;break}return e.abrupt("return");case 2:if(void 0===t.state_key||null===t.state_key){e.next=7;break}if(this.canReceiveStateEvent(t.type,t.state_key)){e.next=5;break}return e.abrupt("return");case 5:e.next=9;break;case 7:if(this.canReceiveRoomEvent(t.type,null===(i=t.content)||void 0===i?void 0:i.msgtype)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.transport.send(a.WidgetApiToWidgetAction.SendEvent,t);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"feedToDevice",value:(n=g(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.canReceiveToDeviceEvent(t.type)){e.next=3;break}return e.next=3,this.transport.send(a.WidgetApiToWidgetAction.SendToDevice,w(w({},t),{},{encrypted:r}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}],r&&_(t.prototype,r),i&&_(t,i),Object.defineProperty(t,"prototype",{writable:!1}),O}(n.EventEmitter);e.exports.ClientWidgetApi=R})),i.register("lbS8M",(function(e,t){var r,i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.VideoConferenceCapabilities=e.exports.StickerpickerCapabilities=e.exports.MatrixCapabilities=void 0,e.exports.getTimelineRoomIDFromCapability=function(e){return e.substring(e.indexOf(":")+1)},e.exports.isTimelineCapability=function(e){return null==e?void 0:e.startsWith("org.matrix.msc2762.timeline:")},e.exports.isTimelineCapabilityFor=function(e,t){return e==="org.matrix.msc2762.timeline:".concat(t)},e.exports.MatrixCapabilities=r,(i=r||(e.exports.MatrixCapabilities=r={})).Screenshots="m.capability.screenshot",i.StickerSending="m.sticker",i.AlwaysOnScreen="m.always_on_screen",i.RequiresClient="io.element.requires_client",i.MSC2931Navigate="org.matrix.msc2931.navigate",i.MSC3846TurnServers="town.robin.msc3846.turn_servers";var n=[r.StickerSending];e.exports.StickerpickerCapabilities=n;var o=[r.AlwaysOnScreen];e.exports.VideoConferenceCapabilities=o})),i.register("e5mjp",(function(e,t){function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SimpleObservable=void 0;var o=function(){function e(t){var r,i,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=[],(i="listeners")in(r=this)?Object.defineProperty(r,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[i]=n,t&&this.listeners.push(t)}var t,i,o;return t=e,(i=[{key:"onUpdate",value:function(e){this.listeners.push(e)}},{key:"update",value:function(e){var t,i=r(this.listeners);try{for(i.s();!(t=i.n()).done;)(0,t.value)(e)}catch(e){i.e(e)}finally{i.f()}}},{key:"close",value:function(){this.listeners=[]}}])&&n(t.prototype,i),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.SimpleObservable=o})),i.register("dMBQL",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("78lsm",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("flXDn",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("cFSSq",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("kiABc",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("kopb9",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isErrorResponse=function(e){if("error"in e){return!!e.error.message}return!1}})),i.register("hAyjW",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("gywY8",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("lVT8C",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("04Jjc",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("7jWzq",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("icKds",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("dXPj6",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("gh8nc",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("3qdML",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("jrx9O",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("krXmq",(function(e,t){var r,i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetKind=void 0,e.exports.WidgetKind=r,(i=r||(e.exports.WidgetKind=r={})).Room="room",i.Account="account",i.Modal="modal"})),i.register("2NlfF",(function(e,t){var r,i;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ModalButtonKind=void 0,e.exports.ModalButtonKind=r,(i=r||(e.exports.ModalButtonKind=r={})).Primary="m.primary",i.Secondary="m.secondary",i.Warning="m.warning",i.Danger="m.danger",i.Link="m.link"})),i.register("eQkL1",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("1Xklf",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("aLy2h",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("9FGnp",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("fTvYq",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("16UdW",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("7Q79V",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("er1KY",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("2SuYn",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("abmZm",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isValidUrl=function(e){if(!e)return!1;try{var t=new URL(e);return"http"===t.protocol||"https"===t.protocol}catch(e){if(e instanceof TypeError)return!1;throw e}}})),i.register("4twjR",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.assertPresent=function(e,t){if(!e[t])throw new Error("".concat(t," is required"))}})),i.register("fc9gm",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Widget=void 0;var r=i("4twjR"),n=i("4v7cb");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.definition=t,!this.definition)throw new Error("Definition is required");(0,r.assertPresent)(t,"id"),(0,r.assertPresent)(t,"creatorUserId"),(0,r.assertPresent)(t,"type"),(0,r.assertPresent)(t,"url")}var t,i,s;return t=e,(i=[{key:"creatorUserId",get:function(){return this.definition.creatorUserId}},{key:"type",get:function(){return this.definition.type}},{key:"id",get:function(){return this.definition.id}},{key:"name",get:function(){return this.definition.name||null}},{key:"title",get:function(){return this.rawData.title||null}},{key:"templateUrl",get:function(){return this.definition.url}},{key:"origin",get:function(){return new URL(this.templateUrl).origin}},{key:"waitForIframeLoad",get:function(){return!1!==this.definition.waitForIframeLoad&&(this.definition.waitForIframeLoad,!0)}},{key:"rawData",get:function(){return this.definition.data||{}}},{key:"getCompleteUrl",value:function(e){return(0,n.runTemplate)(this.templateUrl,this.definition,e)}}])&&o(t.prototype,i),s&&o(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.Widget=s})),i.register("41QTn",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetParser=void 0;var r=i("fc9gm"),n=i("abmZm");function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw o}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,s;return t=e,s=[{key:"parseAccountData",value:function(t){if(!t)return[];for(var r=[],i=0,n=Object.keys(t);i<n.length;i++){var o=n[i],s=t[o];if(s&&("m.widget"===s.type||"im.vector.modular.widgets"===s.type)&&s.sender&&(s.state_key||s.id)===o){var a={content:s.content,sender:s.sender,type:"m.widget",state_key:o,event_id:"$example",room_id:"!example",origin_server_ts:1},c=e.parseRoomWidget(a);c&&r.push(c)}}return r}},{key:"parseWidgetsFromRoomState",value:function(t){if(!t)return[];var r,i=[],n=o(t);try{for(n.s();!(r=n.n()).done;){var s=r.value,a=e.parseRoomWidget(s);a&&i.push(a)}}catch(e){n.e(e)}finally{n.f()}return i}},{key:"parseRoomWidget",value:function(t){if(!t)return null;if("m.widget"!==t.type&&"im.vector.modular.widgets"!==t.type)return null;var r=t.content||{},i={id:t.state_key,creatorUserId:r.creatorUserId||t.sender,name:r.name,type:r.type,url:r.url,waitForIframeLoad:r.waitForIframeLoad,data:r.data};return e.processEstimatedWidget(i)}},{key:"processEstimatedWidget",value:function(e){return e.id&&e.creatorUserId&&e.type&&(0,n.isValidUrl)(e.url)?new r.Widget(e):null}}],(i=null)&&a(t.prototype,i),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.WidgetParser=c})),i.register("dLdTB",(function(e,t){function r(e){return null==e?"".concat(e):e.toString()}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.runTemplate=function(e,t,i){for(var n=Object.assign({},t.data,{matrix_room_id:i.widgetRoomId||"",matrix_user_id:i.currentUserId,matrix_display_name:i.userDisplayName||i.currentUserId,matrix_avatar_url:i.userHttpAvatarUrl||"",matrix_widget_id:t.id,"org.matrix.msc2873.client_id":i.clientId||"","org.matrix.msc2873.client_theme":i.clientTheme||"","org.matrix.msc2873.client_language":i.clientLanguage||""}),o=e,s=0,a=Object.keys(n);s<a.length;s++){var c=a[s],l="$".concat(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),u=new RegExp(l,"g");o=o.replace(u,encodeURIComponent(r(n[c])))}return o},e.exports.toString=r})),i.register("4Ljtc",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WidgetDriver=void 0;var r=i("4v7cb");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,o;return t=e,(i=[{key:"validateCapabilities",value:function(e){return Promise.resolve(new Set)}},{key:"sendEvent",value:function(e,t){return Promise.reject(new Error("Failed to override function"))}},{key:"sendToDevice",value:function(e,t,r){return Promise.reject(new Error("Failed to override function"))}},{key:"readRoomEvents",value:function(e,t,r){return Promise.resolve([])}},{key:"readStateEvents",value:function(e,t,r){return Promise.resolve([])}},{key:"readEventRelations",value:function(e,t,r,i,n,o,s,a){return Promise.resolve({chunk:[]})}},{key:"askOpenID",value:function(e){e.update({state:r.OpenIDRequestState.Blocked})}},{key:"navigate",value:function(e){throw new Error("Navigation is not implemented")}},{key:"getTurnServers",value:function(){throw new Error("TURN server support is not implemented")}}])&&n(t.prototype,i),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports.WidgetDriver=o})),i.register("7Ac1Y",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SyncAccumulator=e.exports.Category=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("gjhRv"),a=i("ldT3p"),c=i("cXHgq"),l=i("aYGbo");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let d;var f;e.exports.Category=d,(f=d||(e.exports.Category=d={})).Invite="invite",f.Leave="leave",f.Join="join";function p(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}e.exports.SyncAccumulator=class{constructor(e={}){this.opts=e,(0,n.default)(this,"accountData",{}),(0,n.default)(this,"inviteRooms",{}),(0,n.default)(this,"joinRooms",{}),(0,n.default)(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e,t=!1){this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}accumulateRooms(e,t=!1){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((r=>{this.accumulateRoom(r,d.Invite,e.rooms.invite[r],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((r=>{this.accumulateRoom(r,d.Join,e.rooms.join[r],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((r=>{this.accumulateRoom(r,d.Leave,e.rooms.leave[r],t)})))}accumulateRoom(e,t,r,i=!1){switch(t){case d.Invite:this.accumulateInviteState(e,r);break;case d.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,i);break;case d.Leave:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:o.logger.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const r=this.inviteRooms[e];t.invite_state.events.forEach((e=>{let t=!1;for(let i=0;i<r.invite_state.events.length;i++){const n=r.invite_state.events[i];n.type===e.type&&n.state_key==e.state_key&&(r.invite_state.events[i]=e,t=!0)}t||r.invite_state.events.push(e)}))}accumulateJoinState(e,t,r=!1){var i,n,o,u,d,f,m,g;this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_readReceipts:{},_threadReadReceipts:{}});const v=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{v._accountData[e.type]=e})),t.unread_notifications&&(v._unreadNotifications=t.unread_notifications),v._unreadThreadNotifications=null!==(i=null!==(n=t[l.UNREAD_THREAD_NOTIFICATIONS.stable])&&void 0!==n?n:t[l.UNREAD_THREAD_NOTIFICATIONS.unstable])&&void 0!==i?i:void 0,t.summary){const e="m.heroes",r="m.invited_member_count",i="m.joined_member_count",n=v._summary,o=t.summary;n[e]=o[e]||n[e],n[i]=o[i]||n[i],n[r]=o[r]||n[r]}if(null===(o=t.ephemeral)||void 0===o||null===(u=o.events)||void 0===u||u.forEach((e=>{e.type===a.EventType.Receipt&&e.content&&Object.keys(e.content).forEach((t=>{Object.entries(e.content[t]).forEach((([r,i])=>{if((0,s.isSupportedReceiptType)(r))for(const o of Object.keys(i)){const i=e.content[t][r][o],s={data:e.content[t][r][o],type:r,eventId:t};var n;if(i.thread_id&&i.thread_id!==c.MAIN_ROOM_TIMELINE)v._threadReadReceipts=h(h({},v._threadReadReceipts),{},{[i.thread_id]:h(h({},null!==(n=v._threadReadReceipts[i.thread_id])&&void 0!==n?n:{}),{},{[o]:s})});else v._readReceipts[o]=s}}))}))})),t.timeline&&t.timeline.limited&&(v._timeline=[]),null===(d=t.state)||void 0===d||null===(f=d.events)||void 0===f||f.forEach((e=>{p(v._currentState,e)})),null===(m=t.timeline)||void 0===m||null===(g=m.events)||void 0===g||g.forEach(((e,i)=>{var n;let o;if(p(v._currentState,e),r)o=e;else{o=Object.assign({},e),void 0!==o.unsigned&&(o.unsigned=Object.assign({},o.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(o._localTs=Date.now()-t)}v._timeline.push({event:o,token:0===i&&null!==(n=t.timeline.prev_batch)&&void 0!==n?n:null})})),v._timeline.length>this.opts.maxTimelineEntries){for(let e=v._timeline.length-this.opts.maxTimelineEntries;e<v._timeline.length;e++)if(v._timeline[e].token){v._timeline=v._timeline.slice(e,v._timeline.length);break}}}getJSON(e=!1){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((r=>{const i=this.joinRooms[r],n={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:i._unreadNotifications,unread_thread_notifications:i._unreadThreadNotifications,summary:i._summary};Object.keys(i._accountData).forEach((e=>{n.account_data.events.push(i._accountData[e])}));const o={type:a.EventType.Receipt,room_id:r,content:{}};for(const[e,t]of Object.entries(i._readReceipts))o.content[t.eventId]||(o.content[t.eventId]={}),o.content[t.eventId][t.type]||(o.content[t.eventId][t.type]={}),o.content[t.eventId][t.type][e]=t.data;for(const e of Object.values(i._threadReadReceipts))for(const[t,r]of Object.entries(e))o.content[r.eventId]||(o.content[r.eventId]={}),o.content[r.eventId][r.type]||(o.content[r.eventId][r.type]={}),o.content[r.eventId][r.type][t]=r.data;Object.keys(o.content).length>0&&n.ephemeral.events.push(o),i._timeline.forEach((t=>{if(!n.timeline.prev_batch){if(!t.token)return;n.timeline.prev_batch=t.token}let r;var i;!e&&("_localTs"in(i=t.event)&&void 0!==i._localTs)?(r=Object.assign({},t.event),void 0!==r.unsigned&&(r.unsigned=Object.assign({},r.unsigned)),delete r._localTs,r.unsigned=r.unsigned||{},r.unsigned.age=Date.now()-t.event._localTs):r=t.event,n.timeline.events.push(r)}));const c=Object.create(null);for(let e=n.timeline.events.length-1;e>=0;e--){const t=n.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const r=(0,s.deepCopy)(t);r.unsigned&&(r.unsigned.prev_content&&(r.content=r.unsigned.prev_content),r.unsigned.prev_sender&&(r.sender=r.unsigned.prev_sender)),p(c,r)}Object.keys(i._currentState).forEach((e=>{Object.keys(i._currentState[e]).forEach((t=>{let r=i._currentState[e][t];c[e]&&c[e][t]&&(r=c[e][t]),n.state.events.push(r)}))})),t.join[r]=n}));const r=[];return Object.keys(this.accountData).forEach((e=>{r.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,accountData:r}}getNextBatchToken(){return this.nextBatch}}})),i.register("6zVPc",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.TimelineWindow=e.exports.TimelineIndex=void 0;var n=r(i("3EUCw")),o=i("jxKcy");i("gEWrD");const s=function(){};e.exports.TimelineWindow=class{constructor(e,t,r={}){this.client=e,this.timelineSet=t,(0,n.default)(this,"windowLimit",void 0),(0,n.default)(this,"start",void 0),(0,n.default)(this,"end",void 0),(0,n.default)(this,"eventCount",0),this.windowLimit=r.windowLimit||1e3}load(e,t=20){const r=r=>{if(!r)throw new Error("No timeline given to initFields");let i;const n=r.getEvents();if(e){if(i=n.findIndex((t=>t.getId()===e)),i<0)throw new Error("getEventTimeline result didn't include requested event")}else i=n.length;const o=Math.min(n.length,i+Math.ceil(t/2)),s=Math.max(0,o-t);this.start=new a(r,s-r.getBaseIndex()),this.end=new a(r,o-r.getBaseIndex()),this.eventCount=o-s};return this.timelineSet.getTimelineForEvent(e)?(r(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){var t,r;if(e==o.EventTimeline.BACKWARDS)return null!==(t=this.start)&&void 0!==t?t:null;if(e==o.EventTimeline.FORWARDS)return null!==(r=this.end)&&void 0!==r?r:null;throw new Error("Invalid direction '"+e+"'")}extend(e,t){const r=this.getTimelineIndex(e);if(!r)return s("TimelineWindow: no timeline yet"),!1;const i=e==o.EventTimeline.BACKWARDS?r.retreat(t):r.advance(t);if(i){this.eventCount+=i,s("TimelineWindow: increased cap by "+i+" (now "+this.eventCount+")");const t=this.eventCount-this.windowLimit;return t>0&&this.unpaginate(t,e!=o.EventTimeline.BACKWARDS),!0}return!1}canPaginate(e){const t=this.getTimelineIndex(e);if(!t)return s("TimelineWindow: no timeline yet"),!1;if(e==o.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;const r=t.timeline.getNeighbouringTimeline(e),i=t.timeline.getPaginationToken(e);return Boolean(r)||Boolean(i)}async paginate(e,t,r=!0,i=5){const n=this.getTimelineIndex(e);if(!n)return s("TimelineWindow: no timeline yet"),!1;if(n.pendingPaginate)return n.pendingPaginate;if(this.extend(e,t))return!0;if(!r||0===i)return!1;if(!n.timeline.getPaginationToken(e))return s("TimelineWindow: no token"),!1;s("TimelineWindow: starting request");const a=this.client.paginateEventTimeline(n.timeline,{backwards:e==o.EventTimeline.BACKWARDS,limit:t}).finally((function(){n.pendingPaginate=void 0})).then((r=>(s("TimelineWindow: request completed with result "+r),r?this.paginate(e,t,!0,i-1):this.paginate(e,t,!1,0))));return n.pendingPaginate=a,a}unpaginate(e,t){const r=t?this.start:this.end;if(!r)throw new Error(`Attempting to unpaginate startOfTimeline=${t} but don't have this direction`);if(e>this.eventCount||e<0)throw new Error(`Attemting to unpaginate ${e} events, but only have ${this.eventCount} in the timeline`);for(;e>0;){const i=t?r.advance(e):r.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,s("TimelineWindow.unpaginate: dropped "+i+" (now "+this.eventCount+")")}}getEvents(){if(!this.start)return[];const e=[];let t=this.start.timeline;for(;;){var r,i;const n=t.getEvents();let s=0,a=n.length;t===this.start.timeline&&(s=this.start.index+t.getBaseIndex()),t===(null===(r=this.end)||void 0===r?void 0:r.timeline)&&(a=this.end.index+t.getBaseIndex());for(let t=s;t<a;t++)e.push(n[t]);if(t===(null===(i=this.end)||void 0===i?void 0:i.timeline))break;t=t.getNeighbouringTimeline(o.EventTimeline.FORWARDS)}return e}};class a{constructor(e,t){this.timeline=e,this.index=t,(0,n.default)(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const r=this.timeline.getNeighbouringTimeline(e<0?o.EventTimeline.BACKWARDS:o.EventTimeline.FORWARDS);return r?(this.timeline=r,this.index=e<0?this.maxIndex():this.minIndex(),s("paginate: switched to new neighbour"),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}e.exports.TimelineIndex=a})),i.register("7ZHER",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.InteractiveAuth=e.exports.AuthType=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("gjhRv");const a="m.login.email.identity",c="m.login.msisdn";let l;var u;e.exports.AuthType=l,(u=l||(e.exports.AuthType=l={})).Password="m.login.password",u.Recaptcha="m.login.recaptcha",u.Terms="m.login.terms",u.Email="m.login.email.identity",u.Msisdn="m.login.msisdn",u.Sso="m.login.sso",u.SsoUnstable="org.matrix.login.sso",u.Dummy="m.login.dummy",u.RegistrationToken="m.login.registration_token",u.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token";class h extends Error{constructor(e,t,r){super(e),this.required_stages=t,this.flows=r,(0,n.default)(this,"name","NoAuthFlowFoundError")}}e.exports.InteractiveAuth=class{constructor(e){(0,n.default)(this,"matrixClient",void 0),(0,n.default)(this,"inputs",void 0),(0,n.default)(this,"clientSecret",void 0),(0,n.default)(this,"requestCallback",void 0),(0,n.default)(this,"busyChangedCallback",void 0),(0,n.default)(this,"stateUpdatedCallback",void 0),(0,n.default)(this,"requestEmailTokenCallback",void 0),(0,n.default)(this,"data",void 0),(0,n.default)(this,"emailSid",void 0),(0,n.default)(this,"requestingEmailToken",!1),(0,n.default)(this,"attemptAuthDeferred",null),(0,n.default)(this,"chosenFlow",null),(0,n.default)(this,"currentStage",null),(0,n.default)(this,"emailAttempt",1),(0,n.default)(this,"submitPromise",null),(0,n.default)(this,"requestEmailToken",(async()=>{if(this.requestingEmailToken)o.logger.warn("Could not request email token: Already requesting");else{o.logger.trace("Requesting email token. Attempt: "+this.emailAttempt),this.requestingEmailToken=!0;try{const e=await this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,this.emailAttempt++,this.data.session);this.emailSid=e.sid,o.logger.trace("Email token request succeeded")}finally{this.requestingEmailToken=!1}}})),this.matrixClient=e.matrixClient,this.data=e.authData||{},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid}attemptAuth(){var e;this.attemptAuthDeferred=(0,s.defer)();const t=this.attemptAuthDeferred.promise;if(null!==(e=this.data)&&void 0!==e&&e.flows)this.startNextAuthStage();else{var r;null===(r=this.busyChangedCallback)||void 0===r||r.call(this,!0);const e=this.data.session?{session:this.data.session}:null;this.doRequest(e).finally((()=>{var e;null===(e=this.busyChangedCallback)||void 0===e||e.call(this,!1)}))}return t}async poll(){if(!this.data.session)return;if(!this.attemptAuthDeferred)return;if(this.submitPromise)return;let e={};if(this.currentStage==a&&this.emailSid){const t={sid:this.emailSid,client_secret:this.clientSecret};if(await this.matrixClient.doesServerRequireIdServerParam()){const e=new URL(this.matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:a,threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)}getSessionId(){var e;return null===(e=this.data)||void 0===e?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var t;return null===(t=this.data.params)||void 0===t?void 0:t[e]}getChosenFlow(){return this.chosenFlow}async submitAuthDict(e,t=!1){if(!this.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");var r;t||(null===(r=this.busyChangedCallback)||void 0===r||r.call(this,!0));for(;this.submitPromise;)try{await this.submitPromise}catch(e){}let i;this.data.session?(i={session:this.data.session},Object.assign(i,e)):i=e;try{this.submitPromise=this.doRequest(i,t),await this.submitPromise}finally{var n;if(this.submitPromise=null,!t)null===(n=this.busyChangedCallback)||void 0===n||n.call(this,!1)}}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}async doRequest(e,t=!1){try{const r=await this.requestCallback(e,t);this.attemptAuthDeferred.resolve(r),this.attemptAuthDeferred=null}catch(e){var r,i,n;const a=null!==(r=null===(i=e.data)||void 0===i?void 0:i.flows)&&void 0!==r?r:null,c=this.data.flows||Boolean(a);var s;if(401!==e.httpStatus||!e.data||!c)if(t)o.logger.log("Background poll request failed doing UI auth: ignoring",e);else null===(s=this.attemptAuthDeferred)||void 0===s||s.reject(e);e.data||(e.data={}),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this.data.flows,e.data.completed=this.data.completed,e.data.session=this.data.session),this.data=e.data;try{this.startNextAuthStage()}catch(e){return this.attemptAuthDeferred.reject(e),void(this.attemptAuthDeferred=null)}if(!this.emailSid&&null!==(n=this.chosenFlow)&&void 0!==n&&n.stages.includes(l.Email))try{await this.requestEmailToken()}catch(e){this.attemptAuthDeferred.reject(e),this.attemptAuthDeferred=null}}}startNextAuthStage(){var e,t;const r=this.chooseStage();if(!r)throw new Error("No incomplete flows from the server");var i,n;(this.currentStage=r,r!==l.Dummy)?null!==(e=this.data)&&void 0!==e&&e.errcode||null!==(t=this.data)&&void 0!==t&&t.error?this.stateUpdatedCallback(r,{errcode:(null===(i=this.data)||void 0===i?void 0:i.errcode)||"",error:(null===(n=this.data)||void 0===n?void 0:n.error)||""}):this.stateUpdatedCallback(r,r===a?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),o.logger.log("Active flow => %s",JSON.stringify(this.chosenFlow));const e=this.firstUncompletedStage(this.chosenFlow);return o.logger.log("Next stage: %s",e),e}chooseFlow(){const e=this.data.flows||[],t=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),r=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber);for(const i of e){let e=!1,n=!1;for(const t of i.stages)t===a?e=!0:t==c&&(n=!0);if(e==t&&n==r)return i}const i=[];throw t&&i.push(a),r&&i.push(c),new h("No appropriate authentication flow found",i,e)}firstUncompletedStage(e){const t=this.data.completed||[];return e.stages.find((e=>!t.includes(e)))}}})),i.register("27kVK",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.IndexedDBStore=void 0;var n=r(i("3EUCw")),o=i("fzuFx"),s=i("exhuv"),a=i("5PGSV"),c=i("fLhqT"),l=i("7BSj1"),u=i("gEWrD"),h=i("75Qdj");class d extends o.MemoryStore{static exists(e,t){return s.LocalIndexedDBStoreBackend.exists(e,t)}constructor(e){if(super(e),(0,n.default)(this,"backend",void 0),(0,n.default)(this,"startedUp",!1),(0,n.default)(this,"syncTs",0),(0,n.default)(this,"userModifiedMap",{}),(0,n.default)(this,"emitter",new h.TypedEventEmitter),(0,n.default)(this,"on",this.emitter.on.bind(this.emitter)),(0,n.default)(this,"getSavedSync",this.degradable((()=>this.backend.getSavedSync()),"getSavedSync")),(0,n.default)(this,"isNewlyCreated",this.degradable((()=>this.backend.isNewlyCreated()),"isNewlyCreated")),(0,n.default)(this,"getSavedSyncToken",this.degradable((()=>this.backend.getNextBatchToken()),"getSavedSyncToken")),(0,n.default)(this,"deleteAllData",this.degradable((()=>(super.deleteAllData(),this.backend.clearDatabase().then((()=>{u.logger.log("Deleted indexeddb data.")}),(e=>{throw u.logger.error(`Failed to delete indexeddb data: ${e}`),e})))))),(0,n.default)(this,"reallySave",this.degradable((()=>{this.syncTs=Date.now();const e=[];for(const t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)}))),(0,n.default)(this,"setSyncData",this.degradable((e=>this.backend.setSyncData(e)),"setSyncData")),(0,n.default)(this,"getOutOfBandMembers",this.degradable((e=>this.backend.getOutOfBandMembers(e)),"getOutOfBandMembers")),(0,n.default)(this,"setOutOfBandMembers",this.degradable(((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t))),"setOutOfBandMembers")),(0,n.default)(this,"clearOutOfBandMembers",this.degradable((e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e))),"clearOutOfBandMembers")),(0,n.default)(this,"getClientOptions",this.degradable((()=>this.backend.getClientOptions()),"getClientOptions")),(0,n.default)(this,"storeClientOptions",this.degradable((e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e))),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new a.RemoteIndexedDBStoreBackend(e.workerFactory,e.dbName):this.backend=new s.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName)}startup(){return this.startedUp?(u.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(u.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((()=>(u.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{u.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach((([e,t])=>{const r=new c.User(e);t&&r.setPresenceEvent(new l.MatrixEvent(t)),this.userModifiedMap[r.userId]=r.getLastModifiedTime(),this.storeUser(r)}))})))}wantsSave(){return Date.now()-this.syncTs>3e5}save(e=!1){return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){const r=t?super[t]:null;return async(...t)=>{try{return await e.call(this,...t)}catch(e){u.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emitter.emit("degraded",e);try{u.logger.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),u.logger.log("IndexedDBStore delete after degrading succeeded")}catch(e){u.logger.warn("IndexedDBStore delete after degrading failed",e)}if(r)return r.call(this,...t)}}}async getPendingEvents(e){if(!this.localStorage)return super.getPendingEvents(e);const t=this.localStorage.getItem(f(e));if(t)try{return JSON.parse(t)}catch(e){u.logger.error("Could not parse persisted pending events",e)}return[]}async setPendingEvents(e,t){if(!this.localStorage)return super.setPendingEvents(e,t);t.length>0?this.localStorage.setItem(f(e),JSON.stringify(t)):this.localStorage.removeItem(f(e))}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function f(e){return`mx_pending_events_${e}`}e.exports.IndexedDBStore=d})),i.register("exhuv",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.LocalIndexedDBStoreBackend=void 0;var n=r(i("3EUCw")),o=i("7Ac1Y"),s=u(i("gjhRv")),a=u(i("iQAad")),c=i("gEWrD");function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}const h=[e=>{e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})},e=>{e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},e=>{e.createObjectStore("client_options",{keyPath:["clobber"]})},e=>{e.createObjectStore("to_device_queue",{autoIncrement:!0})}],d=h.length;function f(e,t,r){const i=e.openCursor(t);return new Promise(((e,t)=>{const n=[];i.onerror=()=>{t(new Error("Query failed: "+i.error))},i.onsuccess=()=>{const t=i.result;t?(n.push(r(t)),t.continue()):e(n)}}))}function p(e){return new Promise(((t,r)=>{e.oncomplete=function(e){t(e)},e.onerror=function(){r(e.error)}}))}function m(e){return new Promise(((t,r)=>{e.onsuccess=function(e){t(e)},e.onerror=function(){r(e.error)}}))}function g(e){return m(e).then((t=>e.result))}e.exports.LocalIndexedDBStoreBackend=class{static exists(e,t){return t="matrix-js-sdk:"+(t||"default"),a.exists(e,t)}constructor(e,t="default"){this.indexedDB=e,(0,n.default)(this,"dbName",void 0),(0,n.default)(this,"syncAccumulator",void 0),(0,n.default)(this,"db",void 0),(0,n.default)(this,"disconnected",!0),(0,n.default)(this,"_isNewlyCreated",!1),(0,n.default)(this,"isPersisting",!1),(0,n.default)(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+t,this.syncAccumulator=new o.SyncAccumulator}connect(){if(!this.disconnected)return c.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,c.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this.dbName,d);return e.onupgradeneeded=t=>{const r=e.result,i=t.oldVersion;c.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${i}`),i<1&&(this._isNewlyCreated=!0),h.forEach(((e,t)=>{i<=t&&e(r)}))},e.onblocked=()=>{c.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},c.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),m(e).then((async()=>{c.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.result,this.db.onversionchange=()=>{var e;null===(e=this.db)||void 0===e||e.close()},await this.init()}))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((([e,t])=>{c.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,account_data:{events:e}},!0)}))}getOutOfBandMembers(e){return new Promise(((t,r)=>{const i=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),n=IDBKeyRange.only(e),o=i.openCursor(n),s=[];let a=!1;o.onsuccess=()=>{const e=o.result;if(!e)return s.length||a?t(s):t(null);const r=e.value;r.oob_written?a=!0:s.push(r),e.continue()},o.onerror=e=>{r(e)}})).then((t=>(c.logger.log(`LL: got ${null==t?void 0:t.length} membershipEvents from storage for room ${e} ...`),t)))}async setOutOfBandMembers(e,t){c.logger.log(`LL: backend about to store ${t.length} members for ${e}`);const r=this.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events");t.forEach((e=>{i.put(e)}));const n={room_id:e,oob_written:!0,state_key:0};i.put(n),await p(r),c.logger.log(`LL: backend done storing for ${e}!`)}async clearOutOfBandMembers(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),r=IDBKeyRange.only(e),i=g(t.openKeyCursor(r,"next")).then((e=>(null==e?void 0:e.primaryKey)[1])),n=g(t.openKeyCursor(r,"prev")).then((e=>(null==e?void 0:e.primaryKey)[1])),[o,s]=await Promise.all([i,n]),a=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),l=IDBKeyRange.bound([e,o],[e,s]);var u;c.logger.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,o],[e,s]),await(u=a.delete(l),new Promise(((e,t)=>{u.onsuccess=()=>e(u),u.onerror=e=>t(e)})))}clearDatabase(){return new Promise((e=>{c.logger.log(`Removing indexeddb instance: ${this.dbName}`);const t=this.indexedDB.deleteDatabase(this.dbName);t.onblocked=()=>{c.logger.log(`can't yet delete indexeddb ${this.dbName} because it is open elsewhere`)},t.onerror=()=>{c.logger.warn(`unable to delete js-sdk store indexeddb: ${t.error}`),e()},t.onsuccess=()=>{c.logger.log(`Removed indexeddb instance: ${this.dbName}`),e()}}))}getSavedSync(e=!0){const t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(s.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then((()=>{this.syncAccumulator.accumulate(e)}))}async syncToDatabase(e){if(this.isPersisting)return c.logger.warn("Skipping syncToDatabase() as persist already in flight"),void this.pendingUserPresenceData.push(...e);e.unshift(...this.pendingUserPresenceData),this.isPersisting=!0;try{const t=this.syncAccumulator.getJSON(!0);await Promise.all([this.persistUserPresenceEvents(e),this.persistAccountData(t.accountData),this.persistSyncData(t.nextBatch,t.roomsData)])}finally{this.isPersisting=!1}}persistSyncData(e,t){return c.logger.log("Persisting sync data up to",e),s.promiseTry((()=>{const r=this.db.transaction(["sync"],"readwrite");return r.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),p(r).then((()=>{c.logger.log("Persisted sync data up to",e)}))}))}persistAccountData(e){return s.promiseTry((()=>{const t=this.db.transaction(["accountData"],"readwrite"),r=t.objectStore("accountData");for(const t of e)r.put(t);return p(t).then()}))}persistUserPresenceEvents(e){return s.promiseTry((()=>{const t=this.db.transaction(["users"],"readwrite"),r=t.objectStore("users");for(const t of e)r.put({userId:t[0],event:t[1]});return p(t).then()}))}getUserPresenceEvents(){return s.promiseTry((()=>f(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))}loadAccountData(){return c.logger.log("LocalIndexedDBStoreBackend: loading account data..."),s.promiseTry((()=>f(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(c.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))}loadSyncData(){return c.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),s.promiseTry((()=>f(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(c.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&c.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))}getClientOptions(){return Promise.resolve().then((()=>f(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.options})).then((e=>e[0]))))}async storeClientOptions(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await p(t)}async saveToDeviceBatches(e){const t=this.db.transaction(["to_device_queue"],"readwrite"),r=t.objectStore("to_device_queue");for(const t of e)r.add(t);await p(t)}async getOldestToDeviceBatch(){const e=this.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),t=await g(e.openCursor());if(!t)return null;const r=t.value;return{id:t.key,txnId:r.txnId,eventType:r.eventType,batch:r.batch}}async removeToDeviceBatch(e){const t=this.db.transaction(["to_device_queue"],"readwrite");t.objectStore("to_device_queue").delete(e),await p(t)}}})),i.register("5PGSV",(function(e,t){var r=i("lHCw5");Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.RemoteIndexedDBStoreBackend=void 0;var n=r(i("3EUCw")),o=i("gEWrD"),s=i("gjhRv");e.exports.RemoteIndexedDBStoreBackend=class{constructor(e,t){this.workerFactory=e,this.dbName=t,(0,n.default)(this,"worker",void 0),(0,n.default)(this,"nextSeq",0),(0,n.default)(this,"inFlight",{}),(0,n.default)(this,"startPromise",void 0),(0,n.default)(this,"onWorkerMessage",(e=>{const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void o.logger.error("Got reply from worker with no seq");const e=this.inFlight[t.seq];if(void 0===e)return void o.logger.error("Got reply for unknown seq "+t.seq);if(delete this.inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const r=new Error(t.error.message);r.name=t.error.name,e.reject(r)}}else o.logger.warn("Unrecognised message from worker: ",t)}))}connect(){return this.ensureStarted().then((()=>this.doCmd("connect")))}clearDatabase(){return this.ensureStarted().then((()=>this.doCmd("clearDatabase")))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}async saveToDeviceBatches(e){return this.doCmd("saveToDeviceBatches",[e])}async getOldestToDeviceBatch(){return this.doCmd("getOldestToDeviceBatch")}async removeToDeviceBatch(e){return this.doCmd("removeToDeviceBatch",[e])}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then((()=>{o.logger.log("IndexedDB worker is ready")}))),this.startPromise}doCmd(e,t){return Promise.resolve().then((()=>{var r;const i=this.nextSeq++,n=(0,s.defer)();return this.inFlight[i]=n,null===(r=this.worker)||void 0===r||r.postMessage({command:e,seq:i,args:t}),n.promise}))}}})),i.register("aj0Or",(function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0})})),i.register("4pdMn",(function(e,t){
/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
const r=i("hx4Xg")("simple-peer");var n=i("isP3b"),o=i("1oa4b"),s=i("l8KM5"),a=i("gt2If"),c=i("9OtjI"),l=i("awmEs").Buffer;const u=65536;function h(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}class d extends s.Duplex{constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this._id=o(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||o(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||d.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},d.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:n(),!this._wrtc)throw"undefined"==typeof window?c(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):c(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void this.destroy(c(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((e=>{this.destroy(c(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach((e=>{this.addStream(e)})),this._pc.ontrack=e=>{this._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((e=>{this._addIceCandidate(e)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((e=>{this.destroy(c(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(c(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch((e=>{var r;!t.address||t.address.endsWith(".local")?(r="Ignoring unsupported ICE candidate.",console.warn(r)):this.destroy(c(e,"ERR_ADD_ICE_CANDIDATE"))}))}send(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(c(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((t=>{this.addTrack(t,e)}))}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let i=r.get(t);if(i)throw i.removed?c(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):c(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");i=this._pc.addTrack(e,t),r.set(t,i),this._senderMap.set(e,r),this._needsNegotiation()}replaceTrack(e,t,r){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),n=i?i.get(r):null;if(!n)throw c(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,i),null!=n.replaceTrack?n.replaceTrack(t):this.destroy(c(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),i=r?r.get(t):null;if(!i)throw c(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(i):this.destroy(c(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((t=>{this.removeTrack(t,e)}))}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,a((()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1})))}negotiate(){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,(()=>{}))}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),a((()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()})))}_setupData(e){if(!e.channel)return this.destroy(c(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=u),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{const t=e.error instanceof Error?e.error:new Error(`Datachannel error: ${e.message} ${e.filename}:${e.lineno}:${e.colno}`);this.destroy(c(t,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1}),5e3)}_read(){}_write(e,t,r){if(this.destroyed)return r(c(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.destroy(c(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>u?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout((()=>this.destroy()),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=h(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})};this._pc.setLocalDescription(e).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(c(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(c(e,"ERR_CREATE_OFFER"))}))}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=h(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()};this._pc.setLocalDescription(e).then((()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(c(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(c(e,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(c(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(c(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(c(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((t=>{Object.assign(e,t)})),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((r=>{const i=[];r.forEach((e=>{i.push(t(e))})),e(null,i)}),(t=>e(t))):this._pc.getStats.length>0?this._pc.getStats((r=>{if(this.destroyed)return;const i=[];r.result().forEach((e=>{const r={};e.names().forEach((t=>{r[t]=e.stat(t)})),r.id=e.id,r.type=e.type,r.timestamp=e.timestamp,i.push(t(r))})),e(null,i)}),(t=>e(t))):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats(((t,r)=>{if(this.destroyed)return;t&&(r=[]);const i={},n={},o={};let s=!1;r.forEach((e=>{"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(n[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));const a=e=>{s=!0;let t=n[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let r=i[e.remoteCandidateId];r&&(r.ip||r.address)?(this.remoteAddress=r.ip||r.address,this.remotePort=Number(r.port)):r&&r.ipAddress?(this.remoteAddress=r.ipAddress,this.remotePort=Number(r.portNumber)):"string"==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(":"),this.remoteAddress=r[0],this.remotePort=Number(r[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach((e=>{"transport"===e.type&&e.selectedCandidatePairId&&a(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&a(e)})),s||Object.keys(o).length&&!Object.keys(n).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(c(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(e,100)}))};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>u||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=l.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach((t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some((e=>e.id===t.id))||(this._remoteStreams.push(t),a((()=>{this._debug("on stream"),this.emit("stream",t)})))}))}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],r.apply(null,e)}}d.WEBRTC_SUPPORT=!!n(),d.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},d.channelConfig={},e.exports=d})),i.register("hx4Xg",(function(e,t){var r=i("9Mq5w");e.exports.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},e.exports.save=function(t){try{t?e.exports.storage.setItem("debug",t):e.exports.storage.removeItem("debug")}catch(e){}},e.exports.load=function(){let t;try{t=e.exports.storage.getItem("debug")}catch(e){}!t&&void 0!==r&&"env"in r&&(t=void 0);return t},e.exports.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.exports.storage=function(){try{return localStorage}catch(e){}}(),e.exports.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports.log=console.debug||console.log||(()=>{}),e.exports=i("hrbGx")(e.exports);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),i.register("hrbGx",(function(e,t){e.exports=function(e){function t(e){let i,n,o,s=null;function a(...e){if(!a.enabled)return;const r=a,n=Number(new Date),o=n-(i||n);r.diff=o,r.prev=i,r.curr=n,i=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((i,n)=>{if("%%"===i)return"%";s++;const o=t.formatters[n];if("function"==typeof o){const t=e[s];i=o.call(r,t),e.splice(s,1),s--}return i})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(n!==t.namespaces&&(n=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=i("aRyHz"),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}})),i.register("aRyHz",(function(e,t){var r=1e3,i=60*r,n=60*i,o=24*n,s=7*o,a=365.25*o;function c(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}e.exports=function(e,t){t=t||{};var l,u,h=typeof e;if("string"===h&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var c=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*a;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*o;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===h&&isFinite(e))return t.long?(l=e,(u=Math.abs(l))>=o?c(l,u,o,"day"):u>=n?c(l,u,n,"hour"):u>=i?c(l,u,i,"minute"):u>=r?c(l,u,r,"second"):l+" ms"):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=n?Math.round(e/n)+"h":t>=i?Math.round(e/i)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}})),i.register("isP3b",(function(e,t){e.exports=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}})),i.register("gt2If",(function(e,t){
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let i;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r):e=>(i||(i=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))})),i.register("9OtjI",(function(e,t){function r(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,t,i){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");i||(i={}),"object"==typeof t&&(i=t,t=""),t&&(i.code=t);try{return r(e,i)}catch(t){i.message=e.message,i.stack=e.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(e));return r(new n,i)}}})),i.register("7U5sq",(function(e,t){(function(){var i,n=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",a="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",l=500,u="__lodash_placeholder__",h=1,d=2,f=4,p=1,m=2,g=1,v=2,y=4,b=8,w=16,_=32,S=64,E=128,M=256,C=512,I=30,T="...",k=800,R=16,x=1,O=2,A=1/0,P=9007199254740991,D=17976931348623157e292,L=NaN,U=4294967295,N=U-1,j=U>>>1,B=[["ary",E],["bind",g],["bindKey",v],["curry",b],["curryRight",w],["flip",C],["partial",_],["partialRight",S],["rearg",M]],F="[object Arguments]",K="[object Array]",q="[object AsyncFunction]",$="[object Boolean]",W="[object Date]",V="[object DOMException]",H="[object Error]",G="[object Function]",z="[object GeneratorFunction]",Y="[object Map]",J="[object Number]",Z="[object Null]",Q="[object Object]",X="[object Promise]",ee="[object Proxy]",te="[object RegExp]",re="[object Set]",ie="[object String]",ne="[object Symbol]",oe="[object Undefined]",se="[object WeakMap]",ae="[object WeakSet]",ce="[object ArrayBuffer]",le="[object DataView]",ue="[object Float32Array]",he="[object Float64Array]",de="[object Int8Array]",fe="[object Int16Array]",pe="[object Int32Array]",me="[object Uint8Array]",ge="[object Uint8ClampedArray]",ve="[object Uint16Array]",ye="[object Uint32Array]",be=/\b__p \+= '';/g,we=/\b(__p \+=) '' \+/g,_e=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Se=/&(?:amp|lt|gt|quot|#39);/g,Ee=/[&<>"']/g,Me=RegExp(Se.source),Ce=RegExp(Ee.source),Ie=/<%-([\s\S]+?)%>/g,Te=/<%([\s\S]+?)%>/g,ke=/<%=([\s\S]+?)%>/g,Re=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xe=/^\w*$/,Oe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ae=/[\\^$.*+?()[\]{}|]/g,Pe=RegExp(Ae.source),De=/^\s+/,Le=/\s/,Ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ne=/\{\n\/\* \[wrapped with (.+)\] \*/,je=/,? & /,Be=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Fe=/[()=,{}\[\]\/\s]/,Ke=/\\(\\)?/g,qe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,$e=/\w*$/,We=/^[-+]0x[0-9a-f]+$/i,Ve=/^0b[01]+$/i,He=/^\[object .+?Constructor\]$/,Ge=/^0o[0-7]+$/i,ze=/^(?:0|[1-9]\d*)$/,Ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Je=/($^)/,Ze=/['\n\r\u2028\u2029\\]/g,Qe="\ud800-\udfff",Xe="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",et="\\u2700-\\u27bf",tt="a-z\\xdf-\\xf6\\xf8-\\xff",rt="A-Z\\xc0-\\xd6\\xd8-\\xde",it="\\ufe0e\\ufe0f",nt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ot="['’]",st="[\ud800-\udfff]",at="["+nt+"]",ct="["+Xe+"]",lt="\\d+",ut="["+et+"]",ht="["+tt+"]",dt="[^"+Qe+nt+lt+et+tt+rt+"]",ft="\ud83c[\udffb-\udfff]",pt="[^\ud800-\udfff]",mt="(?:\ud83c[\udde6-\uddff]){2}",gt="[\ud800-\udbff][\udc00-\udfff]",vt="["+rt+"]",yt="\\u200d",bt="(?:"+ht+"|"+dt+")",wt="(?:"+vt+"|"+dt+")",_t="(?:['’](?:d|ll|m|re|s|t|ve))?",St="(?:['’](?:D|LL|M|RE|S|T|VE))?",Et="(?:"+ct+"|"+ft+")"+"?",Mt="["+it+"]?",Ct=Mt+Et+("(?:"+yt+"(?:"+[pt,mt,gt].join("|")+")"+Mt+Et+")*"),It="(?:"+[ut,mt,gt].join("|")+")"+Ct,Tt="(?:"+[pt+ct+"?",ct,mt,gt,st].join("|")+")",kt=RegExp(ot,"g"),Rt=RegExp(ct,"g"),xt=RegExp(ft+"(?="+ft+")|"+Tt+Ct,"g"),Ot=RegExp([vt+"?"+ht+"+"+_t+"(?="+[at,vt,"$"].join("|")+")",wt+"+"+St+"(?="+[at,vt+bt,"$"].join("|")+")",vt+"?"+bt+"+"+_t,vt+"+"+St,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",lt,It].join("|"),"g"),At=RegExp("["+yt+Qe+Xe+it+"]"),Pt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Lt=-1,Ut={};Ut[ue]=Ut[he]=Ut[de]=Ut[fe]=Ut[pe]=Ut[me]=Ut[ge]=Ut[ve]=Ut[ye]=!0,Ut[F]=Ut[K]=Ut[ce]=Ut[$]=Ut[le]=Ut[W]=Ut[H]=Ut[G]=Ut[Y]=Ut[J]=Ut[Q]=Ut[te]=Ut[re]=Ut[ie]=Ut[se]=!1;var Nt={};Nt[F]=Nt[K]=Nt[ce]=Nt[le]=Nt[$]=Nt[W]=Nt[ue]=Nt[he]=Nt[de]=Nt[fe]=Nt[pe]=Nt[Y]=Nt[J]=Nt[Q]=Nt[te]=Nt[re]=Nt[ie]=Nt[ne]=Nt[me]=Nt[ge]=Nt[ve]=Nt[ye]=!0,Nt[H]=Nt[G]=Nt[se]=!1;var jt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Bt=parseFloat,Ft=parseInt,Kt="object"==typeof r&&r&&r.Object===Object&&r,qt="object"==typeof self&&self&&self.Object===Object&&self,$t=Kt||qt||Function("return this")(),Wt=t&&!t.nodeType&&t,Vt=Wt&&e&&!e.nodeType&&e,Ht=Vt&&Vt.exports===Wt,Gt=Ht&&Kt.process,zt=function(){try{var e=Vt&&Vt.require&&Vt.require("util").types;return e||Gt&&Gt.binding&&Gt.binding("util")}catch(e){}}(),Yt=zt&&zt.isArrayBuffer,Jt=zt&&zt.isDate,Zt=zt&&zt.isMap,Qt=zt&&zt.isRegExp,Xt=zt&&zt.isSet,er=zt&&zt.isTypedArray;function tr(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function rr(e,t,r,i){for(var n=-1,o=null==e?0:e.length;++n<o;){var s=e[n];t(i,s,r(s),e)}return i}function ir(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e}function nr(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function or(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(!t(e[r],r,e))return!1;return!0}function sr(e,t){for(var r=-1,i=null==e?0:e.length,n=0,o=[];++r<i;){var s=e[r];t(s,r,e)&&(o[n++]=s)}return o}function ar(e,t){return!!(null==e?0:e.length)&&vr(e,t,0)>-1}function cr(e,t,r){for(var i=-1,n=null==e?0:e.length;++i<n;)if(r(t,e[i]))return!0;return!1}function lr(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}function ur(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}function hr(e,t,r,i){var n=-1,o=null==e?0:e.length;for(i&&o&&(r=e[++n]);++n<o;)r=t(r,e[n],n,e);return r}function dr(e,t,r,i){var n=null==e?0:e.length;for(i&&n&&(r=e[--n]);n--;)r=t(r,e[n],n,e);return r}function fr(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}var pr=_r("length");function mr(e,t,r){var i;return r(e,(function(e,r,n){if(t(e,r,n))return i=r,!1})),i}function gr(e,t,r,i){for(var n=e.length,o=r+(i?1:-1);i?o--:++o<n;)if(t(e[o],o,e))return o;return-1}function vr(e,t,r){return t==t?function(e,t,r){var i=r-1,n=e.length;for(;++i<n;)if(e[i]===t)return i;return-1}(e,t,r):gr(e,br,r)}function yr(e,t,r,i){for(var n=r-1,o=e.length;++n<o;)if(i(e[n],t))return n;return-1}function br(e){return e!=e}function wr(e,t){var r=null==e?0:e.length;return r?Mr(e,t)/r:L}function _r(e){return function(t){return null==t?i:t[e]}}function Sr(e){return function(t){return null==e?i:e[t]}}function Er(e,t,r,i,n){return n(e,(function(e,n,o){r=i?(i=!1,e):t(r,e,n,o)})),r}function Mr(e,t){for(var r,n=-1,o=e.length;++n<o;){var s=t(e[n]);s!==i&&(r=r===i?s:r+s)}return r}function Cr(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}function Ir(e){return e?e.slice(0,qr(e)+1).replace(De,""):e}function Tr(e){return function(t){return e(t)}}function kr(e,t){return lr(t,(function(t){return e[t]}))}function Rr(e,t){return e.has(t)}function xr(e,t){for(var r=-1,i=e.length;++r<i&&vr(t,e[r],0)>-1;);return r}function Or(e,t){for(var r=e.length;r--&&vr(t,e[r],0)>-1;);return r}var Ar=Sr({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Pr=Sr({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Dr(e){return"\\"+jt[e]}function Lr(e){return At.test(e)}function Ur(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function Nr(e,t){return function(r){return e(t(r))}}function jr(e,t){for(var r=-1,i=e.length,n=0,o=[];++r<i;){var s=e[r];s!==t&&s!==u||(e[r]=u,o[n++]=r)}return o}function Br(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function Fr(e){return Lr(e)?function(e){var t=xt.lastIndex=0;for(;xt.test(e);)++t;return t}(e):pr(e)}function Kr(e){return Lr(e)?function(e){return e.match(xt)||[]}(e):function(e){return e.split("")}(e)}function qr(e){for(var t=e.length;t--&&Le.test(e.charAt(t)););return t}var $r=Sr({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Wr=function e(t){var r,Le=(t=null==t?$t:Wr.defaults($t.Object(),t,Wr.pick($t,Dt))).Array,Qe=t.Date,Xe=t.Error,et=t.Function,tt=t.Math,rt=t.Object,it=t.RegExp,nt=t.String,ot=t.TypeError,st=Le.prototype,at=et.prototype,ct=rt.prototype,lt=t["__core-js_shared__"],ut=at.toString,ht=ct.hasOwnProperty,dt=0,ft=(r=/[^.]+$/.exec(lt&&lt.keys&&lt.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",pt=ct.toString,mt=ut.call(rt),gt=$t._,vt=it("^"+ut.call(ht).replace(Ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=Ht?t.Buffer:i,bt=t.Symbol,wt=t.Uint8Array,_t=yt?yt.allocUnsafe:i,St=Nr(rt.getPrototypeOf,rt),Et=rt.create,Mt=ct.propertyIsEnumerable,Ct=st.splice,It=bt?bt.isConcatSpreadable:i,Tt=bt?bt.iterator:i,xt=bt?bt.toStringTag:i,At=function(){try{var e=Ko(rt,"defineProperty");return e({},"",{}),e}catch(e){}}(),jt=t.clearTimeout!==$t.clearTimeout&&t.clearTimeout,Kt=Qe&&Qe.now!==$t.Date.now&&Qe.now,qt=t.setTimeout!==$t.setTimeout&&t.setTimeout,Wt=tt.ceil,Vt=tt.floor,Gt=rt.getOwnPropertySymbols,zt=yt?yt.isBuffer:i,pr=t.isFinite,Sr=st.join,Vr=Nr(rt.keys,rt),Hr=tt.max,Gr=tt.min,zr=Qe.now,Yr=t.parseInt,Jr=tt.random,Zr=st.reverse,Qr=Ko(t,"DataView"),Xr=Ko(t,"Map"),ei=Ko(t,"Promise"),ti=Ko(t,"Set"),ri=Ko(t,"WeakMap"),ii=Ko(rt,"create"),ni=ri&&new ri,oi={},si=fs(Qr),ai=fs(Xr),ci=fs(ei),li=fs(ti),ui=fs(ri),hi=bt?bt.prototype:i,di=hi?hi.valueOf:i,fi=hi?hi.toString:i;function pi(e){if(xa(e)&&!ba(e)&&!(e instanceof yi)){if(e instanceof vi)return e;if(ht.call(e,"__wrapped__"))return ps(e)}return new vi(e)}var mi=function(){function e(){}return function(t){if(!Ra(t))return{};if(Et)return Et(t);e.prototype=t;var r=new e;return e.prototype=i,r}}();function gi(){}function vi(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function yi(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=U,this.__views__=[]}function bi(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function wi(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function _i(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Si(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new _i;++t<r;)this.add(e[t])}function Ei(e){var t=this.__data__=new wi(e);this.size=t.size}function Mi(e,t){var r=ba(e),i=!r&&ya(e),n=!r&&!i&&Ea(e),o=!r&&!i&&!n&&ja(e),s=r||i||n||o,a=s?Cr(e.length,nt):[],c=a.length;for(var l in e)!t&&!ht.call(e,l)||s&&("length"==l||n&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||zo(l,c))||a.push(l);return a}function Ci(e){var t=e.length;return t?e[En(0,t-1)]:i}function Ii(e,t){return us(no(e),Li(t,0,e.length))}function Ti(e){return us(no(e))}function ki(e,t,r){(r!==i&&!ma(e[t],r)||r===i&&!(t in e))&&Pi(e,t,r)}function Ri(e,t,r){var n=e[t];ht.call(e,t)&&ma(n,r)&&(r!==i||t in e)||Pi(e,t,r)}function xi(e,t){for(var r=e.length;r--;)if(ma(e[r][0],t))return r;return-1}function Oi(e,t,r,i){return Fi(e,(function(e,n,o){t(i,e,r(e),o)})),i}function Ai(e,t){return e&&oo(t,sc(t),e)}function Pi(e,t,r){"__proto__"==t&&At?At(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Di(e,t){for(var r=-1,n=t.length,o=Le(n),s=null==e;++r<n;)o[r]=s?i:tc(e,t[r]);return o}function Li(e,t,r){return e==e&&(r!==i&&(e=e<=r?e:r),t!==i&&(e=e>=t?e:t)),e}function Ui(e,t,r,n,o,s){var a,c=t&h,l=t&d,u=t&f;if(r&&(a=o?r(e,n,o,s):r(e)),a!==i)return a;if(!Ra(e))return e;var p=ba(e);if(p){if(a=function(e){var t=e.length,r=new e.constructor(t);t&&"string"==typeof e[0]&&ht.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!c)return no(e,a)}else{var m=Wo(e),g=m==G||m==z;if(Ea(e))return Qn(e,c);if(m==Q||m==F||g&&!o){if(a=l||g?{}:Ho(e),!c)return l?function(e,t){return oo(e,$o(e),t)}(e,function(e,t){return e&&oo(t,ac(t),e)}(a,e)):function(e,t){return oo(e,qo(e),t)}(e,Ai(a,e))}else{if(!Nt[m])return o?e:{};a=function(e,t,r){var i=e.constructor;switch(t){case ce:return Xn(e);case $:case W:return new i(+e);case le:return function(e,t){var r=t?Xn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case ue:case he:case de:case fe:case pe:case me:case ge:case ve:case ye:return eo(e,r);case Y:return new i;case J:case ie:return new i(e);case te:return function(e){var t=new e.constructor(e.source,$e.exec(e));return t.lastIndex=e.lastIndex,t}(e);case re:return new i;case ne:return n=e,di?rt(di.call(n)):{}}var n}(e,m,c)}}s||(s=new Ei);var v=s.get(e);if(v)return v;s.set(e,a),La(e)?e.forEach((function(i){a.add(Ui(i,t,r,i,e,s))})):Oa(e)&&e.forEach((function(i,n){a.set(n,Ui(i,t,r,n,e,s))}));var y=p?i:(u?l?Do:Po:l?ac:sc)(e);return ir(y||e,(function(i,n){y&&(i=e[n=i]),Ri(a,n,Ui(i,t,r,n,e,s))})),a}function Ni(e,t,r){var n=r.length;if(null==e)return!n;for(e=rt(e);n--;){var o=r[n],s=t[o],a=e[o];if(a===i&&!(o in e)||!s(a))return!1}return!0}function ji(e,t,r){if("function"!=typeof e)throw new ot(s);return ss((function(){e.apply(i,r)}),t)}function Bi(e,t,r,i){var o=-1,s=ar,a=!0,c=e.length,l=[],u=t.length;if(!c)return l;r&&(t=lr(t,Tr(r))),i?(s=cr,a=!1):t.length>=n&&(s=Rr,a=!1,t=new Si(t));e:for(;++o<c;){var h=e[o],d=null==r?h:r(h);if(h=i||0!==h?h:0,a&&d==d){for(var f=u;f--;)if(t[f]===d)continue e;l.push(h)}else s(t,d,i)||l.push(h)}return l}pi.templateSettings={escape:Ie,evaluate:Te,interpolate:ke,variable:"",imports:{_:pi}},pi.prototype=gi.prototype,pi.prototype.constructor=pi,vi.prototype=mi(gi.prototype),vi.prototype.constructor=vi,yi.prototype=mi(gi.prototype),yi.prototype.constructor=yi,bi.prototype.clear=function(){this.__data__=ii?ii(null):{},this.size=0},bi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},bi.prototype.get=function(e){var t=this.__data__;if(ii){var r=t[e];return r===c?i:r}return ht.call(t,e)?t[e]:i},bi.prototype.has=function(e){var t=this.__data__;return ii?t[e]!==i:ht.call(t,e)},bi.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ii&&t===i?c:t,this},wi.prototype.clear=function(){this.__data__=[],this.size=0},wi.prototype.delete=function(e){var t=this.__data__,r=xi(t,e);return!(r<0)&&(r==t.length-1?t.pop():Ct.call(t,r,1),--this.size,!0)},wi.prototype.get=function(e){var t=this.__data__,r=xi(t,e);return r<0?i:t[r][1]},wi.prototype.has=function(e){return xi(this.__data__,e)>-1},wi.prototype.set=function(e,t){var r=this.__data__,i=xi(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},_i.prototype.clear=function(){this.size=0,this.__data__={hash:new bi,map:new(Xr||wi),string:new bi}},_i.prototype.delete=function(e){var t=Bo(this,e).delete(e);return this.size-=t?1:0,t},_i.prototype.get=function(e){return Bo(this,e).get(e)},_i.prototype.has=function(e){return Bo(this,e).has(e)},_i.prototype.set=function(e,t){var r=Bo(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},Si.prototype.add=Si.prototype.push=function(e){return this.__data__.set(e,c),this},Si.prototype.has=function(e){return this.__data__.has(e)},Ei.prototype.clear=function(){this.__data__=new wi,this.size=0},Ei.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Ei.prototype.get=function(e){return this.__data__.get(e)},Ei.prototype.has=function(e){return this.__data__.has(e)},Ei.prototype.set=function(e,t){var r=this.__data__;if(r instanceof wi){var i=r.__data__;if(!Xr||i.length<n-1)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new _i(i)}return r.set(e,t),this.size=r.size,this};var Fi=co(zi),Ki=co(Yi,!0);function qi(e,t){var r=!0;return Fi(e,(function(e,i,n){return r=!!t(e,i,n)})),r}function $i(e,t,r){for(var n=-1,o=e.length;++n<o;){var s=e[n],a=t(s);if(null!=a&&(c===i?a==a&&!Na(a):r(a,c)))var c=a,l=s}return l}function Wi(e,t){var r=[];return Fi(e,(function(e,i,n){t(e,i,n)&&r.push(e)})),r}function Vi(e,t,r,i,n){var o=-1,s=e.length;for(r||(r=Go),n||(n=[]);++o<s;){var a=e[o];t>0&&r(a)?t>1?Vi(a,t-1,r,i,n):ur(n,a):i||(n[n.length]=a)}return n}var Hi=lo(),Gi=lo(!0);function zi(e,t){return e&&Hi(e,t,sc)}function Yi(e,t){return e&&Gi(e,t,sc)}function Ji(e,t){return sr(t,(function(t){return Ia(e[t])}))}function Zi(e,t){for(var r=0,n=(t=zn(t,e)).length;null!=e&&r<n;)e=e[ds(t[r++])];return r&&r==n?e:i}function Qi(e,t,r){var i=t(e);return ba(e)?i:ur(i,r(e))}function Xi(e){return null==e?e===i?oe:Z:xt&&xt in rt(e)?function(e){var t=ht.call(e,xt),r=e[xt];try{e[xt]=i;var n=!0}catch(e){}var o=pt.call(e);n&&(t?e[xt]=r:delete e[xt]);return o}(e):function(e){return pt.call(e)}(e)}function en(e,t){return e>t}function tn(e,t){return null!=e&&ht.call(e,t)}function rn(e,t){return null!=e&&t in rt(e)}function nn(e,t,r){for(var n=r?cr:ar,o=e[0].length,s=e.length,a=s,c=Le(s),l=1/0,u=[];a--;){var h=e[a];a&&t&&(h=lr(h,Tr(t))),l=Gr(h.length,l),c[a]=!r&&(t||o>=120&&h.length>=120)?new Si(a&&h):i}h=e[0];var d=-1,f=c[0];e:for(;++d<o&&u.length<l;){var p=h[d],m=t?t(p):p;if(p=r||0!==p?p:0,!(f?Rr(f,m):n(u,m,r))){for(a=s;--a;){var g=c[a];if(!(g?Rr(g,m):n(e[a],m,r)))continue e}f&&f.push(m),u.push(p)}}return u}function on(e,t,r){var n=null==(e=is(e,t=zn(t,e)))?e:e[ds(Cs(t))];return null==n?i:tr(n,e,r)}function sn(e){return xa(e)&&Xi(e)==F}function an(e,t,r,n,o){return e===t||(null==e||null==t||!xa(e)&&!xa(t)?e!=e&&t!=t:function(e,t,r,n,o,s){var a=ba(e),c=ba(t),l=a?K:Wo(e),u=c?K:Wo(t),h=(l=l==F?Q:l)==Q,d=(u=u==F?Q:u)==Q,f=l==u;if(f&&Ea(e)){if(!Ea(t))return!1;a=!0,h=!1}if(f&&!h)return s||(s=new Ei),a||ja(e)?Oo(e,t,r,n,o,s):function(e,t,r,i,n,o,s){switch(r){case le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ce:return!(e.byteLength!=t.byteLength||!o(new wt(e),new wt(t)));case $:case W:case J:return ma(+e,+t);case H:return e.name==t.name&&e.message==t.message;case te:case ie:return e==t+"";case Y:var a=Ur;case re:var c=i&p;if(a||(a=Br),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;i|=m,s.set(e,t);var u=Oo(a(e),a(t),i,n,o,s);return s.delete(e),u;case ne:if(di)return di.call(e)==di.call(t)}return!1}(e,t,l,r,n,o,s);if(!(r&p)){var g=h&&ht.call(e,"__wrapped__"),v=d&&ht.call(t,"__wrapped__");if(g||v){var y=g?e.value():e,b=v?t.value():t;return s||(s=new Ei),o(y,b,r,n,s)}}return!!f&&(s||(s=new Ei),function(e,t,r,n,o,s){var a=r&p,c=Po(e),l=c.length,u=Po(t),h=u.length;if(l!=h&&!a)return!1;var d=l;for(;d--;){var f=c[d];if(!(a?f in t:ht.call(t,f)))return!1}var m=s.get(e),g=s.get(t);if(m&&g)return m==t&&g==e;var v=!0;s.set(e,t),s.set(t,e);var y=a;for(;++d<l;){var b=e[f=c[d]],w=t[f];if(n)var _=a?n(w,b,f,t,e,s):n(b,w,f,e,t,s);if(!(_===i?b===w||o(b,w,r,n,s):_)){v=!1;break}y||(y="constructor"==f)}if(v&&!y){var S=e.constructor,E=t.constructor;S==E||!("constructor"in e)||!("constructor"in t)||"function"==typeof S&&S instanceof S&&"function"==typeof E&&E instanceof E||(v=!1)}return s.delete(e),s.delete(t),v}(e,t,r,n,o,s))}(e,t,r,n,an,o))}function cn(e,t,r,n){var o=r.length,s=o,a=!n;if(null==e)return!s;for(e=rt(e);o--;){var c=r[o];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<s;){var l=(c=r[o])[0],u=e[l],h=c[1];if(a&&c[2]){if(u===i&&!(l in e))return!1}else{var d=new Ei;if(n)var f=n(u,h,l,e,t,d);if(!(f===i?an(h,u,p|m,n,d):f))return!1}}return!0}function ln(e){return!(!Ra(e)||(t=e,ft&&ft in t))&&(Ia(e)?vt:He).test(fs(e));var t}function un(e){return"function"==typeof e?e:null==e?Ac:"object"==typeof e?ba(e)?gn(e[0],e[1]):mn(e):Kc(e)}function hn(e){if(!Xo(e))return Vr(e);var t=[];for(var r in rt(e))ht.call(e,r)&&"constructor"!=r&&t.push(r);return t}function dn(e){if(!Ra(e))return function(e){var t=[];if(null!=e)for(var r in rt(e))t.push(r);return t}(e);var t=Xo(e),r=[];for(var i in e)("constructor"!=i||!t&&ht.call(e,i))&&r.push(i);return r}function fn(e,t){return e<t}function pn(e,t){var r=-1,i=_a(e)?Le(e.length):[];return Fi(e,(function(e,n,o){i[++r]=t(e,n,o)})),i}function mn(e){var t=Fo(e);return 1==t.length&&t[0][2]?ts(t[0][0],t[0][1]):function(r){return r===e||cn(r,e,t)}}function gn(e,t){return Jo(e)&&es(t)?ts(ds(e),t):function(r){var n=tc(r,e);return n===i&&n===t?rc(r,e):an(t,n,p|m)}}function vn(e,t,r,n,o){e!==t&&Hi(t,(function(s,a){if(o||(o=new Ei),Ra(s))!function(e,t,r,n,o,s,a){var c=ns(e,r),l=ns(t,r),u=a.get(l);if(u)return void ki(e,r,u);var h=s?s(c,l,r+"",e,t,a):i,d=h===i;if(d){var f=ba(l),p=!f&&Ea(l),m=!f&&!p&&ja(l);h=l,f||p||m?ba(c)?h=c:Sa(c)?h=no(c):p?(d=!1,h=Qn(l,!0)):m?(d=!1,h=eo(l,!0)):h=[]:Pa(l)||ya(l)?(h=c,ya(c)?h=Ha(c):Ra(c)&&!Ia(c)||(h=Ho(l))):d=!1}d&&(a.set(l,h),o(h,l,n,s,a),a.delete(l));ki(e,r,h)}(e,t,a,r,vn,n,o);else{var c=n?n(ns(e,a),s,a+"",e,t,o):i;c===i&&(c=s),ki(e,a,c)}}),ac)}function yn(e,t){var r=e.length;if(r)return zo(t+=t<0?r:0,r)?e[t]:i}function bn(e,t,r){t=t.length?lr(t,(function(e){return ba(e)?function(t){return Zi(t,1===e.length?e[0]:e)}:e})):[Ac];var i=-1;t=lr(t,Tr(jo()));var n=pn(e,(function(e,r,n){var o=lr(t,(function(t){return t(e)}));return{criteria:o,index:++i,value:e}}));return function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(n,(function(e,t){return function(e,t,r){var i=-1,n=e.criteria,o=t.criteria,s=n.length,a=r.length;for(;++i<s;){var c=to(n[i],o[i]);if(c)return i>=a?c:c*("desc"==r[i]?-1:1)}return e.index-t.index}(e,t,r)}))}function wn(e,t,r){for(var i=-1,n=t.length,o={};++i<n;){var s=t[i],a=Zi(e,s);r(a,s)&&kn(o,zn(s,e),a)}return o}function _n(e,t,r,i){var n=i?yr:vr,o=-1,s=t.length,a=e;for(e===t&&(t=no(t)),r&&(a=lr(e,Tr(r)));++o<s;)for(var c=0,l=t[o],u=r?r(l):l;(c=n(a,u,c,i))>-1;)a!==e&&Ct.call(a,c,1),Ct.call(e,c,1);return e}function Sn(e,t){for(var r=e?t.length:0,i=r-1;r--;){var n=t[r];if(r==i||n!==o){var o=n;zo(n)?Ct.call(e,n,1):Fn(e,n)}}return e}function En(e,t){return e+Vt(Jr()*(t-e+1))}function Mn(e,t){var r="";if(!e||t<1||t>P)return r;do{t%2&&(r+=e),(t=Vt(t/2))&&(e+=e)}while(t);return r}function Cn(e,t){return as(rs(e,t,Ac),e+"")}function In(e){return Ci(mc(e))}function Tn(e,t){var r=mc(e);return us(r,Li(t,0,r.length))}function kn(e,t,r,n){if(!Ra(e))return e;for(var o=-1,s=(t=zn(t,e)).length,a=s-1,c=e;null!=c&&++o<s;){var l=ds(t[o]),u=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(o!=a){var h=c[l];(u=n?n(h,l,c):i)===i&&(u=Ra(h)?h:zo(t[o+1])?[]:{})}Ri(c,l,u),c=c[l]}return e}var Rn=ni?function(e,t){return ni.set(e,t),e}:Ac,xn=At?function(e,t){return At(e,"toString",{configurable:!0,enumerable:!1,value:Rc(t),writable:!0})}:Ac;function On(e){return us(mc(e))}function An(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var o=Le(n);++i<n;)o[i]=e[i+t];return o}function Pn(e,t){var r;return Fi(e,(function(e,i,n){return!(r=t(e,i,n))})),!!r}function Dn(e,t,r){var i=0,n=null==e?i:e.length;if("number"==typeof t&&t==t&&n<=j){for(;i<n;){var o=i+n>>>1,s=e[o];null!==s&&!Na(s)&&(r?s<=t:s<t)?i=o+1:n=o}return n}return Ln(e,t,Ac,r)}function Ln(e,t,r,n){var o=0,s=null==e?0:e.length;if(0===s)return 0;for(var a=(t=r(t))!=t,c=null===t,l=Na(t),u=t===i;o<s;){var h=Vt((o+s)/2),d=r(e[h]),f=d!==i,p=null===d,m=d==d,g=Na(d);if(a)var v=n||m;else v=u?m&&(n||f):c?m&&f&&(n||!p):l?m&&f&&!p&&(n||!g):!p&&!g&&(n?d<=t:d<t);v?o=h+1:s=h}return Gr(s,N)}function Un(e,t){for(var r=-1,i=e.length,n=0,o=[];++r<i;){var s=e[r],a=t?t(s):s;if(!r||!ma(a,c)){var c=a;o[n++]=0===s?0:s}}return o}function Nn(e){return"number"==typeof e?e:Na(e)?L:+e}function jn(e){if("string"==typeof e)return e;if(ba(e))return lr(e,jn)+"";if(Na(e))return fi?fi.call(e):"";var t=e+"";return"0"==t&&1/e==-A?"-0":t}function Bn(e,t,r){var i=-1,o=ar,s=e.length,a=!0,c=[],l=c;if(r)a=!1,o=cr;else if(s>=n){var u=t?null:Co(e);if(u)return Br(u);a=!1,o=Rr,l=new Si}else l=t?[]:c;e:for(;++i<s;){var h=e[i],d=t?t(h):h;if(h=r||0!==h?h:0,a&&d==d){for(var f=l.length;f--;)if(l[f]===d)continue e;t&&l.push(d),c.push(h)}else o(l,d,r)||(l!==c&&l.push(d),c.push(h))}return c}function Fn(e,t){return null==(e=is(e,t=zn(t,e)))||delete e[ds(Cs(t))]}function Kn(e,t,r,i){return kn(e,t,r(Zi(e,t)),i)}function qn(e,t,r,i){for(var n=e.length,o=i?n:-1;(i?o--:++o<n)&&t(e[o],o,e););return r?An(e,i?0:o,i?o+1:n):An(e,i?o+1:0,i?n:o)}function $n(e,t){var r=e;return r instanceof yi&&(r=r.value()),hr(t,(function(e,t){return t.func.apply(t.thisArg,ur([e],t.args))}),r)}function Wn(e,t,r){var i=e.length;if(i<2)return i?Bn(e[0]):[];for(var n=-1,o=Le(i);++n<i;)for(var s=e[n],a=-1;++a<i;)a!=n&&(o[n]=Bi(o[n]||s,e[a],t,r));return Bn(Vi(o,1),t,r)}function Vn(e,t,r){for(var n=-1,o=e.length,s=t.length,a={};++n<o;){var c=n<s?t[n]:i;r(a,e[n],c)}return a}function Hn(e){return Sa(e)?e:[]}function Gn(e){return"function"==typeof e?e:Ac}function zn(e,t){return ba(e)?e:Jo(e,t)?[e]:hs(Ga(e))}var Yn=Cn;function Jn(e,t,r){var n=e.length;return r=r===i?n:r,!t&&r>=n?e:An(e,t,r)}var Zn=jt||function(e){return $t.clearTimeout(e)};function Qn(e,t){if(t)return e.slice();var r=e.length,i=_t?_t(r):new e.constructor(r);return e.copy(i),i}function Xn(e){var t=new e.constructor(e.byteLength);return new wt(t).set(new wt(e)),t}function eo(e,t){var r=t?Xn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function to(e,t){if(e!==t){var r=e!==i,n=null===e,o=e==e,s=Na(e),a=t!==i,c=null===t,l=t==t,u=Na(t);if(!c&&!u&&!s&&e>t||s&&a&&l&&!c&&!u||n&&a&&l||!r&&l||!o)return 1;if(!n&&!s&&!u&&e<t||u&&r&&o&&!n&&!s||c&&r&&o||!a&&o||!l)return-1}return 0}function ro(e,t,r,i){for(var n=-1,o=e.length,s=r.length,a=-1,c=t.length,l=Hr(o-s,0),u=Le(c+l),h=!i;++a<c;)u[a]=t[a];for(;++n<s;)(h||n<o)&&(u[r[n]]=e[n]);for(;l--;)u[a++]=e[n++];return u}function io(e,t,r,i){for(var n=-1,o=e.length,s=-1,a=r.length,c=-1,l=t.length,u=Hr(o-a,0),h=Le(u+l),d=!i;++n<u;)h[n]=e[n];for(var f=n;++c<l;)h[f+c]=t[c];for(;++s<a;)(d||n<o)&&(h[f+r[s]]=e[n++]);return h}function no(e,t){var r=-1,i=e.length;for(t||(t=Le(i));++r<i;)t[r]=e[r];return t}function oo(e,t,r,n){var o=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var c=t[s],l=n?n(r[c],e[c],c,r,e):i;l===i&&(l=e[c]),o?Pi(r,c,l):Ri(r,c,l)}return r}function so(e,t){return function(r,i){var n=ba(r)?rr:Oi,o=t?t():{};return n(r,e,jo(i,2),o)}}function ao(e){return Cn((function(t,r){var n=-1,o=r.length,s=o>1?r[o-1]:i,a=o>2?r[2]:i;for(s=e.length>3&&"function"==typeof s?(o--,s):i,a&&Yo(r[0],r[1],a)&&(s=o<3?i:s,o=1),t=rt(t);++n<o;){var c=r[n];c&&e(t,c,n,s)}return t}))}function co(e,t){return function(r,i){if(null==r)return r;if(!_a(r))return e(r,i);for(var n=r.length,o=t?n:-1,s=rt(r);(t?o--:++o<n)&&!1!==i(s[o],o,s););return r}}function lo(e){return function(t,r,i){for(var n=-1,o=rt(t),s=i(t),a=s.length;a--;){var c=s[e?a:++n];if(!1===r(o[c],c,o))break}return t}}function uo(e){return function(t){var r=Lr(t=Ga(t))?Kr(t):i,n=r?r[0]:t.charAt(0),o=r?Jn(r,1).join(""):t.slice(1);return n[e]()+o}}function ho(e){return function(t){return hr(Ic(yc(t).replace(kt,"")),e,"")}}function fo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=mi(e.prototype),i=e.apply(r,t);return Ra(i)?i:r}}function po(e){return function(t,r,n){var o=rt(t);if(!_a(t)){var s=jo(r,3);t=sc(t),r=function(e){return s(o[e],e,o)}}var a=e(t,r,n);return a>-1?o[s?t[a]:a]:i}}function mo(e){return Ao((function(t){var r=t.length,n=r,o=vi.prototype.thru;for(e&&t.reverse();n--;){var a=t[n];if("function"!=typeof a)throw new ot(s);if(o&&!c&&"wrapper"==Uo(a))var c=new vi([],!0)}for(n=c?n:r;++n<r;){var l=Uo(a=t[n]),u="wrapper"==l?Lo(a):i;c=u&&Zo(u[0])&&u[1]==(E|b|_|M)&&!u[4].length&&1==u[9]?c[Uo(u[0])].apply(c,u[3]):1==a.length&&Zo(a)?c[l]():c.thru(a)}return function(){var e=arguments,i=e[0];if(c&&1==e.length&&ba(i))return c.plant(i).value();for(var n=0,o=r?t[n].apply(this,e):i;++n<r;)o=t[n].call(this,o);return o}}))}function go(e,t,r,n,o,s,a,c,l,u){var h=t&E,d=t&g,f=t&v,p=t&(b|w),m=t&C,y=f?i:fo(e);return function g(){for(var v=arguments.length,b=Le(v),w=v;w--;)b[w]=arguments[w];if(p)var _=No(g),S=function(e,t){for(var r=e.length,i=0;r--;)e[r]===t&&++i;return i}(b,_);if(n&&(b=ro(b,n,o,p)),s&&(b=io(b,s,a,p)),v-=S,p&&v<u){var E=jr(b,_);return Eo(e,t,go,g.placeholder,r,b,E,c,l,u-v)}var M=d?r:this,C=f?M[e]:e;return v=b.length,c?b=function(e,t){var r=e.length,n=Gr(t.length,r),o=no(e);for(;n--;){var s=t[n];e[n]=zo(s,r)?o[s]:i}return e}(b,c):m&&v>1&&b.reverse(),h&&l<v&&(b.length=l),this&&this!==$t&&this instanceof g&&(C=y||fo(C)),C.apply(M,b)}}function vo(e,t){return function(r,i){return function(e,t,r,i){return zi(e,(function(e,n,o){t(i,r(e),n,o)})),i}(r,e,t(i),{})}}function yo(e,t){return function(r,n){var o;if(r===i&&n===i)return t;if(r!==i&&(o=r),n!==i){if(o===i)return n;"string"==typeof r||"string"==typeof n?(r=jn(r),n=jn(n)):(r=Nn(r),n=Nn(n)),o=e(r,n)}return o}}function bo(e){return Ao((function(t){return t=lr(t,Tr(jo())),Cn((function(r){var i=this;return e(t,(function(e){return tr(e,i,r)}))}))}))}function wo(e,t){var r=(t=t===i?" ":jn(t)).length;if(r<2)return r?Mn(t,e):t;var n=Mn(t,Wt(e/Fr(t)));return Lr(t)?Jn(Kr(n),0,e).join(""):n.slice(0,e)}function _o(e){return function(t,r,n){return n&&"number"!=typeof n&&Yo(t,r,n)&&(r=n=i),t=qa(t),r===i?(r=t,t=0):r=qa(r),function(e,t,r,i){for(var n=-1,o=Hr(Wt((t-e)/(r||1)),0),s=Le(o);o--;)s[i?o:++n]=e,e+=r;return s}(t,r,n=n===i?t<r?1:-1:qa(n),e)}}function So(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=Va(t),r=Va(r)),e(t,r)}}function Eo(e,t,r,n,o,s,a,c,l,u){var h=t&b;t|=h?_:S,(t&=~(h?S:_))&y||(t&=~(g|v));var d=[e,t,o,h?s:i,h?a:i,h?i:s,h?i:a,c,l,u],f=r.apply(i,d);return Zo(e)&&os(f,d),f.placeholder=n,cs(f,e,t)}function Mo(e){var t=tt[e];return function(e,r){if(e=Va(e),(r=null==r?0:Gr($a(r),292))&&pr(e)){var i=(Ga(e)+"e").split("e");return+((i=(Ga(t(i[0]+"e"+(+i[1]+r)))+"e").split("e"))[0]+"e"+(+i[1]-r))}return t(e)}}var Co=ti&&1/Br(new ti([,-0]))[1]==A?function(e){return new ti(e)}:Nc;function Io(e){return function(t){var r=Wo(t);return r==Y?Ur(t):r==re?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return lr(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function To(e,t,r,n,o,a,c,l){var h=t&v;if(!h&&"function"!=typeof e)throw new ot(s);var d=n?n.length:0;if(d||(t&=~(_|S),n=o=i),c=c===i?c:Hr($a(c),0),l=l===i?l:$a(l),d-=o?o.length:0,t&S){var f=n,p=o;n=o=i}var m=h?i:Lo(e),C=[e,t,r,n,o,f,p,a,c,l];if(m&&function(e,t){var r=e[1],i=t[1],n=r|i,o=n<(g|v|E),s=i==E&&r==b||i==E&&r==M&&e[7].length<=t[8]||i==(E|M)&&t[7].length<=t[8]&&r==b;if(!o&&!s)return e;i&g&&(e[2]=t[2],n|=r&g?0:y);var a=t[3];if(a){var c=e[3];e[3]=c?ro(c,a,t[4]):a,e[4]=c?jr(e[3],u):t[4]}(a=t[5])&&(c=e[5],e[5]=c?io(c,a,t[6]):a,e[6]=c?jr(e[5],u):t[6]);(a=t[7])&&(e[7]=a);i&E&&(e[8]=null==e[8]?t[8]:Gr(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=n}(C,m),e=C[0],t=C[1],r=C[2],n=C[3],o=C[4],!(l=C[9]=C[9]===i?h?0:e.length:Hr(C[9]-d,0))&&t&(b|w)&&(t&=~(b|w)),t&&t!=g)I=t==b||t==w?function(e,t,r){var n=fo(e);return function o(){for(var s=arguments.length,a=Le(s),c=s,l=No(o);c--;)a[c]=arguments[c];var u=s<3&&a[0]!==l&&a[s-1]!==l?[]:jr(a,l);return(s-=u.length)<r?Eo(e,t,go,o.placeholder,i,a,u,i,i,r-s):tr(this&&this!==$t&&this instanceof o?n:e,this,a)}}(e,t,l):t!=_&&t!=(g|_)||o.length?go.apply(i,C):function(e,t,r,i){var n=t&g,o=fo(e);return function t(){for(var s=-1,a=arguments.length,c=-1,l=i.length,u=Le(l+a),h=this&&this!==$t&&this instanceof t?o:e;++c<l;)u[c]=i[c];for(;a--;)u[c++]=arguments[++s];return tr(h,n?r:this,u)}}(e,t,r,n);else var I=function(e,t,r){var i=t&g,n=fo(e);return function t(){return(this&&this!==$t&&this instanceof t?n:e).apply(i?r:this,arguments)}}(e,t,r);return cs((m?Rn:os)(I,C),e,t)}function ko(e,t,r,n){return e===i||ma(e,ct[r])&&!ht.call(n,r)?t:e}function Ro(e,t,r,n,o,s){return Ra(e)&&Ra(t)&&(s.set(t,e),vn(e,t,i,Ro,s),s.delete(t)),e}function xo(e){return Pa(e)?i:e}function Oo(e,t,r,n,o,s){var a=r&p,c=e.length,l=t.length;if(c!=l&&!(a&&l>c))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var d=-1,f=!0,g=r&m?new Si:i;for(s.set(e,t),s.set(t,e);++d<c;){var v=e[d],y=t[d];if(n)var b=a?n(y,v,d,t,e,s):n(v,y,d,e,t,s);if(b!==i){if(b)continue;f=!1;break}if(g){if(!fr(t,(function(e,t){if(!Rr(g,t)&&(v===e||o(v,e,r,n,s)))return g.push(t)}))){f=!1;break}}else if(v!==y&&!o(v,y,r,n,s)){f=!1;break}}return s.delete(e),s.delete(t),f}function Ao(e){return as(rs(e,i,ws),e+"")}function Po(e){return Qi(e,sc,qo)}function Do(e){return Qi(e,ac,$o)}var Lo=ni?function(e){return ni.get(e)}:Nc;function Uo(e){for(var t=e.name+"",r=oi[t],i=ht.call(oi,t)?r.length:0;i--;){var n=r[i],o=n.func;if(null==o||o==e)return n.name}return t}function No(e){return(ht.call(pi,"placeholder")?pi:e).placeholder}function jo(){var e=pi.iteratee||Pc;return e=e===Pc?un:e,arguments.length?e(arguments[0],arguments[1]):e}function Bo(e,t){var r,i,n=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function Fo(e){for(var t=sc(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,es(n)]}return t}function Ko(e,t){var r=function(e,t){return null==e?i:e[t]}(e,t);return ln(r)?r:i}var qo=Gt?function(e){return null==e?[]:(e=rt(e),sr(Gt(e),(function(t){return Mt.call(e,t)})))}:Wc,$o=Gt?function(e){for(var t=[];e;)ur(t,qo(e)),e=St(e);return t}:Wc,Wo=Xi;function Vo(e,t,r){for(var i=-1,n=(t=zn(t,e)).length,o=!1;++i<n;){var s=ds(t[i]);if(!(o=null!=e&&r(e,s)))break;e=e[s]}return o||++i!=n?o:!!(n=null==e?0:e.length)&&ka(n)&&zo(s,n)&&(ba(e)||ya(e))}function Ho(e){return"function"!=typeof e.constructor||Xo(e)?{}:mi(St(e))}function Go(e){return ba(e)||ya(e)||!!(It&&e&&e[It])}function zo(e,t){var r=typeof e;return!!(t=null==t?P:t)&&("number"==r||"symbol"!=r&&ze.test(e))&&e>-1&&e%1==0&&e<t}function Yo(e,t,r){if(!Ra(r))return!1;var i=typeof t;return!!("number"==i?_a(r)&&zo(t,r.length):"string"==i&&t in r)&&ma(r[t],e)}function Jo(e,t){if(ba(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Na(e))||(xe.test(e)||!Re.test(e)||null!=t&&e in rt(t))}function Zo(e){var t=Uo(e),r=pi[t];if("function"!=typeof r||!(t in yi.prototype))return!1;if(e===r)return!0;var i=Lo(r);return!!i&&e===i[0]}(Qr&&Wo(new Qr(new ArrayBuffer(1)))!=le||Xr&&Wo(new Xr)!=Y||ei&&Wo(ei.resolve())!=X||ti&&Wo(new ti)!=re||ri&&Wo(new ri)!=se)&&(Wo=function(e){var t=Xi(e),r=t==Q?e.constructor:i,n=r?fs(r):"";if(n)switch(n){case si:return le;case ai:return Y;case ci:return X;case li:return re;case ui:return se}return t});var Qo=lt?Ia:Vc;function Xo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ct)}function es(e){return e==e&&!Ra(e)}function ts(e,t){return function(r){return null!=r&&(r[e]===t&&(t!==i||e in rt(r)))}}function rs(e,t,r){return t=Hr(t===i?e.length-1:t,0),function(){for(var i=arguments,n=-1,o=Hr(i.length-t,0),s=Le(o);++n<o;)s[n]=i[t+n];n=-1;for(var a=Le(t+1);++n<t;)a[n]=i[n];return a[t]=r(s),tr(e,this,a)}}function is(e,t){return t.length<2?e:Zi(e,An(t,0,-1))}function ns(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var os=ls(Rn),ss=qt||function(e,t){return $t.setTimeout(e,t)},as=ls(xn);function cs(e,t,r){var i=t+"";return as(e,function(e,t){var r=t.length;if(!r)return e;var i=r-1;return t[i]=(r>1?"& ":"")+t[i],t=t.join(r>2?", ":" "),e.replace(Ue,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return ir(B,(function(r){var i="_."+r[0];t&r[1]&&!ar(e,i)&&e.push(i)})),e.sort()}(function(e){var t=e.match(Ne);return t?t[1].split(je):[]}(i),r)))}function ls(e){var t=0,r=0;return function(){var n=zr(),o=R-(n-r);if(r=n,o>0){if(++t>=k)return arguments[0]}else t=0;return e.apply(i,arguments)}}function us(e,t){var r=-1,n=e.length,o=n-1;for(t=t===i?n:t;++r<t;){var s=En(r,o),a=e[s];e[s]=e[r],e[r]=a}return e.length=t,e}var hs=function(e){var t=la(e,(function(e){return r.size===l&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Oe,(function(e,r,i,n){t.push(i?n.replace(Ke,"$1"):r||e)})),t}));function ds(e){if("string"==typeof e||Na(e))return e;var t=e+"";return"0"==t&&1/e==-A?"-0":t}function fs(e){if(null!=e){try{return ut.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ps(e){if(e instanceof yi)return e.clone();var t=new vi(e.__wrapped__,e.__chain__);return t.__actions__=no(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ms=Cn((function(e,t){return Sa(e)?Bi(e,Vi(t,1,Sa,!0)):[]})),gs=Cn((function(e,t){var r=Cs(t);return Sa(r)&&(r=i),Sa(e)?Bi(e,Vi(t,1,Sa,!0),jo(r,2)):[]})),vs=Cn((function(e,t){var r=Cs(t);return Sa(r)&&(r=i),Sa(e)?Bi(e,Vi(t,1,Sa,!0),i,r):[]}));function ys(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:$a(r);return n<0&&(n=Hr(i+n,0)),gr(e,jo(t,3),n)}function bs(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var o=n-1;return r!==i&&(o=$a(r),o=r<0?Hr(n+o,0):Gr(o,n-1)),gr(e,jo(t,3),o,!0)}function ws(e){return(null==e?0:e.length)?Vi(e,1):[]}function _s(e){return e&&e.length?e[0]:i}var Ss=Cn((function(e){var t=lr(e,Hn);return t.length&&t[0]===e[0]?nn(t):[]})),Es=Cn((function(e){var t=Cs(e),r=lr(e,Hn);return t===Cs(r)?t=i:r.pop(),r.length&&r[0]===e[0]?nn(r,jo(t,2)):[]})),Ms=Cn((function(e){var t=Cs(e),r=lr(e,Hn);return(t="function"==typeof t?t:i)&&r.pop(),r.length&&r[0]===e[0]?nn(r,i,t):[]}));function Cs(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Is=Cn(Ts);function Ts(e,t){return e&&e.length&&t&&t.length?_n(e,t):e}var ks=Ao((function(e,t){var r=null==e?0:e.length,i=Di(e,t);return Sn(e,lr(t,(function(e){return zo(e,r)?+e:e})).sort(to)),i}));function Rs(e){return null==e?e:Zr.call(e)}var xs=Cn((function(e){return Bn(Vi(e,1,Sa,!0))})),Os=Cn((function(e){var t=Cs(e);return Sa(t)&&(t=i),Bn(Vi(e,1,Sa,!0),jo(t,2))})),As=Cn((function(e){var t=Cs(e);return t="function"==typeof t?t:i,Bn(Vi(e,1,Sa,!0),i,t)}));function Ps(e){if(!e||!e.length)return[];var t=0;return e=sr(e,(function(e){if(Sa(e))return t=Hr(e.length,t),!0})),Cr(t,(function(t){return lr(e,_r(t))}))}function Ds(e,t){if(!e||!e.length)return[];var r=Ps(e);return null==t?r:lr(r,(function(e){return tr(t,i,e)}))}var Ls=Cn((function(e,t){return Sa(e)?Bi(e,t):[]})),Us=Cn((function(e){return Wn(sr(e,Sa))})),Ns=Cn((function(e){var t=Cs(e);return Sa(t)&&(t=i),Wn(sr(e,Sa),jo(t,2))})),js=Cn((function(e){var t=Cs(e);return t="function"==typeof t?t:i,Wn(sr(e,Sa),i,t)})),Bs=Cn(Ps);var Fs=Cn((function(e){var t=e.length,r=t>1?e[t-1]:i;return r="function"==typeof r?(e.pop(),r):i,Ds(e,r)}));function Ks(e){var t=pi(e);return t.__chain__=!0,t}function qs(e,t){return t(e)}var $s=Ao((function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,o=function(t){return Di(t,e)};return!(t>1||this.__actions__.length)&&n instanceof yi&&zo(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:qs,args:[o],thisArg:i}),new vi(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(i),e}))):this.thru(o)}));var Ws=so((function(e,t,r){ht.call(e,r)?++e[r]:Pi(e,r,1)}));var Vs=po(ys),Hs=po(bs);function Gs(e,t){return(ba(e)?ir:Fi)(e,jo(t,3))}function zs(e,t){return(ba(e)?nr:Ki)(e,jo(t,3))}var Ys=so((function(e,t,r){ht.call(e,r)?e[r].push(t):Pi(e,r,[t])}));var Js=Cn((function(e,t,r){var i=-1,n="function"==typeof t,o=_a(e)?Le(e.length):[];return Fi(e,(function(e){o[++i]=n?tr(t,e,r):on(e,t,r)})),o})),Zs=so((function(e,t,r){Pi(e,r,t)}));function Qs(e,t){return(ba(e)?lr:pn)(e,jo(t,3))}var Xs=so((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]}));var ea=Cn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&Yo(e,t[0],t[1])?t=[]:r>2&&Yo(t[0],t[1],t[2])&&(t=[t[0]]),bn(e,Vi(t,1),[])})),ta=Kt||function(){return $t.Date.now()};function ra(e,t,r){return t=r?i:t,t=e&&null==t?e.length:t,To(e,E,i,i,i,i,t)}function ia(e,t){var r;if("function"!=typeof t)throw new ot(s);return e=$a(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=i),r}}var na=Cn((function(e,t,r){var i=g;if(r.length){var n=jr(r,No(na));i|=_}return To(e,i,t,r,n)})),oa=Cn((function(e,t,r){var i=g|v;if(r.length){var n=jr(r,No(oa));i|=_}return To(t,i,e,r,n)}));function sa(e,t,r){var n,o,a,c,l,u,h=0,d=!1,f=!1,p=!0;if("function"!=typeof e)throw new ot(s);function m(t){var r=n,s=o;return n=o=i,h=t,c=e.apply(s,r)}function g(e){var r=e-u;return u===i||r>=t||r<0||f&&e-h>=a}function v(){var e=ta();if(g(e))return y(e);l=ss(v,function(e){var r=t-(e-u);return f?Gr(r,a-(e-h)):r}(e))}function y(e){return l=i,p&&n?m(e):(n=o=i,c)}function b(){var e=ta(),r=g(e);if(n=arguments,o=this,u=e,r){if(l===i)return function(e){return h=e,l=ss(v,t),d?m(e):c}(u);if(f)return Zn(l),l=ss(v,t),m(u)}return l===i&&(l=ss(v,t)),c}return t=Va(t)||0,Ra(r)&&(d=!!r.leading,a=(f="maxWait"in r)?Hr(Va(r.maxWait)||0,t):a,p="trailing"in r?!!r.trailing:p),b.cancel=function(){l!==i&&Zn(l),h=0,n=u=o=l=i},b.flush=function(){return l===i?c:y(ta())},b}var aa=Cn((function(e,t){return ji(e,1,t)})),ca=Cn((function(e,t,r){return ji(e,Va(t)||0,r)}));function la(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new ot(s);var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],o=r.cache;if(o.has(n))return o.get(n);var s=e.apply(this,i);return r.cache=o.set(n,s)||o,s};return r.cache=new(la.Cache||_i),r}function ua(e){if("function"!=typeof e)throw new ot(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}la.Cache=_i;var ha=Yn((function(e,t){var r=(t=1==t.length&&ba(t[0])?lr(t[0],Tr(jo())):lr(Vi(t,1),Tr(jo()))).length;return Cn((function(i){for(var n=-1,o=Gr(i.length,r);++n<o;)i[n]=t[n].call(this,i[n]);return tr(e,this,i)}))})),da=Cn((function(e,t){var r=jr(t,No(da));return To(e,_,i,t,r)})),fa=Cn((function(e,t){var r=jr(t,No(fa));return To(e,S,i,t,r)})),pa=Ao((function(e,t){return To(e,M,i,i,i,t)}));function ma(e,t){return e===t||e!=e&&t!=t}var ga=So(en),va=So((function(e,t){return e>=t})),ya=sn(function(){return arguments}())?sn:function(e){return xa(e)&&ht.call(e,"callee")&&!Mt.call(e,"callee")},ba=Le.isArray,wa=Yt?Tr(Yt):function(e){return xa(e)&&Xi(e)==ce};function _a(e){return null!=e&&ka(e.length)&&!Ia(e)}function Sa(e){return xa(e)&&_a(e)}var Ea=zt||Vc,Ma=Jt?Tr(Jt):function(e){return xa(e)&&Xi(e)==W};function Ca(e){if(!xa(e))return!1;var t=Xi(e);return t==H||t==V||"string"==typeof e.message&&"string"==typeof e.name&&!Pa(e)}function Ia(e){if(!Ra(e))return!1;var t=Xi(e);return t==G||t==z||t==q||t==ee}function Ta(e){return"number"==typeof e&&e==$a(e)}function ka(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=P}function Ra(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function xa(e){return null!=e&&"object"==typeof e}var Oa=Zt?Tr(Zt):function(e){return xa(e)&&Wo(e)==Y};function Aa(e){return"number"==typeof e||xa(e)&&Xi(e)==J}function Pa(e){if(!xa(e)||Xi(e)!=Q)return!1;var t=St(e);if(null===t)return!0;var r=ht.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&ut.call(r)==mt}var Da=Qt?Tr(Qt):function(e){return xa(e)&&Xi(e)==te};var La=Xt?Tr(Xt):function(e){return xa(e)&&Wo(e)==re};function Ua(e){return"string"==typeof e||!ba(e)&&xa(e)&&Xi(e)==ie}function Na(e){return"symbol"==typeof e||xa(e)&&Xi(e)==ne}var ja=er?Tr(er):function(e){return xa(e)&&ka(e.length)&&!!Ut[Xi(e)]};var Ba=So(fn),Fa=So((function(e,t){return e<=t}));function Ka(e){if(!e)return[];if(_a(e))return Ua(e)?Kr(e):no(e);if(Tt&&e[Tt])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Tt]());var t=Wo(e);return(t==Y?Ur:t==re?Br:mc)(e)}function qa(e){return e?(e=Va(e))===A||e===-A?(e<0?-1:1)*D:e==e?e:0:0===e?e:0}function $a(e){var t=qa(e),r=t%1;return t==t?r?t-r:t:0}function Wa(e){return e?Li($a(e),0,U):0}function Va(e){if("number"==typeof e)return e;if(Na(e))return L;if(Ra(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ra(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ir(e);var r=Ve.test(e);return r||Ge.test(e)?Ft(e.slice(2),r?2:8):We.test(e)?L:+e}function Ha(e){return oo(e,ac(e))}function Ga(e){return null==e?"":jn(e)}var za=ao((function(e,t){if(Xo(t)||_a(t))oo(t,sc(t),e);else for(var r in t)ht.call(t,r)&&Ri(e,r,t[r])})),Ya=ao((function(e,t){oo(t,ac(t),e)})),Ja=ao((function(e,t,r,i){oo(t,ac(t),e,i)})),Za=ao((function(e,t,r,i){oo(t,sc(t),e,i)})),Qa=Ao(Di);var Xa=Cn((function(e,t){e=rt(e);var r=-1,n=t.length,o=n>2?t[2]:i;for(o&&Yo(t[0],t[1],o)&&(n=1);++r<n;)for(var s=t[r],a=ac(s),c=-1,l=a.length;++c<l;){var u=a[c],h=e[u];(h===i||ma(h,ct[u])&&!ht.call(e,u))&&(e[u]=s[u])}return e})),ec=Cn((function(e){return e.push(i,Ro),tr(lc,i,e)}));function tc(e,t,r){var n=null==e?i:Zi(e,t);return n===i?r:n}function rc(e,t){return null!=e&&Vo(e,t,rn)}var ic=vo((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),e[t]=r}),Rc(Ac)),nc=vo((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),ht.call(e,t)?e[t].push(r):e[t]=[r]}),jo),oc=Cn(on);function sc(e){return _a(e)?Mi(e):hn(e)}function ac(e){return _a(e)?Mi(e,!0):dn(e)}var cc=ao((function(e,t,r){vn(e,t,r)})),lc=ao((function(e,t,r,i){vn(e,t,r,i)})),uc=Ao((function(e,t){var r={};if(null==e)return r;var i=!1;t=lr(t,(function(t){return t=zn(t,e),i||(i=t.length>1),t})),oo(e,Do(e),r),i&&(r=Ui(r,h|d|f,xo));for(var n=t.length;n--;)Fn(r,t[n]);return r}));var hc=Ao((function(e,t){return null==e?{}:function(e,t){return wn(e,t,(function(t,r){return rc(e,r)}))}(e,t)}));function dc(e,t){if(null==e)return{};var r=lr(Do(e),(function(e){return[e]}));return t=jo(t),wn(e,r,(function(e,r){return t(e,r[0])}))}var fc=Io(sc),pc=Io(ac);function mc(e){return null==e?[]:kr(e,sc(e))}var gc=ho((function(e,t,r){return t=t.toLowerCase(),e+(r?vc(t):t)}));function vc(e){return Cc(Ga(e).toLowerCase())}function yc(e){return(e=Ga(e))&&e.replace(Ye,Ar).replace(Rt,"")}var bc=ho((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),wc=ho((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),_c=uo("toLowerCase");var Sc=ho((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}));var Ec=ho((function(e,t,r){return e+(r?" ":"")+Cc(t)}));var Mc=ho((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Cc=uo("toUpperCase");function Ic(e,t,r){return e=Ga(e),(t=r?i:t)===i?function(e){return Pt.test(e)}(e)?function(e){return e.match(Ot)||[]}(e):function(e){return e.match(Be)||[]}(e):e.match(t)||[]}var Tc=Cn((function(e,t){try{return tr(e,i,t)}catch(e){return Ca(e)?e:new Xe(e)}})),kc=Ao((function(e,t){return ir(t,(function(t){t=ds(t),Pi(e,t,na(e[t],e))})),e}));function Rc(e){return function(){return e}}var xc=mo(),Oc=mo(!0);function Ac(e){return e}function Pc(e){return un("function"==typeof e?e:Ui(e,h))}var Dc=Cn((function(e,t){return function(r){return on(r,e,t)}})),Lc=Cn((function(e,t){return function(r){return on(e,r,t)}}));function Uc(e,t,r){var i=sc(t),n=Ji(t,i);null!=r||Ra(t)&&(n.length||!i.length)||(r=t,t=e,e=this,n=Ji(t,sc(t)));var o=!(Ra(r)&&"chain"in r&&!r.chain),s=Ia(e);return ir(n,(function(r){var i=t[r];e[r]=i,s&&(e.prototype[r]=function(){var t=this.__chain__;if(o||t){var r=e(this.__wrapped__);return(r.__actions__=no(this.__actions__)).push({func:i,args:arguments,thisArg:e}),r.__chain__=t,r}return i.apply(e,ur([this.value()],arguments))})})),e}function Nc(){}var jc=bo(lr),Bc=bo(or),Fc=bo(fr);function Kc(e){return Jo(e)?_r(ds(e)):function(e){return function(t){return Zi(t,e)}}(e)}var qc=_o(),$c=_o(!0);function Wc(){return[]}function Vc(){return!1}var Hc=yo((function(e,t){return e+t}),0),Gc=Mo("ceil"),zc=yo((function(e,t){return e/t}),1),Yc=Mo("floor");var Jc,Zc=yo((function(e,t){return e*t}),1),Qc=Mo("round"),Xc=yo((function(e,t){return e-t}),0);return pi.after=function(e,t){if("function"!=typeof t)throw new ot(s);return e=$a(e),function(){if(--e<1)return t.apply(this,arguments)}},pi.ary=ra,pi.assign=za,pi.assignIn=Ya,pi.assignInWith=Ja,pi.assignWith=Za,pi.at=Qa,pi.before=ia,pi.bind=na,pi.bindAll=kc,pi.bindKey=oa,pi.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return ba(e)?e:[e]},pi.chain=Ks,pi.chunk=function(e,t,r){t=(r?Yo(e,t,r):t===i)?1:Hr($a(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var o=0,s=0,a=Le(Wt(n/t));o<n;)a[s++]=An(e,o,o+=t);return a},pi.compact=function(e){for(var t=-1,r=null==e?0:e.length,i=0,n=[];++t<r;){var o=e[t];o&&(n[i++]=o)}return n},pi.concat=function(){var e=arguments.length;if(!e)return[];for(var t=Le(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return ur(ba(r)?no(r):[r],Vi(t,1))},pi.cond=function(e){var t=null==e?0:e.length,r=jo();return e=t?lr(e,(function(e){if("function"!=typeof e[1])throw new ot(s);return[r(e[0]),e[1]]})):[],Cn((function(r){for(var i=-1;++i<t;){var n=e[i];if(tr(n[0],this,r))return tr(n[1],this,r)}}))},pi.conforms=function(e){return function(e){var t=sc(e);return function(r){return Ni(r,e,t)}}(Ui(e,h))},pi.constant=Rc,pi.countBy=Ws,pi.create=function(e,t){var r=mi(e);return null==t?r:Ai(r,t)},pi.curry=function e(t,r,n){var o=To(t,b,i,i,i,i,i,r=n?i:r);return o.placeholder=e.placeholder,o},pi.curryRight=function e(t,r,n){var o=To(t,w,i,i,i,i,i,r=n?i:r);return o.placeholder=e.placeholder,o},pi.debounce=sa,pi.defaults=Xa,pi.defaultsDeep=ec,pi.defer=aa,pi.delay=ca,pi.difference=ms,pi.differenceBy=gs,pi.differenceWith=vs,pi.drop=function(e,t,r){var n=null==e?0:e.length;return n?An(e,(t=r||t===i?1:$a(t))<0?0:t,n):[]},pi.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?An(e,0,(t=n-(t=r||t===i?1:$a(t)))<0?0:t):[]},pi.dropRightWhile=function(e,t){return e&&e.length?qn(e,jo(t,3),!0,!0):[]},pi.dropWhile=function(e,t){return e&&e.length?qn(e,jo(t,3),!0):[]},pi.fill=function(e,t,r,n){var o=null==e?0:e.length;return o?(r&&"number"!=typeof r&&Yo(e,t,r)&&(r=0,n=o),function(e,t,r,n){var o=e.length;for((r=$a(r))<0&&(r=-r>o?0:o+r),(n=n===i||n>o?o:$a(n))<0&&(n+=o),n=r>n?0:Wa(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},pi.filter=function(e,t){return(ba(e)?sr:Wi)(e,jo(t,3))},pi.flatMap=function(e,t){return Vi(Qs(e,t),1)},pi.flatMapDeep=function(e,t){return Vi(Qs(e,t),A)},pi.flatMapDepth=function(e,t,r){return r=r===i?1:$a(r),Vi(Qs(e,t),r)},pi.flatten=ws,pi.flattenDeep=function(e){return(null==e?0:e.length)?Vi(e,A):[]},pi.flattenDepth=function(e,t){return(null==e?0:e.length)?Vi(e,t=t===i?1:$a(t)):[]},pi.flip=function(e){return To(e,C)},pi.flow=xc,pi.flowRight=Oc,pi.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,i={};++t<r;){var n=e[t];i[n[0]]=n[1]}return i},pi.functions=function(e){return null==e?[]:Ji(e,sc(e))},pi.functionsIn=function(e){return null==e?[]:Ji(e,ac(e))},pi.groupBy=Ys,pi.initial=function(e){return(null==e?0:e.length)?An(e,0,-1):[]},pi.intersection=Ss,pi.intersectionBy=Es,pi.intersectionWith=Ms,pi.invert=ic,pi.invertBy=nc,pi.invokeMap=Js,pi.iteratee=Pc,pi.keyBy=Zs,pi.keys=sc,pi.keysIn=ac,pi.map=Qs,pi.mapKeys=function(e,t){var r={};return t=jo(t,3),zi(e,(function(e,i,n){Pi(r,t(e,i,n),e)})),r},pi.mapValues=function(e,t){var r={};return t=jo(t,3),zi(e,(function(e,i,n){Pi(r,i,t(e,i,n))})),r},pi.matches=function(e){return mn(Ui(e,h))},pi.matchesProperty=function(e,t){return gn(e,Ui(t,h))},pi.memoize=la,pi.merge=cc,pi.mergeWith=lc,pi.method=Dc,pi.methodOf=Lc,pi.mixin=Uc,pi.negate=ua,pi.nthArg=function(e){return e=$a(e),Cn((function(t){return yn(t,e)}))},pi.omit=uc,pi.omitBy=function(e,t){return dc(e,ua(jo(t)))},pi.once=function(e){return ia(2,e)},pi.orderBy=function(e,t,r,n){return null==e?[]:(ba(t)||(t=null==t?[]:[t]),ba(r=n?i:r)||(r=null==r?[]:[r]),bn(e,t,r))},pi.over=jc,pi.overArgs=ha,pi.overEvery=Bc,pi.overSome=Fc,pi.partial=da,pi.partialRight=fa,pi.partition=Xs,pi.pick=hc,pi.pickBy=dc,pi.property=Kc,pi.propertyOf=function(e){return function(t){return null==e?i:Zi(e,t)}},pi.pull=Is,pi.pullAll=Ts,pi.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?_n(e,t,jo(r,2)):e},pi.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?_n(e,t,i,r):e},pi.pullAt=ks,pi.range=qc,pi.rangeRight=$c,pi.rearg=pa,pi.reject=function(e,t){return(ba(e)?sr:Wi)(e,ua(jo(t,3)))},pi.remove=function(e,t){var r=[];if(!e||!e.length)return r;var i=-1,n=[],o=e.length;for(t=jo(t,3);++i<o;){var s=e[i];t(s,i,e)&&(r.push(s),n.push(i))}return Sn(e,n),r},pi.rest=function(e,t){if("function"!=typeof e)throw new ot(s);return Cn(e,t=t===i?t:$a(t))},pi.reverse=Rs,pi.sampleSize=function(e,t,r){return t=(r?Yo(e,t,r):t===i)?1:$a(t),(ba(e)?Ii:Tn)(e,t)},pi.set=function(e,t,r){return null==e?e:kn(e,t,r)},pi.setWith=function(e,t,r,n){return n="function"==typeof n?n:i,null==e?e:kn(e,t,r,n)},pi.shuffle=function(e){return(ba(e)?Ti:On)(e)},pi.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&Yo(e,t,r)?(t=0,r=n):(t=null==t?0:$a(t),r=r===i?n:$a(r)),An(e,t,r)):[]},pi.sortBy=ea,pi.sortedUniq=function(e){return e&&e.length?Un(e):[]},pi.sortedUniqBy=function(e,t){return e&&e.length?Un(e,jo(t,2)):[]},pi.split=function(e,t,r){return r&&"number"!=typeof r&&Yo(e,t,r)&&(t=r=i),(r=r===i?U:r>>>0)?(e=Ga(e))&&("string"==typeof t||null!=t&&!Da(t))&&!(t=jn(t))&&Lr(e)?Jn(Kr(e),0,r):e.split(t,r):[]},pi.spread=function(e,t){if("function"!=typeof e)throw new ot(s);return t=null==t?0:Hr($a(t),0),Cn((function(r){var i=r[t],n=Jn(r,0,t);return i&&ur(n,i),tr(e,this,n)}))},pi.tail=function(e){var t=null==e?0:e.length;return t?An(e,1,t):[]},pi.take=function(e,t,r){return e&&e.length?An(e,0,(t=r||t===i?1:$a(t))<0?0:t):[]},pi.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?An(e,(t=n-(t=r||t===i?1:$a(t)))<0?0:t,n):[]},pi.takeRightWhile=function(e,t){return e&&e.length?qn(e,jo(t,3),!1,!0):[]},pi.takeWhile=function(e,t){return e&&e.length?qn(e,jo(t,3)):[]},pi.tap=function(e,t){return t(e),e},pi.throttle=function(e,t,r){var i=!0,n=!0;if("function"!=typeof e)throw new ot(s);return Ra(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),sa(e,t,{leading:i,maxWait:t,trailing:n})},pi.thru=qs,pi.toArray=Ka,pi.toPairs=fc,pi.toPairsIn=pc,pi.toPath=function(e){return ba(e)?lr(e,ds):Na(e)?[e]:no(hs(Ga(e)))},pi.toPlainObject=Ha,pi.transform=function(e,t,r){var i=ba(e),n=i||Ea(e)||ja(e);if(t=jo(t,4),null==r){var o=e&&e.constructor;r=n?i?new o:[]:Ra(e)&&Ia(o)?mi(St(e)):{}}return(n?ir:zi)(e,(function(e,i,n){return t(r,e,i,n)})),r},pi.unary=function(e){return ra(e,1)},pi.union=xs,pi.unionBy=Os,pi.unionWith=As,pi.uniq=function(e){return e&&e.length?Bn(e):[]},pi.uniqBy=function(e,t){return e&&e.length?Bn(e,jo(t,2)):[]},pi.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?Bn(e,i,t):[]},pi.unset=function(e,t){return null==e||Fn(e,t)},pi.unzip=Ps,pi.unzipWith=Ds,pi.update=function(e,t,r){return null==e?e:Kn(e,t,Gn(r))},pi.updateWith=function(e,t,r,n){return n="function"==typeof n?n:i,null==e?e:Kn(e,t,Gn(r),n)},pi.values=mc,pi.valuesIn=function(e){return null==e?[]:kr(e,ac(e))},pi.without=Ls,pi.words=Ic,pi.wrap=function(e,t){return da(Gn(t),e)},pi.xor=Us,pi.xorBy=Ns,pi.xorWith=js,pi.zip=Bs,pi.zipObject=function(e,t){return Vn(e||[],t||[],Ri)},pi.zipObjectDeep=function(e,t){return Vn(e||[],t||[],kn)},pi.zipWith=Fs,pi.entries=fc,pi.entriesIn=pc,pi.extend=Ya,pi.extendWith=Ja,Uc(pi,pi),pi.add=Hc,pi.attempt=Tc,pi.camelCase=gc,pi.capitalize=vc,pi.ceil=Gc,pi.clamp=function(e,t,r){return r===i&&(r=t,t=i),r!==i&&(r=(r=Va(r))==r?r:0),t!==i&&(t=(t=Va(t))==t?t:0),Li(Va(e),t,r)},pi.clone=function(e){return Ui(e,f)},pi.cloneDeep=function(e){return Ui(e,h|f)},pi.cloneDeepWith=function(e,t){return Ui(e,h|f,t="function"==typeof t?t:i)},pi.cloneWith=function(e,t){return Ui(e,f,t="function"==typeof t?t:i)},pi.conformsTo=function(e,t){return null==t||Ni(e,t,sc(t))},pi.deburr=yc,pi.defaultTo=function(e,t){return null==e||e!=e?t:e},pi.divide=zc,pi.endsWith=function(e,t,r){e=Ga(e),t=jn(t);var n=e.length,o=r=r===i?n:Li($a(r),0,n);return(r-=t.length)>=0&&e.slice(r,o)==t},pi.eq=ma,pi.escape=function(e){return(e=Ga(e))&&Ce.test(e)?e.replace(Ee,Pr):e},pi.escapeRegExp=function(e){return(e=Ga(e))&&Pe.test(e)?e.replace(Ae,"\\$&"):e},pi.every=function(e,t,r){var n=ba(e)?or:qi;return r&&Yo(e,t,r)&&(t=i),n(e,jo(t,3))},pi.find=Vs,pi.findIndex=ys,pi.findKey=function(e,t){return mr(e,jo(t,3),zi)},pi.findLast=Hs,pi.findLastIndex=bs,pi.findLastKey=function(e,t){return mr(e,jo(t,3),Yi)},pi.floor=Yc,pi.forEach=Gs,pi.forEachRight=zs,pi.forIn=function(e,t){return null==e?e:Hi(e,jo(t,3),ac)},pi.forInRight=function(e,t){return null==e?e:Gi(e,jo(t,3),ac)},pi.forOwn=function(e,t){return e&&zi(e,jo(t,3))},pi.forOwnRight=function(e,t){return e&&Yi(e,jo(t,3))},pi.get=tc,pi.gt=ga,pi.gte=va,pi.has=function(e,t){return null!=e&&Vo(e,t,tn)},pi.hasIn=rc,pi.head=_s,pi.identity=Ac,pi.includes=function(e,t,r,i){e=_a(e)?e:mc(e),r=r&&!i?$a(r):0;var n=e.length;return r<0&&(r=Hr(n+r,0)),Ua(e)?r<=n&&e.indexOf(t,r)>-1:!!n&&vr(e,t,r)>-1},pi.indexOf=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:$a(r);return n<0&&(n=Hr(i+n,0)),vr(e,t,n)},pi.inRange=function(e,t,r){return t=qa(t),r===i?(r=t,t=0):r=qa(r),function(e,t,r){return e>=Gr(t,r)&&e<Hr(t,r)}(e=Va(e),t,r)},pi.invoke=oc,pi.isArguments=ya,pi.isArray=ba,pi.isArrayBuffer=wa,pi.isArrayLike=_a,pi.isArrayLikeObject=Sa,pi.isBoolean=function(e){return!0===e||!1===e||xa(e)&&Xi(e)==$},pi.isBuffer=Ea,pi.isDate=Ma,pi.isElement=function(e){return xa(e)&&1===e.nodeType&&!Pa(e)},pi.isEmpty=function(e){if(null==e)return!0;if(_a(e)&&(ba(e)||"string"==typeof e||"function"==typeof e.splice||Ea(e)||ja(e)||ya(e)))return!e.length;var t=Wo(e);if(t==Y||t==re)return!e.size;if(Xo(e))return!hn(e).length;for(var r in e)if(ht.call(e,r))return!1;return!0},pi.isEqual=function(e,t){return an(e,t)},pi.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:i)?r(e,t):i;return n===i?an(e,t,i,r):!!n},pi.isError=Ca,pi.isFinite=function(e){return"number"==typeof e&&pr(e)},pi.isFunction=Ia,pi.isInteger=Ta,pi.isLength=ka,pi.isMap=Oa,pi.isMatch=function(e,t){return e===t||cn(e,t,Fo(t))},pi.isMatchWith=function(e,t,r){return r="function"==typeof r?r:i,cn(e,t,Fo(t),r)},pi.isNaN=function(e){return Aa(e)&&e!=+e},pi.isNative=function(e){if(Qo(e))throw new Xe(o);return ln(e)},pi.isNil=function(e){return null==e},pi.isNull=function(e){return null===e},pi.isNumber=Aa,pi.isObject=Ra,pi.isObjectLike=xa,pi.isPlainObject=Pa,pi.isRegExp=Da,pi.isSafeInteger=function(e){return Ta(e)&&e>=-P&&e<=P},pi.isSet=La,pi.isString=Ua,pi.isSymbol=Na,pi.isTypedArray=ja,pi.isUndefined=function(e){return e===i},pi.isWeakMap=function(e){return xa(e)&&Wo(e)==se},pi.isWeakSet=function(e){return xa(e)&&Xi(e)==ae},pi.join=function(e,t){return null==e?"":Sr.call(e,t)},pi.kebabCase=bc,pi.last=Cs,pi.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var o=n;return r!==i&&(o=(o=$a(r))<0?Hr(n+o,0):Gr(o,n-1)),t==t?function(e,t,r){for(var i=r+1;i--;)if(e[i]===t)return i;return i}(e,t,o):gr(e,br,o,!0)},pi.lowerCase=wc,pi.lowerFirst=_c,pi.lt=Ba,pi.lte=Fa,pi.max=function(e){return e&&e.length?$i(e,Ac,en):i},pi.maxBy=function(e,t){return e&&e.length?$i(e,jo(t,2),en):i},pi.mean=function(e){return wr(e,Ac)},pi.meanBy=function(e,t){return wr(e,jo(t,2))},pi.min=function(e){return e&&e.length?$i(e,Ac,fn):i},pi.minBy=function(e,t){return e&&e.length?$i(e,jo(t,2),fn):i},pi.stubArray=Wc,pi.stubFalse=Vc,pi.stubObject=function(){return{}},pi.stubString=function(){return""},pi.stubTrue=function(){return!0},pi.multiply=Zc,pi.nth=function(e,t){return e&&e.length?yn(e,$a(t)):i},pi.noConflict=function(){return $t._===this&&($t._=gt),this},pi.noop=Nc,pi.now=ta,pi.pad=function(e,t,r){e=Ga(e);var i=(t=$a(t))?Fr(e):0;if(!t||i>=t)return e;var n=(t-i)/2;return wo(Vt(n),r)+e+wo(Wt(n),r)},pi.padEnd=function(e,t,r){e=Ga(e);var i=(t=$a(t))?Fr(e):0;return t&&i<t?e+wo(t-i,r):e},pi.padStart=function(e,t,r){e=Ga(e);var i=(t=$a(t))?Fr(e):0;return t&&i<t?wo(t-i,r)+e:e},pi.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),Yr(Ga(e).replace(De,""),t||0)},pi.random=function(e,t,r){if(r&&"boolean"!=typeof r&&Yo(e,t,r)&&(t=r=i),r===i&&("boolean"==typeof t?(r=t,t=i):"boolean"==typeof e&&(r=e,e=i)),e===i&&t===i?(e=0,t=1):(e=qa(e),t===i?(t=e,e=0):t=qa(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var o=Jr();return Gr(e+o*(t-e+Bt("1e-"+((o+"").length-1))),t)}return En(e,t)},pi.reduce=function(e,t,r){var i=ba(e)?hr:Er,n=arguments.length<3;return i(e,jo(t,4),r,n,Fi)},pi.reduceRight=function(e,t,r){var i=ba(e)?dr:Er,n=arguments.length<3;return i(e,jo(t,4),r,n,Ki)},pi.repeat=function(e,t,r){return t=(r?Yo(e,t,r):t===i)?1:$a(t),Mn(Ga(e),t)},pi.replace=function(){var e=arguments,t=Ga(e[0]);return e.length<3?t:t.replace(e[1],e[2])},pi.result=function(e,t,r){var n=-1,o=(t=zn(t,e)).length;for(o||(o=1,e=i);++n<o;){var s=null==e?i:e[ds(t[n])];s===i&&(n=o,s=r),e=Ia(s)?s.call(e):s}return e},pi.round=Qc,pi.runInContext=e,pi.sample=function(e){return(ba(e)?Ci:In)(e)},pi.size=function(e){if(null==e)return 0;if(_a(e))return Ua(e)?Fr(e):e.length;var t=Wo(e);return t==Y||t==re?e.size:hn(e).length},pi.snakeCase=Sc,pi.some=function(e,t,r){var n=ba(e)?fr:Pn;return r&&Yo(e,t,r)&&(t=i),n(e,jo(t,3))},pi.sortedIndex=function(e,t){return Dn(e,t)},pi.sortedIndexBy=function(e,t,r){return Ln(e,t,jo(r,2))},pi.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var i=Dn(e,t);if(i<r&&ma(e[i],t))return i}return-1},pi.sortedLastIndex=function(e,t){return Dn(e,t,!0)},pi.sortedLastIndexBy=function(e,t,r){return Ln(e,t,jo(r,2),!0)},pi.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=Dn(e,t,!0)-1;if(ma(e[r],t))return r}return-1},pi.startCase=Ec,pi.startsWith=function(e,t,r){return e=Ga(e),r=null==r?0:Li($a(r),0,e.length),t=jn(t),e.slice(r,r+t.length)==t},pi.subtract=Xc,pi.sum=function(e){return e&&e.length?Mr(e,Ac):0},pi.sumBy=function(e,t){return e&&e.length?Mr(e,jo(t,2)):0},pi.template=function(e,t,r){var n=pi.templateSettings;r&&Yo(e,t,r)&&(t=i),e=Ga(e),t=Ja({},t,n,ko);var o,s,c=Ja({},t.imports,n.imports,ko),l=sc(c),u=kr(c,l),h=0,d=t.interpolate||Je,f="__p += '",p=it((t.escape||Je).source+"|"+d.source+"|"+(d===ke?qe:Je).source+"|"+(t.evaluate||Je).source+"|$","g"),m="//# sourceURL="+(ht.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Lt+"]")+"\n";e.replace(p,(function(t,r,i,n,a,c){return i||(i=n),f+=e.slice(h,c).replace(Ze,Dr),r&&(o=!0,f+="' +\n__e("+r+") +\n'"),a&&(s=!0,f+="';\n"+a+";\n__p += '"),i&&(f+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),h=c+t.length,t})),f+="';\n";var g=ht.call(t,"variable")&&t.variable;if(g){if(Fe.test(g))throw new Xe(a)}else f="with (obj) {\n"+f+"\n}\n";f=(s?f.replace(be,""):f).replace(we,"$1").replace(_e,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v=Tc((function(){return et(l,m+"return "+f).apply(i,u)}));if(v.source=f,Ca(v))throw v;return v},pi.times=function(e,t){if((e=$a(e))<1||e>P)return[];var r=U,i=Gr(e,U);t=jo(t),e-=U;for(var n=Cr(i,t);++r<e;)t(r);return n},pi.toFinite=qa,pi.toInteger=$a,pi.toLength=Wa,pi.toLower=function(e){return Ga(e).toLowerCase()},pi.toNumber=Va,pi.toSafeInteger=function(e){return e?Li($a(e),-P,P):0===e?e:0},pi.toString=Ga,pi.toUpper=function(e){return Ga(e).toUpperCase()},pi.trim=function(e,t,r){if((e=Ga(e))&&(r||t===i))return Ir(e);if(!e||!(t=jn(t)))return e;var n=Kr(e),o=Kr(t);return Jn(n,xr(n,o),Or(n,o)+1).join("")},pi.trimEnd=function(e,t,r){if((e=Ga(e))&&(r||t===i))return e.slice(0,qr(e)+1);if(!e||!(t=jn(t)))return e;var n=Kr(e);return Jn(n,0,Or(n,Kr(t))+1).join("")},pi.trimStart=function(e,t,r){if((e=Ga(e))&&(r||t===i))return e.replace(De,"");if(!e||!(t=jn(t)))return e;var n=Kr(e);return Jn(n,xr(n,Kr(t))).join("")},pi.truncate=function(e,t){var r=I,n=T;if(Ra(t)){var o="separator"in t?t.separator:o;r="length"in t?$a(t.length):r,n="omission"in t?jn(t.omission):n}var s=(e=Ga(e)).length;if(Lr(e)){var a=Kr(e);s=a.length}if(r>=s)return e;var c=r-Fr(n);if(c<1)return n;var l=a?Jn(a,0,c).join(""):e.slice(0,c);if(o===i)return l+n;if(a&&(c+=l.length-c),Da(o)){if(e.slice(c).search(o)){var u,h=l;for(o.global||(o=it(o.source,Ga($e.exec(o))+"g")),o.lastIndex=0;u=o.exec(h);)var d=u.index;l=l.slice(0,d===i?c:d)}}else if(e.indexOf(jn(o),c)!=c){var f=l.lastIndexOf(o);f>-1&&(l=l.slice(0,f))}return l+n},pi.unescape=function(e){return(e=Ga(e))&&Me.test(e)?e.replace(Se,$r):e},pi.uniqueId=function(e){var t=++dt;return Ga(e)+t},pi.upperCase=Mc,pi.upperFirst=Cc,pi.each=Gs,pi.eachRight=zs,pi.first=_s,Uc(pi,(Jc={},zi(pi,(function(e,t){ht.call(pi.prototype,t)||(Jc[t]=e)})),Jc),{chain:!1}),pi.VERSION="4.17.21",ir(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){pi[e].placeholder=pi})),ir(["drop","take"],(function(e,t){yi.prototype[e]=function(r){r=r===i?1:Hr($a(r),0);var n=this.__filtered__&&!t?new yi(this):this.clone();return n.__filtered__?n.__takeCount__=Gr(r,n.__takeCount__):n.__views__.push({size:Gr(r,U),type:e+(n.__dir__<0?"Right":"")}),n},yi.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),ir(["filter","map","takeWhile"],(function(e,t){var r=t+1,i=r==x||3==r;yi.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:jo(e,3),type:r}),t.__filtered__=t.__filtered__||i,t}})),ir(["head","last"],(function(e,t){var r="take"+(t?"Right":"");yi.prototype[e]=function(){return this[r](1).value()[0]}})),ir(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");yi.prototype[e]=function(){return this.__filtered__?new yi(this):this[r](1)}})),yi.prototype.compact=function(){return this.filter(Ac)},yi.prototype.find=function(e){return this.filter(e).head()},yi.prototype.findLast=function(e){return this.reverse().find(e)},yi.prototype.invokeMap=Cn((function(e,t){return"function"==typeof e?new yi(this):this.map((function(r){return on(r,e,t)}))})),yi.prototype.reject=function(e){return this.filter(ua(jo(e)))},yi.prototype.slice=function(e,t){e=$a(e);var r=this;return r.__filtered__&&(e>0||t<0)?new yi(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==i&&(r=(t=$a(t))<0?r.dropRight(-t):r.take(t-e)),r)},yi.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},yi.prototype.toArray=function(){return this.take(U)},zi(yi.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),o=pi[n?"take"+("last"==t?"Right":""):t],s=n||/^find/.test(t);o&&(pi.prototype[t]=function(){var t=this.__wrapped__,a=n?[1]:arguments,c=t instanceof yi,l=a[0],u=c||ba(t),h=function(e){var t=o.apply(pi,ur([e],a));return n&&d?t[0]:t};u&&r&&"function"==typeof l&&1!=l.length&&(c=u=!1);var d=this.__chain__,f=!!this.__actions__.length,p=s&&!d,m=c&&!f;if(!s&&u){t=m?t:new yi(this);var g=e.apply(t,a);return g.__actions__.push({func:qs,args:[h],thisArg:i}),new vi(g,d)}return p&&m?e.apply(this,a):(g=this.thru(h),p?n?g.value()[0]:g.value():g)})})),ir(["pop","push","shift","sort","splice","unshift"],(function(e){var t=st[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);pi.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var n=this.value();return t.apply(ba(n)?n:[],e)}return this[r]((function(r){return t.apply(ba(r)?r:[],e)}))}})),zi(yi.prototype,(function(e,t){var r=pi[t];if(r){var i=r.name+"";ht.call(oi,i)||(oi[i]=[]),oi[i].push({name:t,func:r})}})),oi[go(i,v).name]=[{name:"wrapper",func:i}],yi.prototype.clone=function(){var e=new yi(this.__wrapped__);return e.__actions__=no(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=no(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=no(this.__views__),e},yi.prototype.reverse=function(){if(this.__filtered__){var e=new yi(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},yi.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=ba(e),i=t<0,n=r?e.length:0,o=function(e,t,r){var i=-1,n=r.length;for(;++i<n;){var o=r[i],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=Gr(t,e+s);break;case"takeRight":e=Hr(e,t-s)}}return{start:e,end:t}}(0,n,this.__views__),s=o.start,a=o.end,c=a-s,l=i?a:s-1,u=this.__iteratees__,h=u.length,d=0,f=Gr(c,this.__takeCount__);if(!r||!i&&n==c&&f==c)return $n(e,this.__actions__);var p=[];e:for(;c--&&d<f;){for(var m=-1,g=e[l+=t];++m<h;){var v=u[m],y=v.iteratee,b=v.type,w=y(g);if(b==O)g=w;else if(!w){if(b==x)continue e;break e}}p[d++]=g}return p},pi.prototype.at=$s,pi.prototype.chain=function(){return Ks(this)},pi.prototype.commit=function(){return new vi(this.value(),this.__chain__)},pi.prototype.next=function(){this.__values__===i&&(this.__values__=Ka(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},pi.prototype.plant=function(e){for(var t,r=this;r instanceof gi;){var n=ps(r);n.__index__=0,n.__values__=i,t?o.__wrapped__=n:t=n;var o=n;r=r.__wrapped__}return o.__wrapped__=e,t},pi.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof yi){var t=e;return this.__actions__.length&&(t=new yi(this)),(t=t.reverse()).__actions__.push({func:qs,args:[Rs],thisArg:i}),new vi(t,this.__chain__)}return this.thru(Rs)},pi.prototype.toJSON=pi.prototype.valueOf=pi.prototype.value=function(){return $n(this.__wrapped__,this.__actions__)},pi.prototype.first=pi.prototype.head,Tt&&(pi.prototype[Tt]=function(){return this}),pi}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?($t._=Wr,define((function(){return Wr}))):Vt?((Vt.exports=Wr)._=Wr,Wt._=Wr):$t._=Wr}).call(this)}));