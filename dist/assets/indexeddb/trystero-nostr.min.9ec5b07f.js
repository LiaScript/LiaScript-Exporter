!function(){var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("1UDrq",(function(t,n){var r,i;r=t.exports,i=function(){return qt},Object.defineProperty(r,"joinRoom",{get:i,set:undefined,enumerable:!0,configurable:!0});var a=e("hnmIs"),o=e("9Klpk"),s=e("3bWnf"),u=e("eT7f3"),c=e("kb0qF"),f=e("bgoEC"),d=e("7j4mF"),l=e("1Qswt"),h=e("5ENmm"),g=e("6Wo7Q"),y=e("rJmE6"),p=e("fSF4h"),v=e("bWNdT"),m=e("32Euv");function _(e){if(!Number.isSafeInteger(e)||e<0)throw Error("Wrong positive integer: "+e)}function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!((i=e)instanceof Uint8Array||null!=i&&"object"==typeof i&&"Uint8Array"===i.constructor.name))throw Error("Expected Uint8Array");var i;if(n.length>0&&!n.includes(e.length))throw Error("Expected Uint8Array of length ".concat(n,", not of length=").concat(e.length))}function w(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}var E="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function R(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}var A=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},k=function(e,t){return e<<32-t|e>>>t};if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw Error("Non little-endian hardware is not supported");function S(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+(void 0===e?"undefined":(0,y.default)(e)));return new Uint8Array((new TextEncoder).encode(e))}(e)),!R(e))throw Error("expected Uint8Array, got "+(void 0===e?"undefined":(0,y.default)(e)));return e}var T=function(){"use strict";function e(){(0,o.default)(this,e)}return(0,s.default)(e,[{key:"clone",value:function(){return this._cloneInto()}}]),e}();function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(E&&"function"==typeof E.getRandomValues)return E.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}var I=function(e){"use strict";(0,c.default)(n,e);var t=(0,v.default)(n);function n(e,r,i,a){var s;return(0,o.default)(this,n),(s=t.call(this)).blockLen=e,s.outputLen=r,s.padOffset=i,s.isLE=a,s.finished=!1,s.length=0,s.pos=0,s.destroyed=!1,s.buffer=new Uint8Array(e),s.view=A(s.buffer),(0,l.default)(s)}return(0,s.default)(n,[{key:"update",value:function(e){w(this);for(var t=this,n=t.view,r=t.buffer,i=t.blockLen,a=(e=S(e)).length,o=0;o<a;){var s=Math.min(i-this.pos,a-o);if(s!==i)r.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===i&&(this.process(n,0),this.pos=0);else for(var u=A(e);i<=a-o;o+=i)this.process(u,o)}return this.length+=e.length,this.roundClean(),this}},{key:"digestInto",value:function(e){w(this),function(e,t){b(e);var n=t.outputLen;if(e.length<n)throw Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;var t=this,n=t.buffer,r=t.view,i=t.blockLen,a=t.isLE,o=this.pos;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(var s=o;s<i;s++)n[s]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);var i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),u=r?4:0,c=r?0:4;e.setUint32(t+u,o,r),e.setUint32(t+c,s,r)}(r,i-8,BigInt(8*this.length),a),this.process(r,0);var u=A(e),c=this.outputLen;if(c%4)throw Error("_sha2: outputLen should be aligned to 32bit");var f=c/4,d=this.get();if(f>d.length)throw Error("_sha2: outputLen bigger than state");for(var l=0;l<f;l++)u.setUint32(4*l,d[l],a)}},{key:"digest",value:function(){var e=this.buffer,t=this.outputLen;this.digestInto(e);var n=e.slice(0,t);return this.destroy(),n}},{key:"_cloneInto",value:function(e){var t;e||(e=new this.constructor),(t=e).set.apply(t,(0,g.default)(this.get()));var n=this,r=n.blockLen,i=n.buffer,a=n.length,o=n.finished,s=n.destroyed,u=n.pos;return e.length=a,e.pos=u,e.finished=o,e.destroyed=s,a%r&&e.buffer.set(i),e}}]),n}(T),B=function(e,t,n){return e&t^e&n^t&n},N=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),O=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),x=new Uint32Array(64),D=function(e){"use strict";(0,c.default)(n,e);var t=(0,v.default)(n);function n(){var e;return(0,o.default)(this,n),(e=t.call(this,64,32,8,!1)).A=0|O[0],e.B=0|O[1],e.C=0|O[2],e.D=0|O[3],e.E=0|O[4],e.F=0|O[5],e.G=0|O[6],e.H=0|O[7],(0,l.default)(e)}return(0,s.default)(n,[{key:"get",value:function(){var e=this;return[e.A,e.B,e.C,e.D,e.E,e.F,e.G,e.H]}},{key:"set",value:function(e,t,n,r,i,a,o,s){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|a,this.G=0|o,this.H=0|s}},{key:"process",value:function(e,t){for(var n=0;n<16;n++,t+=4)x[n]=e.getUint32(t,!1);for(var r=16;r<64;r++){var i=x[r-15],a=x[r-2],o=k(i,7)^k(i,18)^i>>>3,s=k(a,17)^k(a,19)^a>>>10;x[r]=s+x[r-7]+o+x[r-16]|0}for(var u,c=this,f=c.A,d=c.B,l=c.C,h=c.D,g=c.E,y=c.F,p=c.G,v=c.H,m=0;m<64;m++){var _=v+(k(g,6)^k(g,11)^k(g,25))+((u=g)&y^~u&p)+N[m]+x[m]|0,b=(k(f,2)^k(f,13)^k(f,22))+B(f,d,l)|0;v=p,p=y,y=g,g=h+_|0,h=l,l=d,d=f,f=_+b|0}f=f+this.A|0,d=d+this.B|0,l=l+this.C|0,h=h+this.D|0,g=g+this.E|0,y=y+this.F|0,p=p+this.G|0,v=v+this.H|0,this.set(f,d,l,h,g,y,p,v)}},{key:"roundClean",value:function(){x.fill(0)}},{key:"destroy",value:function(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}]),n}(I),L=function(e){var t=function(t){return e().update(S(t)).digest()},n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=function(){return e()},t}((function(){return new D})),P=BigInt(0),q=BigInt(1),U=BigInt(2);function H(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}var F=Array.from({length:256},(function(e,t){return t.toString(16).padStart(2,"0")}));function M(e){if(!H(e))throw Error("Uint8Array expected");for(var t="",n=0;n<e.length;n++)t+=F[e[n]];return t}function j(e){var t=e.toString(16);return 1&t.length?"0"+t:t}function z(e){if("string"!=typeof e)throw Error("hex string expected, got "+(void 0===e?"undefined":(0,y.default)(e)));return BigInt(""===e?"0":"0x"+e)}var V={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function K(e){return e>=V._0&&e<=V._9?e-V._0:e>=V._A&&e<=V._F?e-(V._A-10):e>=V._a&&e<=V._f?e-(V._a-10):void 0}function Y(e){if("string"!=typeof e)throw Error("hex string expected, got "+(void 0===e?"undefined":(0,y.default)(e)));var t=e.length,n=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);for(var r=new Uint8Array(n),i=0,a=0;i<n;i++,a+=2){var o=K(e.charCodeAt(a)),s=K(e.charCodeAt(a+1));if(void 0===o||void 0===s){var u=e[a]+e[a+1];throw Error('hex string expected, got non-hex character "'+u+'" at index '+a)}r[i]=16*o+s}return r}function Z(e){return z(M(e))}function W(e){if(!H(e))throw Error("Uint8Array expected");return z(M(Uint8Array.from(e).reverse()))}function J(e,t){return Y(e.toString(16).padStart(2*t,"0"))}function G(e,t){return J(e,t).reverse()}function Q(e,t,n){var r;if("string"==typeof t)try{r=Y(t)}catch(n){throw Error("".concat(e,' must be valid hex string, got "').concat(t,'". Cause: ').concat(n))}else{if(!H(t))throw Error(e+" must be hex string or Uint8Array");r=Uint8Array.from(t)}var i=r.length;if("number"==typeof n&&i!==n)throw Error("".concat(e," expected ").concat(n," bytes, got ").concat(i));return r}function X(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=0;i<t.length;i++){var a=t[i];if(!H(a))throw Error("Uint8Array expected");r+=a.length}for(var o=new Uint8Array(r),s=0,u=0;u<t.length;u++){var c=t[u];o.set(c,s),s+=c.length}return o}var $=function(e){return(U<<BigInt(e-1))-q},ee=function(e){return new Uint8Array(e)},te=function(e){return Uint8Array.from(e)};function ne(e,t,n){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof n)throw Error("hmacFn must be a function");var r=ee(e),i=ee(e),a=0,o=function(){r.fill(1),i.fill(0),a=0},s=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return n.apply(void 0,[i,r].concat((0,g.default)(t)))},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee();i=s(te([0]),e),r=s(),0!==e.length&&(i=s(te([1]),e),r=s())},c=function(){if(a++>=1e3)throw Error("drbg: tried 1000 values");for(var e=0,n=[];e<t;){var i=(r=s()).slice();n.push(i),e+=r.length}return X.apply(void 0,(0,g.default)(n))};return function(e,t){var n;for(o(),u(e);!(n=t(c()));)u();return o(),n}}var re={bigint:function(e){return"bigint"==(void 0===e?"undefined":(0,y.default)(e))},function:function(e){return"function"==typeof e},boolean:function(e){return"boolean"==typeof e},string:function(e){return"string"==typeof e},stringOrUint8Array:function(e){return"string"==typeof e||H(e)},isSafeInteger:function(e){return Number.isSafeInteger(e)},array:function(e){return Array.isArray(e)},field:function(e,t){return t.Fp.isValid(e)},hash:function(e){return"function"==typeof e&&Number.isSafeInteger(e.outputLen)}};function ie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=function(t,n,r){var i=re[n];if("function"!=typeof i)throw Error('Invalid validator "'.concat(n,'", expected function'));var a=e[t];if(!(r&&void 0===a||i(a,e)))throw Error("Invalid param ".concat(t+"","=").concat(a," (").concat(void 0===a?"undefined":(0,y.default)(a),"), expected ").concat(n))},i=!0,a=!1,o=void 0;try{for(var s,u=Object.entries(t)[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=(0,h.default)(s.value,2);r(c[0],c[1],!1)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}var f=!0,d=!1,l=void 0;try{for(var g,p=Object.entries(n)[Symbol.iterator]();!(f=(g=p.next()).done);f=!0){var v=(0,h.default)(g.value,2);r(v[0],v[1],!0)}}catch(e){d=!0,l=e}finally{try{f||null==p.return||p.return()}finally{if(d)throw l}}return e}var ae=Object.freeze({__proto__:null,bitGet:function(e,t){return e>>BigInt(t)&q},bitLen:function(e){var t;for(t=0;e>P;e>>=q,t+=1);return t},bitMask:$,bitSet:function(e,t,n){return e|(n?q:P)<<BigInt(t)},bytesToHex:M,bytesToNumberBE:Z,bytesToNumberLE:W,concatBytes:X,createHmacDrbg:ne,ensureBytes:Q,equalBytes:function(e,t){if(e.length!==t.length)return!1;for(var n=0,r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},hexToBytes:Y,hexToNumber:z,isBytes:H,numberToBytesBE:J,numberToBytesLE:G,numberToHexUnpadded:j,numberToVarBytesBE:function(e){return Y(j(e))},utf8ToBytes:function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+(void 0===e?"undefined":(0,y.default)(e)));return new Uint8Array((new TextEncoder).encode(e))},validateObject:ie}),oe=BigInt(0),se=BigInt(1),ue=BigInt(2),ce=BigInt(3),fe=BigInt(4),de=BigInt(5),le=BigInt(8);function he(e,t){var n=e%t;return n>=oe?n:t+n}function ge(e,t,n){if(n<=oe||t<oe)throw Error("Expected power/modulo > 0");if(n===se)return oe;for(var r=se;t>oe;)t&se&&(r=r*e%n),e=e*e%n,t>>=se;return r}function ye(e,t,n){for(var r=e;t-- >oe;)r*=r,r%=n;return r}function pe(e,t){if(e===oe||t<=oe)throw Error("invert: expected positive integers, got n=".concat(e," mod=").concat(t));for(var n=he(e,t),r=t,i=oe,a=se;n!==oe;){var o=r%n,s=i-a*(r/n);r=n,n=o,i=a,a=s}if(r!==se)throw Error("invert: does not exist");return he(i,t)}BigInt(9),BigInt(16);var ve=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function me(e,t){var n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function _e(e){if("bigint"!=(void 0===e?"undefined":(0,y.default)(e)))throw Error("field order must be bigint");var t=e.toString(2).length;return Math.ceil(t/8)}function be(e){var t=_e(e);return t+Math.ceil(t/2)}var we,Ee=BigInt(0),Re=BigInt(1);function Ae(e){return ie(e.Fp,ve.reduce((function(e,t){return e[t]="function",e}),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),ie(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze((0,d.default)((0,f.default)({},me(e.n,e.nBitLength),e),{p:e.Fp.ORDER}))}var ke=ae.bytesToNumberBE,Se=ae.hexToBytes,Te=(we={Err:function(e){"use strict";(0,c.default)(n,e);var t=(0,v.default)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,o.default)(this,n),t.call(this,e)}return n}((0,p.default)(Error))},(0,u.default)(we,"_parseInt",(function(e){var t=Te.Err;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");var n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:ke(r),l:e.subarray(n+2)}})),(0,u.default)(we,"toSig",(function(e){var t=Te.Err,n="string"==typeof e?Se(e):e;if(!H(n))throw Error("ui8a expected");var r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");var i=Te._parseInt(n.subarray(2)),a=i.d,o=i.l,s=Te._parseInt(o),u=s.d;if(s.l.length)throw new t("Invalid signature: left bytes after parsing");return{r:a,s:u}})),(0,u.default)(we,"hexFromSig",(function(e){var t=function(e){return 8&Number.parseInt(e[0],16)?"00"+e:e},n=function(e){var t=e.toString(16);return 1&t.length?"0"+t:t},r=t(n(e.s)),i=t(n(e.r)),a=r.length/2,o=i.length/2,s=n(a),u=n(o);return"30".concat(n(o+a+4),"02").concat(u).concat(i,"02").concat(s).concat(r)})),we),Ce=BigInt(0),Ie=BigInt(1);BigInt(2);var Be=BigInt(3);BigInt(4);var Ne=function(e){"use strict";(0,c.default)(n,e);var t=(0,v.default)(n);function n(e,r){var i;(0,o.default)(this,n),(i=t.call(this)).finished=!1,i.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");_(e.outputLen),_(e.blockLen)}(e);var a=S(r);if(i.iHash=e.create(),"function"!=typeof i.iHash.update)throw Error("Expected instance of class which extends utils.Hash");i.blockLen=i.iHash.blockLen,i.outputLen=i.iHash.outputLen;var s=i.blockLen,u=new Uint8Array(s);u.set(a.length>s?e.create().update(a).digest():a);for(var c=0;c<u.length;c++)u[c]^=54;i.iHash.update(u),i.oHash=e.create();for(var f=0;f<u.length;f++)u[f]^=106;return i.oHash.update(u),u.fill(0),(0,l.default)(i)}return(0,s.default)(n,[{key:"update",value:function(e){return w(this),this.iHash.update(e),this}},{key:"digestInto",value:function(e){w(this),b(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}},{key:"digest",value:function(){var e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}},{key:"_cloneInto",value:function(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));var t=this,n=t.oHash,r=t.iHash,i=t.finished,a=t.destroyed,o=t.blockLen,s=t.outputLen;return e.finished=i,e.destroyed=a,e.blockLen=o,e.outputLen=s,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}},{key:"destroy",value:function(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}]),n}(T),Oe=function(e,t,n){return new Ne(e,t).update(n).digest()};Oe.create=function(e,t){return new Ne(e,t)};var xe=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),De=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Le=BigInt(1),Pe=BigInt(2),qe=function(e,t){return(e+t/Pe)/t};function Ue(e){var t=xe,n=BigInt(3),r=BigInt(6),i=BigInt(11),a=BigInt(22),o=BigInt(23),s=BigInt(44),u=BigInt(88),c=e*e*e%t,f=c*c*e%t,d=ye(f,n,t)*f%t,l=ye(d,n,t)*f%t,h=ye(l,Pe,t)*c%t,g=ye(h,i,t)*h%t,y=ye(g,a,t)*g%t,p=ye(y,s,t)*y%t,v=ye(p,u,t)*p%t,m=ye(v,s,t)*y%t,_=ye(m,n,t)*f%t,b=ye(_,o,t)*g%t,w=ye(b,r,t)*c%t,E=ye(w,Pe,t);if(!He.eql(He.sqr(E),e))throw Error("Cannot find square root");return E}var He=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e<=oe)throw Error("Expected Field ORDER > 0, got "+e);var i=me(e,t),a=i.nBitLength,o=i.nByteLength;if(o>2048)throw Error("Field lengths over 2048 bytes are not supported");var s=function(e){if(e%fe===ce){var t=(e+se)/fe;return function(e,n){var r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error("Cannot find square root");return r}}if(e%le===de){var n=(e-de)/le;return function(e,t){var r=e.mul(t,ue),i=e.pow(r,n),a=e.mul(t,i),o=e.mul(e.mul(a,ue),i),s=e.mul(a,e.sub(o,e.ONE));if(!e.eql(e.sqr(s),t))throw Error("Cannot find square root");return s}}return function(e){var t,n,r,i=(e-se)/ue;for(t=e-se,n=0;t%ue===oe;t/=ue,n++);for(r=ue;r<e&&ge(r,i,e)!==e-se;r++);if(1===n){var a=(e+se)/fe;return function(e,t){var n=e.pow(t,a);if(!e.eql(e.sqr(n),t))throw Error("Cannot find square root");return n}}var o=(t+se)/ue;return function(e,a){if(e.pow(a,i)===e.neg(e.ONE))throw Error("Cannot find square root");for(var s=n,u=e.pow(e.mul(e.ONE,r),t),c=e.pow(a,o),f=e.pow(a,t);!e.eql(f,e.ONE);){if(e.eql(f,e.ZERO))return e.ZERO;for(var d=1,l=e.sqr(f);d<s&&!e.eql(l,e.ONE);d++)l=e.sqr(l);var h=e.pow(u,se<<BigInt(s-d-1));u=e.sqr(h),c=e.mul(c,h),f=e.mul(f,u),s=d}return c}}(e)}(e),u=Object.freeze({ORDER:e,BITS:a,BYTES:o,MASK:$(a),ZERO:oe,ONE:se,create:function(t){return he(t,e)},isValid:function(t){if("bigint"!=(void 0===t?"undefined":(0,y.default)(t)))throw Error("Invalid field element: expected bigint, got "+(void 0===t?"undefined":(0,y.default)(t)));return oe<=t&&t<e},is0:function(e){return e===oe},isOdd:function(e){return(e&se)===se},neg:function(t){return he(-t,e)},eql:function(e,t){return e===t},sqr:function(t){return he(t*t,e)},add:function(t,n){return he(t+n,e)},sub:function(t,n){return he(t-n,e)},mul:function(t,n){return he(t*n,e)},pow:function(e,t){return function(e,t,n){if(n<oe)throw Error("Expected power > 0");if(n===oe)return e.ONE;if(n===se)return t;for(var r=e.ONE,i=t;n>oe;)n&se&&(r=e.mul(r,i)),i=e.sqr(i),n>>=se;return r}(u,e,t)},div:function(t,n){return he(t*pe(n,e),e)},sqrN:function(e){return e*e},addN:function(e,t){return e+t},subN:function(e,t){return e-t},mulN:function(e,t){return e*t},inv:function(t){return pe(t,e)},sqrt:r.sqrt||function(e){return s(u,e)},invertBatch:function(e){return function(e,t){var n=Array(t.length),r=t.reduce((function(t,r,i){return e.is0(r)?t:(n[i]=t,e.mul(t,r))}),e.ONE),i=e.inv(r);return t.reduceRight((function(t,r,i){return e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))}),i),n}(u,e)},cmov:function(e,t,n){return n?t:e},toBytes:function(e){return n?G(e,o):J(e,o)},fromBytes:function(e){if(e.length!==o)throw Error("Fp.fromBytes: expected ".concat(o,", got ").concat(e.length));return n?W(e):Z(e)}});return Object.freeze(u)}(xe,void 0,void 0,{sqrt:Ue}),Fe=function(e,t){var n=function(t){return function(e){var t=function(e){var t=Ae(e);return ie(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze((0,f.default)({lowS:!0},t))}(e),n=t.Fp,r=t.n,i=n.BYTES+1,a=2*n.BYTES+1;function c(e){return he(e,r)}function l(e){return pe(e,r)}var h=function(e){var t=function(e){var t=Ae(e);ie(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});var n=t.endo,r=t.Fp,i=t.a;if(n){if(!r.eql(i,r.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=(0,y.default)(n.beta)||"function"!=typeof n.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze((0,f.default)({},t))}(e),n=t.Fp,r=t.toBytes||function(e,t){var r=t.toAffine();return X(Uint8Array.from([4]),n.toBytes(r.x),n.toBytes(r.y))},i=t.fromBytes||function(e){var t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}};function a(e){var r=t.a,i=t.b,a=n.sqr(e),o=n.mul(a,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),a(t.Gx)))throw Error("bad generator point: equation left != right");function c(e){return"bigint"==(void 0===e?"undefined":(0,y.default)(e))&&Ce<e&&e<t.n}function d(e){if(!c(e))throw Error("Expected valid bigint: 0 < bigint < curve.n")}function l(e){var n,r=t.allowedPrivateKeyLengths,i=t.nByteLength,a=t.wrapPrivateKey,o=t.n;if(r&&"bigint"!=(void 0===e?"undefined":(0,y.default)(e))){if(H(e)&&(e=M(e)),"string"!=typeof e||!r.includes(e.length))throw Error("Invalid key");e=e.padStart(2*i,"0")}try{n="bigint"==(void 0===e?"undefined":(0,y.default)(e))?e:Z(Q("private key",e,i))}catch(t){throw Error("private key must be ".concat(i," bytes, hex or bigint, not ").concat(void 0===e?"undefined":(0,y.default)(e)))}return a&&(n=he(n,o)),d(n),n}var h=new Map;function g(e){if(!(e instanceof p))throw Error("ProjectivePoint expected")}var p=function(){"use strict";function e(t,r,i){if((0,o.default)(this,e),this.px=t,this.py=r,this.pz=i,null==t||!n.isValid(t))throw Error("x required");if(null==r||!n.isValid(r))throw Error("y required");if(null==i||!n.isValid(i))throw Error("z required")}return(0,s.default)(e,[{key:"x",get:function(){return this.toAffine().x}},{key:"y",get:function(){return this.toAffine().y}},{key:"_setWindowSize",value:function(e){this._WINDOW_SIZE=e,h.delete(this)}},{key:"assertValidity",value:function(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw Error("bad point: ZERO")}var e=this.toAffine(),r=e.x,i=e.y;if(!n.isValid(r)||!n.isValid(i))throw Error("bad point: x or y not FE");var o=n.sqr(i),s=a(r);if(!n.eql(o,s))throw Error("bad point: equation left != right");if(!this.isTorsionFree())throw Error("bad point: not in prime-order subgroup")}},{key:"hasEvenY",value:function(){var e=this.toAffine().y;if(n.isOdd)return!n.isOdd(e);throw Error("Field doesn't support isOdd")}},{key:"equals",value:function(e){g(e);var t=this,r=t.px,i=t.py,a=t.pz,o=e.px,s=e.py,u=e.pz,c=n.eql(n.mul(r,u),n.mul(o,a)),f=n.eql(n.mul(i,u),n.mul(s,a));return c&&f}},{key:"negate",value:function(){return new e(this.px,n.neg(this.py),this.pz)}},{key:"double",value:function(){var r=t.a,i=t.b,a=n.mul(i,Be),o=this,s=o.px,u=o.py,c=o.pz,f=n.ZERO,d=n.ZERO,l=n.ZERO,h=n.mul(s,s),g=n.mul(u,u),y=n.mul(c,c),p=n.mul(s,u);return p=n.add(p,p),l=n.mul(s,c),l=n.add(l,l),f=n.mul(r,l),d=n.mul(a,y),d=n.add(f,d),f=n.sub(g,d),d=n.add(g,d),d=n.mul(f,d),f=n.mul(p,f),l=n.mul(a,l),y=n.mul(r,y),p=n.sub(h,y),p=n.mul(r,p),p=n.add(p,l),l=n.add(h,h),h=n.add(l,h),h=n.add(h,y),h=n.mul(h,p),d=n.add(d,h),y=n.mul(u,c),y=n.add(y,y),h=n.mul(y,p),f=n.sub(f,h),l=n.mul(y,g),l=n.add(l,l),new e(f,d,l=n.add(l,l))}},{key:"add",value:function(r){g(r);var i=this,a=i.px,o=i.py,s=i.pz,u=r.px,c=r.py,f=r.pz,d=n.ZERO,l=n.ZERO,h=n.ZERO,y=t.a,p=n.mul(t.b,Be),v=n.mul(a,u),m=n.mul(o,c),_=n.mul(s,f),b=n.add(a,o),w=n.add(u,c);b=n.mul(b,w),w=n.add(v,m),b=n.sub(b,w),w=n.add(a,s);var E=n.add(u,f);return w=n.mul(w,E),E=n.add(v,_),w=n.sub(w,E),E=n.add(o,s),d=n.add(c,f),E=n.mul(E,d),d=n.add(m,_),E=n.sub(E,d),h=n.mul(y,w),d=n.mul(p,_),h=n.add(d,h),d=n.sub(m,h),h=n.add(m,h),l=n.mul(d,h),m=n.add(v,v),m=n.add(m,v),_=n.mul(y,_),w=n.mul(p,w),m=n.add(m,_),_=n.sub(v,_),_=n.mul(y,_),w=n.add(w,_),v=n.mul(m,w),l=n.add(l,v),v=n.mul(E,w),d=n.mul(b,d),d=n.sub(d,v),v=n.mul(b,m),h=n.mul(E,h),new e(d,l,h=n.add(h,v))}},{key:"subtract",value:function(e){return this.add(e.negate())}},{key:"is0",value:function(){return this.equals(e.ZERO)}},{key:"wNAF",value:function(t){return m.wNAFCached(this,h,t,(function(t){var r=n.invertBatch(t.map((function(e){return e.pz})));return t.map((function(e,t){return e.toAffine(r[t])})).map(e.fromAffine)}))}},{key:"multiplyUnsafe",value:function(r){var i=e.ZERO;if(r===Ce)return i;if(d(r),r===Ie)return this;var a=t.endo;if(!a)return m.unsafeLadder(this,r);for(var o=a.splitScalar(r),s=o.k1neg,u=o.k1,c=o.k2neg,f=o.k2,l=i,h=i,g=this;u>Ce||f>Ce;)u&Ie&&(l=l.add(g)),f&Ie&&(h=h.add(g)),g=g.double(),u>>=Ie,f>>=Ie;return s&&(l=l.negate()),c&&(h=h.negate()),h=new e(n.mul(h.px,a.beta),h.py,h.pz),l.add(h)}},{key:"multiply",value:function(r){d(r);var i,a,o=r,s=t.endo;if(s){var u=s.splitScalar(o),c=u.k1neg,f=u.k1,l=u.k2neg,h=u.k2,g=this.wNAF(f),y=g.p,p=g.f,v=this.wNAF(h),_=v.p,b=v.f;y=m.constTimeNegate(c,y),_=m.constTimeNegate(l,_),_=new e(n.mul(_.px,s.beta),_.py,_.pz),i=y.add(_),a=p.add(b)}else{var w=this.wNAF(o);i=w.p,a=w.f}return e.normalizeZ([i,a])[0]}},{key:"multiplyAndAddUnsafe",value:function(t,n,r){var i=e.BASE,a=function(e,t){return t!==Ce&&t!==Ie&&e.equals(i)?e.multiply(t):e.multiplyUnsafe(t)},o=a(this,n).add(a(t,r));return o.is0()?void 0:o}},{key:"toAffine",value:function(e){var t=this,r=t.px,i=t.py,a=t.pz,o=this.is0();null==e&&(e=o?n.ONE:n.inv(a));var s=n.mul(r,e),u=n.mul(i,e),c=n.mul(a,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw Error("invZ was invalid");return{x:s,y:u}}},{key:"isTorsionFree",value:function(){var n=t.h,r=t.isTorsionFree;if(n===Ie)return!0;if(r)return r(e,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}},{key:"clearCofactor",value:function(){var n=t.h,r=t.clearCofactor;return n===Ie?this:r?r(e,this):this.multiplyUnsafe(t.h)}},{key:"toRawBytes",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.assertValidity(),r(e,this,t)}},{key:"toHex",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return M(this.toRawBytes(e))}}],[{key:"fromAffine",value:function(t){var r=t||{},i=r.x,a=r.y;if(!t||!n.isValid(i)||!n.isValid(a))throw Error("invalid affine point");if(t instanceof e)throw Error("projective point not allowed");var o=function(e){return n.eql(e,n.ZERO)};return o(i)&&o(a)?e.ZERO:new e(i,a,n.ONE)}},{key:"normalizeZ",value:function(t){var r=n.invertBatch(t.map((function(e){return e.pz})));return t.map((function(e,t){return e.toAffine(r[t])})).map(e.fromAffine)}},{key:"fromHex",value:function(t){var n=e.fromAffine(i(Q("pointHex",t)));return n.assertValidity(),n}},{key:"fromPrivateKey",value:function(t){return e.BASE.multiply(l(t))}}]),e}();p.BASE=new p(t.Gx,t.Gy,n.ONE),p.ZERO=new p(n.ZERO,n.ONE,n.ZERO);var v=t.nBitLength,m=function(e,t){var n,r=function(e,t){var n=t.negate();return e?n:t},i=function(e){return{windows:Math.ceil(t/e)+1,windowSize:Math.pow(2,e-1)}};return n={constTimeNegate:r,unsafeLadder:function(t,n){for(var r=e.ZERO,i=t;n>Ee;)n&Re&&(r=r.add(i)),i=i.double(),n>>=Re;return r},precomputeWindow:function(e,t){for(var n=i(t),r=n.windows,a=n.windowSize,o=[],s=e,u=s,c=0;c<r;c++){u=s,o.push(u);for(var f=1;f<a;f++)u=u.add(s),o.push(u);s=u.double()}return o}},(0,u.default)(n,"wNAF",(function(t,n,a){for(var o=i(t),s=o.windows,u=o.windowSize,c=e.ZERO,f=e.BASE,d=BigInt(Math.pow(2,t)-1),l=Math.pow(2,t),h=BigInt(t),g=0;g<s;g++){var y=g*u,p=Number(a&d);a>>=h,p>u&&(p-=l,a+=Re);var v=y,m=y+Math.abs(p)-1,_=g%2!=0,b=p<0;0===p?f=f.add(r(_,n[v])):c=c.add(r(b,n[m]))}return{p:c,f:f}})),(0,u.default)(n,"wNAFCached",(function(e,t,n,r){var i=e._WINDOW_SIZE||1,a=t.get(e);return a||(a=this.precomputeWindow(e,i),1!==i&&t.set(e,r(a))),this.wNAF(i,a,n)})),n}(p,t.endo?Math.ceil(v/2):v);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:l,weierstrassEquation:a,isWithinCurveOrder:c}}((0,d.default)((0,f.default)({},t),{toBytes:function(e,t,r){var i=t.toAffine(),a=n.toBytes(i.x),o=X;return r?o(Uint8Array.from([t.hasEvenY()?2:3]),a):o(Uint8Array.from([4]),a,n.toBytes(i.y))},fromBytes:function(e){var t=e.length,r=e[0],o=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===a&&4===r)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};throw Error("Point of length ".concat(t," was invalid. Expected ").concat(i," compressed bytes or ").concat(a," uncompressed bytes"))}var s=Z(o);if(!(Ce<(u=s)&&u<n.ORDER))throw Error("Point is not on curve");var u,c=m(s),f=n.sqrt(c);return!(1&~r)!=((f&Ie)===Ie)&&(f=n.neg(f)),{x:s,y:f}}})),p=h.ProjectivePoint,v=h.normPrivateKeyToScalar,m=h.weierstrassEquation,_=h.isWithinCurveOrder,b=function(e){return M(J(e,t.nByteLength))};function w(e){return e>r>>Ie}var E=function(e,t,n){return Z(e.slice(t,n))},R=function(){"use strict";function e(t,n,r){(0,o.default)(this,e),this.r=t,this.s=n,this.recovery=r,this.assertValidity()}return(0,s.default)(e,[{key:"assertValidity",value:function(){if(!_(this.r))throw Error("r must be 0 < r < CURVE.n");if(!_(this.s))throw Error("s must be 0 < s < CURVE.n")}},{key:"addRecoveryBit",value:function(t){return new e(this.r,this.s,t)}},{key:"recoverPublicKey",value:function(e){var r=this,i=r.r,a=r.s,o=r.recovery,s=T(Q("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw Error("recovery id invalid");var u=2===o||3===o?i+t.n:i;if(u>=n.ORDER)throw Error("recovery id 2 or 3 invalid");var f=1&o?"03":"02",d=p.fromHex(f+b(u)),h=l(u),g=c(-s*h),y=c(a*h),v=p.BASE.multiplyAndAddUnsafe(d,g,y);if(!v)throw Error("point at infinify");return v.assertValidity(),v}},{key:"hasHighS",value:function(){return w(this.s)}},{key:"normalizeS",value:function(){return this.hasHighS()?new e(this.r,c(-this.s),this.recovery):this}},{key:"toDERRawBytes",value:function(){return Y(this.toDERHex())}},{key:"toDERHex",value:function(){return Te.hexFromSig({r:this.r,s:this.s})}},{key:"toCompactRawBytes",value:function(){return Y(this.toCompactHex())}},{key:"toCompactHex",value:function(){return b(this.r)+b(this.s)}}],[{key:"fromCompact",value:function(n){var r=t.nByteLength;return n=Q("compactSignature",n,2*r),new e(E(n,0,r),E(n,r,2*r))}},{key:"fromDER",value:function(t){var n=Te.toSig(Q("DER",t));return new e(n.r,n.s)}}]),e}(),A={isValidPrivateKey:function(e){try{return v(e),!0}catch(e){return!1}},normPrivateKeyToScalar:v,randomPrivateKey:function(){var e=be(t.n);return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.length,i=_e(t),a=be(t);if(r<16||r<a||r>1024)throw Error("expected ".concat(a,"-1024 bytes of input, got ").concat(r));var o=he(n?Z(e):W(e),t-se)+se;return n?G(o,i):J(o,i)}(t.randomBytes(e),t.n)},precompute:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function k(e){var t=H(e),n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===a:n?r===2*i||r===2*a:e instanceof p}var S=t.bits2int||function(e){var n=Z(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},T=t.bits2int_modN||function(e){return c(S(e))},C=$(t.nBitLength);function I(e){if("bigint"!=(void 0===e?"undefined":(0,y.default)(e)))throw Error("bigint expected");if(!(Ce<=e&&e<C))throw Error("bigint expected < 2^"+t.nBitLength);return J(e,t.nByteLength)}function B(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O;if(["recovered","canonical"].some((function(e){return e in i})))throw Error("sign() legacy options not supported");var a=t.hash,o=t.randomBytes,s=i.lowS,u=i.prehash,f=i.extraEntropy;null==s&&(s=!0),e=Q("msgHash",e),u&&(e=Q("prehashed msgHash",a(e)));var d=T(e),h=v(r),y=[I(h),I(d)];if(null!=f){var m=!0===f?o(n.BYTES):f;y.push(Q("extraEntropy",m))}var b=X.apply(void 0,(0,g.default)(y)),E=d;return{seed:b,k2sig:function(e){var t=S(e);if(_(t)){var n=l(t),r=p.BASE.multiply(t).toAffine(),i=c(r.x);if(i!==Ce){var a=c(n*c(E+i*h));if(a!==Ce){var o=(r.x===i?0:2)|Number(r.y&Ie),u=a;return s&&w(a)&&(u=function(e){return w(e)?c(-e):e}(a),o^=1),new R(i,u,o)}}}}}}var N,O={lowS:t.lowS,prehash:!1},x={lowS:t.lowS,prehash:!1};return p.BASE._setWindowSize(8),N={CURVE:t,getPublicKey:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return p.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(k(e))throw Error("first arg must be private key");if(!k(t))throw Error("second arg must be public key");return p.fromHex(t).multiply(v(e)).toRawBytes(n)},sign:function(e,n){var r=B(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:O),i=r.seed,a=r.k2sig,o=t;return ne(o.hash.outputLen,o.nByteLength,o.hmac)(i,a)}},(0,u.default)(N,"verify",(function(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,o=e;if(n=Q("msgHash",n),r=Q("publicKey",r),"strict"in a)throw Error("options.strict was renamed to lowS");var s,u,f=a.lowS,d=a.prehash;try{if("string"==typeof o||H(o))try{s=R.fromDER(o)}catch(e){if(!(e instanceof Te.Err))throw e;s=R.fromCompact(o)}else{if("object"!=typeof o||"bigint"!=(0,y.default)(o.r)||"bigint"!=(0,y.default)(o.s))throw Error("PARSE");var h=o.r,g=o.s;s=new R(h,g)}u=p.fromHex(r)}catch(e){if("PARSE"===e.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(f&&s.hasHighS())return!1;d&&(n=t.hash(n));var v=s.r,m=s.s,_=T(n),b=l(m),w=c(_*b),E=c(v*b),A=null===(i=p.BASE.multiplyAndAddUnsafe(u,w,E))||void 0===i?void 0:i.toAffine();return!!A&&c(A.x)===v})),(0,u.default)(N,"ProjectivePoint",p),(0,u.default)(N,"Signature",R),(0,u.default)(N,"utils",A),N}((0,f.default)({},e,function(e){return{hash:e,hmac:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Oe(e,t,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=0;i<t.length;i++){var a=t[i];if(!R(a))throw Error("Uint8Array expected");r+=a.length}for(var o=new Uint8Array(r),s=0,u=0;s<t.length;s++){var c=t[s];o.set(c,u),u+=c.length}return o}.apply(this,(0,g.default)(r)))},randomBytes:C}}(t)))};return Object.freeze((0,d.default)((0,f.default)({},n(t)),{create:n}))}({a:BigInt(0),b:BigInt(7),Fp:He,n:De,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:function(e){var t=De,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Le*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=n,o=BigInt("0x100000000000000000000000000000000"),s=qe(a*e,t),u=qe(-r*e,t),c=he(e-s*n-u*i,t),f=he(-s*r-u*a,t),d=c>o,l=f>o;if(d&&(c=t-c),l&&(f=t-f),c>o||f>o)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:c,k2neg:l,k2:f}}}},L),Me=BigInt(0),je=function(e){return"bigint"==(void 0===e?"undefined":(0,y.default)(e))&&Me<e&&e<xe},ze=function(e){return"bigint"==(void 0===e?"undefined":(0,y.default)(e))&&Me<e&&e<De},Ve={};function Ke(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=Ve[e];if(void 0===i){var a=L(Uint8Array.from(e,(function(e){return e.charCodeAt(0)})));i=X(a,a),Ve[e]=i}return L(X.apply(void 0,[i].concat((0,g.default)(n))))}var Ye=function(e){return e.toRawBytes(!0).slice(1)},Ze=function(e){return J(e,32)},We=function(e){return he(e,xe)},Je=function(e){return he(e,De)},Ge=Fe.ProjectivePoint,Qe=function(e,t,n){return Ge.BASE.multiplyAndAddUnsafe(e,t,n)};function Xe(e){var t=Fe.utils.normPrivateKeyToScalar(e),n=Ge.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Je(-t),bytes:Ye(n)}}function $e(e){if(!je(e))throw Error("bad x: need 0 < x < p");var t=We(e*e),n=Ue(We(t*e+BigInt(7)));n%Pe!==Me&&(n=We(-n));var r=new Ge(e,n,Le);return r.assertValidity(),r}function et(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Je(Z(Ke.apply(void 0,["BIP0340/challenge"].concat((0,g.default)(t)))))}function tt(e,t,n){var r=Q("signature",e,64),i=Q("message",t),a=Q("publicKey",n,32);try{var o=$e(Z(a)),s=Z(r.subarray(0,32));if(!je(s))return!1;var u=Z(r.subarray(32,64));if(!ze(u))return!1;var c=et(Ze(s),Ye(o),i),f=Qe(o,u,Je(-c));return!(!f||!f.hasEvenY()||f.toAffine().x!==s)}catch(e){return!1}}var nt={getPublicKey:function(e){return Xe(e).bytes},sign:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C(32),r=Q("message",e),i=Xe(t),a=i.bytes,o=i.scalar,s=Q("auxRand",n,32),u=Ze(o^Z(Ke("BIP0340/aux",s))),c=Ke("BIP0340/nonce",u,a,r),f=Je(Z(c));if(f===Me)throw Error("sign failed: k is zero");var d=Xe(f),l=d.bytes,h=d.scalar,g=et(l,a,r),y=new Uint8Array(64);if(y.set(l,0),y.set(Ze(Je(h+g*o)),32),!tt(y,r,a))throw Error("sign: Invalid signature produced");return y},verify:tt,utils:{randomPrivateKey:Fe.utils.randomPrivateKey,lift_x:$e,pointToBytes:Ye,numberToBytesBE:J,bytesToNumberBE:Z,taggedHash:Ke,mod:he}};function rt(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=256*Math.random()|0;return t}function it(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}function at(e,t){return Object.defineProperty(e,"code",{value:t,enumerable:!0,configurable:!0}),e}function ot(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var st=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this;if((0,o.default)(this,e),this._map=new Map,this._id=rt(4).toString("hex").slice(0,7),this._doDebug=t.debug,this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||rt(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||e.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},e.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||function(e){return e},this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=void 0===t.trickle||t.trickle,this.allowHalfTrickle=void 0!==t.allowHalfTrickle&&t.allowHalfTrickle,this.iceCompleteTimeout=t.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&"object"==typeof t.wrtc?t.wrtc:it(),!this._wrtc)throw"undefined"==typeof window?at(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):at(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void this.destroy(at(e,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=function(){n._onIceStateChange()},this._pc.onicegatheringstatechange=function(){n._onIceStateChange()},this._pc.onconnectionstatechange=function(){n._onConnectionStateChange()},this._pc.onsignalingstatechange=function(){n._onSignalingStateChange()},this._pc.onicecandidate=function(e){n._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((function(e){n.destroy(at(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=function(e){n._setupData(e)},this.streams&&this.streams.forEach((function(e){n.addStream(e)})),this._pc.ontrack=function(e){n._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation()}return(0,s.default)(e,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw at(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.destroy(at(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(at(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch((function(e){!n.address||n.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):t.destroy(at(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this.destroying){if(this.destroyed)throw at(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"addTransceiver",value:function(e,t){if(!this.destroying){if(this.destroyed)throw at(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(at(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw at(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(n){t.addTrack(n,e)}))}}},{key:"addTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw at(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var n=this._senderMap.get(e)||new Map,r=n.get(t);if(r)throw r.removed?at(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):at(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,n){if(!this.destroying){if(this.destroyed)throw at(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw at(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(at(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw at(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw at(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(at(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw at(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(n){t.removeTrack(n,e)}))}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this.destroying){if(this.destroyed)throw at(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"destroy",value:function(e){var t=this;this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask((function(){if(t.destroyed=!0,t.destroying=!1,t._debug("destroy (error: %s)",e&&(e.message||e)),t._connected=!1,t._pcReady=!1,t._channelReady=!1,t._remoteTracks=null,t._remoteStreams=null,t._senderMap=null,clearInterval(t._closingInterval),t._closingInterval=null,clearInterval(t._interval),t._interval=null,t._chunk=null,t._cb=null,t._channel){try{t._channel.close()}catch(e){}t._channel.onmessage=null,t._channel.onopen=null,t._channel.onclose=null,t._channel.onerror=null}if(t._pc){try{t._pc.close()}catch(e){}t._pc.oniceconnectionstatechange=null,t._pc.onicegatheringstatechange=null,t._pc.onsignalingstatechange=null,t._pc.onicecandidate=null,t._pc.ontrack=null,t._pc.ondatachannel=null}t._pc=null,t._channel=null,e&&t.emit("error",e),t.emit("close")})))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.destroy(at(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){t.destroy(at(e,"ERR_DATA_CHANNEL"))};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=ot(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(at(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(at(t,"ERR_CREATE_OFFER"))}))}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=ot(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(at(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(at(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(at(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(at(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(at(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"==={}.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e.getStats((function(n,r){if(!e.destroyed){n&&(r=[]);var i={},a={},o={},s=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(o[e.id]=e)}));var u=function(t){s=!0;var n=a[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)})),s||Object.keys(o).length&&!Object.keys(a).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(at(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))};t()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.emit("data",t)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.destroy())}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some((function(e){return e.id===n.id}))||(t._remoteStreams.push(n),queueMicrotask((function(){t._debug("on stream"),t.emit("stream",n)})))}))}},{key:"_debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._doDebug&&(t[0]="["+this._id+"] "+t[0])}},{key:"on",value:function(e,t){var n=this._map;n.has(e)||n.set(e,new Set),n.get(e).add(t)}},{key:"off",value:function(e,t){var n=this._map,r=n.get(e);r&&(r.delete(t),0===r.size&&n.delete(e))}},{key:"once",value:function(e,t){var n=this,r=function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];n.off(e,r),t.apply(void 0,(0,g.default)(a))};this.on(e,r)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this._map,a=!0,o=!1,s=void 0;if(i.has(e))try{for(var u,c=i.get(e)[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var f=u.value;try{f.apply(void 0,(0,g.default)(n))}catch(e){console.error(e)}}}catch(e){o=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}}]),e}();st.WEBRTC_SUPPORT=!!it(),st.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},st.channelConfig={};var ut,ct,ft=function(e,t,n){var r=new st({initiator:e,trickle:t,config:n}),i=function(e){return r.__earlyDataBuffer.push(e)};return r.on(Rt.data,i),r.__earlyDataBuffer=[],r.__drainEarlyData=function(e){r.off(Rt.data,i),r.__earlyDataBuffer.forEach(e),delete r.__earlyDataBuffer,delete r.__drainEarlyData},r},dt=function(e){return Array(e).fill().map((function(){return"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Math.floor(62*Math.random())]})).join("")},lt="Trystero",ht=dt(20),gt=Object.keys,yt=Object.values,pt=Object.entries,vt=Object.fromEntries,mt=function(){},_t=function(e){return Error("".concat(lt,": ").concat(e))},bt=function(e){return(new TextEncoder).encode(e)},wt=function(e){return(new TextDecoder).decode(e)},Et=function(e){return e.reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"")},Rt=vt(["close","connect","data","error","signal","stream","track"].map((function(e){return[e,e]}))),At=Object.getPrototypeOf(Uint8Array),kt=16369,St=255,Tt="bufferedamountlow",Ct="AES-CBC",It=(ct=(0,a.default)((function(e,t){var n,r,i,a,o,s,u;return(0,m.__generator)(this,(function(c){switch(c.label){case 0:return n=crypto.getRandomValues(new Uint8Array(16)),i=JSON.stringify,a={},s=(o=crypto.subtle).encrypt,u=[{name:Ct,iv:n}],[4,e];case 1:return[4,s.apply(o,u.concat([c.sent(),bt(t)]))];case 2:return[2,i.apply(JSON,[(a.c=(r=c.sent(),btoa(String.fromCharCode.apply(null,new Uint8Array(r)))),a.iv=(0,g.default)(n),a)])]}}))})),function(e,t){return ct.apply(this,arguments)}),Bt=function(){var e=(0,a.default)((function(e,t){var n,r,i,a,o,s;return(0,m.__generator)(this,(function(u){switch(u.label){case 0:return n=JSON.parse(t),r=n.c,i=n.iv,o=(a=crypto.subtle).decrypt,s=[{name:Ct,iv:new Uint8Array(i)}],[4,e];case 1:return[4,o.apply(a,s.concat([u.sent(),function(e){var t=atob(e);return new Uint8Array(t.length).map((function(e,n){return t.charCodeAt(n)})).buffer}(r)]))];case 2:return[2,wt.apply(void 0,[u.sent()])]}}))}));return function(t,n){return e.apply(this,arguments)}}(),Nt={},Ot=Et(crypto.getRandomValues(new Uint8Array(32))),xt=Et(nt.getPublicKey(Ot)),Dt={},Lt=function(){return Math.floor(Date.now()/1e3)},Pt=["wss://relay.nostr.net","wss://relay.blackbyte.nl","wss://relay.piazza.today","wss://relay.exit.pub","wss://relay.nostr.band","wss://relay.damus.io","wss://nostr.mom","wss://relay.snort.social","wss://nostr.lu.ke","wss://relay.plebstr.com","wss://nostr.sathoarder.com","wss://nsrelay.assilvestrar.club","wss://nostrasia.casa","wss://relay.nostr.bg","wss://relay.nostrr.de","wss://relay.nostrss.re"],qt=(ut=Nt,function(e,t){if(ut[t])return ut[t];if(!e)throw _t("requires a config map as the first argument");if(!e.appId&&!e.firebaseApp)throw _t("config map is missing appId field");if(!t)throw _t("namespace argument required");return ut[t]=function(e,t){var n=e.password&&function(){var e=(0,a.default)((function(e,t){var n,r,i;return(0,m.__generator)(this,(function(a){switch(a.label){case 0:return r=(n=crypto.subtle).importKey,i=["raw"],[4,crypto.subtle.digest({name:"SHA-256"},bt("".concat(e,":").concat(t)))];case 1:return[2,r.apply(n,i.concat([a.sent(),{name:Ct},!1,["encrypt","decrypt"]]))]}}))}));return function(t,n){return e.apply(this,arguments)}}()(e.password,t),r="trystero/".concat(e.appId,"/").concat(t),i="".concat(r,"/").concat(ht),o=dt(64),s=dt(64),u={},c={},l={},g=function(e,t,n){return(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||4)}(e,Pt),y=function(e,t){w(e,t),l[t]=e},p=function(e){delete u[e],delete c[e],delete l[e]},v=function(e,t){return JSON.stringify(["REQ",e,{kinds:[29333],since:Lt(),"#x":[t]}])},_=function(e){return JSON.stringify(["CLOSE",e])},b=function(){var e=(0,a.default)((function(e,t){var n,r,i,a,o,s,u;return(0,m.__generator)(this,(function(c){switch(c.label){case 0:return n={kind:29333,content:JSON.stringify(t),pubkey:xt,created_at:Lt(),tags:[["x",e]]},i=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",bt(JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content])))];case 1:return r=Et.apply(void 0,[new(i.apply(Uint8Array,[void 0,c.sent()]))]),a=JSON.stringify,o=["EVENT"],s=[(0,f.default)({},n)],u={id:r},[4,nt.sign(r,Ot)];case 2:return[2,a.apply(JSON,[o.concat([d.default.apply(void 0,s.concat([(u.sig=Et.apply(void 0,[c.sent()]),u)]))])])]}}))}));return function(t,n){return e.apply(this,arguments)}}(),w=mt;return g.forEach((function(t){var g=new WebSocket(t);Dt[t]=g,g.addEventListener("open",(0,a.default)((function(){var e;return(0,m.__generator)(this,(function(t){switch(t.label){case 0:return g.send(v(o,r)),g.send(v(s,i)),e=g.send,[4,b(r,ht)];case 1:return e.apply(g,[t.sent()]),[2]}}))}))),g.addEventListener("message",function(){var t=(0,a.default)((function(t){var i,v,_,w,E,R,A,k,S,T,C,I,B,N,O,x,D;return(0,m.__generator)(this,(function(L){switch(L.label){case 0:return i=(0,h.default)(JSON.parse(t.data),4),v=i[0],_=i[1],w=i[2],E=i[3],"EVENT"!==v?[2,void("OK"!==v||w||console.warn("".concat(lt,": relay failure from ").concat(g.url," - ").concat(E)))]:(R=JSON.parse(w.content),_!==o?[3,1]:((A=R)===ht||l[A]||c[A]||(c[A]=!0,(k=u[A]=ft(!0,!1,e.rtcConfig)).once(Rt.signal,function(){var e=(0,a.default)((function(e){var t,i,a,o,s,u;return(0,m.__generator)(this,(function(c){switch(c.label){case 0:return t=g.send,i=["".concat(r,"/").concat(A)],a={peerId:ht},n?(s=[(0,f.default)({},e)],u={},[4,It(n,e.sdp)]):[3,2];case 1:return o=d.default.apply(void 0,s.concat([(u.sdp=c.sent(),u)])),[3,3];case 2:o=e,c.label=3;case 3:return[4,b.apply(void 0,i.concat([(a.offer=o,a)]))];case 4:return t.apply(g,[c.sent()]),[2]}}))}));return function(t){return e.apply(this,arguments)}}()),k.once(Rt.connect,(function(){return y(k,A)})),k.once(Rt.close,(function(){return p(A)}))),[3,6]));case 1:return _!==s?[3,6]:(S=R.peerId,T=R.offer,C=R.answer,u[S]&&C?(B=(I=u[S]).signal,n?(O=[(0,f.default)({},C)],x={},[4,Bt(n,C.sdp)]):[3,3]):[3,5]);case 2:return N=d.default.apply(void 0,O.concat([(x.sdp=L.sent(),x)])),[3,4];case 3:N=C,L.label=4;case 4:return[2,void B.apply(I,[N])];case 5:if(!T)return[2];(D=ft(!1,!1,e.rtcConfig)).once(Rt.signal,function(){var e=(0,a.default)((function(e){var t,i,a,o,s,u;return(0,m.__generator)(this,(function(c){switch(c.label){case 0:return t=g.send,i=["".concat(r,"/").concat(S)],a={peerId:ht},n?(s=[(0,f.default)({},e)],u={},[4,It(n,e.sdp)]):[3,2];case 1:return o=d.default.apply(void 0,s.concat([(u.sdp=c.sent(),u)])),[3,3];case 2:o=e,c.label=3;case 3:return[4,b.apply(void 0,i.concat([(a.answer=o,a)]))];case 4:return[2,t.apply(g,[c.sent()])]}}))}));return function(t){return e.apply(this,arguments)}}()),D.once(Rt.connect,(function(){return y(D,S)})),D.once(Rt.close,(function(){return p(S)})),D.signal(T),L.label=6;case 6:return[2]}}))}));return function(e){return t.apply(this,arguments)}}())})),function(e,t){var n={},r={},i={},o={},s={},u={},c=function(e,t){return(e?Array.isArray(e)?e:[e]:gt(n)).flatMap((function(e){var r=n[e];return r?t(e,r):(console.warn("".concat(lt,": no peer with id ").concat(e," found")),[])}))},l=function(e){if(r[e])return[r[e].send,r[e].setOnComplete,r[e].setOnProgress];if(!e)throw _t("action type argument is required");var t=bt(e);if(t.byteLength>12)throw _t('action type string "'.concat(e,'" (').concat(t.byteLength,"b) exceeds byte limit (12). Hint: choose a shorter name."));var i=new Uint8Array(12);i.set(t);var o=0;return r[e]={onComplete:mt,onProgress:mt,setOnComplete:function(t){return r[e]=(0,d.default)((0,f.default)({},r[e]),{onComplete:t})},setOnProgress:function(t){return r[e]=(0,d.default)((0,f.default)({},r[e]),{onProgress:t})},send:function(e,t,r,s){return(0,a.default)((function(){var u,f,d,l,h,g,y,p,v,_;return(0,m.__generator)(this,(function(b){switch(b.label){case 0:if(r&&"object"!=typeof r)throw _t("action meta argument must be an object");if(void 0===e)throw _t("action data cannot be undefined");if(u="string"!=typeof e,f=e instanceof Blob,d=f||e instanceof ArrayBuffer||e instanceof At,r&&!d)throw _t("action meta argument can only be used with binary data");return d?(v=Uint8Array.bind,f?[4,e.arrayBuffer()]:[3,2]):[3,4];case 1:return _=b.sent(),[3,3];case 2:_=e,b.label=3;case 3:return p=new(v.apply(Uint8Array,[void 0,_])),[3,5];case 4:p=bt(u?JSON.stringify(e):e),b.label=5;case 5:return l=p,h=r?bt(JSON.stringify(r)):null,g=Math.ceil(l.byteLength/kt)+(r?1:0)||1,y=Array(g).fill().map((function(e,t){var n=t===g-1,a=r&&0===t,s=new Uint8Array(15+(a?h.byteLength:n?l.byteLength-kt*(g-(r?2:1)):kt));return s.set(i),s.set([o],12),s.set([n|a<<1|d<<2|u<<3],13),s.set([Math.round((t+1)/g*St)],14),s.set(r?a?h:l.subarray((t-1)*kt,t*kt):l.subarray(t*kt,(t+1)*kt),15),s})),[2,(o=o+1&St,Promise.all(c(t,(w=(0,a.default)((function(e,t){var i,a,o;return(0,m.__generator)(this,(function(u){switch(u.label){case 0:i=t._channel,a=0,u.label=1;case 1:return a<g?(o=y[a],i.bufferedAmount>i.bufferedAmountLowThreshold?[4,new Promise((function(e){var t=function(){i.removeEventListener(Tt,t),e()};i.addEventListener(Tt,t)}))]:[3,3]):[3,5];case 2:u.sent(),u.label=3;case 3:if(!n[e])return[3,5];t.send(o),a++,s&&s(o[14]/St,e,r),u.label=4;case 4:return[3,1];case 5:return[2]}}))})),function(e,t){return w.apply(this,arguments)}))))]}var w}))}))()}},[r[e].send,r[e].setOnComplete,r[e].setOnProgress]},g=function(e,t){var n=new Uint8Array(t),a=wt(n.subarray(0,12)).replaceAll("\0",""),o=(0,h.default)(n.subarray(12,13),1)[0],s=(0,h.default)(n.subarray(13,14),1)[0],u=(0,h.default)(n.subarray(14,15),1)[0],c=n.subarray(15),f=!!(1&s),d=!!(2&s),l=!!(4&s),g=!!(8&s);if(!r[a])throw _t("received message with unregistered type (".concat(a,")"));i[e]||(i[e]={}),i[e][a]||(i[e][a]={});var y=i[e][a][o];if(y||(y=i[e][a][o]={chunks:[]}),d?y.meta=JSON.parse(wt(c)):y.chunks.push(c),r[a].onProgress(u/St,e,y.meta),f){var p=new Uint8Array(y.chunks.reduce((function(e,t){return e+t.byteLength}),0));if(y.chunks.reduce((function(e,t){return p.set(t,e),e+t.byteLength}),0),l)r[a].onComplete(p,e,y.meta);else{var v=wt(p);r[a].onComplete(g?JSON.parse(v):v,e)}delete i[e][a][o]}},y=(0,h.default)(l("__91n6__"),2),p=y[0],v=y[1],_=(0,h.default)(l("__90n6__"),2),b=_[0],w=_[1],E=(0,h.default)(l("__516n4L__"),2),R=E[0],A=E[1],k=(0,h.default)(l("__57r34m__"),2),S=k[0],T=k[1],C=(0,h.default)(l("__7r4ck__"),2),I=C[0],B=C[1],N=mt,O=mt,x=mt,D=mt;return e((function(e,t){if(!n[t]){var r=g.bind(null,t);n[t]=e,e.on(Rt.signal,(function(e){return R(e,t)})),e.on(Rt.close,(function(){return function(e){n[e]&&(delete n[e],delete i[e],delete o[e],O(e))}(t)})),e.on(Rt.data,r),e.on(Rt.stream,(function(e){x(e,t,s[t]),delete s[t]})),e.on(Rt.track,(function(e,n){D(e,n,t,u[t]),delete u[t]})),e.on(Rt.error,(function(e){"ERR_DATA_CHANNEL"!==e.code&&console.error(e)})),N(t),e.__drainEarlyData(r)}})),v((function(e,t){return b("",t)})),w((function(e,t){o[t]&&(o[t](),delete o[t])})),A((function(e,t){n[t]&&n[t].signal(e)})),T((function(e,t){return s[t]=e})),B((function(e,t){return u[t]=e})),{makeAction:l,ping:function(e){return(0,a.default)((function(){var t;return(0,m.__generator)(this,(function(n){switch(n.label){case 0:if(!e)throw _t("ping() must be called with target peer ID");return t=Date.now(),p("",e),[4,new Promise((function(t){return o[e]=t}))];case 1:return[2,(n.sent(),Date.now()-t)]}}))}))()},leave:function(){pt(n).forEach((function(e){var t=(0,h.default)(e,2),r=t[0];t[1].destroy(),delete n[r]})),t()},getPeers:function(){return vt(pt(n).map((function(e){var t=(0,h.default)(e,2);return[t[0],t[1]._pc]})))},addStream:function(e,t,n){return c(t,(r=(0,a.default)((function(t,r){return(0,m.__generator)(this,(function(i){switch(i.label){case 0:return n?[4,S(n,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r.addStream(e),[2]}}))})),function(e,t){return r.apply(this,arguments)}));var r},removeStream:function(e,t){return c(t,(function(t,n){return n.removeStream(e)}))},addTrack:function(e,t,n,r){return c(n,(i=(0,a.default)((function(n,i){return(0,m.__generator)(this,(function(a){switch(a.label){case 0:return r?[4,I(r,n)]:[3,2];case 1:a.sent(),a.label=2;case 2:return i.addTrack(e,t),[2]}}))})),function(e,t){return i.apply(this,arguments)}));var i},removeTrack:function(e,t,n){return c(n,(function(n,r){return r.removeTrack(e,t)}))},replaceTrack:function(e,t,n,r,i){return c(r,(o=(0,a.default)((function(r,a){return(0,m.__generator)(this,(function(o){switch(o.label){case 0:return i?[4,I(i,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return a.replaceTrack(e,t,n),[2]}}))})),function(e,t){return o.apply(this,arguments)}));var o},onPeerJoin:function(e){return N=e},onPeerLeave:function(e){return O=e},onPeerStream:function(e){return x=e},onPeerTrack:function(e){return D=e}}}((function(e){return w=e}),(function(){delete Nt[t],yt(Dt).forEach((function(e){e.send(_(o)),e.send(_(s))}))}))}(e,t)})}))}();
