var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("hsMrW",(function(r,n){var t,a;t=r.exports,a=function(){return Te},Object.defineProperty(t,"joinRoom",{get:a,set:undefined,enumerable:!0,configurable:!0});var o,s,i,l,c,d,u,f,y,p,m,w,v,g,h,b,k,P,T,A,S=e("dM3DM"),L=e("aQXMn");const{floor:D,random:I}=Math,$="Trystero",E=(e,r)=>Array(e).fill().map(r),C=e=>E(e,(()=>"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[D(62*I())])).join(""),U=C(20),_=Promise.all.bind(Promise),j="undefined"!=typeof window,{entries:O,fromEntries:M,keys:R}=Object,H=()=>{},J=e=>Error(`${$}: ${e}`),x=new TextEncoder,q=new TextDecoder,B=e=>x.encode(e),G=e=>q.decode(e),N=(...e)=>e.join("@"),W=JSON.stringify,z=JSON.parse,K={};let Q=null,V=null;const X=()=>{Q||(Q=new Promise((e=>{V=e})).finally((()=>{V=null,Q=null})))},F=()=>null==V?void 0:V(),Y="AES-GCM",Z={},ee=async e=>(o=Z)[s=e]||(o[s]=Array.from(await(async(e,r)=>new Uint8Array(await crypto.subtle.digest("SHA-1",B(r))))(0,e)).map((e=>e.toString(36))).join("")),re=async(e,r)=>{const n=crypto.getRandomValues(new Uint8Array(16));var t;return n.join(",")+"$"+(t=await crypto.subtle.encrypt({name:Y,iv:n},await e,B(r)),btoa(String.fromCharCode.apply(null,new Uint8Array(t))))},ne=async(e,r)=>{const[n,t]=r.split("$");return G(await crypto.subtle.decrypt({name:Y,iv:new Uint8Array(n.split(","))},await e,(e=>{const r=atob(e);return new Uint8Array(r.length).map(((e,n)=>r.charCodeAt(n))).buffer})(t)))},te="icegatheringstatechange",ae="offer";var oe=(e,{rtcConfig:r,rtcPolyfill:n,turnConfig:t})=>{const a=new(n||RTCPeerConnection)((0,S.default)({iceServers:se.concat(t||[])},r)),o={};let s=!1,i=!1,l=null;const c=e=>{e.binaryType="arraybuffer",e.bufferedAmountLowThreshold=65535,e.onmessage=e=>{var r;return null===(r=o.data)||void 0===r?void 0:r.call(o,e.data)},e.onopen=()=>{var e;return null===(e=o.connect)||void 0===e?void 0:e.call(o)},e.onclose=()=>{var e;return null===(e=o.close)||void 0===e?void 0:e.call(o)},e.onerror=e=>{var r;return null===(r=o.error)||void 0===r?void 0:r.call(o,e)}},d=e=>Promise.race([new Promise((r=>{const n=()=>{"complete"===e.iceGatheringState&&(e.removeEventListener(te,n),r())};e.addEventListener(te,n),n()})),new Promise((e=>setTimeout(e,5e3)))]).then((()=>({type:e.localDescription.type,sdp:e.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")})));return e?(l=a.createDataChannel("data"),c(l)):a.ondatachannel=({channel:e})=>{l=e,c(e)},a.onnegotiationneeded=async()=>{try{var e;s=!0,await a.setLocalDescription();const r=await d(a);null===(e=o.signal)||void 0===e||e.call(o,r)}catch(e){var r;null===(r=o.error)||void 0===r||r.call(o,e)}finally{s=!1}},a.onconnectionstatechange=()=>{var e;["disconnected","failed","closed"].includes(a.connectionState)&&(null===(e=o.close)||void 0===e||e.call(o))},a.ontrack=e=>{var r,n;null===(r=o.track)||void 0===r||r.call(o,e.track,e.streams[0]),null===(n=o.stream)||void 0===n||n.call(o,e.streams[0])},a.onremovestream=e=>{var r;return null===(r=o.stream)||void 0===r?void 0:r.call(o,e.stream)},e&&(a.canTrickleIceCandidates||a.onnegotiationneeded()),{created:Date.now(),connection:a,get channel(){return l},get isDead(){return"closed"===a.connectionState},async signal(r){var n;if("open"!==(null==l?void 0:l.readyState)||(null===(n=r.sdp)||void 0===n?void 0:n.includes("a=rtpmap")))try{if(r.type===ae){var t;if(s||"stable"!==a.signalingState&&!i){if(e)return;await _([a.setLocalDescription({type:"rollback"}),a.setRemoteDescription(r)])}else await a.setRemoteDescription(r);await a.setLocalDescription();const n=await d(a);return null===(t=o.signal)||void 0===t||t.call(o,n),n}if("answer"===r.type){i=!0;try{await a.setRemoteDescription(r)}finally{i=!1}}}catch(e){var c;null===(c=o.error)||void 0===c||c.call(o,e)}},sendData:e=>l.send(e),destroy(){null==l||l.close(),a.close(),s=!1,i=!1},setHandlers:e=>Object.assign(o,e),offerPromise:e?new Promise((e=>o.signal=r=>{r.type===ae&&e(r)})):Promise.resolve(),addStream:e=>e.getTracks().forEach((r=>a.addTrack(r,e))),removeStream:e=>a.getSenders().filter((r=>e.getTracks().includes(r.track))).forEach((e=>a.removeTrack(e))),addTrack:(e,r)=>a.addTrack(e,r),removeTrack(e){const r=a.getSenders().find((r=>r.track===e));r&&a.removeTrack(r)},replaceTrack(e,r){const n=a.getSenders().find((r=>r.track===e));if(n)return n.replaceTrack(r)}}};const se=[...E(3,((e,r)=>`stun:stun${r||""}.l.google.com:19302`)),"stun:stun.cloudflare.com:3478"].map((e=>({urls:e}))),ie=Object.getPrototypeOf(Uint8Array),le=16369,ce=255,de="bufferedamountlow",ue=e=>"@_"+e,fe={},ye={},pe={},me={},we={},ve={},ge={},he={},be=async e=>{if(ye[e])return ye[e];const r=(await ee(e)).slice(0,20);return ye[e]=r,pe[r]=e,r},ke=async(e,r,n)=>e.send(W((0,S.default)({action:"announce",info_hash:await be(r),peer_id:U},n))),Pe=(e,r,n)=>console.warn(`${$}: torrent tracker ${n?"failure":"warning"} from ${e} - ${r}`),Te=(({init:e,subscribe:r,announce:n})=>{const t={};let a,o,s,h,b=!1;return(k,P,T)=>{var A;const{appId:D}=k;if(null===(A=t[D])||void 0===A?void 0:A[P])return t[D][P];const I={},C={},x=N($,D,P),q=ee(x),K=ee(N(x,U)),Q=(async(e,r,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},B(`${e}:${r}:${n}`)),{name:Y},!1,["encrypt","decrypt"]))(k.password||"",D,P),V=e=>async r=>({type:r.type,sdp:await e(Q,r.sdp)}),Z=V(ne),te=V(re),ae=()=>oe(!0,k),se=(e,r,n)=>{var t;C[r]?C[r]!==e&&e.destroy():(C[r]=e,ge(e,r),null===(t=I[r])||void 0===t||t.forEach(((e,r)=>{r!==n&&e.destroy()})),delete I[r])},fe=(e,r)=>{C[r]===e&&delete C[r]},ye=e=>(o.push(...E(e,ae)),_(o.splice(0,e).map((e=>e.offerPromise.then(te).then((r=>({peer:e,offer:r}))))))),pe=(e,r)=>null==T?void 0:T({error:`incorrect password (${k.password}) when decrypting ${r}`,appId:D,peerId:e,roomId:P});if(!k)throw J("requires a config map as the first argument");if(!D&&!k.firebaseApp)throw J("config map is missing appId field");if(!P)throw J("roomId argument required");if(!b){const r=e(k);o=E(20,ae),a=Array.isArray(r)?r:[r],b=!0,s=setInterval((()=>o=o.filter((e=>{const r=Date.now()-e.created<57333;return r||e.destroy(),r}))),59052.99),h=k.manualRelayReconnection?H:(()=>{if(j){const e=new AbortController;return addEventListener("online",F,{signal:e.signal}),addEventListener("offline",X,{signal:e.signal}),()=>e.abort()}return H})()}const me=a.map((()=>5333)),we=[],ve=a.map((async(e,n)=>r(await e,await q,await K,(e=>async(r,n,t)=>{const[a,o]=await _([q,K]);if(r!==a&&r!==o)return;const{peerId:s,offer:i,answer:l,peer:c}="string"==typeof n?z(n):n;if(s!==U&&!C[s])if(!s||i||l){if(i){var d;if((null===(d=I[s])||void 0===d?void 0:d[e])&&U>s)return;const r=oe(!1,k);let n;r.setHandlers({connect:()=>se(r,s,e),close:()=>fe(r,s)});try{n=await Z(i)}catch(e){return void pe(s,"offer")}if(r.isDead)return;const[a,o]=await _([ee(N(x,s)),r.signal(n)]);t(a,W({peerId:U,answer:await te(o)}))}else if(l){let r;try{r=await Z(l)}catch(e){return void pe(s,"answer")}if(c)c.setHandlers({connect:()=>se(c,s,e),close:()=>fe(c,s)}),c.signal(r);else{var u;const n=null===(u=I[s])||void 0===u?void 0:u[e];n&&!n.isDead&&n.signal(r)}}}else{var f;if(null===(f=I[s])||void 0===f?void 0:f[e])return;const[[{peer:r,offer:n}],a]=await _([ye(1),ee(N(x,s))]);(m=I)[w=s]||(m[w]=[]),I[s][e]=r,setTimeout((()=>((e,r)=>{var n;if(C[e])return;const t=null===(n=I[e])||void 0===n?void 0:n[r];t&&(delete I[e][r],t.destroy())})(s,e)),.9*me[e]),r.setHandlers({connect:()=>se(r,s,e),close:()=>fe(r,s)}),t(a,W({peerId:U,offer:n}))}})(n),ye)));_([q,K]).then((([e,r])=>{const t=async(a,o)=>{const s=await n(a,e,r);"number"==typeof s&&(me[o]=s),we[o]=setTimeout((()=>t(a,o)),me[o])};ve.forEach((async(e,r)=>{await e,t(await a[r],r)}))}));let ge=H;return(v=t)[g=D]||(v[g]={}),t[D][P]=((e,r,n)=>{const t={},a={},o={},s={},m={},w={},v={},g={onPeerJoin:H,onPeerLeave:H,onPeerStream:H,onPeerTrack:H},h=(e,r)=>(e?Array.isArray(e)?e:[e]:R(t)).flatMap((e=>{const n=t[e];return n?r(e,n):(console.warn(`${$}: no peer with id ${e} found`),[])})),b=e=>{t[e]&&(t[e].destroy(),delete t[e],delete s[e],delete m[e],g.onPeerLeave(e),r(e))},k=e=>{if(a[e])return o[e];if(!e)throw J("action type argument is required");const r=B(e);if(r.byteLength>12)throw J(`action type string "${e}" (${r.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const n=new Uint8Array(12);n.set(r);let s=0;return a[e]={onComplete:H,onProgress:H,setOnComplete:r=>a[e]=(0,L.default)((0,S.default)({},a[e]),{onComplete:r}),setOnProgress:r=>a[e]=(0,L.default)((0,S.default)({},a[e]),{onProgress:r}),async send(e,r,a,o){if(a&&"object"!=typeof a)throw J("action meta argument must be an object");const i=typeof e;if("undefined"===i)throw J("action data cannot be undefined");const l="string"!==i,c=e instanceof Blob,d=c||e instanceof ArrayBuffer||e instanceof ie;if(a&&!d)throw J("action meta argument can only be used with binary data");const u=d?new Uint8Array(c?await e.arrayBuffer():e):B(l?W(e):e),f=a?B(W(a)):null,y=Math.ceil(u.byteLength/le)+(a?1:0)||1,p=E(y,((e,r)=>{const t=r===y-1,o=a&&0===r,i=new Uint8Array(15+(o?f.byteLength:t?u.byteLength-le*(y-(a?2:1)):le));return i.set(n),i.set([s],12),i.set([t|o<<1|d<<2|l<<3],13),i.set([Math.round((r+1)/y*ce)],14),i.set(a?o?f:u.subarray((r-1)*le,r*le):u.subarray(r*le,(r+1)*le),15),i}));return s=s+1&ce,_(h(r,(async(e,r)=>{const{channel:n}=r;let s=0;for(;s<y;){const i=p[s];if(n.bufferedAmount>n.bufferedAmountLowThreshold&&await new Promise((e=>{const r=()=>{n.removeEventListener(de,r),e()};n.addEventListener(de,r)})),!t[e])break;r.sendData(i),s++,null==o||o(i[14]/ce,e,a)}})))}},(i=o)[l=e]||(i[l]=[a[e].send,a[e].setOnComplete,a[e].setOnProgress])},P=async()=>{await Q(""),await new Promise((e=>setTimeout(e,99))),O(t).forEach((([e,r])=>{r.destroy(),delete t[e]})),n()},[T,A]=k(ue("ping")),[D,I]=k(ue("pong")),[C,U]=k(ue("signal")),[x,q]=k(ue("stream")),[N,K]=k(ue("track")),[Q,V]=k(ue("leave"));return(e=>{ge=e})(((e,r)=>{t[r]||(t[r]=e,e.setHandlers({data:e=>((e,r)=>{const n=new Uint8Array(r),t=G(n.subarray(0,12)).replaceAll("\0",""),[o]=n.subarray(12,13),[i]=n.subarray(13,14),[l]=n.subarray(14,15),m=n.subarray(15),w=!!(1&i),v=!!(2&i),g=!!(4&i),h=!!(8&i);if(!a[t])return void console.warn(`${$}: received message with unregistered type (${t})`);(c=s)[d=e]||(c[d]={}),(u=s[e])[f=t]||(u[f]={});const b=(y=s[e][t])[p=o]||(y[p]={chunks:[]});if(v?b.meta=z(G(m)):b.chunks.push(m),a[t].onProgress(l/ce,e,b.meta),!w)return;const k=new Uint8Array(b.chunks.reduce(((e,r)=>e+r.byteLength),0));if(b.chunks.reduce(((e,r)=>(k.set(r,e),e+r.byteLength)),0),delete s[e][t][o],g)a[t].onComplete(k,e,b.meta);else{const r=G(k);a[t].onComplete(h?z(r):r,e)}})(r,e),stream(e){g.onPeerStream(e,r,w[r]),delete w[r]},track(e,n){g.onPeerTrack(e,n,r,v[r]),delete v[r]},signal:e=>C(e,r),close:()=>b(r),error(e){console.error(e),b(r)}}),g.onPeerJoin(r))})),A(((e,r)=>D("",r))),I(((e,r)=>{var n;null===(n=m[r])||void 0===n||n.call(m),delete m[r]})),U(((e,r)=>{var n;return null===(n=t[r])||void 0===n?void 0:n.signal(e)})),q(((e,r)=>w[r]=e)),K(((e,r)=>v[r]=e)),V(((e,r)=>b(r))),j&&addEventListener("beforeunload",P),{makeAction:k,leave:P,async ping(e){if(!e)throw J("ping() must be called with target peer ID");const r=Date.now();return T("",e),await new Promise((r=>m[e]=r)),Date.now()-r},getPeers:()=>M(O(t).map((([e,r])=>[e,r.connection]))),addStream:(e,r,n)=>h(r,(async(r,t)=>{n&&await x(n,r),t.addStream(e)})),removeStream:(e,r)=>h(r,((r,n)=>n.removeStream(e))),addTrack:(e,r,n,t)=>h(n,(async(n,a)=>{t&&await N(t,n),a.addTrack(e,r)})),removeTrack:(e,r)=>h(r,((r,n)=>n.removeTrack(e))),replaceTrack:(e,r,n,t)=>h(n,(async(n,a)=>{t&&await N(t,n),a.replaceTrack(e,r)})),onPeerJoin:e=>g.onPeerJoin=e,onPeerLeave:e=>g.onPeerLeave=e,onPeerStream:e=>g.onPeerStream=e,onPeerTrack:e=>g.onPeerTrack=e}})(0,(e=>delete C[e]),(()=>{delete t[D][P],we.forEach(clearTimeout),ve.forEach((async e=>(await e)())),clearInterval(s),h(),b=!1}))}})({init:e=>((e,r,n)=>(e.relayUrls||r).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||3))(e,Ae).map((e=>{const r=((e,r)=>{const n={},t=()=>{const a=new WebSocket(e);a.onclose=()=>{var r;Q?Q.then(t):(null!==(r=(h=K)[b=e])&&void 0!==r||(h[b]=3333),setTimeout(t,K[e]),K[e]*=2)},a.onmessage=e=>r(e.data),n.socket=a,n.url=a.url,n.ready=new Promise((r=>a.onopen=()=>{r(n),K[e]=3333})),n.send=e=>{1===a.readyState&&a.send(e)}};return t(),n})(e,(e=>{const r=z(e),t=r["failure reason"],a=r["warning message"],{interval:o}=r,s=pe[r.info_hash];if(t)Pe(n,t,!0);else{var i,l;if(a&&Pe(n,a),o&&1e3*o>ve[n]&&we[n][s]){const e=Math.min(1e3*o,120333);clearInterval(me[n][s]),ve[n]=e,me[n][s]=setInterval(we[n][s],e)}ge[r.offer_id]||(r.offer||r.answer)&&(ge[r.offer_id]=!0,null===(l=(i=he[n])[s])||void 0===l||l.call(i,r))}})),{url:n}=r;return fe[n]=r,he[n]={},r.ready})),subscribe(e,r,n,t,a){const{url:o}=e,s=async()=>{const n=M((await a(10)).map((e=>[C(20),e])));he[e.url][r]=a=>{if(a.offer)t(r,{offer:a.offer,peerId:a.peer_id},((n,t)=>ke(e,r,{answer:z(t).answer,offer_id:a.offer_id,to_peer_id:a.peer_id})));else if(a.answer){const e=n[a.offer_id];e&&t(r,{answer:a.answer,peerId:a.peer_id,peer:e.peer})}},ke(e,r,{numwant:10,offers:O(n).map((([e,{offer:r}])=>({offer_id:e,offer:r})))})};return ve[o]=33333,(k=we)[P=o]||(k[P]={}),we[o][r]=s,(T=me)[A=o]||(T[A]={}),me[o][r]=setInterval(s,ve[o]),s(),()=>{clearInterval(me[o][r]),delete he[o][r],delete we[o][r]}},announce:e=>ve[e.url]});const Ae=["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.btorrent.xyz","tracker.files.fm:7073/announce"].map((e=>"wss://"+e))}));
